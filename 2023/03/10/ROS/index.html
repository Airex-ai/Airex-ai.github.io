<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="keywords" content="Hexo Theme Redefine">
    
    <meta name="author" content="Airex Yu">
    <!-- preconnect -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    
    <!--- Seo Part-->
    
    <link rel="canonical" href="http://example.com/2023/03/10/ros/"/>
    <meta name="robots" content="index,follow">
    <meta name="googlebot" content="index,follow">
    <meta name="revisit-after" content="1 days">
    
        <meta name="description" content="ROS概述ROS简介ROS诞生背景  机器人是一种高度复杂的系统性实现，包括机械加工、机械结构设计、硬件设计、嵌入式软件设计、上层软件设计和各种硬件与软件集成，甚至说机器人系统是当今工业体系的集大成者     机器人体系是相当庞大的，其复杂度之高，以至于没有任何个人、组织甚至公司能够独立完成系统性的机器人研发工作 一种更合适的策略是：让机器人研发者专注于自己擅长的邻域，其他模块则直接复用相关邻域更">
<meta property="og:type" content="article">
<meta property="og:title" content="ROS">
<meta property="og:url" content="http://example.com/2023/03/10/ROS/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="ROS概述ROS简介ROS诞生背景  机器人是一种高度复杂的系统性实现，包括机械加工、机械结构设计、硬件设计、嵌入式软件设计、上层软件设计和各种硬件与软件集成，甚至说机器人系统是当今工业体系的集大成者     机器人体系是相当庞大的，其复杂度之高，以至于没有任何个人、组织甚至公司能够独立完成系统性的机器人研发工作 一种更合适的策略是：让机器人研发者专注于自己擅长的邻域，其他模块则直接复用相关邻域更">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/2023/03/10/ROS/image-20230310092210304.png">
<meta property="og:image" content="http://example.com/2023/03/10/ROS/image-20230310093301571.png">
<meta property="og:image" content="http://example.com/2023/03/10/ROS/image-20230311094433501.png">
<meta property="og:image" content="http://example.com/2023/03/10/ROS/image-20230311101037228.png">
<meta property="og:image" content="http://example.com/2023/03/10/ROS/image-20230323143418714.png">
<meta property="og:image" content="http://example.com/2023/03/10/ROS/image-20230311170333301.png">
<meta property="og:image" content="http://example.com/2023/03/10/ROS/image-20230312150846724.png">
<meta property="og:image" content="http://example.com/2023/03/10/ROS/image-20230312151405541.png">
<meta property="og:image" content="http://example.com/2023/03/10/ROS/image-20230312160742726.png">
<meta property="og:image" content="http://example.com/2023/03/10/ROS/image-20230312171144148.png">
<meta property="og:image" content="http://example.com/2023/03/10/ROS/image-20230313083831493.png">
<meta property="og:image" content="http://example.com/2023/03/10/ROS/image-20230313101114809.png">
<meta property="og:image" content="http://example.com/2023/03/10/ROS/image-20230313104440608.png">
<meta property="og:image" content="http://example.com/2023/03/10/ROS/image-20230314093633782.png">
<meta property="og:image" content="http://example.com/2023/03/10/ROS/image-20230314095023251.png">
<meta property="og:image" content="http://example.com/2023/03/10/ROS/image-20230314151458371.png">
<meta property="og:image" content="http://example.com/2023/03/10/ROS/image-20230316095944593.png">
<meta property="og:image" content="http://example.com/2023/03/10/ROS/image-20230321162806856.png">
<meta property="og:image" content="http://example.com/2023/03/10/ROS/image-20230321194133995.png">
<meta property="og:image" content="http://example.com/2023/03/10/ROS/image-20230321194158896.png">
<meta property="og:image" content="http://example.com/2023/03/10/ROS/image-20230322143355855.png">
<meta property="og:image" content="http://example.com/2023/03/10/ROS/image-20230322143443764.png">
<meta property="article:published_time" content="2023-03-10T04:30:45.000Z">
<meta property="article:modified_time" content="2023-05-25T13:21:00.289Z">
<meta property="article:author" content="John Doe">
<meta property="article:tag" content="ROS通信">
<meta property="article:tag" content="ROS自动驾驶">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/2023/03/10/ROS/image-20230310092210304.png">
    
    
    <!--- Icon Part-->
    <link rel="icon" type="image/png" href="/images/%E9%B1%BC.svg" sizes="192x192">
    <link rel="apple-touch-icon" sizes="180x180" href="/images/%E9%B1%BC.svg">
    <meta name="theme-color" content="#A31F34">
    <link rel="shortcut icon" href="/images/%E9%B1%BC.svg">
    <!--- Page Info-->
    
    <title>
        
            ROS -
        
        Airex-Daily
    </title>
    
<link rel="stylesheet" href="/css/style.css">

    
<link rel="stylesheet" href="/assets/fonts.css">

    <!--- Font Part-->
    
    
    
        <link href="" rel="stylesheet">
    
    
        <link href="" rel="stylesheet">
    

    <!--- Inject Part-->
    
    <script id="hexo-configurations">
    let Global = window.Global || {};
    Global.hexo_config = {"hostname":"example.com","root":"/","language":"zh-CN"};
    Global.theme_config = {"articles":{"style":{"font_size":"16px","line_height":1.5,"image_border_radius":"14px","image_alignment":"center","image_caption":false,"link_icon":true},"word_count":{"enable":true,"count":true,"min2read":true},"author_label":{"enable":true,"auto":false,"list":[]},"code_block":{"copy":true,"style":"mac","font":{"enable":false,"family":null,"url":null}},"toc":{"enable":true,"max_depth":3,"number":false,"expand":true,"init_open":true},"copyright":true,"lazyload":true,"recommendation":{"enable":false,"title":"推荐阅读","limit":3,"placeholder":"/images/wallhaven-wqery6-light.webp","skip_dirs":[]}},"colors":{"primary":"#A31F34","secondary":null},"global":{"fonts":{"chinese":{"enable":true,"family":null,"url":null},"english":{"enable":true,"family":null,"url":null}},"content_max_width":"1000px","sidebar_width":"210px","hover":{"shadow":true,"scale":false},"scroll_progress":{"bar":false,"percentage":true},"busuanzi_counter":{"enable":true,"site_pv":true,"site_uv":true,"post_pv":true},"pjax":true,"open_graph":true,"google_analytics":{"enable":false,"id":null}},"home_banner":{"enable":true,"style":"fix","image":{"light":"/images/wallhaven-wqery6-light.webp","dark":"/images/wallhaven-rry6gw.png"},"title":"伸手也握不住彩虹🌈","subtitle":{"text":["——我期待"],"hitokoto":{"enable":true,"api":"https://v1.hitokoto.cn"},"typing_speed":100,"backing_speed":80,"starting_delay":500,"backing_delay":1500,"loop":true,"smart_backspace":true},"text_color":{"light":"#fff","dark":"#d1d1b6"},"text_style":{"title_size":"2.8rem","subtitle_size":"1.5rem","line_height":1.2},"custom_font":{"enable":false,"family":null,"url":null},"social_links":{"enable":true,"links":{"github":"https://github.com/Airex-ai","instagram":null,"zhihu":null,"twitter":null,"email":"airex.yu@foxmail.com"}}},"plugins":{"feed":{"enable":false},"aplayer":{"enable":false,"type":"fixed","audios":[{"name":null,"artist":null,"url":"https://music.163.com/song?id=1501530173&userid=253099352","cover":null}]},"mermaid":{"enable":true,"version":"9.3.0"}},"version":"2.1.5","navbar":{"auto_hide":true,"color":{"left":"#f78736","right":"#367df7","transparency":35},"links":{"Home":{"path":"/","icon":"fa-regular fa-house"},"Archives":{"path":"/archives","icon":"fa-regular fa-archive"},"About":{"icon":"fa-regular fa-user","submenus":{"Github":"https://github.com/Airex-ai?tab=repositories"}},"随记":{"icon":"fa-solid fa-tree-palm","path":"/masonry/"}},"search":{"enable":true,"preload":true}},"page_templates":{"friends_column":2,"tags_style":"blur"},"home":{"sidebar":{"enable":true,"position":"left","first_item":"menu","announcement":null,"links":{"Archives":{"path":"/archives","icon":"fa-regular fa-archive"},"Tags":{"path":"/tags","icon":"fa-regular fa-tags"},"Categories":{"path":"/categories","icon":"fa-regular fa-folder"}}},"article_date_format":"auto","categories":{"enable":true,"limit":3},"tags":{"enable":true,"limit":3}}};
    Global.language_ago = {"second":"%s 秒前","minute":"%s 分钟前","hour":"%s 小时前","day":"%s 天前","week":"%s 周前","month":"%s 个月前","year":"%s 年前"};
    Global.data_config = {"masonry":false};
  </script>
    
    <!--- Fontawesome Part-->
    
<link rel="stylesheet" href="/fontawesome/fontawesome.min.css">

    
<link rel="stylesheet" href="/fontawesome/brands.min.css">

    
<link rel="stylesheet" href="/fontawesome/solid.min.css">

    
<link rel="stylesheet" href="/fontawesome/regular.min.css">

    
    
    
    
<meta name="generator" content="Hexo 6.3.0"></head>


<body>
<div class="progress-bar-container">
    

    
        <span class="pjax-progress-bar"></span>
        <span class="pjax-progress-icon">
            <i class="fa-solid fa-circle-notch fa-spin"></i>
        </span>
    
</div>


<main class="page-container">

    

    <div class="main-content-container">

        <div class="main-content-header">
            <header class="navbar-container">
    
    <div class="navbar-content">
        <div class="left">
            
            <a class="logo-title" href="/">
                
                Airex-Daily
                
            </a>
        </div>

        <div class="right">
            <!-- PC -->
            <div class="desktop">
                <ul class="navbar-list">
                    
                        
                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class="" 
                                    href="/"  >
                                    
                                        
                                            <i class="fa-regular fa-house"></i>
                                        
                                        首页
                                    
                                </a>
                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class="" 
                                    href="/archives"  >
                                    
                                        
                                            <i class="fa-regular fa-archive"></i>
                                        
                                        归档
                                    
                                </a>
                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class="has-dropdown" 
                                    href="#" onClick="return false;">
                                    
                                        
                                            <i class="fa-regular fa-user"></i>
                                        
                                        关于&nbsp;<i class="fa-solid fa-chevron-down"></i>
                                    
                                </a>
                                <!-- Submenu -->
                                
                                    <ul class="sub-menu">
                                    
                                        <li>
                                        <a target="_blank" rel="noopener" href="https://github.com/Airex-ai?tab=repositories">GITHUB
                                        </a>
                                        </li>
                                    
                                    </ul>
                                
                            </li>
                    
                        
                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class="" 
                                    href="/masonry/"  >
                                    
                                        
                                            <i class="fa-solid fa-tree-palm"></i>
                                        
                                        随记
                                    
                                </a>
                                <!-- Submenu -->
                                
                            </li>
                    
                    
                        <li class="navbar-item search search-popup-trigger">
                            <i class="fa-solid fa-magnifying-glass"></i>
                        </li>
                    
                </ul>
            </div>
            <!-- Mobile -->
            <div class="mobile">
                
                    <div class="icon-item search search-popup-trigger"><i class="fa-solid fa-magnifying-glass"></i></div>
                
                <div class="icon-item navbar-bar">
                    <div class="navbar-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile drawer -->
    <div class="navbar-drawer">
        <ul class="drawer-navbar-list">
            
                
                    <li class="drawer-navbar-item flex-center">
                        <a class="" 
                        href="/"  >
                             
                                
                                    <i class="fa-regular fa-house"></i>
                                
                                首页
                            
                        </a>
                    </li>
                    <!-- Submenu -->
                    
            
                
                    <li class="drawer-navbar-item flex-center">
                        <a class="" 
                        href="/archives"  >
                             
                                
                                    <i class="fa-regular fa-archive"></i>
                                
                                归档
                            
                        </a>
                    </li>
                    <!-- Submenu -->
                    
            
                
                    <li class="drawer-navbar-item flex-center">
                        <a class="has-dropdown" 
                        href="#" onClick="return false;">
                            
                                
                                    <i class="fa-regular fa-user"></i>
                                
                                关于&nbsp;<i class="fa-solid fa-chevron-down"></i>
                            
                        </a>
                    </li>
                    <!-- Submenu -->
                              
                        
                            <li class="dropdown-item flex-center">
                                <a class="dropdown-item" target="_blank" rel="noopener" href="https://github.com/Airex-ai?tab=repositories">GITHUB</a>
                            </li>
                        
                    
            
                
                    <li class="drawer-navbar-item flex-center">
                        <a class="" 
                        href="/masonry/"  >
                             
                                
                                    <i class="fa-solid fa-tree-palm"></i>
                                
                                随记
                            
                        </a>
                    </li>
                    <!-- Submenu -->
                    
            

        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="main-content-body">

            

            <div class="main-content">

                
                    <div class="fade-in-down-animation">
    <div class="post-page-container">
        <div class="article-content-container">

            
             
                <div class="article-title">         
                    <img src="/images/ROS.jpg" alt="ROS" />
                    <h1 class="article-title-cover">ROS</h1>
                </div>
            
                
            

            
                <div class="article-header">
                    <div class="avatar">
                        <img src="/images/%E5%A4%B4%E5%83%8F.JPG">
                    </div>
                    <div class="info">
                        <div class="author">
                            <span class="name">Airex Yu</span>
                            
                                <span class="author-label">Lv3</span>
                            
                        </div>
                        <div class="meta-info">
                            <div class="article-meta-info">
    <span class="article-date article-meta-item">
        <i class="fa-regular fa-pen-fancy"></i>&nbsp;
        <span class="desktop">2023-03-10 12:30:45</span>
        <span class="mobile">2023-03-10 12:30</span>
        <span class="hover-info">创建</span>
    </span>
    
        <span class="article-date article-meta-item">
            <i class="fa-regular fa-wrench"></i>&nbsp;
            <span class="desktop">2023-05-25 21:21</span>
            <span class="mobile">2023-05-25 21:21</span>
            <span class="hover-info">更新</span>
        </span>
    

    
        <span class="article-categories article-meta-item">
            <i class="fa-regular fa-folders"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/categories/ROS/">ROS</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    
    
        <span class="article-tags article-meta-item">
            <i class="fa-regular fa-tags"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/tags/ROS%E9%80%9A%E4%BF%A1/">ROS通信</a>&nbsp;
                    </li>
                
                    <li>
                        | <a href="/tags/ROS%E8%87%AA%E5%8A%A8%E9%A9%BE%E9%A9%B6/">ROS自动驾驶</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    

    
    
    
    
        <span class="article-pv article-meta-item">
            <i class="fa-regular fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>
        </span>
    
</div>

                        </div>
                    </div>
                </div>
            

            <div class="article-content markdown-body">
                <h1 id="ROS概述"><a href="#ROS概述" class="headerlink" title="ROS概述"></a>ROS概述</h1><h2 id="ROS简介"><a href="#ROS简介" class="headerlink" title="ROS简介"></a>ROS简介</h2><p><strong>ROS诞生背景</strong></p>
<blockquote>
<p>机器人是一种高度复杂的系统性实现，包括机械加工、机械结构设计、硬件设计、嵌入式软件设计、上层软件设计和各种硬件与软件集成，甚至说机器人系统是当今工业体系的集大成者</p>
</blockquote>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/03/10/ROS/image-20230310092210304.png"
                      class="" title="image-20230310092210304"
                >

<blockquote>
<p>机器人体系是相当庞大的，其复杂度之高，以至于没有任何个人、组织甚至公司能够独立完成系统性的机器人研发工作</p>
<p>一种更合适的策略是：让机器人研发者专注于自己擅长的邻域，其他模块则直接复用相关邻域更专业研发团队的实现，当然自身的研究也可以被其他人继续复用。这种基于“复用”的分工写作，遵循了<strong>不重复发明轮子</strong>的原则，显然是可以大大提高机器人的研发效率的，尤其是随着机器人硬件越来越丰富，软件库越来越庞大，这种复用性和模块化开发需求也愈发激烈</p>
</blockquote>
<p>在此大背景下，2007年，一家名为柳树车库（Willow Garage）的机器人公司发布了ROS（机器人操作系统），ROS是 一套机器人通用软件框架，可以提升功能模块的复用性，并且随着该系统的不断迭代与完善，如今ROS已经称为机器人邻域的事实标准。</p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/03/10/ROS/image-20230310093301571.png"
                      class="" title="image-20230310093301571"
                >

<h3 id="ROS概念"><a href="#ROS概念" class="headerlink" title="ROS概念"></a>ROS概念</h3><p><strong>ROS全称Robot Operating System（机器人操作系统）</strong></p>
<ul>
<li>ROS是适用于机器人的开源<strong>元操作系统（搭建在实际操作系统上的类操作系统软件）</strong></li>
<li>ROS集成了大量的工具、库、协议、提供类似OS所提供的功能，简化对机器人的控制</li>
<li>还提供了在多台计算机（<strong>分布式</strong>）上获取，构建，编写和运行代码的工具和库，ROS在某些方面类似于“机器人框架”</li>
<li>ROS设计者将ROS表述为<code>ROS = Plumbing + Tools + Capabilities +Ecosystem</code>，即ROIS是通讯机制，工具软件包，机器人高层技能以及机器人生态系统的集合体</li>
</ul>
<h3 id="ROS设计目标"><a href="#ROS设计目标" class="headerlink" title="ROS设计目标"></a>ROS设计目标</h3><p>机器人开发的分工思想，实现了不同研发团队的共享和协作，提升了机器人的研发效率，为了服务“分工”，ROS主要设计了如下目标：</p>
<ul>
<li>代码复用：ROS目标不是称为具有最多功能的框架，ROS主要目标是支持机器人技术研发中的代码重用</li>
<li>分布式：ROS是进程（也称为Nodes）的分布式框架，ROS中的进程可分布于不同主机，不同主机协同合作，从而分散计算压力。</li>
<li>松耦合：ROS中功能模块封装于独立的功能包或元功能包，便于分享，功能包内的模块以节点为单位运行，以ROS标准的IO作为接口，开发者不需要关注模块内部实现，只要了解接口规则就能实现复用，实现了模块间点对点的松耦合连接</li>
<li>精简：ROS被设计为尽可能精简，以便为ROS编写的代码可以与其他机器人软件框架一起使用。ROS易于其他机器人软件框架集成：ROS已与OpenRAVE，Orocos和Player集成</li>
<li>语言独立性：包括Java，C++，Python等。为了支持更多应用开发和移植，ROS设计为一种语言弱相关的框架结构，使用简介，中立的定义语言描述模块间的消息接口，在编译中再产生所使用语言的目标文件，为消息交互提供支持，同时允许消息接口的嵌套使用</li>
<li>易于测试：ROS具有称为rostest的内置单元&#x2F;集成测试框架，可轻松安装和拆卸测试工具</li>
<li>大型应用：ROS适用于大型运行时系统和大型开发流程。</li>
<li>丰富的组件化工具包：ROS可采用组件化方式集成一些工具和软件到系统中并作为一个组件直接使用，如RVIZ（3D可视化工具），开发者根据ROS接口在其中显示机器人模型，组件还包括仿真环境和消息查看工具等</li>
</ul>
<h3 id="ROS发展历程"><a href="#ROS发展历程" class="headerlink" title="ROS发展历程"></a>ROS发展历程</h3><ul>
<li><p>ROS是一个由来已久、贡献者众多的大型软件项目。在ROS诞生之前，很多学者认为，机器人研究需要一个开放式的协作框架，并且已经有不少类似的项目致力于实现这样的框架。在这些工作中，斯坦福大学在2000年年中开展了一系列相关研究项目，如斯坦福人工智能机器人(STandford Al Robot,STAIR)项目、个人机器人(Personal Robots, PR）项目等，在上述项目中，在研究具有代表性、集成式人工智能系统的过程中，创立了用于室内场景的高灵活性、动态软件系统，其可以用于机器人学研究。</p>
</li>
<li><p>2007年，柳树车库(Willow Garage）提供了大星资源，用于将斯坦福大学机器人项目中的软件系统进行扩展与完善，同时，在无数研究人员的共同努力下，ROS的核心思想和基本软件包逐渐得到完善。</p>
</li>
<li><p>ROS的发行版本(ROS distribution）指ROS软件包的版本，其与Linux的发行版本(如Ubuntu）的概念类似。推出ROS发行版本的目的在于使开发人员可以使用相对稳定的代码库，直到其准备好将所有内容进行版本升级为止。因此，每个发行版本推出后，ROS开发者通常仅对这一版本的bug进行修复，同时提供少量针对核心软件包的改进。<br>版本特点:按照英文字母顺序命名，ROS目前已经发布了ROS1的终极版本: noetic，并建议后期过渡至ROS2版本。noetic 版本之前默认使用的是Python2，noetic支持Python3。<br>建议版本: noetic 或 melodic 或 kinetic</p>
</li>
</ul>
<h2 id="ROS安装"><a href="#ROS安装" class="headerlink" title="ROS安装"></a>ROS安装</h2><h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>我们使用的是ROS版本是 Noetic，那么可以在ubuntu20.04、Mac或windows10系统上安装，虽然一般用户平时使用的操作系统以windows居多，但是ROS之前的版本基本都不支持windows，所以当前我们选用的操作系统是ubuntu，以方便向历史版本过渡。ubuntu安装常用方式有两种:</p>
<ul>
<li>实体机安装ubuntu(较为常用的是使用双系统，windows 与 ubuntu并存);</li>
<li>虚拟机安装ubuntu。</li>
</ul>
<p>两种方式比较，各有优缺点:</p>
<ul>
<li>方案1可以保证性能，且不需要考虑硬件兼容性问题，但是和windows系统交互不便;</li>
<li>方案2可以方便的实现windows 与ubuntu交互，不过性能稍差，且与硬件交互不便。</li>
</ul>
<p>在ROS中，一些仿真操作是比较耗费系统资源的，且经常需要和一些硬件(雷达、摄像头、imu、STM32、arduino…)交互，因此，原则上建议采用方案1，不过如果只是出于学习目的，那么方案2也基本够用，且方案2在windows与ubuntu的交互上更为方便，对于学习者更为友好，因此本教程在此选用的是方案2。当然，具体采用哪种实现方案，请按需选择。</p>
<p>如果采用虚拟机安装ubuntu，再安装ROS的话，大致流程如下:</p>
<ol>
<li>安装虚拟机软件(比如: virtualbox或 VMware);</li>
<li>使用虚拟机软件虚拟一台主机;</li>
<li>在虚拟主机上安装ubuntu 20.04;</li>
<li>在ubuntu 上安装ROS;</li>
<li>测试ROS环境是否可以正常运行。</li>
</ol>
<p>虚拟机软件选择上，对于我们学习而言vitualbox和VMware都可以满足需求，二者比较，前者免费，后者收费，所以本教程选用virtualbox。</p>
<h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><p>Ubuntu安装完毕后，就可以安装ROS-Kinetic操作系统了，大致步骤如下:</p>
<ol>
<li><p>配置ubuntu的软件和更新;</p>
</li>
<li><p>设置安装源;</p>
</li>
<li><p>设置key;</p>
</li>
<li><p>安装;</p>
</li>
<li><p>初始化rosdep</p>
</li>
<li><p>配置环境变量。</p>
</li>
</ol>
<blockquote>
<ol>
<li>配置Ubuntu的软件和更新</li>
</ol>
</blockquote>
<p>配置ubuntu的软件和更新，允许安装不经认证的软件。<br>首先打开“软件和更新”对话框，具体可以在Ubuntu搜索按钮中搜索。<br>打开后按照下图进行配置（确保勾选了”restricted”，”universe,”和”multiverse.”)</p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/03/10/ROS/image-20230311094433501.png"
                      class="" title="image-20230311094433501"
                >

<blockquote>
<ol start="2">
<li>设置安装源</li>
</ol>
</blockquote>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo sh -c &#x27;. /etc/lsb-release &amp;&amp; echo &quot;deb http://mirrors.ustc.edu.cn/ros/ubuntu/ $DISTRIB_CODENAME main&quot; &gt; /etc/apt/sources.list.d/ros-latest.list&#x27;</span><br></pre></td></tr></table></figure></div>

<p><strong>可以使用其他的镜像源进行替换</strong></p>
<blockquote>
<ol start="3">
<li>设置KEY</li>
</ol>
</blockquote>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-key adv --keyserver &#x27;hkp://keyserver.ubuntu.com:80&#x27; --recv-key C1CF6E31E6BADE8868B172B4F42ED6FBAB17C654</span><br></pre></td></tr></table></figure></div>

<blockquote>
<ol start="4">
<li>安装</li>
</ol>
</blockquote>
<p>首先执行安装apt（以前是apt-get，官方建议apt），apt是用于从互联网仓库搜素，安装，省级，卸载软件或操作系统的工具）</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update				(更换了镜像以后一定要更新)</span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install ros-kinetic-desktop-full</span><br></pre></td></tr></table></figure></div>

<blockquote>
<ol start="5">
<li>初始化rosdep</li>
</ol>
</blockquote>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo rosdepc init</span><br></pre></td></tr></table></figure></div>

<p><strong>注意：这里绝大多数情况都会报错！！！</strong></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//用鱼香的工具解决</span><br><span class="line">wget http://fishros.com/install -O fishros &amp;&amp; bash fishros</span><br></pre></td></tr></table></figure></div>

<p>最后再次执行如下命令：</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rosdepc update</span><br></pre></td></tr></table></figure></div>

<p>最后安装成功</p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/03/10/ROS/image-20230311101037228.png"
                      class="" title="image-20230311101037228"
                >

<blockquote>
<ol start="6">
<li>配置环境变量</li>
</ol>
</blockquote>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;source /opt/ros/kinetic/setup.bash&quot; &gt;&gt; ~/.bashrc</span><br><span class="line">source ~/.bashrc</span><br></pre></td></tr></table></figure></div>

<p><strong>额外配置：安装rosinstall等工具</strong></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install python-rosinstall python-rosinstall-generator python-wstool build-essential</span><br></pre></td></tr></table></figure></div>

<h3 id="卸载"><a href="#卸载" class="headerlink" title="卸载"></a>卸载</h3><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get remove ros-kinetic-*</span><br></pre></td></tr></table></figure></div>

<h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><p>ROS内置了一些小程序，可以通过运行这些小程序以检测ROS环境是否可以正常运行</p>
<ol>
<li><p>首先启动三个命令行(ctrl + alt + T)</p>
</li>
<li><p>命令行1键入: <strong>roscore</strong></p>
</li>
<li><p>命令行2键入: <strong>rosrun turtlesim turtlesim_node</strong>(此时会弹出图形化界面)</p>
</li>
<li><p>命令行3键入: **rosrun turtlesim turtle_teleop_key(**在3中可以通过上下左右控制2中乌龟的运动)</p>
</li>
</ol>
<p><strong>注意：光标必须聚焦在键盘控制窗口，否则无法控制乌龟移动</strong></p>
<h2 id="ROS快速体验"><a href="#ROS快速体验" class="headerlink" title="ROS快速体验"></a>ROS快速体验</h2><p>ROS中涉及的编程语言以C++和Python为主，ROS中的大多数程序两者都可以实现，在本系列教程中，每一个案例也都会分别使用C++和Python两种方案演示，大家可以根据自身情况选择合适的实现方案</p>
<p>ROS中的程序即便使用不同的编程语言，实现流程也大致类似，以当前HelloWorld程序为例，实现流程大致如下:</p>
<ol>
<li>先创建—个工作空间;</li>
<li>再创建—个功能包;</li>
<li>编辑源文件;</li>
<li>编辑配置文件;</li>
<li>编译并执行。</li>
</ol>
<blockquote>
<ol>
<li>创建工作空间并初始化</li>
</ol>
</blockquote>
<p>首先创建一个工作空间以及一个src子目录，然后进入工作空间再调用catkin_make命令编译。</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p 自定义工作空间名称/src</span><br><span class="line">cd 自定义空间名称</span><br><span class="line">catkin_make</span><br></pre></td></tr></table></figure></div>

<p>上述流程中，C++和Python只是在步骤3和步骤4的实现细节上存在差异，其他流程基本一致。本节先实现C++和Python程序编写的通用部分步骤1与步骤2，1.3.2节和1.3.3节再分别使用C++和Python编写HelloWorld。</p>
<blockquote>
<ol start="2">
<li>进入src创建ros包并添加依赖</li>
</ol>
</blockquote>
 <div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd src</span><br><span class="line">catkin_create_pkg 自定义包名 roscpp rospy std_msgs</span><br></pre></td></tr></table></figure></div>

<p>上述命令，会在工作空间下生成一个功能包，该功能包依赖于roscpp、rospy与 std_msgs，其中<strong>roscpp是使用C++实现的库，而rospy则是使用python实现的库，std_msgs是标准消息库</strong>，创建ROS功能包时，一般都会依赖这三个库实现。</p>
<p>**注意:**在ROS中，虽然实现同一功能时，C++和Python可以互换，但是具体选择哪种语言，需要视需求而定，因为两种语言相较而言:C++运行效率高但是编码效率低，而Python则反之，基于二者互补的特点，ROS设计者分别设计了roscpp与rospy库，前者旨在成为ROS的高性能库，而后者则一般用于对性能无要求的场景，旨在提高开发效率。</p>
<h3 id="C-版"><a href="#C-版" class="headerlink" title="C++版"></a>C++版</h3><blockquote>
<ol>
<li>进入ros包的src目录编辑源文件</li>
</ol>
</blockquote>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd 自定义的包</span><br></pre></td></tr></table></figure></div>

<p>C++源码是实现（文件名自定义）</p>
<div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ros/ros.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc,<span class="type">char</span> *argv[])</span></span>&#123;</span><br><span class="line">    <span class="comment">//执行ros节点初始化</span></span><br><span class="line">    ros::<span class="built_in">init</span>(argc,argv,<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">    <span class="comment">//创建ros节点句柄（非必须）</span></span><br><span class="line">    ros::NodeHandle n;</span><br><span class="line">    <span class="comment">//控制台输出hello world</span></span><br><span class="line">    <span class="built_in">ROS_INFO</span>(<span class="string">&quot;hello world!&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<blockquote>
<ol start="2">
<li>编辑ros包下的Cmakelist.txt文件</li>
</ol>
</blockquote>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">add_executable(步骤3的源文件名(源文件映射名称)</span><br><span class="line">	src/C++源文件名.cpp</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">target_link_libraries(步骤3的源文件名(源文件映射名称)</span><br><span class="line">	&amp;&#123;catkin_LIBRAYIES&#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure></div>

<blockquote>
<ol start="3">
<li>进入工作空间目录并编译</li>
</ol>
</blockquote>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd 自定义空间名称</span><br><span class="line">catkin_make</span><br></pre></td></tr></table></figure></div>

<blockquote>
<ol start="4">
<li>执行</li>
</ol>
</blockquote>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">roscore       //命令行1</span><br><span class="line"></span><br><span class="line">cd 工作空间		//命令行2</span><br><span class="line">source ./devel/setup.bash			//刷新环境变量</span><br><span class="line">rosrun 包名 C++节点		//命令行会输出hello world！</span><br></pre></td></tr></table></figure></div>

<p><strong>注意：</strong> <code>source ~/工作空间/devel/setup.bash</code>可以添加进<code>.bashrc</code>文件，使用上更方便</p>
<p><strong>默认情况下，source只有在刷新环境变量的窗口有用，以下方式可以让source在任意窗口都可以使用</strong></p>
<p>添加方式1：直接使用gedit或vi编辑.bashrc文件，最后添加该内容</p>
<p>添加方式2：<code>echo &quot;source ~/工作空间/devel/setupbash&quot; &gt;&gt; ~/.bashrc</code></p>
<h3 id="Python版"><a href="#Python版" class="headerlink" title="Python版"></a>Python版</h3><blockquote>
<ol>
<li>进入ros包添加scripts目录并编辑python文件</li>
</ol>
</blockquote>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd ros包</span><br><span class="line">mkdir scripts</span><br></pre></td></tr></table></figure></div>

<p>新建python文件（文件自定义）：</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#！ /usr/bin/env python			##选择编译器</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"><span class="keyword">if</span> __name__ ==<span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    rospy.init_node(<span class="string">&quot;hello&quot;</span>)</span><br><span class="line">    rospy.loginfo(<span class="string">&quot;hello world!&quot;</span>)</span><br></pre></td></tr></table></figure></div>

<blockquote>
<ol start="2">
<li>为python文件添加可执行权限</li>
</ol>
</blockquote>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod +x 自定义文件名.py</span><br></pre></td></tr></table></figure></div>

<blockquote>
<ol start="3">
<li>编辑ros包下的CmakeList.txt文件</li>
</ol>
</blockquote>
<p><strong>注意：此操作noetic版本不需要</strong></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">catkin_install_python(PROGRAMS scripts/自定义文件名.py</span><br><span class="line">	DESTINATION $(CATKIN_PACKAGE_BIN_DESTINATION)</span><br><span class="line">)</span><br></pre></td></tr></table></figure></div>

<blockquote>
<ol start="4">
<li>进入工作空间目录并编译</li>
</ol>
</blockquote>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd 自定义空间名称</span><br><span class="line">catkin_make</span><br></pre></td></tr></table></figure></div>

<blockquote>
<ol start="5">
<li>进入工作空间目录并执行</li>
</ol>
</blockquote>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">roscore      //命令行1</span><br><span class="line"></span><br><span class="line">cd 工作空间		//命令行2</span><br><span class="line">source ./devel/setup.bash</span><br><span class="line">rosrun 包名 自定义文件名.py</span><br></pre></td></tr></table></figure></div>

<p>输出结果：hello world！</p>
<h2 id="ROS集成开发环境搭建"><a href="#ROS集成开发环境搭建" class="headerlink" title="ROS集成开发环境搭建"></a>ROS集成开发环境搭建</h2><h3 id="安装终端"><a href="#安装终端" class="headerlink" title="安装终端"></a>安装终端</h3><p>在ros中，需要频繁的使用到终端，且可能需要同时开启多个窗口，推荐使用<strong>Terminator</strong>。</p>
<blockquote>
<p>1.安装</p>
</blockquote>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install terminator</span><br></pre></td></tr></table></figure></div>

<blockquote>
<p>2.Terminator常用快捷键</p>
</blockquote>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Alt+Up												//移动到上面的终端</span><br><span class="line">Alt+Down											//移动到下面的终端</span><br><span class="line">Alt+Left											//移动到左边的终端</span><br><span class="line">Alt+Right											//移动到右边的终端</span><br><span class="line">ctrl+Shift+0										//平分割终端</span><br><span class="line">ctrl+Shift+E										//垂直分害终端</span><br><span class="line">Ctrl+Shift+Right									//在垂直分割的终端中将分割条向右移动</span><br><span class="line">ctrl+Shift+Left										//垂直分割的终端中将分割条向左移动</span><br><span class="line">Ctrl+Shift+Up										//在水平分割的终端中将分割条向上移动</span><br><span class="line">Ctrl+Shift+Down										//水平分割的终端中将分割条向下移动</span><br><span class="line">Ctrl+Shift+S										//隐藏/显示滚动条</span><br><span class="line">Ctrl+Shift+F										//搜索</span><br><span class="line">Ctrl+Shift+C										//复制选中的内容到剪贴板</span><br><span class="line">Ctrl+Shift+V										//粘贴剪贴板的内容到此处</span><br><span class="line">ctrl+Shift+w										//关闭当前终端</span><br><span class="line">Ctrl+Shift+Q										//退出当前窗口，当前窗口的所有终端都将被关闭</span><br><span class="line">Ctrl+Shift+X										//最大化显示当前终端</span><br><span class="line">Ctrl+Shift+Z										//最大化显示当前终端并使字体放大</span><br><span class="line">Ctrl+Shift+N or Ctrl+Tab							//移动到下一个终端</span><br><span class="line">Ctrl+Shift+P or Ctrl+Shift+Tab						 //Crtl+Shift+Tab移动到之前的一个终端</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<h3 id="安装vscode"><a href="#安装vscode" class="headerlink" title="安装vscode"></a>安装vscode</h3><p>下载好ubuntu的deb文件，然后运行</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo dpkg -i code_1.62.2-1636665017_amd64.deb</span><br></pre></td></tr></table></figure></div>

<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/03/10/ROS/image-20230323143418714.png"
                      class="" title="image-20230323143418714"
                >

<h3 id="vscode使用-基本配置"><a href="#vscode使用-基本配置" class="headerlink" title="vscode使用_基本配置"></a>vscode使用_基本配置</h3><blockquote>
<ol>
<li>创建ROS工作空间</li>
</ol>
</blockquote>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p 工作空间名/src</span><br><span class="line">cd 工作空间名</span><br><span class="line">catkin_make</span><br></pre></td></tr></table></figure></div>

<blockquote>
<ol start="2">
<li>启动vscode</li>
</ol>
</blockquote>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd 工作空间</span><br><span class="line">code .</span><br></pre></td></tr></table></figure></div>

<blockquote>
<ol start="3">
<li>vscode中编译ros</li>
</ol>
</blockquote>
<p>快捷键 ctrl + shift + B调用编译，选择：<code>catkin_make:build</code>	可以点击配置设置为默认，修改.vscode&#x2F;tasks.json文件</p>
<div class="highlight-container" data-rel="Json"><figure class="iseeu highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"><span class="comment">//有关tasks.json格式的文档，请参见</span></span><br><span class="line">    <span class="comment">// https:/ /go.microsoft.com/fwlink / ?LinkId=733558</span></span><br><span class="line">    <span class="attr">&quot;version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2.0.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;tasks&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;label&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;catkin_make: debug&quot;</span><span class="punctuation">,</span><span class="comment">//代表提示的描述性信息</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;shell&quot;</span><span class="punctuation">,</span><span class="comment">//可以选择shell或者process</span></span><br><span class="line">            <span class="attr">&quot;command&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;catkin_make&quot;</span> <span class="punctuation">,</span><span class="comment">//这个是我们需要运行的命令</span></span><br><span class="line">            <span class="attr">&quot;args&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="comment">//如果需要在命令后面加一些后缀，可以写在这里，比如-DCATKIN_MWHITELIST_PACKAGES=</span></span><br><span class="line">            <span class="attr">&quot;group&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="attr">&quot;kind&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;build&quot;</span> <span class="punctuation">,</span> <span class="attr">&quot;isDefault&quot;</span> <span class="punctuation">:</span><span class="literal"><span class="keyword">true</span></span><span class="punctuation">&#125;</span><span class="punctuation">,</span>			<span class="comment">//编译时默认执行该命令</span></span><br><span class="line">            <span class="attr">&quot;presentation&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;reveal&quot;</span><span class="punctuation">:</span> <span class="string">&quot;always&quot;</span> <span class="comment">//可选always或者silence，代表是否输出信息</span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;problemMatcher&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;$mscompile&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">   <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></div>

<blockquote>
<ol start="4">
<li>创建ROS功能包</li>
</ol>
</blockquote>
<p>选定src目录—&gt;create catkin package</p>
<p>输入包名—&gt;输入roscpp rospy std_msgs依赖</p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/03/10/ROS/image-20230311170333301.png"
                      class="" title="image-20230311170333301"
                >

<blockquote>
<ol start="5">
<li>C++实现</li>
</ol>
</blockquote>
<div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ros/ros.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc,<span class="type">char</span> *argv[])</span></span>&#123;</span><br><span class="line">    <span class="comment">//执行ros节点初始化</span></span><br><span class="line">    ros::<span class="built_in">init</span>(argc,argv,<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">    <span class="comment">//创建ros节点句柄（非必须）</span></span><br><span class="line">    ros::NodeHandle n;</span><br><span class="line">    <span class="comment">//控制台输出hello world</span></span><br><span class="line">    <span class="built_in">ROS_INFO</span>(<span class="string">&quot;hello world!&quot;</span>);					</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p><strong>python实现</strong></p>
<p>在功能包下新建scripts文件夹，添加python文件，并添加<strong>可执行权限</strong></p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/env python</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    	rospy.init_node(<span class="string">&quot;hello_vscode_p&quot;</span>)</span><br><span class="line">        rospy.loginfo(<span class="string">&quot;hello vscode，我是python .....&quot;</span>)</span><br></pre></td></tr></table></figure></div>

<blockquote>
<ol start="6">
<li>配置CMakeLists.txt</li>
</ol>
</blockquote>
<p><strong>C++配置:</strong></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">add_executable(节点名称</span><br><span class="line">	src/C++源文件名.cpp</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">target_link_lirary(节点名称</span><br><span class="line">	$&#123;catkin_LIBRARY&#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure></div>

<p><strong>python配置：</strong>		</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">catkin_install_python(PROGRAMS scripts/自定义文件名.py</span><br><span class="line">	DESTINATION $&#123;CATKIN_PACKAGR_BIN_DESTINATION&#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure></div>

<p><strong>当不配置<code>CMakeList.txt</code>文件时，执行python文件抛出异常：<code>/usr/bin/env: &quot;python&quot; 没有那个文件或目录</code></strong></p>
<p>原因：noetic使用的是python3，如果不配置的话，noetic会到<code>/usr/bin/env python</code>下找解释器，导致错误</p>
<p>解决方法：</p>
<ol>
<li>直接声明解释器为python3（不建议）：因为很多情况下我们不能修改别人的代码</li>
<li>通过软链接将python链接到python3（建议）</li>
</ol>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//命令行执行</span><br><span class="line">sudo ln -s /usr/bin/python3 /usr/bin/python</span><br></pre></td></tr></table></figure></div>



<blockquote>
<p>7.编译实现</p>
</blockquote>
<p>编译：ctrl + shift + B</p>
<p>执行：和之前一致，但现在在VScode中添加终端，首先执行：<code>source ./devel/setup.bash</code></p>
<p><strong>注意：如果不编译直接执行python文件，会抛出异常</strong></p>
<ol>
<li>.第一行解释器声明，可以使用绝对路径定位到 python3的安装路径# &#x2F;usr&#x2F;bin&#x2F;python3，但是不建议</li>
<li>.建议使用#&#x2F;usr&#x2F;binlenv python但是会抛出异常:&#x2F;usr&#x2F;bin&#x2F;env: “python”:没有那个文件或目录</li>
<li>.解决1.:#l&#x2F;usr&#x2F;bin&#x2F;env python3直接使用python3但存在问题:不兼容之前的ROS相关python实现</li>
<li>.解决2:创建一个链接符号到python 命令: sudo ln -s &#x2F;usr&#x2F;bin&#x2F; python3 &#x2F;usr&#x2F;bin&#x2F;python</li>
</ol>
<p>注意：</p>
<ol>
<li><strong>若没有编码提示要修改<code>c_cpp_properties.json</code>文件，设置”cppStandard”:”C++17”</strong></li>
<li>main函数的参数不可以被const修饰</li>
<li>当ROS_INFO终端输出中文时，会出现乱码<ul>
<li>解决办法：在函数开头加入下面代码的任意一句</li>
</ul>
</li>
</ol>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">setlocale(LC_CTYPE,<span class="string">&quot;zh_CN.utf8&quot;</span>);</span><br><span class="line">setlocale(LC_ALL,<span class="string">&quot;&quot;</span>);</span><br></pre></td></tr></table></figure></div>

<h2 id="launch文件演示"><a href="#launch文件演示" class="headerlink" title="launch文件演示"></a>launch文件演示</h2><blockquote>
<p>需求</p>
</blockquote>
<p>一个程序可能需要启动多个节点，比如：ROS内置的小乌龟案例，如果要控制乌龟运动，要启动多个窗口，分别启动roscore、乌龟界面节点、键盘控制节点。如果每次都调用rosrun逐一启动，显然效率低下。<strong>官方给出的优化策略是使用launch文件，一次性启动多个ros节点</strong></p>
<blockquote>
<p>实现</p>
</blockquote>
<ol>
<li>选定功能包点击 —&gt; launch文件夹</li>
<li>选定launch文件夹点击 —&gt; 添加launch文件</li>
<li>编辑launch文件内容</li>
</ol>
 <div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;launch&gt;</span><br><span class="line">	&lt;node pkg=&quot;helloworld&quot; type=&quot;demo_hello&quot; name=&quot;hello&quot; output=&quot;screen”/&gt;</span><br><span class="line">	&lt;node pkg=&quot;turtlesim&quot; type=&quot;turtlesim_node&quot; name=&quot;t1&quot;/&gt;</span><br><span class="line">	&lt;node pkg=&quot;turtlesim&quot; type=&quot;turtle_teleop_key&quot; name=&quot;key1&quot; /&gt;</span><br><span class="line">&lt;/launch&gt;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>node：包含的某个节点</li>
<li>pkg：功能包</li>
<li>type：被运行的节点文件</li>
<li>name：为节点命名</li>
<li><strong>output：设置日志的输出目标</strong> ，在控制台中输出信息 <code>output=&quot;screen&quot;</code></li>
</ul>
<ol start="4">
<li>运行launch文件</li>
</ol>
<p><code>roslaunch 包名 launch文件名</code></p>
<ol start="5">
<li>运行结果：一次性启动了多个节点</li>
</ol>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/03/10/ROS/image-20230312150846724.png"
                      class="" title="image-20230312150846724"
                >

<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/03/10/ROS/image-20230312151405541.png"
                      class="" title="image-20230312151405541"
                >

<h2 id="ROS架构"><a href="#ROS架构" class="headerlink" title="ROS架构"></a>ROS架构</h2><p>到目前为止，我们已经安装了ROS，运行了ROS中内置的小乌龟案例，并且也编写了ROS小程序，对ROS也有了一个大概的认知，当然这个认知可能还是比较模糊并不清晰的，接下来，我们要从宏观上来介绍一下ROS的架构设计。</p>
<p>立足不同的角度，对ROS架构的描述也是不同的，一般我们可以从设计者、维护者、系统结构与自身结构4个角度来描述ROS结构:</p>
<blockquote>
<ol>
<li>设计者</li>
</ol>
</blockquote>
<p>ROS设计者将ROS表述为”ROS &#x3D; Plumbing + Tools + Capabilities + Ecosystem”</p>
<ul>
<li>Plumbing：通讯机制(实现ROS不同节点之间的交互)</li>
<li>Tools :工具软件包(ROS中的开发和调试工县)</li>
<li>Capabilities ：机器人高层技能(ROS中某些功能的集合，比如：导航)</li>
<li>Ecosystem：机器人生态系统(跨地域、跨软件与硬件的ROS联盟)</li>
</ul>
<blockquote>
<ol start="2">
<li>维护者</li>
</ol>
</blockquote>
<p>立足维护者的角度：ROS架构可划分为两大部分</p>
<ul>
<li>main：核心部分，主要由Willow Garage和一些开发者设计、提供以及维护。它提供了一些分布式计算的基本工具，以及整个ROS的核部分的程序编写。</li>
<li>universe：全球范围的代码，有不同国家的ROS社区组织开发和维护。一种是库的代码，如OpenCV,PCL等;库的上一层是从功能角度提供的代码，如人脸识别，他们调用下层的库;最上层的代码是应用级的代码，让机器人完成某—确定的功能。</li>
</ul>
<blockquote>
<ol start="3">
<li>系统结构</li>
</ol>
</blockquote>
<p>立足系统架构：ROS可以划分为三层</p>
<ul>
<li>OS层：ROS只是元操作系统，需要依托真正的操作系统，目前兼容性最好的是Linux的Ubuntu，MAC和Windows也支持</li>
<li>中间层：是ROS封装的关于机器人开发的中间件，如：<ul>
<li>基于TCP&#x2F;UDP继续封装的TCPROS&#x2F;UDPROS通信系统</li>
<li>用于进程间通信Nodelet，为数据的实时性传输提供支持</li>
<li>另外，还提供了大量的机器人开发实现库，如:数据类型定义、坐标变换、运动控制</li>
</ul>
</li>
<li>应用层：功能包，以及功能包内的节点，比如：master、turtlesim的控制与运动节点</li>
</ul>
<blockquote>
<ol start="4">
<li>自身结构</li>
</ol>
</blockquote>
<p>就ROS自身实现而言，也可以划分为三层</p>
<ul>
<li>文件系统：ROS文件系统级指的是在硬盘上面查看的ROS源代码的组织形式</li>
<li>计算图：ROS分布式系统中不同进程需要进行数据交互，计算图可以以点对点的网络形式表现数据交互过程，计算图中的重要概念:节点(Node)、消息(message)、通信机制_主题(topic)、通信机制_服务(service)</li>
<li>开源社区：ROS的社区级概念是ROS网络上进行代码发布的一种表现形式<ul>
<li>发行版(Distribution) ROS发行版是可以独立安装、带有版本号的一系列综合功能包。ROS发行版像Linux发行版一样发挥类似的作用。这使得ROS软件安装更加容易，而且能够通过一个软件集合维持一致的版本。</li>
<li>软件库(Repository) ROS依赖于共享开源代码与软件库的网站或主机服务，在这里不同的机构能够发布和分享各自的机器人软件与程序。</li>
<li>ROS维基(ROS wiki) ROS Wiki是用于记录有关ROS系统信息的主要论坛。任何人都可以注册账户、贡献自己的文件、提供更正或更新、编写教程以及其他行为。网址是<a class="link"   target="_blank" rel="noopener" href="http://wiki.ros.org/" >http://wiki.ros.org/ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></li>
<li>Bug提交系统(Bug Ticket System）如果你发现问题或者想提出一个新功能，ROS提供这个资源去做这些。</li>
<li>邮件列表(Mailing list) ROS用户邮件列表是关于ROS的主要交流渠道，能够像论坛一样交流从ROS软件更新到ROS软件使用中的各种疑问或信息。网址是http:&#x2F;llists.ros.orgl.</li>
<li>ROS问答(ROS Answer）用户可以使用这个资源去提问题。网址是<a class="link"   target="_blank" rel="noopener" href="https://answers.ros.orglquestions/%E3%80%82" >https://answers.ros.orglquestions/。 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></li>
<li>博客（Blog）你可以看到定期更新、照片和新闻。网址是<a class="link"   target="_blank" rel="noopener" href="https://www.ros.org/news/%EF%BC%8C%E4%B8%8D%E8%BF%87%E5%8D%9A%E5%AE%A2%E7%B3%BB%E7%BB%9F%E5%B7%B2%E7%BB%8F%E9%80%80%E4%BC%91%EF%BC%8CROS%E7%A4%BE%E5%8C%BA%E5%8F%96%E8%80%8C%E4%BB%A3%E4%B9%8B%EF%BC%8C%E7%BD%91%E5%9D%80%E6%98%AFhttps:lldiscourse.ros.orgl%E3%80%82" >https://www.ros.org/news/，不过博客系统已经退休，ROS社区取而代之，网址是https:lldiscourse.ros.orgl。 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></li>
</ul>
</li>
</ul>
<p>现在处于学习的初级阶段，只是运行了ROS的内置案例，编写了简单的ROS实现，因此，受限于当前进度不会详细介绍所有设计架构中的所有模块，当前只介绍文件系统与计算图，下一章会介绍ROS的通信机制，这也是ROS的核心实现之一。现在处于学习的初级阶段，只是运行了ROS的内置案例，编写了简单的ROS实现，因此，受限于当前进度不会详细介绍所有设计架构中的所有模块，当前只介绍文件系统与计算图，下一章会介绍ROS的通信机制，这也是ROS的核心实现之一。</p>
<h3 id="ROS文件系统"><a href="#ROS文件系统" class="headerlink" title="ROS文件系统"></a>ROS文件系统</h3><p>ROS文件系统指的是在硬盘上ROS源代码的组织形式，其结构大致可以如下图所示：</p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/03/10/ROS/image-20230312160742726.png"
                      class="" title="image-20230312160742726"
                >

<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">workspace：自定义的工作空间</span><br><span class="line">	build：编译空间，用于存放CMake和catkin的缓存信息、配置信息和其他中间件</span><br><span class="line">	devel：开发空间，用于存放编译后生成的目标文件，包括头文件、动态&amp;静态链接库、可执行文件等。</span><br><span class="line">	src：源码</span><br><span class="line">		package：功能包（ROS基本单元包含多个节点、库与配置文件，包名所有字母小写，只能由字母、数字符号组成</span><br><span class="line">		CMakeLists.txt：配置编译规则，比如源文件、依赖项，目标文件</span><br><span class="line">		package.xml：包信息，比如：包名，版本，坐着，依赖项</span><br><span class="line">		scripts：存储python文件</span><br><span class="line">		src：存储C++源文件</span><br><span class="line">		include：头文件</span><br><span class="line">		msg：消息通信格式文件</span><br><span class="line">		srv：服务通信格式文件</span><br><span class="line">		action：动作格式文件</span><br><span class="line">		launch：可一次性运行多个节点</span><br><span class="line">		config：配置信息</span><br><span class="line">	CMakeLists.txt：编译时的基本配置</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<h3 id="ROS文件系统相关命令"><a href="#ROS文件系统相关命令" class="headerlink" title="ROS文件系统相关命令"></a>ROS文件系统相关命令</h3><p>ROS的文件系统本质上都还是操作系统文件，我们可以使用Linux命令来操作这些文件，不过在ROS中为了更好的用户体验，ROS专门提供了一些类似于Linux的命令，这些命令较之于Linux原生命令更为简介、高效。文件操作，无外乎就是增删改查与执行等操作，接下来，我们就从这五个维度，来介绍ROS文件系统的一些常用命令。</p>
<blockquote>
<ol>
<li>增</li>
</ol>
</blockquote>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">catkin_create_pkg 自定义包名 依赖包 	//建新的ROS功能包</span><br><span class="line">sudo apt install xxx		//安装ROS功能包</span><br></pre></td></tr></table></figure></div>

<blockquote>
<ol start="2">
<li>删</li>
</ol>
</blockquote>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt purge xxx			//删除某个功能包</span><br></pre></td></tr></table></figure></div>

<blockquote>
<ol start="3">
<li>查</li>
</ol>
</blockquote>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">rospack list			//列出所有功能包</span><br><span class="line">rospack find 包名			//查找某个功能包是否存在，如果存在返回安装路径</span><br><span class="line">roscd 包名			//进入某个功能包</span><br><span class="line">rosls					//列出某个包下的文件</span><br><span class="line">apt search xxx		//从网络中搜索某个功能包</span><br></pre></td></tr></table></figure></div>

<blockquote>
<ol start="4">
<li>改</li>
</ol>
</blockquote>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rosed 包名 文件名			//修改功能包文件，例如：rosed turtlesim Color.msg</span><br></pre></td></tr></table></figure></div>

<blockquote>
<ol start="5">
<li>执行</li>
</ol>
</blockquote>
<p><strong>roscore：</strong>是ROS的系统先决条件节点和程序的集合，必须运行roscore才能使ROS节点进行通信。</p>
<p>roscore将启动：ros master、ros 参数服务器、ros 日志节点</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">roscore          or           roscore -p xxxx（端口）</span><br></pre></td></tr></table></figure></div>

<p><strong>rosrun：</strong>运行指定的ROS节点</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rosrun 包名 可执行文件名</span><br></pre></td></tr></table></figure></div>

<p><strong>roslaunch：</strong>执行某个包下的launch文件</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">roslaunch 包名 launch文件名</span><br></pre></td></tr></table></figure></div>

<h3 id="ROS计算图"><a href="#ROS计算图" class="headerlink" title="ROS计算图"></a>ROS计算图</h3><blockquote>
<ol>
<li>简介</li>
</ol>
</blockquote>
<p>前面介绍的是ROS文件结构，是磁盘上ROS程序的存储结构，是静态的，而ros程序运行之后，不同的节点之间是错综复杂的，ROS中提供了一个实用的工具:	<strong>rqt_graph</strong>。</p>
<p>rqt_graph能够创建一个显示当前系统运行情况的动态图形。ROS分布式系统中不同进程需要进行数据交互，计算图可以以点对点的网络形式表现数据交互过程。rqt_graph是rqt程序包中的一部分。</p>
<blockquote>
<ol start="2">
<li>安装</li>
</ol>
</blockquote>
<p>如果前期把所有的功能包都已经安装完成（<strong>desktop-full</strong>），则直接在终端窗口中输入<code>rosrun rqt_graph rqt_graph</code></p>
<p>未安装</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install ros-&lt;kinetic&gt;-rqt</span><br><span class="line">sudo apt install ros-&lt;kinetic&gt;-rqt-common-pluins</span><br></pre></td></tr></table></figure></div>

<blockquote>
<ol start="3">
<li>计算图演示</li>
</ol>
</blockquote>
<p>运行小乌龟案例 —&gt; 运行ROS计算图</p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/03/10/ROS/image-20230312171144148.png"
                      class="" title="image-20230312171144148"
                >

<h1 id="ROS通信机制"><a href="#ROS通信机制" class="headerlink" title="ROS通信机制"></a>ROS通信机制</h1><p>机器人是一种高度复杂的系统性实现，在机器人上可能集成各种传感器(雷达、摄像头、GPS…)以及运动控制实现，为了解耦合，在ROS中每一个功能点都是一个单独的进程，每一个进程都是独立运行的。更确切的讲，<strong>ROS是进程（也称为Nodes)的分布式框架。</strong>因为这些进程甚至还可分布于不同主机，不同主机协同工作，从而分散计算压力。不过随之也有一个问题: 不同的进程是如何通信的? 也即不同进程间如何实现数据交换的?在此我们就需要介绍一下ROS中的通信机制了。</p>
<p>ROS中的基本通信机制主要有如下三种实现策略: </p>
<ul>
<li>话题通信（发布订阅模式）</li>
<li>服务通信（请求响应模式）</li>
<li>参数服务器（参数共享模式）</li>
</ul>
<p>本章的主要内容就是是介绍各个通倍机剧的应用场景、理论模型、代码实现以及相关操作命令。本章预期达成学习目标如下:</p>
<ul>
<li>能够熟练介绍ROS中常用的通信机制</li>
<li>能够理解ROS中每种通信机制的理论模型</li>
<li>能够以代码的方式实现各种通信机制对应的案例</li>
<li>能够熟练使用ROS中的一些操作命令</li>
<li>能够独立完成相关实操案例</li>
</ul>
<h2 id="话题通信"><a href="#话题通信" class="headerlink" title="话题通信"></a>话题通信</h2><p>话题通信是ROS中使用频率最高的一种通信模式，话题通信是基于<strong>发布订阅</strong>模式的，也即:一个节点发布消息，另一个节点订阅该消息。话题通信的应用场景也极其广泛，比如下面一个常见场景:</p>
<blockquote>
<p>机器人在执行导航功能，使用的传感器是激光雷达，机器人会采集激光雷达感知到的信息并计算，然后生成运动控制信息驱动机器人底盘运动。</p>
</blockquote>
<p>在上述场景中，就不止一次使用到了话题通信。</p>
<ul>
<li>以激光雷达信息的采集处理为例，<strong>在ROS中有一个节点需要时时的发布当前雷达采集到的数据，</strong>导航横块中也有节点会订阅并解析雷达数据。</li>
<li>再以运动消息的发布为例，导航模块会根据传感器采集的数据时时的计算出运动控制信息并发布给底盘，底盘也可以有一个节点订阅运动信息并最终转换成控制电机的脉冲信号。</li>
</ul>
<p>以此类推，像雷达、摄像头、GPS…等等一些传感器数据的采集，也都是使用了话题通信，换言之，<strong>话题通信适用于不断更新的数据传输相关的应用场景。</strong></p>
<blockquote>
<p>概念</p>
</blockquote>
<p>以发布订阅的方式实现不同节点之间数据交互的通信模式。</p>
<blockquote>
<p>作用</p>
</blockquote>
<p>用于<strong>不断更新的，少逻辑处理</strong>的数据传输场景</p>
<h3 id="理论模型"><a href="#理论模型" class="headerlink" title="理论模型"></a>理论模型</h3><p>话题通信实现模型是比较复杂的，该模型如下图所示，该模型中涉及到三个角色：</p>
<ul>
<li>ROS Master（管理者）</li>
<li>Talker</li>
<li>Listener</li>
</ul>
<p>ROS Master负责保管Talker和Listener注册的信息，并匹配话题相同的Talker与Listener，帮助Talker与Listener建立连接，连接建立后，Talker 可以发布消息，且发布的消息会被Listener订阅。</p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/03/10/ROS/image-20230313083831493.png"
                      class="" title="image-20230313083831493"
                >

<p><strong>注意：</strong></p>
<ul>
<li>使用的协议有RPC和TCP，0<del>2是RPC，3</del>6是TCP</li>
<li>步骤0和步骤1没有顺序关系;</li>
<li>talker和listener建立连接后，master就可以关闭了;</li>
<li><strong>上述实现流程已经封装了，以后直接调用即可。</strong></li>
</ul>
<p>话题通信中，大部分实现已经封装了，我们只需要关注话题设置、发布者实现、订阅者实现、消息载体</p>
<h3 id="话题通信基本操作（C-）"><a href="#话题通信基本操作（C-）" class="headerlink" title="话题通信基本操作（C++）"></a>话题通信基本操作（C++）</h3><p>需求：编写发布订阅实现，要求发布方以10HZ（每秒10次）的频率发布文本消息，订阅方订阅消息并将消息内容打印输出</p>
<p>分析：在模型实现中，ROS master不需要实现，而连接的建立也已经被封装了，需要关注的关键点有三个：</p>
<ul>
<li>发布方</li>
<li>订阅方</li>
<li>数据（文本，ROS中的String）</li>
</ul>
<p>流程：</p>
<ul>
<li>编写发布方实现</li>
<li>编写订阅方实现</li>
<li>编辑配置文件</li>
<li>编译并执行</li>
</ul>
<blockquote>
<p>publisher</p>
</blockquote>
<div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ros/ros.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;std_msgs/String.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;sstream&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc,<span class="type">char</span> *argv[])</span></span>&#123;</span><br><span class="line">    <span class="built_in">setlocale</span>(LC_ALL,<span class="string">&quot;&quot;</span>);	<span class="comment">//中文乱码解决</span></span><br><span class="line">    ros::<span class="built_in">init</span>(argc,argv,<span class="string">&quot;publisher_name&quot;</span>);</span><br><span class="line">    <span class="comment">//初始化节点句柄</span></span><br><span class="line">    ros::NodeHandle nh;</span><br><span class="line">    <span class="comment">//创建发布者对象</span></span><br><span class="line">    ros::Publisher pub = nh.<span class="built_in">advertise</span>&lt;std_msgs::String&gt;(<span class="string">&quot;topic&quot;</span>,<span class="number">10</span>);	<span class="comment">//发布者对象名称；10代表消息队列的大小，当遇到特殊情况，消息无法发送，消息会进入队列。队列容量不够时，先进入队列的消息会被弹出</span></span><br><span class="line">    </span><br><span class="line">    std_msgs::String msg;</span><br><span class="line">    <span class="comment">//发布频率</span></span><br><span class="line">    <span class="function">ros::Rate <span class="title">rate</span><span class="params">(<span class="number">10</span>)</span></span>;			<span class="comment">//10Hz</span></span><br><span class="line">    <span class="type">int</span> count = <span class="number">0</span>;</span><br><span class="line">    ros::<span class="built_in">Duration</span>(<span class="number">3</span>).<span class="built_in">sleep</span>();		<span class="comment">//延迟第一条消息的发送</span></span><br><span class="line">    <span class="keyword">while</span>(ros::<span class="number">0</span>k())&#123;</span><br><span class="line">        count++;</span><br><span class="line">        <span class="comment">//msg.data = &quot;hello&quot;;</span></span><br><span class="line">        std::stringstream ss;</span><br><span class="line">        <span class="comment">//字符串拼接</span></span><br><span class="line">        ss &lt;&lt; <span class="string">&quot;hello ---&gt;&quot;</span> &lt;&lt; count;</span><br><span class="line">        msg.data = ss.<span class="built_in">str</span>();</span><br><span class="line">        <span class="comment">//控制台打印信息</span></span><br><span class="line">        <span class="built_in">ROS_INFO</span>(<span class="string">&quot;发布的数据是：%s&quot;</span>,ss.<span class="built_in">str</span>().<span class="built_in">c_str</span>());</span><br><span class="line">        pub.<span class="built_in">publish</span>(msg);</span><br><span class="line">        rate.<span class="built_in">sleep</span>();			<span class="comment">//每0.1秒休眠一次</span></span><br><span class="line">        ros::<span class="built_in">spinOnce</span>();		<span class="comment">//官方建议，处理回调函数</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<blockquote>
<p>listener</p>
</blockquote>
<div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ros/ros.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;std_msgs/String.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">doMsg</span><span class="params">(<span class="type">const</span> std_msgs::String::ConstPtr &amp;msg)</span></span>&#123;</span><br><span class="line">    <span class="built_in">ROS_INFO</span>(<span class="string">&quot;翠花订阅的消息是：%s&quot;</span>,msg-&gt;data.<span class="built_in">c_str</span>());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc,<span class="type">char</span> *argv[])</span></span>&#123;</span><br><span class="line">	ros::<span class="built_in">init</span>(argc,argv,<span class="string">&quot;subscriber_name&quot;</span>);</span><br><span class="line">	ros::NodeHandle nh;</span><br><span class="line">	ros::Subscriber sub = nh.<span class="built_in">subscribe</span>(<span class="string">&quot;topic&quot;</span>,<span class="number">10</span>,doMsg);	<span class="comment">//话题fang必须与发布者的话题对应；doMsg是回调函数，处理收到的信息</span></span><br><span class="line">	</span><br><span class="line">	ros::<span class="built_in">spin</span>();		<span class="comment">//回调函数被多次执行</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>注意：有多少cpp文件，就要在CMakeList.txt文件中添加多少<code>add_executable</code>和<code>target_link_libraries</code></p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/03/10/ROS/image-20230313101114809.png"
                      class="" title="image-20230313101114809"
                >

<blockquote>
<p>补充</p>
</blockquote>
<ol>
<li>回调函数：只有在特定的时机，才会被触发，才会被执行</li>
<li>vscode中main函数<code>int main(int argc,char const *argv[])&#123;&#125;</code>默认生成时，argv会被const修饰，需要去掉该修饰符</li>
<li><code>ros/ros.h No such file or directory</code> 错误：检查<code>CMakeList.txt</code>的<code>find_package</code>是否出现重复内容，如果有删除即可</li>
<li><code>CmakeList.txt</code>中的<code>find_package</code>不添加包也可以运行：这是因为在构建之前的包的时候，已经将包添加进去了。但是却不建议这样做，如果是工程的第一个包，上述情况会报错</li>
<li>订阅时前几条数据丢失：原因是在发送前几条数据时，publisher还未在roscore注册完毕。<ul>
<li><strong>解决：注册后，加入休眠<code>ros::Duration(3.0).sleep();</code>延迟第一条数据的发送</strong></li>
</ul>
</li>
</ol>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/03/10/ROS/image-20230313104440608.png"
                      class="" title="image-20230313104440608"
                >

<h3 id="话题通信基本操作（python）"><a href="#话题通信基本操作（python）" class="headerlink" title="话题通信基本操作（python）"></a>话题通信基本操作（python）</h3><p>需求：编写发布订阅实现，要求发布方以10HZ（每秒10次）的频率发布文本消息，订阅方订阅消息并将消息内容打印输出</p>
<p>分析：在模型实现中，ROS master不需要实现，而连接的建立也已经被封装了，需要关注的关键点有三个：</p>
<ul>
<li>发布方</li>
<li>订阅方</li>
<li>数据（文本，ROS中的String）</li>
</ul>
<p>流程：</p>
<ul>
<li>编写发布方实现</li>
<li>编写订阅方实现</li>
<li>为python文件添加文件可执行权限</li>
<li>编辑配置文件</li>
<li>编译并执行</li>
</ul>
<blockquote>
<p>发布方</p>
</blockquote>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"><span class="keyword">from</span> std_msgs.msg <span class="keyword">import</span> String</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ ==<span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    rospy.init_node(<span class="string">&quot;publisher_name&quot;</span>)</span><br><span class="line">    <span class="comment">##创建发布者对象</span></span><br><span class="line">    pub = rospy.Publisher(<span class="string">&quot;topic&quot;</span>,String,queue_size=<span class="number">10</span>)			<span class="comment">#String是消息类型</span></span><br><span class="line">    msg = String()</span><br><span class="line">    <span class="comment">#指定发布频率</span></span><br><span class="line">    rate = rospy.Rate(<span class="number">1</span>)</span><br><span class="line">    count = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> rospy.is_shutdown():</span><br><span class="line">        count +=<span class="number">1</span></span><br><span class="line">        msg.data = <span class="string">&quot;hello&quot;</span> + <span class="built_in">str</span>(count)</span><br><span class="line">        pub.publish(msg)</span><br><span class="line">        rospy.loginfo(<span class="string">&quot;发布的数据是：%s&quot;</span>,msg.data)</span><br><span class="line">        rate.sleep()</span><br></pre></td></tr></table></figure></div>

<blockquote>
<p>订阅方</p>
</blockquote>
<p><strong>注意：每个python文件编写完不仅要配置CMkaeList.txt文件，还要为python文件增加可执行权限</strong></p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/env python</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"><span class="keyword">from</span> std_msgs.msg <span class="keyword">import</span> String</span><br><span class="line"></span><br><span class="line"><span class="comment">#回调函数</span></span><br><span class="line">doMsg(msg):</span><br><span class="line">    rospy.loginfo(<span class="string">&quot;订阅的数据是： %s&quot;</span>,msg.data)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ ==<span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    rospy.init_node(<span class="string">&quot;node_name&quot;</span>)</span><br><span class="line">    sub = rospy.Subscriber(<span class="string">&quot;topic&quot;</span>,String,doMsg,queue_size=<span class="number">10</span>)		<span class="comment">#String是接受的数据类型</span></span><br><span class="line">    rospy.spin()</span><br></pre></td></tr></table></figure></div>

<blockquote>
<p><strong>解耦合：只发布方和订阅方的主题一致就可以通信</strong></p>
</blockquote>
<h3 id="话题通信自定义msg"><a href="#话题通信自定义msg" class="headerlink" title="话题通信自定义msg"></a>话题通信自定义msg</h3><p>在ROS通信协议中，数据载体是一个较为重要组成部分，ROS中通过<strong>std_msgs</strong>封装了一些原生的数据类型,比如:String、Int32、Int64、Char、Bool、Empty…但是，这些数据一般只包含一个data字段，结构的单一意味着功能上的局限性，当传输一些复杂的数据，比如:激光雷达的信息…std_msgs 由于描述性较差而显得力不从心，这种场景下可以使用自定义的消息类型</p>
<p>msgs只是简单的脚本文件，每行具有字段类型和字段名称，可以使用的字段类型有：</p>
<ul>
<li>int8、int16、int64、uint</li>
<li>float32、float64</li>
<li>string</li>
<li>time、duration</li>
<li>other msg files</li>
<li>array</li>
</ul>
<p><strong>ROS中还有一种特殊类型：<code>Header</code>，标头包含时间戳和ROS中常用的坐标帧信息。</strong></p>
<blockquote>
<p>创建自定义消息，该消息包含人的信息：姓名、身高、年龄</p>
</blockquote>
<p><strong>流程：</strong></p>
<ol>
<li>按照固定格式创建msg文件</li>
<li>编辑配置文件</li>
<li>编译生成可以被python或C++调用的中间文件</li>
</ol>
<blockquote>
<p>定义msg文件</p>
</blockquote>
<p>功能包下新建msg目录，添加文件<strong>Person.msg</strong></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">string name</span><br><span class="line">uint age</span><br><span class="line">float64 height</span><br></pre></td></tr></table></figure></div>

<blockquote>
<p>编辑配置文件</p>
</blockquote>
<p><strong>package.xml</strong>添加编译依赖与执行依赖</p>
<div class="highlight-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build_depend</span>&gt;</span>message_generation<span class="tag">&lt;/<span class="name">build_depend</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">exec_depend</span>&gt;</span>message_runtime<span class="tag">&lt;/<span class="name">exec_depend</span>&gt;</span></span><br></pre></td></tr></table></figure></div>

<p><strong>CMakeList.txt</strong>编辑msg相关配置</p>
<div class="highlight-container" data-rel="Makefile"><figure class="iseeu highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 编译时依赖</span></span><br><span class="line">find_package(catkin REQUIRED COMPONENTS</span><br><span class="line">	roscpp</span><br><span class="line">	rospy</span><br><span class="line">	std_msgs</span><br><span class="line">	message_generation</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">##	配置msg源文件</span></span><br><span class="line">add_message_files(</span><br><span class="line">	FILES</span><br><span class="line">	Person.msg</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">## 把下面的代码的注释去掉</span></span><br><span class="line">generate_messages(</span><br><span class="line">	DEPENDENCIES</span><br><span class="line">	std_msgs</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">## 执行时依赖</span></span><br><span class="line">catkin_package(</span><br><span class="line">	CATKIN_DEPENDS roscpp rospy std_msgs message_runtime</span><br><span class="line">)</span><br></pre></td></tr></table></figure></div>

<blockquote>
<p>编译</p>
</blockquote>
<p><strong>生成中间文件</strong></p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/03/10/ROS/image-20230314093633782.png"
                      class="" title="image-20230314093633782"
                >

<h3 id="话题通信自定义msg调用（C-）"><a href="#话题通信自定义msg调用（C-）" class="headerlink" title="话题通信自定义msg调用（C++）"></a>话题通信自定义msg调用（C++）</h3><blockquote>
<p>编写发布订阅实现，要求 发布方以10HZ的频率发布自定义消息，订阅方订阅自定义消息并将自定义消息内容打印输出</p>
</blockquote>
<p><strong>分析：</strong>在模型实现中，ROS master不需要实现，而连接的建立也已经封装，需要关注的关键点有三个：</p>
<ol>
<li>发布方</li>
<li>接收方</li>
<li>数据（这里为自定义消息）</li>
</ol>
<p><strong>流程：</strong></p>
<ol>
<li>编写发布方实现</li>
<li>编写订阅方实现</li>
<li>编辑配置执行</li>
<li>编译并执行</li>
</ol>
<blockquote>
<p>vscode配置</p>
</blockquote>
<p>为了方便代码提示以及避免误抛异常，需要先配置vscode，将前面生成的C++头文件路径配置进c_cpp_properties.json的includepath属性：</p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/03/10/ROS/image-20230314095023251.png"
                      class="" title="image-20230314095023251"
                >

<blockquote>
<p>发布方</p>
</blockquote>
<div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ros/ros.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;包名/上面生成的头文件&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc,<span class="type">char</span> *argv[])</span></span>&#123;</span><br><span class="line">    <span class="built_in">setlocale</span>(LC_SLL,<span class="string">&quot;&quot;</span>);</span><br><span class="line">    ros::<span class="built_in">init</span>(argc,argv,<span class="string">&quot;node_name&quot;</span>);</span><br><span class="line">    ros::NodeHandle nh;</span><br><span class="line">    ros::Publisher pub = nh.<span class="built_in">advertise</span>&lt;包名::自定义文件类型&gt;(<span class="string">&quot;topic&quot;</span>,<span class="number">10</span>);		<span class="comment">//包名::自定义文件类型取 plumbing_pubsub Person</span></span><br><span class="line">    </span><br><span class="line">    plumbing_pubsub::Person person;</span><br><span class="line">    perosn.name=<span class="string">&quot;zhangsna&quot;</span>;</span><br><span class="line">    person.age = <span class="number">1</span>;</span><br><span class="line">    person.height = <span class="number">1.73</span>;</span><br><span class="line">    ros::<span class="built_in">Rate</span>(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">while</span>(ros::<span class="built_in">ok</span>())&#123;</span><br><span class="line">		person.age +=<span class="number">1</span>;</span><br><span class="line">        pub.<span class="built_in">publish</span>(person);</span><br><span class="line">        rate.<span class="built_in">sleep</span>();</span><br><span class="line">        ros::<span class="built_in">spinOnce</span>();</span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>注意：编码好C++文件后，除了跟之前一样需要配置<code>add_exectable</code>和<code>target_link_libraries</code>外，还需要配置<code>add_dependencies</code></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">add_dependencies(C++文件,$&#123;PROJECT_NAME&#125;_gengerate_message_cpp)</span><br></pre></td></tr></table></figure></div>

<p><strong>原因：在编译时创建的C++文件先编译，中间文件Head文件后编译，但其中包含了生成的中间文件，不声明会报错。</strong></p>
<blockquote>
<p>订阅方</p>
</blockquote>
<div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ros/ros.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;包名/上面生成的头文件&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">doPerson</span><span class="params">(plumbing_pubsub::Person::ConstPtr&amp; person)</span></span>&#123;</span><br><span class="line">    <span class="built_in">ROS_INFO</span>(<span class="string">&quot;订阅的信息是：%s,%d,%.2f&quot;</span>,pernson.name.<span class="built_in">c_str</span>(),person.age,person.height);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc,<span class="type">char</span> *argv[])</span></span>&#123;</span><br><span class="line">    <span class="built_in">setlocale</span>(LC_SLL,<span class="string">&quot;&quot;</span>);</span><br><span class="line">    ros::<span class="built_in">init</span>(argc,argv,<span class="string">&quot;node_name&quot;</span>);</span><br><span class="line">    ros::NodeHandle nh;</span><br><span class="line">    ros::Subscriber sub = nh.<span class="built_in">subscribe</span>(<span class="string">&quot;topic&quot;</span>,<span class="number">10</span>,doPerson);</span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>注意：编码好C++文件后，除了跟之前一样需要配置<code>add_exectable</code>和<code>target_link_libraries</code>外，还需要配置<code>add_dependencies</code></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">add_dependencies(C++文件,$&#123;PROJECT_NAME&#125;_gengerate_message_cpp)</span><br></pre></td></tr></table></figure></div>

<h3 id="话题通信自定义msg调用（python）"><a href="#话题通信自定义msg调用（python）" class="headerlink" title="话题通信自定义msg调用（python）"></a>话题通信自定义msg调用（python）</h3><blockquote>
<p>编写发布订阅实现，要求 发布方以1HZ的频率发布自定义消息，订阅方订阅自定义消息并将自定义消息内容打印输出</p>
</blockquote>
<p><strong>分析：</strong>在模型实现中，ROS master不需要实现，而连接的建立也已经封装，需要关注的关键点有三个：</p>
<ol>
<li>发布方</li>
<li>接收方</li>
<li>数据（这里为自定义消息）</li>
</ol>
<p><strong>流程：</strong></p>
<ol>
<li>编写发布方实现</li>
<li>编写订阅方实现</li>
<li>为python文件添加可执行权限</li>
<li>编辑配置执行</li>
<li>编译并执行</li>
</ol>
<blockquote>
<p>vscode配置</p>
</blockquote>
<p>为了方便代码提示以及避免误抛异常，需要先配置vscode，将前面生成的python头文件路径配置进<strong>setting.json</strong>的<code>python.autoComplete.extraPaths</code>属性：  是自定义message的路径，即包含它的文件夹</p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/03/10/ROS/image-20230314151458371.png"
                      class="" title="image-20230314151458371"
                >

<blockquote>
<p>发送方</p>
</blockquote>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/env python</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"><span class="keyword">from</span> 包名（功能包.msg） <span class="keyword">import</span> 文件名</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ ==<span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    rospy.init_node(<span class="string">&quot;node_name&quot;</span>)</span><br><span class="line">    pub = rospy.Publisher(<span class="string">&quot;topic&quot;</span>,文件名,queue_size=<span class="number">10</span>)</span><br><span class="line">    p = Person() <span class="comment">##实例化类</span></span><br><span class="line">    p.name = <span class="string">&quot;张三&quot;</span></span><br><span class="line">    p.age = <span class="number">8</span></span><br><span class="line">    p.height = <span class="number">1.85</span></span><br><span class="line">    rate = rospy.Rate(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> rospy.is_shutdown():</span><br><span class="line">        pub.publish(p)</span><br><span class="line">        rospy.loginfo(<span class="string">&quot;发布的消息：%s,%d,%.2f&quot;</span>,p.name,p.age,p.height)</span><br><span class="line">        rate.sleep()</span><br></pre></td></tr></table></figure></div>

<p>注意：编码好后记得修改文件权限</p>
<blockquote>
<p>订阅方</p>
</blockquote>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/env python</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"><span class="keyword">from</span> 包名（功能包.msg） <span class="keyword">import</span> 文件名</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">doMsg</span>(<span class="params">p</span>):</span><br><span class="line">    rospy.loginfo(<span class="string">&quot;订阅的信息是：%s,%d,%.2f&quot;</span>,p.name.t_str(),p.age,)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ ==<span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    rospy.init_node(<span class="string">&quot;node_name&quot;</span>)</span><br><span class="line">    sub = rospy.Subscriber(<span class="string">&quot;topic&quot;</span>,自定义Msg,doMsg)</span><br><span class="line">    rospy.spin()</span><br></pre></td></tr></table></figure></div>

<h2 id="服务通信"><a href="#服务通信" class="headerlink" title="服务通信"></a>服务通信</h2><p>服务通信也是ROS中一种极其常用的通信模式，服务通信是基于请求响应模式的，是一种应答机制。也即:一个节点A向另一个节点B发送请求，B接收处理请求并产生响应结果返回给A。比如如下场景:</p>
<blockquote>
<p>机器人巡逻过程中，控制系统分析传感器数据发现可疑物体或人…此时需要拍摄照片并留存。</p>
</blockquote>
<p>在上述场景中，就使用到了服务通信。</p>
<ul>
<li>一个节点需要向相机节点发送拍照请求，相机节点处理请求，并返回处理结果</li>
</ul>
<p>与上述应用类似的，<strong>服务通信更适用于对时效性有要求、具有一定逻辑处理的应用场景。</strong></p>
<p><strong>概念</strong>：以请求响应的方式实现不同节点之间数据交互的通信模式</p>
<p><strong>作用</strong>：用于偶然的、对时效性有要求的，有一定逻辑处理需求的数据传输场景</p>
<h3 id="服务通信理论模型"><a href="#服务通信理论模型" class="headerlink" title="服务通信理论模型"></a>服务通信理论模型</h3><p>服务通信较之于话题通信更简单些，理论模型如下图所示，该模型中涉及到三个角色:</p>
<ul>
<li>ROS master(管理者)</li>
<li>Server(服务端)</li>
<li>Client(客户端)</li>
</ul>
<p>ROS Master负责保管Server和Client 注册的信息，并匹配话题相同的Server与Client，帮助Server 与Client建立连接，连接建立后，Client发送请求信息，Server返回响应信息。</p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/03/10/ROS/image-20230316095944593.png"
                      class="" title="image-20230316095944593"
                >

<p>注意：</p>
<ol>
<li>保证顺序，服务端先于客户端启动</li>
<li>客户端和服务端可以存在多个</li>
</ol>
<h3 id="服务通信自定义服务消息srv"><a href="#服务通信自定义服务消息srv" class="headerlink" title="服务通信自定义服务消息srv"></a>服务通信自定义服务消息srv</h3><p><strong>需求</strong>：服务通信中，客户端提交两个整数至服务端，服务端求和并响应结果到客户端，请创建服务器与客户端通信的数据载体。</p>
<p><strong>流程：</strong></p>
<p>srv文件内的可用数据类型与msg文件一致，且定义srv实现流程与自定义msg实现流程类似:</p>
<ol>
<li>按照固定格式创建srv文件</li>
<li>编辑配置文件</li>
<li>编译生成中间文件</li>
</ol>
<blockquote>
<p>定义srv文件</p>
</blockquote>
<p>服务通信中，数据分为两部分，请求与响应，在srv文件中请求和响应使用<code>---</code>分割，具体实现如下：</p>
<p>功能包下新建srv目录，添加xxx.srv文件，内容：</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#客户端请求时发送的两个数字</span><br><span class="line">int32 num1</span><br><span class="line">int32 num2</span><br><span class="line">---</span><br><span class="line">#服务器响应发送 大数据</span><br><span class="line">int32 num</span><br></pre></td></tr></table></figure></div>

<blockquote>
<p>编辑配置文件</p>
</blockquote>
<p><strong>package.xml</strong>中添加编译依赖与执行依赖</p>
<div class="highlight-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build_depend</span>&gt;</span>message_generation<span class="tag">&lt;/<span class="name">build_depend</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">exec_depend</span>&gt;</span>message_runtime<span class="tag">&lt;/<span class="name">exec_depend</span>&gt;</span></span><br></pre></td></tr></table></figure></div>

<p><strong>CMakeList.txt</strong>中：find_package添加<code>message_generation</code>；<code>add_service_files</code>添加的srv文件；将<code>generate_messages</code>的注释放开（自定义的srv文件的数据类型是基于这里的）；<code>catkin_package</code>放开CATKIN_DEPENDS并添加<code>message_runtime</code></p>
<p><strong>编译后生成的文件在<code>dev</code>文件夹中</strong></p>
<h3 id="服务通信自定义srv调用（C-）"><a href="#服务通信自定义srv调用（C-）" class="headerlink" title="服务通信自定义srv调用（C++）"></a>服务通信自定义srv调用（C++）</h3><p><strong>需求：</strong>编写服务通信，客户端提交两个整数至服务端，服务端求和并响应结果到客户端。</p>
<p><strong>分析：</strong>在模型实现中，ROS master不需要实现，而连接的建立也已经被封装了，需要关注的关键点有三个:</p>
<ol>
<li><p>服务端</p>
</li>
<li><p>客户端</p>
</li>
<li><p>数据</p>
</li>
</ol>
<p><strong>流程</strong>：</p>
<ol>
<li><p>编写服务端实现;</p>
</li>
<li><p>编写客户端实现;</p>
</li>
<li><p>编辑配置文件;</p>
</li>
<li><p>编译并执行。</p>
</li>
</ol>
<blockquote>
<p>vscode配置</p>
</blockquote>
<p>需要像之前自定义msg 实现一样配置<code>c_cpp_properies.json</code>文件，如果以前已经配置且没有变更工作空间,可以忽略，如果需要配置，配置方式与之前相同:</p>
<h1 id="ROS实现自动驾驶"><a href="#ROS实现自动驾驶" class="headerlink" title="ROS实现自动驾驶"></a>ROS实现自动驾驶</h1><blockquote>
<p>发布图片，按帧播放</p>
</blockquote>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/env python</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"><span class="keyword">import</span> cv2</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> sensor_msgs.msg <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">from</span> cv_bridge <span class="keyword">import</span> CvBridge</span><br><span class="line"></span><br><span class="line">DATA_PATH = <span class="string">&#x27;/home/airex/data/KITTIT/RawData/2011_09_26/2011_09_26_drive_0005_sync/&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    frame = <span class="number">0</span></span><br><span class="line">    rospy.init_node(<span class="string">&quot;kitti_node&quot;</span>,anonymous=<span class="literal">True</span>)</span><br><span class="line">    pub = rospy.Publisher(<span class="string">&quot;kitti_cam&quot;</span>,Image,queue_size = <span class="number">10</span>)</span><br><span class="line">    bridge = CvBridge()</span><br><span class="line"></span><br><span class="line">    rate = rospy.Rate(<span class="number">10</span>)</span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> rospy.is_shutdown():</span><br><span class="line">        img = cv2.imread(os.path.join(DATA_PATH,<span class="string">&#x27;image_02/data/%010d.png&#x27;</span>%frame))		<span class="comment">#join是将两个地址拼接起来</span></span><br><span class="line">        pub.publish(bridge.cv2_to_imgmsg(img,<span class="string">&quot;bgr8&quot;</span>))		<span class="comment">#CvBridge是将opencv的图片转为ROS可以处理的图片</span></span><br><span class="line">        rospy.loginfo(<span class="string">&quot;camera image published&quot;</span>)</span><br><span class="line">        rate.sleep()  </span><br><span class="line">        frame += <span class="number">1</span></span><br><span class="line">        frame %=<span class="number">154</span>     		<span class="comment">#图片最多只有153张，当frame增加到154，会变成0。重复播放</span></span><br></pre></td></tr></table></figure></div>

<p>运行后，打开<code>rviz</code>添加<code>topic</code>，可以看到上述代码运行的主题，可以选择保存，下次可以直接读取</p>
<blockquote>
<p>发布点云数据</p>
</blockquote>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/env python</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"><span class="keyword">import</span> cv2</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> sensor_msgs.msg <span class="keyword">import</span> Image,PointCloud2		<span class="comment">#sensor_msgs.msgs中有Image和PointCloud2类型</span></span><br><span class="line"><span class="keyword">from</span> cv_bridge <span class="keyword">import</span> CvBridge</span><br><span class="line"><span class="keyword">from</span> std_msgs.msg <span class="keyword">import</span> Header</span><br><span class="line"><span class="keyword">import</span> sensor_msgs.point_cloud2 <span class="keyword">as</span> pcl2			<span class="comment">#创造点云的类型</span></span><br><span class="line"></span><br><span class="line">DATA_PATH = <span class="string">&#x27;/home/airex/data/KITTIT/RawData/2011_09_26/2011_09_26_drive_0005_sync/&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    frame = <span class="number">0</span></span><br><span class="line">    rospy.init_node(<span class="string">&quot;kitti_node&quot;</span>,anonymous=<span class="literal">True</span>)</span><br><span class="line">    cam_pub = rospy.Publisher(<span class="string">&quot;kitti_cam&quot;</span>,Image,queue_size = <span class="number">10</span>)</span><br><span class="line">    pcl_pub = rospy.Publisher(<span class="string">&quot;kitti_point_cloud&quot;</span>,PointCloud2,queue_size=<span class="number">10</span>)</span><br><span class="line">    bridge = CvBridge()</span><br><span class="line"></span><br><span class="line">    rate = rospy.Rate(<span class="number">10</span>)</span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> rospy.is_shutdown():</span><br><span class="line">        img = cv2.imread(os.path.join(DATA_PATH,<span class="string">&#x27;image_02/data/%010d.png&#x27;</span>%frame))</span><br><span class="line">        point_cloud = np.fromfile(os.path.join(DATA_PATH,<span class="string">&#x27;velodyne_points/data/%010d.bin&#x27;</span>%frame),dtype=np.float32).reshape(-<span class="number">1</span>,<span class="number">4</span>)		<span class="comment">#将读入的数据转为 n*4的矩阵，n是点云中点的数量，4是每个点有四维的数据，xyz坐标和反射率</span></span><br><span class="line">        </span><br><span class="line">        cam_pub.publish(bridge.cv2_to_imgmsg(img,<span class="string">&quot;bgr8&quot;</span>))</span><br><span class="line">        header = Header()</span><br><span class="line">        header.stamp = rospy.Time.now()</span><br><span class="line">        header.frame_id = <span class="string">&#x27;map&#x27;</span></span><br><span class="line">        </span><br><span class="line">        pcl_pub.publish(pcl2.create_cloud_xyz32(header,point_cloud[:,:<span class="number">3</span>]))	<span class="comment">#n个点，每个点前3行数据，不包括反射率</span></span><br><span class="line">        rospy.loginfo(<span class="string">&quot;published&quot;</span>)</span><br><span class="line">        rate.sleep()  </span><br><span class="line">        frame += <span class="number">1</span></span><br><span class="line">        frame %=<span class="number">154</span>     </span><br></pre></td></tr></table></figure></div>

<h2 id="画出车子和照相机视野"><a href="#画出车子和照相机视野" class="headerlink" title="画出车子和照相机视野"></a>画出车子和照相机视野</h2><blockquote>
<p>publish.utils.py</p>
</blockquote>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> std_msgs.msg <span class="keyword">import</span> Header</span><br><span class="line"><span class="keyword">from</span> sensor_msgs.msg <span class="keyword">import</span> Image,PointCloud2</span><br><span class="line"><span class="keyword">import</span> sensor_msgs.point_cloud2 <span class="keyword">as</span> pcl2</span><br><span class="line"><span class="keyword">from</span> cv_bridge <span class="keyword">import</span> CvBridge</span><br><span class="line"><span class="keyword">from</span> visualization_msgs.msg <span class="keyword">import</span> Marker</span><br><span class="line"><span class="keyword">import</span> tf</span><br><span class="line"></span><br><span class="line">FRAME_ID = <span class="string">&#x27;map&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">publish_camera</span>(<span class="params">cam_pub,bridge,image</span>):</span><br><span class="line">    cam_pub.publish(bridge.cv2_to_imgmsg(image,<span class="string">&#x27;bgr8&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">publish_point_cloud</span>(<span class="params">pcl_pub,point_cloud</span>):</span><br><span class="line">    header = Header()</span><br><span class="line">    header.stamp = rospy.Time.now()</span><br><span class="line">    header.frame_id = FRAME_ID</span><br><span class="line">    pcl_pub.publish(pcl2.create_cloud_xyz32(header,point_cloud[:.:<span class="number">3</span>]))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">publish_ego_car</span>(<span class="params">ego_car_pub</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    publish left and right 45 degree FOV lines and ego car model mesh</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    marker = Marker()						<span class="comment">#ROS中划线的工具</span></span><br><span class="line">    marker.header.frame_id = FRAME_ID</span><br><span class="line">    marker.header.stamp = rospy.Time.now()</span><br><span class="line"></span><br><span class="line">    marker.<span class="built_in">id</span> = <span class="number">0</span>							<span class="comment">#每个marker只能有一个id</span></span><br><span class="line">    marker.action = Marker.ADD				<span class="comment">#加入一个marker</span></span><br><span class="line">    marker.lifetime = rospy.Duration()</span><br><span class="line">    marker.<span class="built_in">type</span> = Marker.LINE_STRIP			<span class="comment">#marker的类型</span></span><br><span class="line"></span><br><span class="line">    marker.color.r = <span class="number">0.0</span></span><br><span class="line">    marker.color.g = <span class="number">1.0</span>					<span class="comment">#绿色</span></span><br><span class="line">    marker.color.b = <span class="number">0.0</span></span><br><span class="line">    marker.color.a = <span class="number">1.0</span></span><br><span class="line">    marker.scale.x = <span class="number">0.2</span>					<span class="comment">#marker的粗细</span></span><br><span class="line"></span><br><span class="line">    marker.points = []						  </span><br><span class="line">    marker.points.append(Point(<span class="number">10</span>,-<span class="number">10</span>,<span class="number">0</span>))			<span class="comment">#kitti数据集中的velodyne的坐标系下的三个坐标，构成一个九十度角</span></span><br><span class="line">    marker.points.append(Point(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>))</span><br><span class="line">    marker.points.append(Point(<span class="number">10</span>,<span class="number">10</span>,<span class="number">0</span>))</span><br><span class="line"></span><br><span class="line">    ego_car_pub.publish(marker)</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">publish_car_model</span>(<span class="params">model_pub</span>):</span><br><span class="line">    mesh_marker = Marker()</span><br><span class="line">    mesh_marker.header.frame_id = FRAME_ID</span><br><span class="line">    mesh_marker.header.stamp = rospy.Time.now()</span><br><span class="line"></span><br><span class="line">    mesh_marker.<span class="built_in">id</span> = -<span class="number">1</span></span><br><span class="line">    mesh_marker.lifetime = rospy.Duration()</span><br><span class="line">    mesh_marker.<span class="built_in">type</span> = Marker.MESH__RESOURCE</span><br><span class="line">     mesh_marker.mesh_resource  = <span class="string">&quot;package://kittii/Audi R8/Models/Audi R8.dae&quot;</span>		<span class="comment">#kittii是功能包，后面是3D模型文件</span></span><br><span class="line"></span><br><span class="line">    mesh_marker.pose.position.x = <span class="number">0.0</span>			<span class="comment">#设置车子的位置</span></span><br><span class="line">    mesh_marker.pose.position.y = <span class="number">0.0</span></span><br><span class="line">    mesh_marker.pose.position.z = -<span class="number">1.73</span>			<span class="comment">#Velodyne的位置是在车顶(0,0,0)，因为设置z为负数</span></span><br><span class="line"></span><br><span class="line">    q = ros_tf.transformations.quaternion_from_euler(np.pi/<span class="number">2</span>,<span class="number">0</span>,np.pi)		<span class="comment">#创建旋转量</span></span><br><span class="line">    mesh_marker.pose.orientation.x = q[<span class="number">0</span>]</span><br><span class="line">    mesh_marker.pose.orientation.y = q[<span class="number">1</span>]</span><br><span class="line">    mesh_marker.pose.orientation.z = q[<span class="number">2</span>]</span><br><span class="line">    mesh_marker.pose.orientation.w = q[<span class="number">3</span>]</span><br><span class="line"></span><br><span class="line">    mesh_marker.color.r = <span class="number">1.0</span></span><br><span class="line">    mesh_marker.color.g = <span class="number">1.0</span></span><br><span class="line">    mesh_marker.color.b = <span class="number">1.0</span></span><br><span class="line">    mesh_marker.color.a = <span class="number">1.0</span></span><br><span class="line"></span><br><span class="line">    mesh_marker.scale.x = <span class="number">0.9</span></span><br><span class="line">    mesh_marker.scale.y = <span class="number">0.9</span></span><br><span class="line">    mesh_marker.scale.z = <span class="number">0.9</span></span><br><span class="line"></span><br><span class="line">    model_pub.publish(mesh_marker)</span><br></pre></td></tr></table></figure></div>

<blockquote>
<p>data.utils.py</p>
</blockquote>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> cv2</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read_camera</span>(<span class="params">path</span>):</span><br><span class="line">    <span class="keyword">return</span> cv2.imread(path)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read_point_cloud</span>(<span class="params">path</span>):</span><br><span class="line">    <span class="keyword">return</span> np.fromfile(path,dtype=np.float32).reshape(-<span class="number">1</span>,<span class="number">4</span>)</span><br></pre></td></tr></table></figure></div>



<blockquote>
<p>kitti.py</p>
</blockquote>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/env python</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> data_utils <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> publish_utils <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">DATA_PATH = <span class="string">&#x27;/home/airex/data/KITTIT/RawData/2011_09_26/2011_09_26_drive_0005_sync/&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    frame = <span class="number">0</span></span><br><span class="line">    rospy.init_node(<span class="string">&quot;kitti_node&quot;</span>,anonymous=<span class="literal">True</span>)</span><br><span class="line">    cam_pub = rospy.Publisher(<span class="string">&quot;kitti_cam&quot;</span>,Image,queue_size = <span class="number">10</span>)</span><br><span class="line">    pcl_pub = rospy.Publisher(<span class="string">&quot;kitti_point_cloud&quot;</span>,PointCloud2,queue_size=<span class="number">10</span>)</span><br><span class="line">    ego_pub = rospy.Publisher(<span class="string">&quot;kitti_ego_car&quot;</span>,Marker,queue_size=<span class="number">10</span>)</span><br><span class="line">    model_pub = rospy.Publisher(<span class="string">&quot;kitti_model&quot;</span>,Marker,queue_size=<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    bridge = CvBridge()</span><br><span class="line"></span><br><span class="line">    rate = rospy.Rate(<span class="number">10</span>)</span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> rospy.is_shutdown():</span><br><span class="line">        img = cv2.imread(os.path.join(DATA_PATH,<span class="string">&#x27;image_02/data/%010d.png&#x27;</span>%frame))</span><br><span class="line">        point_cloud = np.fromfile(os.path.join(DATA_PATH,<span class="string">&#x27;velodyne_points/data/%010d.bin&#x27;</span>%frame))</span><br><span class="line">        publish_camera(cam_pub,image)</span><br><span class="line">        publish_point_cloud(pcl_pub,point_cloud)</span><br><span class="line">        publish_ego_car(ego_pub)</span><br><span class="line">        publish_car_model(model_pub)</span><br><span class="line">        rospy.loginfo(<span class="string">&quot;published&quot;</span>)</span><br><span class="line">        rate.sleep()  </span><br><span class="line">        frame += <span class="number">1</span></span><br><span class="line">        frame %=<span class="number">154</span>     </span><br></pre></td></tr></table></figure></div>

<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/03/10/ROS/image-20230321162806856.png"
                      class="" title="image-20230321162806856"
                >



<p><strong>补充：上述的两个Marker可以通过添加到MarkerArray的方式一起发布，只要将一个publish的函数的代码添加到另一个函数中，并使用<code>marker_array.markers.append(marker)</code>的方式将两个marker添加到markerArray中，并使用一个publisher发布即可</strong></p>
<blockquote>
<p>发布IMU数据</p>
</blockquote>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">read_imu</span>(<span class="params">path</span>):</span><br><span class="line">    df = pd.read_csv(path,header = <span class="literal">None</span>,sep=<span class="string">&#x27; &#x27;</span>)</span><br><span class="line">    df.columns = IMU_COLUMN_NAMES</span><br><span class="line">    <span class="keyword">return</span> df</span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">publish_imu</span>(<span class="params">imu_pub,imu_data</span>):</span><br><span class="line">    </span><br><span class="line">    imu = Imu()</span><br><span class="line">    imu.header.fram  =FRAME_ID</span><br><span class="line">    imu.header.stamp = rospy.Time.now()</span><br><span class="line"></span><br><span class="line">    q = tf.transformations.quaternion_from_euler(<span class="built_in">float</span>(imu_data.roll),<span class="built_in">float</span>(imu_data.pitch),<span class="built_in">float</span>(imu_data.yaw))</span><br><span class="line">    imu.orientation.x = q[<span class="number">0</span>]			</span><br><span class="line">    imu.orientation.y = q[<span class="number">1</span>]</span><br><span class="line">    imu.orientation.z = q[<span class="number">2</span>]</span><br><span class="line">    imu.orientation.w = q[<span class="number">3</span>]</span><br><span class="line">    imu.linear_acceleration.x = imu_data.af</span><br><span class="line">    imu.linear_acceleration.y = imu_data.al</span><br><span class="line">    imu.linear_acceleration.z = imu_data.au</span><br><span class="line">    imu.angular_velocity.x = imu_data.wf</span><br><span class="line">    imu.angular_velocity.y = imu_data.wl</span><br><span class="line">    imu.angular_velocity.z = imu_data.wu</span><br><span class="line"></span><br><span class="line">    imu_pub.publish(imu)</span><br></pre></td></tr></table></figure></div>

<blockquote>
<p>gps发布</p>
</blockquote>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">gps_pub = rospy.Publisher(<span class="string">&quot;kitti_gps&quot;</span>,NavSatFix,queue_size = <span class="number">10</span>)</span><br><span class="line">imu_data = read_imu(os.path.join(DATA_PATH,<span class="string">&#x27;oxts/data/%010d.txt&#x27;</span>%frame))</span><br><span class="line">publish_gps(gps_pub,imu_data)</span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">publish_gps</span>(<span class="params">gps_pub,imu_data</span>):</span><br><span class="line">    gps = NavSatFix()</span><br><span class="line">    gps.header.frame_id = FRAME_ID</span><br><span class="line">    gps.header.stamp = rospy.Time.now()</span><br><span class="line"></span><br><span class="line">    gps.latitude = imu_data.lat</span><br><span class="line">    gps.longitude = imu_data.lon</span><br><span class="line">    gps.altitude = imu_data.alt</span><br><span class="line"></span><br><span class="line">    gps_pub.publish(gps)</span><br></pre></td></tr></table></figure></div>

<p>注意：gps不会显示 在rviz上，可以用<code>rostopic ehco </code>的方式查看</p>
<h2 id="人工标注显示"><a href="#人工标注显示" class="headerlink" title="人工标注显示"></a>人工标注显示</h2><blockquote>
<p>数据集的获取</p>
</blockquote>
<p>在kitti官网下载对应资源的标注过的数据集，数据的表现形式类似于excel</p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/03/10/ROS/image-20230321194133995.png"
                      class="" title="image-20230321194133995"
                >

<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/03/10/ROS/image-20230321194158896.png"
                      class="" title="image-20230321194158896"
                >

<h3 id="2D"><a href="#2D" class="headerlink" title="2D"></a>2D</h3><blockquote>
<p>data_utils.py</p>
</blockquote>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">TRAKING_COLUMN_NAMES = [<span class="string">&#x27;frame&#x27;</span>,<span class="string">&#x27;track_id&#x27;</span>,<span class="string">&#x27;type&#x27;</span>,<span class="string">&#x27;truncated&#x27;</span>,<span class="string">&#x27;occluded&#x27;</span>,<span class="string">&#x27;alpha&#x27;</span>,<span class="string">&#x27;bbox_left&#x27;</span>,<span class="string">&#x27;bbox_top&#x27;</span>,<span class="string">&#x27;bb0x_right&#x27;</span>,<span class="string">&#x27;bbox_bottom&#x27;</span>,<span class="string">&#x27;height&#x27;</span>,<span class="string">&#x27;length&#x27;</span>,<span class="string">&#x27;width&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;length&#x27;</span>,<span class="string">&#x27;pos_x&#x27;</span>,<span class="string">&#x27;pos_y&#x27;</span>,<span class="string">&#x27;pos_z&#x27;</span>,<span class="string">&#x27;rot_y&#x27;</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read_tracking</span>(<span class="params">path</span>):</span><br><span class="line">    df = pd.read_csv(path,header=<span class="literal">None</span>,sep=<span class="string">&#x27; &#x27;</span>)</span><br><span class="line">    df.columns = IMU_COLUMN_NAMES					<span class="comment">#excel中的每列的标题</span></span><br><span class="line">    df.loc[df.<span class="built_in">type</span>.isin([<span class="string">&#x27;Truck&#x27;</span>,<span class="string">&#x27;Van&#x27;</span>,<span class="string">&#x27;Tram&#x27;</span>]),<span class="string">&#x27;type&#x27;</span>] = <span class="string">&#x27;Car&#x27;</span>		<span class="comment">#将type为Truck，Van和Tram的type都改为car</span></span><br><span class="line">    df = df[df.<span class="built_in">type</span>.isin([<span class="string">&#x27;Car&#x27;</span>,<span class="string">&#x27;Pedestrian&#x27;</span>,<span class="string">&#x27;Cyclist&#x27;</span>])]			<span class="comment">#只保留Car，Pedestrian和Cyclist的数据</span></span><br><span class="line">    <span class="keyword">return</span> df</span><br></pre></td></tr></table></figure></div>

<blockquote>
<p>publish_utils.py</p>
</blockquote>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">publish_camera</span>(<span class="params">cam_pub,bridge,image</span>):</span><br><span class="line">    <span class="keyword">for</span> typ,box <span class="keyword">in</span> <span class="built_in">zip</span>(types,boxes):		<span class="comment">#zip将tyeps和boxes数组的数据一一对应，打包变成一个新类型</span></span><br><span class="line">        top_left = <span class="built_in">int</span>(box[<span class="number">0</span>],box[<span class="number">1</span>])</span><br><span class="line">        bottom_right = <span class="built_in">int</span>(box[<span class="number">2</span>],box[<span class="number">3</span>])</span><br><span class="line">        cv2.rectangle(image,top_left,bottom_right,DETECTION_COLOR_DICT[typ],<span class="number">2</span>)	<span class="comment">#DETECTION_COLOR_DICT根据type类型设置绘画的颜色</span></span><br><span class="line"></span><br><span class="line">    cam_pub.publish(bridge.cv2_to_imgmsg(image,<span class="string">&#x27;bgr8&#x27;</span>))</span><br></pre></td></tr></table></figure></div>

<blockquote>
<p>kitti.py</p>
</blockquote>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">df_tracking = read_tracking(<span class="string">&#x27;/home/airex/data/KITTIT/training/label_02/0000.txt&#x27;</span>)</span><br><span class="line">frame = <span class="number">0</span></span><br><span class="line">rospy.init_node(<span class="string">&quot;kitti_node&quot;</span>,anonymous=<span class="literal">True</span>)</span><br><span class="line">cam_pub = rospy.Publisher(<span class="string">&quot;kitti_cam&quot;</span>,Image,queue_size = <span class="number">10</span>)</span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> rospy.is_shutdown():</span><br><span class="line"></span><br><span class="line">        boxes = np.array(df_tracking[df_tracking.frame==frame]					  [[<span class="string">&#x27;bbox_left&#x27;</span>,<span class="string">&#x27;bbox_top&#x27;</span>,<span class="string">&#x27;bbox_right&#x27;</span>,<span class="string">&#x27;bbox_bottom&#x27;</span>]])  <span class="comment">#将第frame帧的点的信息取出</span></span><br><span class="line">        types = np.array(df_tracking[df_tracking.frame==frame][<span class="string">&#x27;type&#x27;</span>])</span><br><span class="line">        img = cv2.imread(os.path.join(DATA_PATH,<span class="string">&#x27;image_02/data/%010d.png&#x27;</span>%frame))</span><br><span class="line">        publish_camera(cam_pub,bridge,image,boxes,types)</span><br><span class="line"></span><br><span class="line">        rospy.loginfo(<span class="string">&quot;published&quot;</span>)</span><br><span class="line">        rate.sleep()  </span><br><span class="line">        frame += <span class="number">1</span></span><br><span class="line">        frame %=<span class="number">154</span>     </span><br></pre></td></tr></table></figure></div>

<h3 id="3D"><a href="#3D" class="headerlink" title="3D"></a>3D</h3><blockquote>
<p>kitti.py</p>
</blockquote>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> kitti_utils <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">compute_3d_box_cam2</span>(<span class="params">h,w,l,x,y,z,yaw</span>):		<span class="comment">#将照相机坐标转换为3d坐标，(x,y,z)是车子地面中心点的坐标，yaw是旋转量</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        return: 3xn in cam2 coordinate</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    R = np.array([[np.cos(yaw),<span class="number">0</span>,np.sin(yaw)],[<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>],[-np.sin(yaw),<span class="number">0</span>,np.cos(yaw)]]) 	<span class="comment">#旋转矩阵       </span></span><br><span class="line">    x_corners = [l/<span class="number">2</span>,l/<span class="number">2</span>,-l/<span class="number">2</span>,-l/<span class="number">2</span>,l/<span class="number">2</span>,l/<span class="number">2</span>,-l/<span class="number">2</span>,-l/<span class="number">2</span>]		<span class="comment">#竖着组合起来分别是3d长方体的八个点</span></span><br><span class="line">    y_corners = [<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,-h,-h,-h,-h]</span><br><span class="line">    z_corners = [w/<span class="number">2</span>,-w/<span class="number">2</span>,-w/<span class="number">2</span>,w/<span class="number">2</span>,w/<span class="number">2</span>,-w/<span class="number">2</span>,-w/<span class="number">2</span>,w/<span class="number">2</span>]</span><br><span class="line">    corners_3d_cam2 = np.dot(R,np.vstack([x_corners,y_corners,z_corners]))</span><br><span class="line">    corners_3d_cam2 += np.vstack([x,y,z])		<span class="comment">#与原点相加</span></span><br><span class="line">    <span class="keyword">return</span> corners_3d_cam2</span><br><span class="line"></span><br><span class="line">main函数：</span><br><span class="line">		box3d_pub = rospy.Publisher(<span class="string">&quot;kitti_3d&quot;</span>,MarkerArray,queue_size=<span class="number">10</span>)</span><br><span class="line">        df_tracking = read_tracking(<span class="string">&#x27;/home/airex/data/KITTIT/training/label_02/0000.txt&#x27;</span>)	<span class="comment">#标定的数据</span></span><br><span class="line">        calib = Calibration(<span class="string">&#x27;/home/airex/data/KITTIT/RawData/2011_09_26&#x27;</span>,from_video=<span class="literal">True</span>)	<span class="comment">#各种传感器之间的关系</span></span><br><span class="line">        boxes_3d = np.array(df_tracking_frame[[<span class="string">&#x27;height&#x27;</span>,<span class="string">&#x27;width&#x27;</span>,<span class="string">&#x27;length&#x27;</span>,<span class="string">&#x27;pos_x&#x27;</span>,<span class="string">&#x27;pos_y&#x27;</span>,<span class="string">&#x27;pos_z&#x27;</span>,<span class="string">&#x27;rot_y&#x27;</span>]])</span><br><span class="line">        corners_3d_velos = []</span><br><span class="line">        <span class="keyword">for</span> box_3d <span class="keyword">in</span> boxes_3d:</span><br><span class="line">            corners_3d_cam2 = compute_3d_box_cam2(*box_3d)		<span class="comment">#*代表将数组展开。该行返回一个经过处理的长方体的8个点</span></span><br><span class="line">            corners_3d_velo = calib.project_rect_to_velo(corners_3d_cam2.T)	<span class="comment">#将照相机坐标转到velodye坐标系中</span></span><br><span class="line">            corners_3d_velos += [corners_3d_velo]</span><br><span class="line">        publish_3dbox(box3d_pub,corners_3d_velos,types)</span><br></pre></td></tr></table></figure></div>

<blockquote>
<p>kitti_utils.py</p>
</blockquote>
<p><strong>引用的其他开发者写的将照相机坐标转到velodye坐标系</strong></p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot; Helper methods for loading and parsing KITTI data.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Author: Charles R. Qi</span></span><br><span class="line"><span class="string">Date: September 2017</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> print_function</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> cv2</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Object3d</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27; 3d object label &#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, label_file_line</span>):</span><br><span class="line">        data = label_file_line.split(<span class="string">&#x27; &#x27;</span>)</span><br><span class="line">        data[<span class="number">1</span>:] = [<span class="built_in">float</span>(x) <span class="keyword">for</span> x <span class="keyword">in</span> data[<span class="number">1</span>:]]</span><br><span class="line"></span><br><span class="line">        <span class="comment"># extract label, truncation, occlusion</span></span><br><span class="line">        self.<span class="built_in">type</span> = data[<span class="number">0</span>] <span class="comment"># &#x27;Car&#x27;, &#x27;Pedestrian&#x27;, ...</span></span><br><span class="line">        self.truncation = data[<span class="number">1</span>] <span class="comment"># truncated pixel ratio [0..1]</span></span><br><span class="line">        self.occlusion = <span class="built_in">int</span>(data[<span class="number">2</span>]) <span class="comment"># 0=visible, 1=partly occluded, 2=fully occluded, 3=unknown</span></span><br><span class="line">        self.alpha = data[<span class="number">3</span>] <span class="comment"># object observation angle [-pi..pi]</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># extract 2d bounding box in 0-based coordinates</span></span><br><span class="line">        self.xmin = data[<span class="number">4</span>] <span class="comment"># left</span></span><br><span class="line">        self.ymin = data[<span class="number">5</span>] <span class="comment"># top</span></span><br><span class="line">        self.xmax = data[<span class="number">6</span>] <span class="comment"># right</span></span><br><span class="line">        self.ymax = data[<span class="number">7</span>] <span class="comment"># bottom</span></span><br><span class="line">        self.box2d = np.array([self.xmin,self.ymin,self.xmax,self.ymax])</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># extract 3d bounding box information</span></span><br><span class="line">        self.h = data[<span class="number">8</span>] <span class="comment"># box height</span></span><br><span class="line">        self.w = data[<span class="number">9</span>] <span class="comment"># box width</span></span><br><span class="line">        self.l = data[<span class="number">10</span>] <span class="comment"># box length (in meters)</span></span><br><span class="line">        self.t = (data[<span class="number">11</span>],data[<span class="number">12</span>],data[<span class="number">13</span>]) <span class="comment"># location (x,y,z) in camera coord.</span></span><br><span class="line">        self.ry = data[<span class="number">14</span>] <span class="comment"># yaw angle (around Y-axis in camera coordinates) [-pi..pi]</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">print_object</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Type, truncation, occlusion, alpha: %s, %d, %d, %f&#x27;</span> % \</span><br><span class="line">            (self.<span class="built_in">type</span>, self.truncation, self.occlusion, self.alpha))</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;2d bbox (x0,y0,x1,y1): %f, %f, %f, %f&#x27;</span> % \</span><br><span class="line">            (self.xmin, self.ymin, self.xmax, self.ymax))</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;3d bbox h,w,l: %f, %f, %f&#x27;</span> % \</span><br><span class="line">            (self.h, self.w, self.l))</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;3d bbox location, ry: (%f, %f, %f), %f&#x27;</span> % \</span><br><span class="line">            (self.t[<span class="number">0</span>],self.t[<span class="number">1</span>],self.t[<span class="number">2</span>],self.ry))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Calibration</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27; Calibration matrices and utils</span></span><br><span class="line"><span class="string">        3d XYZ in &lt;label&gt;.txt are in rect camera coord.</span></span><br><span class="line"><span class="string">        2d box xy are in image2 coord</span></span><br><span class="line"><span class="string">        Points in &lt;lidar&gt;.bin are in Velodyne coord.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        y_image2 = P^2_rect * x_rect</span></span><br><span class="line"><span class="string">        y_image2 = P^2_rect * R0_rect * Tr_velo_to_cam * x_velo</span></span><br><span class="line"><span class="string">        x_ref = Tr_velo_to_cam * x_velo</span></span><br><span class="line"><span class="string">        x_rect = R0_rect * x_ref</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        P^2_rect = [f^2_u,  0,      c^2_u,  -f^2_u b^2_x;</span></span><br><span class="line"><span class="string">                    0,      f^2_v,  c^2_v,  -f^2_v b^2_y;</span></span><br><span class="line"><span class="string">                    0,      0,      1,      0]</span></span><br><span class="line"><span class="string">                 = K * [1|t]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        image2 coord:</span></span><br><span class="line"><span class="string">         ----&gt; x-axis (u)</span></span><br><span class="line"><span class="string">        |</span></span><br><span class="line"><span class="string">        |</span></span><br><span class="line"><span class="string">        v y-axis (v)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        velodyne coord:</span></span><br><span class="line"><span class="string">        front x, left y, up z</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        rect/ref camera coord:</span></span><br><span class="line"><span class="string">        right x, down y, front z</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Ref (KITTI paper): http://www.cvlibs.net/publications/Geiger2013IJRR.pdf</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        TODO(rqi): do matrix multiplication only once for each projection.</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, calib_filepath, from_video=<span class="literal">False</span></span>):</span><br><span class="line">        <span class="keyword">if</span> from_video:</span><br><span class="line">            calibs = self.read_calib_from_video(calib_filepath)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            calibs = self.read_calib_file(calib_filepath)</span><br><span class="line">        <span class="comment"># Projection matrix from rect camera coord to image2 coord</span></span><br><span class="line">        self.P = calibs[<span class="string">&#x27;P2&#x27;</span>] </span><br><span class="line">        self.P = np.reshape(self.P, [<span class="number">3</span>,<span class="number">4</span>])</span><br><span class="line">        <span class="comment"># Rigid transform from Velodyne coord to reference camera coord</span></span><br><span class="line">        self.V2C = calibs[<span class="string">&#x27;Tr_velo_to_cam&#x27;</span>]</span><br><span class="line">        self.V2C = np.reshape(self.V2C, [<span class="number">3</span>,<span class="number">4</span>])</span><br><span class="line">        self.C2V = inverse_rigid_trans(self.V2C)</span><br><span class="line">        <span class="comment"># Rotation from reference camera coord to rect camera coord</span></span><br><span class="line">        self.R0 = calibs[<span class="string">&#x27;R0_rect&#x27;</span>]</span><br><span class="line">        self.R0 = np.reshape(self.R0,[<span class="number">3</span>,<span class="number">3</span>])</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Camera intrinsics and extrinsics</span></span><br><span class="line">        self.c_u = self.P[<span class="number">0</span>,<span class="number">2</span>]</span><br><span class="line">        self.c_v = self.P[<span class="number">1</span>,<span class="number">2</span>]</span><br><span class="line">        self.f_u = self.P[<span class="number">0</span>,<span class="number">0</span>]</span><br><span class="line">        self.f_v = self.P[<span class="number">1</span>,<span class="number">1</span>]</span><br><span class="line">        self.b_x = self.P[<span class="number">0</span>,<span class="number">3</span>]/(-self.f_u) <span class="comment"># relative </span></span><br><span class="line">        self.b_y = self.P[<span class="number">1</span>,<span class="number">3</span>]/(-self.f_v)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">read_calib_file</span>(<span class="params">self, filepath</span>):</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27; Read in a calibration file and parse into a dictionary.</span></span><br><span class="line"><span class="string">        Ref: https://github.com/utiasSTARS/pykitti/blob/master/pykitti/utils.py</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        data = &#123;&#125;</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(filepath, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            <span class="keyword">for</span> line <span class="keyword">in</span> f.readlines():</span><br><span class="line">                line = line.rstrip()</span><br><span class="line">                <span class="keyword">if</span> <span class="built_in">len</span>(line)==<span class="number">0</span>: <span class="keyword">continue</span></span><br><span class="line">                key, value = line.split(<span class="string">&#x27;:&#x27;</span>, <span class="number">1</span>)</span><br><span class="line">                <span class="comment"># The only non-float values in these files are dates, which</span></span><br><span class="line">                <span class="comment"># we don&#x27;t care about anyway</span></span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    data[key] = np.array([<span class="built_in">float</span>(x) <span class="keyword">for</span> x <span class="keyword">in</span> value.split()])</span><br><span class="line">                <span class="keyword">except</span> ValueError:</span><br><span class="line">                    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> data</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">read_calib_from_video</span>(<span class="params">self, calib_root_dir</span>):</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27; Read calibration for camera 2 from video calib files.</span></span><br><span class="line"><span class="string">            there are calib_cam_to_cam and calib_velo_to_cam under the calib_root_dir</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        data = &#123;&#125;</span><br><span class="line">        cam2cam = self.read_calib_file(os.path.join(calib_root_dir, <span class="string">&#x27;calib_cam_to_cam.txt&#x27;</span>))</span><br><span class="line">        velo2cam = self.read_calib_file(os.path.join(calib_root_dir, <span class="string">&#x27;calib_velo_to_cam.txt&#x27;</span>))</span><br><span class="line">        Tr_velo_to_cam = np.zeros((<span class="number">3</span>,<span class="number">4</span>))</span><br><span class="line">        Tr_velo_to_cam[<span class="number">0</span>:<span class="number">3</span>,<span class="number">0</span>:<span class="number">3</span>] = np.reshape(velo2cam[<span class="string">&#x27;R&#x27;</span>], [<span class="number">3</span>,<span class="number">3</span>])</span><br><span class="line">        Tr_velo_to_cam[:,<span class="number">3</span>] = velo2cam[<span class="string">&#x27;T&#x27;</span>]</span><br><span class="line">        data[<span class="string">&#x27;Tr_velo_to_cam&#x27;</span>] = np.reshape(Tr_velo_to_cam, [<span class="number">12</span>])</span><br><span class="line">        data[<span class="string">&#x27;R0_rect&#x27;</span>] = cam2cam[<span class="string">&#x27;R_rect_00&#x27;</span>]</span><br><span class="line">        data[<span class="string">&#x27;P2&#x27;</span>] = cam2cam[<span class="string">&#x27;P_rect_02&#x27;</span>]</span><br><span class="line">        <span class="keyword">return</span> data</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">cart2hom</span>(<span class="params">self, pts_3d</span>):</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27; Input: nx3 points in Cartesian</span></span><br><span class="line"><span class="string">            Oupput: nx4 points in Homogeneous by pending 1</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        n = pts_3d.shape[<span class="number">0</span>]</span><br><span class="line">        pts_3d_hom = np.hstack((pts_3d, np.ones((n,<span class="number">1</span>))))</span><br><span class="line">        <span class="keyword">return</span> pts_3d_hom</span><br><span class="line"> </span><br><span class="line">    <span class="comment"># =========================== </span></span><br><span class="line">    <span class="comment"># ------- 3d to 3d ---------- </span></span><br><span class="line">    <span class="comment"># =========================== </span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">project_velo_to_ref</span>(<span class="params">self, pts_3d_velo</span>):</span><br><span class="line">        pts_3d_velo = self.cart2hom(pts_3d_velo) <span class="comment"># nx4</span></span><br><span class="line">        <span class="keyword">return</span> np.dot(pts_3d_velo, np.transpose(self.V2C))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">project_ref_to_velo</span>(<span class="params">self, pts_3d_ref</span>):</span><br><span class="line">        pts_3d_ref = self.cart2hom(pts_3d_ref) <span class="comment"># nx4</span></span><br><span class="line">        <span class="keyword">return</span> np.dot(pts_3d_ref, np.transpose(self.C2V))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">project_rect_to_ref</span>(<span class="params">self, pts_3d_rect</span>):</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27; Input and Output are nx3 points &#x27;&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">return</span> np.transpose(np.dot(np.linalg.inv(self.R0), np.transpose(pts_3d_rect)))</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">project_ref_to_rect</span>(<span class="params">self, pts_3d_ref</span>):</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27; Input and Output are nx3 points &#x27;&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">return</span> np.transpose(np.dot(self.R0, np.transpose(pts_3d_ref)))</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">project_rect_to_velo</span>(<span class="params">self, pts_3d_rect</span>):</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27; Input: nx3 points in rect camera coord.</span></span><br><span class="line"><span class="string">            Output: nx3 points in velodyne coord.</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span> </span><br><span class="line">        pts_3d_ref = self.project_rect_to_ref(pts_3d_rect)</span><br><span class="line">        <span class="keyword">return</span> self.project_ref_to_velo(pts_3d_ref)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">project_velo_to_rect</span>(<span class="params">self, pts_3d_velo</span>):</span><br><span class="line">        pts_3d_ref = self.project_velo_to_ref(pts_3d_velo)</span><br><span class="line">        <span class="keyword">return</span> self.project_ref_to_rect(pts_3d_ref)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># =========================== </span></span><br><span class="line">    <span class="comment"># ------- 3d to 2d ---------- </span></span><br><span class="line">    <span class="comment"># =========================== </span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">project_rect_to_image</span>(<span class="params">self, pts_3d_rect</span>):</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27; Input: nx3 points in rect camera coord.</span></span><br><span class="line"><span class="string">            Output: nx2 points in image2 coord.</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        pts_3d_rect = self.cart2hom(pts_3d_rect)</span><br><span class="line">        pts_2d = np.dot(pts_3d_rect, np.transpose(self.P)) <span class="comment"># nx3</span></span><br><span class="line">        pts_2d[:,<span class="number">0</span>] /= pts_2d[:,<span class="number">2</span>]</span><br><span class="line">        pts_2d[:,<span class="number">1</span>] /= pts_2d[:,<span class="number">2</span>]</span><br><span class="line">        <span class="keyword">return</span> pts_2d[:,<span class="number">0</span>:<span class="number">2</span>]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">project_velo_to_image</span>(<span class="params">self, pts_3d_velo</span>):</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27; Input: nx3 points in velodyne coord.</span></span><br><span class="line"><span class="string">            Output: nx2 points in image2 coord.</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        pts_3d_rect = self.project_velo_to_rect(pts_3d_velo)</span><br><span class="line">        <span class="keyword">return</span> self.project_rect_to_image(pts_3d_rect)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># =========================== </span></span><br><span class="line">    <span class="comment"># ------- 2d to 3d ---------- </span></span><br><span class="line">    <span class="comment"># =========================== </span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">project_image_to_rect</span>(<span class="params">self, uv_depth</span>):</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27; Input: nx3 first two channels are uv, 3rd channel</span></span><br><span class="line"><span class="string">                   is depth in rect camera coord.</span></span><br><span class="line"><span class="string">            Output: nx3 points in rect camera coord.</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        n = uv_depth.shape[<span class="number">0</span>]</span><br><span class="line">        x = ((uv_depth[:,<span class="number">0</span>]-self.c_u)*uv_depth[:,<span class="number">2</span>])/self.f_u + self.b_x</span><br><span class="line">        y = ((uv_depth[:,<span class="number">1</span>]-self.c_v)*uv_depth[:,<span class="number">2</span>])/self.f_v + self.b_y</span><br><span class="line">        pts_3d_rect = np.zeros((n,<span class="number">3</span>))</span><br><span class="line">        pts_3d_rect[:,<span class="number">0</span>] = x</span><br><span class="line">        pts_3d_rect[:,<span class="number">1</span>] = y</span><br><span class="line">        pts_3d_rect[:,<span class="number">2</span>] = uv_depth[:,<span class="number">2</span>]</span><br><span class="line">        <span class="keyword">return</span> pts_3d_rect</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">project_image_to_velo</span>(<span class="params">self, uv_depth</span>):</span><br><span class="line">        pts_3d_rect = self.project_image_to_rect(uv_depth)</span><br><span class="line">        <span class="keyword">return</span> self.project_rect_to_velo(pts_3d_rect)</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rotx</span>(<span class="params">t</span>):</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27; 3D Rotation about the x-axis. &#x27;&#x27;&#x27;</span></span><br><span class="line">    c = np.cos(t)</span><br><span class="line">    s = np.sin(t)</span><br><span class="line">    <span class="keyword">return</span> np.array([[<span class="number">1</span>,  <span class="number">0</span>,  <span class="number">0</span>],</span><br><span class="line">                     [<span class="number">0</span>,  c, -s],</span><br><span class="line">                     [<span class="number">0</span>,  s,  c]])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">roty</span>(<span class="params">t</span>):</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27; Rotation about the y-axis. &#x27;&#x27;&#x27;</span></span><br><span class="line">    c = np.cos(t)</span><br><span class="line">    s = np.sin(t)</span><br><span class="line">    <span class="keyword">return</span> np.array([[c,  <span class="number">0</span>,  s],</span><br><span class="line">                     [<span class="number">0</span>,  <span class="number">1</span>,  <span class="number">0</span>],</span><br><span class="line">                     [-s, <span class="number">0</span>,  c]])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rotz</span>(<span class="params">t</span>):</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27; Rotation about the z-axis. &#x27;&#x27;&#x27;</span></span><br><span class="line">    c = np.cos(t)</span><br><span class="line">    s = np.sin(t)</span><br><span class="line">    <span class="keyword">return</span> np.array([[c, -s,  <span class="number">0</span>],</span><br><span class="line">                     [s,  c,  <span class="number">0</span>],</span><br><span class="line">                     [<span class="number">0</span>,  <span class="number">0</span>,  <span class="number">1</span>]])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">transform_from_rot_trans</span>(<span class="params">R, t</span>):</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27; Transforation matrix from rotation matrix and translation vector. &#x27;&#x27;&#x27;</span></span><br><span class="line">    R = R.reshape(<span class="number">3</span>, <span class="number">3</span>)</span><br><span class="line">    t = t.reshape(<span class="number">3</span>, <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> np.vstack((np.hstack([R, t]), [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>]))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">inverse_rigid_trans</span>(<span class="params">Tr</span>):</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27; Inverse a rigid body transform matrix (3x4 as [R|t])</span></span><br><span class="line"><span class="string">        [R&#x27;|-R&#x27;t; 0|1]</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    inv_Tr = np.zeros_like(Tr) <span class="comment"># 3x4</span></span><br><span class="line">    inv_Tr[<span class="number">0</span>:<span class="number">3</span>,<span class="number">0</span>:<span class="number">3</span>] = np.transpose(Tr[<span class="number">0</span>:<span class="number">3</span>,<span class="number">0</span>:<span class="number">3</span>])</span><br><span class="line">    inv_Tr[<span class="number">0</span>:<span class="number">3</span>,<span class="number">3</span>] = np.dot(-np.transpose(Tr[<span class="number">0</span>:<span class="number">3</span>,<span class="number">0</span>:<span class="number">3</span>]), Tr[<span class="number">0</span>:<span class="number">3</span>,<span class="number">3</span>])</span><br><span class="line">    <span class="keyword">return</span> inv_Tr</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read_label</span>(<span class="params">label_filename</span>):</span><br><span class="line">    lines = [line.rstrip() <span class="keyword">for</span> line <span class="keyword">in</span> <span class="built_in">open</span>(label_filename)]</span><br><span class="line">    objects = [Object3d(line) <span class="keyword">for</span> line <span class="keyword">in</span> lines]</span><br><span class="line">    <span class="keyword">return</span> objects</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">load_image</span>(<span class="params">img_filename</span>):</span><br><span class="line">    <span class="keyword">return</span> cv2.imread(img_filename)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">load_velo_scan</span>(<span class="params">velo_filename</span>):</span><br><span class="line">    scan = np.fromfile(velo_filename, dtype=np.float32)</span><br><span class="line">    scan = scan.reshape((-<span class="number">1</span>, <span class="number">4</span>))</span><br><span class="line">    <span class="keyword">return</span> scan</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">project_to_image</span>(<span class="params">pts_3d, P</span>):</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27; Project 3d points to image plane.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Usage: pts_2d = projectToImage(pts_3d, P)</span></span><br><span class="line"><span class="string">      input: pts_3d: nx3 matrix</span></span><br><span class="line"><span class="string">             P:      3x4 projection matrix</span></span><br><span class="line"><span class="string">      output: pts_2d: nx2 matrix</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">      P(3x4) dot pts_3d_extended(4xn) = projected_pts_2d(3xn)</span></span><br><span class="line"><span class="string">      =&gt; normalize projected_pts_2d(2xn)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">      &lt;=&gt; pts_3d_extended(nx4) dot P&#x27;(4x3) = projected_pts_2d(nx3)</span></span><br><span class="line"><span class="string">          =&gt; normalize projected_pts_2d(nx2)</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    n = pts_3d.shape[<span class="number">0</span>]</span><br><span class="line">    pts_3d_extend = np.hstack((pts_3d, np.ones((n,<span class="number">1</span>))))</span><br><span class="line">    <span class="built_in">print</span>((<span class="string">&#x27;pts_3d_extend shape: &#x27;</span>, pts_3d_extend.shape))</span><br><span class="line">    pts_2d = np.dot(pts_3d_extend, np.transpose(P)) <span class="comment"># nx3</span></span><br><span class="line">    pts_2d[:,<span class="number">0</span>] /= pts_2d[:,<span class="number">2</span>]</span><br><span class="line">    pts_2d[:,<span class="number">1</span>] /= pts_2d[:,<span class="number">2</span>]</span><br><span class="line">    <span class="keyword">return</span> pts_2d[:,<span class="number">0</span>:<span class="number">2</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">compute_box_3d</span>(<span class="params">obj, P</span>):</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27; Takes an object and a projection matrix (P) and projects the 3d</span></span><br><span class="line"><span class="string">        bounding box into the image plane.</span></span><br><span class="line"><span class="string">        Returns:</span></span><br><span class="line"><span class="string">            corners_2d: (8,2) array in left image coord.</span></span><br><span class="line"><span class="string">            corners_3d: (8,3) array in in rect camera coord.</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="comment"># compute rotational matrix around yaw axis</span></span><br><span class="line">    R = roty(obj.ry)    </span><br><span class="line"></span><br><span class="line">    <span class="comment"># 3d bounding box dimensions</span></span><br><span class="line">    l = obj.l;</span><br><span class="line">    w = obj.w;</span><br><span class="line">    h = obj.h;</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 3d bounding box corners</span></span><br><span class="line">    x_corners = [l/<span class="number">2</span>,l/<span class="number">2</span>,-l/<span class="number">2</span>,-l/<span class="number">2</span>,l/<span class="number">2</span>,l/<span class="number">2</span>,-l/<span class="number">2</span>,-l/<span class="number">2</span>];</span><br><span class="line">    y_corners = [<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,-h,-h,-h,-h];</span><br><span class="line">    z_corners = [w/<span class="number">2</span>,-w/<span class="number">2</span>,-w/<span class="number">2</span>,w/<span class="number">2</span>,w/<span class="number">2</span>,-w/<span class="number">2</span>,-w/<span class="number">2</span>,w/<span class="number">2</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># rotate and translate 3d bounding box</span></span><br><span class="line">    corners_3d = np.dot(R, np.vstack([x_corners,y_corners,z_corners]))</span><br><span class="line">    <span class="comment">#print corners_3d.shape</span></span><br><span class="line">    corners_3d[<span class="number">0</span>,:] = corners_3d[<span class="number">0</span>,:] + obj.t[<span class="number">0</span>];</span><br><span class="line">    corners_3d[<span class="number">1</span>,:] = corners_3d[<span class="number">1</span>,:] + obj.t[<span class="number">1</span>];</span><br><span class="line">    corners_3d[<span class="number">2</span>,:] = corners_3d[<span class="number">2</span>,:] + obj.t[<span class="number">2</span>];</span><br><span class="line">    <span class="comment">#print &#x27;cornsers_3d: &#x27;, corners_3d </span></span><br><span class="line">    <span class="comment"># only draw 3d bounding box for objs in front of the camera</span></span><br><span class="line">    <span class="keyword">if</span> np.<span class="built_in">any</span>(corners_3d[<span class="number">2</span>,:]&lt;<span class="number">0.1</span>):</span><br><span class="line">        corners_2d = <span class="literal">None</span></span><br><span class="line">        <span class="keyword">return</span> corners_2d, np.transpose(corners_3d)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># project the 3d bounding box into the image plane</span></span><br><span class="line">    corners_2d = project_to_image(np.transpose(corners_3d), P);</span><br><span class="line">    <span class="comment">#print &#x27;corners_2d: &#x27;, corners_2d</span></span><br><span class="line">    <span class="keyword">return</span> corners_2d, np.transpose(corners_3d)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">compute_orientation_3d</span>(<span class="params">obj, P</span>):</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27; Takes an object and a projection matrix (P) and projects the 3d</span></span><br><span class="line"><span class="string">        object orientation vector into the image plane.</span></span><br><span class="line"><span class="string">        Returns:</span></span><br><span class="line"><span class="string">            orientation_2d: (2,2) array in left image coord.</span></span><br><span class="line"><span class="string">            orientation_3d: (2,3) array in in rect camera coord.</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># compute rotational matrix around yaw axis</span></span><br><span class="line">    R = roty(obj.ry)</span><br><span class="line">   </span><br><span class="line">    <span class="comment"># orientation in object coordinate system</span></span><br><span class="line">    orientation_3d = np.array([[<span class="number">0.0</span>, obj.l],[<span class="number">0</span>,<span class="number">0</span>],[<span class="number">0</span>,<span class="number">0</span>]])</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># rotate and translate in camera coordinate system, project in image</span></span><br><span class="line">    orientation_3d = np.dot(R, orientation_3d)</span><br><span class="line">    orientation_3d[<span class="number">0</span>,:] = orientation_3d[<span class="number">0</span>,:] + obj.t[<span class="number">0</span>]</span><br><span class="line">    orientation_3d[<span class="number">1</span>,:] = orientation_3d[<span class="number">1</span>,:] + obj.t[<span class="number">1</span>]</span><br><span class="line">    orientation_3d[<span class="number">2</span>,:] = orientation_3d[<span class="number">2</span>,:] + obj.t[<span class="number">2</span>]</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># vector behind image plane?</span></span><br><span class="line">    <span class="keyword">if</span> np.<span class="built_in">any</span>(orientation_3d[<span class="number">2</span>,:]&lt;<span class="number">0.1</span>):</span><br><span class="line">      orientation_2d = <span class="literal">None</span></span><br><span class="line">      <span class="keyword">return</span> orientation_2d, np.transpose(orientation_3d)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># project orientation into the image plane</span></span><br><span class="line">    orientation_2d = project_to_image(np.transpose(orientation_3d), P);</span><br><span class="line">    <span class="keyword">return</span> orientation_2d, np.transpose(orientation_3d)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">draw_projected_box3d</span>(<span class="params">image, qs, color=(<span class="params"><span class="number">255</span>,<span class="number">255</span>,<span class="number">255</span></span>), thickness=<span class="number">2</span></span>):</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27; Draw 3d bounding box in image</span></span><br><span class="line"><span class="string">        qs: (8,3) array of vertices for the 3d box in following order:</span></span><br><span class="line"><span class="string">            1 -------- 0</span></span><br><span class="line"><span class="string">           /|         /|</span></span><br><span class="line"><span class="string">          2 -------- 3 .</span></span><br><span class="line"><span class="string">          | |        | |</span></span><br><span class="line"><span class="string">          . 5 -------- 4</span></span><br><span class="line"><span class="string">          |/         |/</span></span><br><span class="line"><span class="string">          6 -------- 7</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    qs = qs.astype(np.int32)</span><br><span class="line">    <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">4</span>):</span><br><span class="line">       <span class="comment"># Ref: http://docs.enthought.com/mayavi/mayavi/auto/mlab_helper_functions.html</span></span><br><span class="line">       i,j=k,(k+<span class="number">1</span>)%<span class="number">4</span></span><br><span class="line">       <span class="comment"># use LINE_AA for opencv3</span></span><br><span class="line">       cv2.line(image, (qs[i,<span class="number">0</span>],qs[i,<span class="number">1</span>]), (qs[j,<span class="number">0</span>],qs[j,<span class="number">1</span>]), color, thickness, cv2.CV_AA)</span><br><span class="line"></span><br><span class="line">       i,j=k+<span class="number">4</span>,(k+<span class="number">1</span>)%<span class="number">4</span> + <span class="number">4</span></span><br><span class="line">       cv2.line(image, (qs[i,<span class="number">0</span>],qs[i,<span class="number">1</span>]), (qs[j,<span class="number">0</span>],qs[j,<span class="number">1</span>]), color, thickness, cv2.CV_AA)</span><br><span class="line"></span><br><span class="line">       i,j=k,k+<span class="number">4</span></span><br><span class="line">       cv2.line(image, (qs[i,<span class="number">0</span>],qs[i,<span class="number">1</span>]), (qs[j,<span class="number">0</span>],qs[j,<span class="number">1</span>]), color, thickness, cv2.CV_AA)</span><br><span class="line">    <span class="keyword">return</span> image</span><br></pre></td></tr></table></figure></div>

<blockquote>
<p>publish_utils.py</p>
</blockquote>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">FRAME_ID = <span class="string">&#x27;map&#x27;</span></span><br><span class="line">DETECTION_COLOR_DICT = &#123;<span class="string">&#x27;car&#x27;</span>:(<span class="number">255</span>,<span class="number">255</span>,<span class="number">0</span>),<span class="string">&#x27;Pedestrian&#x27;</span>:(<span class="number">0</span>,<span class="number">226</span>,<span class="number">255</span>),<span class="string">&#x27;Cyclist&#x27;</span>:(<span class="number">141</span>,<span class="number">40</span>,<span class="number">255</span>)&#125;</span><br><span class="line">LIFETIME = <span class="number">0.1</span>		<span class="comment">#3D图形存在的时间</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#将8个点连接起来。点的顺序是从底面的左前方开始为0，顺时针旋转，以此为1，2.....</span></span><br><span class="line">LINE = [[<span class="number">0</span>,<span class="number">1</span>],[<span class="number">1</span>,<span class="number">2</span>],[<span class="number">2</span>,<span class="number">3</span>],[<span class="number">3</span>,<span class="number">0</span>]]        <span class="comment">#lower face</span></span><br><span class="line">LINE += [[<span class="number">4</span>,<span class="number">5</span>],[<span class="number">5</span>,<span class="number">6</span>],[<span class="number">6</span>,<span class="number">7</span>],[<span class="number">7</span>,<span class="number">4</span>]]       <span class="comment">#upper face </span></span><br><span class="line">LINE += [[<span class="number">4</span>,<span class="number">0</span>],[<span class="number">5</span>,<span class="number">1</span>],[<span class="number">6</span>,<span class="number">2</span>],[<span class="number">7</span>,<span class="number">3</span>]]       <span class="comment">#connect lower face and upper face</span></span><br><span class="line">LINE += [[<span class="number">4</span>,<span class="number">1</span>],[<span class="number">5</span>,<span class="number">0</span>]]           <span class="comment">#front face，表示车子的正前方</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">publish_3dbox</span>(<span class="params">box3d_pub,corners_3d_velos,types</span>):</span><br><span class="line">    marker_array = MarkerArray()</span><br><span class="line">    <span class="keyword">for</span> i,corners_3d_velo <span class="keyword">in</span> <span class="built_in">enumerate</span>(corners_3d_velos):</span><br><span class="line">        marker = Marker()</span><br><span class="line">        marker.header.frame_id = FRAME_ID</span><br><span class="line">        marker.header.stamp = rospy.Time.now()</span><br><span class="line">        marker.<span class="built_in">id</span> = i</span><br><span class="line">        marker.action = Marker.ADD</span><br><span class="line">        marker.lifetime = rospy.Duration(LIFETIME)</span><br><span class="line">        marker.<span class="built_in">type</span> = Marker.LINE_LIST	<span class="comment">#LINE_LIST类型将点连接起来</span></span><br><span class="line"></span><br><span class="line">        b,g,r = DETECTION_COLOR_DICT[types[i]]	<span class="comment">#根据类型不同调整绘制的颜色</span></span><br><span class="line">        marker.color.r = r/<span class="number">255.0</span></span><br><span class="line">        marker.color.g = g/<span class="number">255.0</span></span><br><span class="line">        marker.color.b = b/<span class="number">255.0</span></span><br><span class="line"></span><br><span class="line">        marker.color.a = <span class="number">1.0</span></span><br><span class="line">        marker.scale.x = <span class="number">0.1</span></span><br><span class="line"></span><br><span class="line">        marker.points = []</span><br><span class="line">        <span class="keyword">for</span> l <span class="keyword">in</span> LINES:</span><br><span class="line">            p1 = corners_3d_velo[l[<span class="number">0</span>]]		</span><br><span class="line">            marker.points.append(Point(p1[<span class="number">0</span>],p1[<span class="number">1</span>],p1[<span class="number">2</span>]))</span><br><span class="line">            p2 = corners_3d_velo[l[<span class="number">1</span>]]</span><br><span class="line">            marker.points.append(Point(p2[<span class="number">0</span>],p2[<span class="number">1</span>],p2[<span class="number">2</span>]))</span><br><span class="line">        marker_array.markers.append(marker)</span><br><span class="line"></span><br><span class="line">    box3d_pub.publish(marker_array)</span><br></pre></td></tr></table></figure></div>

<h2 id="显示track-id"><a href="#显示track-id" class="headerlink" title="显示track_id"></a>显示track_id</h2><p>track_id是对一个物体的标注，一直代表该物体</p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/03/10/ROS/image-20230322143355855.png"
                      class="" title="image-20230322143355855"
                >

<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/03/10/ROS/image-20230322143443764.png"
                      class="" title="image-20230322143443764"
                >

<h2 id="绘制本车的轨迹"><a href="#绘制本车的轨迹" class="headerlink" title="绘制本车的轨迹"></a>绘制本车的轨迹</h2><blockquote>
<p>kitti.py</p>
</blockquote>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Object</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        self.locations = []		<span class="comment">#车子的轨迹列表</span></span><br><span class="line">        <span class="comment">#self.locations = deque(maxlen=20)</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">update</span>(<span class="params">self,displacement,yaw_change</span>):</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(self.locations)):</span><br><span class="line">            x0,y0 = self.locations[i]</span><br><span class="line">            <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">            		displacement是两帧间车子移动的距离，yaw_change是车子转过的角度</span></span><br><span class="line"><span class="string">            		(x1,y1)即在当前坐标系中，上一帧中车子的坐标</span></span><br><span class="line"><span class="string">            		下面的公式，相当于一个点通过一个旋转矩阵，从一个坐标系转到了另一个坐标系</span></span><br><span class="line"><span class="string">            &quot;&quot;&quot;</span></span><br><span class="line">            x1 = x0 * np.cos(yaw_change) + y0 * np.sin(yaw_change) - displacement</span><br><span class="line">            y1 = -x0 * np.sin(yaw_change) + y0 * np.cos(yaw_change)</span><br><span class="line">            self.locations[i] = np.array([x1,y1])</span><br><span class="line"></span><br><span class="line">        self.locations += [np.array([<span class="number">0</span>,<span class="number">0</span>])]     <span class="comment">#最后必须加一个(0,0)表示车子当前的位置</span></span><br><span class="line">        <span class="comment">#self.locations = self.locations[:20]</span></span><br><span class="line">        <span class="comment">#self.locations.appendleft(np.array([0,0]))   与deque对应的操作</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">reset</span>(<span class="params">self</span>):</span><br><span class="line">        self.locations = []</span><br><span class="line">        </span><br><span class="line">main函数中：</span><br><span class="line">	loc_pub = rospy.Publisher(<span class="string">&quot;kitti_loc&quot;</span>,MarkerArray,queue_size=<span class="number">10</span>)</span><br><span class="line">    ego_car = Object()</span><br><span class="line">    prev_imu_data = <span class="literal">None</span></span><br><span class="line">    tracker = &#123;&#125;        <span class="comment">#包含了所有需要追踪的物体</span></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> rospy.is_shutdown():</span><br><span class="line">        </span><br><span class="line">        center = &#123;&#125;                                  <span class="comment">#一帧里面标注的物体</span></span><br><span class="line">        <span class="keyword">for</span> track_id,box_3d <span class="keyword">in</span> <span class="built_in">zip</span>(track_ids,boxes_3d):</span><br><span class="line">            corners_3d_cam2 = compute_3d_box_cam2(*box_3d)</span><br><span class="line">            corners_3d_velo = calib.project_rect_to_velo(corners_3d_cam2.T)</span><br><span class="line">            corners_3d_velos += [corners_3d_velo]</span><br><span class="line"></span><br><span class="line">            centers[track_id] = np.mean(corners_3d_velo,axis=<span class="number">0</span>)[:<span class="number">2</span>]		<span class="comment">#取出x和y的平均</span></span><br><span class="line">        centers[-<span class="number">1</span>] = np.array([<span class="number">0</span>,<span class="number">0</span>])   <span class="comment">#探测车辆的坐标</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> prev_imu_data <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            displacement = <span class="number">0.1</span>*np.linalg.norm(imu_data[[<span class="string">&#x27;vf&#x27;</span>,<span class="string">&#x27;vl&#x27;</span>]])	<span class="comment">#以向量的方式取出向前方向和向左方向的速度，并通过乘以0.1，获得两帧间车子运动的距离</span></span><br><span class="line">            yaw_change = <span class="built_in">float</span>(imu_data.yaw - prev_imu_data.yaw)	<span class="comment">#角度的变化</span></span><br><span class="line">            ego_car.update(displacement,yaw_change)</span><br><span class="line">        prev_imu_data = imu_data</span><br><span class="line">        publish_loc(loc_pub,ego_car.locations)</span><br><span class="line"></span><br><span class="line">        rospy.loginfo(<span class="string">&quot;published&quot;</span>)</span><br><span class="line">        rate.sleep()  </span><br><span class="line">        frame += <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> frame == <span class="number">154</span>:</span><br><span class="line">            frame =<span class="number">0</span></span><br><span class="line">            ego_car.reset()		<span class="comment">#视频重复播放，轨迹重新设置</span></span><br></pre></td></tr></table></figure></div>

<blockquote>
<p>publish_utils.py</p>
</blockquote>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">publish_loc</span>(<span class="params">loc_pub,loca</span>):</span><br><span class="line">    marker_array = MarkerArray()</span><br><span class="line"></span><br><span class="line">    marker = Marker()</span><br><span class="line">    marker.header.frame_id = FRAME_ID</span><br><span class="line">    marker.header.stamp = rospy.Time.now()</span><br><span class="line">    marker.<span class="built_in">id</span> = i</span><br><span class="line">    marker.action = Marker.ADD</span><br><span class="line">    marker.lifetime = rospy.Duration()</span><br><span class="line">    marker.<span class="built_in">type</span> = Marker.LINE_STRIP</span><br><span class="line"></span><br><span class="line">    marker.color.r = <span class="number">1.0</span></span><br><span class="line">    marker.color.g = <span class="number">0.0</span></span><br><span class="line">    marker.color.b = <span class="number">0.0</span></span><br><span class="line"></span><br><span class="line">    marker.color.a = <span class="number">1.0</span></span><br><span class="line">    marker.scale.x = <span class="number">0.2</span></span><br><span class="line"></span><br><span class="line">    marker.points = []</span><br><span class="line">    <span class="keyword">for</span> p <span class="keyword">in</span> locations:</span><br><span class="line">        marker.points.append(Point(p[<span class="number">0</span>],p[<span class="number">1</span>],<span class="number">0</span>))		</span><br><span class="line"></span><br><span class="line">    marker_array.markers.append(marker)</span><br><span class="line">    loc_pub.publish(marker_array)</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>


            </div>

            
                <div class="post-copyright-info">
                    <div class="article-copyright-info-container">
    <ul>
        <li><strong>标题:</strong> ROS</li>
        <li><strong>作者:</strong> Airex Yu</li>
        <li><strong>创建于:</strong> 2023-03-10 12:30:45</li>
        
            <li>
                <strong>更新于:</strong> 2023-05-25 21:21:00
            </li>
        
        <li>
            <strong>链接:</strong> http://example.com/2023/03/10/ROS/
        </li>
        <li>
            <strong>版权声明:</strong> 本文章采用 <a class="license" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">CC BY-NC-SA 4.0</a> 进行许可。
        </li>
    </ul>
</div>

                </div>
            

            
                <ul class="post-tags-box">
                    
                        <li class="tag-item">
                            <a href="/tags/ROS%E9%80%9A%E4%BF%A1/">#ROS通信</a>&nbsp;
                        </li>
                    
                        <li class="tag-item">
                            <a href="/tags/ROS%E8%87%AA%E5%8A%A8%E9%A9%BE%E9%A9%B6/">#ROS自动驾驶</a>&nbsp;
                        </li>
                    
                </ul>
            

            

            
                <div class="article-nav">
                    
                        <div class="article-prev">
                            <a class="prev"
                            rel="prev"
                            href="/2023/03/27/yolo/"
                            >
                                <span class="left arrow-icon flex-center">
                                    <i class="fa-solid fa-chevron-left"></i>
                                </span>
                                <span class="title flex-center">
                                    <span class="post-nav-title-item">yolo</span>
                                    <span class="post-nav-item">上一篇</span>
                                </span>
                            </a>
                        </div>
                    
                    
                        <div class="article-next">
                            <a class="next"
                            rel="next"
                            href="/2023/03/08/C-%E9%9D%A2%E8%AF%95%E9%A2%98/"
                            >
                                <span class="title flex-center">
                                    <span class="post-nav-title-item">C++面试题</span>
                                    <span class="post-nav-item">下一篇</span>
                                </span>
                                <span class="right arrow-icon flex-center">
                                    <i class="fa-solid fa-chevron-right"></i>
                                </span>
                            </a>
                        </div>
                    
                </div>
            


            
                <div class="comment-container">
                    <div class="comments-container">
    <div id="comment-anchor"></div>
    <div class="comment-area-title">
        <i class="fa-solid fa-comments"></i>&nbsp;评论
    </div>
    

        
            
 
    <div id="waline"></div>
    <script type="module"  data-pjax>
        import { init } from 'https://evan.beee.top/js/waline.mjs';

        function loadWaline() {
            init({
                el: '#waline',
                serverURL: 'https://example.example.com',
                lang: 'zh-CN',
                dark: 'body[class~="dark-mode"]',
                requiredMeta: ['nick','mail'], // cannot customize by theme config, change it yourself
            });
        }

        if ('true') {
            const loadWalineTimeout = setTimeout(() => {
                loadWaline();
                clearTimeout(loadWalineTimeout);
            }, 1000);
        } else {
            window.addEventListener('DOMContentLoaded', loadWaline);
        }
        
    </script>



        
    
</div>

                </div>
            
        </div>

        
            <div class="toc-content-container">
                <div class="post-toc-wrap">
    <div class="post-toc">
        <div class="toc-title">此页目录</div>
        <div class="page-title">ROS</div>
        <ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#ROS%E6%A6%82%E8%BF%B0"><span class="nav-text">ROS概述</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#ROS%E7%AE%80%E4%BB%8B"><span class="nav-text">ROS简介</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#ROS%E6%A6%82%E5%BF%B5"><span class="nav-text">ROS概念</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ROS%E8%AE%BE%E8%AE%A1%E7%9B%AE%E6%A0%87"><span class="nav-text">ROS设计目标</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ROS%E5%8F%91%E5%B1%95%E5%8E%86%E7%A8%8B"><span class="nav-text">ROS发展历程</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ROS%E5%AE%89%E8%A3%85"><span class="nav-text">ROS安装</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AE%80%E4%BB%8B"><span class="nav-text">简介</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE"><span class="nav-text">配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8D%B8%E8%BD%BD"><span class="nav-text">卸载</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B5%8B%E8%AF%95"><span class="nav-text">测试</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ROS%E5%BF%AB%E9%80%9F%E4%BD%93%E9%AA%8C"><span class="nav-text">ROS快速体验</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#C-%E7%89%88"><span class="nav-text">C++版</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Python%E7%89%88"><span class="nav-text">Python版</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ROS%E9%9B%86%E6%88%90%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="nav-text">ROS集成开发环境搭建</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%89%E8%A3%85%E7%BB%88%E7%AB%AF"><span class="nav-text">安装终端</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%89%E8%A3%85vscode"><span class="nav-text">安装vscode</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#vscode%E4%BD%BF%E7%94%A8-%E5%9F%BA%E6%9C%AC%E9%85%8D%E7%BD%AE"><span class="nav-text">vscode使用_基本配置</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#launch%E6%96%87%E4%BB%B6%E6%BC%94%E7%A4%BA"><span class="nav-text">launch文件演示</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ROS%E6%9E%B6%E6%9E%84"><span class="nav-text">ROS架构</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#ROS%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F"><span class="nav-text">ROS文件系统</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ROS%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E7%9B%B8%E5%85%B3%E5%91%BD%E4%BB%A4"><span class="nav-text">ROS文件系统相关命令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ROS%E8%AE%A1%E7%AE%97%E5%9B%BE"><span class="nav-text">ROS计算图</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#ROS%E9%80%9A%E4%BF%A1%E6%9C%BA%E5%88%B6"><span class="nav-text">ROS通信机制</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AF%9D%E9%A2%98%E9%80%9A%E4%BF%A1"><span class="nav-text">话题通信</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%90%86%E8%AE%BA%E6%A8%A1%E5%9E%8B"><span class="nav-text">理论模型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AF%9D%E9%A2%98%E9%80%9A%E4%BF%A1%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C%EF%BC%88C-%EF%BC%89"><span class="nav-text">话题通信基本操作（C++）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AF%9D%E9%A2%98%E9%80%9A%E4%BF%A1%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C%EF%BC%88python%EF%BC%89"><span class="nav-text">话题通信基本操作（python）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AF%9D%E9%A2%98%E9%80%9A%E4%BF%A1%E8%87%AA%E5%AE%9A%E4%B9%89msg"><span class="nav-text">话题通信自定义msg</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AF%9D%E9%A2%98%E9%80%9A%E4%BF%A1%E8%87%AA%E5%AE%9A%E4%B9%89msg%E8%B0%83%E7%94%A8%EF%BC%88C-%EF%BC%89"><span class="nav-text">话题通信自定义msg调用（C++）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AF%9D%E9%A2%98%E9%80%9A%E4%BF%A1%E8%87%AA%E5%AE%9A%E4%B9%89msg%E8%B0%83%E7%94%A8%EF%BC%88python%EF%BC%89"><span class="nav-text">话题通信自定义msg调用（python）</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9C%8D%E5%8A%A1%E9%80%9A%E4%BF%A1"><span class="nav-text">服务通信</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9C%8D%E5%8A%A1%E9%80%9A%E4%BF%A1%E7%90%86%E8%AE%BA%E6%A8%A1%E5%9E%8B"><span class="nav-text">服务通信理论模型</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9C%8D%E5%8A%A1%E9%80%9A%E4%BF%A1%E8%87%AA%E5%AE%9A%E4%B9%89%E6%9C%8D%E5%8A%A1%E6%B6%88%E6%81%AFsrv"><span class="nav-text">服务通信自定义服务消息srv</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9C%8D%E5%8A%A1%E9%80%9A%E4%BF%A1%E8%87%AA%E5%AE%9A%E4%B9%89srv%E8%B0%83%E7%94%A8%EF%BC%88C-%EF%BC%89"><span class="nav-text">服务通信自定义srv调用（C++）</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#ROS%E5%AE%9E%E7%8E%B0%E8%87%AA%E5%8A%A8%E9%A9%BE%E9%A9%B6"><span class="nav-text">ROS实现自动驾驶</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%94%BB%E5%87%BA%E8%BD%A6%E5%AD%90%E5%92%8C%E7%85%A7%E7%9B%B8%E6%9C%BA%E8%A7%86%E9%87%8E"><span class="nav-text">画出车子和照相机视野</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%BA%E5%B7%A5%E6%A0%87%E6%B3%A8%E6%98%BE%E7%A4%BA"><span class="nav-text">人工标注显示</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2D"><span class="nav-text">2D</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3D"><span class="nav-text">3D</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%98%BE%E7%A4%BAtrack-id"><span class="nav-text">显示track_id</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BB%98%E5%88%B6%E6%9C%AC%E8%BD%A6%E7%9A%84%E8%BD%A8%E8%BF%B9"><span class="nav-text">绘制本车的轨迹</span></a></li></ol></li></ol>

    </div>
</div>
            </div>
        
    </div>
</div>


                

            </div>
            
            

        </div>

        <div class="main-content-footer">
            <footer class="footer">
    <div class="info-container">
        <div class="copyright-info">
            &copy;
            
              <span>2023</span>
              -
            
            2023&nbsp;&nbsp;<i class="fa-solid fa-heart fa-beat" style="--fa-animation-duration: 0.5s; color: #f54545"></i>&nbsp;&nbsp;<a href="/">Airex Yu</a>
        </div>
        
            <script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            <div class="website-count info-item">
                
                    <span id="busuanzi_container_site_uv" class="busuanzi_container_site_uv">
                        访问人数&nbsp;<span id="busuanzi_value_site_uv" class="busuanzi_value_site_uv"></span>
                    </span>
                
                
                    <span id="busuanzi_container_site_pv" class="busuanzi_container_site_pv">
                        总访问量&nbsp;<span id="busuanzi_value_site_pv" class="busuanzi_value_site_pv"></span>
                    </span>
                
            </div>
        
        <div class="theme-info info-item">
            <span class="powered-by-container">由 <?xml version="1.0" encoding="utf-8"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg version="1.1" id="圖層_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1rem" height="1rem" viewBox="0 0 512 512" enable-background="new 0 0 512 512" xml:space="preserve"><path fill="#0E83CD" d="M256.4,25.8l-200,115.5L56,371.5l199.6,114.7l200-115.5l0.4-230.2L256.4,25.8z M349,354.6l-18.4,10.7l-18.6-11V275H200v79.6l-18.4,10.7l-18.6-11v-197l18.5-10.6l18.5,10.8V237h112v-79.6l18.5-10.6l18.5,10.8V354.6z"/></svg><a target="_blank" href="https://hexo.io">Hexo</a> 驱动</span>
                <br>
            <span class="theme-version-container">主题&nbsp;<a class="theme-version" target="_blank" href="https://github.com/EvanNotFound/hexo-theme-redefine">Redefine v2.1.5</a>
        </div>
        
        
        
            <div id="start_div" style="display:none">
                2023/01/05 11:45:14
            </div>
            <div>
                博客已运行 <span class="odometer" id="runtime_days" ></span> 天 <span class="odometer" id="runtime_hours"></span> 小时 <span class="odometer" id="runtime_minutes"></span> 分钟 <span class="odometer" id="runtime_seconds"></span> 秒
            </div>
        
        
        
            <script async data-pjax>
                try {
                    function odometer_init() {
                    const elements = document.querySelectorAll('.odometer');
                    elements.forEach(el => {
                        new Odometer({
                            el,
                            format: '( ddd).dd',
                            duration: 200
                        });
                    });
                    }
                    odometer_init();
                } catch (error) {}
            </script>
        
        
        
    </div>  
</footer>
        </div>
    </div>

    
        <div class="post-tools">
            <div class="post-tools-container">
    <ul class="article-tools-list">
        <!-- TOC aside toggle -->
        
            <li class="right-bottom-tools page-aside-toggle">
                <i class="fa-regular fa-outdent"></i>
            </li>
        

        <!-- go comment -->
        
            <li class="go-comment">
                <i class="fa-regular fa-comments"></i>
            </li>
        
    </ul>
</div>

        </div>
    

    <div class="right-side-tools-container">
        <div class="side-tools-container">
    <ul class="hidden-tools-list">
        <li class="right-bottom-tools tool-font-adjust-plus flex-center">
            <i class="fa-regular fa-magnifying-glass-plus"></i>
        </li>

        <li class="right-bottom-tools tool-font-adjust-minus flex-center">
            <i class="fa-regular fa-magnifying-glass-minus"></i>
        </li>

        <li class="right-bottom-tools tool-expand-width flex-center">
            <i class="fa-regular fa-expand"></i>
        </li>

        <li class="right-bottom-tools tool-dark-light-toggle flex-center">
            <i class="fa-regular fa-moon"></i>
        </li>

        <!-- rss -->
        

        

        <li class="right-bottom-tools tool-scroll-to-bottom flex-center">
            <i class="fa-regular fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="visible-tools-list">
        <li class="right-bottom-tools toggle-tools-list flex-center">
            <i class="fa-regular fa-cog fa-spin"></i>
        </li>
        
            <li class="right-bottom-tools tool-scroll-to-top flex-center">
                <i class="arrow-up fas fa-arrow-up"></i>
                <span class="percent"></span>
            </li>
        
        
    </ul>
</div>

    </div>

    <div class="image-viewer-container">
    <img src="">
</div>


    
        <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
          <span class="search-input-field-pre">
            <i class="fa-solid fa-keyboard"></i>
          </span>
            <div class="search-input-container">
                <input autocomplete="off"
                       autocorrect="off"
                       autocapitalize="off"
                       placeholder="搜索..."
                       spellcheck="false"
                       type="search"
                       class="search-input"
                >
            </div>
            <span class="popup-btn-close">
                <i class="fa-solid fa-times"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fa-solid fa-spinner fa-spin-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>

    


</main>




<script src="/js/utils.js"></script>

<script src="/js/main.js"></script>

<script src="/js/layouts/navbarShrink.js"></script>

<script src="/js/tools/scrollTopBottom.js"></script>

<script src="/js/tools/lightDarkSwitch.js"></script>



    
<script src="/js/tools/localSearch.js"></script>




    
<script src="/js/tools/codeBlock.js"></script>




    
<script src="/js/layouts/lazyload.js"></script>




    
<script src="/js/tools/runtime.js"></script>

    
<script src="/js/libs/odometer.min.js"></script>

    
<link rel="stylesheet" href="/assets/odometer-theme-minimal.css">




  
<script src="/js/libs/Typed.min.js"></script>

  
<script src="/js/plugins/typed.js"></script>




    
<script src="/js/libs/mermaid.min.js"></script>

    
<script src="/js/plugins/mermaid.js"></script>





<div class="post-scripts pjax">
    
        
<script src="/js/tools/tocToggle.js"></script>

<script src="/js/libs/anime.min.js"></script>

<script src="/js/layouts/toc.js"></script>

<script src="/js/plugins/tabs.js"></script>

    
</div>


    
<script src="/js/libs/pjax.min.js"></script>

<script>
    window.addEventListener('DOMContentLoaded', () => {
        window.pjax = new Pjax({
            selectors: [
                'head title',
                '.page-container',
                '.pjax',
            ],
            history: true,
            debug: false,
            cacheBust: false,
            timeout: 0,
            analytics: false,
            currentUrlFullReload: false,
            scrollRestoration: false,
            // scrollTo: true,
        });

        document.addEventListener('pjax:send', () => {
            Global.utils.pjaxProgressBarStart();
        });

        document.addEventListener('pjax:complete', () => {
            Global.utils.pjaxProgressBarEnd();
            window.pjax.executeScripts(document.querySelectorAll('script[data-pjax], .pjax script'));
            Global.refresh();
        });
    });
</script>




</body>
</html>
