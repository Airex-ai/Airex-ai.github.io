<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="keywords" content="Hexo Theme Redefine">
    
    <meta name="author" content="Airex Yu">
    <!-- preconnect -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    
    <!--- Seo Part-->
    
    <link rel="canonical" href="http://example.com/2023/04/13/j5/"/>
    <meta name="robots" content="index,follow">
    <meta name="googlebot" content="index,follow">
    <meta name="revisit-after" content="1 days">
    
        <meta name="description" content="J5 ISPè½¯ç¡¬ä»¶æ€»ä½“ä»‹ç»ISPåè¯è§£é‡ŠISPï¼ˆImage Signal Processorï¼‰ï¼šæ˜¯ä¸€ç§ä¸“é—¨ç”¨äºå¤„ç†å›¾åƒä¿¡å·çš„èŠ¯ç‰‡æˆ–è½¯ä»¶æ¨¡å—ï¼Œå®ƒé€šå¸¸ç”¨äºæ•°å­—ç›¸æœºã€æ™ºèƒ½æ‰‹æœºã€å¹³æ¿ç”µè„‘å’Œå…¶ä»–å„ç§å›¾åƒè®¾å¤‡ä¸­ã€‚ISPå¯ä»¥å¯¹ä»å›¾åƒä¼ æ„Ÿå™¨ä¸­è¯»å–çš„åŸå§‹å›¾åƒæ•°æ®è¿›è¡Œå¤„ç†ï¼ŒåŒ…æ‹¬å»å™ªã€ç™½å¹³è¡¡ã€è‰²å½©æ ¡æ­£ã€æ›å…‰æ§åˆ¶ã€é”åŒ–å’Œå…¶ä»–ä¸€äº›å›¾åƒå¤„ç†ç®—æ³•ï¼Œä»¥äº§ç”Ÿæ›´é«˜è´¨é‡çš„å›¾åƒã€‚ISPè¿˜å¯ä»¥æ”¯æŒä¸åŒçš„å›¾åƒæ ¼å¼å’Œå‹ç¼©ç®—æ³•ï¼Œä»¥ä¾¿åœ¨å­˜å‚¨å’Œä¼ è¾“">
<meta property="og:type" content="article">
<meta property="og:title" content="J5">
<meta property="og:url" content="http://example.com/2023/04/13/J5/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="J5 ISPè½¯ç¡¬ä»¶æ€»ä½“ä»‹ç»ISPåè¯è§£é‡ŠISPï¼ˆImage Signal Processorï¼‰ï¼šæ˜¯ä¸€ç§ä¸“é—¨ç”¨äºå¤„ç†å›¾åƒä¿¡å·çš„èŠ¯ç‰‡æˆ–è½¯ä»¶æ¨¡å—ï¼Œå®ƒé€šå¸¸ç”¨äºæ•°å­—ç›¸æœºã€æ™ºèƒ½æ‰‹æœºã€å¹³æ¿ç”µè„‘å’Œå…¶ä»–å„ç§å›¾åƒè®¾å¤‡ä¸­ã€‚ISPå¯ä»¥å¯¹ä»å›¾åƒä¼ æ„Ÿå™¨ä¸­è¯»å–çš„åŸå§‹å›¾åƒæ•°æ®è¿›è¡Œå¤„ç†ï¼ŒåŒ…æ‹¬å»å™ªã€ç™½å¹³è¡¡ã€è‰²å½©æ ¡æ­£ã€æ›å…‰æ§åˆ¶ã€é”åŒ–å’Œå…¶ä»–ä¸€äº›å›¾åƒå¤„ç†ç®—æ³•ï¼Œä»¥äº§ç”Ÿæ›´é«˜è´¨é‡çš„å›¾åƒã€‚ISPè¿˜å¯ä»¥æ”¯æŒä¸åŒçš„å›¾åƒæ ¼å¼å’Œå‹ç¼©ç®—æ³•ï¼Œä»¥ä¾¿åœ¨å­˜å‚¨å’Œä¼ è¾“">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230413095502144.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230413100008288.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230413100641601.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230413100847090.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230413101558584.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230413102356479.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230413102619436.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230413103326548.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230413104118516.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230413104411602.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230413104718792.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230413104835498.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230413105227373.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230413105748121.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230413110012436.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230413141440552.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230413141950166.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230413142430330.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230413142924688.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230413143449313.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230413143747621.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230413144303859.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230413145208674.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230413145942257.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230413150709408.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230413151331021.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230413152206939.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230413153249502.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230413153256246.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230413153545992.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230413154243974.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230413154841706.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230413155947281.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230413160926541.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230413162559842.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230413164354215.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230413190222405.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230413190239065.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230413191906143.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230413191917441.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230413192524229.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230413193303925.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230413202351846.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230413203431146.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230413203610737.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230413205313414.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230413205449483.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230413205457968.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230413205808655-16813906889561.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230413210047533.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230413210614098.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230413210812784.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230414081802204-16814314824862.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230414081944807.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230414082107058.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230414090204749.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230414090744026.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230414091506525.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230414091515257.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230414092121709.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230414092812821.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230414093656150.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230414093750378.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230414093814731.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230414094036665.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230414094240554.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230414150130688.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230414150325417.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230414150440962.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230414150603960.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230414150705375.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230414150851796.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230414151011131.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230414151311362.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230414191305397.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230414191332944.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230414191457449.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230414191618474.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230414191705921.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230414192726981.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230414193205759.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230414193443284.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230414194156836.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230415111219563.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230415111318104.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230415111350861.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230415111405353.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230415111416759.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230415111447163.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230415111506865.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230417100729900.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230417100729900.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230417110135342.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230508083610568.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230508083658725.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230508083721413.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230508083807175-16835062874561.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230508083839507.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230508105126487.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230508105624157.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230508105637087.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230508143642837.png">
<meta property="og:image" content="http://example.com/J5/image-20230508144405157.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230508153214469.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230508153238553.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230508153303552.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230508160041194.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230508162216452.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230508163604194.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230508163753480.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230508182313277.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230508183501325.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230508185808895.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230508193519478.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230508193533794.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230508193547284.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230508210604846.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230509081114868.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230509082134522.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230509082954384.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230509085125392.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230509142108471.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230509154920761.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230509161118772.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230509163550937.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230509163811644.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230509180655936.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230510101919593.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230510102108014.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230510110605591.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230511144012726.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230511151319223.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230511152328296.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230511163529466.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230511163541846.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230511163640082.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230511163652416.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230511163706141.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230511163716860.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230511163732112.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230511163745405.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230511163951063.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230511165306052.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230511165319688.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230511165339651.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230511170356933.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230511170406799.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230511170417646.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230512090436547.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230512102422982.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230512140850527.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230512140907489.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230512140915597.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230704120423250.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230518135248836.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230523141923963.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230523142304073.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230523145446009.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230523145458269.png">
<meta property="og:image" content="http://example.com/J5/image-20230523145847126.png">
<meta property="og:image" content="http://example.com/J5/image-20230523145906154.png">
<meta property="og:image" content="http://example.com/J5/image-20230523145919210.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230523145932256.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230523154854692.png">
<meta property="og:image" content="http://example.com/J5/image-20230523154924792.png">
<meta property="og:image" content="http://example.com/J5/image-20230523154943236.png">
<meta property="og:image" content="http://example.com/2023/04/13/J5/image-20230523161450735.png">
<meta property="article:published_time" content="2023-04-13T07:49:21.000Z">
<meta property="article:modified_time" content="2023-07-04T04:04:28.595Z">
<meta property="article:author" content="John Doe">
<meta property="article:tag" content="ONNX">
<meta property="article:tag" content="J5">
<meta property="article:tag" content="ISP">
<meta property="article:tag" content="é¡¹ç›®">
<meta property="article:tag" content="çƒ§å†™é•œåƒ">
<meta property="article:tag" content="PTQ">
<meta property="article:tag" content="Docker">
<meta property="article:tag" content="åµŒå…¥å¼å¼€å‘">
<meta property="article:tag" content="æµ®ç‚¹æ¨¡å‹è½¬å®šç‚¹æ¨¡å‹">
<meta property="article:tag" content="åœ°å¹³çº¿">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/2023/04/13/J5/image-20230413095502144.png">
    
    
    <!--- Icon Part-->
    <link rel="icon" type="image/png" href="/images/%E9%B1%BC.svg" sizes="192x192">
    <link rel="apple-touch-icon" sizes="180x180" href="/images/%E9%B1%BC.svg">
    <meta name="theme-color" content="#A31F34">
    <link rel="shortcut icon" href="/images/%E9%B1%BC.svg">
    <!--- Page Info-->
    
    <title>
        
            J5 -
        
        Airex-Daily
    </title>
    
<link rel="stylesheet" href="/css/style.css">

    
<link rel="stylesheet" href="/assets/fonts.css">

    <!--- Font Part-->
    
    
    
        <link href="" rel="stylesheet">
    
    
        <link href="" rel="stylesheet">
    

    <!--- Inject Part-->
    
    <script id="hexo-configurations">
    let Global = window.Global || {};
    Global.hexo_config = {"hostname":"example.com","root":"/","language":"zh-CN"};
    Global.theme_config = {"articles":{"style":{"font_size":"16px","line_height":1.5,"image_border_radius":"14px","image_alignment":"center","image_caption":false,"link_icon":true},"word_count":{"enable":true,"count":true,"min2read":true},"author_label":{"enable":true,"auto":false,"list":[]},"code_block":{"copy":true,"style":"mac","font":{"enable":false,"family":null,"url":null}},"toc":{"enable":true,"max_depth":3,"number":false,"expand":true,"init_open":true},"copyright":true,"lazyload":true,"recommendation":{"enable":false,"title":"æ¨èé˜…è¯»","limit":3,"placeholder":"/images/wallhaven-wqery6-light.webp","skip_dirs":[]}},"colors":{"primary":"#A31F34","secondary":null},"global":{"fonts":{"chinese":{"enable":true,"family":null,"url":null},"english":{"enable":true,"family":null,"url":null}},"content_max_width":"1000px","sidebar_width":"210px","hover":{"shadow":true,"scale":false},"scroll_progress":{"bar":false,"percentage":true},"busuanzi_counter":{"enable":true,"site_pv":true,"site_uv":true,"post_pv":true},"pjax":true,"open_graph":true,"google_analytics":{"enable":false,"id":null}},"home_banner":{"enable":true,"style":"fix","image":{"light":"/images/wallhaven-wqery6-light.webp","dark":"/images/wallhaven-rry6gw.png"},"title":"ä¼¸æ‰‹ä¹Ÿæ¡ä¸ä½å½©è™¹ğŸŒˆ","subtitle":{"text":["â€”â€”æˆ‘æœŸå¾…"],"hitokoto":{"enable":true,"api":"https://v1.hitokoto.cn"},"typing_speed":100,"backing_speed":80,"starting_delay":500,"backing_delay":1500,"loop":true,"smart_backspace":true},"text_color":{"light":"#fff","dark":"#d1d1b6"},"text_style":{"title_size":"2.8rem","subtitle_size":"1.5rem","line_height":1.2},"custom_font":{"enable":false,"family":null,"url":null},"social_links":{"enable":true,"links":{"github":"https://github.com/Airex-ai","instagram":null,"zhihu":null,"twitter":null,"email":"airex.yu@foxmail.com"}}},"plugins":{"feed":{"enable":false},"aplayer":{"enable":false,"type":"fixed","audios":[{"name":null,"artist":null,"url":"https://music.163.com/song?id=1501530173&userid=253099352","cover":null}]},"mermaid":{"enable":true,"version":"9.3.0"}},"version":"2.1.5","navbar":{"auto_hide":true,"color":{"left":"#f78736","right":"#367df7","transparency":35},"links":{"Home":{"path":"/","icon":"fa-regular fa-house"},"Archives":{"path":"/archives","icon":"fa-regular fa-archive"},"About":{"icon":"fa-regular fa-user","submenus":{"Github":"https://github.com/Airex-ai?tab=repositories"}},"éšè®°":{"icon":"fa-solid fa-tree-palm","path":"/masonry/"}},"search":{"enable":true,"preload":true}},"page_templates":{"friends_column":2,"tags_style":"blur"},"home":{"sidebar":{"enable":true,"position":"left","first_item":"menu","announcement":null,"links":{"Archives":{"path":"/archives","icon":"fa-regular fa-archive"},"Tags":{"path":"/tags","icon":"fa-regular fa-tags"},"Categories":{"path":"/categories","icon":"fa-regular fa-folder"}}},"article_date_format":"auto","categories":{"enable":true,"limit":3},"tags":{"enable":true,"limit":3}}};
    Global.language_ago = {"second":"%s ç§’å‰","minute":"%s åˆ†é’Ÿå‰","hour":"%s å°æ—¶å‰","day":"%s å¤©å‰","week":"%s å‘¨å‰","month":"%s ä¸ªæœˆå‰","year":"%s å¹´å‰"};
    Global.data_config = {"masonry":false};
  </script>
    
    <!--- Fontawesome Part-->
    
<link rel="stylesheet" href="/fontawesome/fontawesome.min.css">

    
<link rel="stylesheet" href="/fontawesome/brands.min.css">

    
<link rel="stylesheet" href="/fontawesome/solid.min.css">

    
<link rel="stylesheet" href="/fontawesome/regular.min.css">

    
    
    
    
<meta name="generator" content="Hexo 6.3.0"></head>


<body>
<div class="progress-bar-container">
    

    
        <span class="pjax-progress-bar"></span>
        <span class="pjax-progress-icon">
            <i class="fa-solid fa-circle-notch fa-spin"></i>
        </span>
    
</div>


<main class="page-container">

    

    <div class="main-content-container">

        <div class="main-content-header">
            <header class="navbar-container">
    
    <div class="navbar-content">
        <div class="left">
            
            <a class="logo-title" href="/">
                
                Airex-Daily
                
            </a>
        </div>

        <div class="right">
            <!-- PC -->
            <div class="desktop">
                <ul class="navbar-list">
                    
                        
                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class="" 
                                    href="/"  >
                                    
                                        
                                            <i class="fa-regular fa-house"></i>
                                        
                                        é¦–é¡µ
                                    
                                </a>
                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class="" 
                                    href="/archives"  >
                                    
                                        
                                            <i class="fa-regular fa-archive"></i>
                                        
                                        å½’æ¡£
                                    
                                </a>
                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class="has-dropdown" 
                                    href="#" onClick="return false;">
                                    
                                        
                                            <i class="fa-regular fa-user"></i>
                                        
                                        å…³äº&nbsp;<i class="fa-solid fa-chevron-down"></i>
                                    
                                </a>
                                <!-- Submenu -->
                                
                                    <ul class="sub-menu">
                                    
                                        <li>
                                        <a target="_blank" rel="noopener" href="https://github.com/Airex-ai?tab=repositories">GITHUB
                                        </a>
                                        </li>
                                    
                                    </ul>
                                
                            </li>
                    
                        
                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class="" 
                                    href="/masonry/"  >
                                    
                                        
                                            <i class="fa-solid fa-tree-palm"></i>
                                        
                                        éšè®°
                                    
                                </a>
                                <!-- Submenu -->
                                
                            </li>
                    
                    
                        <li class="navbar-item search search-popup-trigger">
                            <i class="fa-solid fa-magnifying-glass"></i>
                        </li>
                    
                </ul>
            </div>
            <!-- Mobile -->
            <div class="mobile">
                
                    <div class="icon-item search search-popup-trigger"><i class="fa-solid fa-magnifying-glass"></i></div>
                
                <div class="icon-item navbar-bar">
                    <div class="navbar-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile drawer -->
    <div class="navbar-drawer">
        <ul class="drawer-navbar-list">
            
                
                    <li class="drawer-navbar-item flex-center">
                        <a class="" 
                        href="/"  >
                             
                                
                                    <i class="fa-regular fa-house"></i>
                                
                                é¦–é¡µ
                            
                        </a>
                    </li>
                    <!-- Submenu -->
                    
            
                
                    <li class="drawer-navbar-item flex-center">
                        <a class="" 
                        href="/archives"  >
                             
                                
                                    <i class="fa-regular fa-archive"></i>
                                
                                å½’æ¡£
                            
                        </a>
                    </li>
                    <!-- Submenu -->
                    
            
                
                    <li class="drawer-navbar-item flex-center">
                        <a class="has-dropdown" 
                        href="#" onClick="return false;">
                            
                                
                                    <i class="fa-regular fa-user"></i>
                                
                                å…³äº&nbsp;<i class="fa-solid fa-chevron-down"></i>
                            
                        </a>
                    </li>
                    <!-- Submenu -->
                              
                        
                            <li class="dropdown-item flex-center">
                                <a class="dropdown-item" target="_blank" rel="noopener" href="https://github.com/Airex-ai?tab=repositories">GITHUB</a>
                            </li>
                        
                    
            
                
                    <li class="drawer-navbar-item flex-center">
                        <a class="" 
                        href="/masonry/"  >
                             
                                
                                    <i class="fa-solid fa-tree-palm"></i>
                                
                                éšè®°
                            
                        </a>
                    </li>
                    <!-- Submenu -->
                    
            

        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="main-content-body">

            

            <div class="main-content">

                
                    <div class="fade-in-down-animation">
    <div class="post-page-container">
        <div class="article-content-container">

            
             
                <div class="article-title">         
                    <img src="/images/J5.png" alt="J5" />
                    <h1 class="article-title-cover">J5</h1>
                </div>
            
                
            

            
                <div class="article-header">
                    <div class="avatar">
                        <img src="/images/%E5%A4%B4%E5%83%8F.JPG">
                    </div>
                    <div class="info">
                        <div class="author">
                            <span class="name">Airex Yu</span>
                            
                                <span class="author-label">Lv3</span>
                            
                        </div>
                        <div class="meta-info">
                            <div class="article-meta-info">
    <span class="article-date article-meta-item">
        <i class="fa-regular fa-pen-fancy"></i>&nbsp;
        <span class="desktop">2023-04-13 15:49:21</span>
        <span class="mobile">2023-04-13 15:49</span>
        <span class="hover-info">åˆ›å»º</span>
    </span>
    
        <span class="article-date article-meta-item">
            <i class="fa-regular fa-wrench"></i>&nbsp;
            <span class="desktop">2023-07-04 12:04:28</span>
            <span class="mobile">2023-07-04 12:04</span>
            <span class="hover-info">æ›´æ–°</span>
        </span>
    

    
        <span class="article-categories article-meta-item">
            <i class="fa-regular fa-folders"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/categories/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/">æ·±åº¦å­¦ä¹ </a>&nbsp;
                    </li>
                
                    <li>
                        &gt; <a href="/categories/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/%E8%87%AA%E5%8A%A8%E9%A9%BE%E9%A9%B6/">è‡ªåŠ¨é©¾é©¶</a>&nbsp;
                    </li>
                
                    <li>
                        &gt; <a href="/categories/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/%E8%87%AA%E5%8A%A8%E9%A9%BE%E9%A9%B6/%E5%9C%B0%E5%B9%B3%E7%BA%BF/">åœ°å¹³çº¿</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    
    
        <span class="article-tags article-meta-item">
            <i class="fa-regular fa-tags"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/tags/ONNX/">ONNX</a>&nbsp;
                    </li>
                
                    <li>
                        | <a href="/tags/J5/">J5</a>&nbsp;
                    </li>
                
                    <li>
                        | <a href="/tags/ISP/">ISP</a>&nbsp;
                    </li>
                
                    <li>
                        | <a href="/tags/%E9%A1%B9%E7%9B%AE/">é¡¹ç›®</a>&nbsp;
                    </li>
                
                    <li>
                        | <a href="/tags/%E7%83%A7%E5%86%99%E9%95%9C%E5%83%8F/">çƒ§å†™é•œåƒ</a>&nbsp;
                    </li>
                
                    <li>
                        | <a href="/tags/PTQ/">PTQ</a>&nbsp;
                    </li>
                
                    <li>
                        | <a href="/tags/Docker/">Docker</a>&nbsp;
                    </li>
                
                    <li>
                        | <a href="/tags/%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/">åµŒå…¥å¼å¼€å‘</a>&nbsp;
                    </li>
                
                    <li>
                        | <a href="/tags/%E6%B5%AE%E7%82%B9%E6%A8%A1%E5%9E%8B%E8%BD%AC%E5%AE%9A%E7%82%B9%E6%A8%A1%E5%9E%8B/">æµ®ç‚¹æ¨¡å‹è½¬å®šç‚¹æ¨¡å‹</a>&nbsp;
                    </li>
                
                    <li>
                        | <a href="/tags/%E5%9C%B0%E5%B9%B3%E7%BA%BF/">åœ°å¹³çº¿</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    

    
    
    
    
        <span class="article-pv article-meta-item">
            <i class="fa-regular fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>
        </span>
    
</div>

                        </div>
                    </div>
                </div>
            

            <div class="article-content markdown-body">
                <h1 id="J5-ISPè½¯ç¡¬ä»¶æ€»ä½“ä»‹ç»"><a href="#J5-ISPè½¯ç¡¬ä»¶æ€»ä½“ä»‹ç»" class="headerlink" title="J5 ISPè½¯ç¡¬ä»¶æ€»ä½“ä»‹ç»"></a><em>J5 ISPè½¯ç¡¬ä»¶æ€»ä½“ä»‹ç»</em></h1><h2 id="ISPåè¯è§£é‡Š"><a href="#ISPåè¯è§£é‡Š" class="headerlink" title="ISPåè¯è§£é‡Š"></a><em>ISPåè¯è§£é‡Š</em></h2><p><em><strong>ISPï¼ˆImage Signal Processorï¼‰</strong>ï¼šæ˜¯ä¸€ç§ä¸“é—¨ç”¨äºå¤„ç†å›¾åƒä¿¡å·çš„èŠ¯ç‰‡æˆ–è½¯ä»¶æ¨¡å—ï¼Œå®ƒé€šå¸¸ç”¨äºæ•°å­—ç›¸æœºã€æ™ºèƒ½æ‰‹æœºã€å¹³æ¿ç”µè„‘å’Œå…¶ä»–å„ç§å›¾åƒè®¾å¤‡ä¸­ã€‚ISPå¯ä»¥å¯¹ä»å›¾åƒä¼ æ„Ÿå™¨ä¸­è¯»å–çš„åŸå§‹å›¾åƒæ•°æ®è¿›è¡Œå¤„ç†ï¼ŒåŒ…æ‹¬å»å™ªã€ç™½å¹³è¡¡ã€è‰²å½©æ ¡æ­£ã€æ›å…‰æ§åˆ¶ã€é”åŒ–å’Œå…¶ä»–ä¸€äº›å›¾åƒå¤„ç†ç®—æ³•ï¼Œä»¥äº§ç”Ÿæ›´é«˜è´¨é‡çš„å›¾åƒã€‚ISPè¿˜å¯ä»¥æ”¯æŒä¸åŒçš„å›¾åƒæ ¼å¼å’Œå‹ç¼©ç®—æ³•ï¼Œä»¥ä¾¿åœ¨å­˜å‚¨å’Œä¼ è¾“å›¾åƒæ—¶èŠ‚çœå¸¦å®½å’Œå­˜å‚¨ç©ºé—´ã€‚åœ¨ç°ä»£æ•°å­—ç›¸æœºå’Œæ™ºèƒ½æ‰‹æœºä¸­ï¼ŒISPæ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„ç»„æˆéƒ¨åˆ†ï¼Œå®ƒå¯ä»¥å¸®åŠ©ç”¨æˆ·è½»æ¾åœ°æ‹æ‘„é«˜è´¨é‡çš„ç…§ç‰‡å’Œè§†é¢‘ã€‚</em></p>
<p><em><strong>Camera Interface Managerï¼ˆç›¸æœºæ¥å£ç®¡ç†å™¨ï¼‰</strong>ï¼šæ˜¯ä¸€ç§è½¯ä»¶ç»„ä»¶ï¼Œå®ƒè´Ÿè´£ç®¡ç†è®¾å¤‡ä¸Šçš„ç›¸æœºç¡¬ä»¶å’Œåº”ç”¨ç¨‹åºä¹‹é—´çš„é€šä¿¡ã€‚å®ƒæä¾›äº†ä¸€ä¸ªæ¥å£ï¼Œè®©åº”ç”¨ç¨‹åºå¯ä»¥è®¿é—®è®¾å¤‡ä¸Šçš„ç›¸æœºï¼Œå¹¶æ§åˆ¶å®ƒçš„å„ç§åŠŸèƒ½ï¼Œå¦‚ç„¦è·ã€æ›å…‰ã€é—ªå…‰ç¯ç­‰ã€‚æ­¤å¤–ï¼Œç›¸æœºæ¥å£ç®¡ç†å™¨è¿˜å¯ä»¥å¤„ç†ç›¸æœºç¡¬ä»¶å’Œè½¯ä»¶ä¹‹é—´çš„å…¼å®¹æ€§é—®é¢˜ï¼Œç¡®ä¿ç›¸æœºç¡¬ä»¶èƒ½å¤Ÿä¸åº”ç”¨ç¨‹åºæ­£å¸¸é€šä¿¡ã€‚</em></p>
<p><em><strong>PYMï¼ˆPyramidï¼‰</strong>ï¼šPyramidæ˜¯ä¸€ä¸ªæµè¡Œçš„Python Webæ¡†æ¶ã€‚å®ƒæ˜¯ä¸€ä¸ªå¼€æºçš„æ¡†æ¶ï¼Œä½¿ç”¨ç®€å•ï¼Œé€‚ç”¨äºå¼€å‘å„ç§è§„æ¨¡çš„Webåº”ç”¨ç¨‹åºã€‚Pyramidçš„ç‰¹ç‚¹ä¹‹ä¸€æ˜¯å®ƒçš„çµæ´»æ€§ï¼Œå®ƒå…è®¸å¼€å‘äººå‘˜ä½¿ç”¨å„ç§å·¥å…·å’Œåº“æ¥æ„å»ºWebåº”ç”¨ç¨‹åºã€‚Pyramidè¿˜å…·æœ‰å¯æ‰©å±•æ€§å’Œå¯å®šåˆ¶æ€§ï¼Œå› æ­¤å¯ä»¥æ ¹æ®éœ€è¦è¿›è¡Œè‡ªå®šä¹‰é…ç½®å’Œæ‰©å±•ã€‚</em></p>
<p><em><strong>VPSï¼ˆVideo Processing Systemï¼‰ï¼ˆè§†é¢‘å¤„ç†ç³»ç»Ÿï¼‰</strong>ï¼šæ˜¯ä¸€ç§ç”¨äºå¤„ç†è§†é¢‘ä¿¡å·çš„è®¡ç®—æœºç³»ç»Ÿæˆ–è®¾å¤‡ã€‚å®ƒé€šå¸¸ç”±ç¡¬ä»¶å’Œè½¯ä»¶ç»„æˆï¼Œå¯ä»¥å¯¹è§†é¢‘ä¿¡å·è¿›è¡Œä¸åŒçš„æ“ä½œï¼Œä¾‹å¦‚ç¼–ç ã€è§£ç ã€å‹ç¼©ã€è§£å‹ã€æ»¤æ³¢ã€é™å™ªã€å¢å¼ºã€åˆ†æå’Œæ¸²æŸ“ç­‰ã€‚</em></p>
<p><em><strong>DRCDï¼š</strong>Dynamic Range Compressionï¼ˆåŠ¨æ€èŒƒå›´å‹ç¼©ï¼‰å’ŒDynamic Range Decompressionï¼ˆåŠ¨æ€èŒƒå›´è§£å‹ï¼‰æ˜¯ä¸€ç§ä¿¡å·å¤„ç†æŠ€æœ¯ï¼Œé€šå¸¸ç”¨äºéŸ³é¢‘å’Œè§†é¢‘å¤„ç†ä¸­ã€‚åœ¨éŸ³é¢‘å¤„ç†ä¸­ï¼ŒDynamic Range Compressionè¢«ç”¨æ¥æ§åˆ¶éŸ³é‡çš„å˜åŒ–ï¼Œä½¿å¾—éŸ³é¢‘ä¸­çš„å“åº¦å˜åŒ–æ›´åŠ å¹³æ»‘ï¼Œä»è€Œæé«˜éŸ³é¢‘çš„è´¨é‡ã€‚åœ¨è§†é¢‘å¤„ç†ä¸­ï¼ŒDynamic Range Compressionè¢«ç”¨æ¥æ§åˆ¶äº®åº¦çš„å˜åŒ–ï¼Œä½¿å¾—è§†é¢‘ä¸­çš„äº®åº¦å˜åŒ–æ›´åŠ å¹³æ»‘ï¼Œä»è€Œæé«˜è§†é¢‘çš„è´¨é‡ã€‚</em></p>
<ul>
<li><p><em>Dynamic Range Compressionçš„ä¸»è¦æ€æƒ³æ˜¯é€šè¿‡å‹ç¼©ä¿¡å·çš„åŠ¨æ€èŒƒå›´æ¥æ§åˆ¶ä¿¡å·çš„å“åº¦å˜åŒ–ã€‚å…·ä½“æ¥è¯´ï¼Œå®ƒä¼šå°†ä¿¡å·çš„è¾ƒå¤§å¹…åº¦éƒ¨åˆ†å‹ç¼©åˆ°è¾ƒå°çš„å¹…åº¦èŒƒå›´å†…ï¼Œä»è€Œä½¿å¾—æ•´ä¸ªä¿¡å·çš„åŠ¨æ€èŒƒå›´å˜å°ã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯å¯ä»¥ä½¿å¾—ä¿¡å·çš„å“åº¦å˜åŒ–æ›´åŠ å¹³æ»‘ï¼Œä»è€Œæé«˜ä¿¡å·çš„è´¨é‡ã€‚</em></p>
</li>
<li><p><em>Dynamic Range Decompressionåˆ™æ˜¯å°†å‹ç¼©åçš„ä¿¡å·æ¢å¤åˆ°åŸæ¥çš„åŠ¨æ€èŒƒå›´ã€‚è¿™ä¸ªè¿‡ç¨‹é€šå¸¸æ˜¯é€šè¿‡å¯¹å‹ç¼©åçš„ä¿¡å·è¿›è¡Œæ”¾å¤§æ¥å®ç°çš„ã€‚</em></p>
</li>
<li><p><em>åœ¨éŸ³é¢‘å¤„ç†ä¸­ï¼ŒDynamic Range Compressionå’ŒDynamic Range Decompressioné€šå¸¸è¢«ç”¨æ¥æ§åˆ¶éŸ³é¢‘çš„å“åº¦å˜åŒ–ï¼Œä»è€Œæé«˜éŸ³é¢‘çš„è´¨é‡ã€‚åœ¨è§†é¢‘å¤„ç†ä¸­ï¼ŒDynamic Range Compressionå’ŒDynamic Range Decompressionåˆ™è¢«ç”¨æ¥æ§åˆ¶è§†é¢‘çš„äº®åº¦å˜åŒ–ï¼Œä»è€Œæé«˜è§†é¢‘çš„è´¨é‡ã€‚</em></p>
</li>
</ul>
<p><em><strong>Color Correction Matrixï¼š</strong>åœ¨è®¡ç®—æœºç¼–ç¨‹ä¸­ï¼ŒChromatic Aberrationï¼ˆè‰²å·®ï¼‰æ˜¯æŒ‡é€é•œæˆ–é•œå¤´æ— æ³•å°†æ‰€æœ‰é¢œè‰²çš„å…‰çº¿èšç„¦åœ¨åŒä¸€ç‚¹ä¸Šï¼Œä»è€Œå¯¼è‡´å›¾åƒå‡ºç°è‰²å·®ã€‚Chromatic Aberration Correctionï¼ˆè‰²å·®æ ¡æ­£ï¼‰æ˜¯ä¸€ç§æŠ€æœ¯ï¼Œæ—¨åœ¨é€šè¿‡å¯¹å›¾åƒè¿›è¡Œå¤„ç†æ¥å‡å°‘æˆ–æ¶ˆé™¤è‰²å·®çš„å½±å“ã€‚åœ¨å›¾åƒå¤„ç†ä¸­ï¼Œè‰²å·®æ ¡æ­£å¯ä»¥é€šè¿‡å¯¹å›¾åƒè¿›è¡ŒåæœŸå¤„ç†æ¥å®ç°ã€‚è¿™é€šå¸¸æ¶‰åŠåˆ°å¯¹å›¾åƒè¿›è¡Œé¢œè‰²å¹³è¡¡ï¼Œå³è°ƒæ•´å›¾åƒä¸­ä¸åŒé¢œè‰²çš„äº®åº¦å’Œé¥±å’Œåº¦ï¼Œä»¥ä¾¿å®ƒä»¬çœ‹èµ·æ¥æ›´åŠ è‡ªç„¶å’Œå¹³è¡¡ã€‚æ­¤å¤–ï¼Œä¸€äº›å›¾åƒå¤„ç†è½¯ä»¶è¿˜æä¾›äº†ç‰¹å®šçš„å·¥å…·ï¼Œä¾‹å¦‚Adobe Photoshopä¸­çš„Lens Correctionï¼ˆé•œå¤´æ ¡æ­£ï¼‰å·¥å…·ï¼Œå¯ä»¥å¸®åŠ©ç”¨æˆ·å‡å°‘æˆ–æ¶ˆé™¤è‰²å·®ã€‚</em></p>
<p><em><strong>Color Correction Matrixï¼š</strong>åœ¨è®¡ç®—æœºç¼–ç¨‹ä¸­ï¼ŒColor Correction Matrixï¼ˆé¢œè‰²æ ¡æ­£çŸ©é˜µï¼‰æ˜¯ä¸€ç§ç”¨äºè°ƒæ•´å›¾åƒé¢œè‰²çš„æŠ€æœ¯ã€‚å®ƒé€šå¸¸ç”¨äºåœ¨æ˜¾ç¤ºå™¨æˆ–æ‰“å°æœºç­‰è®¾å¤‡ä¸Šæ ¡æ­£é¢œè‰²ï¼Œä»¥ä¾¿å®ƒä»¬èƒ½å¤Ÿæ›´å‡†ç¡®åœ°æ˜¾ç¤ºæˆ–æ‰“å°é¢œè‰²ã€‚Color Correction Matrixæ˜¯ä¸€ä¸ªçŸ©é˜µï¼Œé€šå¸¸æ˜¯3x3çš„ï¼Œç”¨äºå°†è¾“å…¥å›¾åƒçš„RGBå€¼è½¬æ¢ä¸ºè¾“å‡ºå›¾åƒçš„RGBå€¼ã€‚è¿™ä¸ªçŸ©é˜µå¯ä»¥æ ¹æ®éœ€è¦è¿›è¡Œè°ƒæ•´ï¼Œä»¥å®ç°ä¸åŒçš„é¢œè‰²æ ¡æ­£æ•ˆæœã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨Color Correction Matrixæ¥å¢åŠ æˆ–å‡å°‘å›¾åƒä¸­çš„çº¢è‰²ã€ç»¿è‰²æˆ–è“è‰²æˆåˆ†ï¼Œæˆ–è€…è°ƒæ•´äº®åº¦å’Œå¯¹æ¯”åº¦ç­‰ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼ŒColor Correction Matrixé€šå¸¸ä½œä¸ºå›¾åƒå¤„ç†åº“æˆ–è½¯ä»¶ä¸­çš„ä¸€ä¸ªé€‰é¡¹æä¾›ï¼Œä¾‹å¦‚Adobe Photoshopæˆ–GIMPç­‰ã€‚ç¨‹åºå‘˜å¯ä»¥ä½¿ç”¨è¿™äº›åº“æˆ–è½¯ä»¶æ¥åˆ›å»ºè‡ªå·±çš„Color Correction Matrixï¼Œæˆ–è€…ä½¿ç”¨é¢„å®šä¹‰çš„çŸ©é˜µæ¥å®ç°ç‰¹å®šçš„é¢œè‰²æ ¡æ­£æ•ˆæœã€‚</em></p>
<p><em><strong>Color Space Conversionï¼š</strong>åœ¨è®¡ç®—æœºç¼–ç¨‹ä¸­ï¼ŒColor Space Conversionï¼ˆé¢œè‰²ç©ºé—´è½¬æ¢ï¼‰æ˜¯æŒ‡å°†ä¸€ç§é¢œè‰²ç©ºé—´ä¸­çš„é¢œè‰²å€¼è½¬æ¢ä¸ºå¦ä¸€ç§é¢œè‰²ç©ºé—´ä¸­çš„é¢œè‰²å€¼çš„è¿‡ç¨‹ã€‚é¢œè‰²ç©ºé—´æ˜¯ä¸€ç§ç”¨äºè¡¨ç¤ºé¢œè‰²çš„æ•°å­¦æ¨¡å‹ï¼Œå®ƒå®šä¹‰äº†ä¸€ç»„é¢œè‰²å€¼åŠå…¶åœ¨è‰²å½©ç©ºé—´ä¸­çš„æ’åˆ—æ–¹å¼ã€‚å¸¸è§çš„é¢œè‰²ç©ºé—´åŒ…æ‹¬RGBã€CMYKã€HSVã€HSLç­‰ã€‚RGBæ˜¯ä¸€ç§åŸºäºçº¢ã€ç»¿ã€è“ä¸‰åŸè‰²æ„æˆçš„é¢œè‰²ç©ºé—´ï¼Œå¸¸ç”¨äºæ˜¾ç¤ºå™¨ã€ç…§æ˜ç­‰é¢†åŸŸï¼›CMYKæ˜¯ä¸€ç§åŸºäºé’ã€å“çº¢ã€é»„ã€é»‘å››ç§é¢œæ–™æ„æˆçš„é¢œè‰²ç©ºé—´ï¼Œå¸¸ç”¨äºå°åˆ·é¢†åŸŸï¼›HSVå’ŒHSLåˆ™æ˜¯ä¸€ç§åŸºäºè‰²ç›¸ã€é¥±å’Œåº¦ã€äº®åº¦æˆ–æ˜åº¦çš„é¢œè‰²ç©ºé—´ï¼Œå¸¸ç”¨äºå›¾å½¢å¤„ç†ç­‰é¢†åŸŸã€‚é¢œè‰²ç©ºé—´è½¬æ¢åœ¨å¾ˆå¤šé¢†åŸŸéƒ½æœ‰åº”ç”¨ï¼Œä¾‹å¦‚å›¾åƒå¤„ç†ã€è®¡ç®—æœºè§†è§‰ã€è®¡ç®—æœºå›¾å½¢å­¦ç­‰ã€‚åœ¨ç¼–ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å„ç§ç¼–ç¨‹è¯­è¨€å’Œåº“æ¥å®ç°é¢œè‰²ç©ºé—´è½¬æ¢ï¼Œä¾‹å¦‚Pythonä¸­çš„OpenCVåº“ã€Javaä¸­çš„Java Advanced Imagingåº“ç­‰ã€‚</em></p>
<p><em><strong>Mutil-Context backendï¼š</strong>åœ¨è®¡ç®—æœºç¼–ç¨‹ä¸­ï¼ŒMulti-Context backendæ˜¯æŒ‡ä¸€ç§æ”¯æŒåœ¨å¤šä¸ªä¸Šä¸‹æ–‡ç¯å¢ƒä¸­æ‰§è¡Œè®¡ç®—çš„åç«¯ã€‚è¿™ç§åç«¯é€šå¸¸ç”¨äºå¤„ç†å¤§è§„æ¨¡çš„è®¡ç®—ä»»åŠ¡ï¼Œä¾‹å¦‚æ·±åº¦å­¦ä¹ æ¨¡å‹è®­ç»ƒã€‚åœ¨æ·±åº¦å­¦ä¹ ä¸­ï¼Œé€šå¸¸ä½¿ç”¨å›¾å½¢è®¡ç®—æ¡†æ¶ï¼ˆå¦‚TensorFlowæˆ–PyTorchï¼‰æ¥å®šä¹‰è®¡ç®—å›¾ï¼Œç„¶åä½¿ç”¨åç«¯æ¥æ‰§è¡Œè®¡ç®—ã€‚Multi-Context backendå…·æœ‰å¤šä¸ªä¸Šä¸‹æ–‡ç¯å¢ƒï¼Œå¯ä»¥åŒæ—¶æ‰§è¡Œå¤šä¸ªè®¡ç®—å›¾ï¼Œä»è€Œæé«˜è®¡ç®—æ•ˆç‡ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥å°†å¤šä¸ªå°å‹æ¨¡å‹æ”¾åœ¨åŒä¸€å—GPUä¸Šæ‰§è¡Œï¼Œæˆ–è€…å°†ä¸€ä¸ªå¤§å‹æ¨¡å‹æ‹†åˆ†æˆå¤šä¸ªéƒ¨åˆ†ï¼Œåˆ†åˆ«åœ¨å¤šä¸ªGPUä¸Šæ‰§è¡Œã€‚Multi-Context backendé€šå¸¸éœ€è¦ç¡¬ä»¶æ”¯æŒï¼Œä¾‹å¦‚å¤šGPUã€å¤šæ ¸CPUæˆ–åˆ†å¸ƒå¼ç³»ç»Ÿã€‚åœ¨ä½¿ç”¨Multi-Context backendæ—¶ï¼Œéœ€è¦ä»”ç»†è®¾è®¡è®¡ç®—å›¾å’Œä»»åŠ¡åˆ†é…ï¼Œä»¥å……åˆ†åˆ©ç”¨ç¡¬ä»¶èµ„æºå¹¶é¿å…ç“¶é¢ˆã€‚</em></p>
<h2 id="ISP-pipelineä»‹ç»"><a href="#ISP-pipelineä»‹ç»" class="headerlink" title="ISP pipelineä»‹ç»"></a><em>ISP pipelineä»‹ç»</em></h2><h3 id="J5æµç¨‹"><a href="#J5æµç¨‹" class="headerlink" title="J5æµç¨‹"></a><em>J5æµç¨‹</em></h3><p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230413095502144.png"
                      class="" title="image-20230413095502144"
                ></em></p>
<h3 id="J5-ISP-feature"><a href="#J5-ISP-feature" class="headerlink" title="J5 ISP feature"></a><em>J5 ISP feature</em></h3><p><em>1ã€æ”¯æŒOnline&#x2F;Offlineå¹¶è¡Œå¤šæ ·æ ¼å¼çš„æ•°æ®è¾“å‡ºã€‚ã€</em></p>
<p><em>2ã€æ”¯æŒè¾“å…¥&#x2F;è¾“å‡ºæ•°æ®CropåŠŸèƒ½ã€‚</em></p>
<p><em>3ã€æ”¯æŒSensor Linearæ¨¡å¼ã€Sensor Native(built-in)å®½åŠ¨æ€æ¨¡å¼ã€ä»¥åŠæ”¯æŒæœ€å¤§4:1çš„HDRæ¨¡å¼ã€‚</em></p>
<p><em>4ã€æ”¯æŒå¤šç±»å‹çš„CFA pattern: RGGB, RCCC,RGBIR, RCCB,RYYCy,and RCCG</em></p>
<p><em>5ã€æ”¯æŒçµæ´»å¤šæ ·çš„statistics dataï¼ŒåŒ…æ‹¬:9 instances of 1024-bin fixed histogramsã€1 instance of an AE 5-bin configurable histogramã€1 instance of an AWB ratio meterã€16 instances of ROl pixel croppersã€‚</em></p>
<p><em>6ã€æ”¯æŒSpatial NR(sinter)ã€Local&#x2F;Global Tone-mapping Engine(iridix)ã€Gammaã€Chromatic Aberration Correctionã€Colour Correction Matrixã€Green Equalisationã€Shading Correctionã€Defect Pixel Correction. Black Level Correctionã€Digital Gainã€White Balanceç­‰ISPå¤„ç†åŠŸèƒ½ã€‚</em></p>
<p><em>7ã€ISPæ”¯æŒFunction safetyç›¸å…³åŠŸèƒ½ï¼ŒåŒ…æ‹¬BIST(Built in self-test)ã€Continuous Checking with Dedicated Safety Circuitsã€Fault Reportç­‰ã€‚</em></p>
<h3 id="J5-ISPæ€§èƒ½"><a href="#J5-ISPæ€§èƒ½" class="headerlink" title="J5 ISPæ€§èƒ½"></a><em>J5 ISPæ€§èƒ½</em></h3><p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230413100008288.png"
                      class="" title="image-20230413100008288"
                ></em></p>
<h2 id="ISPç¡¬ä»¶åŸç†"><a href="#ISPç¡¬ä»¶åŸç†" class="headerlink" title="ISPç¡¬ä»¶åŸç†"></a><em>ISPç¡¬ä»¶åŸç†</em></h2><h3 id="ISPå·¥ä½œåŸç†"><a href="#ISPå·¥ä½œåŸç†" class="headerlink" title="ISPå·¥ä½œåŸç†"></a><em>ISPå·¥ä½œåŸç†</em></h3><ol>
<li><em>ISPé€šè¿‡MCFEè¿›è¡Œå¤šè·¯è°ƒåº¦raw dataè¿›ISP pipelineå¤„ç†ï¼Œå¯ä»¥æ˜¯ä»inputä¸­è°ƒå…¥ï¼Œä¹Ÿå¯ä»¥æ˜¯ä»Raw bufferä¸­è°ƒå…¥</em></li>
<li><em>MCBEæ§åˆ¶ISPçš„DDRè¾“å‡ºå’Œoutputè¾“å‡º</em></li>
<li><em>MCFEæ§åˆ¶å¤šè·¯ISPé…ç½®çš„åˆ‡æ¢</em></li>
<li><em>å¤šè·¯æ•°æ®æµçš„ISPé…ç½®ç›¸äº’ç‹¬ç«‹ï¼Œå¯¸äºcdma_space</em></li>
<li><em>å½“éœ€è¦å¤„ç†æŸè·¯æ•°æ®æµæ—¶ï¼ŒISPå…ˆloadå¯¹åº”çš„cdma spaceåˆ°register spaceï¼Œå¤„ç†å®Œè¯¥è·¯æ•°æ®æ—¶ï¼Œå°†ç›¸åº”çš„statisticsä»register spaceå†™åˆ°cdma space</em></li>
</ol>
<p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230413100641601.png"
                      class="" title="image-20230413100641601"
                ></em></p>
<h3 id="ISPè°ƒåº¦æ¨¡å¼"><a href="#ISPè°ƒåº¦æ¨¡å¼" class="headerlink" title="ISPè°ƒåº¦æ¨¡å¼"></a><em>ISPè°ƒåº¦æ¨¡å¼</em></h3><p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230413100847090.png"
                      class="" title="image-20230413100847090"
                ></em></p>
<h3 id="ISPå…¸å‹ä¸­æ–­æ—¶åº"><a href="#ISPå…¸å‹ä¸­æ–­æ—¶åº" class="headerlink" title="ISPå…¸å‹ä¸­æ–­æ—¶åº"></a><em>ISPå…¸å‹ä¸­æ–­æ—¶åº</em></h3><p><em>FE_STARTï¼šå›¾ç‰‡çš„ä¸€å¸§çš„ç¬¬ä¸€è¡Œæµç»è¯¥ä½ç½®äº§ç”Ÿçš„ä¸­æ–­</em></p>
<p><em>FE_ENDï¼šå›¾ç‰‡çš„ä¸€å¸§æµç»æœ€åä¸€è¡Œæµç»è¯¥ä½ç½®äº§ç”Ÿçš„ç»ˆç«¯</em></p>
<p><em>æ³¨æ„ï¼šCIM_DMAä¸ç»è¿‡pipelineï¼Œæ‰€ä»¥ä¸ä¼šäº§ç”Ÿä¸Šè¿°ä¸­æ–­</em></p>
<p><em>ä¸ä¸Šè¿°æè¿°ç±»ä¼¼ï¼Œè¾“å‡ºå›¾ç‰‡çš„ä¸€å¸§çš„ç¬¬ä¸€è¡Œæµç»çš„ä½ç½®äº§ç”Ÿçš„ä¸­æ–­ç§°ä¸ºBE_STARTï¼Œæœ€åä¸€è¡Œæµç»çš„ä½ç½®äº§ç”Ÿçš„ä¸­æ–­ç§°ä¸ºBE_END</em></p>
<p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230413101558584.png"
                      class="" title="image-20230413101558584"
                ></em></p>
<h2 id="ISPè½¯ä»¶æ¶æ„"><a href="#ISPè½¯ä»¶æ¶æ„" class="headerlink" title="ISPè½¯ä»¶æ¶æ„"></a><em>ISPè½¯ä»¶æ¶æ„</em></h2><h3 id="ISP-è½¯ä»¶æ¶æ„overview"><a href="#ISP-è½¯ä»¶æ¶æ„overview" class="headerlink" title="ISP è½¯ä»¶æ¶æ„overview"></a><em>ISP è½¯ä»¶æ¶æ„overview</em></h3><p><em>ISPè½¯ä»¶firmwareåŒ…æ‹¬ï¼š</em></p>
<ol>
<li><em>ISP driverï¼šå®ç°å¯¹isp hardwareçš„è®¿é—®ã€ispè°ƒåº¦ç®¡ç†ã€ispä¸­æ–­å¤„ç†ã€bufferç®¡ç†ã€calibrationåŠ è½½ã€sensorå›è°ƒã€isp fsmå¤„ç†ã€tuning  tool connectionã€ISPå·¥ä½œçº¿ç¨‹ã€ISPå›çŒä¸dumpã€åŠŸèƒ½å®‰å…¨ã€ISP debugç­‰</em></li>
<li><em><strong>ISP halï¼ˆAPIåº“ï¼‰</strong>ï¼šå®ç°ISP API LIBã€2A LIBã€Calibration LIBã€Tuning serverç­‰</em></li>
<li><em>ISP userï¼šå®ç°å¯¹VPS interfaceæä¾›APIï¼Œä»¥åŠå¯¹user appæä¾›ISP APIï¼Œä¸ºç”¨æˆ·æä¾›ISPæ§åˆ¶æ¥å£</em></li>
<li><em>Tuning toolï¼štuning toolåŒ…æ‹¬Control Toolã€Calibration Toolã€Hobotplaer</em></li>
</ol>
<p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230413102356479.png"
                      class="" title="image-20230413102356479"
                ></em></p>
<h3 id="ISPè½¯ä»¶feature"><a href="#ISPè½¯ä»¶feature" class="headerlink" title="ISPè½¯ä»¶feature"></a><em>ISPè½¯ä»¶feature</em></h3><p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230413102619436.png"
                      class="" title="image-20230413102619436"
                ></em></p>
<h3 id="ISPè½¯ä»¶æ•°æ®æµä¸æ§åˆ¶æµ"><a href="#ISPè½¯ä»¶æ•°æ®æµä¸æ§åˆ¶æµ" class="headerlink" title="ISPè½¯ä»¶æ•°æ®æµä¸æ§åˆ¶æµ"></a><em>ISPè½¯ä»¶æ•°æ®æµä¸æ§åˆ¶æµ</em></h3><ol>
<li><p><em>Tuning toolæä¾›å¯¹sensorã€hwã€swçš„è®¿é—®</em></p>
</li>
<li><p><em>ISP SWä¸CIM_DMAiæä¾›raw bufferäº¤æ¢ã€</em></p>
</li>
<li><p><em>ISP SWä¸PYMæä¾›frame id &amp; timestampsçš„ä¼ é€’ä»¥åŠå¤šè·¯å¯¹åº”å‚æ•°çš„åŒæ­¥äº¤æ¢ã€</em></p>
</li>
<li><p><em>ISP SWä¸ºVPS &amp; user APPæä¾›è®¿é—®æ¥å£</em></p>
</li>
</ol>
<p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230413103326548.png"
                      class="" title="image-20230413103326548"
                ></em></p>
<h3 id="ISP-firmwareç›¸äº’å…³ç³»"><a href="#ISP-firmwareç›¸äº’å…³ç³»" class="headerlink" title="ISP firmwareç›¸äº’å…³ç³»"></a><em>ISP firmwareç›¸äº’å…³ç³»</em></h3><ol>
<li><p><em>PCç«¯è¿è¡ŒHobotplayerã€Control Toolã€Calibration toolã€‚</em></p>
<ul>
<li><p><em>Hobotplayeré€šè¿‡VPS Streamingè·å–æ•°æ®æµã€å®ç°åœ¨çº¿æ˜¾ç¤ºã€snapshotã€ç»Ÿè®¡æ•°æ®åˆ†æç­‰åŠŸèƒ½</em></p>
</li>
<li><p><em>Control Toolé€šè¿‡Tuning packageè®¿é—®Tuning serverï¼Œå®ç°å¯¹ISPçš„åœ¨çº¿è°ƒè¯•</em></p>
</li>
</ul>
</li>
<li><p><em>J5 boardè¿è¡ŒVPS Streamingã€Tuningpackageç­‰åº”ç”¨</em></p>
</li>
<li><p><em>ISP SWä¸ºVPS Streamingã€Tuning packageæä¾›ISPå„é¡¹tuning æ‰€éœ€åŠŸèƒ½</em></p>
</li>
</ol>
<h2 id="ISPè½¯ä»¶æµç¨‹"><a href="#ISPè½¯ä»¶æµç¨‹" class="headerlink" title="ISPè½¯ä»¶æµç¨‹"></a><em>ISPè½¯ä»¶æµç¨‹</em></h2><h3 id="ISPè½¯ä»¶åˆå§‹åŒ–ä¸å·¥ä½œæµç¨‹"><a href="#ISPè½¯ä»¶åˆå§‹åŒ–ä¸å·¥ä½œæµç¨‹" class="headerlink" title="ISPè½¯ä»¶åˆå§‹åŒ–ä¸å·¥ä½œæµç¨‹"></a><em>ISPè½¯ä»¶åˆå§‹åŒ–ä¸å·¥ä½œæµç¨‹</em></h3><p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230413104118516.png"
                      class="" title="image-20230413104118516"
                ></em></p>
<h3 id="ISP-2A-amp-ISP-kernel-drvçš„äº¤äº’æµç¨‹"><a href="#ISP-2A-amp-ISP-kernel-drvçš„äº¤äº’æµç¨‹" class="headerlink" title="ISP 2A &amp; ISP kernel drvçš„äº¤äº’æµç¨‹"></a><em>ISP 2A &amp; ISP kernel drvçš„äº¤äº’æµç¨‹</em></h3><ol>
<li><em>ISP kernel drvé€šè¿‡sbufä¸Šé€ç»Ÿè®¡æ•°æ®ç»™2A</em>  </li>
<li><em>2Aç®—æ³•åˆ©ç”¨ç»Ÿè®¡æ•°æ®è®¡ç®—2Aè°ƒtargetï¼Œå¹¶é€šè¿‡ufä¸‹å‘è®¡ç®—ç»“æœç»™ISP kernel drv</em></li>
</ol>
<p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230413104411602.png"
                      class="" title="image-20230413104411602"
                ></em></p>
<h3 id="ISPå¯¹å¤–APIä½¿ç”¨æµç¨‹"><a href="#ISPå¯¹å¤–APIä½¿ç”¨æµç¨‹" class="headerlink" title="ISPå¯¹å¤–APIä½¿ç”¨æµç¨‹"></a><em>ISPå¯¹å¤–APIä½¿ç”¨æµç¨‹</em></h3><ol>
<li><em>ISP APIä¸ºç”¨æˆ·åº”ç”¨æä¾›æ¥å£ï¼Œå®ç°ç”¨æˆ·åº”ç”¨å¯¹ISPçš„è®¿é—®ä¸æ§åˆ¶</em></li>
<li><em>å¯¹å¤–APIçš„è®¿é—®ä¸æ•°æ®æµæ§åˆ¶è¿›ç¨‹å¯ä»¥åˆ†ç¦»ï¼Œæ–¹ä¾¿ç”¨æˆ·å¤šè¿›ç¨‹è®¿é—®</em></li>
</ol>
<p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230413104718792.png"
                      class="" title="image-20230413104718792"
                ></em></p>
<h3 id="ISPå¯¹å¤–API"><a href="#ISPå¯¹å¤–API" class="headerlink" title="ISPå¯¹å¤–API"></a><em>ISPå¯¹å¤–API</em></h3><p><em><strong>1åˆ‡æ¢2Aæ¨¡å¼ä¸ºautoï¼Œ2åˆ‡æ¢2Aæ¨¡å¼ ä¸ºmanualã€‚éœ€è¦è°ƒ2Açš„å‚æ•°æ—¶ï¼Œéœ€è¦å°†2Aæ¨¡å¼åˆ‡æ¢ä¸ºmanual</strong></em></p>
<p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230413104835498.png"
                      class="" title="image-20230413104835498"
                ></em></p>
<p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230413105227373.png"
                      class="" title="image-20230413105227373"
                ></em></p>
<p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230413105748121.png"
                      class="" title="image-20230413105748121"
                ></em></p>
<h3 id="JSPåœ¨çº¿tuningæµç¨‹"><a href="#JSPåœ¨çº¿tuningæµç¨‹" class="headerlink" title="JSPåœ¨çº¿tuningæµç¨‹"></a><em>JSPåœ¨çº¿tuningæµç¨‹</em></h3><ol>
<li><em>PCç«¯è¿è¡ŒControl Toolï¼Œé€šè¿‡GUIç•Œé¢è¿›è¡Œtuningæ“ä½œï¼Œå¹¶é€šè¿‡Ethernetä¸‹å‘è®¿é—®æ§åˆ¶å‘½ä»¤ï¼Œè®¿é—®J5 ISP</em></li>
<li><em>Hobotplayeré€šè¿‡Ethernetè·å–æ•°æ®æµã€å®ç°åœ¨çº¿æ˜¾ç¤ºï¼Œsnapshotã€ç»Ÿè®¡æ•°æ®åˆ†æç­‰åŠŸèƒ½</em></li>
</ol>
<p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230413110012436.png"
                      class="" title="image-20230413110012436"
                ></em></p>
<h1 id="J5-ISPç³»ç»Ÿé©±åŠ¨å®ç°ä»‹ç»"><a href="#J5-ISPç³»ç»Ÿé©±åŠ¨å®ç°ä»‹ç»" class="headerlink" title="J5 ISPç³»ç»Ÿé©±åŠ¨å®ç°ä»‹ç»"></a><em>J5 ISPç³»ç»Ÿé©±åŠ¨å®ç°ä»‹ç»</em></h1><h2 id="ISPé©±åŠ¨è½¯ä»¶æ•´ä½“æ¡†æ¶"><a href="#ISPé©±åŠ¨è½¯ä»¶æ•´ä½“æ¡†æ¶" class="headerlink" title="ISPé©±åŠ¨è½¯ä»¶æ•´ä½“æ¡†æ¶"></a><em>ISPé©±åŠ¨è½¯ä»¶æ•´ä½“æ¡†æ¶</em></h2><p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230413141440552.png"
                      class="" title="image-20230413141440552"
                ></em></p>
<h3 id="ISPé©±åŠ¨æ¡†æ¶"><a href="#ISPé©±åŠ¨æ¡†æ¶" class="headerlink" title="ISPé©±åŠ¨æ¡†æ¶"></a><em>ISPé©±åŠ¨æ¡†æ¶</em></h3><ul>
<li><em>ISP driverè´Ÿè´£åŠ è½½ISPç³»ç»Ÿèµ„æºï¼Œå¹¶é€šè¿‡apiå®ç°å¯¹ISPçŠ¶æ€æœºçš„è½®è½¬ï¼Œç¡®ä¿ç³»ç»Ÿæ­£å¸¸è¿è¡Œ</em></li>
<li><em>åŒæ—¶æ”¯æŒcontrol toolsæˆ–è€…é€šè¿‡command apiå®ç°å¯¹ISPè½¯ç¡¬ä»¶æ§åˆ¶</em></li>
</ul>
<p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230413141950166.png"
                      class="" title="image-20230413141950166"
                ></em></p>
<h3 id="ISP-è®¾å¤‡æ¥å…¥æ€»ä½“é€šè·¯"><a href="#ISP-è®¾å¤‡æ¥å…¥æ€»ä½“é€šè·¯" class="headerlink" title="ISP è®¾å¤‡æ¥å…¥æ€»ä½“é€šè·¯"></a><em>ISP è®¾å¤‡æ¥å…¥æ€»ä½“é€šè·¯</em></h3><ul>
<li><em>æ”¯æŒlocal sensorå’Œremote sensorä¸¤ç§è¿æ¥æ–¹å¼æ¥å…¥ISPï¼Œæ¥å…¥çš„æ–¹å¼ä¸åŒå¤„ç†çš„æµç¨‹ä¹Ÿä¸ä¸€æ ·ã€‚å…·ä½“æ¥è¯´local sensorçš„æ•°æ®è¦é€šè¿‡inputæ”¾åˆ°raw bufferï¼›è€ŒRremote sensorä¼šç›´æ¥å°†æ•°æ®æ”¾åˆ°bufferä¸­</em></li>
<li><em>é€šè¿‡å»ºç«‹client&#x2F;server socketé€šä¿¡ï¼Œæ”¯æŒcontrol toolsçš„tuningè°ƒè¯•</em></li>
</ul>
<p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230413142430330.png"
                      class="" title="image-20230413142430330"
                ></em></p>
<blockquote>
<p><em>local  sensorçš„æ•°æ®å¤„ç†æµç¨‹</em></p>
</blockquote>
<p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230413142924688.png"
                      class="" title="image-20230413142924688"
                ></em></p>
<p><em>æ³¨æ„ï¼šISP out bufferï¼šé™¤äº†æ”¯æŒå•ç‹¬çš„æ•°æ®è¾“å‡ºå¤–ï¼Œè¿˜å¯æ”¯æŒåŒæ—¶è¾“å…¥rawå’ŒYUVæ•°æ®ï¼Œä¾¿äºè°ƒè¯•é—®é¢˜</em></p>
<h2 id="ISPé©±åŠ¨äº‹ä»¶ã€çŠ¶æ€æœºã€çº¿ç¨‹è°ƒåº¦ä»‹ç»"><a href="#ISPé©±åŠ¨äº‹ä»¶ã€çŠ¶æ€æœºã€çº¿ç¨‹è°ƒåº¦ä»‹ç»" class="headerlink" title="ISPé©±åŠ¨äº‹ä»¶ã€çŠ¶æ€æœºã€çº¿ç¨‹è°ƒåº¦ä»‹ç»"></a><em>ISPé©±åŠ¨äº‹ä»¶ã€çŠ¶æ€æœºã€çº¿ç¨‹è°ƒåº¦ä»‹ç»</em></h2><h3 id="ISPé©±åŠ¨ä¸­æ–­äº‹ä»¶"><a href="#ISPé©±åŠ¨ä¸­æ–­äº‹ä»¶" class="headerlink" title="ISPé©±åŠ¨ä¸­æ–­äº‹ä»¶"></a><em>ISPé©±åŠ¨ä¸­æ–­äº‹ä»¶</em></h3><p><em>ISPæ”¯æŒçš„ä¸­æ–­å¦‚ä¸‹å›¾ï¼š</em></p>
<ul>
<li><em>å®é™…ä¸Šåªä½¿ç”¨äº†mcfeå’Œmcbeçš„ä¸­æ–­</em></li>
<li><em>ç»Ÿè®¡æ•°æ®çš„ä¸­æ–­æŒ‚è½½åœ¨mcbe endä¸­ä¸€èµ·è§¦å‘äº‹ä»¶ã€‚<strong>æ‰“å¼€ä»¥åä¼šå¢åŠ cpuçš„è´Ÿæ‹…</strong></em></li>
</ul>
<p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230413143449313.png"
                      class="" title="image-20230413143449313"
                ></em></p>
<p><em>ISPçš„äº‹ä»¶å¦‚ä¸‹å›¾ï¼š</em></p>
<p><em>ISPçš„å·¥ä½œé€šè¿‡äº‹ä»¶æ¥æ¨åŠ¨å„æ¨¡å—çš„çŠ¶æ€æœºè½®è½¬</em></p>
<p><em>åå°çº¿ç¨‹æ¯éš”1msæˆ–è€…æœ‰ä¿¡å·æ¥æ—¶ä¼šå¤„ç†event queueäº‹ä»¶ï¼Œé€šè¿‡äº‹ä»¶æ¨åŠ¨ISPæ‰€æœ‰æ¨¡å—çš„çŠ¶æ€æœºè½®è½¬</em></p>
<p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230413143747621.png"
                      class="" title="image-20230413143747621"
                ></em></p>
<h3 id="ISP-FSMçŠ¶æ€æœºè½®è½¬"><a href="#ISP-FSMçŠ¶æ€æœºè½®è½¬" class="headerlink" title="ISP FSMçŠ¶æ€æœºè½®è½¬"></a><em>ISP FSMçŠ¶æ€æœºè½®è½¬</em></h3><ul>
<li><em>ä¸‹å›¾çš„çŠ¶æ€æœºä»…æ˜¯åŸºç¡€çš„çŠ¶æ€æœº</em></li>
<li><em>åˆå§‹åŒ–è¿‡ç¨‹ä¼šå°†æ¯ä¸ªå­æ¨¡å—çš„çŠ¶æ€æ¨è¿›readyçŠ¶æ€åï¼ŒISPåˆ™å¯å®æ—¶çš„å¯¹è¾“å…¥çš„æ•°æ®è¿›è¡Œå¤„ç†</em></li>
<li><em>æ¯ä¸ªå­æ¨¡å—çš„çŠ¶æ€æœºä¸å®Œå…¨ä¸€è‡´</em></li>
<li><em>åªæœ‰æ¨¡å—éœ€è¦è°ƒæ•´çš„æ—¶å€™æ‰åœ¨å¯¹åº”çŠ¶æ€æœºä¸‹è¿›è¡Œå¤„ç†</em></li>
</ul>
<p> <em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230413144303859.png"
                      class="" title="image-20230413144303859"
                ></em></p>
<h3 id="ISPäº‹ä»¶è½®è½¬"><a href="#ISPäº‹ä»¶è½®è½¬" class="headerlink" title="ISPäº‹ä»¶è½®è½¬"></a><em>ISPäº‹ä»¶è½®è½¬</em></h3><ul>
<li><em>äº‹ä»¶çš„è½®è½¬æ˜¯åŒingè¿‡è½¯ä»¶çš„æ–¹å¼æ¥å®ç°</em></li>
<li><em>è½¯ä»¶æ ¹æ®æ”¶åˆ°çš„äº‹ä»¶å“åº”å¯¹åº”çš„å¤„ç†æµç¨‹ã€‘</em></li>
<li><em>å›¾ä¸­ä»¥åˆå§‹åŒ–å’ŒMCBE ENDäº‹ä»¶ä¸¾ä¾‹è¯´æ˜</em></li>
</ul>
<p><em>æµç¨‹ï¼šISP Driverä¼šé¦–å…ˆé€šè¿‡configå’Œstartäº‹ä»¶åˆå§‹åŒ–HWå’Œreload  calibrationï¼Œå†é€šè¿‡å…¶ä»–äº‹ä»¶å¯¹sensoræˆ–è€…bufferç­‰è¿›è¡Œè°ƒæ•´</em></p>
<p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230413145208674.png"
                      class="" title="image-20230413145208674"
                ></em></p>
<h3 id="ISPé©±åŠ¨çº¿ç¨‹"><a href="#ISPé©±åŠ¨çº¿ç¨‹" class="headerlink" title="ISPé©±åŠ¨çº¿ç¨‹"></a><em>ISPé©±åŠ¨çº¿ç¨‹</em></h3><ul>
<li><p><em>ISPåˆå§‹åŒ–åï¼Œé™¤äº†è¿è¡Œçš„ä¸»çº¿ç¨‹å¤–è¿˜ä¼šè¿è¡Œ3ä¸ªåå°çº¿ç¨‹ï¼šisp_process_threadï¼Œisp_connection_threadï¼Œä¸­æ–­ä¸‹åŠéƒ¨çº¿ç¨‹ï¼ˆè¿›è¡Œé˜»å¡è‡ªæ£€ï¼‰</em></p>
</li>
<li><p><em>ISP_process_threadçº¿ç¨‹ç”±ä¿¡å·é‡é©±åŠ¨ï¼Œä¼šæ¯éš”1msä»message queueè·å–eventå¹¶å¯¹eventè¿›è¡Œå¤„ç†</em></p>
</li>
<li><p><em>isp_connect_threadï¼šåˆå§‹åŒ–socketï¼Œå¹¶ç›‘å¬ç«¯å£ä¿¡æ¯ï¼Œå½“æ”¶åˆ°ä¿¡æ¯åï¼Œè§£æå¹¶å¤„ç†ä¿¡æ¯ï¼Œä¸»è¦æ˜¯ç»™control toolä½¿ç”¨çš„</em></p>
</li>
<li><p><em>ä¸­æ–­ä¸‹åŠéƒ¨çº¿ç¨‹ä¼šæ ¹æ®ä¸­æ–­äº‹ä»¶ä¸‹å‘ä¸åŒçš„eventç»™isp process threadè¿›è¡Œå¤„ç†</em></p>
</li>
</ul>
<p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230413145942257.png"
                      class="" title="image-20230413145942257"
                ></em></p>
<h2 id="ISPå†…å­˜ç®¡ç†"><a href="#ISPå†…å­˜ç®¡ç†" class="headerlink" title="ISPå†…å­˜ç®¡ç†"></a><em>ISPå†…å­˜ç®¡ç†</em></h2><h3 id="ISPé©±åŠ¨å†…å­˜ç©ºé—´"><a href="#ISPé©±åŠ¨å†…å­˜ç©ºé—´" class="headerlink" title="ISPé©±åŠ¨å†…å­˜ç©ºé—´"></a><em>ISPé©±åŠ¨å†…å­˜ç©ºé—´</em></h3><ul>
<li><em>ISPå†…å­˜ä½¿ç”¨ä¸»è¦æœ‰2éƒ¨åˆ†ï¼šå­˜æ”¾æ•°æ®çš„bufferï¼Œå­˜æ”¾ä¸åŒslotçš„é…ç½®çš„CDMAæ§åˆ¶å†…å­˜</em></li>
<li><em>æ•°æ®bufferï¼š</em><ul>
<li><em>raw  bufferå’Œoutput bufferï¼Œé€šè¿‡ionçš„æ–¹å¼åˆ†é…å‡ºæ¥ï¼Œåˆ†é…çš„ä¸ªæ•°ä¸æ¨¡å¼ä¸€ä¸€å¯¹åº”</em></li>
<li><em>Passthruæ¨¡å¼ä¸ºonlineæ¨¡å¼ï¼Œä¸éœ€è¦ç”³è¯·raw bufferï¼Œoutput bufferå¯é…ç½®</em></li>
<li><em>local sensoré€šè·¯éœ€è¦raw buffer2å¿«ï¼Œoutput bufferå¯é…ç½®</em></li>
<li><em>remote sensoré€šè·¯éœ€è¦raw buffer8å—ï¼Œæ¶‰åŠåˆ°å‰å‡ æ¨¡å—çš„è½®è½¬ï¼Œoutput bufferå¯é…ç½®</em></li>
</ul>
</li>
</ul>
<p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230413150709408.png"
                      class="" title="image-20230413150709408"
                ></em></p>
<ul>
<li><em><strong>CDMAï¼š</strong></em><ul>
<li><em>é€šè¿‡ION bufferï¼Œé©±åŠ¨åŠ è½½æ—¶åˆ†é…</em> </li>
<li><em>å•ä¸ªISPå¯ä»¥æ”¯æŒ8è·¯æ•°æ®ï¼Œæ¯ä¸€è·¯æ•°æ®ä¼šæœ‰ä¸€ä¸ªç§æœ‰çš„cdmaç©ºé—´</em></li>
<li><em>ç”¨äºåœ¨ISPå¯¹ä¸åŒçš„ctxè¿›è¡Œåˆ‡æ¢å¤„ç†æ—¶ï¼Œå­˜æ”¾å¤„ç†å½“å‰å¯¹åº”ctxçš„å¯„å­˜å™¨ç©ºé—´å€¼</em></li>
</ul>
</li>
</ul>
<p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230413151331021.png"
                      class="" title="image-20230413151331021"
                ></em></p>
<h2 id="ISPæ•°æ®å¤„ç†æµç¨‹"><a href="#ISPæ•°æ®å¤„ç†æµç¨‹" class="headerlink" title="ISPæ•°æ®å¤„ç†æµç¨‹"></a><em>ISPæ•°æ®å¤„ç†æµç¨‹</em></h2><h3 id="ISPç»Ÿè®¡æ•°æ®æ›´æ–°æµç¨‹"><a href="#ISPç»Ÿè®¡æ•°æ®æ›´æ–°æµç¨‹" class="headerlink" title="ISPç»Ÿè®¡æ•°æ®æ›´æ–°æµç¨‹"></a><em>ISPç»Ÿè®¡æ•°æ®æ›´æ–°æµç¨‹</em></h3><p><em>æ•°æ®é€šè·¯æµç¨‹ï¼š</em></p>
<ol>
<li><em>ç»Ÿè®¡æ•°æ®ä¸­æ–­äº‹ä»¶ä¸ŠæŠ¥åä¼šè§¦å‘å¯¹åº”çš„è½¯ä»¶äº‹ä»¶ï¼ŒISP process queueä¼šå¤„ç†å¯¹åº”çš„äº‹ä»¶</em></li>
<li><em>2aé€šè¿‡sbuf readåˆ°å¯¹åº”çš„æ•°æ®åè¿›è¡Œè®¡ç®—ï¼Œè®¡ç®—å®Œæˆåé€šè¿‡writeå¯¹åº”ç»“æœï¼ŒåŒæ—¶è§¦å‘å¯¹åº”çš„äº‹ä»¶</em></li>
<li><em>äº‹ä»¶æ¨åŠ¨åç»­çš„æµç¨‹æœ€ç»ˆé€šè¿‡æ³¨å†Œçš„sensor callbackå‡½æ•°å°†ç»“æœä¸‹å‘åˆ°sensor Hw</em></li>
</ol>
<p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230413152206939.png"
                      class="" title="image-20230413152206939"
                ></em></p>
<h3 id="ISP-command-APIæµç¨‹ï¼ˆæ¨åŠ¨äº‹ä»¶ï¼Œæ·»åŠ äº‹ä»¶ï¼‰"><a href="#ISP-command-APIæµç¨‹ï¼ˆæ¨åŠ¨äº‹ä»¶ï¼Œæ·»åŠ äº‹ä»¶ï¼‰" class="headerlink" title="ISP command APIæµç¨‹ï¼ˆæ¨åŠ¨äº‹ä»¶ï¼Œæ·»åŠ äº‹ä»¶ï¼‰"></a><em>ISP command APIæµç¨‹ï¼ˆæ¨åŠ¨äº‹ä»¶ï¼Œæ·»åŠ äº‹ä»¶ï¼‰</em></h3><ul>
<li><em>context_params.cä¸­å‡ºæ³¨å†Œäº†æ‰€æœ‰æ”¯æŒçš„apiæ•°æ®</em></li>
<li><em>æ¯ä¸ªå¯¹è±¡åŒ…å«å¦‚ä¸‹å‚æ•°</em></li>
</ul>
<p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230413153249502.png"
                      class="" title="image-20230413153249502"
                ></em></p>
<p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230413153256246.png"
                      class="" title="image-20230413153256246"
                ></em></p>
<p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230413153545992.png"
                      class="" title="image-20230413153545992"
                ></em></p>
<h3 id="ISP-command-apiç±»å‹"><a href="#ISP-command-apiç±»å‹" class="headerlink" title="ISP command apiç±»å‹"></a><em>ISP command apiç±»å‹</em></h3><ul>
<li><em>Command apiä¸­çš„idæ—¶éœ€è¦è½¬æ¢çš„ï¼Œå¦‚æœéœ€è¦é¢å¤–æ·»åŠ command apiçš„è½¬æ¢çš„å…³ç³»å¦‚ä¸‹</em></li>
<li><em>å¯¹å¤–æš´éœ²çš„æ¥å£ä¸ºcommand listï¼Œcommand listé€šè¿‡idè½¬æ¢å‡½æ•°ï¼Œå°†å¯¹åº”çš„idè½¬åŒ–èƒ½ISP idæˆ–è€…context id</em></li>
<li><em>å°†è·å–åˆ°çš„å¯¹åº”çš„idè°ƒç”¨ä¸åŒçš„æ–¹æ³•è¿›è¡Œè®¾ç½®å’Œå¤„ç†</em></li>
</ul>
<p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230413154243974.png"
                      class="" title="image-20230413154243974"
                ></em></p>
<h3 id="ISPé©±åŠ¨å¤„ç†æ—¶åºæµç¨‹"><a href="#ISPé©±åŠ¨å¤„ç†æ—¶åºæµç¨‹" class="headerlink" title="ISPé©±åŠ¨å¤„ç†æ—¶åºæµç¨‹"></a><em>ISPé©±åŠ¨å¤„ç†æ—¶åºæµç¨‹</em></h3><p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230413154841706.png"
                      class="" title="image-20230413154841706"
                ></em></p>
<h1 id="J5-Tuningå‡†å¤‡å·¥ä½œä»‹ç»"><a href="#J5-Tuningå‡†å¤‡å·¥ä½œä»‹ç»" class="headerlink" title="J5 Tuningå‡†å¤‡å·¥ä½œä»‹ç»"></a><em>J5 Tuningå‡†å¤‡å·¥ä½œä»‹ç»</em></h1><h2 id="AE-x2F-AWBä»‹ç»"><a href="#AE-x2F-AWBä»‹ç»" class="headerlink" title="AE&#x2F;AWBä»‹ç»"></a><em>AE&#x2F;AWBä»‹ç»</em></h2><h3 id="ç»Ÿè®¡æ•°æ®"><a href="#ç»Ÿè®¡æ•°æ®" class="headerlink" title="ç»Ÿè®¡æ•°æ®"></a><em>ç»Ÿè®¡æ•°æ®</em></h3><p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230413155947281.png"
                      class="" title="image-20230413155947281"
                ></em></p>
<p><em>AWB ã€AE-5binæ•°æ®ï¼šåˆ†å—æ•°æ®ï¼Œå¯ä»¥ä»å¤šä¸ªèŠ‚ç‚¹è¾“å‡ºï¼Œä¸”å…·æœ‰ä¸åŒçš„ç‰¹æ€§</em></p>
<p><em>AE-1024binï¼šåˆ†å—åˆ†é…æƒé‡ï¼Œä»è€Œæ§åˆ¶ä¸åŒçš„æµ‹å…‰æ¨¡å¼</em></p>
<h3 id="AEä»‹ç»"><a href="#AEä»‹ç»" class="headerlink" title="AEä»‹ç»"></a><em>AEä»‹ç»</em></h3><p><em>è‡ªåŠ¨æ›å…‰ç®—æ³•çš„ç›®çš„æ˜¯æ ¹æ®åœºæ™¯çš„å…‰çº¿æ¡ä»¶è‡ªåŠ¨è°ƒæ•´æ‘„åƒæœºçš„æ›å…‰æ—¶é—´ï¼Œä»¥è·å¾—æœ€ä½³çš„å›¾åƒè´¨é‡ã€‚</em></p>
<ol>
<li><em>è·å–ç»Ÿè®¡æ•°æ®</em></li>
<li><em>ä¼°è®¡å½“å‰ç”»é¢äº®åº¦</em></li>
<li><em>è°ƒæ•´å½“å‰targetç›®æ ‡</em></li>
<li><em>æ ¹æ®targetåŠç”»é¢äº®åº¦è®¡ç®—evå€¼</em></li>
<li><em>æ ¹æ®è¡¥å……è°ƒæ•´evå€¼</em></li>
<li><em>æ ¹æ®partion_lutè¡¨åˆ†é…gainå’Œline</em></li>
<li><em>æ§åˆ¶sensoræ›å…‰</em></li>
</ol>
<p><em><strong>æ³¨æ„ï¼šAEæ›å…‰å‚æ•°å†™è§¦å‘æ¡ä»¶ä¸ºframe_startï¼ˆå›¾ç‰‡æ¥çš„æ—¶å€™ï¼‰ï¼Œframe_outè·å–ç»Ÿè®¡æ•°æ®</strong></em> </p>
<p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230413160926541.png"
                      class="" title="image-20230413160926541"
                ></em></p>
<h3 id="AEæµ‹å…‰æ–¹å¼"><a href="#AEæµ‹å…‰æ–¹å¼" class="headerlink" title="AEæµ‹å…‰æ–¹å¼"></a><em>AEæµ‹å…‰æ–¹å¼</em></h3><p><em>å°†ç”»é¢åˆ†æˆM</em>Nä¸ªå°åŒºå—ï¼Œæ¯ä¸ªåŒºåŸŸå¯ä»¥è®¾ç½®ä¸åŒçš„æƒé‡è¿›è¡Œç›´æ–¹å›¾ç»Ÿè®¡ï¼ˆæ ¹æ®æƒé‡é‡å¤ç»Ÿè®¡ï¼Œ0è¡¨ç¤ºä¸å‚ä¸ç»Ÿè®¡ï¼Œ1ä»£è¡¨ç»Ÿè®¡1æ¬¡ï¼Œ2ä»£è¡¨ç»Ÿè®¡2æ¬¡ï¼Œä»¥æ­¤ç±»æ¨ï¼Œ<strong>ä½†15è¡¨ç¤ºç»Ÿè®¡16æ¬¡</strong>ï¼‰ï¼Œç”¨æˆ·ä¿®æ”¹ä¸åŒçš„æƒé‡è¾¾åˆ°ä¿®æ”¹æµ‹å…‰æ–¹å¼ç›®çš„ã€‚æµ‹å…‰æ–¹å¼å¯é€‰ï¼šä¸­å¿ƒæµ‹å…‰ï¼Œå¹³å‡æµ‹å…‰ï¼ŒåŒºåŸŸæµ‹å…‰ã€‚*</p>
<p><em>æ³¨æ„ï¼šJ5æœ€å¤šæ”¯æŒ15</em>15åˆ†å—ï¼Œ<strong>åŒºåŸŸä¸­çš„æ¯ä¸€ä¸ªå°å—æœ‰ä¸åŒçš„æƒé‡ï¼Œé€šè¿‡è°ƒæ•´å„ä¸ªå°å—çš„æƒé‡æ¥è°ƒæ•´æµ‹å…‰æ–¹å¼</strong>*</p>
<p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230413162559842.png"
                      class="" title="image-20230413162559842"
                ></em></p>
<h3 id="AWBä»‹ç»"><a href="#AWBä»‹ç»" class="headerlink" title="AWBä»‹ç»"></a><em>AWBä»‹ç»</em></h3><p><em>è‡ªåŠ¨ç™½å¹³è¡¡ï¼ˆAWBï¼‰ç®—æ³•æ˜¯ä¸€ç§ç”¨äºæ•°å­—å›¾åƒå¤„ç†ä¸­çš„ç®—æ³•ï¼Œæ—¨åœ¨æ¶ˆé™¤å›¾åƒä¸­çš„é¢œè‰²åå·®ï¼Œä½¿å…¶çœ‹èµ·æ¥æ›´è‡ªç„¶ã€‚</em></p>
<p><em>awbè®¡ç®—æ–¹æ³•ï¼š</em></p>
<ol>
<li><em>æ ¹æ®é¢„å…ˆæ ‡å®šå‚æ•°ç¡®å®šç™½ç‚¹æƒé‡ï¼ˆ<strong>è®¡ç®—å›¾åƒä¸­äº®åº¦æœ€é«˜çš„åŒºåŸŸçš„RGBå€¼çš„å¹³å‡å€¼</strong>ï¼‰</em></li>
<li><em>æ ¹æ®ç»Ÿè®¡å’Œæƒé‡è®¡ç®—rgainå’Œbgainï¼ˆ<strong>æ ¹æ®ç™½å¹³è¡¡ç‚¹çš„å€¼æ¥è®¡ç®—æ¯ä¸ªé€šé“çš„å¢ç›Š</strong>ï¼‰</em></li>
<li><em>æ ¹æ®rgainå’Œbgainè®¡ç®—cctï¼ˆ<strong>å°†æ¯ä¸ªé€šé“çš„å¢ç›Šåº”ç”¨äºå›¾åƒä¸­çš„åƒç´ </strong>ï¼‰</em></li>
</ol>
<p><em>æ³¨æ„ï¼š</em></p>
<p><em>(1)rgbgwç”±mesh_rgbg_weightæ’å€¼å¾—åˆ°çš„æƒé‡</em></p>
<p><em>(2)s.ç”±mesh_ls_ weightæ’å€¼å¾—åˆ°çš„æƒé‡</em></p>
<p><em><strong>(3)cctç”±mesh_color_temperæ’å€¼å¾—åˆ°çš„è‰²æ¸©</strong></em></p>
<p><em>(4)ç”¨æˆ·å¯ä»¥é€šè¿‡ä¿®æ”¹calibrationåˆ‡æ¢é€‰æ‹©isp-awb&#x2F;sensor-awb</em></p>
<p><em>(5)AMBç®—æ³•è®¡ç®—çš„rgain&#x2F;bgainä¸º4.8format,256è¡¨ç¤º1x</em></p>
<p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230413164354215.png"
                      class="" title="image-20230413164354215"
                ></em></p>
<h2 id="sensoré©±åŠ¨å¼€å‘å’ŒéªŒè¯"><a href="#sensoré©±åŠ¨å¼€å‘å’ŒéªŒè¯" class="headerlink" title="sensoré©±åŠ¨å¼€å‘å’ŒéªŒè¯"></a><em>sensoré©±åŠ¨å¼€å‘å’ŒéªŒè¯</em></h2><h3 id="sensoré©±åŠ¨å®ç°"><a href="#sensoré©±åŠ¨å®ç°" class="headerlink" title="sensoré©±åŠ¨å®ç°"></a><em>sensoré©±åŠ¨å®ç°</em></h3><p><em>å¯¹äºRAWç±»å‹çš„æ¨¡ç»„ï¼Œè¿˜éœ€è¿›è¡Œtuningé€‚é…ï¼Œå®ç°AE&#x2F;AWBç­‰æ§åˆ¶åŠŸèƒ½ï¼Œä»¥é…åˆISPå®Œæˆæ•ˆæœè°ƒèŠ‚ã€‚VINæä¾›æœ‰2ç§æœºåˆ¶ï¼Œæ ¹æ®sensoråŠŸèƒ½é€‰æ‹©å¹¶å®ç°ã€‚</em></p>
<p><em>é©±åŠ¨å±‚æ§åˆ¶ï¼šæ ‡å‡†åŒ–æ§åˆ¶æ–¹å¼ï¼ˆLUTé…ç½®å½¢å¼ï¼‰ï¼šSensoråˆå§‹åŒ–æ—¶ioctlä¸‹å‘sensor_trning_dat_tï¼›</em></p>
<p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230413190222405.png"
                      class="" title="image-20230413190222405"
                ></em></p>
<p><em>ç”¨æˆ·å±‚æ§åˆ¶ï¼šå®šåˆ¶åŒ–æ§åˆ¶æ–¹å¼ï¼ˆAPIæ“ä½œå½¢å¼ï¼‰ï¼šSensoråº“userpace_controlä½¿èƒ½å¹¶å®ç°API</em></p>
<p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230413190239065.png"
                      class="" title="image-20230413190239065"
                ></em></p>
<h3 id="sensoré©±åŠ¨ä»‹ç»"><a href="#sensoré©±åŠ¨ä»‹ç»" class="headerlink" title="sensoré©±åŠ¨ä»‹ç»"></a><em>sensoré©±åŠ¨ä»‹ç»</em></h3><p> <em>ç±»å‹ä¸€ï¼šè¯¥ç±»å‹sensorä»…éœ€è¦è®¾ç½®é•¿å¸§ï¼ˆæˆ–çŸ­å¸§ï¼‰çš„lineå’Œgainï¼Œå…¶ä»–å¸§çš„æ›å…‰å‚æ•°æ ¹æ®å›ºå®šçš„ratioè®¡ç®—ä¸”awdä¸éœ€è¦è€ƒè™‘ä¸åŒè‰²æ¸©ä¸‹è°ƒæ•´å‚æ•°ã€‚è¯¥å‹sensorå»ºè®®ä½¿ç”¨é©±åŠ¨å±‚æ§åˆ¶æ–¹å¼</em></p>
<p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230413191906143.png"
                      class="" title="image-20230413191906143"
                ></em></p>
<p><em>ç±»å‹äºŒï¼šè¯¥ç±»å‹sensoréœ€è¦è®¾ç½®çš„ä¸‰å¸§çš„lineå’Œgainéƒ½éœ€è¦ç”¨æˆ·è®¾ç½®ï¼Œå…¶ä»–å¸§çš„æ›å…‰å‚æ•°æ ¹æ®é•¿å¸§æˆ–çŸ­å¸§æ ¹æ®ä¸€å®šçš„è®¡ç®—æ–¹å¼å¾—å‡ºï¼Œæˆ–awdéœ€è¦è€ƒè™‘ä¸åŒè‰²æ¸©ä¸‹è°ƒæ•´å‚æ•°ã€‚è¯¥å‹sensorå»ºè®®ä½¿ç”¨ç”¨æˆ·å±‚æ§åˆ¶æ–¹å¼</em></p>
<p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230413191917441.png"
                      class="" title="image-20230413191917441"
                ></em></p>
<p><em><strong>sensoré©±åŠ¨æœ‰ä¸€äº›å…³é”®å­—æ®µè¡¨å¾è¯¥sensoråœ¨è¯¥é…ç½®ä¸‹çš„ç¡¬ä»¶ç‰¹æ€§ï¼ŒISPä½¿ç”¨é©±åŠ¨æ—¶å¿…é¡»éµå¾ªä»¥ä¸‹å‚æ•°</strong></em></p>
<p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230413192524229.png"
                      class="" title="image-20230413192524229"
                ></em></p>
<h3 id="é©±åŠ¨å±‚æ§åˆ¶å®ç°"><a href="#é©±åŠ¨å±‚æ§åˆ¶å®ç°" class="headerlink" title="é©±åŠ¨å±‚æ§åˆ¶å®ç°"></a><em>é©±åŠ¨å±‚æ§åˆ¶å®ç°</em></h3><p> <em><strong>é©±åŠ¨å±‚æ§åˆ¶sensor-ae&#x2F;awdéœ€è¦å»ºç«‹ispç®—æ³•è®¡ç®—å¾—å‡ºçš„ae&#x2F;awdå‚æ•°ä¸sensorå¯„å­˜å™¨æ˜ å°„è½¬æ¢</strong></em></p>
<p><em>sensor lutè¡¨ï¼šä¸åŒgain_indexå¯¹åº”çš„å¯„å­˜å™¨å€¼ï¼Œagain_indexå–å€¼èŒƒå›´[0ï¼Œ255]ï¼Œçš„gainindexå–å€¼èŒƒå›´[0,255]</em></p>
<p><em>sensor lineé…ç½®ï¼šè¡Œè½¬æ¢å¯„å­˜å™¨å€¼è®¡ç®—æ–¹å¼ï¼ˆ<strong>å°†aeçš„è¡Œå‚æ•°è½¬æ¢ä¸ºsensorå®é™…çš„å¯„å­˜å™¨å‚æ•°</strong>ï¼‰ï¼š*<em>xè¡¨ç¤ºaeç®—æ³•è®¡ç®—çš„æ›å…‰è¡Œï¼Œyè¡¨ç¤ºè¯¥è¡Œå¯¹åº”çš„å¯„å­˜å™¨å‚æ•°</em></em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230413193303925.png"
                      class="" title="image-20230413193303925"
                >*</p>
<h3 id="ç”¨æˆ·å±‚æ§åˆ¶å®ç°"><a href="#ç”¨æˆ·å±‚æ§åˆ¶å®ç°" class="headerlink" title="ç”¨æˆ·å±‚æ§åˆ¶å®ç°"></a><em>ç”¨æˆ·å±‚æ§åˆ¶å®ç°</em></h3><p><em>APIå‡½æ•°ï¼š</em></p>
<ul>
<li><em>moduleï¼šåç§°å­—ç¬¦ä¸²ï¼Œç”¨äºåŒºåˆ†ä¸åŒçš„sensor</em><ul>
<li><em>userpace_controlï¼šä½¿èƒ½halå±‚æ§åˆ¶æ¨¡å—</em></li>
<li><em>aexp_line_gain_controlï¼šhalå±‚aeæ§åˆ¶ï¼Œè·å–çŸ­å¸§ï¼ˆé•¿å¸§ï¼‰çš„æ§åˆ¶å‚æ•°gainå’Œlineï¼Œè½¬æ¢ä¸ºsensoræ§åˆ¶å‚æ•°</em></li>
<li><em>wb_cct_controlï¼šhalå±‚awbæ§åˆ¶ï¼Œè·å–awbä¿¡æ¯è½¬æ¢ä¸ºsensoræ§åˆ¶å‚æ•°</em></li>
<li><em>æ³¨æ„ï¼šaexp_line_gain_controlå’Œwb_cct_controlå‡½æ•°çš„é•¿å¸§&#x2F;çŸ­å¸§éœ€è¦tuningç­–ç•¥å†³å®šï¼Œè®¡ç®—æ–¹å¼éœ€è¦faeæä¾›æ‰‹å†Œ</em></li>
</ul>
</li>
</ul>
<h3 id="sensoré©±åŠ¨éªŒè¯"><a href="#sensoré©±åŠ¨éªŒè¯" class="headerlink" title="sensoré©±åŠ¨éªŒè¯"></a><em>sensoré©±åŠ¨éªŒè¯</em></h3><p> <em>é©±åŠ¨å±‚å®ç°æˆ–ç”¨æˆ·å±‚å®ç°æ§åˆ¶åï¼Œéœ€è¦å¯¹AEé©±åŠ¨å’ŒAWBé©±åŠ¨çš„è¿è¡Œç»“æœè¿›è¡ŒéªŒè¯</em></p>
<p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230413202351846.png"
                      class="" title="image-20230413202351846"
                ></em></p>
<h2 id="Tuningå·¥å…·ä½¿ç”¨ä»‹ç»"><a href="#Tuningå·¥å…·ä½¿ç”¨ä»‹ç»" class="headerlink" title="Tuningå·¥å…·ä½¿ç”¨ä»‹ç»"></a><em>Tuningå·¥å…·ä½¿ç”¨ä»‹ç»</em></h2><p><em>tuningå·¥å…·åŒ…æ‹¬calibration toolã€‚control toolå’ŒHobotplayerå·¥å…·</em></p>
<ul>
<li><em>Calibration Tool å·¥å…·ä¸ºé™æ€æ ‡å®šå·¥å…·ï¼Œç”¨äºå‚æ•°æ ‡å®šç”Ÿæˆstatic.json</em></li>
<li><em>Control Toolä¸ºåœ¨çº¿è°ƒè¯•å·¥å…·ï¼Œç”¨æˆ·ä½¿ç”¨è¯¥å·¥å…·æŸ¥çœ‹&#x2F;ä¿®æ”¹å‚æ•°</em></li>
<li><em>HobotPlayerä¸ºåœ¨çº¿è°ƒè¯•å·¥å…·ï¼Œç”¨æˆ·ä½¿ç”¨è¯¥å·¥å…·æŸ¥çœ‹å®æ–½æ•ˆæœï¼Œä¿å­˜å›¾åƒ</em></li>
</ul>
<p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230413203431146.png"
                      class="" title="image-20230413203431146"
                ></em></p>
<p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230413203610737.png"
                      class="" title="image-20230413203610737"
                ></em></p>
<h3 id="Control-Tool"><a href="#Control-Tool" class="headerlink" title="Control Tool"></a><em>Control Tool</em></h3><p><em>æ¨¡å—ï¼š</em></p>
<ul>
<li><em>Hardwareï¼šæŸ¥çœ‹&#x2F;ä¿®æ”¹å„å­æ¨¡å—å‚æ•°</em></li>
<li><em>APIï¼šæŸ¥çœ‹&#x2F;ä¿®æ”¹Firewareå‚æ•°</em></li>
<li><em>Calibrationï¼šæŸ¥çœ‹&#x2F;ä¿®æ”¹Calibration-lutå‚æ•°</em></li>
</ul>
<p><em>åŠŸèƒ½æè¿°ï¼š</em></p>
<ul>
<li><em>å‚æ•°ä¿å­˜ï¼šå­˜å‚¨hardwareå¯„å­˜å™¨å‚æ•°ã€å­˜å‚¨Fireware APIå‚æ•°ã€å­˜å‚¨calibration-lutè¡¨</em></li>
<li><em>é¡µé¢é‡å»ºï¼šUpload New XML Fileï¼›Upload New Software APi</em></li>
<li><em>ç´¢å¼•ï¼šæœç´¢å…³é”®è¯</em></li>
<li><em>æ ‡è®°ï¼šæ ‡è®°ç›¸å…³é¡¹ï¼Œåœ¨æ ‡è®°é¡µç»Ÿä¸€æ˜¾ç¤º</em></li>
</ul>
<p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230413205313414.png"
                      class="" title="image-20230413205313414"
                ></em></p>
<h3 id="HobotPlayer"><a href="#HobotPlayer" class="headerlink" title="HobotPlayer"></a><em>HobotPlayer</em></h3><p><em>ç”¨äºå®æ—¶æŸ¥çœ‹è§†é¢‘æµæ•°æ®ï¼ŒåŒæ—¶åŒ…å«ç®€å•çš„æ•°æ®åˆ†æåŠŸèƒ½</em></p>
<p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230413205449483.png"
                      class="" title="image-20230413205449483"
                ></em></p>
<p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230413205457968.png"
                      class="" title="image-20230413205457968"
                ></em></p>
<h2 id="Tuningå‚æ•°éƒ¨ç½²"><a href="#Tuningå‚æ•°éƒ¨ç½²" class="headerlink" title="Tuningå‚æ•°éƒ¨ç½²"></a><em>Tuningå‚æ•°éƒ¨ç½²</em></h2><h3 id="Tuningå‚æ•°"><a href="#Tuningå‚æ•°" class="headerlink" title="Tuningå‚æ•°"></a><em>Tuningå‚æ•°</em></h3><p><em>ISPç®—æ³•ä½¿ç”¨lutè¡¨è®°å½•è°ƒè¯•å‚æ•°ï¼Œä¸åŒè°ƒè¯•å‚æ•°å…·æœ‰ä¸åŒå‘½å</em></p>
<p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230413205808655-16813906889561.png"
                      class="" title="image-20230413205808655"
                ></em></p>
<p><em>æ³¨æ„ï¼š</em></p>
<ol>
<li><em>valueç§å…ƒç´ çš„ä¸ªæ•°ç­‰äºrow</em>cols*</li>
<li><em>widthå­—æ®µçš„æ•°æ®æ ¼å¼éœ€è¦ä¸ç³»ç»ŸåŒ¹é…ï¼Œä¸å¯ä»»æ„ä¿®æ”¹</em></li>
<li><em>å‚æ•°è·å–ï¼š</em><ul>
<li><em>æ ¹æ®å­—æ®µå«ä¹‰ï¼Œä¿®æ”¹</em>_ static.jsonå’Œ <em>_ dymanic.json</em></li>
<li><em>é€šè¿‡control_toolå¯¼å‡ºè°ƒè¯•å®Œæˆçš„calibrationå‚æ•°</em></li>
</ul>
</li>
</ol>
<p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230413210047533.png"
                      class="" title="image-20230413210047533"
                ></em></p>
<h3 id="Tuningå‚æ•°ç¼–è¯‘"><a href="#Tuningå‚æ•°ç¼–è¯‘" class="headerlink" title="Tuningå‚æ•°ç¼–è¯‘"></a><em>Tuningå‚æ•°ç¼–è¯‘</em></h3><ul>
<li><em>ç¼–è¯‘ç›®å½•ï¼š<code>j5_dvb/hbre/libisp/j5/tuning/caldata/generate_lib</code></em></li>
<li><em>ç¼–è¯‘å‡†å¤‡ï¼šcontrol_toolå¯¼å‡ºçš„æ–‡ä»¶åç§°ç§°ä¸ºdynamic.jsonå’Œstatic.jsonï¼Œç¼–è¯‘æ—¶ç³»ç»Ÿä¼šç´¢å¼•å‚æ•°åº“åç§°çš„å‰ç¼€å‘½ååŠ¨æ€åº“åç§°</em></li>
</ul>
<p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230413210614098.png"
                      class="" title="image-20230413210614098"
                ></em></p>
<ul>
<li><em>ç¼–è¯‘æ£€æŸ¥ï¼šå‚æ•°ç¼–è¯‘æ—¶ä¼šè‡ªåŠ¨æ£€æŸ¥calibration_widthå®šä¹‰æ˜¯å¦æ­£ç¡®ï¼Œå½“å®šä¹‰ä¸æ­£ç¡®æ—¶éœ€è¦æ‰‹åŠ¨ä¿®æ”¹ï¼Œé¿å…å½±å“ç³»ç»Ÿç¨³å®šæ€§ã€‚ç”¨æˆ·æ‰§è¡Œmakeåéœ€è¦æ£€æŸ¥ç¼–è¯‘logæ˜¯å¦åŒ…å«erroré”™è¯¯</em></li>
</ul>
<p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230413210812784.png"
                      class="" title="image-20230413210812784"
                ></em></p>
<h3 id="Tuningå‚æ•°éƒ¨ç½²-1"><a href="#Tuningå‚æ•°éƒ¨ç½²-1" class="headerlink" title="Tuningå‚æ•°éƒ¨ç½²"></a><em>Tuningå‚æ•°éƒ¨ç½²</em></h3><ul>
<li><em>å‚æ•°éƒ¨ç½²ï¼šç¼–è¯‘å®Œæˆå‚æ•°åº“lib</em>.soåæ”¾å…¥J5æ¿ä¾§ï¼ˆboardï¼‰ï¼Œåœ¨å¯åŠ¨jsonä¸­æŒ‡å®šç»å¯¹è·¯å¾„å’Œå‚æ•°åº“åç§°ï¼ˆvpm_config.jsonä¸­çš„ISPé…ç½®éƒ¨åˆ†ï¼‰å¹¶å¼€å¯åŠŸèƒ½ï¼ˆcalib_mode&#x3D;1ï¼‰ï¼Œç³»ç»Ÿå¯åŠ¨æ—¶åˆ™è‡ªåŠ¨åŠ è½½è¯¥calibrationå‚æ•°åº“*</li>
</ul>
<p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230414081802204-16814314824862.png"
                      class="" title="image-20230414081802204"
                ></em></p>
<ul>
<li><em>å‚æ•°æ ¸å¯¹ï¼šç³»ç»Ÿå¯åŠ¨åæ‰“å¼€control_toolå·¥å…·æŸ¥çœ‹version_infoï¼Œæ£€æŸ¥æ˜¯å¦æ˜¯ç”¨æˆ·æŒ‡å®šçš„å‚æ•°åº“</em></li>
</ul>
<p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230414081944807.png"
                      class="" title="image-20230414081944807"
                ></em></p>
<p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230414082107058.png"
                      class="" title="image-20230414082107058"
                ></em></p>
<h1 id="Tuningå®æˆ˜ç»éªŒåˆ†äº«"><a href="#Tuningå®æˆ˜ç»éªŒåˆ†äº«" class="headerlink" title="Tuningå®æˆ˜ç»éªŒåˆ†äº«"></a><em>Tuningå®æˆ˜ç»éªŒåˆ†äº«</em></h1><h2 id="ISP-Feature-x2F-PipelineåŠå®¢è§‚çŸ«æ­£"><a href="#ISP-Feature-x2F-PipelineåŠå®¢è§‚çŸ«æ­£" class="headerlink" title="ISP Feature&#x2F;PipelineåŠå®¢è§‚çŸ«æ­£"></a><em>ISP Feature&#x2F;PipelineåŠå®¢è§‚çŸ«æ­£</em></h2><h3 id="ISP-Feature"><a href="#ISP-Feature" class="headerlink" title="ISP Feature"></a><em>ISP Feature</em></h3><ul>
<li><em>å†…ç½®å›¾åƒä¿¡å·å¤„ç†å™¨(Isp)æ”¯æŒRAWåˆ°YUVè½¬æ¢</em></li>
<li><em>é«˜åŠ¨æ€èŒƒå›´(HDR)ä¼ æ„Ÿå™¨æ”¯æŒ</em><ul>
<li><em>æ•°å­—é‡å (DOL)HDRä¼ æ„Ÿå™¨æ”¯æŒ(æœ€å¤š4æ¬¡æ›å…‰)</em></li>
<li><em>çº¿æ€§åŒ–HDRä¼ æ„Ÿå™¨æ”¯æŒ</em></li>
<li><em>åŸç”Ÿ(onä¼ æ„Ÿå™¨)å‹ç¼©HDRä¼ æ„Ÿå™¨æ”¯æŒ</em></li>
</ul>
</li>
<li><em>æ”¯æŒè‡ªåŠ¨æ›å…‰ï¼Œè‡ªåŠ¨ç™½å¹³è¡¡ï¼Œç›´æ–¹å›¾ç»Ÿè®¡</em></li>
<li><em>æ”¯æŒæ•°å­—åŠ¨æ€</em></li>
<li><em>æ”¯æŒé•œå¤´é˜´å½±æ ¡æ­£</em></li>
<li><em>æ”¯æŒç¼ºé™·åƒç´ æ ¡æ­£(DPC)</em></li>
<li><em>æ”¯æŒç©ºé—´é™å™ª(SINTER)</em></li>
<li><em>æ”¯æŒé”åŒ–å’Œè¾¹ç¼˜å¢å¼º</em></li>
<li><em>æ”¯æŒä¼½ç›æ ¡æ­£</em></li>
<li><em>åœ¨PCæœºä¸Šæ”¯æŒGDCå’ŒFISHEYEæ ¡æ­£ISPè°ƒä¼˜å·¥å…·</em></li>
</ul>
<h3 id="ISP-Algorithm-block-diagram-part"><a href="#ISP-Algorithm-block-diagram-part" class="headerlink" title="ISP Algorithm block diagram-part"></a><em>ISP Algorithm block diagram-part</em></h3><p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230414090204749.png"
                      class="" title="image-20230414090204749"
                ></em></p>
<p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230414090744026.png"
                      class="" title="image-20230414090744026"
                ></em></p>
<h3 id="J5-è°ƒè¯•ç¯å¢ƒåŠåŸºæœ¬æ“ä½œä»‹ç»"><a href="#J5-è°ƒè¯•ç¯å¢ƒåŠåŸºæœ¬æ“ä½œä»‹ç»" class="headerlink" title="J5 è°ƒè¯•ç¯å¢ƒåŠåŸºæœ¬æ“ä½œä»‹ç»"></a><em>J5 è°ƒè¯•ç¯å¢ƒåŠåŸºæœ¬æ“ä½œä»‹ç»</em></h3><ol>
<li><em>é‡‡é›†Rawå›¾åƒ</em></li>
<li><em>å¯¼å…¥å¯¹åº”çš„Rawå›¾åƒï¼Œä½¿ç”¨Calibration toolåˆ†æ¨¡å—æ ¡æ­£ï¼Œå¹¶äº§ç”Ÿé™æ€æ ¡æ­£å‚æ•°</em></li>
<li><em>å°†é™æ€çŸ«æ­£å‚æ•°uploadç³»ç»Ÿè½¯ä»¶åç”Ÿæ•ˆ</em></li>
<li><em>åœ¨PCç«¯ä½¿ç”¨control_toolå·¥å…·å®æ—¶è°ƒè¯•æ¨¡å—å‚æ•°éªŒè¯å›¾åƒæ•ˆæœ</em></li>
<li><em>é‡å¤ä¹‹å‰æ­¥éª¤è‡³æ•ˆæœè¾¾åˆ°éœ€æ±‚</em></li>
</ol>
<p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230414091506525.png"
                      class="" title="image-20230414091506525"
                ></em></p>
<p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230414091515257.png"
                      class="" title="image-20230414091515257"
                ></em></p>
<h3 id="Hobot-player"><a href="#Hobot-player" class="headerlink" title="Hobot player"></a><em>Hobot player</em></h3><blockquote>
<p><em>å¯åŠ¨æ•°æ®æµç¨‹;</em></p>
</blockquote>
<p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230414092121709.png"
                      class="" title="image-20230414092121709"
                ></em></p>
<blockquote>
<p><em>ä¸»ç•Œé¢</em></p>
</blockquote>
<p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230414092812821.png"
                      class="" title="image-20230414092812821"
                ></em></p>
<blockquote>
<p><em>å®æ—¶RAWé¢„è§ˆ</em></p>
</blockquote>
<p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230414093656150.png"
                      class="" title="image-20230414093656150"
                ></em></p>
<blockquote>
<p><em>Dump RAW</em></p>
</blockquote>
<p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230414093750378.png"
                      class="" title="image-20230414093750378"
                ></em></p>
<blockquote>
<p><em>é™æ€RAWé¢„è§ˆ</em></p>
</blockquote>
<p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230414093814731.png"
                      class="" title="image-20230414093814731"
                ></em></p>
<h3 id="Control-Tool-1"><a href="#Control-Tool-1" class="headerlink" title="Control Tool"></a><em>Control Tool</em></h3><p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230414094036665.png"
                      class="" title="image-20230414094036665"
                ></em></p>
<p>** </p>
<blockquote>
<p><em>gain setting</em></p>
</blockquote>
<p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230414094240554.png"
                      class="" title="image-20230414094240554"
                ></em></p>
<blockquote>
<p><em>calibration tool</em></p>
</blockquote>
<p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230414150130688.png"
                      class="" title="image-20230414150130688"
                ></em></p>
<blockquote>
<p><em>RAWæ ¼å¼è®¾ç½®</em></p>
</blockquote>
<p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230414150325417.png"
                      class="" title="image-20230414150325417"
                ></em></p>
<blockquote>
<p><em>Black level</em></p>
</blockquote>
<p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230414150440962.png"
                      class="" title="image-20230414150440962"
                ></em></p>
<blockquote>
<p><em>Gamma FE</em></p>
</blockquote>
<p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230414150603960.png"
                      class="" title="image-20230414150603960"
                ></em></p>
<blockquote>
<p><em>Mesh Shading</em></p>
</blockquote>
<p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230414150705375.png"
                      class="" title="image-20230414150705375"
                ></em></p>
<blockquote>
<p><em>Gamma</em></p>
</blockquote>
<p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230414150851796.png"
                      class="" title="image-20230414150851796"
                ></em></p>
<blockquote>
<p><em>CCM</em></p>
</blockquote>
<p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230414151011131.png"
                      class="" title="image-20230414151011131"
                ></em></p>
<blockquote>
<p><em>AWB</em></p>
</blockquote>
<p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230414151311362.png"
                      class="" title="image-20230414151311362"
                ></em></p>
<blockquote>
<p><em>NP(Noise Profile)</em></p>
</blockquote>
<p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230414191305397.png"
                      class="" title="image-20230414191305397"
                ></em></p>
<blockquote>
<p><em>CAï¼ˆè‰²å·®çŸ«æ­£ï¼‰</em></p>
</blockquote>
<p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230414191332944.png"
                      class="" title="image-20230414191332944"
                ></em></p>
<p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230414191457449.png"
                      class="" title="image-20230414191457449"
                ></em></p>
<h3 id="Tuningå‚æ•°ç¼–è¯‘-1"><a href="#Tuningå‚æ•°ç¼–è¯‘-1" class="headerlink" title="Tuningå‚æ•°ç¼–è¯‘"></a><em>Tuningå‚æ•°ç¼–è¯‘</em></h3><blockquote>
<p><em>1.ä¿å­˜calibrationçŸ«æ­£ç»“æœ</em></p>
</blockquote>
<p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230414191618474.png"
                      class="" title="image-20230414191618474"
                ></em></p>
<blockquote>
<p><em>2.å°†ä¿å­˜çš„JSONæ–‡ä»¶æ±‡æ€»åˆ°ç¼–è¯‘è·¯å¾„ä¸‹ï¼Œmakeå³å¯ç”Ÿæˆso</em>	</p>
</blockquote>
<p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230414191705921.png"
                      class="" title="image-20230414191705921"
                ></em></p>
<h2 id="Coloræ¨¡å—-AWB-x2F-CCM"><a href="#Coloræ¨¡å—-AWB-x2F-CCM" class="headerlink" title="Coloræ¨¡å—-AWB&#x2F;CCM"></a><em>Coloræ¨¡å—-AWB&#x2F;CCM</em></h2><p><em>AWBï¼š</em></p>
<ul>
<li><em>AWBé™æ€æ ¡æ­£</em></li>
<li><em>R&#x2F;Gï¼ŒB&#x2F;Gåœ¨ä¸åŒçš„å…‰æºåŠå…¸å‹åœºæ™¯ä¸‹çš„å“åº”</em></li>
<li><em>Color-preference - åè‰²å–œå¥½</em></li>
<li><em>Mixed-lightæ··å…‰å¤„ç†</em></li>
<li><em>Corner caseåœºæ™¯å¤„ç†</em></li>
<li><em>AWB parameter</em></li>
</ul>
<p><em>CCM &amp; Shadingï¼š</em></p>
<ul>
<li><em>shadingå‚æ•°åŠCCMå‚æ•°ä¸AWBè¿”å›è‰²æ¸©ç›¸å…³æ€§</em></li>
</ul>
<h3 id="AWB-Auto-white-balance-algorithm"><a href="#AWB-Auto-white-balance-algorithm" class="headerlink" title="AWB - Auto white balance algorithm"></a><em>AWB - Auto white balance algorithm</em></h3><p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230414192726981.png"
                      class="" title="image-20230414192726981"
                ></em></p>
<blockquote>
<p><em>calibration parameter</em></p>
</blockquote>
<ul>
<li><em>å¯é€‰æ‹©åœ¨â€™Demosaicâ€™æˆ–â€™CCMâ€™ä¸¤ä¸ªæ¨¡å—ä¹‹åè¿›è¡ŒAWBç»Ÿè®¡</em></li>
<li><em>ä¿®æ”¹ä½ç½®ï¼šcontrol_toolâ€”-Hardwareâ€”-Pipelineâ€”-WAB switch</em></li>
</ul>
<p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230414193205759.png"
                      class="" title="image-20230414193205759"
                ></em></p>
<blockquote>
<p><em>Metering zones and tap point</em></p>
</blockquote>
<ul>
<li><em>å·¦è¾¹æ¡†gridä¿¡æ¯ï¼šå­˜å‚¨average R&#x2F;Gã€B&#x2F;Gæˆ–è€…average G&#x2F;Rã€G&#x2F;B</em></li>
<li><em>å³è¾¹æ¡†æ˜¯å¯¹åº”çš„Gridæƒé‡å€¼ã€‚è¯¥æƒé‡å€¼ç”¨äºglobal rgain&#x2F;rgainçš„è®¡ç®—</em></li>
</ul>
<p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230414193443284.png"
                      class="" title="image-20230414193443284"
                ></em></p>
<blockquote>
<p><em>statist boundaries</em></p>
</blockquote>
<p><em>åŸºäºcolor rationå¯¹ä¸æƒ³è¦ç»Ÿè®¡çš„åŒºåŸŸæˆ–åƒç´ å‰”é™¤ï¼Œé€šè¿‡é…ç½®Control tool-Hardware-staticsä¸­å¦‚ä¸‹å¯„å­˜å™¨é™åˆ¶</em></p>
<p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230414194156836.png"
                      class="" title="image-20230414194156836"
                ></em></p>
<h1 id="x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D"><a href="#x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D" class="headerlink" title="&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;"></a><em>&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</em></h1><h1 id="J5-EVMå¼€å‘å¥—ä»¶ç”¨æˆ·æ‰‹å†Œ"><a href="#J5-EVMå¼€å‘å¥—ä»¶ç”¨æˆ·æ‰‹å†Œ" class="headerlink" title="J5 EVMå¼€å‘å¥—ä»¶ç”¨æˆ·æ‰‹å†Œ"></a><em>J5 EVMå¼€å‘å¥—ä»¶ç”¨æˆ·æ‰‹å†Œ</em></h1><h2 id="ç¡¬ä»¶å¹³å°ä»‹ç»"><a href="#ç¡¬ä»¶å¹³å°ä»‹ç»" class="headerlink" title="ç¡¬ä»¶å¹³å°ä»‹ç»"></a><em>ç¡¬ä»¶å¹³å°ä»‹ç»</em></h2><h3 id="èŠ¯ç‰‡æ¡†å›¾"><a href="#èŠ¯ç‰‡æ¡†å›¾" class="headerlink" title="èŠ¯ç‰‡æ¡†å›¾"></a><em>èŠ¯ç‰‡æ¡†å›¾</em></h3><p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230415111219563.png"
                      class="" title="image-20230415111219563"
                ></em></p>
<ul>
<li><em>æ”¯æŒ4è·¯2.5G MIPI CSI RXæ¥å£</em></li>
<li><em>æ”¯æŒ2è·¯2.5G MIPI CSI TXæ¥å£</em></li>
<li><em>æ”¯æŒ1è·¯DVPæ¥å£</em></li>
<li><em>æ”¯æŒ8è·¯I2Cæ¥å£</em></li>
<li><em>æ”¯æŒ4è·¯SPI masteræ¥å£å’Œ2è·¯SPI slaveæ¥å£ï¼Œå…¶ä¸­1è·¯SPI masterå’Œ1è·¯SPI slaveå¤ç”¨</em></li>
<li><em>æ”¯æŒ4è·¯UARTæ¥å£</em></li>
<li><em>æ”¯æŒ4è·¯CANF-FDæ¥å£</em></li>
<li><em>æ”¯æŒ2è·¯1Gb Ethernetæ¥å£ï¼Œæ”¯æŒTSNï¼ˆæ—¶é—´æ•æ„Ÿç½‘ç»œï¼‰</em></li>
<li><em>æ”¯æŒ1è·¯PCIe Gen3 2Laneæ¥å£</em></li>
<li><em>æ”¯æŒ16è·¯LPWMæ¥å£å’Œ2è·¯PWMæ¥å£</em></li>
<li><em>æ”¯æŒ1è·¯EMMCå’Œ1è·¯SD&#x2F;SDIOæ¥å£</em></li>
<li><em>æ”¯æŒ1è·¯OSPIæ¥å£è¿æ¥nor&#x2F;hyper&#x2F; flash</em></li>
<li><em>æ”¯æŒ64bit LPDDR4&#x2F;4X memoryæ¥å£</em></li>
</ul>
<h3 id="å¼€å‘æ¿å®ç‰©å›¾"><a href="#å¼€å‘æ¿å®ç‰©å›¾" class="headerlink" title="å¼€å‘æ¿å®ç‰©å›¾"></a><em>å¼€å‘æ¿å®ç‰©å›¾</em></h3><p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230415111318104.png"
                      class="" title="image-20230415111318104"
                ></em></p>
<table>
<thead>
<tr>
<th><em>ç¼–å·</em></th>
<th><em>åŠŸèƒ½ä»‹ç»</em></th>
</tr>
</thead>
<tbody><tr>
<td><em>1</em></td>
<td><em>Sockets of RX sub-board</em></td>
</tr>
<tr>
<td><em>2</em></td>
<td><em>Socket of TX sub-board</em></td>
</tr>
<tr>
<td><em>3</em></td>
<td><em>DVP</em></td>
</tr>
<tr>
<td><em>4</em></td>
<td><em>DIP switch</em></td>
</tr>
<tr>
<td><em>5</em></td>
<td><em>JTAG</em></td>
</tr>
<tr>
<td><em>6</em></td>
<td><em>Ethernet port</em></td>
</tr>
<tr>
<td><em>7</em></td>
<td><em>SD card</em></td>
</tr>
<tr>
<td><em>8</em></td>
<td><em>Serial</em></td>
</tr>
<tr>
<td><em>9</em></td>
<td><em>Back board connector</em></td>
</tr>
<tr>
<td><em>10</em></td>
<td><em>Power</em></td>
</tr>
</tbody></table>
<h3 id="å¤–è®¾å®‰è£…"><a href="#å¤–è®¾å®‰è£…" class="headerlink" title="å¤–è®¾å®‰è£…"></a><em>å¤–è®¾å®‰è£…</em></h3><p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230415111350861.png"
                      class="" title="image-20230415111350861"
                ></em></p>
<p><em>è¯·æŒ‰ç…§ä»¥ä¸‹é¡ºåºå®‰è£…ï¼š</em></p>
<ol>
<li><em>åœ¨ä¸Šè¿°å®ç‰©å›¾ä½ç½®ï¼Œæ‰¾åˆ°serialæ’å£ï¼Œæ’å…¥Micro-USBçº¿ï¼ŒMicro-USBçº¿å¦ä¸€å¤´ä¸PCè¿æ¥</em></li>
<li><em>åœ¨ä¸Šè¿°å®ç‰©å›¾ä½ç½®ï¼Œæ‰¾åˆ°ç½‘å£ï¼Œæ’å…¥ç¬¦åˆè¦æ±‚çš„ç½‘çº¿ï¼Œç½‘çº¿å¦ä¸€å¤´ä¸PCè¿æ¥</em></li>
<li><em>å¦‚æœ‰éœ€è¦ï¼Œåœ¨ä¸Šè¿°å®ç‰©å›¾ä¸­æ‰¾åˆ°Micro SDå¡æ§½ä½ç½®ï¼Œæ’å…¥Micro SDå¡</em></li>
</ol>
<p><em>å¦‚æœ‰éœ€æ±‚ï¼Œè¯·æŒ‰ç…§å¦‚ä¸‹æ­¥éª¤é…ç½®æ‘„åƒå¤´åŠæ˜¾ç¤ºè¾“å‡ºå­æ¿ï¼Œæ‰€æœ‰æ˜¾ç¤ºè¾“å‡ºå­æ¿é…å¤‡é˜²åæ’ã€‚</em></p>
<p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230415111405353.png"
                      class="" title="image-20230415111405353"
                ></em></p>
<p><em>åœ¨ä¸Šè¿°å®ç‰©å›¾ä¸­ï¼Œæ‰¾åˆ°æ‘„åƒå¤´å­æ¿æ’å£ï¼Œå¹¶æ ¹æ®åº”ç”¨éœ€è¦ï¼Œæ¥å…¥ä¼ æ„Ÿå™¨åŠå…¶åŒ¹é…è½¬æ¢å­æ¿ã€‚</em></p>
<p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230415111416759.png"
                      class="" title="image-20230415111416759"
                ></em></p>
<p><em>å¯åŠ¨æ¨¡å¼DIPå…·ä½“é…ç½®å¦‚ä¸‹ï¼ŒDIPå¼€å…³ä¸‹æ‹¨ä¸ºå…³é—­çŠ¶æ€ï¼Œè¯·æ ¹æ®å…·ä½“éœ€è¦ï¼Œä¾æ®ä¸‹è¡¨è°ƒæ•´ã€‚ å·¦ä¾§DIPå¼€å…³é…ç½®ä¿¡æ¯ï¼š</em></p>
<table>
<thead>
<tr>
<th><em>DIPç¼–å·</em></th>
<th><em>åç§°</em></th>
<th><em>é»˜è®¤å€¼</em></th>
<th><em>åŠŸèƒ½æè¿°</em></th>
</tr>
</thead>
<tbody><tr>
<td><em>1</em></td>
<td><em>ä¿ç•™</em></td>
<td><em>0</em></td>
<td><em>ä¿ç•™</em></td>
</tr>
<tr>
<td><em>[4:2]</em></td>
<td><em>2NDBOOT_SEL</em></td>
<td><em>0</em></td>
<td><em>000: 2NDBOOT æ¥è‡ª EMMC</em></td>
</tr>
<tr>
<td><em>010: 2NDBOOT æ¥è‡ª UART XMODEM</em></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><em>011: 2NDBOOT æ¥è‡ª SPI FLASH(SPI NOR FLASH)</em></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><em>100: 2NDBOOT æ¥è‡ª SD</em></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><em>101: 2NDBOOT æ¥è‡ª AP SPI</em></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><em>110: 2NDBOOT æ¥è‡ª SPI FLASH(SPI HYPER FLASH)</em></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><em>111: 2NDBOOT æ¥è‡ª SPI FLASH(SPI NOR FALSH 8LINE DDR MODE)</em></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><em>5</em></td>
<td><em>ä¿ç•™</em></td>
<td><em>0</em></td>
<td><em>ä¿ç•™</em></td>
</tr>
<tr>
<td><em>6</em></td>
<td><em>DEVICE_MODE</em></td>
<td><em>0</em></td>
<td><em>å½“ 2NDBOOT&#x3D;EMMC&#x2F;SD æ—¶0&#x3D;PIO æ¨¡å¼1&#x3D;DMA æ¨¡å¼</em></td>
</tr>
<tr>
<td><em>å½“2NDBOOT&#x3D;SPI NOR FLASHæ—¶0&#x3D;32bit åœ°å€æ¨¡å¼1&#x3D;24bit åœ°å€æ¨¡å¼</em></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><em>å½“2NDBOOT&#x3D;SPI Hyper FLASHæ—¶ï¼Œæ²¡æœ‰å«ä¹‰</em></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><em>å½“2NDBOOT&#x3D;AP-SPI&#x2F;UART-XMODEMæ—¶ï¼Œæ²¡æœ‰å«ä¹‰</em></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><em>[8:7]</em></td>
<td><em>FASTBOOT_SEL</em></td>
<td><em>0</em></td>
<td><em>CPU&#x2F;BUS åˆ‡é¢‘é€‰æ‹©</em></td>
</tr>
<tr>
<td><em>00: æœ€é«˜é¢‘</em></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><em>01: æ¬¡é«˜é¢‘</em></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><em>10: ç¬¬ä¸‰æ¡£é¢‘ç‡</em></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><em>11: å…¨ 24M é¢‘ç‡</em></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><em>éƒ¨åˆ†DIPå¼€å…³ä¸è½¯ä»¶æ— å…³ï¼Œè¯¦æƒ…è¯·å‚è€ƒç¡¬ä»¶è®¾è®¡æ–‡æ¡£</em></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<p><em>å³ä¾§DIPå¼€å…³é…ç½®ä¿¡æ¯ï¼š</em></p>
<table>
<thead>
<tr>
<th><em>DIPç¼–å·</em></th>
<th><em>åç§°</em></th>
<th><em>é»˜è®¤å€¼</em></th>
<th><em>åŠŸèƒ½æè¿°</em></th>
</tr>
</thead>
<tbody><tr>
<td><em>1</em></td>
<td><em>UART_BAUD_RATE</em></td>
<td><em>0</em></td>
<td><em>0: 921600bps</em></td>
</tr>
<tr>
<td><em>1: 115200bps</em></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><em>2</em></td>
<td><em>ä¿ç•™</em></td>
<td><em>0</em></td>
<td><em>ä¿ç•™</em></td>
</tr>
<tr>
<td><em>3</em></td>
<td><em>SPI_FLASH_RESET</em></td>
<td><em>0</em></td>
<td><em>å½“2NDBOOT&#x3D;SPI FLASHæ—¶0: æ— æ“ä½œ1: è¯»å–NOR&#x2F;Hyper FLASHä¹‹å‰é¦–å…ˆæ‰§è¡Œä¸€æ¬¡RESETå‘½ä»¤æ“ä½œ</em></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><em>å½“2NDBOOT&#x3D;EMMC&#x2F;SDæ—¶è¯¥ä½ä»£è¡¨sdmmc_input_delay[0]</em></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><em>4</em></td>
<td><em>DISABLE_WDOG</em></td>
<td><em>0</em></td>
<td><em>0: ä½¿èƒ½WatchDogè¿›è¡Œåˆ‡é¢‘ä¿æŠ¤ï¼Œåˆ‡é¢‘ä¹‹å‰ä½¿èƒ½WatchDogï¼Œåˆ‡é¢‘æˆåŠŸä¹‹åäºˆä»¥å…³é—­ï¼Œå¦‚æœåˆ‡é¢‘å¤±è´¥å¯¼è‡´æ­»æœºï¼Œåˆ™WatchDogç”Ÿæ•ˆå¤ä½æ•´ä¸ªç³»ç»Ÿ</em></td>
</tr>
<tr>
<td><em>1: ä¸ä½¿ç”¨WatchDog</em></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><em>5</em></td>
<td><em>SDMMC_DELAY[1]</em></td>
<td><em>0</em></td>
<td><em>å½“2NDBOOT&#x3D;EMMC&#x2F;SDæ—¶è¯¥ä½ä»£è¡¨sdmmc_input_delay[1]</em></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><em>6</em></td>
<td><em>SDMMC_DELAY[2]</em></td>
<td><em>0</em></td>
<td><em>å½“2NDBOOT&#x3D;EMMC&#x2F;SDæ—¶è¯¥ä½ä»£è¡¨sdmmc_input_delay[2]</em></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><em>7</em></td>
<td><em>ä¿ç•™</em></td>
<td><em>0</em></td>
<td><em>ä¿ç•™</em></td>
</tr>
<tr>
<td><em>8</em></td>
<td><em>SKIP_CHECKSUM</em></td>
<td><em>0</em></td>
<td><em>0: æ ¡å¯¹å„é¡¹checksum</em></td>
</tr>
<tr>
<td><em>1: ä¸æ ¡å¯¹å„é¡¹checksum (easy for debug)</em></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><em>éƒ¨åˆ†DIPå¼€å…³ä¸è½¯ä»¶æ— å…³ï¼Œè¯¦æƒ…è¯·å‚è€ƒç¡¬ä»¶è®¾è®¡æ–‡æ¡£</em></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<h2 id="è½¯ä»¶å¼€å‘å·¥å…·"><a href="#è½¯ä»¶å¼€å‘å·¥å…·" class="headerlink" title="è½¯ä»¶å¼€å‘å·¥å…·"></a><em>è½¯ä»¶å¼€å‘å·¥å…·</em></h2><h3 id="ç³»ç»Ÿæ¡†å›¾"><a href="#ç³»ç»Ÿæ¡†å›¾" class="headerlink" title="ç³»ç»Ÿæ¡†å›¾"></a><em>ç³»ç»Ÿæ¡†å›¾</em></h3><p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230415111447163.png"
                      class="" title="image-20230415111447163"
                ></em></p>
<h3 id="å¼€å‘å·¥å…·ç›®å½•ç»“æ„"><a href="#å¼€å‘å·¥å…·ç›®å½•ç»“æ„" class="headerlink" title="å¼€å‘å·¥å…·ç›®å½•ç»“æ„"></a><em>å¼€å‘å·¥å…·ç›®å½•ç»“æ„</em></h3><p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230415111506865.png"
                      class="" title="image-20230415111506865"
                ></em></p>
<p><em>J5ç°æœ‰çš„åŸºç¡€æ–¹æ¡ˆï¼šA Coreä¸Šç›´æ¥è¿è¡ŒLinuxæ“ä½œç³»ç»Ÿï¼ŒSafety M Coreä¸Šæ²¡æœ‰è½¯ä»¶æ“ä½œç³»ç»Ÿã€‚ Safety M Core ä¸Šçš„è½¯ä»¶å¯¹A Coreä¸Šçš„è½¯ä»¶è¿›è¡Œç›‘æ§ï¼Œå¤„ç†å®‰å…¨æ•…éšœåŒæ—¶å‘SoCå¤–éƒ¨æŠ¥é”™ã€‚VDSP Coreä¸Šè¿è¡Œçš„æ˜¯XOS VDSPç®—æ³•è½¯ä»¶ï¼Œè´Ÿè´£ä¼ ç»Ÿçš„CVè¿ç®—ã€‚L2-L3åŸŸæ§åˆ¶å™¨ä¸Šçš„ ASIL-Dç›¸ å…³ä»»åŠ¡ï¼Œéƒ½ç”±å¤–éƒ¨ASIL-D MCUå®Œæˆã€‚</em></p>
<table>
<thead>
<tr>
<th><em><strong>è½¯ä»¶ç›®å½•å</strong></em></th>
<th><em><strong>ç›®å½•è¯´æ˜</strong></em></th>
</tr>
</thead>
<tbody><tr>
<td><em>build</em></td>
<td><em>ç¼–è¯‘ç¯å¢ƒä¸æ‰§è¡Œè„šæœ¬ç›®å½•</em></td>
</tr>
<tr>
<td><em>external&#x2F;android-tools</em></td>
<td><em>Rootfsä¸­initæ‰§è¡Œç¨‹åºæºä»£ç ç›®å½•</em></td>
</tr>
<tr>
<td><em>hbre&#x2F;camera</em></td>
<td><em>Cameraä¸­é—´ä»¶APIæºä»£ç ç›®å½•</em></td>
</tr>
<tr>
<td><em>hbre&#x2F;hbutils</em></td>
<td><em>Hbutilså·¥å…·åŒ…æºä»£ç ç›®å½•</em></td>
</tr>
<tr>
<td><em>hbre&#x2F;hobotsdk</em></td>
<td><em>Hobotsdkæºä»£ç ç›®å½•</em></td>
</tr>
<tr>
<td><em>hbre&#x2F;libdisp</em></td>
<td><em>Displayä¸­é—´ä»¶APIæºä»£ç ç›®å½•</em></td>
</tr>
<tr>
<td><em>hbre&#x2F;libhbpcie</em></td>
<td><em>Pcieä¸­é—´ä»¶APIæºä»£ç ç›®å½•</em></td>
</tr>
<tr>
<td><em>hbre&#x2F;libion</em></td>
<td><em>Ionï¼ˆç‰©ç†å†…å­˜ç®¡ç†ï¼‰ä¸­é—´ä»¶APIæºä»£ç ç›®å½•</em></td>
</tr>
<tr>
<td><em>hbre&#x2F;liblog</em></td>
<td><em>Logcatï¼ˆç”¨æˆ·æ€logè®°å½•ï¼‰æºä»£ç ç›®å½•</em></td>
</tr>
<tr>
<td><em>hbre&#x2F;librpmsg</em></td>
<td><em>æ ¸é—´é€šä¿¡ä¸­é—´ä»¶APIæºä»£ç ç›®å½•</em></td>
</tr>
<tr>
<td><em>hbre&#x2F;libsecchip</em></td>
<td><em>Securityä¸­é—´ä»¶APIæºä»£ç ç›®å½•</em></td>
</tr>
<tr>
<td><em>hbre&#x2F;openssl-engine</em></td>
<td><em>Opensslç¡¬ä»¶åŠ é€Ÿå¼•æ“æºä»£ç ç›®å½•</em></td>
</tr>
<tr>
<td><em>uboot</em></td>
<td><em>Splå’Œubootæºä»£ç ç›®å½•</em></td>
</tr>
<tr>
<td><em>kernel</em></td>
<td><em>Linux kernelæºä»£ç </em></td>
</tr>
<tr>
<td><em>prebuilts&#x2F;root</em></td>
<td><em>Rootfsç›®å½•ï¼ŒbuildååŒ…å«åœ¨kernel Imageä¸­</em></td>
</tr>
<tr>
<td><em>tools&#x2F;autotest</em></td>
<td><em>è‡ªåŠ¨åŒ–æµ‹è¯•æ‰§è¡Œpythonè„šæœ¬ç›®å½•</em></td>
</tr>
<tr>
<td><em>unittest&#x2F;testapp</em></td>
<td><em>æµ‹è¯•ä»£ç ç›®å½•</em></td>
</tr>
<tr>
<td><em>unittest&#x2F;utest</em></td>
<td><em>è‡ªåŠ¨åŒ–æµ‹è¯•ç”¨ä¾‹jsonè„šæœ¬ç›®å½•</em></td>
</tr>
</tbody></table>
<p><em>ç”¨æˆ·åˆ°æ‰‹çš„æ˜¯å¦‚ä¸‹çš„åŒ…ï¼š</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dev-j5-k5-LNX5.10_GCC9.3_REL_PL3.0_2022072603.zip</span><br></pre></td></tr></table></figure></div>

<p><em>è¿™é‡Œå¯¹ä»£ç çš„ç›®å½•ç»“æ„ç®€å•åšä¸‹ä»‹ç»ï¼Œæ–¹ä¾¿ç»™å¼€å‘äººå‘˜ä¸€ä¸ªåˆæ­¥çš„è®¤è¯†ã€‚ æ³¨é‡Šï¼šç”±äºå…·ä½“æƒ…å†µæ ¹æ®å…·ä½“ä½¿ç”¨ä¸ºå‡†ï¼Œè¿™é‡Œåªå¯¹ç»å¸¸ä½¿ç”¨çš„ç›®å½•è¿›è¡Œè¯´æ˜ï¼Œç»†èŠ‚æ ¹æ®ä½¿ç”¨æƒ… å†µå˜åŠ¨ï¼Œä»¥ä¸‹ä»…ä¾›å‚è€ƒã€‚</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Makefile  build  certs  external  hbre  kernel  mcore  out  prebuilts  tools  uboot  unittest</span><br></pre></td></tr></table></figure></div>

<h4 id="build"><a href="#build" class="headerlink" title="build"></a><em>build</em></h4><p><em>ç¼–è¯‘ç›¸å…³çš„å‚æ•°é…ç½®ï¼Œä»¥åŠå‡çº§é•œåƒçš„ç›®å½•ã€‚ ä¸‹è¡¨ä»‹ç»äº†ç»å¸¸ä½¿ç”¨çš„å‡ ä¸ªå·¥ä½œç›®å½•åŠæ–‡ä»¶ï¼š</em></p>
<table>
<thead>
<tr>
<th><em>æ–‡ä»¶ç›®å½•å</em></th>
<th><em>æ–‡ä»¶ç›®å½•åŠŸèƒ½è¯´æ˜</em></th>
</tr>
</thead>
<tbody><tr>
<td><em>build.sh</em></td>
<td><em>ç¼–è¯‘é•œåƒæ—¶å€™çš„æ‰§è¡Œè„šæœ¬ã€‚</em></td>
</tr>
<tr>
<td><em>envsetup.sh</em></td>
<td><em>ç¼–è¯‘é•œåƒçš„é…ç½®è„šæœ¬ã€‚</em></td>
</tr>
<tr>
<td><em>core</em></td>
<td><em>buildç¯å¢ƒé…ç½®è„šæœ¬ç›®å½•ã€‚</em></td>
</tr>
<tr>
<td><em>device</em></td>
<td><em>å„å¹³å°ç¼–è¯‘æ—¶æ‰€ç”¨çš„é…ç½®æ–‡ä»¶ï¼šenv.sh, gpt.conf, rootfs.manifest, fstab, init.rc, ubi.cfgç­‰ã€‚</em></td>
</tr>
<tr>
<td><em>Makefile</em></td>
<td><em>å®Œæ•´ç¼–è¯‘æ‰€ç”¨Makefileã€‚</em></td>
</tr>
<tr>
<td><em>ota_tools</em></td>
<td><em>otaå‡çº§åŒ…ç”Ÿæˆæ‰€éœ€çš„ç›¸å…³å·¥å…·è„šæœ¬ç›®å½•: sbl_package_maker,mcore_package_maker,bl31_package_maker,uboot_package_maker,kernel_package_maker,system_package_maker,app_package_maker, diff_tools, allç­‰ã€‚</em></td>
</tr>
<tr>
<td><em>scripts</em></td>
<td><em>ç¼–è¯‘æ‰“åŒ…æ‰€éœ€çš„å„ç§è„šæœ¬ã€‚</em></td>
</tr>
<tr>
<td><em>tools</em></td>
<td><em>ç¼–è¯‘æ‰“åŒ…å·¥å…·æ‰€åœ¨ç›®å½•: avbtools, cramfsmkbooting, pkgtool, squashfs, key_management_toolkitsç­‰ã€‚</em></td>
</tr>
</tbody></table>
<h4 id="external"><a href="#external" class="headerlink" title="external"></a><em>external</em></h4><p><em>ç¬¬ä¸‰æ–¹ä»£ç ç›®å½•ï¼Œç›®å‰å­˜æ”¾Rootfsä¸­initæ‰§è¡Œç¨‹åºæºä»£ç ç›®å½•ã€‚</em></p>
<h4 id="hbre"><a href="#hbre" class="headerlink" title="hbre"></a><em>hbre</em></h4><p><em>åœ°å¹³çº¿å®šåˆ¶åŒ–ç”¨æˆ·åº“æºç ï¼Œå¦‚Cameraç­‰ã€‚ ä¸‹è¡¨ä»‹ç»äº†å‡ ä¸ªç»å¸¸ä½¿ç”¨çš„ç”¨æˆ·åº“æºç å·¥ä½œç›®å½•ï¼š</em></p>
<table>
<thead>
<tr>
<th><em><strong>æ–‡ä»¶ç›®å½•å</strong></em></th>
<th><em><strong>æ–‡ä»¶ç›®å½•åŠŸèƒ½è¯´æ˜</strong></em></th>
</tr>
</thead>
<tbody><tr>
<td><em>camera</em></td>
<td><em>Cameraä¸­é—´ä»¶APIæºä»£ç ç›®å½•ã€‚</em></td>
</tr>
<tr>
<td><em>hbutils</em></td>
<td><em>Hbutilså·¥å…·åŒ…æºä»£ç ç›®å½•ã€‚</em></td>
</tr>
<tr>
<td><em>hobotsdk</em></td>
<td><em>Hobotsdkæºä»£ç ç›®å½•ã€‚</em></td>
</tr>
<tr>
<td><em>libdisp</em></td>
<td><em>Displayä¸­é—´ä»¶APIæºä»£ç ç›®å½•ã€‚</em></td>
</tr>
<tr>
<td><em>libhbpcie</em></td>
<td><em>Pcieä¸­é—´ä»¶APIæºä»£ç ç›®å½•ã€‚</em></td>
</tr>
<tr>
<td><em>libion</em></td>
<td><em>Ionï¼ˆç‰©ç†å†…å­˜ç®¡ç†ï¼‰ä¸­é—´ä»¶APIæºä»£ç ç›®å½•ã€‚</em></td>
</tr>
<tr>
<td><em>liblog</em></td>
<td><em>Logcatï¼ˆç”¨æˆ·æ€logè®°å½•ï¼‰æºä»£ç ç›®å½•ã€‚</em></td>
</tr>
<tr>
<td><em>librpmsg</em></td>
<td><em>æ ¸é—´é€šä¿¡ä¸­é—´ä»¶APIæºä»£ç ç›®å½•ã€‚</em></td>
</tr>
<tr>
<td><em>libsecchip</em></td>
<td><em>Securityä¸­é—´ä»¶APIæºä»£ç ç›®å½•ã€‚</em></td>
</tr>
<tr>
<td><em>openssl-engine</em></td>
<td><em>Opensslç¡¬ä»¶åŠ é€Ÿå¼•æ“æºä»£ç ç›®å½•ã€‚</em></td>
</tr>
</tbody></table>
<h4 id="kernel"><a href="#kernel" class="headerlink" title="kernel"></a><em>kernel</em></h4><p><em>Linuxå†…æ ¸ç›¸å…³ä»£ç ï¼ŒåŒ…å«J5 SoCçš„é©±åŠ¨ä»£ç å’Œä½“ç³»æ¶æ„ä»£ç ã€‚ ä¸‹è¡¨ä»‹ç»äº†J5 SoC Linuxå†…æ ¸ä¸­å‡ ä¸ªä¸»è¦æ¨¡å—çš„æºç ç›®å½•åŠæ–‡ä»¶ï¼š</em></p>
<table>
<thead>
<tr>
<th><em><strong>æ–‡ä»¶ç›®å½•å</strong></em></th>
<th><em><strong>æ–‡ä»¶ç›®å½•åŠŸèƒ½è¯´æ˜</strong></em></th>
</tr>
</thead>
<tbody><tr>
<td><em>arch</em></td>
<td><em>SoCä½“ç³»æ¶æ„ä»£ç ï¼ŒJ5ä½¿ç”¨8æ ¸A55ï¼ˆArm-V8ä½“ç³»æ¶æ„ï¼‰CPUï¼Œä¸»è¦ä½“ç³»æ¶æ„ä»£ç åœ¨arch&#x2F;arm64ç›®å½•ä¸­ï¼ŒLinuxå†…æ ¸ç¼–è¯‘é…ç½®åœ¨arch&#x2F;arm64&#x2F; configsç›®å½•ä¸­ï¼ŒJ5 SoC dtsç›¸å…³é…ç½®åœ¨arch&#x2F;arm64&#x2F;boot&#x2F;dts&#x2F;hobotç›®å½•ä¸­ã€‚</em></td>
</tr>
<tr>
<td><em>block</em></td>
<td><em>æ­¤æ–‡ä»¶å¤¹åŒ…å«å—è®¾å¤‡é©±åŠ¨ç¨‹åºçš„ä»£ç ï¼Œè¯¥ç›®å½•ç”¨äºå®ç°å—è®¾å¤‡çš„åŸºæœ¬æ¡†æ¶å’Œå—è®¾å¤‡çš„I&#x2F;Oè°ƒåº¦ç®—æ³•ã€‚å—è®¾å¤‡æ˜¯ä»¥æ•°æ®å—æ–¹å¼æ¥æ”¶å’Œå‘é€çš„æ•°æ®çš„è®¾å¤‡ï¼Œæ•°æ®å—éƒ½æ˜¯ä¸€å—ä¸€å—çš„æ•°æ®è€Œä¸æ˜¯æŒç»­çš„æ•°æ®æµã€‚</em></td>
</tr>
<tr>
<td><em>crypto</em></td>
<td><em>è¿™ä¸ªæ–‡ä»¶å¤¹åŒ…å«è®¸å¤šåŠ å¯†ç®—æ³•çš„æºä»£ç ã€‚ä¾‹å¦‚ï¼Œâ€œsha1_generic.câ€è¿™ä¸ªæ–‡ä»¶åŒ…å«äº†sha1åŠ å¯†ç®—æ³•çš„ä»£ç ã€‚</em></td>
</tr>
<tr>
<td><em>drivers</em></td>
<td><em>è¯¥ç›®å½•åŒ…å«é©±åŠ¨ä»£ç ã€‚é©±åŠ¨æ˜¯ä¸€ä¸ªæ§åˆ¶ç¡¬ä»¶çš„è½¯ä»¶ï¼Œä¾‹å¦‚ï¼Œè¦è®©J5çŸ¥é“pcieæ€»çº¿å¹¶ä½¿å…¶å¯ç”¨ï¼Œpcie rc&#x2F;epé©±åŠ¨æ˜¯å¿…è¦çš„ã€‚è¿™ä¸ªæ–‡ä»¶å¤¹ä¸­å­˜åœ¨è®¸å¤šæ–‡ä»¶å¤¹ï¼Œæ¯ä¸ªæ–‡ä»¶å¤¹éƒ½ä»¥ç¡¬ä»¶çš„ç§ç±»æˆ–è€…å‹å·å‘½åã€‚</em></td>
</tr>
<tr>
<td><em>fs</em></td>
<td><em>è¿™æ˜¯æ–‡ä»¶ç³»ç»Ÿçš„æ–‡ä»¶å¤¹ã€‚åœ¨è¿™ä¸ªæ–‡ä»¶å¤¹é‡Œï¼Œæ¯ç§æ–‡ä»¶ç³»ç»Ÿéƒ½æœ‰è‡ªå·±çš„æ–‡ä»¶å¤¹ã€‚ä¾‹å¦‚ï¼Œext4æ–‡ä»¶ç³»ç»Ÿçš„ä»£ç åœ¨ext4æ–‡ä»¶å¤¹å†…ã€‚åœ¨fsæ–‡ä»¶å¤¹å†…ï¼Œé™¤äº†æ–‡ä»¶ç³»ç»Ÿå„è‡ªçš„æ–‡ä»¶å¤¹ï¼Œè¿˜æœ‰ä¸å±äºä»»ä½•æ–‡ä»¶ç³»ç»Ÿçš„æ–‡ä»¶ã€‚è¿™äº›æ–‡ä»¶ç”¨æ¥æ§åˆ¶æ•´ä¸ªæ–‡ä»¶ç³»ç»Ÿï¼Œä¾‹å¦‚ï¼Œmount.hä¸­ä¼šåŒ…å«æŒ‚è½½æ–‡ä»¶ç³»ç»Ÿçš„ä»£ç ã€‚</em></td>
</tr>
<tr>
<td><em>kernel</em></td>
<td><em>Linuxå†…æ ¸çš„æ ¸å¿ƒæ¡†æ¶ä»£ç ï¼Œæ¯”å¦‚ï¼šè°ƒåº¦å­ç³»ç»Ÿã€æ—¶é—´å­ç³»ç»Ÿã€åŠŸè€—ç®¡ç†å­ç³»ç»Ÿã€ä¸­æ–­ç®¡ç†å­ç³»ç»Ÿç­‰ã€‚</em></td>
</tr>
<tr>
<td><em>lib</em></td>
<td><em>Linuxå†…æ ¸çš„è½¯ä»¶åº“ä»£ç ï¼Œæ¯”å¦‚ï¼šchecksum,crc,fdt,zlibç­‰ã€‚</em></td>
</tr>
<tr>
<td><em>sound</em></td>
<td><em>Linuxå†…æ ¸Audioå­ç³»ç»Ÿæºä»£ç ç›®å½•ã€‚</em></td>
</tr>
<tr>
<td><em>Net</em></td>
<td><em>Linuxå†…æ ¸ç½‘ç»œåè®®æ ˆæºä»£ç ç›®å½•ã€‚</em></td>
</tr>
<tr>
<td><em>Makefile</em></td>
<td><em>è¿™ä¸ªè„šæœ¬æ˜¯ç¼–è¯‘å†…æ ¸çš„ä¸»è¦æ–‡ä»¶ã€‚è¿™ä¸ªæ–‡ä»¶å°†ç¼–è¯‘å‚æ•°å’Œç¼–è¯‘æ‰€éœ€çš„æ–‡ä»¶å’Œå¿…è¦çš„ä¿¡æ¯ä¼ ç»™ç¼–è¯‘å™¨ã€‚</em></td>
</tr>
</tbody></table>
<h4 id="mcore"><a href="#mcore" class="headerlink" title="mcore"></a><em>mcore</em></h4><p><em>J5 SoC Mæ ¸è¿è¡Œçš„æ˜¯baremetalä»£ç ï¼Œå¦‚ä¸‹ä¸ºMcoreæºä»£ç æ ‘ã€‚ ä¸‹è¡¨ä»‹ç»äº†J5 SoC Mcoreå†…æ ¸ä¸­å‡ ä¸ªä¸»è¦æ¨¡å—çš„æºç ç›®å½•åŠæ–‡ä»¶ï¼š</em></p>
<table>
<thead>
<tr>
<th><em><strong>æ–‡ä»¶ç›®å½•å</strong></em></th>
<th><em><strong>æ–‡ä»¶ç›®å½•åŠŸèƒ½è¯´æ˜</strong></em></th>
</tr>
</thead>
<tbody><tr>
<td><em>build.sh</em></td>
<td><em>mcoreç¼–è¯‘é•œåƒæ—¶å€™çš„æ‰§è¡Œè„šæœ¬ã€‚</em></td>
</tr>
<tr>
<td><em>debug</em></td>
<td><em>è°ƒè¯•åŠŸèƒ½ç›¸å…³çš„ä»£ç ã€‚</em></td>
</tr>
<tr>
<td><em>driver</em></td>
<td><em>å¤–è®¾é©±åŠ¨ä»£ç ï¼ˆi2c, spi, pvt, wdg, gpioç­‰ï¼‰ã€‚</em></td>
</tr>
<tr>
<td><em>include</em></td>
<td><em>å¤´æ–‡ä»¶ã€‚</em></td>
</tr>
<tr>
<td><em>middleware</em></td>
<td><em>ä¸­é—´ä»¶ï¼ˆæ ¸é—´é€šä¿¡ã€ä»»åŠ¡è°ƒåº¦æ¡†æ¶ã€spiä¼ è¾“åè®®ç­‰ï¼‰ã€‚</em></td>
</tr>
<tr>
<td><em>system</em></td>
<td><em>ç³»ç»Ÿè¿è¡Œçš„åŸºç¡€åŠŸèƒ½ï¼ˆå¯åŠ¨ä»£ç ã€å¼‚å¸¸å¤„ç†ã€systickç­‰ï¼‰ã€‚</em></td>
</tr>
<tr>
<td><em>task</em></td>
<td><em>å„ä»»åŠ¡çš„å®ç°ä»£ç ã€‚</em></td>
</tr>
<tr>
<td><em>customer.c</em></td>
<td><em>ç”¨æˆ·å®šåˆ¶ä»£ç ã€‚</em></td>
</tr>
</tbody></table>
<h4 id="out"><a href="#out" class="headerlink" title="out"></a><em>out</em></h4><p><em>ç¼–è¯‘è¿‡ç¨‹å®Œæˆæ—¶çš„é•œåƒè¾“å‡ºä½ç½®ã€‚ ä¸‹è¡¨ä»‹ç»äº†J5ç³»ç»Ÿè½¯ä»¶ç¼–è¯‘ç”Ÿæˆç»“æœï¼š</em></p>
<table>
<thead>
<tr>
<th><em><strong>æ–‡ä»¶ç›®å½•å</strong></em></th>
<th><em><strong>æ–‡ä»¶ç›®å½•åŠŸèƒ½è¯´æ˜</strong></em></th>
</tr>
</thead>
<tbody><tr>
<td><em>log</em></td>
<td><em>ç¼–è¯‘logç”Ÿæˆåœ¨è¯¥ç›®å½•ä¸‹ã€‚</em></td>
</tr>
<tr>
<td><em>build</em></td>
<td><em>ç¼–è¯‘ä¸­é—´æ–‡ä»¶æ”¾åœ¨è¿™é‡Œã€‚</em></td>
</tr>
<tr>
<td><em>target</em></td>
<td><em>æ‰€æœ‰ç¼–è¯‘åç”Ÿæˆçš„æœ€ç»ˆé•œåƒéƒ½æ”¾åœ¨out&#x2F;target&#x2F;product&#x2F;packages ç›®å½•ä¸­ï¼ŒLinuxå†…æ ¸ç¼–è¯‘ç”Ÿæˆçš„koå’Œç¬¦å·è¡¨æ”¾åœ¨out&#x2F;target&#x2F;product&#x2F;symbols ç›®å½•ä¸­ã€‚</em></td>
</tr>
<tr>
<td><em>tmpunittest</em></td>
<td><em>J5ç³»ç»Ÿè½¯ä»¶æµ‹è¯•APPé•œåƒç”Ÿæˆç›®å½•ã€‚</em></td>
</tr>
<tr>
<td><em>prerootfs</em></td>
<td><em>Prebuilt&#x2F;rootå†…åŒ…å«çš„rootfsé•œåƒå†å¢åŠ ä¸€äº›hrutçš„å·¥å…·é•œåƒã€‚</em></td>
</tr>
<tr>
<td><em>tmprootfs</em></td>
<td><em>hbreç¼–è¯‘ç”Ÿæˆçš„rootfsé•œåƒï¼Œä¼šåŒ…å«åœ¨system.imgä¸­ã€‚</em></td>
</tr>
</tbody></table>
<h4 id="prebuilts"><a href="#prebuilts" class="headerlink" title="prebuilts"></a><em>prebuilts</em></h4><p><em>ç¼–è¯‘å¥½çš„ç”¨äºæ ¹æ–‡ä»¶ç³»ç»Ÿçš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚ ä¸‹è¡¨ä»‹ç»äº†prebuiltsä¸‹çš„å‡ ä¸ªä¸»è¦æ¨¡å—çš„æºç ç›®å½•ï¼š</em></p>
<table>
<thead>
<tr>
<th><em><strong>æ–‡ä»¶ç›®å½•å</strong></em></th>
<th><em><strong>æ–‡ä»¶ç›®å½•åŠŸèƒ½è¯´æ˜</strong></em></th>
</tr>
</thead>
<tbody><tr>
<td><em>boot</em></td>
<td><em>J5ç³»ç»Ÿè½¯ä»¶æ•´ä½“ç¼–è¯‘å’Œæ‰“åŒ…è¿‡ç¨‹ä¸­éœ€è¦çš„ä¸€äº›äºŒè¿›åˆ¶é•œåƒï¼ŒåŒ…å«ï¼šbl31é•œåƒã€bpuæ¨¡å‹é•œåƒã€ddré•œåƒå’ŒMcoreé•œåƒã€‚</em></td>
</tr>
<tr>
<td><em>host</em></td>
<td><em>äº¤å‰ç¼–è¯‘å·¥å…·é“¾ç›®å½•ã€‚</em></td>
</tr>
<tr>
<td><em>root</em></td>
<td><em>ç¼–è¯‘å¥½çš„ç”¨äºæ ¹æ–‡ä»¶ç³»ç»Ÿçš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚</em></td>
</tr>
<tr>
<td><em>mcore</em></td>
<td><em>ç¼–è¯‘å¥½çš„mcoreçš„objæ–‡ä»¶ã€‚</em></td>
</tr>
<tr>
<td><em>root_hijack</em></td>
<td><em>è‡ªå®šä¹‰çš„æ ¹æ–‡ä»¶ç³»ç»Ÿç›¸å…³è„šæœ¬ã€äºŒè¿›åˆ¶æ–‡ä»¶ã€‚</em></td>
</tr>
</tbody></table>
<h4 id="tools"><a href="#tools" class="headerlink" title="tools"></a><em>tools</em></h4><p><em>å·¥å…·ç›®å½•ï¼Œç›®å‰ä»…åŒ…å«è‡ªåŠ¨åŒ–æµ‹è¯•è„šæœ¬ã€‚</em></p>
<h4 id="uboot"><a href="#uboot" class="headerlink" title="uboot"></a><em>uboot</em></h4><blockquote>
<p><em>U-Boot æ˜¯ä¸€ä¸ªå¼€æºçš„åµŒå…¥å¼ç³»ç»Ÿå¼•å¯¼åŠ è½½ç¨‹åº</em></p>
</blockquote>
<p><em>å¯åŠ¨bootloaderç›¸å…³æ–‡ä»¶ã€‚ ä¸‹è¡¨ä»‹ç»äº†J5 ubootä¸­å‡ ä¸ªä¸»è¦æ¨¡å—çš„æºç ç›®å½•ï¼š</em></p>
<table>
<thead>
<tr>
<th><em><strong>æ–‡ä»¶ç›®å½•å</strong></em></th>
<th><em><strong>æ–‡ä»¶ç›®å½•åŠŸèƒ½è¯´æ˜</strong></em></th>
</tr>
</thead>
<tbody><tr>
<td><em>api</em></td>
<td><em>ubootä¸­çš„æ¥å£å‡½æ•°ã€‚</em></td>
</tr>
<tr>
<td><em>arch</em></td>
<td><em>ubootä¸­æœ‰å…³å¤„ç†å™¨æ¶æ„ç›¸å…³çš„ä»£ç ã€‚</em></td>
</tr>
<tr>
<td><em>board</em></td>
<td><em>ä¸ºå¼€å‘æ¿å®šåˆ¶çš„ç›¸å…³ä»£ç ã€‚</em></td>
</tr>
<tr>
<td><em>common</em></td>
<td><em>é€šç”¨ä»£ç ï¼Œå¤§éƒ¨åˆ†ä¸å‘½ä»¤è¡Œæœ‰å…³ã€‚</em></td>
</tr>
<tr>
<td><em>disk</em></td>
<td><em>ç£ç›˜åˆ†åŒºç›¸å…³ä»£ç ã€‚</em></td>
</tr>
<tr>
<td><em>doc</em></td>
<td><em>æœ‰å…³README.txtç›¸å…³ä»£ç ã€‚</em></td>
</tr>
<tr>
<td><em>drivers</em></td>
<td><em>ä¸é©±åŠ¨ç¨‹åºç›¸å…³ä»£ç ã€‚</em></td>
</tr>
<tr>
<td><em>examples</em></td>
<td><em>ç¤ºä¾‹ç¨‹åºã€‚</em></td>
</tr>
<tr>
<td><em>fs</em></td>
<td><em>æ–‡ä»¶ç³»ç»Ÿï¼Œé€‚åˆå¤§éƒ¨åˆ†å¼€å‘æ¿ä¸Šçš„æ–‡ä»¶ç³»ç»Ÿã€‚</em></td>
</tr>
<tr>
<td><em>include</em></td>
<td><em>åŒ…å«å…¨å±€çš„å¤´æ–‡ä»¶ã€‚</em></td>
</tr>
<tr>
<td><em>lib</em></td>
<td><em>é€šç”¨åº“æ–‡ä»¶ã€‚</em></td>
</tr>
<tr>
<td><em>net</em></td>
<td><em>ç½‘ç»œç›¸å…³çš„ä»£ç ï¼Œå°å‹çš„åè®®æ ˆã€‚</em></td>
</tr>
<tr>
<td><em>post</em></td>
<td><em>Power On Self Testï¼Œä¸Šç”µè‡ªæ£€ç¨‹åºã€‚</em></td>
</tr>
<tr>
<td><em>tools</em></td>
<td><em>è¾…åŠ©ç¨‹åºï¼Œç”¨äºç¼–è¯‘å’Œæ£€æŸ¥ubootç›®æ ‡æ–‡ä»¶ã€‚</em></td>
</tr>
</tbody></table>
<h4 id="unittest"><a href="#unittest" class="headerlink" title="unittest"></a><em>unittest</em></h4><blockquote>
<p><em>unittest æ˜¯ Python å†…ç½®çš„ä¸€ä¸ªç”¨äºç¼–å†™å•å…ƒæµ‹è¯•çš„æ¡†æ¶ã€‚å®ƒå¯ä»¥è‡ªåŠ¨åŒ–æ‰§è¡Œæµ‹è¯•ç”¨ä¾‹ï¼Œæ¯”è¾ƒæµ‹è¯•ç»“æœå¹¶ç”Ÿæˆæµ‹è¯•æŠ¥å‘Šã€‚</em></p>
</blockquote>
<p><em>unittest æä¾›äº†ç”¨äºæµ‹è¯•çš„ TestCase ç±»å’Œä¸€ç³»åˆ—çš„æ–­è¨€æ–¹æ³•ï¼Œä»¥åŠ setUp() å’Œ tearDown() æ–¹æ³•ç”¨äºæµ‹è¯•å‰çš„åˆå§‹åŒ–å’Œæµ‹è¯•å®Œåçš„æ¸…ç†å·¥ä½œã€‚é€šè¿‡è¿™äº›å·¥å…·ï¼Œå¼€å‘è€…å¯ä»¥æ–¹ä¾¿åœ°ç¼–å†™ã€æ‰§è¡Œå’Œç®¡ç†æµ‹è¯•ç”¨ä¾‹ã€‚</em></p>
<p><em>unittest æ”¯æŒæ¨¡å—åŒ–æµ‹è¯•ï¼Œå¯ä»¥å°†æµ‹è¯•ç”¨ä¾‹åˆ†åˆ«æ”¾åœ¨ä¸åŒçš„æµ‹è¯•æ–‡ä»¶ä¸­ï¼Œå¹¶é€šè¿‡ TestSuite ç±»å’Œ TestLoader ç±»å°†å®ƒä»¬ç»„åˆåœ¨ä¸€èµ·æ‰§è¡Œã€‚æ­¤å¤–ï¼Œunittest è¿˜æ”¯æŒæµ‹è¯•è¦†ç›–ç‡çš„è®¡ç®—ã€‚</em></p>
<p><em>ç®€å•çš„æµ‹è¯•ç”¨ä¾‹æºç å’Œç”¨äºè‡ªåŠ¨åŒ–æµ‹è¯•çš„jsoné…ç½®æ–‡ä»¶ã€‚ ä¸‹è¡¨ä»‹ç»äº†J5 unittestä¸­å‡ ä¸ªä¸»è¦æ¨¡å—çš„æºç ç›®å½•ï¼š</em></p>
<table>
<thead>
<tr>
<th><em><strong>æ–‡ä»¶ç›®å½•å</strong></em></th>
<th><em><strong>æ–‡ä»¶ç›®å½•åŠŸèƒ½è¯´æ˜</strong></em></th>
</tr>
</thead>
<tbody><tr>
<td><em>build</em></td>
<td><em>unittest ç¼–è¯‘è„šæœ¬ã€‚</em></td>
</tr>
<tr>
<td><em>prebuilts</em></td>
<td><em>ç¼–è¯‘æ‰€éœ€é¢„å»ºç›®å½•ã€‚</em></td>
</tr>
<tr>
<td><em>testapp</em></td>
<td><em>æµ‹è¯•æºä»£ç ç›®å½•ï¼Œç¼–è¯‘ç”Ÿæˆçš„åº“å’Œå¯æ‰§è¡Œæ–‡ä»¶ä¼šåŒ…å«åœ¨out&#x2F;tmpunittestç›®å½•ä¸­ã€‚</em></td>
</tr>
<tr>
<td><em>utest</em></td>
<td><em>ç”¨äºè‡ªåŠ¨åŒ–æµ‹è¯•çš„jsoné…ç½®æ–‡ä»¶ç›®å½•ï¼ŒåŒ…å«æ‰€æœ‰çš„è‡ªåŠ¨åŒ–æµ‹è¯•caseé…ç½®æ–‡ä»¶ã€‚</em></td>
</tr>
</tbody></table>
<h2 id="æ¿ç«¯è¿æ¥æ–¹æ³•"><a href="#æ¿ç«¯è¿æ¥æ–¹æ³•" class="headerlink" title="æ¿ç«¯è¿æ¥æ–¹æ³•"></a><em>æ¿ç«¯è¿æ¥æ–¹æ³•</em></h2><h3 id="ç½‘å£è¿æ¥"><a href="#ç½‘å£è¿æ¥" class="headerlink" title="ç½‘å£è¿æ¥"></a><em>ç½‘å£è¿æ¥</em></h3><p><em>é€šè¿‡ç½‘å£ä»¥sshåè®®ä¸å¼€å‘æ¿é€šè®¯çš„è½¯ä»¶ã€‚</em></p>
<h3 id="ä¸²å£æ¥å£"><a href="#ä¸²å£æ¥å£" class="headerlink" title="ä¸²å£æ¥å£"></a><em>ä¸²å£æ¥å£</em></h3><p><em>å½“ä½¿ç”¨windowsé€šè¿‡ä¸²å£è¿æ¥J5 dvbæ¿æ—¶ï¼Œéœ€å®‰è£…å¯¹åº”é©±åŠ¨ï¼Œé©±åŠ¨ä¸‹è½½é“¾æ¥ï¼š<a class="link"   target="_blank" rel="noopener" href="http://www.ftdichip.cn/Drivers/VCP.htm%EF%BC%8C%E9%A9%B1%E5%8A%A8%E5%AE%89%E8%A3%85%E5%90%8E%E8%AF%86%E5%88%AB%E5%87%BA%E7%9A%84%E5%9B%9B%E4%B8%AACOM%E5%8F%A3%EF%BC%8C%E9%80%89%E6%8B%A9%E9%A1%BA%E5%BA%8F%E7%AC%AC%E4%B8%89%E4%B8%AACOM%E5%8F%A3%EF%BC%8C%E4%B8%B2%E5%8F%A3%E6%B3%A2%E7%89%B9%E7%8E%87%EF%BC%9A921600%E3%80%82" >http://www.ftdichip.cn/Drivers/VCP.htmï¼Œé©±åŠ¨å®‰è£…åè¯†åˆ«å‡ºçš„å››ä¸ªCOMå£ï¼Œé€‰æ‹©é¡ºåºç¬¬ä¸‰ä¸ªCOMå£ï¼Œä¸²å£æ³¢ç‰¹ç‡ï¼š921600ã€‚ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> J5èŠ¯ç‰‡æ”¯æŒä¸²å£ï¼Œè½¯ä»¶ç¼ºçœç™»å½•ä¸²å£æ§åˆ¶å°ï¼Œåœ¨PCç«¯å¯ä»¥ç”¨SecureCRT, minicomï¼Œpicocom ç­‰è½¯ä»¶ç™»å½•ã€‚ï¼ˆæ³¨ï¼šç›®å‰é•œåƒä»…æ”¯æŒä¸²å£æ§åˆ¶å°æ³¢ç‰¹ç‡ä¸º921600ï¼Œå¦‚é…ç½®å…¶ä»–çš„æ³¢ç‰¹ç‡éœ€è¦ä¿®æ”¹é•œåƒï¼‰</em></p>
<blockquote>
<p><em>è¡¥å……ï¼š</em></p>
<p><em>ä¸²è¡ŒCOMç«¯å£æ˜¯ä¸€ç§ç”¨äºä¸²è¡Œé€šä¿¡çš„æ¥å£ï¼Œä¹Ÿç§°ä¸ºRS-232æ¥å£ã€‚å®ƒæ˜¯è®¡ç®—æœºä¸å…¶ä»–è®¾å¤‡è¿›è¡Œä¸²è¡Œé€šä¿¡çš„ä¸€ç§æ ‡å‡†æ¥å£ï¼Œé€šå¸¸ç”¨äºè¿æ¥è°ƒåˆ¶è§£è°ƒå™¨ã€æ‰“å°æœºã€ä¼ æ„Ÿå™¨ã€æ‰§è¡Œå™¨ç­‰è®¾å¤‡ã€‚</em></p>
<p><em>è™šæ‹ŸCOMç«¯å£ï¼ˆVCPï¼‰é©±åŠ¨ç¨‹åºæ˜¯ä¸€ç§è½¯ä»¶ç¨‹åºï¼Œå®ƒå¯ä»¥å°†è®¡ç®—æœºçš„USBæ¥å£æ¨¡æ‹Ÿæˆæ ‡å‡†çš„ä¸²è¡ŒCOMç«¯å£ã€‚</em></p>
<p><em>å°†è®¡ç®—æœºçš„USBæ¥å£æ¨¡æ‹Ÿæˆæ ‡å‡†çš„ä¸²è¡ŒCOMç«¯å£æœ‰ä»¥ä¸‹å‡ ä¸ªåŸå› ï¼š</em></p>
<ol>
<li><em>å…¼å®¹æ€§ï¼šè®¸å¤šè€æ—§çš„è®¾å¤‡åªæ”¯æŒä¸²è¡ŒCOMç«¯å£ï¼Œè€Œä¸æ”¯æŒUSBæ¥å£ã€‚é€šè¿‡å°†è®¡ç®—æœºçš„USBæ¥å£æ¨¡æ‹Ÿæˆä¸²è¡ŒCOMç«¯å£ï¼Œå¯ä»¥ä½¿è¿™äº›è€æ—§çš„è®¾å¤‡èƒ½å¤Ÿä¸è®¡ç®—æœºè¿›è¡Œé€šä¿¡ï¼Œä»è€Œå»¶é•¿è®¾å¤‡çš„ä½¿ç”¨å¯¿å‘½ã€‚</em></li>
<li><em>ç®€åŒ–è®¾è®¡ï¼šä¸€äº›æ–°çš„è®¾å¤‡éœ€è¦ä¸è®¡ç®—æœºè¿›è¡Œä¸²è¡Œé€šä¿¡ï¼Œä½†æ˜¯æ²¡æœ‰å†…ç½®çš„ä¸²è¡ŒCOMç«¯å£ï¼Œåªæœ‰USBæ¥å£ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå°†è®¡ç®—æœºçš„USBæ¥å£æ¨¡æ‹Ÿæˆä¸²è¡ŒCOMç«¯å£å¯ä»¥ç®€åŒ–è®¾å¤‡çš„è®¾è®¡ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥æé«˜è®¾å¤‡çš„å…¼å®¹æ€§ã€‚</em></li>
<li><em>å¯é æ€§ï¼šä¸²è¡ŒCOMç«¯å£æ˜¯ä¸€ç§æˆç†Ÿçš„æ ‡å‡†æ¥å£ï¼Œå…·æœ‰å¹¿æ³›çš„åº”ç”¨å’Œæµ‹è¯•ç»éªŒã€‚é€šè¿‡å°†è®¡ç®—æœºçš„USBæ¥å£æ¨¡æ‹Ÿæˆä¸²è¡ŒCOMç«¯å£ï¼Œå¯ä»¥ä¿è¯é€šä¿¡çš„ç¨³å®šæ€§å’Œå¯é æ€§ã€‚</em></li>
</ol>
</blockquote>
<h4 id="SecureCRT"><a href="#SecureCRT" class="headerlink" title="SecureCRT"></a><em>SecureCRT</em></h4><ol>
<li><em>windowsä¸Šéœ€è¦å®‰è£…è™šæ‹ŸCOMç«¯å£ï¼ˆVCPï¼‰é©±åŠ¨ç¨‹åºï¼Œé©±åŠ¨ä¸‹è½½åœ°å€ï¼š <a class="link"   target="_blank" rel="noopener" href="http://www.ftdichip.cn/Drivers/VCP.htm" >http://www.ftdichip.cn/Drivers/VCP.htm <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></em></li>
<li><em>åœ¨protocolä¸‹æ‹‰èœå•ä¸­é€‰æ‹©serial</em></li>
<li><em>é€‰æ‹©portå£ä¸ºæ¿å­è¿æ¥åˆ°ç”µè„‘ä¸Šçš„comå£ï¼Œå¯åœ¨æˆ‘çš„ç”µè„‘&gt;å³é”®å±æ€§&gt;ç¡¬ä»¶&gt;è®¾å¤‡ç®¡ç†å™¨ä¸­æŸ¥çœ‹ï¼Œæ³¢ç‰¹ç‡é€‰æ‹©921600ï¼›æ¿å­è¿æ¥åˆ°ç”µè„‘ä¸Šä¼šæœ‰4ä¸ªCOMå£ï¼Œé€‰æ‹©ç¬¬ä¸‰ä¸ª</em></li>
<li><em>è¿æ¥ç™»å½•</em></li>
</ol>
<h4 id="Minicom"><a href="#Minicom" class="headerlink" title="Minicom"></a><em>Minicom</em></h4><p><em>è¿æ¥ä¸²å£å‘½ä»¤å‚è€ƒå¦‚ä¸‹ï¼š</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">minicom â€“b 921600 â€“D /dev/tty*</span><br></pre></td></tr></table></figure></div>

<h4 id="Picocom"><a href="#Picocom" class="headerlink" title="Picocom"></a><em>Picocom</em></h4><p><em>è¿æ¥ä¸²å£å‘½ä»¤å‚è€ƒå¦‚ä¸‹ï¼š</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">picocom â€“b 921600 /dev/tty*</span><br></pre></td></tr></table></figure></div>

<h4 id="ADB"><a href="#ADB" class="headerlink" title="ADB"></a><em>ADB</em></h4><p><em>æ¿ä¸Šç³»ç»Ÿé»˜è®¤å¼€å§‹ADBè°ƒè¯•ï¼Œåœ¨Micro-USBè¿æ¥pcåï¼Œè®¾å¤‡ç®¡ç†å™¨è‡ªåŠ¨è¯†åˆ«è®¾å¤‡ã€‚ æ¿ä¸Šé…ç½®&#x2F;æŸ¥çœ‹ipåœ°å€ï¼š</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ifconfig eth1 XX.XX.XX.XX</span><br><span class="line">ifconfig -a</span><br></pre></td></tr></table></figure></div>

<p><em>pcç«¯è¿æ¥æ¿ä¸Šç³»ç»Ÿï¼Œè¿›å…¥adb shellã€‚</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">adb connect XX.XX.XX.XX:5555</span><br><span class="line">adb shell</span><br></pre></td></tr></table></figure></div>

<h2 id="ç¼–è¯‘é•œåƒè¯´æ˜"><a href="#ç¼–è¯‘é•œåƒè¯´æ˜" class="headerlink" title="ç¼–è¯‘é•œåƒè¯´æ˜"></a><em>ç¼–è¯‘é•œåƒè¯´æ˜</em></h2><h3 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a><em>ç¯å¢ƒæ­å»º</em></h3><h4 id="å·¥å…·é“¾é…ç½®"><a href="#å·¥å…·é“¾é…ç½®" class="headerlink" title="å·¥å…·é“¾é…ç½®"></a><em>å·¥å…·é“¾é…ç½®</em></h4><p><em>ç”±äºç¼–è¯‘çš„é•œåƒä½¿ç”¨åˆ°æ¿å­ä¸Šï¼Œéœ€è¦ä½¿ç”¨äº¤å‰ç¼–è¯‘å·¥å…·é“¾ï¼Œæ‰èƒ½ä½¿ç¼–è¯‘åçš„é•œåƒåœ¨æ¿å­ä¸Šæ­£å¸¸è¿è¡Œï¼Œè¿™é‡Œä»‹ç»ä¸‹äº¤å‰ç¼–è¯‘å·¥å…·é“¾çš„é€‰æ‹©å’Œé…ç½®ã€‚ äº¤å‰ç¼–è¯‘å·¥å…·é“¾æœ‰å¾ˆå¤šç‰ˆæœ¬ï¼Œæ ¹æ®å®é™…éœ€æ±‚ä½¿ç”¨çš„æ˜¯ gcc-ubuntu-9.3.0-2020.03-x86_64-aarch64-linux-gnu è¿™ä¸ªç‰ˆæœ¬ã€‚Buildç³»ç»Ÿè‡ªå¸¦ä¸€å¥—äº¤å‰ç¼–è¯‘ç¯å¢ƒå¦‚ä¸‹å›¾æ‰€ç¤º:</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ARCH=&quot;arm64&quot;</span><br><span class="line">CROSS_COMPILE=&quot;/home/user.name/platform_sdk/prebuilts/host/gcc-ubuntu-9.3.0-2020.03-x86_64-aarch64-linux-gnu/bin/aarch64-linux-gnu-&quot;</span><br><span class="line">TARGET_VENDOR=&quot;horizon&quot;</span><br><span class="line">TARGET_PROJECT=&quot;j5&quot;</span><br><span class="line">TARGET_MODE=&quot;debug&quot;</span><br><span class="line">TARGET_BIT=&quot;64&quot;</span><br><span class="line">ENABLE_BUILD_DEPENDENCY=&quot;false&quot;</span><br><span class="line">N=&quot;24&quot;</span><br></pre></td></tr></table></figure></div>

<blockquote>
<p><em>äº¤å‰ç¼–è¯‘å·¥å…·é“¾æ˜¯ä¸€ç§å·¥å…·ï¼Œ<strong>å®ƒå¯ä»¥åœ¨ä¸€ä¸ªæ“ä½œç³»ç»Ÿä¸Šç”Ÿæˆå¯åœ¨å¦ä¸€ä¸ªæ“ä½œç³»ç»Ÿä¸Šè¿è¡Œçš„ç¨‹åº</strong>ã€‚è¿™ç§æŠ€æœ¯é€šå¸¸ç”¨äºåµŒå…¥å¼ç³»ç»Ÿå¼€å‘ï¼Œå› ä¸ºåµŒå…¥å¼ç³»ç»Ÿé€šå¸¸ä½¿ç”¨çš„å¤„ç†å™¨å’Œæ“ä½œç³»ç»Ÿä¸å¸¸è§„è®¡ç®—æœºä¸åŒã€‚<strong>äº¤å‰ç¼–è¯‘å·¥å…·é“¾åŒ…æ‹¬ç¼–è¯‘å™¨ã€é“¾æ¥å™¨å’Œåº“ç­‰å·¥å…·</strong>ï¼Œè¿™äº›å·¥å…·å¯ä»¥ç”Ÿæˆå¯åœ¨ç›®æ ‡å¹³å°ä¸Šè¿è¡Œçš„å¯æ‰§è¡Œæ–‡ä»¶æˆ–åº“ã€‚è¿™äº›å·¥å…·é“¾é€šå¸¸ç”±å¼€å‘äººå‘˜è‡ªå·±æ„å»ºï¼Œå› ä¸ºæ¯ä¸ªç›®æ ‡å¹³å°éƒ½æœ‰ä¸åŒçš„è¦æ±‚å’Œé™åˆ¶ã€‚</em></p>
</blockquote>
<blockquote>
<p><em><code>gcc-ubuntu-9.3.0-2020.03-x86_64-aarch64-linux-gnu</code> æ˜¯ä¸€ä¸ªäº¤å‰ç¼–è¯‘å·¥å…·é“¾ï¼Œç”¨äºåœ¨x86_64æ¶æ„çš„Ubuntuç³»ç»Ÿä¸Šç¼–è¯‘ç”Ÿæˆå¯åœ¨aarch64æ¶æ„çš„Linuxç³»ç»Ÿä¸Šè¿è¡Œçš„ç¨‹åºã€‚</em></p>
</blockquote>
<p><em>ä¾‹å¦‚ï¼Œubuntuä¸Šå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ç¼–è¯‘ä¸€ä¸ªCè¯­è¨€ç¨‹åºï¼š</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bashCopy code</span><br><span class="line">aarch64-linux-gnu-gcc -o hello hello.c</span><br></pre></td></tr></table></figure></div>

<p><em><strong>è¿™ä¸ªå‘½ä»¤å°†ç¼–è¯‘åä¸ºhello.cçš„æºæ–‡ä»¶ï¼Œå¹¶ç”Ÿæˆä¸€ä¸ªåä¸ºhelloçš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶å¯ä»¥åœ¨aarch64æ¶æ„çš„Linuxç³»ç»Ÿä¸Šè¿è¡Œã€‚</strong></em></p>
<h5 id="Ubuntu-18-04"><a href="#Ubuntu-18-04" class="headerlink" title="Ubuntu 18.04"></a><em>Ubuntu 18.04</em></h5><p><em>å¯¹äºUbuntu18.04ï¼Œéœ€è¦æŒ‰ç…§ä»¥ä¸‹å‘½ä»¤æ­å»ºå¼€å‘ç¯å¢ƒï¼šå¦‚æœæœ‰å…¶å®ƒæŠ¥é”™ï¼Œè¡¥å……å®‰è£…ç¼ºçš„åŒ…ã€‚</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install build-essential		//å®‰è£…äº†ä¸€ç»„ç¼–è¯‘å·¥å…·ï¼ŒåŒ…æ‹¬GCCç¼–è¯‘å™¨ã€makeã€libc-devç­‰ã€‚è¿™äº›å·¥å…·å¯ä»¥ç”¨äºç¼–è¯‘å’Œæ„å»ºå„ç§C/C++ç¨‹åºã€‚</span><br><span class="line"></span><br><span class="line">sudo apt-get install make				//å®‰è£…äº†GNU Makeå·¥å…·ï¼Œå®ƒæ˜¯ä¸€ä¸ªç”¨äºè‡ªåŠ¨åŒ–æ„å»ºç¨‹åºçš„å·¥å…·ï¼Œå¯ä»¥æ ¹æ®Makefileæ–‡ä»¶æ¥è‡ªåŠ¨ç¼–è¯‘ã€é“¾æ¥å’Œç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶ã€‚</span><br><span class="line"></span><br><span class="line">sudo apt install cmake					//å®‰è£…äº†CMakeå·¥å…·ï¼Œå®ƒæ˜¯ä¸€ä¸ªè·¨å¹³å°çš„è‡ªåŠ¨åŒ–æ„å»ºå·¥å…·ï¼Œå¯ä»¥ç”Ÿæˆå„ç§ä¸åŒçš„æ„å»ºç³»ç»Ÿï¼Œå¦‚Makefileã€Visual Studioé¡¹ç›®ç­‰ã€‚</span><br><span class="line"></span><br><span class="line">sudo apt install bison					//å®‰è£…äº†Bisonå·¥å…·ï¼Œå®ƒæ˜¯ä¸€ä¸ªç”¨äºç”Ÿæˆè¯­æ³•åˆ†æå™¨çš„å·¥å…·ï¼Œå¯ä»¥ç”¨äºç¼–å†™ç¼–è¯‘å™¨ã€è§£é‡Šå™¨ç­‰ç¨‹åºã€‚</span><br><span class="line"></span><br><span class="line">sudo apt install flex					//å®‰è£…äº†Flexå·¥å…·ï¼Œå®ƒæ˜¯ä¸€ä¸ªç”¨äºç”Ÿæˆè¯æ³•åˆ†æå™¨çš„å·¥å…·ï¼Œå¯ä»¥ç”¨äºç¼–å†™ç¼–è¯‘å™¨ã€è§£é‡Šå™¨ç­‰ç¨‹åºã€‚</span><br><span class="line"></span><br><span class="line">sudo apt-get install python-numpy		</span><br><span class="line">sudo apt install android-tools-fsutils		//å®‰è£…äº†Androidç³»ç»Ÿçš„æ–‡ä»¶ç³»ç»Ÿå·¥å…·ï¼ŒåŒ…æ‹¬adbã€fastbootç­‰å·¥å…·ï¼Œå¯ä»¥ç”¨äºä¸Androidè®¾å¤‡è¿›è¡Œäº¤äº’å’Œè°ƒè¯•ã€‚</span><br><span class="line"></span><br><span class="line">sudo apt install mtd-utils				//å®‰è£…äº†Linux MTDï¼ˆMemory Technology Deviceï¼‰å·¥å…·é›†ï¼ŒåŒ…æ‹¬nanddumpã€nandwriteç­‰å·¥å…·ï¼Œå¯ä»¥ç”¨äºä¸é—ªå­˜è®¾å¤‡è¿›è¡Œäº¤äº’å’Œç®¡ç†ã€‚</span><br><span class="line"></span><br><span class="line">sudo apt install zlib1g-dev				//å®‰è£…äº†zlibå‹ç¼©åº“çš„å¼€å‘æ–‡ä»¶ï¼Œå¯ä»¥ç”¨äºåœ¨ç¨‹åºä¸­ä½¿ç”¨zlibåº“è¿›è¡Œæ•°æ®å‹ç¼©å’Œè§£å‹ç¼©ã€‚</span><br><span class="line"></span><br><span class="line">sudo apt install kmod					//å®‰è£…äº†Linuxå†…æ ¸æ¨¡å—å·¥å…·ï¼ŒåŒ…æ‹¬modprobeã€insmodç­‰å·¥å…·ï¼Œå¯ä»¥ç”¨äºåŠ è½½å’Œå¸è½½å†…æ ¸æ¨¡å—ã€‚</span><br><span class="line"></span><br><span class="line">sudo apt install liblz4-tool			//å®‰è£…äº†LZ4å‹ç¼©åº“çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œå¯ä»¥ç”¨äºåœ¨ç»ˆç«¯ä¸­å¯¹æ•°æ®è¿›è¡ŒLZ4å‹ç¼©å’Œè§£å‹ç¼©ã€‚</span><br><span class="line"></span><br><span class="line">sudo apt install libssl-dev				//å®‰è£…äº†OpenSSLåŠ å¯†åº“çš„å¼€å‘æ–‡ä»¶ï¼Œå¯ä»¥ç”¨äºåœ¨ç¨‹åºä¸­ä½¿ç”¨OpenSSLåº“è¿›è¡Œæ•°æ®åŠ å¯†å’Œè§£å¯†ã€‚</span><br><span class="line"></span><br><span class="line">sudo apt install python3-openpyxl		//å®‰è£…äº†Python openpyxlåº“ï¼Œå®ƒæ˜¯ä¸€ä¸ªç”¨äºè¯»å†™Excelæ–‡ä»¶çš„Pythonåº“ï¼Œå¯ä»¥ç”¨äºå¤„ç†Excelæ–‡ä»¶çš„æ•°æ®ã€‚</span><br></pre></td></tr></table></figure></div>

<h5 id="CentOS-7-0"><a href="#CentOS-7-0" class="headerlink" title="CentOS 7.0"></a><em>CentOS 7.0</em></h5><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">yum install glib cmake gcc bison flex minicom python-pip</span><br><span class="line">pip install numpy</span><br><span class="line">yum install make_ext4fs-1.0.0-1.el7.x86_64.rpm</span><br><span class="line">yum install zlib-devel</span><br><span class="line">yum install mtd-utils-1.5.0-2.el6.nux.x86_64.rpm</span><br><span class="line">yum install kmod</span><br><span class="line">yum install liblz4-tool</span><br></pre></td></tr></table></figure></div>

<h4 id="æœåŠ¡å™¨ï¼ˆTFTPï¼‰å»ºç«‹ä¸æ–‡æ¡£ä¼ è¾“"><a href="#æœåŠ¡å™¨ï¼ˆTFTPï¼‰å»ºç«‹ä¸æ–‡æ¡£ä¼ è¾“" class="headerlink" title="æœåŠ¡å™¨ï¼ˆTFTPï¼‰å»ºç«‹ä¸æ–‡æ¡£ä¼ è¾“"></a><em>æœåŠ¡å™¨ï¼ˆTFTPï¼‰å»ºç«‹ä¸æ–‡æ¡£ä¼ è¾“</em></h4><blockquote>
<p><em>FTPçš„ç‰¹ç‚¹åŒ…æ‹¬ï¼š</em></p>
<ol>
<li><em>ç®€å•ï¼šTFTPçš„åè®®è®¾è®¡éå¸¸ç®€å•ï¼Œåªæœ‰å‡ ä¸ªå‘½ä»¤å’Œå‚æ•°ï¼Œæ˜“äºå®ç°å’Œä½¿ç”¨ã€‚</em></li>
<li><em>å¿«é€Ÿï¼šTFTPä½¿ç”¨UDPåè®®ï¼Œæ²¡æœ‰è¿æ¥å»ºç«‹å’Œæ–­å¼€çš„è¿‡ç¨‹ï¼Œå› æ­¤ä¼ è¾“é€Ÿåº¦æ¯”TCPåè®®å¿«ã€‚</em></li>
<li><em>æ˜“äºå®ç°ï¼šTFTPçš„å®ç°éå¸¸ç®€å•ï¼Œåªéœ€è¦ä¸€ä¸ªæ ‡å‡†çš„ç½‘ç»œå¥—æ¥å­—å’Œå‡ ä¸ªå‘½ä»¤å³å¯ã€‚</em></li>
<li><em>å®‰å…¨æ€§è¾ƒå·®ï¼šTFTPæ²¡æœ‰åŠ å¯†å’Œè®¤è¯æœºåˆ¶ï¼Œå› æ­¤ä¼ è¾“çš„æ•°æ®å®¹æ˜“è¢«çªƒå¬å’Œç¯¡æ”¹ã€‚</em></li>
</ol>
<p><em>TFTPç›¸å¯¹äºFTPæ¥è¯´åŠŸèƒ½è¾ƒä¸ºç®€å•ï¼Œä¼ è¾“é€Ÿåº¦è¾ƒå¿«ä½†å¯é æ€§è¾ƒå·®ï¼Œå®‰å…¨æ€§è¾ƒå·®ã€‚FTPåŠŸèƒ½æ›´ä¸ºä¸°å¯Œï¼Œä¼ è¾“é€Ÿåº¦è¾ƒæ…¢ä½†å¯é æ€§æ›´é«˜ï¼Œå®‰å…¨æ€§æ›´å¥½ã€‚é€‰æ‹©å“ªç§åè®®å–å†³äºå…·ä½“çš„åº”ç”¨åœºæ™¯å’Œéœ€æ±‚ã€‚</em></p>
</blockquote>
<h5 id="windows"><a href="#windows" class="headerlink" title="windows"></a><em>windows</em></h5><p><em>Windowså¯ä»¥ä½¿ç”¨ï¼štftp_win32ã€tftpd64æˆ–ä»»æ„Windowsä¸‹çš„tftpæœåŠ¡å™¨ç¨‹åºã€‚</em></p>
<h5 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a><em>Linux</em></h5><p><em>Linuxä¸‹éœ€è¦æ­å»ºtftp serverç¯å¢ƒï¼š</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install tftpd-hpa</span><br><span class="line">sudo mkdir /tftpboot</span><br><span class="line"># ç¼–è¾‘tftpd-hpaè®¾ç½®</span><br><span class="line">sudo vi /etc/default/tftpd-hpa					//è¿™ä¸ªå‘½ä»¤ç”¨viç¼–è¾‘å™¨æ‰“å¼€æ–‡ä»¶ /etc/default/tftpd-hpaï¼Œè¿™æ˜¯tftpd-hpaçš„é…ç½®æ–‡ä»¶ã€‚åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­ï¼Œä½ å¯ä»¥è®¾ç½®TFTPæœåŠ¡å™¨çš„ä¸€äº›é€‰é¡¹ï¼Œå¦‚TFTPæœåŠ¡å™¨çš„æ ¹ç›®å½•ï¼ŒIPåœ°å€å’Œç«¯å£ç­‰</span><br></pre></td></tr></table></figure></div>

<p><em>è¿›å…¥viç¼–è¾‘ç•Œé¢åï¼Œå°†ä»¥ä¸‹å†…å®¹é”®å…¥æ–‡ä»¶ï¼ŒæœåŠ¡å™¨æ ¹æ–‡ä»¶å¤¹å°†ä¼šè¢«è®¾ç½®ä¸ºï¼šâ€œ&#x2F;tftpbootâ€</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">TFTP_USERNAME=&quot;tftp&quot;</span><br><span class="line">TFTP_DIRECTORY=&quot;/tftpboot&quot;</span><br><span class="line">TFTP_ADDRESS=&quot;[::]:69&quot;		//è¿™ä¸ªå˜é‡è®¾ç½®TFTPæœåŠ¡å™¨ç›‘å¬çš„IPåœ°å€å’Œç«¯å£å·ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒTFTPæœåŠ¡å™¨å°†ç›‘å¬æ‰€æœ‰å¯ç”¨çš„IPv4å’ŒIPv6åœ°å€ï¼Œå¹¶ä½¿ç”¨æ ‡å‡†TFTPç«¯å£å·69ã€‚</span><br><span class="line"></span><br><span class="line">TFTP_OPTIONS=&quot;-l -c -s&quot;		// è¿™ä¸ªå˜é‡è®¾ç½®TFTPæœåŠ¡å™¨çš„ä¸€äº›é€‰é¡¹ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œé€‰é¡¹ -l è¡¨ç¤ºå¯ç”¨æ—¥å¿—è®°å½•ï¼Œé€‰é¡¹ -c è¡¨ç¤ºå…è®¸å®¢æˆ·ç«¯ä¸Šä¼ æ–‡ä»¶ï¼Œé€‰é¡¹ -s è¡¨ç¤ºå°†TFTPæœåŠ¡å™¨è§†ä¸ºä¸€ä¸ªâ€œå®‰å…¨â€æœåŠ¡å™¨ï¼Œè¿™æ„å‘³ç€å®ƒåªä¼šå…è®¸è®¿é—®TFTPæ ¹ç›®å½•ä¸‹çš„æ–‡ä»¶ã€‚</span><br></pre></td></tr></table></figure></div>

<p><em>é…ç½®pcç«¯ipä¸ºxx.xx.xx.xxï¼š</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ifconfig xx.xx.xx.xx</span><br></pre></td></tr></table></figure></div>

<p><em>é‡å¯tftpæœåŠ¡å™¨å¹¶åº”ç”¨é…ç½®ï¼š</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo service tftpd-hpa restart</span><br></pre></td></tr></table></figure></div>

<p><em>å†…æ ¸ç›¸å…³é•œåƒæ”¾åˆ°&#x2F;tftpbootç›®å½•ã€‚ <strong>åœ¨æ¿ç«¯UBootä¸­ï¼š</strong></em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">setenv serverip xx.xx.xx.xx</span><br><span class="line">setenv ipaddr xx.xx.xx.yy /*ä¸ä¸»æœºåŒç½‘æ®µip*/</span><br></pre></td></tr></table></figure></div>

<p><em>è®¾ç½®tftpä¼ è¾“æ–‡ä»¶å‚¨å­˜çš„DDRåœ°å€ï¼š<strong>è¿™äº›å‘½ä»¤æ˜¯ç”¨äºé€šè¿‡TFTPæœåŠ¡å™¨å°†æ–‡ä»¶å†™å…¥åµŒå…¥å¼è®¾å¤‡çš„MMCå­˜å‚¨å™¨ä¸­ï¼Œå¹¶é‡å¯è®¾å¤‡ã€‚</strong></em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">setenv target_addr 0x6000000		//è¿™ä¸ªå‘½ä»¤è®¾ç½®å˜é‡ target_addr çš„å€¼ä¸º 0x6000000ã€‚è¿™ä¸ªå˜é‡å°†ç”¨äºå­˜å‚¨ä»TFTPæœåŠ¡å™¨ä¸‹è½½çš„æ–‡ä»¶çš„å†…å­˜åœ°å€ã€‚</span><br><span class="line"></span><br><span class="line">tftp $&#123;target_addr&#125; &lt;ç›®æ ‡æ–‡ä»¶åœ¨tftpæœåŠ¡å™¨ç›®å½•çš„ç›¸å¯¹è·¯å¾„&gt;		//è¿™ä¸ªå‘½ä»¤ä½¿ç”¨TFTPåè®®ä»TFTPæœåŠ¡å™¨ä¸‹è½½æ–‡ä»¶ï¼Œå¹¶å°†æ–‡ä»¶å­˜å‚¨åˆ°å˜é‡ target_addr æŒ‡å®šçš„å†…å­˜åœ°å€ä¸­ã€‚</span><br><span class="line"></span><br><span class="line">mmc write $&#123;target_addr&#125; 0x0 &lt;æ–‡ä»¶æ€»å—æ•°ï¼ˆ512Bä¸ºä¸€å—ï¼‰&gt;		//è¿™ä¸ªå‘½ä»¤å°†ä»TFTPæœåŠ¡å™¨ä¸‹è½½çš„æ–‡ä»¶å†™å…¥åµŒå…¥å¼è®¾å¤‡çš„MMCå­˜å‚¨å™¨ä¸­ã€‚$&#123;target_addr&#125; æ˜¯ä»TFTPæœåŠ¡å™¨ä¸‹è½½çš„æ–‡ä»¶çš„å†…å­˜åœ°å€ï¼Œ0x0 æ˜¯MMCå­˜å‚¨å™¨ä¸­å†™å…¥æ–‡ä»¶çš„èµ·å§‹å—åœ°å€ï¼Œ</span><br><span class="line"></span><br><span class="line">reset								//è¿™ä¸ªå‘½ä»¤é‡å¯åµŒå…¥å¼è®¾å¤‡ã€‚</span><br></pre></td></tr></table></figure></div>

<h4 id="æœåŠ¡å™¨ï¼ˆNFSï¼‰å»ºç«‹ä¸æ–‡æ¡£ä¼ è¾“"><a href="#æœåŠ¡å™¨ï¼ˆNFSï¼‰å»ºç«‹ä¸æ–‡æ¡£ä¼ è¾“" class="headerlink" title="æœåŠ¡å™¨ï¼ˆNFSï¼‰å»ºç«‹ä¸æ–‡æ¡£ä¼ è¾“"></a><em>æœåŠ¡å™¨ï¼ˆNFSï¼‰å»ºç«‹ä¸æ–‡æ¡£ä¼ è¾“</em></h4><blockquote>
<p><em>NFSï¼ˆNetwork File Systemï¼‰æ˜¯ä¸€ç§åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿåè®®ï¼Œå®ƒå…è®¸åœ¨ç½‘ç»œä¸Šçš„ä¸åŒè®¡ç®—æœºä¹‹é—´å…±äº«æ–‡ä»¶å’Œç›®å½•ã€‚</em></p>
</blockquote>
<p><em>åœ¨æ¿å­ä¸Šæ‰§è¡Œåº”ç”¨ç¨‹åºï¼Œç”¨è¿™ç§æ–¹å¼å¾ˆä¾¿æ·ã€‚æŠŠåº”ç”¨ç¨‹åºæ”¾åˆ° pc æœºçš„æŸä¸ªç›®å½•ï¼Œæ¯”å¦‚ &#x2F;home&#x2F;$USER&#x2F;nfsç›®å½•ï¼Œæ¿å­ä¾§æŒ‚è½½å®Œä»¥åï¼Œå¯ä»¥çœ‹åˆ°pcæœºä¸Šçš„å†…å®¹ï¼Œå¯ä»¥ç›´æ¥æ‰§è¡Œåº”ç”¨ ç¨‹åºï¼ˆéœ€è¦åº“çš„è¯æ‹·è´åˆ°&#x2F;libç›®å½•ä¸‹ï¼‰ã€‚</em></p>
<h5 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a><em>Windows</em></h5><p><em>åœ¨PCå†…é…ç½®nfsæœåŠ¡å™¨ï¼Œä¸‹è½½å®‰è£…nfs1169â€“.zipã€‚</em></p>
<h5 id="Linux-1"><a href="#Linux-1" class="headerlink" title="Linux"></a><em>Linux</em></h5><p><em>å®‰è£…NFSï¼š</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install nfs-kernel-server</span><br></pre></td></tr></table></figure></div>

<p><em>é…ç½®ï¼šè¿™äº›å‘½ä»¤çš„æ•ˆæœæ˜¯å°† <code>/home/$USER/nfs</code> ç›®å½•å…±äº«ç»™æ‰€æœ‰IPåœ°å€ä»¥ <code>xx.xx</code> å¼€å¤´çš„å®¢æˆ·ç«¯ï¼Œè¿™äº›å®¢æˆ·ç«¯å°†å…·æœ‰è¯»å†™è®¿é—®æƒé™ï¼Œå¹¶ä¸”rootç”¨æˆ·å°†å…·æœ‰è®¿é—®è¿™ä¸ªå…±äº«èµ„æºçš„æƒé™ã€‚</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cd ~</span><br><span class="line">mkdir nfs</span><br><span class="line">sudo vim /etc/exports</span><br><span class="line"></span><br><span class="line">/home/$USER/nfs xx.xx.*.*(sync,rw,no_root_squash)		///home/$USER/nfs ç›®å½•è¢«æŒ‡å®šä¸ºè¦å…±äº«çš„ç›®å½•ï¼Œxx.xx.*.* æ˜¯å…è®¸è®¿é—®è¿™ä¸ªç›®å½•çš„å®¢æˆ·ç«¯IPåœ°å€çš„é€šé…ç¬¦ï¼Œsync,rw,no_root_squash æ˜¯æŒ‡å®šNFSå…±äº«é€‰é¡¹çš„è®¾ç½®ï¼Œå…¶ä¸­ sync è¡¨ç¤ºåŒæ­¥å†™å…¥ï¼Œrw è¡¨ç¤ºè¯»å†™è®¿é—®ï¼Œ</span><br><span class="line"></span><br><span class="line">sudo exportfs -a									//è¿™ä¸ªå‘½ä»¤å°†åœ¨NFSæœåŠ¡å™¨ä¸Šå¯ç”¨æ‰€æœ‰åœ¨ /etc/exports æ–‡ä»¶ä¸­å®šä¹‰çš„å…±äº«èµ„æºã€‚</span><br></pre></td></tr></table></figure></div>

<p><em>é‡å¯rpcbindæœåŠ¡ï¼š</em></p>
<blockquote>
<p><em>rpcbindæœåŠ¡é€šå¸¸åœ¨Unix&#x2F;Linuxæ“ä½œç³»ç»Ÿä¸­ä¸NFSï¼ˆNetwork File Systemï¼‰ä¸€èµ·ä½¿ç”¨ï¼Œå› ä¸ºNFSä½¿ç”¨RPCåè®®è¿›è¡Œé€šä¿¡ã€‚åœ¨NFSä¸­ï¼Œå®¢æˆ·ç«¯éœ€è¦çŸ¥é“NFSæœåŠ¡å™¨ä¸Šçš„å…±äº«ç›®å½•å’Œæ–‡ä»¶çš„RPCç¨‹åºå·å’Œç«¯å£å·ï¼Œä»¥ä¾¿èƒ½å¤Ÿè®¿é—®å®ƒä»¬ã€‚rpcbindæœåŠ¡å¯ä»¥æä¾›è¿™äº›ä¿¡æ¯ï¼Œä½¿å¾—å®¢æˆ·ç«¯å¯ä»¥è¿æ¥åˆ°NFSæœåŠ¡å™¨å¹¶è®¿é—®å…±äº«èµ„æºã€‚</em></p>
<p><em>åœ¨NFSä¸­ï¼ŒrpcbindæœåŠ¡è¿˜å¯ä»¥ç®¡ç†NFSæœåŠ¡çš„æ³¨å†Œå’Œæ³¨é”€ï¼Œä»¥åŠå¤„ç†NFSæœåŠ¡çš„ç‰ˆæœ¬æ§åˆ¶ã€‚</em></p>
</blockquote>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo service rpcbind restart</span><br></pre></td></tr></table></figure></div>

<p><em>é‡å¯nfsæœåŠ¡ï¼š</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo service nfs-kernel-server restart</span><br></pre></td></tr></table></figure></div>

<p><em>é…ç½®ipï¼š</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ifconfig eth1 xx.xx.xx.xx netmask 255.255.255.0</span><br></pre></td></tr></table></figure></div>

<p><em>æŒ‚è½½PCæœåŠ¡å™¨æ–‡ä»¶å¤¹äºâ€œ&#x2F;mnt&#x2F;nfsâ€</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /mnt/nfs</span><br><span class="line">mount -t nfs -o nolock xx.xx.xx.xx:/home/$USER/nfs /mnt/nfs</span><br></pre></td></tr></table></figure></div>

<p><em>æŒ‚è½½æˆåŠŸåï¼ŒPCä¸Šnfsæ–‡ä»¶å¤¹å†…æ–‡ä»¶å¯ä»¥ç›´æ¥åœ¨æ¿ç«¯è¿›è¡Œè¯»å–&#x2F;å†™å…¥&#x2F;æ‰§è¡Œç­‰æ“ä½œï¼ˆé…ç½®æƒé™åï¼‰</em></p>
<h3 id="ç¼–è¯‘å‘½ä»¤"><a href="#ç¼–è¯‘å‘½ä»¤" class="headerlink" title="ç¼–è¯‘å‘½ä»¤"></a><em>ç¼–è¯‘å‘½ä»¤</em></h3><p><em>æ­å»ºå¥½å¼€å‘ç¯å¢ƒåï¼Œä¸‹è½½ä»£ç åˆ°ä½ çš„å¼€å‘ç¯å¢ƒä¸­ï¼Œä½¿ç”¨å¦‚ä¸‹å‘½ä»¤è¿›è¡Œæ•´ä½“ç¼–è¯‘ã€‚</em></p>
<p><em><strong>è¿™äº›æŒ‡ä»¤æ˜¯ç”¨äºåœ¨Linuxç³»ç»Ÿä¸Šç¼–è¯‘ä¸€ä¸ªåä¸º <code>platform_sdk</code> çš„è½¯ä»¶å¼€å‘å·¥å…·åŒ…ã€‚</strong></em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">user.name@server-1:~/work/pull/platform_sdk$ source build/envsetup.sh		//è¿™ä¸ªå‘½ä»¤è¿è¡Œ envsetup.sh è„šæœ¬ï¼Œå®ƒä¼šè®¾ç½®ä¸€äº›ç¯å¢ƒå˜é‡å’Œå‡½æ•°ï¼Œä»¥ä¾¿ç¼–è¯‘å·¥ä½œæ­£å¸¸è¿›è¡Œã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œenvsetup.sh è„šæœ¬è¢«è¿è¡Œåœ¨ /home/user.name/work/pull/platform_sdk ç›®å½•ä¸‹ã€‚</span><br><span class="line"></span><br><span class="line">TOPDIR: /home/user.name/work/pull/platform_sdk		//è¿™ä¸ªå‘½ä»¤è¾“å‡ºå˜é‡ TOPDIR çš„å€¼ï¼Œå®ƒæ˜¯æŒ‡ç¼–è¯‘å·¥å…·åŒ…çš„é¡¶çº§ç›®å½•ã€‚</span><br><span class="line"></span><br><span class="line">including device/horizon/j5/vendorsetup.sh		// è¿™ä¸ªå‘½ä»¤åŒ…å« vendorsetup.sh è„šæœ¬ï¼Œå®ƒä¼šè®¾ç½®ä¸€äº›ç¯å¢ƒå˜é‡å’Œå‡½æ•°ï¼Œä»¥ä¾¿ç¼–è¯‘ç‰¹å®šçš„è®¾å¤‡ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œvendorsetup.sh è„šæœ¬è¢«åŒ…å«åœ¨ device/horizon/j5 ç›®å½•ä¸‹ã€‚</span><br><span class="line"></span><br><span class="line">including device/horizon/matrix5/vendorsetup.sh		//è¿™ä¸ªå‘½ä»¤åŒ…å« vendorsetup.sh è„šæœ¬ï¼Œå®ƒä¼šè®¾ç½®ä¸€äº›ç¯å¢ƒå˜é‡å’Œå‡½æ•°ï¼Œä»¥ä¾¿ç¼–è¯‘ç‰¹å®šçš„è®¾å¤‡ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œvendorsetup.sh è„šæœ¬è¢«åŒ…å«åœ¨ device/horizon/matrix5 ç›®å½•ä¸‹ã€‚</span><br><span class="line"></span><br><span class="line">. /home/user.name/work/pull/platform_sdk/build/core/mainenv.sh		//è¿™ä¸ªå‘½ä»¤è¿è¡Œ mainenv.sh è„šæœ¬ï¼Œå®ƒä¼šè®¾ç½®ä¸€äº›ç¯å¢ƒå˜é‡å’Œå‡½æ•°ï¼Œä»¥ä¾¿ç¼–è¯‘å·¥ä½œæ­£å¸¸è¿›è¡Œã€‚</span><br><span class="line"></span><br><span class="line">user.name@server-1:~/work/pull/platform_sdk/build$ lunch		//è¿™ä¸ªå‘½ä»¤è¿è¡Œ lunch è„šæœ¬ï¼Œå®ƒä¼šæ˜¾ç¤ºä¸€ä¸ªèœå•ï¼Œè®©ç”¨æˆ·é€‰æ‹©è¦ç¼–è¯‘çš„ç›®æ ‡è®¾å¤‡å’Œç¼–è¯‘é€‰é¡¹ã€‚</span><br><span class="line"></span><br><span class="line">You&#x27;re building on Linux echo</span><br><span class="line">Lunch menu... pick a combo:</span><br><span class="line">     1. horizon_j5-debug_gcc9.64</span><br><span class="line">     2. horizon_j5-release_gcc9.64</span><br><span class="line">     3. horizon_matrix5-debug_gcc9.64</span><br><span class="line">     4. horizon_matrix5-release_gcc9.64</span><br><span class="line"></span><br><span class="line">Which would you like?  1</span><br><span class="line">64-bit</span><br><span class="line">Debug_gcc9.3 Mode</span><br><span class="line">. /home/user.name/work/pull/platform_sdk/build/device/horizon/j5/debug_gcc9-env.sh</span><br><span class="line">******************************</span><br><span class="line">start to make tools</span><br><span class="line">make: Entering directory &#x27;/home/user.name/work/pull/platform_sdk/build/tools/pkgtool&#x27;</span><br><span class="line">make: &#x27;j5-imgpkg&#x27; is up to date.</span><br><span class="line">make: Leaving directory &#x27;/home/user.name/work/pull/platform_sdk/build/tools/pkgtool&#x27;</span><br><span class="line">has extracted gcc-ubuntu-9.3.0-2020.03-x86_64-aarch64-linux-gnu</span><br><span class="line">end make tools</span><br><span class="line">******************************</span><br><span class="line">=========================================</span><br><span class="line">ARCH=&quot;arm64&quot;</span><br><span class="line">CROSS_COMPILE=&quot;/home/user.name/work/pull/platform_sdk/prebuilts/host/gcc-ubuntu-9.3.0-2020.03-x86_64-aarch64-linux-gnu/bin/aarch64-linux-gnu-&quot;</span><br><span class="line">TARGET_VENDOR=&quot;horizon&quot;</span><br><span class="line">TARGET_PROJECT=&quot;j5&quot;</span><br><span class="line">TARGET_MODE=&quot;debug&quot;</span><br><span class="line">TARGET_BIT=&quot;64&quot;</span><br><span class="line">ENABLE_BUILD_DEPENDENCY=&quot;false&quot;</span><br><span class="line">N=&quot;24&quot;</span><br><span class="line">=========================================</span><br><span class="line"></span><br><span class="line">user.name@CP:~/work/pull/platform_sdk/build$ ./build.sh -e all		//è¿™ä¸ªå‘½ä»¤è¿è¡Œ build.sh è„šæœ¬ï¼Œå®ƒä¼šå¼€å§‹ç¼–è¯‘å·¥ä½œã€‚-e all å‚æ•°è¡¨ç¤ºè¦ç¼–è¯‘æ‰€æœ‰çš„ç›®æ ‡æ–‡ä»¶å’Œåº“ã€‚</span><br></pre></td></tr></table></figure></div>

<p><em><strong>ç”Ÿæˆçš„æ–‡ä»¶åœ¨out&#x2F;target&#x2F;product&#x2F;packages&#x2F;ä¸­ã€‚</strong></em></p>
<p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230417100729900.png"
                      class="" title="image-20230417100729900"
                ></em></p>
<h3 id="ç¼–è¯‘å‚æ•°"><a href="#ç¼–è¯‘å‚æ•°" class="headerlink" title="ç¼–è¯‘å‚æ•°"></a><em>ç¼–è¯‘å‚æ•°</em></h3><ul>
<li><em>J5-dvbæ¿é€šç”¨é•œåƒ(åŒ…å«emmcå’Œnor-flashé•œåƒ)</em></li>
</ul>
<blockquote>
<p><em>eMMCï¼ˆEmbedded MultiMediaCardï¼‰æ˜¯ä¸€ç§å†…ç½®å¼å¤šåª’ä½“å¡ï¼Œå®ƒæ˜¯ä¸€ç§é’ˆå¯¹åµŒå…¥å¼ç³»ç»Ÿçš„å­˜å‚¨è®¾å¤‡ã€‚eMMCå­˜å‚¨å™¨é€šå¸¸è¢«ç”¨äºåµŒå…¥å¼ç³»ç»Ÿä¸­ï¼Œä¾‹å¦‚æ™ºèƒ½æ‰‹æœºã€å¹³æ¿ç”µè„‘ã€æ™ºèƒ½ç”µè§†ã€æœºé¡¶ç›’ç­‰è®¾å¤‡ã€‚eMMCå­˜å‚¨å™¨é€šå¸¸åŒ…æ‹¬ä¸€ä¸ªé—ªå­˜å­˜å‚¨èŠ¯ç‰‡å’Œä¸€ä¸ªæ§åˆ¶å™¨èŠ¯ç‰‡ï¼Œå®ƒä»¬ä¸€èµ·ç»„æˆäº†ä¸€ä¸ªå­˜å‚¨è®¾å¤‡ã€‚</em></p>
<p><em>eMMCé•œåƒæ˜¯æŒ‡å°†ä¸€ä¸ªå®Œæ•´çš„ç³»ç»Ÿé•œåƒå†™å…¥åˆ°eMMCå­˜å‚¨å™¨ä¸­çš„è¿‡ç¨‹ã€‚é€šå¸¸ï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯é€šè¿‡ä¸€ä¸ªä¸“é—¨çš„å·¥å…·æˆ–è€…ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·æ¥å®Œæˆçš„ã€‚eMMCé•œåƒåŒ…æ‹¬æ“ä½œç³»ç»Ÿã€é©±åŠ¨ç¨‹åºã€åº”ç”¨ç¨‹åºå’Œå…¶ä»–ç›¸å…³æ–‡ä»¶ï¼Œè¿™äº›æ–‡ä»¶è¢«å†™å…¥åˆ°eMMCå­˜å‚¨å™¨ä¸­ï¼Œä»¥ä¾¿åœ¨åµŒå…¥å¼ç³»ç»Ÿä¸­å¯åŠ¨å’Œè¿è¡Œã€‚</em></p>
<p><em>åœ¨åµŒå…¥å¼ç³»ç»Ÿä¸­ï¼ŒeMMCå­˜å‚¨å™¨é€šå¸¸è¢«ç”¨ä½œä¸»è¦çš„å­˜å‚¨è®¾å¤‡ï¼Œå› ä¸ºå®ƒå…·æœ‰é«˜é€Ÿã€ä½åŠŸè€—ã€å°å°ºå¯¸ç­‰ä¼˜ç‚¹ã€‚é€šè¿‡å°†ç³»ç»Ÿé•œåƒå†™å…¥åˆ°eMMCå­˜å‚¨å™¨ä¸­ï¼Œå¯ä»¥æ–¹ä¾¿åœ°è¿›è¡Œç³»ç»Ÿçš„å¤‡ä»½å’Œæ¢å¤ï¼Œä¹Ÿå¯ä»¥æ–¹ä¾¿åœ°è¿›è¡Œç³»ç»Ÿçš„å‡çº§å’Œæ›´æ–°ã€‚</em></p>
</blockquote>
<blockquote>
<p><em>Nor Flashæ˜¯ä¸€ç§éæ˜“å¤±æ€§å­˜å‚¨å™¨ï¼Œå®ƒé€šå¸¸è¢«ç”¨äºåµŒå…¥å¼ç³»ç»Ÿä¸­ï¼Œä¾‹å¦‚è·¯ç”±å™¨ã€ç‰©è”ç½‘è®¾å¤‡ã€å·¥æ§è®¾å¤‡ç­‰ã€‚</em></p>
<p><em>ä¸eMMCå­˜å‚¨å™¨ç›¸æ¯”ï¼Œ<strong>Nor Flashå­˜å‚¨å™¨çš„ä¸»è¦ä¼˜ç‚¹æ˜¯è¯»å–é€Ÿåº¦æ›´å¿«ï¼Œè€Œä¸”å¯ä»¥ç›´æ¥åœ¨ç³»ç»Ÿä¸­æ‰§è¡Œä»£ç </strong>ã€‚Nor Flashå­˜å‚¨å™¨é€šå¸¸è¢«ç”¨ä½œåµŒå…¥å¼ç³»ç»Ÿçš„å¯åŠ¨è®¾å¤‡ï¼Œå› ä¸ºå®ƒå¯ä»¥æä¾›å¿«é€Ÿçš„å¯åŠ¨æ—¶é—´å’Œå¯é çš„å¯åŠ¨è¿‡ç¨‹ã€‚é€šè¿‡å°†ç³»ç»Ÿé•œåƒå†™å…¥åˆ°Nor Flashå­˜å‚¨å™¨ä¸­ï¼Œå¯ä»¥æ–¹ä¾¿åœ°è¿›è¡Œç³»ç»Ÿçš„å¤‡ä»½å’Œæ¢å¤ï¼Œä¹Ÿå¯ä»¥æ–¹ä¾¿åœ°è¿›è¡Œç³»ç»Ÿçš„å‡çº§å’Œæ›´æ–°</em></p>
</blockquote>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">source build/envsetup.sh</span><br><span class="line">lunch 1  # horizon_j5-debug_gcc9.64</span><br><span class="line">./build.sh -e all</span><br></pre></td></tr></table></figure></div>

<blockquote>
<p><em><code>source</code>å‘½ä»¤ä¼šè¯»å–æŒ‡å®šçš„è„šæœ¬æ–‡ä»¶ï¼Œå¹¶å°†å…¶ä¸­çš„å‘½ä»¤å’Œå˜é‡åŠ è½½åˆ°å½“å‰shellç¯å¢ƒä¸­ã€‚è¿™æ„å‘³ç€ï¼Œå¦‚æœä½ åœ¨è„šæœ¬æ–‡ä»¶ä¸­è®¾ç½®äº†ç¯å¢ƒå˜é‡ï¼Œé‚£ä¹ˆåœ¨æ‰§è¡Œå®Œ<code>source</code>å‘½ä»¤åï¼Œè¿™äº›ç¯å¢ƒå˜é‡å°±ä¼šåœ¨å½“å‰shellä¼šè¯ä¸­ç”Ÿæ•ˆã€‚</em></p>
<p><em><code>source</code>å‘½ä»¤ä¹Ÿå¯ä»¥ç”¨<code>.</code>æ¥ä»£æ›¿ï¼Œå®ƒä»¬çš„ä½œç”¨æ˜¯å®Œå…¨ç›¸åŒçš„ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ æœ‰ä¸€ä¸ªåä¸º<code>my_script.sh</code>çš„è„šæœ¬æ–‡ä»¶ï¼Œç”¨<code>. my_script.sh</code>æ‰§è¡Œè„šæœ¬</em></p>
<p><em>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<code>source</code>å‘½ä»¤åªå¯¹å½“å‰shellä¼šè¯æœ‰æ•ˆã€‚å¦‚æœä½ åœ¨ä¸€ä¸ªå­shellä¸­æ‰§è¡Œ<code>source</code>å‘½ä»¤ï¼Œé‚£ä¹ˆå…¶ä¸­çš„ç¯å¢ƒå˜é‡å’Œå…¶ä»–é…ç½®åªä¼šåœ¨è¯¥å­shellä¸­ç”Ÿæ•ˆï¼Œè€Œä¸ä¼šå½±å“åˆ°çˆ¶shellæˆ–å…¶ä»–shellä¼šè¯ã€‚</em></p>
</blockquote>
<p><em>ç»“æœå¦‚ä¸‹ï¼š</em></p>
<p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230417100729900.png"
                      class="" title="image-20230417100729900"
                ></em></p>
<ul>
<li><em>J5-dvbæ¿nor-flashé•œåƒ</em></li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">source build/envsetup.sh</span><br><span class="line">lunch 1   # horizon_j5-debug_gcc9.64</span><br><span class="line">./build.sh -e all â€“b j5dvb_nor</span><br></pre></td></tr></table></figure></div>

<ul>
<li><em>J5-dvbæ¿hyper-flashé•œåƒ</em></li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">source build/envsetup.sh</span><br><span class="line">lunch 1    # horizon_j5-debug_gcc9.64				//å‘½ä»¤ç”¨äºé€‰æ‹©è¦æ„å»ºçš„ç›®æ ‡è®¾å¤‡å’Œæ„å»ºç±»å‹ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œhorizon_j5-debug_gcc9.64æ˜¯ä¸€ä¸ªæ„å»ºç±»å‹ï¼Œå®ƒæŒ‡å®šäº†ä¸€ä¸ªåä¸ºhorizon_j5çš„è®¾å¤‡ï¼Œå¹¶ä½¿ç”¨debugæ„å»ºç±»å‹å’Œgcc9.64ç¼–è¯‘å™¨ã€‚è¿™ä¸ªå‘½ä»¤ä¼šè®¾ç½®ä¸€äº›ç¯å¢ƒå˜é‡ï¼Œä»¥ä¾¿åœ¨åç»­çš„æ„å»ºè¿‡ç¨‹ä¸­ä½¿ç”¨ã€‚</span><br><span class="line"></span><br><span class="line">./build.sh -e all â€“b j5dvb_hyper			//-e allé€‰é¡¹æŒ‡å®šè¦æ„å»ºçš„æ¨¡å—ï¼Œâ€“b j5dvb_hyperé€‰é¡¹æŒ‡å®šè¦æ„å»ºçš„ç›®æ ‡å¹³å°ã€‚</span><br></pre></td></tr></table></figure></div>

<ul>
<li><em>J5-dvbæ¿ç¼–è¯‘å®¢æˆ·è‡ªå®šä¹‰app</em></li>
</ul>
<p><em>éœ€è¦å®¢æˆ·åœ¨æºç æ ¹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªç›®å½•ï¼Œå­˜æ”¾å·²ç»ç¼–è¯‘å¥½çš„ç¨‹åºï¼Œæ¯”å¦‚vendorç›®å½•ï¼Œç¼–è¯‘æ‰“åŒ…å¦‚ä¸‹ï¼š</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">source build/envsetup.sh</span><br><span class="line">lunch 1    # horizon_j5-debug_gcc9.64</span><br><span class="line">./build.sh -e all â€“a vendor			//-a vendoræŒ‡çš„æ˜¯å°†ç¼–è¯‘å¥½çš„ç¨‹åºå­˜æ”¾åœ¨vendorä¸­</span><br></pre></td></tr></table></figure></div>

<ul>
<li><em>RTå’ŒéRTç‰ˆæœ¬ç¼–è¯‘</em></li>
</ul>
<blockquote>
<p><em>RTå’ŒéRTç‰ˆæœ¬ç¼–è¯‘é€šå¸¸æ˜¯æŒ‡åŸºäºå®æ—¶æ“ä½œç³»ç»Ÿï¼ˆRTOSï¼‰å’Œæ™®é€šæ“ä½œç³»ç»Ÿçš„ç¼–è¯‘æ–¹å¼ã€‚</em></p>
<p><em>RTè¡¨ç¤ºReal-Timeï¼ˆå®æ—¶ï¼‰ï¼ŒRTOSè¡¨ç¤ºå®æ—¶æ“ä½œç³»ç»Ÿã€‚å®æ—¶æ“ä½œç³»ç»Ÿæ˜¯ä¸€ç§ç‰¹æ®Šçš„æ“ä½œç³»ç»Ÿï¼Œå®ƒèƒ½å¤Ÿä¿è¯ç³»ç»Ÿå¯¹å¤–éƒ¨äº‹ä»¶çš„å“åº”æ—¶é—´ï¼Œåœ¨ç‰¹å®šæ—¶é—´å†…å®Œæˆä»»åŠ¡çš„æ‰§è¡Œã€‚RTOSé€šå¸¸ç”¨äºåµŒå…¥å¼ç³»ç»Ÿã€å·¥ä¸šè‡ªåŠ¨åŒ–ã€åŒ»ç–—è®¾å¤‡ç­‰é¢†åŸŸï¼Œè¦æ±‚ç³»ç»Ÿå¯¹å¤–éƒ¨äº‹ä»¶çš„å“åº”æ—¶é—´éå¸¸å¿«ã€‚RTç‰ˆæœ¬ç¼–è¯‘é€šå¸¸æŒ‡åŸºäºå®æ—¶æ“ä½œç³»ç»Ÿçš„ç¼–è¯‘æ–¹å¼ï¼Œå®ƒå¯ä»¥ä¿è¯ç³»ç»Ÿå¯¹å¤–éƒ¨äº‹ä»¶çš„å“åº”æ—¶é—´ï¼Œæé«˜ç³»ç»Ÿçš„å®æ—¶æ€§å’Œå¯é æ€§ã€‚åœ¨RTç‰ˆæœ¬ç¼–è¯‘ä¸­ï¼Œç¼–è¯‘å™¨å’Œé“¾æ¥å™¨ä¼šä½¿ç”¨ç‰¹æ®Šçš„é€‰é¡¹å’Œåº“æ–‡ä»¶ï¼Œä»¥ä¾¿ç”Ÿæˆé€‚åˆå®æ—¶æ“ä½œç³»ç»Ÿçš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚</em></p>
<p><em>éRTç‰ˆæœ¬ç¼–è¯‘é€šå¸¸æŒ‡åŸºäºæ™®é€šæ“ä½œç³»ç»Ÿçš„ç¼–è¯‘æ–¹å¼ï¼Œå®ƒä¸éœ€è¦è€ƒè™‘å®æ—¶æ€§å’Œå¯é æ€§ç­‰å› ç´ ã€‚åœ¨éRTç‰ˆæœ¬ç¼–è¯‘ä¸­ï¼Œç¼–è¯‘å™¨å’Œé“¾æ¥å™¨ä¼šä½¿ç”¨æ™®é€šçš„é€‰é¡¹å’Œåº“æ–‡ä»¶ï¼Œä»¥ä¾¿ç”Ÿæˆé€‚åˆæ™®é€šæ“ä½œç³»ç»Ÿçš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒRTç‰ˆæœ¬ç¼–è¯‘å’ŒéRTç‰ˆæœ¬ç¼–è¯‘çš„åŒºåˆ«ä¸»è¦åœ¨äºç¼–è¯‘å™¨å’Œé“¾æ¥å™¨çš„é€‰é¡¹å’Œåº“æ–‡ä»¶çš„ä¸åŒï¼Œä»¥åŠå¯¹å®æ—¶æ€§å’Œå¯é æ€§ç­‰å› ç´ çš„è€ƒè™‘ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œé€‰æ‹©RTç‰ˆæœ¬ç¼–è¯‘è¿˜æ˜¯éRTç‰ˆæœ¬ç¼–è¯‘ï¼Œå–å†³äºç³»ç»Ÿçš„å®é™…éœ€æ±‚å’Œåº”ç”¨åœºæ™¯ã€‚</em></p>
</blockquote>
<p><em>platform_sdkæ”¯æŒrtå’Œértç¼–è¯‘ï¼Œå¼€å…³æ˜¯ENABLE_RT_PATCHç¯å¢ƒå˜é‡ï¼Œè®¾ç½®ä¸ºtrueè¡¨ç¤ºå¼€RTï¼›è®¾ç½®ä¸ºfalseè¡¨ç¤ºå…³é—­RTï¼Œé»˜è®¤RTæ‰“å¼€(å¯ä»¥é€šè¿‡ENABLE_RT_PATCHç¯å¢ƒå˜é‡çš„å€¼è¿›è¡Œç¡®è®¤)ï¼Œå…³RTç¼–è¯‘å¦‚ä¸‹ï¼š</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">source build/envsetup.sh</span><br><span class="line">lunch 1    # horizon_j5-debug_gcc9.64</span><br><span class="line">export ENABLE_RT_PATCH=false</span><br><span class="line">./build.sh -e all â€“a vendor</span><br></pre></td></tr></table></figure></div>

<ul>
<li><em>ç¼–è¯‘æ—¶æ·»åŠ version</em></li>
</ul>
<p><em>ç¼–è¯‘æ—¶ï¼Œä¸ºäº†æ–¹ä¾¿è¿½è¿°æ¿å­ä¸Šçš„ä»£ç ï¼Œå¯ä»¥æŒ‡å®šversionä¿¡æ¯ï¼Œå¦‚ä¸‹ç¼–è¯‘ï¼š</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">source build/envsetup.sh</span><br><span class="line">lunch 1    # horizon_j5-debug_gcc9.64</span><br><span class="line">./build.sh -e all â€“a vendor -v xx_20220815</span><br></pre></td></tr></table></figure></div>

<p><em>å¯ä»¥åœ¨æ¿å­ä¸Šæ‰§è¡Œï¼Œå¦‚ä¸‹å‘½ä»¤è¿›è¡ŒæŸ¥çœ‹ï¼š</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@j5dvb:/# cat /etc/version</span><br><span class="line">xxx_20220815 debug</span><br></pre></td></tr></table></figure></div>

<h3 id="ç¼–è¯‘é…ç½®"><a href="#ç¼–è¯‘é…ç½®" class="headerlink" title="ç¼–è¯‘é…ç½®"></a><em>ç¼–è¯‘é…ç½®</em></h3><h4 id="åˆ†åŒºç¼–è¯‘"><a href="#åˆ†åŒºç¼–è¯‘" class="headerlink" title="åˆ†åŒºç¼–è¯‘"></a><em>åˆ†åŒºç¼–è¯‘</em></h4><p><em>åœ¨build&#x2F;device&#x2F;horizon&#x2F;j5&#x2F;ä¸‹æœ‰debug-gpt.confé…ç½®æ–‡ä»¶ã€‚</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">1:veeprom:none:34s:37s:1</span><br><span class="line">1:reserved:none:38s:1023s:1</span><br><span class="line">1:binfo1:none:1024s:2047s:1</span><br><span class="line">1:binfo2:none:2048s:3071s:1</span><br><span class="line">1:binfo3:none:3072s:4095s:1</span><br><span class="line">1:sbl/$&#123;UBOOT_SPL_NAME&#125;:none:4096s:4351s:1</span><br><span class="line">1:sblbak0/$&#123;UBOOT_SPL_NAME&#125;:none:4352s:4607s:1</span><br><span class="line">1:sblbak1/$&#123;UBOOT_SPL_NAME&#125;:none:4608s:4863s:1</span><br><span class="line">1:sblbak2/$&#123;UBOOT_SPL_NAME&#125;:none:4864s:5119s:1</span><br><span class="line">1:ddrc_a/ddrc.img.bin:none:5120s:5631s:1</span><br><span class="line">1:ddrc_b/ddrc.img.bin:none:5632s:6143s:1</span><br><span class="line">1:ddrp_a/ddrp.img.bin:none:6144s:8447s:1</span><br><span class="line">1:ddrp_b/ddrp.img.bin:none:8448s:10751s:1</span><br><span class="line">1:uboot_a/$&#123;UBOOT_IMAGE_NAME&#125;:none:10752s:14847s:1</span><br><span class="line">1:uboot_b/$&#123;UBOOT_IMAGE_NAME&#125;:none:14848s:18943s:1</span><br><span class="line">1:bl31_a/$&#123;BL31_IMAGE_NAME&#125;:none:18944s:20991s:1</span><br><span class="line">1:bl31_b/$&#123;BL31_IMAGE_NAME&#125;:none:20992s:23039s:1</span><br><span class="line">1:mcore_a:none:23040s:23295s:1</span><br><span class="line">1:mcore_b:none:23296s:23551s:1</span><br><span class="line">1:misc:none:23552s:23807s:1</span><br><span class="line">1:ubootenv:none:23808s:23815s:1</span><br><span class="line">1:HB_APDP:none:23816s:24063s:1</span><br><span class="line">1:veeprombak:none:24064s:25087s:1</span><br><span class="line">1:vbmeta_a/$&#123;VBMETA_IMAGE_NAME&#125;:none:25088s:25343s:1</span><br><span class="line">1:vbmeta_b/$&#123;VBMETA_IMAGE_NAME&#125;:none:25344s:25599s:1</span><br><span class="line">1:boot_a/$&#123;BOOT_PART_IMAGE_NAME&#125;:none:25600s:66559s:1</span><br><span class="line">1:boot_b/$&#123;BOOT_PART_IMAGE_NAME&#125;:none:66560s:107519s:1</span><br><span class="line">1:bpu_a:none:107520s:369663s:1</span><br><span class="line">1:bpu_b:none:369664s:631807s:1</span><br><span class="line">1:system_a:ext4:631808s:2728959s:0</span><br><span class="line">1:system_b:ext4:2728960s:4826111s:0</span><br><span class="line">1:app:ext4:4826112s:9020415s:0</span><br><span class="line">1:userdata:ext4:9020416s:13214719s:0</span><br></pre></td></tr></table></figure></div>

<blockquote>
<p><em>åˆ†åŒºè¡¨æ˜¯æŒ‡è®¡ç®—æœºç¡¬ç›˜æˆ–å…¶ä»–å­˜å‚¨è®¾å¤‡ä¸Šçš„åˆ†åŒºä¿¡æ¯è¡¨ï¼Œå®ƒè®°å½•äº†å­˜å‚¨è®¾å¤‡ä¸Šæ¯ä¸ªåˆ†åŒºçš„èµ·å§‹ä½ç½®ã€ç»“æŸä½ç½®ã€å¤§å°ç­‰ä¿¡æ¯ã€‚åˆ†åŒºè¡¨çš„ä½œç”¨æ˜¯å°†ä¸€ä¸ªç‰©ç†ç¡¬ç›˜æˆ–å­˜å‚¨è®¾å¤‡åˆ’åˆ†ä¸ºå¤šä¸ªé€»è¾‘åˆ†åŒºï¼Œä»¥ä¾¿æ›´æœ‰æ•ˆåœ°åˆ©ç”¨å­˜å‚¨ç©ºé—´å’Œç®¡ç†æ•°æ®ã€‚</em></p>
</blockquote>
<p><em>é…ç½®æ–‡ä»¶è¯´æ˜ï¼š</em></p>
<ul>
<li><em>åˆ†åŒºä½¿èƒ½:åˆ†åŒºå:åˆ†åŒºæ–‡ä»¶ç³»ç»Ÿæ ¼å¼:èµ·å§‹åˆ†åŒºä½ç½®:ç»“æŸåˆ†åŒºä½ç½®</em></li>
<li><em>åˆ†åŒºä½¿èƒ½:è¡¨ç¤ºè¿™ä¸€è¡Œæ˜¯å¦éœ€è¦å»ºç«‹çœŸæ­£çš„åˆ†åŒºè¡¨ï¼Œ1è¡¨ç¤ºéœ€è¦å»ºç«‹åˆ†åŒºï¼Œ0ä¸éœ€è¦å»ºç«‹</em></li>
<li><em>åˆ†åŒºå:åˆ†åŒºè¡¨çš„åç§°ï¼Œä¹Ÿæ˜¯ä½œä¸ºå»ºç«‹å¥½åæ‹·è´è¿›åˆ†åŒºçš„imgåå­—</em></li>
<li><em>åˆ†åŒºæ–‡ä»¶ç³»ç»Ÿæ ¼å¼:å¯ä»¥æ”¯æŒä¸‹é¢æ ¼å¼ï¼ˆubuntu14.04ï¼‰å¦‚æœä¸ºnoneï¼Œåˆ™è¡¨ç¤ºä¸éœ€è¦å»ºç«‹æ–‡ä»¶ç³»ç»Ÿï¼Œå½“å‰ä¸ºä»…æ”¯æŒext4</em></li>
<li><em>åˆ†åŒºèµ·å§‹åœ°å€:åˆ†åŒºèµ·å§‹åœ°å€ä¸€å®šè¦æ˜¯512å­—èŠ‚çš„æ•´æ•°å€ï¼Œsä»£è¡¨çš„æ˜¯emmc çš„ä¸€ä¸ªsection çš„ç¼©å†™å³512B</em></li>
<li><em>åˆ†åŒºç»“æŸåœ°å€:åˆ†åŒºç»“æŸåœ°å€ä¸€å®šè¦æ˜¯512å­—èŠ‚çš„æ•´æ•°å€ï¼Œsä»£è¡¨çš„æ˜¯emmc çš„ä¸€ä¸ªsection çš„ç¼©å†™å³512B</em></li>
<li><em>åˆ†åŒºç»“æŸåœ°å€ - åˆ†åŒºèµ·å§‹åœ°å€ &#x3D; åˆ†åŒºå¤§å°</em></li>
<li><em>ç¦æ­¢å‡ºç°å°æ•°å’Œè´Ÿæ•°</em></li>
</ul>
<p><em>æ³¨æ„ï¼šèµ·å§‹ä½ç½®å’Œç»“æŸåˆ†åŒºä½ç½®ä¹‹é—´çš„å¤§å°è®¡ç®—æ–¹å¼ä¸ºï¼Œç»“æŸåˆ†åŒºä½ç½®-èµ·å§‹ä½ç½®+1sã€‚ä¾‹ å¦‚æœ€åä¸€è¡Œï¼Œ162017s - 62018s + 1s &#x3D; 100000sã€‚</em></p>
<table>
<thead>
<tr>
<th><em><strong>åºå·</strong></em></th>
<th><em><strong>åˆ†åŒºå</strong></em></th>
<th><em><strong>å¤§å°</strong></em></th>
<th><em><strong>æ–‡ä»¶ç³»ç»Ÿ</strong></em></th>
<th><em><strong>ç”¨é€”</strong></em></th>
</tr>
</thead>
<tbody><tr>
<td><em>1</em></td>
<td><em>veeprom</em></td>
<td><em>2K</em></td>
<td><em>none</em></td>
<td><em>å­˜å‚¨OTAæ ‡å¿—</em></td>
</tr>
<tr>
<td><em>2</em></td>
<td><em>reserved</em></td>
<td><em>493K</em></td>
<td><em>none</em></td>
<td><em>åˆ†åŒºå¯¹é½ä½¿ç”¨</em></td>
</tr>
<tr>
<td><em>3</em></td>
<td><em>binfo1</em></td>
<td><em>512K</em></td>
<td><em>none</em></td>
<td><em>åœ°å¹³çº¿å¯åŠ¨æ ‡å¿—</em></td>
</tr>
<tr>
<td><em>4</em></td>
<td><em>binfo2</em></td>
<td><em>512K</em></td>
<td><em>none</em></td>
<td><em>åœ°å¹³çº¿å¯åŠ¨æ ‡å¿—</em></td>
</tr>
<tr>
<td><em>5</em></td>
<td><em>binfo3</em></td>
<td><em>512K</em></td>
<td><em>none</em></td>
<td><em>åœ°å¹³çº¿å¯åŠ¨æ ‡å¿—</em></td>
</tr>
<tr>
<td><em>6</em></td>
<td><em>sbl</em></td>
<td><em>128K</em></td>
<td><em>none</em></td>
<td><em>ç¬¬äºŒçº§bootloader</em></td>
</tr>
<tr>
<td><em>7</em></td>
<td><em>sblbak0</em></td>
<td><em>128K</em></td>
<td><em>none</em></td>
<td><em>ç¬¬äºŒçº§bootloader</em></td>
</tr>
<tr>
<td><em>8</em></td>
<td><em>sblbak1</em></td>
<td><em>128K</em></td>
<td><em>none</em></td>
<td><em>ç¬¬äºŒçº§bootloader</em></td>
</tr>
<tr>
<td><em>9</em></td>
<td><em>sblbak2</em></td>
<td><em>128K</em></td>
<td><em>none</em></td>
<td><em>ç¬¬äºŒçº§bootloader</em></td>
</tr>
<tr>
<td><em>10</em></td>
<td><em>ddrc_a</em></td>
<td><em>256K</em></td>
<td><em>none</em></td>
<td><em>ddr controllerçš„é…ç½®ä»£ç </em></td>
</tr>
<tr>
<td><em>11</em></td>
<td><em>ddrc_b</em></td>
<td><em>256K</em></td>
<td><em>none</em></td>
<td><em>ddr controllerçš„é…ç½®ä»£ç </em></td>
</tr>
<tr>
<td><em>12</em></td>
<td><em>ddrp_a</em></td>
<td><em>1152K</em></td>
<td><em>none</em></td>
<td><em>æ˜¯ddr controllerçš„å‚æ•°ä¿¡æ¯ï¼Œç›®å‰é¢„ç•™</em></td>
</tr>
<tr>
<td><em>13</em></td>
<td><em>ddrp_b</em></td>
<td><em>1152K</em></td>
<td><em>none</em></td>
<td><em>æ˜¯ddr controllerçš„å‚æ•°ä¿¡æ¯ï¼Œç›®å‰é¢„ç•™</em></td>
</tr>
<tr>
<td><em>14</em></td>
<td><em>uboot_a</em></td>
<td><em>2048K</em></td>
<td><em>none</em></td>
<td><em>ubooté•œåƒ</em></td>
</tr>
<tr>
<td><em>15</em></td>
<td><em>uboot_b</em></td>
<td><em>2048K</em></td>
<td><em>none</em></td>
<td><em>ubooté•œåƒ</em></td>
</tr>
<tr>
<td><em>16</em></td>
<td><em>bl31_a</em></td>
<td><em>1024K</em></td>
<td><em>none</em></td>
<td><em>Arm trust environment firmwareï¼Œè¿è¡Œåœ¨EL3çŠ¶æ€ï¼Œå¤„ç†securityç›¸å…³æ“ä½œ</em></td>
</tr>
<tr>
<td><em>17</em></td>
<td><em>bl31_b</em></td>
<td><em>1024K</em></td>
<td><em>none</em></td>
<td><em>Arm trust environment firmwareï¼Œè¿è¡Œåœ¨EL3çŠ¶æ€ï¼Œå¤„ç†securityç›¸å…³æ“ä½œ</em></td>
</tr>
<tr>
<td><em>18</em></td>
<td><em>mcore_a</em></td>
<td><em>128K</em></td>
<td><em>none</em></td>
<td><em>ç­¾ååçš„mcore çš„é•œåƒ</em></td>
</tr>
<tr>
<td><em>19</em></td>
<td><em>mcore_b</em></td>
<td><em>128K</em></td>
<td><em>none</em></td>
<td><em>ç­¾ååçš„mcore çš„é•œåƒ</em></td>
</tr>
<tr>
<td><em>20</em></td>
<td><em>misc</em></td>
<td><em>128K</em></td>
<td><em>none</em></td>
<td><em>å­˜å‚¨ABåˆ†åŒºæ ‡å¿—</em></td>
</tr>
<tr>
<td><em>21</em></td>
<td><em>ubootenv</em></td>
<td><em>4K</em></td>
<td><em>none</em></td>
<td><em>å­˜å‚¨ubootç¯å¢ƒå˜é‡</em></td>
</tr>
<tr>
<td><em>22</em></td>
<td><em>HB_APDP</em></td>
<td><em>124K</em></td>
<td><em>none</em></td>
<td><em>å†…éƒ¨è°ƒè¯•ä½¿ç”¨</em></td>
</tr>
<tr>
<td><em>23</em></td>
<td><em>veeprombak</em></td>
<td><em>512K</em></td>
<td><em>none</em></td>
<td><em>å­˜å‚¨IP å’Œç½‘å…³</em></td>
</tr>
<tr>
<td><em>24</em></td>
<td><em>vbmeta_a</em></td>
<td><em>128K</em></td>
<td><em>none</em></td>
<td><em>ç”¨äºç³»ç»ŸAVBå¯åŠ¨æ ¡éªŒçš„ç­¾åé•œåƒ</em></td>
</tr>
<tr>
<td><em>25</em></td>
<td><em>vbmeta_b</em></td>
<td><em>128K</em></td>
<td><em>none</em></td>
<td><em>ç”¨äºç³»ç»ŸAVBå¯åŠ¨æ ¡éªŒçš„ç­¾åé•œåƒ</em></td>
</tr>
<tr>
<td><em>26</em></td>
<td><em>boot_a</em></td>
<td><em>20M</em></td>
<td><em>none</em></td>
<td><em>kernelé•œåƒï¼ˆimage+dtbï¼‰å’Œrootfs</em></td>
</tr>
<tr>
<td><em>27</em></td>
<td><em>boot_b</em></td>
<td><em>20M</em></td>
<td><em>none</em></td>
<td><em>kernelé•œåƒï¼ˆimage+dtbï¼‰å’Œrootfs</em></td>
</tr>
<tr>
<td><em>28</em></td>
<td><em>bpu_a</em></td>
<td><em>128M</em></td>
<td><em>none</em></td>
<td><em>BPU æ¨¡å‹æ–‡ä»¶</em></td>
</tr>
<tr>
<td><em>29</em></td>
<td><em>bpu_b</em></td>
<td><em>128M</em></td>
<td><em>none</em></td>
<td><em>BPU æ¨¡å‹æ–‡ä»¶</em></td>
</tr>
<tr>
<td><em>30</em></td>
<td><em>system_a</em></td>
<td><em>1024M</em></td>
<td><em>ext4</em></td>
<td><em>ç³»ç»Ÿè¿è¡Œå¿…è¦çš„åº“ã€å‘½ä»¤ç­‰ï¼Œrootfsè¿è¡Œæ—¶è¢«æŒ‚è½½åˆ°systemç›®å½•ï¼Œdm-verityåªè¯»åˆ†åŒº</em></td>
</tr>
<tr>
<td><em>31</em></td>
<td><em>system_b</em></td>
<td><em>1024M</em></td>
<td><em>ext4</em></td>
<td><em>ç³»ç»Ÿè¿è¡Œå¿…è¦çš„åº“ã€å‘½ä»¤ç­‰ï¼Œrootfsè¿è¡Œæ—¶è¢«æŒ‚è½½åˆ°systemç›®å½•ï¼Œdm-verityåªè¯»åˆ†åŒº</em></td>
</tr>
<tr>
<td><em>32</em></td>
<td><em>app</em></td>
<td><em>2048M</em></td>
<td><em>ext4</em></td>
<td><em>app åˆ†åŒºé•œåƒï¼Œrootfsè¿è¡Œæ˜¯è¢«æŒ‚è½½åˆ°app ç›®å½•ï¼Œdm-verityåªè¯»åˆ†åŒº</em></td>
</tr>
<tr>
<td><em>33</em></td>
<td><em>userdata</em></td>
<td><em>other</em></td>
<td><em>ext4</em></td>
<td><em>å­˜å‚¨ç”¨æˆ·æ•°æ®</em></td>
</tr>
</tbody></table>
<blockquote>
<p><em>æŒ‚è½½æ˜¯æŒ‡å°†è®¾å¤‡è¿æ¥åˆ°æ–‡ä»¶ç³»ç»Ÿçš„è¿‡ç¨‹ã€‚åœ¨æŒ‚è½½è¿‡ç¨‹ä¸­ï¼Œæ“ä½œç³»ç»Ÿå°†è®¾å¤‡ä¸ä¸€ä¸ªç›®å½•å…³è”èµ·æ¥ï¼Œè¿™ä¸ªç›®å½•ç§°ä¸ºæŒ‚è½½ç‚¹ã€‚ä¸€æ—¦è®¾å¤‡è¢«æŒ‚è½½åˆ°æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œå®ƒå°±å¯ä»¥åƒå…¶ä»–æ–‡ä»¶ä¸€æ ·è¢«è®¿é—®å’Œæ“ä½œã€‚å¦‚æœä¸æŒ‚è½½è®¾å¤‡ï¼Œç³»ç»Ÿå°±æ— æ³•è®¿é—®è®¾å¤‡ä¸­çš„æ–‡ä»¶å’Œç›®å½•ã€‚</em></p>
<p><em>å› æ­¤ï¼Œæ–‡ä»¶ç³»ç»Ÿéœ€è¦æŒ‚è½½æ‰èƒ½åœ¨Linuxç³»ç»Ÿä¸­ä½¿ç”¨ã€‚åœ¨æŒ‚è½½æ–‡ä»¶ç³»ç»Ÿæ—¶ï¼Œéœ€è¦æŒ‡å®šæŒ‚è½½ç‚¹ä»¥åŠå…¶ä»–ä¸€äº›é€‰é¡¹ï¼Œä¾‹å¦‚è¯»å†™æƒé™ã€æ–‡ä»¶ç³»ç»Ÿç±»å‹ç­‰ã€‚è¿™äº›é€‰é¡¹å°†å½±å“æ–‡ä»¶ç³»ç»Ÿçš„è®¿é—®æ–¹å¼å’Œæ€§èƒ½ã€‚</em></p>
<p><em><code>fstab</code>æ˜¯ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿè¡¨æ–‡ä»¶ï¼Œå®ƒæ˜¯Linuxç³»ç»Ÿä¸­ç”¨äºè‡ªåŠ¨æŒ‚è½½æ–‡ä»¶ç³»ç»Ÿçš„é…ç½®æ–‡ä»¶ä¹‹ä¸€ã€‚<code>fstab</code>ä¸­åˆ—å‡ºäº†ç³»ç»Ÿä¸Šæ‰€æœ‰éœ€è¦è‡ªåŠ¨æŒ‚è½½çš„æ–‡ä»¶ç³»ç»Ÿçš„è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ–‡ä»¶ç³»ç»Ÿç±»å‹ã€è®¾å¤‡åç§°ã€æŒ‚è½½ç‚¹ã€æŒ‚è½½é€‰é¡¹ç­‰ã€‚å½“ç³»ç»Ÿå¯åŠ¨æ—¶ï¼Œ<code>fstab</code>ä¸­åˆ—å‡ºçš„æ–‡ä»¶ç³»ç»Ÿä¼šè‡ªåŠ¨æŒ‚è½½åˆ°æŒ‡å®šçš„æŒ‚è½½ç‚¹ä¸Šã€‚</em></p>
<p><em><code>fstab</code>æ–‡ä»¶é€šå¸¸ä½äº<code>/etc/fstab</code>è·¯å¾„ä¸‹ï¼Œå®ƒæ˜¯ä¸€ä¸ªçº¯æ–‡æœ¬æ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨ä»»ä½•æ–‡æœ¬ç¼–è¾‘å™¨è¿›è¡Œç¼–è¾‘ã€‚åœ¨ç¼–è¾‘<code>fstab</code>æ–‡ä»¶æ—¶ï¼Œéœ€è¦å°å¿ƒï¼Œå› ä¸ºé”™è¯¯çš„é…ç½®å¯èƒ½ä¼šå¯¼è‡´ç³»ç»Ÿå¯åŠ¨å¤±è´¥ï¼Œç”šè‡³æ— æ³•å¯åŠ¨ã€‚å› æ­¤ï¼Œåœ¨ç¼–è¾‘<code>fstab</code>æ–‡ä»¶ä¹‹å‰ï¼Œæœ€å¥½å¤‡ä»½ä¸€ä¸‹åŸå§‹æ–‡ä»¶ã€‚</em></p>
</blockquote>
<h4 id="æ–‡ä»¶ç³»ç»Ÿè®¾ç½®"><a href="#æ–‡ä»¶ç³»ç»Ÿè®¾ç½®" class="headerlink" title="æ–‡ä»¶ç³»ç»Ÿè®¾ç½®"></a><em>æ–‡ä»¶ç³»ç»Ÿè®¾ç½®</em></h4><p><em>æ–‡ä»¶ç³»ç»Ÿé…ç½®è¡¨å­˜æ”¾è·¯å¾„ï¼š build&#x2F;device&#x2F;horizon&#x2F;j5&#x2F;j5dvb.emmc.release.fstab build&#x2F;device&#x2F;horizon&#x2F;j5&#x2F;j5dvb.emmc.debug.fstab æ ¹æ®4.1 ç« èŠ‚ä¸­lunch çš„é€‰é¡¹æ˜¯releaseè¿˜æ˜¯debugï¼Œbuild ç³»ç»Ÿä¼šé€‰æ‹©å¯¹åº”çš„fstabï¼Œé€šè¿‡è‡ª å®šä¹‰ fstab æ–‡ä»¶å¯ä»¥è®¾ç½®ä½ éœ€è¦çš„æ–‡ä»¶ç³»ç»Ÿé…ç½®ï¼Œç³»ç»Ÿåœ¨å¯åŠ¨çš„æ—¶å€™ï¼Œä¼šè°ƒç”¨ mount â€“at å‘½ ä»¤ï¼Œå®Œæˆå¯¹&#x2F;etc&#x2F;fstab æ–‡ä»¶çš„è§£æï¼Œä»è€ŒæŒ‚è½½è®¾ç½®çš„æ–‡ä»¶ç³»ç»Ÿã€‚</em></p>
<blockquote>
<p><em><code>mount -a</code>å‘½ä»¤çš„ä½œç”¨æ˜¯æŒ‚è½½&#x2F;etc&#x2F;fstabæ–‡ä»¶ä¸­åˆ—å‡ºçš„æ‰€æœ‰æ–‡ä»¶ç³»ç»Ÿã€‚</em></p>
<p><em><strong>å½“ç³»ç»Ÿå¯åŠ¨æ—¶ï¼Œæ“ä½œç³»ç»Ÿä¼šè‡ªåŠ¨æŒ‚è½½<code>/etc/fstab</code>æ–‡ä»¶ä¸­åˆ—å‡ºçš„æ–‡ä»¶ç³»ç»Ÿ</strong>ã€‚ä½†æ˜¯ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå¯èƒ½éœ€è¦æ‰‹åŠ¨æŒ‚è½½æŸä¸ªæ–‡ä»¶ç³»ç»Ÿï¼Œæˆ–è€…åœ¨ä¿®æ”¹äº†<code>/etc/fstab</code>æ–‡ä»¶åéœ€è¦é‡æ–°æŒ‚è½½æ‰€æœ‰æ–‡ä»¶ç³»ç»Ÿã€‚æ­¤æ—¶ï¼Œå¯ä»¥ä½¿ç”¨<code>mount -a</code>å‘½ä»¤æ¥æŒ‚è½½<code>/etc/fstab</code>æ–‡ä»¶ä¸­åˆ—å‡ºçš„æ‰€æœ‰æ–‡ä»¶ç³»ç»Ÿã€‚</em></p>
<p><em>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<strong>ä½¿ç”¨<code>mount -a</code>å‘½ä»¤ä¼šæŒ‚è½½<code>/etc/fstab</code>æ–‡ä»¶ä¸­åˆ—å‡ºçš„æ‰€æœ‰æ–‡ä»¶ç³»ç»Ÿï¼ŒåŒ…æ‹¬é‚£äº›å·²ç»æŒ‚è½½çš„æ–‡ä»¶ç³»ç»Ÿã€‚</strong>å› æ­¤ï¼Œåœ¨ä½¿ç”¨<code>mount -a</code>å‘½ä»¤ä¹‹å‰ï¼Œåº”è¯¥ç¡®ä¿æ‰€æœ‰çš„æ–‡ä»¶ç³»ç»Ÿéƒ½å·²ç»æ­£ç¡®æŒ‚è½½ï¼Œä»¥å…å‡ºç°é‡å¤æŒ‚è½½æˆ–å…¶ä»–é”™è¯¯ã€‚</em></p>
</blockquote>
<h4 id="æ–‡ä»¶ç³»ç»Ÿæƒé™"><a href="#æ–‡ä»¶ç³»ç»Ÿæƒé™" class="headerlink" title="æ–‡ä»¶ç³»ç»Ÿæƒé™"></a><em>æ–‡ä»¶ç³»ç»Ÿæƒé™</em></h4><table>
<thead>
<tr>
<th><em><strong>åºå·</strong></em></th>
<th><em><strong>ç›®å½•</strong></em></th>
<th><em><strong>æƒé™</strong></em></th>
<th><em><strong>ç”¨é€”</strong></em></th>
</tr>
</thead>
<tbody><tr>
<td><em>1</em></td>
<td><em>&#x2F;system</em></td>
<td><em>åªè¯»</em></td>
<td><em>ç³»ç»Ÿsystemé•œåƒ</em></td>
</tr>
<tr>
<td><em>2</em></td>
<td><em>&#x2F;app</em></td>
<td><em>åªè¯»</em></td>
<td><em>åº”ç”¨ç¨‹åºçš„é•œåƒ</em></td>
</tr>
<tr>
<td><em>3</em></td>
<td><em>&#x2F;userdata</em></td>
<td><em>è¯»å†™</em></td>
<td><em>å­˜æ”¾ç”¨æˆ·æ•°æ®ç­‰</em></td>
</tr>
</tbody></table>
<h4 id="æ–‡ä»¶ç³»ç»Ÿä¿®æ”¹"><a href="#æ–‡ä»¶ç³»ç»Ÿä¿®æ”¹" class="headerlink" title="æ–‡ä»¶ç³»ç»Ÿä¿®æ”¹"></a><em>æ–‡ä»¶ç³»ç»Ÿä¿®æ”¹</em></h4><p><em>æ ¹æ–‡ä»¶ç³»ç»Ÿè·¯å¾„ï¼šprebuilts&#x2F;root_hijack&#x2F;hobot&#x2F;ï¼Œæƒ³è¦å¢å‡æ ¹æ–‡ä»¶ç³»ç»Ÿæ–‡ä»¶ï¼Œéœ€è¦ä¸¤æ­¥æ“ä½œï¼š</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">user.name@hz-server-1:~/work/pull/platform_sdk$ ls prebuilts/root_hijack/hobot/</span><br><span class="line">etc  init.normal.rc  init.rc  init.recovery.rc  lib  sbin  usr  verity_key</span><br></pre></td></tr></table></figure></div>

<ol>
<li><em>åœ¨prebuilts&#x2F;root_hijack&#x2F;hobot&#x2F; ç›®å½•ä¸‹å¢å‡ç›¸åº”çš„æ–‡ä»¶</em></li>
</ol>
<p><em>b. æ–‡ä»¶å¢åŠ åˆ°rootfsï¼Œåœ¨build&#x2F;device&#x2F;horizon&#x2F;j5&#x2F;debug-rootfs.manifestä¸­ï¼Œå¢åŠ -æ–‡ä»¶ï¼Œåœ¨ build&#x2F;device&#x2F;horizon&#x2F;j5&#x2F;debug-kernel-rootfs.manifestä¸­ï¼Œå¢åŠ +æ–‡ä»¶ æ–‡ä»¶å¢åŠ åˆ°systemï¼Œåœ¨build&#x2F;device&#x2F;horizon&#x2F;j5&#x2F;debug-rootfs.manifestä¸­ï¼Œä¸æ“ä½œï¼Œåœ¨ build&#x2F;device&#x2F;horizon&#x2F;j5&#x2F;debug-kernel-rootfs.manifestä¸­ï¼Œä¸æ“ä½œã€‚</em></p>
<h3 id="ç¼–è¯‘è¾“å‡º"><a href="#ç¼–è¯‘è¾“å‡º" class="headerlink" title="ç¼–è¯‘è¾“å‡º"></a><em>ç¼–è¯‘è¾“å‡º</em></h3><p><em>ç›®å‰ç”±ç¼–è¯‘ç³»ç»Ÿç¼–è¯‘ç”Ÿæˆçš„ç³»ç»Ÿé•œåƒå¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š</em></p>
<table>
<thead>
<tr>
<th><em><strong>é•œåƒåå­—</strong></em></th>
<th><em><strong>å¯¹åº”åˆ†åŒº</strong></em></th>
<th><em><strong>ç”¨é€”è¯´æ˜</strong></em></th>
<th><em><strong>é•œåƒç”Ÿæˆä½ç½®</strong></em></th>
</tr>
</thead>
<tbody><tr>
<td><em>&#x2F;</em></td>
<td><em>veeprom</em></td>
<td><em>å­˜å‚¨OTAæ ‡å¿—</em></td>
<td><em>&#x2F;</em></td>
</tr>
<tr>
<td><em>gpt_main-secure.img</em></td>
<td><em>binfo1binfo2binfo3</em></td>
<td><em>åœ°å¹³çº¿å¯åŠ¨æ ‡å¿—.&#x2F;build.sh â€“e allå‘½ä»¤æ‰ä¼šç”Ÿæˆ</em></td>
<td><em>out&#x2F;target&#x2F;product&#x2F;packages</em></td>
</tr>
<tr>
<td><em>binfo-nor-secure.img</em></td>
<td><em>binfo1binfo2binfo3</em></td>
<td><em>åœ°å¹³çº¿å¯åŠ¨æ ‡å¿—.&#x2F;build.sh â€“e all â€“b j5dvb_nor å‘½ä»¤æ‰ä¼šç”Ÿæˆ</em></td>
<td><em>out&#x2F;target&#x2F;product&#x2F;packages</em></td>
</tr>
<tr>
<td><em>binfo-hyper-secure.img</em></td>
<td><em>binfo1binfo2binfo3</em></td>
<td><em>åœ°å¹³çº¿å¯åŠ¨æ ‡å¿—.&#x2F;build.sh â€“e all â€“b j5dvb_hyper å‘½ä»¤æ‰ä¼šç”Ÿæˆ</em></td>
<td><em>out&#x2F;target&#x2F;product&#x2F;packages</em></td>
</tr>
<tr>
<td><em>spl.img0.bin</em></td>
<td><em>sblsblbak0sblbak1sblbak2</em></td>
<td><em>ç¬¬äºŒçº§bootloader</em></td>
<td><em>out&#x2F;target&#x2F;product&#x2F;packages</em></td>
</tr>
<tr>
<td><em>ddrc.img.bin</em></td>
<td><em>ddrc_addrc_b</em></td>
<td><em>ddrc.img.binæ˜¯ddr controllerçš„é…ç½®ä»£ç ã€‚</em></td>
<td><em>out&#x2F;target&#x2F;product&#x2F;packages</em></td>
</tr>
<tr>
<td><em>&#x2F;</em></td>
<td><em>ddrp_addrp_b</em></td>
<td><em>æ˜¯ddr controllerçš„å‚æ•°ä¿¡æ¯ï¼Œç›®å‰é¢„ç•™</em></td>
<td><em>&#x2F;</em></td>
</tr>
<tr>
<td><em>uboot.img.bin</em></td>
<td><em>uboot_auboot_b</em></td>
<td><em>è¿è¡Œåœ¨EL1çŠ¶æ€çš„ç¬¬3çº§bootloaderï¼Œä¸‹è½½boot.imgæˆ–recovery.imgåˆ°DDRï¼Œå¯åŠ¨kernelå’Œramdiskã€‚</em></td>
<td><em>out&#x2F;target&#x2F;product&#x2F;packages</em></td>
</tr>
<tr>
<td><em>bl31.img.bin</em></td>
<td><em>bl31_abl31_b</em></td>
<td><em>Arm trust environment firmwareï¼Œè¿è¡Œåœ¨EL3çŠ¶æ€ï¼Œåˆå§‹åŒ–armï¼Œgicå’Œsyscounterï¼Œå¤„ç†securityç›¸å…³æ“ä½œï¼Œç®¡ç†powerå’Œclockç­‰åŠŸèƒ½ã€‚</em></td>
<td><em>out&#x2F;target&#x2F;product&#x2F;packages</em></td>
</tr>
<tr>
<td><em>mcore.img.bin</em></td>
<td><em>mcore_amcore_b</em></td>
<td><em>ç­¾ååçš„mcoreçš„é•œåƒ</em></td>
<td><em>out&#x2F;target&#x2F;product&#x2F;packages</em></td>
</tr>
<tr>
<td><em>&#x2F;</em></td>
<td><em>misc</em></td>
<td><em>å­˜å‚¨ABåˆ†åŒºæ ‡å¿—</em></td>
<td><em>&#x2F;</em></td>
</tr>
<tr>
<td><em>&#x2F;</em></td>
<td><em>ubootenv</em></td>
<td><em>å­˜å‚¨ubootç¯å¢ƒå˜é‡</em></td>
<td><em>&#x2F;</em></td>
</tr>
<tr>
<td><em>&#x2F;</em></td>
<td><em>HB_APDP</em></td>
<td><em>å†…éƒ¨è°ƒè¯•ä½¿ç”¨</em></td>
<td><em>&#x2F;</em></td>
</tr>
<tr>
<td><em>&#x2F;</em></td>
<td><em>veeprombak</em></td>
<td><em>å­˜å‚¨IP å’Œç½‘å…³</em></td>
<td><em>&#x2F;</em></td>
</tr>
<tr>
<td><em>vbmeta.img</em></td>
<td><em>vbmeta_avbmeta_b</em></td>
<td><em>ç”¨äºç³»ç»ŸAVBå¯åŠ¨æ ¡éªŒçš„ç­¾åé•œåƒ</em></td>
<td><em>out&#x2F;target&#x2F;product&#x2F;packages</em></td>
</tr>
<tr>
<td><em>boot.img</em></td>
<td><em>boot_aboot_b</em></td>
<td><em>ç”¨äºç³»ç»Ÿæ­£å¸¸æ¨¡å¼ä¸‹çš„kernelé•œåƒï¼ˆimage+dtbï¼‰å’Œramdiskï¼ˆæœ€å°rootfsï¼‰</em></td>
<td><em>out&#x2F;target&#x2F;product&#x2F;packages</em></td>
</tr>
<tr>
<td><em>bpu_image.bin</em></td>
<td><em>bpu_abpu_b</em></td>
<td><em>BPU æ¨¡å‹æ–‡ä»¶</em></td>
<td><em>out&#x2F;target&#x2F;product&#x2F;packages</em></td>
</tr>
<tr>
<td><em>system.img</em></td>
<td><em>system_asystem_bæˆ–è€…æ˜¯system</em></td>
<td><em>ç³»ç»Ÿrootfsé•œåƒï¼Œåœ¨boot.imgä¸­çš„ramdiskè¿è¡Œæ—¶è¢«mountã€‚</em></td>
<td><em>out&#x2F;target&#x2F;product&#x2F;packages</em></td>
</tr>
<tr>
<td><em>app.img</em></td>
<td><em>app</em></td>
<td><em>app åˆ†åŒºé•œåƒï¼Œåœ¨ç³»ç»Ÿå¯åŠ¨åä¼šæŒ‚è½½åˆ°app åˆ†åŒºä¸­</em></td>
<td><em>out&#x2F;target&#x2F;product&#x2F;packages</em></td>
</tr>
<tr>
<td><em>&#x2F;</em></td>
<td><em>userdata</em></td>
<td><em>å­˜å‚¨ç”¨æˆ·æ•°æ®</em></td>
<td><em>&#x2F;</em></td>
</tr>
</tbody></table>
<h3 id="ç­¾ååŠ å¯†"><a href="#ç­¾ååŠ å¯†" class="headerlink" title="ç­¾ååŠ å¯†"></a><em>ç­¾ååŠ å¯†</em></h3><p><em>å‰æï¼šä¹‹å‰æ‰€æœ‰é•œåƒéƒ½å·²ç»ç¼–è¯‘å®Œæˆï¼Œè¿˜éœ€è¦ç»è¿‡é•œåƒç­¾ååæ‰èƒ½ç”Ÿæˆå¯ç”¨çš„é•œåƒæ–‡ä»¶ï¼Œ ç›´æ¥æ‰§è¡Œbuild&#x2F;ç›®å½•ä¸‹çš„Makefileï¼Œå³å¯å®Œæˆä¸‹é¢æ‰€æœ‰çš„é•œåƒæ–‡ä»¶åŠ å¯†ç­¾åã€‚</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd build/</span><br><span class="line">make</span><br></pre></td></tr></table></figure></div>

<h3 id="æ¨¡å—ç¼–è¯‘"><a href="#æ¨¡å—ç¼–è¯‘" class="headerlink" title="æ¨¡å—ç¼–è¯‘"></a><em>æ¨¡å—ç¼–è¯‘</em></h3><p><em>æ¨¡å—å•ç‹¬ç¼–è¯‘äº§ç”Ÿçš„æ˜¯æœªç­¾åçš„é•œåƒï¼Œè¿˜éœ€è¦å†è¿›è¡Œé•œåƒç­¾åï¼Œæ‰èƒ½çƒ§å½•ä½¿ç”¨ï¼Œå¦åˆ™å¯åŠ¨ä¼šå¤±è´¥ã€‚ é¦–å…ˆå»ºç«‹ç¼–è¯‘ç¯å¢ƒ:</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">source build/envsetup.sh</span><br><span class="line">lunch 1   # horizon_j5-debug_gcc9.64</span><br></pre></td></tr></table></figure></div>

<h4 id="Uboot"><a href="#Uboot" class="headerlink" title="Uboot"></a><em>Uboot</em></h4><blockquote>
<p><em>U-Bootï¼ˆUniversal Bootloaderï¼‰æ˜¯ä¸€æ¬¾å¼€æºçš„ã€å¹¿æ³›ä½¿ç”¨çš„å¼•å¯¼åŠ è½½ç¨‹åºï¼ˆbootloaderï¼‰ï¼Œå®ƒå¯ä»¥åœ¨åµŒå…¥å¼ç³»ç»Ÿä¸­åŠ è½½å’Œè¿è¡Œæ“ä½œç³»ç»Ÿã€‚</em></p>
<p><em>U-Bootçš„ä¸»è¦åŠŸèƒ½æ˜¯åŠ è½½å’Œå¯åŠ¨æ“ä½œç³»ç»Ÿå†…æ ¸ï¼Œä½†å®ƒè¿˜å…·æœ‰è®¸å¤šå…¶ä»–åŠŸèƒ½ï¼Œä¾‹å¦‚é…ç½®ç¡¬ä»¶å‚æ•°ã€ä¸‹è½½å’Œçƒ§å†™å›ºä»¶ã€æ›´æ–°æ“ä½œç³»ç»Ÿã€å¯åŠ¨ç½‘ç»œç­‰ã€‚U-Bootå¯ä»¥é€šè¿‡ä¸²å£ã€ä»¥å¤ªç½‘ã€USBç­‰å¤šç§æ–¹å¼è¿›è¡Œäº¤äº’å’Œé…ç½®ï¼Œä»è€Œæ–¹ä¾¿äº†ç³»ç»Ÿçš„è°ƒè¯•å’Œç»´æŠ¤ã€‚</em></p>
</blockquote>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd uboot/</span><br><span class="line">./build.sh -o emmc/nor/hyper</span><br></pre></td></tr></table></figure></div>

<h4 id="Kernel"><a href="#Kernel" class="headerlink" title="Kernel"></a><em>Kernel</em></h4><blockquote>
<p><em>Kernelï¼ˆå†…æ ¸ï¼‰æ˜¯æ“ä½œç³»ç»Ÿçš„æ ¸å¿ƒéƒ¨åˆ†ï¼Œå®ƒæ˜¯æ“ä½œç³»ç»Ÿä¸è®¡ç®—æœºç¡¬ä»¶ä¹‹é—´çš„æ¥å£ï¼Œè´Ÿè´£ç®¡ç†è®¡ç®—æœºçš„ç¡¬ä»¶èµ„æºå’Œæä¾›åŸºæœ¬çš„ç³»ç»ŸæœåŠ¡ã€‚Kernelé€šå¸¸è¢«ç§°ä¸ºæ“ä½œç³»ç»Ÿçš„â€œå¿ƒè„â€ï¼Œå®ƒæ˜¯æ“ä½œç³»ç»Ÿçš„æœ€åº•å±‚éƒ¨åˆ†ï¼Œç›´æ¥è¿è¡Œåœ¨è®¡ç®—æœºçš„ç¡¬ä»¶ä¸Šã€‚</em></p>
<p><em>Kernelçš„ä¸»è¦åŠŸèƒ½åŒ…æ‹¬ç®¡ç†è®¡ç®—æœºçš„å†…å­˜ã€å¤„ç†å™¨ã€è¾“å…¥è¾“å‡ºè®¾å¤‡ã€æ–‡ä»¶ç³»ç»Ÿç­‰ç¡¬ä»¶èµ„æºï¼Œæä¾›è¿›ç¨‹ç®¡ç†ã€å†…å­˜ç®¡ç†ã€æ–‡ä»¶ç®¡ç†ã€ç½‘ç»œé€šä¿¡ç­‰åŸºæœ¬çš„ç³»ç»ŸæœåŠ¡ã€‚Kernelè¿˜è´Ÿè´£å¤„ç†ä¸­æ–­ã€å¼‚å¸¸ã€ç³»ç»Ÿè°ƒç”¨ç­‰ç³»ç»Ÿäº‹ä»¶ï¼Œå¹¶å°†å®ƒä»¬åˆ†é…ç»™é€‚å½“çš„è¿›ç¨‹è¿›è¡Œå¤„ç†ã€‚</em></p>
</blockquote>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd kernel/</span><br><span class="line">./build.sh all</span><br></pre></td></tr></table></figure></div>

<h4 id="MCore"><a href="#MCore" class="headerlink" title="MCore"></a><em>MCore</em></h4><blockquote>
<p><em>å¤šæ ¸å¤„ç†å™¨æ˜¯åœ¨å•ä¸ªç‰©ç†èŠ¯ç‰‡ä¸Šé›†æˆäº†å¤šä¸ªå¤„ç†æ ¸å¿ƒçš„å¤„ç†å™¨ï¼Œå¯ä»¥åŒæ—¶æ‰§è¡Œå¤šä¸ªçº¿ç¨‹æˆ–è¿›ç¨‹ï¼Œä»è€Œæé«˜ç³»ç»Ÿçš„æ€§èƒ½å’Œæ•ˆç‡ã€‚æ¯ä¸ªå¤„ç†æ ¸å¿ƒéƒ½å¯ä»¥ç‹¬ç«‹è¿è¡Œï¼Œå…·æœ‰è‡ªå·±çš„å¯„å­˜å™¨ã€ç¼“å­˜ã€æ‰§è¡Œå•å…ƒç­‰ç¡¬ä»¶èµ„æºï¼Œå¹¶ä¸”å¯ä»¥å…±äº«ç³»ç»Ÿèµ„æºï¼Œå¦‚å†…å­˜ã€æ€»çº¿ç­‰ã€‚</em></p>
<p><em>MCoreæ˜¯ä¸€ç§å¤šæ ¸å¤„ç†å™¨æ¶æ„ï¼Œç”±è‹±ç‰¹å°”å…¬å¸å¼€å‘ã€‚MCoreæ¶æ„çš„å¤„ç†å™¨å¯ä»¥åŒ…å«å¤šä¸ªå¤„ç†æ ¸å¿ƒï¼Œæ¯ä¸ªæ ¸å¿ƒéƒ½å¯ä»¥ç‹¬ç«‹è¿è¡Œï¼ŒåŒæ—¶å…±äº«ç³»ç»Ÿèµ„æºã€‚MCoreæ¶æ„çš„å¤„ç†å™¨é€šå¸¸ç”¨äºé«˜æ€§èƒ½åµŒå…¥å¼ç³»ç»Ÿä¸­ï¼Œä¾‹å¦‚è·¯ç”±å™¨ã€äº¤æ¢æœºã€ç½‘ç»œå­˜å‚¨è®¾å¤‡ç­‰ã€‚</em></p>
</blockquote>
<p><em>è¿›å…¥ repoæ ¹ç›®å½•&#x2F;mcoreï¼Œæ‰§è¡Œbuild.shï¼Œå³å¯å¾—åˆ°Mcore.binä¸Mcore.elfã€‚ ç¼–è¯‘æˆåŠŸä¼šæç¤ºå¦‚ä¸‹ä¿¡æ¯</em></p>
<p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230417110135342.png"
                      class="" title="image-20230417110135342"
                ></em></p>
<h2 id="çƒ§å†™é•œåƒè¯´æ˜"><a href="#çƒ§å†™é•œåƒè¯´æ˜" class="headerlink" title="çƒ§å†™é•œåƒè¯´æ˜"></a><em>çƒ§å†™é•œåƒè¯´æ˜</em></h2><h3 id="åœ°å¹³çº¿çƒ§å†™å·¥å…·"><a href="#åœ°å¹³çº¿çƒ§å†™å·¥å…·" class="headerlink" title="åœ°å¹³çº¿çƒ§å†™å·¥å…·"></a><em>åœ°å¹³çº¿çƒ§å†™å·¥å…·</em></h3><p><em>åœ°å¹³çº¿çƒ§å†™å·¥å…·å°†ç”¨äºç»™å¼€å‘æ¿ä¸Šçš„æ ¸å¿ƒæ¿çƒ§å†™ç³»ç»Ÿã€‚ç›®å‰çƒ§å†™å·¥å…·æ”¯æŒwindows 64ä½ç³»ç»Ÿå’Œubuntu14.04ä»¥ä¸Šç³»ç»Ÿã€‚ç”¨æˆ·éœ€å°†ç³»ç»Ÿå¯¹åº”çš„çƒ§å†™ æ–‡ä»¶å‹ç¼©åŒ…ä¸‹è½½å¹¶è§£å‹ï¼ŒæŒ‰é•œåƒçƒ§å†™æµç¨‹ä»‹ç»è¿›è¡Œæ“ä½œã€‚å…¶ä¸­ä¸åŒé€‰é¡¹å¯¹åº”å…·ä½“å«ä¹‰è¯·å‚ è€ƒâ€œMU-3020-15-J5-å¼€å‘æ¿å‡çº§å·¥å…·ä½¿ç”¨æ‰‹å†Œ.docxâ€ã€‚</em></p>
<ul>
<li><em>Windowsï¼šè§£å‹hbupdate_win64_v</em>.zipæ–‡ä»¶ï¼ŒåŒå‡»æ‰§è¡Œè§£å‹åç›®å½•é‡Œçš„hbupdate.exeã€‚logæ–‡ä»¶å­˜ æ”¾åœ¨è§£å‹åçš„logç›®å½•ä¸­ã€‚*</li>
<li><em>Linuxï¼šè§£å‹hbupdate_linux</em> v* .tgzæ–‡ä»¶ï¼Œå…¶ä¸­ * gui <em>ä¸ºå›¾å½¢ç”¨æˆ·æ¥å£ï¼Œ * cli</em>ä¸ºå‘½ä»¤è¡Œç”¨æˆ·æ¥ å£ã€‚åœ¨ç»ˆç«¯è¿è¡Œï¼š*</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd hbupdate-linux</span><br><span class="line">sudo ./hbupdate-linux</span><br></pre></td></tr></table></figure></div>

<p><em>logæ–‡ä»¶å­˜æ”¾åœ¨hbupdate-linux&#x2F;logç›®å½•ã€‚</em></p>
<h4 id="ä½¿ç”¨æµç¨‹"><a href="#ä½¿ç”¨æµç¨‹" class="headerlink" title="ä½¿ç”¨æµç¨‹"></a><em>ä½¿ç”¨æµç¨‹</em></h4><blockquote>
<p><em>é€‰æ‹©äº§å“ç±»å‹</em></p>
</blockquote>
<p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230508083610568.png"
                      class="" title="image-20230508083610568"
                ></em></p>
<blockquote>
<p><em>é€‰æ‹©å‡çº§é…ç½®ï¼ŒåŒ…æ‹¬äº§å“åç§°ã€ä¸‹è½½æ¨¡å¼ã€ä¸‹è½½æ–¹å¼ã€å†…å­˜ç±»å‹</em></p>
</blockquote>
<p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230508083658725.png"
                      class="" title="image-20230508083658725"
                ></em></p>
<blockquote>
<p><em>é€‰æ‹©å‡çº§æ–‡ä»¶åŠå‡çº§æ–‡ä»¶é€‰é¡¹</em></p>
</blockquote>
<p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230508083721413.png"
                      class="" title="image-20230508083721413"
                ></em></p>
<blockquote>
<p><em>é…ç½®äº§å“ä¸PCè¿æ¥å‚æ•°ï¼šæ¿ç«¯ipä¿¡æ¯ã€PCç«¯ä¸²å£ã€ç½‘å£ç­‰</em></p>
</blockquote>
<p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230508083807175-16835062874561.png"
                      class="" title="image-20230508083807175"
                ></em></p>
<blockquote>
<p><em>å¼€å§‹å‡çº§ï¼Œå¹¶æŒ‰ç…§å¼¹çª—ä¿¡æ¯è¿›è¡Œç›¸åº”æ“ä½œ</em></p>
</blockquote>
<p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230508083839507.png"
                      class="" title="image-20230508083839507"
                ></em></p>
<h4 id="ä½¿ç”¨å»ºè®®"><a href="#ä½¿ç”¨å»ºè®®" class="headerlink" title="ä½¿ç”¨å»ºè®®"></a><em>ä½¿ç”¨å»ºè®®</em></h4><ul>
<li><em>ä½¿ç”¨ä¹‹å‰åŠ¡å¿…ä»”ç»†é˜…è¯»ä½¿ç”¨æ‰‹å†Œ</em></li>
<li><em>é•œåƒçš„æ–‡ä»¶åä¸æ”¯æŒä¸­æ–‡ï¼Œä¸èƒ½æœ‰ç©ºæ ¼ï¼Œæœ€å¥½æ˜¯ç®€å•çš„å…¨è‹±æ–‡åŠ ä¸‹åˆ’çº¿</em></li>
<li><em>ä¸ºäº†å¢åŠ é•œåƒä¸‹è½½çš„é€Ÿåº¦å’ŒæˆåŠŸç‡ï¼Œä½¿ç”¨æ¿å­ä¸PCç›´è¿ï¼Œå°¤å…¶ä¸è¦ç”¨æ— çº¿ç½‘ç»œä¸æ¿é€šè®¯</em></li>
<li><em>é…ç½®ç½‘ç»œçš„æ—¶å€™è¦ä»”ç»†ç¡®è®¤æ¿å­çš„ç½‘ç»œå’Œpcçš„ç½‘å¡åœ°å€æ˜¯åœ¨ä¸€ä¸ªå­ç½‘</em></li>
<li><em>è‹¥ç½‘ç»œä¸é€šï¼Œè¯·å…³é—­é˜²ç«å¢™å†å°è¯•</em></li>
<li><em>å½“å•æ¿æ— æ³•å¯åŠ¨æ—¶ï¼Œå¯ä»¥ä½¿ç”¨uartä¸‹è½½æ¨¡å¼çƒ§å½•æ•‘ç –</em></li>
</ul>
<h3 id="UART"><a href="#UART" class="headerlink" title="UART"></a><em>UART</em></h3><blockquote>
<p><em>UARTå…¨ç§°ä¸ºUniversal Asynchronous Receiver&#x2F;Transmitterï¼Œæ˜¯ä¸€ç§å¯ç¼–ç¨‹çš„ä¸²è¡Œé€šä¿¡æ¥å£ï¼Œé€šå¸¸è¢«ç”¨äºå°†è®¡ç®—æœºå’Œå¾®æ§åˆ¶å™¨ã€ä¼ æ„Ÿå™¨ç­‰å¤–éƒ¨è®¾å¤‡è¿›è¡Œé€šä¿¡ã€‚</em></p>
<p><em>UARTé€šè¿‡å°†æ•°æ®ä»¥å›ºå®šçš„é€Ÿç‡å’Œæ ¼å¼è½¬æ¢ä¸ºä¸²è¡Œæ•°æ®æµï¼Œå®ç°è®¡ç®—æœºå’Œå¤–éƒ¨è®¾å¤‡ä¹‹é—´çš„é€šä¿¡ã€‚åœ¨UARTé€šä¿¡ä¸­ï¼Œå‘é€æ•°æ®çš„è®¾å¤‡ä¼šå°†æ•°æ®ä½é€ä¸ªè½¬æ¢ä¸ºäºŒè¿›åˆ¶å½¢å¼ï¼Œç„¶åå°†å…¶ä¼ é€ç»™æ¥æ”¶è®¾å¤‡ã€‚æ¥æ”¶è®¾å¤‡ä¼šå°†ä¸²è¡Œæ•°æ®æµè½¬æ¢ä¸ºå¹¶è¡Œæ•°æ®ï¼Œæ¢å¤åŸæœ¬çš„æ•°æ®ä½æ ¼å¼ã€‚</em></p>
<p><em>UARTæœ‰ä»¥ä¸‹å‡ ä¸ªä¸»è¦ç‰¹ç‚¹ï¼š</em></p>
<ol>
<li><em>åŒå‘é€šä¿¡ã€‚UARTå¯ä»¥åŒæ—¶è¿›è¡Œå‘é€å’Œæ¥æ”¶æ•°æ®ã€‚</em></li>
<li><em>å¼‚æ­¥é€šä¿¡ã€‚UARTä¸éœ€è¦åœ¨å‘é€æ•°æ®å‰å’Œæ¥æ”¶æ•°æ®æ—¶è¿›è¡Œæ—¶é’ŸåŒæ­¥ï¼Œè€Œæ˜¯é€šè¿‡è§„å®šçš„æ³¢ç‰¹ç‡æ¥è¿›è¡Œæ•°æ®ä¼ è¾“ã€‚</em></li>
<li><em>å¯ç¼–ç¨‹æ³¢ç‰¹ç‡å’Œæ•°æ®ä½æ•°ã€‚å¯ä»¥æ ¹æ®éœ€è¦è®¾ç½®æ³¢ç‰¹ç‡ã€æ•°æ®ä½æ•°ã€æ ¡éªŒä½ã€åœæ­¢ä½ç­‰å‚æ•°æ¥é€‚åº”ä¸åŒçš„åº”ç”¨åœºåˆã€‚</em></li>
<li><em>æ•°æ®ä¼ è¾“å¯é æ€§é«˜ã€‚UARTé€šä¿¡é‡‡ç”¨åŒå‘æ•°æ®ä¼ è¾“ï¼Œæ•°æ®ä¼ è¾“å¯é æ€§é«˜ï¼Œå…·æœ‰è‡ªåŠ¨é‡å‘æœºåˆ¶ï¼Œèƒ½å¤Ÿä¿è¯æ•°æ®çš„å®Œæ•´æ€§ã€‚</em></li>
</ol>
<p><em>UARTè¢«å¹¿æ³›åº”ç”¨äºå„ç§è®¾å¤‡å’Œç³»ç»Ÿä¸­ï¼Œæ¯”å¦‚ä¸²å£é€šä¿¡ã€åµŒå…¥å¼ç³»ç»Ÿã€ç‰©è”ç½‘è®¾å¤‡ç­‰ç­‰ã€‚</em></p>
</blockquote>
<blockquote>
<p><em>eMMCå¯åŠ¨æ˜¯æŒ‡é€šè¿‡eMMCï¼ˆembedded MultiMediaCardï¼‰é—ªå­˜èŠ¯ç‰‡æ¥è¿›è¡Œå¯åŠ¨ç¨‹åºçš„è¿‡ç¨‹ã€‚eMMCæ˜¯ä¸€ç§ç”¨äºç§»åŠ¨è®¾å¤‡å’ŒåµŒå…¥å¼ç³»ç»Ÿçš„å­˜å‚¨å™¨æ ‡å‡†ï¼Œé€šå¸¸åŒ…æ‹¬ä¸€ä¸ªé—ªå­˜èŠ¯ç‰‡å’Œä¸€ä¸ªæ§åˆ¶å™¨èŠ¯ç‰‡ï¼Œå¯ä»¥ç”¨äºå­˜å‚¨æ“ä½œç³»ç»Ÿã€åº”ç”¨ç¨‹åºã€æ•°æ®ç­‰ã€‚</em></p>
<p><em>åœ¨ä¸€äº›åµŒå…¥å¼ç³»ç»Ÿä¸­ï¼Œæ¯”å¦‚Androidæ‰‹æœºã€æ™ºèƒ½ç”µè§†ç­‰è®¾å¤‡ï¼Œä½¿ç”¨eMMCä½œä¸ºå¯åŠ¨è®¾å¤‡æ¥åŠ è½½æ“ä½œç³»ç»Ÿå’Œå¼•å¯¼ç¨‹åºã€‚å¯åŠ¨è¿‡ç¨‹å¯ä»¥åˆ†ä¸ºé¢„å¯åŠ¨å’Œå¼•å¯¼ä¸¤ä¸ªé˜¶æ®µã€‚</em></p>
<p><em>åœ¨é¢„å¯åŠ¨é˜¶æ®µï¼Œè®¾å¤‡é¦–å…ˆä¼šåŠ è½½å¼•å¯¼å›ºä»¶ï¼ˆBootloaderï¼‰ï¼Œå¹¶åˆå§‹åŒ–eMMCé©±åŠ¨ç¨‹åºï¼Œä»¥ç¡®ä¿å¯ä»¥æ­£ç¡®åœ°è®¿é—®eMMCå­˜å‚¨å™¨ã€‚ç„¶åï¼Œå¼•å¯¼å›ºä»¶ä¼šå¯»æ‰¾å¹¶åŠ è½½æ“ä½œç³»ç»Ÿå†…æ ¸å’Œå†…æ ¸æ‰€éœ€çš„é©±åŠ¨ç¨‹åºç­‰ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼ŒeMMCå­˜å‚¨å™¨ä¼šè¢«ä½œä¸ºä¸€ä¸ªå—è®¾å¤‡æ¥è®¿é—®ï¼Œé€šè¿‡eMMCæ€»çº¿åè®®ä»é—ªå­˜èŠ¯ç‰‡ä¸­è¯»å–æ•°æ®ã€‚</em></p>
<p><em>åœ¨å¼•å¯¼é˜¶æ®µï¼Œè®¾å¤‡ä¼šä»eMMCä¸­åŠ è½½æ“ä½œç³»ç»Ÿå†…æ ¸ï¼Œå¹¶å°†ç³»ç»Ÿæ§åˆ¶æƒäº¤ç»™å†…æ ¸æ¥å®Œæˆå¯åŠ¨è¿‡ç¨‹ã€‚æ­¤æ—¶ï¼ŒeMMCä»ç„¶å¯ä»¥è¢«ç”¨æ¥è®¿é—®æ›´å¤šçš„åº”ç”¨ç¨‹åºå’Œæ•°æ®ã€‚æ•´ä¸ªè¿‡ç¨‹éœ€è¦é€šè¿‡è®¾å¤‡çš„å¼•å¯¼æ–¹å¼å’Œå¼•å¯¼åˆ†åŒºæ¥æŒ‡å®šï¼Œä»¥ç¡®ä¿å¯ä»¥æ­£ç¡®åœ°ä»eMMCä¸­å¯åŠ¨å’ŒåŠ è½½æ•°æ®ã€‚</em></p>
<p><em>æ€»ä¹‹ï¼ŒeMMCå¯åŠ¨æ˜¯æŒ‡é€šè¿‡eMMCå­˜å‚¨å™¨æ¥è¿›è¡Œå¯åŠ¨ç¨‹åºçš„è¿‡ç¨‹ï¼Œæ˜¯åµŒå…¥å¼ç³»ç»Ÿå’Œç§»åŠ¨è®¾å¤‡ä¸­å¹¿æ³›é‡‡ç”¨çš„ä¸€ç§å¯åŠ¨æ–¹å¼ã€‚</em></p>
</blockquote>
<p><em>a. çƒ§å½•å‡†å¤‡ è°ƒæ•´æ¿ä¸ŠDIPå¼€å…³è‡³UARTå¯åŠ¨æ¨¡å¼ï¼Œæ³¢ç‰¹ç‡921600ï¼Œä¸‹è½½å¹¶è§£å‹å‘å¸ƒåŒ…ã€‚ b. çƒ§å½•å‘½ä»¤</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">python3 x-modem-download/uart-load.py --secboot -d /dev/tty* -b 921600 -i *.*.*.* -p */packages/ flash</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">python3ï¼šä½¿ç”¨Python 3æ¥è¿è¡Œåé¢çš„è„šæœ¬ã€‚</span><br><span class="line">x-modem-download/uart-load.pyï¼šæŒ‡å®šè¦è¿è¡Œçš„ Python è„šæœ¬ï¼Œå³ uart-load.pyã€‚x-modem-download æ˜¯è„šæœ¬æ‰€åœ¨çš„ç›®å½•ã€‚</span><br><span class="line">â€“secbootï¼šè¡¨ç¤ºåœ¨ä¸‹è½½æ–‡ä»¶ä¹‹å‰è¿›è¡ŒèŠ¯ç‰‡éªŒè¯ï¼ˆsecure bootï¼‰ã€‚</span><br><span class="line">-d /dev/tty*ï¼šæŒ‡å®šæœ¬åœ°ä¸²è¡Œé€šä¿¡ç«¯å£ï¼Œ* é€šé…ç¬¦è¡¨ç¤ºè¯¥å‚æ•°å¯ä»¥æ˜¯ç¬¦åˆè¦æ±‚çš„ä»»ä½•å­—ç¬¦ä¸²ï¼Œä¾‹å¦‚ /dev/ttyS0 æˆ– /dev/ttyUSB0ã€‚</span><br><span class="line">-b 921600ï¼šæŒ‡å®šæ³¢ç‰¹ç‡ï¼ˆå³æ•°æ®ä¼ è¾“é€Ÿåº¦ï¼‰ï¼Œä»£è¡¨æ¯ç§’å¯ä»¥ä¼ è¾“ 921600 ä¸ªæ•°æ®ä½ã€‚</span><br><span class="line">-i *.*.*.*ï¼šæŒ‡å®šè¦ä¸‹è½½æ•°æ®çš„ç›®æ ‡ IP åœ°å€ï¼Œ* é€šé…ç¬¦è¡¨ç¤ºè¯¥å‚æ•°å¯ä»¥æ˜¯ç¬¦åˆè¦æ±‚çš„ä»»ä½•å­—ç¬¦ä¸²ï¼Œä¾‹å¦‚ 192.168.0.1ã€‚</span><br><span class="line">-p /packages/ï¼šæŒ‡å®šè¦å‘é€çš„æ•°æ®æ‰€åœ¨çš„è·¯å¾„ï¼Œ é€šé…ç¬¦è¡¨ç¤ºè¯¥å‚æ•°å¯ä»¥æ˜¯ç¬¦åˆè¦æ±‚çš„ä»»ä½•å­—ç¬¦ä¸²ï¼Œä¾‹å¦‚ /home/user/files/ã€‚</span><br><span class="line">flashï¼šæŒ‡å®šæ•°æ®å­˜å‚¨çš„ä½ç½®ï¼Œå…·ä½“å«ä¹‰è¦çœ‹è®¾å¤‡æœ¬èº«çš„å­˜å‚¨ç»“æ„ï¼Œè¿™é‡Œè¡¨ç¤ºå­˜å‚¨åˆ°è®¾å¤‡çš„ flash å­˜å‚¨å™¨ä¸­ã€‚</span><br></pre></td></tr></table></figure></div>

<p><em>æ˜Ÿå·éƒ¨åˆ†åˆ†åˆ«ä¿®æ”¹ä¸ºå•æ¿ä¸²å£è®¾å¤‡ã€å•æ¿é…ç½®ipã€å‘å¸ƒåŒ…packagesè·¯å¾„ã€‚</em></p>
<h4 id="SecureCRT-1"><a href="#SecureCRT-1" class="headerlink" title="SecureCRT"></a><em>SecureCRT</em></h4><blockquote>
<p><em>SecureCRTæ˜¯ä¸€æ¬¾ç½‘ç»œç»ˆç«¯ä»¿çœŸè½¯ä»¶ï¼Œå¯ä»¥é€šè¿‡SSHã€Telnetã€Rloginã€Serialã€TAPIå’ŒRAWåè®®è¿æ¥åˆ°è¿œç¨‹æœåŠ¡å™¨ï¼Œæä¾›å®‰å…¨ã€ç¨³å®šã€é«˜æ•ˆçš„è¿œç¨‹è®¿é—®ä½“éªŒã€‚</em></p>
<p><em>SecureCRTåŒ…å«äº†å„ç§å¸¸ç”¨çš„ç»ˆç«¯ä»¿çœŸåŠŸèƒ½ï¼Œå¦‚ä¼šè¯ç®¡ç†ã€å¤šæ ‡ç­¾çª—å£ã€å¤šæœºä½ã€åŠ¨æ€ç«¯å£è½¬å‘ã€è‡ªåŠ¨åŒ–è„šæœ¬ã€é‡è¦ä¼šè¯çš„å¤‡ä»½å’Œæ—¥å¿—è®°å½•ç­‰ï¼ŒåŒæ—¶è¿˜æ”¯æŒæ‰©å±•æ’ä»¶ã€è‡ªå®šä¹‰å¿«æ·é”®ã€è‡ªåŠ¨æŒ‰é”®è®°å½•ç­‰ä¾¿æ·çš„æ“ä½œæ–¹å¼ï¼Œæ–¹ä¾¿ç”¨æˆ·è¿›è¡Œç®¡ç†å’Œé…ç½®ã€‚</em></p>
</blockquote>
<p><em>åœ¨èœå•é‡Œé€‰æ‹©å¯¹åº”ä¼ è¾“åè®®ã€‚</em></p>
<h4 id="Minicom-1"><a href="#Minicom-1" class="headerlink" title="Minicom"></a><em>Minicom</em></h4><blockquote>
<p><em>Minicomæ˜¯ä¸€æ¬¾å¸¸ç”¨çš„ä¸²å£é€šä¿¡å·¥å…·ï¼Œé€šå¸¸ç”¨äºåœ¨Linuxç³»ç»Ÿä¸­è¿æ¥åˆ°ä¸²å£è®¾å¤‡è¿›è¡Œé€šä¿¡ã€è°ƒè¯•ç­‰æ“ä½œã€‚Minicomæ”¯æŒå¤šç§ä¸²å£ã€USB-to-serialé€‚é…å™¨ã€ä»¥åŠè¿œç¨‹ç»ˆç«¯ï¼Œæ˜¯ä¸€æ¬¾åŠŸèƒ½å¼ºå¤§çš„ä¸²å£ç»ˆç«¯å·¥å…·ã€‚</em></p>
<p><em>Minicomå¯ä»¥é€šè¿‡å‘½ä»¤è¡Œæ–¹å¼å¯åŠ¨ï¼Œå¹¶æä¾›äº†æ–¹ä¾¿çš„èœå•ç•Œé¢å’Œå¿«æ·é”®æ“ä½œã€‚å®ƒæ”¯æŒä¸²å£è®¾ç½®ã€é€šä¿¡åè®®ã€ç¡¬ä»¶æµæ§ç­‰å¸¸è§çš„ä¸²å£é€šè®¯è®¾ç½®ï¼Œå¹¶å¯ä»¥ä¿å­˜å¤šä¸ªä¼šè¯è¿æ¥ï¼Œæ–¹ä¾¿ç”¨æˆ·åˆ‡æ¢å’Œç®¡ç†ã€‚æ­¤å¤–ï¼ŒMinicomè¿˜æ”¯æŒè‡ªåŠ¨åŒ–è„šæœ¬ï¼Œå¯ä»¥é€šè¿‡è„šæœ¬åŠŸèƒ½å®ç°ä¸²å£è‡ªåŠ¨æµ‹è¯•ã€è®¾å¤‡è‡ªåŠ¨åŒ–æµ‹è¯•ç­‰åŠŸèƒ½ã€‚</em></p>
<p><em>Minicomç›¸å¯¹äºå…¶ä»–ä¸²å£ç»ˆç«¯å·¥å…·å…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š</em></p>
<ol>
<li><em>å¼€æºå…è´¹ï¼šMinicomæ˜¯ä¸€æ¬¾å®Œå…¨å¼€æºçš„è½¯ä»¶ï¼Œç”¨æˆ·å¯ä»¥å…è´¹ä¸‹è½½ä½¿ç”¨ï¼Œä¸”æä¾›æºä»£ç ï¼Œç”¨æˆ·å¯è‡ªç”±è¿›è¡Œä¿®æ”¹å’Œå®šåˆ¶ã€‚</em></li>
<li><em>æ˜“äºå®‰è£…å’Œä½¿ç”¨ï¼šMinicomé€šå¸¸åœ¨Linuxç³»ç»Ÿä¸­é¢„å®‰è£…ï¼Œç”¨æˆ·å¯ç›´æ¥ä½¿ç”¨å‘½ä»¤è¡Œå¯åŠ¨è¿›è¡Œé€šä¿¡ï¼Œç•Œé¢ç®€æ´æ˜“ç”¨ã€‚</em></li>
<li><em>æ”¯æŒè„šæœ¬ç¼–å†™ï¼šMinicomæä¾›äº†è‡ªåŠ¨åŒ–è„šæœ¬ç¼–å†™åŠŸèƒ½ï¼Œå¯ä»¥æ”¯æŒç”¨æˆ·å®Œæˆä¸€äº›è‡ªåŠ¨åŒ–æµ‹è¯•å’Œé…ç½®ã€‚</em></li>
</ol>
</blockquote>
<p><em>Ctrl-A+S å¯é€‰æ‹©å…·ä½“åè®®ã€‚ å‰å¾€è¾“å…¥ç›®å½•ï¼Œã€ç©ºæ ¼ã€‘é”®å¯é€‰æ‹©å“ªä¸ªæ–‡ä»¶ï¼Œç„¶åOKç¡®è®¤ï¼Œæ‰§è¡Œä¸‹è½½ã€‚ æ³¨æ„ï¼šROMé˜¶æ®µå…ˆç”¨XModemåè®®ä¼ è¾“SPLï¼Œå…¶ä½™é•œåƒä½¿ç”¨YModemåè®®ä¼ è¾“ï¼š ä¸Šç”µæç¤ºä»ä¸²å£å¯åŠ¨åï¼Œé€šè¿‡ä¸²å£XMODEMåè®®ä¸‹è½½spl</em>.binåˆ°SRAMï¼› æŒ‰ç…§æç¤ºé€šè¿‡ä¸²å£YMODEMåè®®ä¸‹è½½boot.pkgï¼Œä¸‹è½½å®Œæˆè¿›å…¥u-boot consoleè¿›è¡Œåç»­çƒ§å†™ã€‚*</p>
<h4 id="Linuxå‘½ä»¤è¡Œ"><a href="#Linuxå‘½ä»¤è¡Œ" class="headerlink" title="Linuxå‘½ä»¤è¡Œ"></a><em>Linuxå‘½ä»¤è¡Œ</em></h4><ol>
<li><em>è°ƒæ•´æ¿ä¸ŠDIPå¼€å…³è‡³UARTå¯åŠ¨æ¨¡å¼ï¼Œæ³¢ç‰¹ç‡921600</em></li>
<li><em>ä¸‹è½½å¹¶è§£å‹å‘å¸ƒåŒ…</em></li>
<li><em>çƒ§å½•å‘½ä»¤ï¼š</em></li>
</ol>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 x-modem-download/uart-load.py -d /dev/tty* -b 921600 -i *.*.*.* -p */packages/ flash</span><br></pre></td></tr></table></figure></div>

<p><em>å¤‡æ³¨ï¼šéƒ¨åˆ†åˆ†åˆ«ä¿®æ”¹ä¸ºå•æ¿ä¸²å£è®¾å¤‡ã€å•æ¿é…ç½®ipã€å‘å¸ƒåŒ…packagesè·¯å¾„</em></p>
<h3 id="Uboot-1"><a href="#Uboot-1" class="headerlink" title="Uboot"></a><em>Uboot</em></h3><h4 id="çƒ§å†™å®Œæ•´é•œåƒ"><a href="#çƒ§å†™å®Œæ•´é•œåƒ" class="headerlink" title="çƒ§å†™å®Œæ•´é•œåƒ"></a><em>çƒ§å†™å®Œæ•´é•œåƒ</em></h4><p><em>åœ¨UBootå†…ï¼š</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">setenv ipaddr xx.xx.xx.yy /*å¼€å‘æ¿IPåœ°å€*/</span><br><span class="line">setenv serverip xx.xx.xx.xx /*ä¸»æœºipåœ°å€*/</span><br><span class="line">tftp 0xa0000000 disk.img</span><br><span class="line">mmc write 0xa0000000 0 $&#123;filesize&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">tftp 0xa0000000 disk.imgï¼šè¿™ä¸ªå‘½ä»¤ä½¿ç”¨TFTPåè®®ä»ä¸»æœºä¸‹è½½æ–‡ä»¶ disk.img å¹¶å­˜å‚¨åˆ°å¼€å‘æ¿çš„å†…å­˜åœ°å€ 0xa0000000 å¤„ã€‚TFTPæ˜¯ä¸€ç§ç®€å•çš„æ–‡ä»¶ä¼ è¾“åè®®ï¼Œé€šå¸¸ç”¨äºåœ¨åµŒå…¥å¼ç³»ç»Ÿä¸­ä»è¿œç¨‹ä¸»æœºä¸‹è½½æ–‡ä»¶ã€‚</span><br><span class="line"></span><br><span class="line">mmc write 0xa0000000 0 $&#123;filesize&#125;ï¼šè¿™ä¸ªå‘½ä»¤å°†å†…å­˜åœ°å€ 0xa0000000 å¤„çš„æ•°æ®å†™å…¥åˆ°MMCï¼ˆå¤šåª’ä½“å¡ï¼‰è®¾å¤‡çš„ç¬¬ä¸€ä¸ªæ‰‡åŒºï¼ˆåç§»é‡ä¸º0ï¼‰ã€‚$&#123;filesize&#125; æ˜¯ä¸€ä¸ªå˜é‡ï¼Œè¡¨ç¤ºæ–‡ä»¶å¤§å°ï¼Œå°†æ ¹æ®å®é™…ä¸‹è½½çš„æ–‡ä»¶å¤§å°è¿›è¡Œæ›¿æ¢ã€‚è¿™ä¸ªå‘½ä»¤é€šå¸¸ç”¨äºå°†ä¸‹è½½çš„æ˜ åƒæ–‡ä»¶å†™å…¥MMCè®¾å¤‡çš„å­˜å‚¨åŒºï¼Œä»¥ä¾¿åœ¨å¼€å‘æ¿ä¸Šè¿›è¡Œç³»ç»Ÿæ›´æ–°æˆ–å›ºä»¶çƒ§å½•ã€‚</span><br></pre></td></tr></table></figure></div>

<h4 id="çƒ§å†™å•ç‹¬é•œåƒ"><a href="#çƒ§å†™å•ç‹¬é•œåƒ" class="headerlink" title="çƒ§å†™å•ç‹¬é•œåƒ"></a><em>çƒ§å†™å•ç‹¬é•œåƒ</em></h4><p><em>åœ¨UBootå†…ï¼š å¦‚å•ç‹¬çƒ§å†™åˆ†åŒºé•œåƒpartï¼Œå¯¹åº”æ–‡ä»¶fileï¼š ä½¿ç”¨mmc writeå‘½ä»¤ã€‚</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">tftp 0xa0000000 $file</span><br><span class="line">mmc write 0xa0000000 [part addr] [part len]</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p><em>part addrä¸ºç›®æ ‡åˆ†åŒºèµ·å§‹åœ°å€ï¼Œå¯ä»¥é€šè¿‡mmc partå‘½ä»¤æŸ¥è¯¢åè®¡ç®—ï¼ˆèµ·å§‹blkï¼‰ï¼›part lenä¸ºæ“¦å†™å—æ€»æ•°ï¼Œç”±ï¼ˆfilesize&#x2F;0x200ï¼‰å¾—å‡ºï¼Œå…¶ä¸­ï¼Œfilesizeä¸ºæ–‡ä»¶å¤§å°ï¼Œå¿…é¡»ä¸º16è¿›åˆ¶ï¼Œtftpä¸‹è½½åä¼šæ‰“å°å‡ºæ¥ã€‚ åœ¨Kernelå†…ï¼š é€šè¿‡tftpä¸‹è½½æ–‡ä»¶ã€‚</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ifconfig eth1 xx.xx.xx.xx</span><br><span class="line">tftp â€“g xx.xx.xx.xx -r $file</span><br><span class="line"></span><br><span class="line">ifconfig eth1 xx.xx.xx.xxï¼šè¿™ä¸ªæŒ‡ä»¤ç”¨äºé…ç½®ç½‘ç»œæ¥å£ eth1 çš„IPåœ°å€ä¸º xx.xx.xx.xxã€‚ifconfig æ˜¯ä¸€ä¸ªç”¨äºé…ç½®ç½‘ç»œæ¥å£çš„å‘½ä»¤ï¼Œé€šè¿‡æŒ‡å®šæ¥å£åå’ŒIPåœ°å€æ¥é…ç½®å¯¹åº”çš„ç½‘ç»œæ¥å£ã€‚</span><br><span class="line"></span><br><span class="line">tftp â€“g xx.xx.xx.xx -r $fileï¼šè¿™ä¸ªæŒ‡ä»¤ä½¿ç”¨TFTPåè®®ä»è¿œç¨‹ä¸»æœº xx.xx.xx.xx ä¸‹è½½æ–‡ä»¶ã€‚-g å‚æ•°è¡¨ç¤ºä½¿ç”¨&quot;get&quot;ï¼ˆè·å–ï¼‰æ¨¡å¼ï¼Œ-r å‚æ•°åé¢è·Ÿç€çš„æ˜¯è¦ä¸‹è½½çš„æ–‡ä»¶åï¼Œè€Œ $file åˆ™æ˜¯ä¸€ä¸ªå˜é‡ï¼Œè¡¨ç¤º</span><br></pre></td></tr></table></figure></div>

<p><em>å°†æ–‡ä»¶å†™å…¥å¯¹åº”åˆ†åŒºã€‚åˆ†åŒºå®šä¹‰å¯é€šè¿‡å‘½ä»¤â€fdisk -lâ€æŸ¥çœ‹ã€‚</em></p>
<h4 id="Fastboot"><a href="#Fastboot" class="headerlink" title="Fastboot"></a><em>Fastboot</em></h4><blockquote>
<p><em>Fastbootæ˜¯ä¸€ç§ç”¨äºAndroidè®¾å¤‡çš„å¼€å‘è€…å·¥å…·å’Œåè®®ï¼Œç”¨äºåœ¨è®¾å¤‡ä¸Šæ‰§è¡Œå„ç§æ“ä½œï¼Œä¾‹å¦‚åˆ·å†™å›ºä»¶ã€è§£é”å¼•å¯¼åŠ è½½ç¨‹åºã€åˆ·å…¥åˆ†åŒºã€å®‰è£…ç³»ç»Ÿæ˜ åƒç­‰ã€‚</em></p>
<p><em>ä»¥ä¸‹æ˜¯Fastbootçš„ä¸»è¦ç‰¹ç‚¹å’Œç”¨é€”ï¼š</em></p>
<ol>
<li><em>åˆ·å†™å›ºä»¶å’Œåˆ†åŒºï¼šFastbootå…è®¸å¼€å‘äººå‘˜å°†å›ºä»¶ï¼ˆå¦‚æ“ä½œç³»ç»Ÿã€å¼•å¯¼åŠ è½½ç¨‹åºã€å†…æ ¸ç­‰ï¼‰å’Œåˆ†åŒºæ˜ åƒåˆ·å†™åˆ°Androidè®¾å¤‡çš„å­˜å‚¨å™¨ä¸­ã€‚è¿™æ˜¯ä¸€ç§å¸¸ç”¨çš„æ–¹å¼æ¥æ›´æ–°è®¾å¤‡çš„å›ºä»¶æˆ–è¿›è¡Œå®šåˆ¶å¼€å‘ã€‚</em></li>
<li><em>è§£é”å¼•å¯¼åŠ è½½ç¨‹åºï¼šFastbootæä¾›äº†ä¸€ç§æ–¹å¼æ¥è§£é”è®¾å¤‡çš„å¼•å¯¼åŠ è½½ç¨‹åºï¼ˆBootloaderï¼‰ã€‚è§£é”å¼•å¯¼åŠ è½½ç¨‹åºå¯ä»¥å…è®¸ç”¨æˆ·åœ¨è®¾å¤‡ä¸Šå®‰è£…è‡ªå®šä¹‰å›ºä»¶ã€æ ¹æ®éœ€è¦æ›´æ”¹ç³»ç»Ÿè®¾ç½®ç­‰ã€‚ä½†è¯·æ³¨æ„ï¼Œè§£é”å¼•å¯¼åŠ è½½ç¨‹åºå¯èƒ½ä¼šå¯¼è‡´è®¾å¤‡å®‰å…¨æ€§é™ä½å¹¶ä¸”å¤±å»æŸäº›ä¿ä¿®å’Œæ”¯æŒã€‚</em></li>
<li><em>å®‰è£…ç³»ç»Ÿæ˜ åƒï¼šFastbootå¯ç”¨äºå°†å®Œæ•´çš„Androidç³»ç»Ÿæ˜ åƒï¼ˆå¦‚ROMã€GSIç­‰ï¼‰åˆ·å…¥è®¾å¤‡ä¸­ã€‚è¿™å¯¹äºå¼€å‘äººå‘˜å’ŒROMå®šåˆ¶è€…æ¥è¯´æ˜¯éå¸¸æœ‰ç”¨çš„ï¼Œå¯ä»¥è¿›è¡Œç³»ç»Ÿçº§åˆ«çš„ä¿®æ”¹å’Œè°ƒè¯•ã€‚</em></li>
<li><em>è°ƒè¯•å’Œæ•…éšœæ’é™¤ï¼šFastbootè¿˜æä¾›äº†ä¸€äº›è°ƒè¯•åŠŸèƒ½ï¼Œä¾‹å¦‚æŸ¥çœ‹è®¾å¤‡çŠ¶æ€ã€æŸ¥çœ‹åˆ†åŒºä¿¡æ¯ã€é‡æ–°å¯åŠ¨è®¾å¤‡ç­‰ã€‚è¿™å¯¹äºå¼€å‘äººå‘˜åœ¨è°ƒè¯•å’Œæ•…éšœæ’é™¤è¿‡ç¨‹ä¸­éå¸¸æœ‰å¸®åŠ©ã€‚</em></li>
</ol>
<p><em>ä½¿ç”¨Fastbootéœ€è¦åœ¨è®¡ç®—æœºä¸Šå®‰è£…ADBï¼ˆAndroid Debug Bridgeï¼‰å·¥å…·å’Œè®¾å¤‡é©±åŠ¨ç¨‹åºã€‚ç„¶åï¼Œé€šè¿‡è¿æ¥Androidè®¾å¤‡åˆ°è®¡ç®—æœºï¼Œå¹¶åœ¨è®¡ç®—æœºä¸Šè¿è¡Œç›¸åº”çš„Fastbootå‘½ä»¤ï¼Œå¯ä»¥ä¸è®¾å¤‡è¿›è¡Œé€šä¿¡å’Œæ‰§è¡Œå„ç§æ“ä½œã€‚</em></p>
</blockquote>
<p><em><strong>fastbootåˆ‡å¿Œä½¿ç”¨ç³»ç»Ÿè‡ªå¸¦çš„ç‰ˆæœ¬ï¼Œå¯åˆ°<a class="link"   target="_blank" rel="noopener" href="https://wiki.lineageos.org/adb_fastboot_guide.html%E4%B8%8B%E8%BD%BD%EF%BC%8C%E6%88%96%E4%BB%8E%E5%8F%91%E5%B8%83%E5%8C%85downloadtools/fastboot/%E8%B7%AF%E5%BE%84%E4%B8%8B%E8%8E%B7%E5%8F%96%E3%80%82" >https://wiki.lineageos.org/adb_fastboot_guide.htmlä¸‹è½½ï¼Œæˆ–ä»å‘å¸ƒåŒ…downloadtools/fastboot/è·¯å¾„ä¸‹è·å–ã€‚ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></strong></em></p>
<p><em>åœ¨Kernelå†…ï¼š</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reboot bootloader</span><br></pre></td></tr></table></figure></div>

<p><em>åœ¨UBootå†…ï¼š</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">run fastboot_cmd</span><br></pre></td></tr></table></figure></div>

<p><em>ä½¿ç”¨æ–¹æ³•ï¼š å¼€å‘æ¿é€šè¿‡ä¸Šè¿°æ–¹æ³•è¿›å…¥Fastbootæ¨¡å¼ï¼Œå¹¶é€šè¿‡ethernetè¿æ¥è‡³PCï¼Œè€ŒPCç«¯éœ€å®‰è£…Fastboot å·¥å…·ï¼Œè¯·å‚è€ƒLineageOSå®˜ç½‘é…ç½®ã€‚ä½¿ç”¨Fastbootçƒ§å†™é•œåƒã€‚ å•æ¿ç«¯å‘½ä»¤ï¼š</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#é…ç½®å•æ¿ip</span><br><span class="line">setenv ipaddr xx.xx.xx.xx</span><br><span class="line">#è¿›å…¥fastbootæ¨¡å¼</span><br><span class="line">run fastboot_cmd</span><br><span class="line">#æŸ¥çœ‹mmcåˆ†åŒºè¡¨</span><br><span class="line">mmc part</span><br><span class="line">#æŸ¥çœ‹mtdåˆ†åŒºè¡¨</span><br><span class="line">mtd list</span><br></pre></td></tr></table></figure></div>

<p><em>PCç«¯å‘½ä»¤ï¼š</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">#é…ç½®è¦å‡çº§çš„å•æ¿ip,ipéœ€ä¸å¼€å‘æ¿é…ç½®ç›¸åŒ</span><br><span class="line">export ANDROID_SERIAL=udp:xx.xx.xx.xx:5554</span><br><span class="line">#è¿›å…¥å‘å¸ƒåŒ…packagesç›®å½•ï¼Œä½¿ç”¨è„šæœ¬å®Œæ•´å‡çº§é•œåƒ</span><br><span class="line">./flash_all.sh</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#flash_all.shéƒ¨åˆ†å¯é€‰é…ç½®</span><br><span class="line">[--golden] [--packages &lt;~/images/packages&gt;] [--ignore_bigimage] [--bootdevice mmc] [--secure]</span><br><span class="line">#å‡çº§goldené•œåƒ</span><br><span class="line">[--golden]</span><br><span class="line">#é•œåƒæ–‡ä»¶æ‰€åœ¨è·¯å¾„</span><br><span class="line">[--packages &lt;~/images/packages&gt;]</span><br><span class="line">#å¿½ç•¥å¤§é•œåƒæ–‡ä»¶å‡çº§</span><br><span class="line">[--ignore_bigimage]</span><br><span class="line">#å¼ºåˆ¶é€‰æ‹©å‡çº§é•œåƒä½ç½®ï¼Œmmc/nor/hyper</span><br><span class="line">[--bootdevice mmc/nor/hyper]</span><br><span class="line">#å‡çº§secure boot		Secure Bootæ˜¯è®¸å¤šç°ä»£è®¡ç®—æœºä¸Šçš„å®‰å…¨åŠŸèƒ½ä¹‹ä¸€ã€‚å®ƒæ—¨åœ¨ç¡®ä¿åœ¨è®¡ç®—æœºå¯åŠ¨è¿‡ç¨‹ä¸­ä»…åŠ è½½ç”±æ“ä½œç³»ç»Ÿåˆ¶é€ å•†ç­¾åçš„ä»£ç å’Œé©±åŠ¨ç¨‹åºï¼Œä»è€Œé˜²æ­¢æ¶æ„ä»£ç å¯åŠ¨å’Œæ”»å‡»ã€‚</span><br><span class="line">[--secure]</span><br></pre></td></tr></table></figure></div>

<blockquote>
<p><em><strong>Goldené•œåƒæ˜¯æŒ‡å·²ç»è¢«å®Œå…¨é…ç½®ã€å¹¶è¿›è¡Œäº†æ‰€æœ‰å¿…è¦çš„è½¯ä»¶å®‰è£…å’Œæ›´æ–°çš„é•œåƒã€‚</strong>å®ƒå¯ä»¥å¿«é€Ÿéƒ¨ç½²åœ¨å¤šä¸ªè®¡ç®—æœºä¸Šï¼Œè¿™äº›è®¡ç®—æœºå…±äº«ç›¸åŒçš„è½¯ä»¶å’Œé…ç½®ï¼Œä»è€Œç¡®ä¿åœ¨æ•´ä¸ªç»„ç»‡ä¸­è·å¾—ä¸€è‡´ä¸”å¯é çš„éƒ¨ç½²ã€‚Goldené•œåƒé€šå¸¸ç”¨äºå¤§å‹ä¼ä¸šæˆ–ç»„ç»‡å†…éƒ¨ã€ITéƒ¨é—¨æˆ–ç³»ç»Ÿç®¡ç†å‘˜å®Œæˆé•œåƒåˆ›å»ºã€‚</em></p>
<p><em>Goldené•œåƒå¯ä»¥åŒ…å«æ“ä½œç³»ç»Ÿã€é¢„å®‰è£…çš„è½¯ä»¶ã€å®‰å…¨è®¾ç½®ã€ç³»ç»Ÿé…ç½®æ–‡ä»¶å’Œè¡¥ä¸ç­‰å†…å®¹ã€‚åœ¨åˆ›å»ºé•œåƒæ—¶ï¼Œç®¡ç†å‘˜åº”è¯¥è€ƒè™‘åˆ°éœ€è¦åˆ›å»ºçš„è®¡ç®—æœºæ•°é‡ã€ç¡¬ä»¶ç±»å‹ã€æ“ä½œç³»ç»Ÿç‰ˆæœ¬ç­‰ï¼Œä»¥ç¡®ä¿é•œåƒèƒ½å¤Ÿåœ¨æ‰€æœ‰ç›®æ ‡è®¡ç®—æœºä¸ŠæˆåŠŸéƒ¨ç½²ã€‚</em></p>
<p><em>ä½¿ç”¨Goldené•œåƒå¯ä»¥å¸¦æ¥å¤šä¸ªå¥½å¤„ï¼š</em></p>
<ol>
<li><em>ç®€åŒ–éƒ¨ç½²è¿‡ç¨‹ï¼šé€šè¿‡ä½¿ç”¨Goldené•œåƒï¼Œå¯ä»¥å‡å°‘éƒ¨ç½²æ–°è®¡ç®—æœºæ—¶çš„å·¥ä½œé‡å’Œæ—¶é—´ã€‚å½“éœ€è¦éƒ¨ç½²æ–°è®¡ç®—æœºæ—¶ï¼Œåªè¦å°†Goldené•œåƒåº”ç”¨åˆ°ç¡¬ä»¶ä¸Šï¼Œç³»ç»Ÿç®¡ç†å‘˜ä¾¿ä¸éœ€è¦ä¸€éåˆä¸€éåœ°æ‰‹åŠ¨æ“ä½œï¼Œä»è€Œå¯ä»¥å¿«é€Ÿä¸”ä¸€è‡´åœ°éƒ¨ç½²æ–°è®¡ç®—æœºã€‚</em></li>
<li><em>åŠ å¼ºå®‰å…¨æ€§ï¼šé€šè¿‡é¢„é…ç½®çš„å®‰å…¨è®¾ç½®å’Œæ›´æ–°ï¼Œå¯ä»¥ç¡®ä¿æ‰€æœ‰çš„è®¡ç®—æœºéƒ½éœ€è¦æœ‰ç›¸åŒçš„å®‰å…¨æ€§å’Œæ›´æ–°ã€‚</em></li>
<li><em>æé«˜å¯ç®¡ç†æ€§ï¼šé€šè¿‡ä½¿ç”¨Goldené•œåƒï¼Œç³»ç»Ÿç®¡ç†å‘˜å¯ä»¥ç®¡ç†ã€æ›´æ–°å’Œå‡çº§ç»„ç»‡ä¸­çš„æ‰€æœ‰è®¡ç®—æœºï¼Œå¹¶ç¡®ä¿æ‰€æœ‰è®¡ç®—æœºéƒ½ä½äºåŒä¸€æ›´æ–°å’Œé…ç½®çº§åˆ«ä¸Šï¼Œç®€åŒ–ç®¡ç†å’Œç»´æŠ¤æµç¨‹ã€‚</em></li>
</ol>
</blockquote>
<p><em>å¯ä»¥å•ç‹¬æ“ä½œæŸä¸€åˆ†åŒºï¼š</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#å•ç‹¬çƒ§å†™åˆ†åŒºå‘½ä»¤</span><br><span class="line">fastboot flash [part] [file]</span><br><span class="line">#å…¶ä¸­partä¸ºåˆ†åŒºåï¼Œfileä¸ºè¦çƒ§å½•çš„æ–‡ä»¶ï¼Œå¦‚ä¸‹ï¼š</span><br><span class="line">fastboot flash system_a system.img</span><br><span class="line">#å•ç‹¬æ“¦å†™åˆ†åŒºå‘½ä»¤</span><br><span class="line">fastboot erase [part]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">fastboot flash [part] [file]ï¼šè¿™ä¸ªå‘½ä»¤ç”¨äºå°†ä¸€ä¸ªç‰¹å®šçš„åˆ†åŒºçƒ§å†™åˆ°Androidè®¾å¤‡çš„æŒ‡å®šä½ç½®ã€‚[part] å‚æ•°æŒ‡å®šè¦å†™å…¥çš„åˆ†åŒºåç§°ï¼Œ[file] å‚æ•°æŒ‡å®šè¦çƒ§å½•çš„æ–‡ä»¶åæˆ–è·¯å¾„ã€‚ä¾‹å¦‚ï¼Œfastboot flash system_a system.img å°† system.img æ–‡ä»¶çƒ§å½•åˆ° system_a åˆ†åŒºä¸­ã€‚åœ¨æ‰§è¡Œè¯¥å‘½ä»¤ä¹‹å‰ï¼Œéœ€è¦å°†è®¾å¤‡è®¾ç½®ä¸ºFastbootæ¨¡å¼ï¼Œå¹¶å°†å…¶è¿æ¥åˆ°ä¸»æœºã€‚</span><br><span class="line"></span><br><span class="line">fastboot erase [part]ï¼šè¿™ä¸ªå‘½ä»¤ç”¨äºæ“¦é™¤Androidè®¾å¤‡ä¸Šçš„ä¸€ä¸ªç‰¹å®šåˆ†åŒºã€‚[part] å‚æ•°æŒ‡å®šè¦æ“¦é™¤çš„åˆ†åŒºåç§°ã€‚ä¾‹å¦‚ï¼Œfastboot erase system_a å°†æ“¦é™¤ system_a åˆ†åŒºã€‚åœ¨æ‰§è¡Œè¯¥å‘½ä»¤ä¹‹å‰ï¼Œéœ€è¦å°†è®¾å¤‡è®¾ç½®ä¸ºFastbootæ¨¡å¼ï¼Œå¹¶å°†å…¶è¿æ¥åˆ°ä¸»æœºã€‚</span><br></pre></td></tr></table></figure></div>

<p><em>å‡çº§å®Œæˆåå¯ä»¥ç›´æ¥å¤ä½å•æ¿ã€‚</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fastboot reboot</span><br></pre></td></tr></table></figure></div>

<h3 id="SD"><a href="#SD" class="headerlink" title="SD"></a><em>SD</em></h3><h4 id="çƒ§å†™å®Œæ•´é•œåƒ-1"><a href="#çƒ§å†™å®Œæ•´é•œåƒ-1" class="headerlink" title="çƒ§å†™å®Œæ•´é•œåƒ"></a><em>çƒ§å†™å®Œæ•´é•œåƒ</em></h4><p><em>åˆ¶ä½œ SD å¡ï¼š</em></p>
<ol>
<li><em>å‡†å¤‡ä¸€å¼  SD å¡</em></li>
<li><em>æœ¬æœºå®Œæˆå®Œæ•´é•œåƒç¼–è¯‘</em></li>
<li><em>è¿›å…¥ build&#x2F;scripts&#x2F; ç›®å½•</em></li>
<li><em>æ‰§è¡Œ mk_disk_img.sh è„šæœ¬</em></li>
</ol>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">gpt config is</span><br><span class="line">*******************************************************************</span><br><span class="line">*             ./mk_disk_img.sh Version 1.0</span><br><span class="line">*             generate disk.img</span><br><span class="line">*             usage: ./mk_disk_img.sh -d mmc|nor|hyper -s -k 0|4</span><br><span class="line">*******************************************************************</span><br><span class="line">å…¶ä¸­-dæŒ‡å®šå¯åŠ¨ä»‹è´¨ï¼Œ-sæŒ‡å®šä¸ºåŠ å¯†é•œåƒï¼Œ-kæŒ‡å®šèŠ¯ç‰‡ä½¿ç”¨key0/key4</span><br></pre></td></tr></table></figure></div>

<p><em>åœ¨ out&#x2F;target&#x2F;product&#x2F;packages&#x2F; ç›®å½•ä¸‹ä¼šç”Ÿæˆ disk_xxx.img é•œåƒ</em></p>
<p><em>å¯¼å…¥åˆ° SD å¡ï¼š</em></p>
<ol>
<li><em>å‡è®¾ SD å¡åœ¨æœ¬æœºè¢«è¯†åˆ«ä¸º &#x2F;dev&#x2F;sdbï¼Œsudo dd if&#x3D;disk_mmc.img of&#x3D;&#x2F;dev&#x2F;sdb</em></li>
<li><em>sync</em></li>
<li><em>disk_mmc.img çƒ§å†™</em></li>
<li><em>å°† disk_mmc.img æ”¾åˆ° SD å¡çš„ userdata åˆ†åŒºï¼Œä½¿ç”¨ SD å¡æ–¹å¼å¯åŠ¨</em></li>
<li><em>åœ¨ Uboot ä¸‹ä½¿ç”¨ mmc read çš„æ–¹å¼å°† disk.img è¯»å…¥åˆ°å†…å­˜ä¸­ï¼Œåœ°å€åŠå¤§å°ä»…ä¾›å‚è€ƒ</em></li>
</ol>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mmc dev 1           //åˆ‡æ¢åˆ°SDå¡</span><br><span class="line">mmc read 0xa0000000 599c10 5821  // mmc read å†…å­˜åœ°å€ åˆ†åŒºåœ°å€ï¼ˆuserdataåŒºï¼‰ å—å¤§å°ï¼ˆdisk.imgå¤§å°ï¼‰</span><br><span class="line">mmc dev 0           //åˆ‡æ¢åˆ°eMMC</span><br><span class="line">mmc write 0xa0000000 0 5821         // mmc write å†…å­˜åœ°å€ åˆ†åŒºåœ°å€ï¼ˆä»eMMCå¼€å¤´å¼€å§‹å†™ï¼‰ å—å¤§å°ï¼ˆdisk.imgå¤§å°ï¼‰</span><br></pre></td></tr></table></figure></div>

<p><em>æ–­ç”µï¼Œé€‰æ‹© eMMC å¯åŠ¨ã€‚</em></p>
<h4 id="çƒ§å†™åˆ†åŒºé•œåƒ"><a href="#çƒ§å†™åˆ†åŒºé•œåƒ" class="headerlink" title="çƒ§å†™åˆ†åŒºé•œåƒ"></a><em>çƒ§å†™åˆ†åŒºé•œåƒ</em></h4><ol>
<li><em>å°†å„åˆ†åŒºé•œåƒæ”¾åœ¨ SD å¡çš„ userdata åˆ†åŒº</em></li>
<li><em>åœ¨ Uboot ä¸‹ä½¿ç”¨ mmc write çš„æ–¹å¼å°†å„åˆ†åŒºé•œåƒå†™å…¥åˆ° emmc å¯¹åº”çš„åˆ†åŒºä¸Š</em></li>
</ol>
<h2 id="éªŒè¯æ£€æŸ¥"><a href="#éªŒè¯æ£€æŸ¥" class="headerlink" title="éªŒè¯æ£€æŸ¥"></a><em>éªŒè¯æ£€æŸ¥</em></h2><h3 id="ç³»ç»Ÿç‰ˆæœ¬"><a href="#ç³»ç»Ÿç‰ˆæœ¬" class="headerlink" title="ç³»ç»Ÿç‰ˆæœ¬"></a><em>ç³»ç»Ÿç‰ˆæœ¬</em></h3><p><em>ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ£€æŸ¥å½“å‰ç³»ç»Ÿçš„ç‰ˆæœ¬ï¼š</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@j5dvb:~# cat /proc/version</span><br></pre></td></tr></table></figure></div>

<h4 id="çŠ¶æ€æ£€æŸ¥ï¼šBPU"><a href="#çŠ¶æ€æ£€æŸ¥ï¼šBPU" class="headerlink" title="çŠ¶æ€æ£€æŸ¥ï¼šBPU"></a><em>çŠ¶æ€æ£€æŸ¥ï¼šBPU</em></h4><blockquote>
<p><em>BPUæŒ‡çš„æ˜¯åˆ†æ”¯é¢„æµ‹å•å…ƒï¼ˆBranch Prediction Unitï¼‰ï¼Œæ˜¯ç°ä»£CPUä¸­ä¸€ä¸ªé‡è¦çš„åŠŸèƒ½å•å…ƒã€‚</em></p>
<p><em><strong>åœ¨CPUä¸­ï¼Œåˆ†æ”¯æŒ‡ä»¤æ˜¯ä¸€ä¸ªé‡è¦çš„æ§åˆ¶ç»“æ„ï¼Œå®ƒå¯ä»¥åˆ¤æ–­ç¨‹åºæ‰§è¡Œè·¯çº¿ï¼Œå¹¶å¯¹åç»­æŒ‡ä»¤çš„æ‰§è¡Œé¡ºåºè¿›è¡Œæ§åˆ¶ã€‚</strong>ä½†æ˜¯åˆ†æ”¯æŒ‡ä»¤çš„æ‰§è¡Œä¼šå¯¼è‡´CPUçš„æµæ°´çº¿ï¼ˆPipelineï¼‰æš‚åœï¼Œä»è€Œå½±å“CPUçš„æ€§èƒ½ã€‚ä¸ºäº†å‡å°‘æµæ°´çº¿çš„æš‚åœï¼ŒBPUè¢«è®¾è®¡ç”¨äºé¢„æµ‹åˆ†æ”¯æŒ‡ä»¤çš„æ‰§è¡Œç»“æœã€‚</em></p>
<p><em>BPUé€šå¸¸åˆ©ç”¨å†å²å’Œä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œæ¥é¢„æµ‹åˆ†æ”¯æŒ‡ä»¤çš„æ‰§è¡Œè·¯å¾„ã€‚ä¾‹å¦‚ï¼Œå®ƒå¯èƒ½ä¼šè®°å½•ä¹‹å‰åˆ†æ”¯æŒ‡ä»¤çš„æ‰§è¡Œç»“æœï¼Œä»¥ä¾¿åˆ¤æ–­æŸä¸ªåˆ†æ”¯æŒ‡ä»¤æ‰§è¡Œçš„å¯èƒ½è·¯å¾„ã€‚BPUè¿˜å¯èƒ½ä¼šæ ¹æ®åˆ†æ”¯æŒ‡ä»¤æ‰€å¤„çš„ä¸Šä¸‹æ–‡ç¯å¢ƒè¿›è¡Œé¢„æµ‹ï¼Œä¾‹å¦‚ï¼Œå®ƒå¯èƒ½ä¼šæ ¹æ®å½“å‰ç¨‹åºä»£ç ä¸­å¾ªç¯ç»“æ„çš„ç‰¹å¾æ¥é¢„æµ‹åˆ†æ”¯æŒ‡ä»¤çš„æ‰§è¡Œè·¯å¾„ã€‚</em></p>
<p><em>å¦‚æœBPUé¢„æµ‹æ­£ç¡®ï¼Œå®ƒå°†èƒ½å¤Ÿä½¿CPUæµæ°´çº¿ä¿æŒé«˜æ•ˆçš„è¿è¡Œã€‚ä½†æ˜¯ï¼Œå¦‚æœBPUé¢„æµ‹é”™è¯¯ï¼Œåˆ™ä¼šå¯¼è‡´æµæ°´çº¿ä¸­æ–­ï¼Œä»è€Œä½¿CPUæ€§èƒ½ä¸‹é™ã€‚å› æ­¤ï¼Œç ”ç©¶å’Œä¼˜åŒ–BPUçš„é¢„æµ‹ç®—æ³•ï¼Œæ˜¯æé«˜CPUæ€§èƒ½çš„ä¸€ä¸ªé‡è¦æ–¹å‘ã€‚</em></p>
</blockquote>
<p><em>å¯ä½¿ç”¨ hrut_somstatus å·¥å…·æŸ¥çœ‹ BPU åŸºæœ¬å·¥ä½œçŠ¶æ€ï¼Œå¯è·å–åˆ° BPU å½“å‰è¿è¡Œé¢‘ç‡ä¿¡æ¯å’Œå ç”¨ç‡ä¿¡æ¯ã€‚</em></p>
<p><em>( BPU æœªä½¿èƒ½å·¥ä½œæ—¶ï¼Œé¢‘ç‡ä¿¡æ¯ä»…ä¸ºè½¯ä»¶è®°å½•ä¿¡æ¯ï¼Œå¹¶é BPU çœŸå®å·¥ä½œé¢‘ç‡)</em></p>
<p><em>Linux shell ä¸­æ‰§è¡Œå‘½ä»¤ hrut_somstatusï¼Œå¯æ‰“å°åŸºæœ¬å·¥ä½œçŠ¶æ€ã€‚</em></p>
<p><em>é™¤ hrut_somstatus å·¥å…·å¤–ï¼ŒBPU çš„è¯¦ç»†å·¥ä½œçŠ¶æ€è¿˜å¯ä»¥é€šè¿‡ BPU ç›¸å…³çš„ sys èŠ‚ç‚¹æŸ¥çœ‹ã€‚</em></p>
<h3 id="çŠ¶æ€æ£€æŸ¥ï¼šMCore"><a href="#çŠ¶æ€æ£€æŸ¥ï¼šMCore" class="headerlink" title="çŠ¶æ€æ£€æŸ¥ï¼šMCore"></a><em>çŠ¶æ€æ£€æŸ¥ï¼šMCore</em></h3><blockquote>
<p><em>mcoreå¯èƒ½æŒ‡å¤šæ ¸ä¸­å¿ƒï¼ˆmulticoreï¼‰ï¼Œæ˜¯è®¡ç®—æœºä¸­çš„ä¸€ç§å¤„ç†å™¨ç±»å‹ã€‚</em></p>
<p><em><strong>å¤šæ ¸ä¸­å¿ƒï¼ˆmulticoreï¼‰æŒ‡çš„æ˜¯å°†å¤šä¸ªæ ¸å¿ƒé›†æˆåˆ°åŒä¸€ä¸ªç‰©ç†èŠ¯ç‰‡ä¸­çš„å¤„ç†å™¨ã€‚</strong>ä¸å•æ ¸å¿ƒï¼ˆsingle-coreï¼‰å¤„ç†å™¨ç›¸æ¯”ï¼Œå¤šæ ¸å¿ƒå¤„ç†å™¨å¯ä»¥åœ¨åŒä¸€æ—¶é—´å†…æ‰§è¡Œæ›´å¤šçš„ä»»åŠ¡ã€‚ä¾‹å¦‚ï¼Œåœ¨å¤šæ ¸å¿ƒè®¡ç®—æœºä¸Šï¼Œä¸€ä¸ªæ ¸å¿ƒå¯ä»¥è¿è¡Œæ“ä½œç³»ç»Ÿï¼Œå¦ä¸€ä¸ªæ ¸å¿ƒå¯ä»¥åŒæ—¶è¿è¡Œä¸€ä¸ªè®¡ç®—å¯†é›†å‹çš„åº”ç”¨ç¨‹åºï¼Œä»è€Œæé«˜è®¡ç®—æœºçš„æ€»ä½“æ€§èƒ½ã€‚</em></p>
<p><em>å¤šæ ¸å¿ƒå¤„ç†å™¨ä¹Ÿå¯ä»¥å¸¦æ¥æ›´å¥½çš„èƒ½æ•ˆæ¯”ï¼ˆenergy efficiency ratioï¼‰ï¼Œå› ä¸ºæ¯ä¸ªæ ¸å¿ƒå¯ä»¥æ›´é«˜æ•ˆåœ°ä½¿ç”¨ç”µèƒ½å’Œè®¡ç®—èµ„æºã€‚æ­¤å¤–ï¼Œå¤šæ ¸å¿ƒè®¾è®¡ä¹Ÿå¯ä»¥æé«˜è®¡ç®—æœºçš„å¯é æ€§ï¼Œå› ä¸ºå³ä½¿å…¶ä¸­ä¸€ä¸ªæ ¸å¿ƒå—åˆ°æ•…éšœæˆ–è¿è¡Œç¼“æ…¢ï¼Œå…¶ä»–æ ¸å¿ƒä»ç„¶å¯ä»¥ç»§ç»­è¿è¡Œä»»åŠ¡ã€‚</em></p>
<p><em>ç°ä»Šï¼Œå¤šæ•°è®¡ç®—æœºéƒ½é‡‡ç”¨å¤šæ ¸å¿ƒå¤„ç†å™¨ï¼Œè€Œä¸æ˜¯å•æ ¸å¿ƒå¤„ç†å™¨ï¼Œå› ä¸ºå¤šæ ¸å¿ƒå¤„ç†å™¨æ‹¥æœ‰æ›´é«˜çš„è®¡ç®—æ€§èƒ½å’Œæ›´å¥½çš„èƒ½æ•ˆæ¯”ã€‚</em></p>
</blockquote>
<p><em>ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ£€æŸ¥ MCore å·¥ä½œçŠ¶æ€å’Œå½“å‰è¿è¡Œçš„ MCore firmware çš„ç‰ˆæœ¬ï¼š</em></p>
<ol>
<li><em>ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ£€æŸ¥Mcoreå·¥ä½œçŠ¶æ€</em></li>
</ol>
<p><em>åœ¨ Linux shell ä¸­æ‰§è¡Œå‘½ä»¤ â€œcat &#x2F;sys&#x2F;class&#x2F;remoteproc&#x2F;remoteproc0&#x2F;liveâ€ï¼Œå¦‚æœæ˜¾ç¤º liveï¼Œåˆ™è¡¨ç¤º MCore æ­£å¸¸è¿è¡Œã€‚</em></p>
<p><em>å¦‚æœæ˜¾ç¤º deadï¼Œåˆ™è¡¨ç¤º MCore æ²¡æœ‰æ­£å¸¸å·¥ä½œã€‚</em></p>
<ol>
<li><em>ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ£€æŸ¥ MCore firmware çš„ç‰ˆæœ¬ï¼š</em></li>
</ol>
<p><em>åœ¨ Linux shell ä¸­æ‰§è¡Œå‘½ä»¤ â€œcat &#x2F;sys&#x2F;class&#x2F;remoteproc&#x2F;remoteproc0&#x2F;versionâ€ï¼Œå³å¯æŸ¥çœ‹ MCore å›ºä»¶çš„ç‰ˆæœ¬å·ä¿¡æ¯ã€‚</em></p>
<h2 id="å¸¸ç”¨å·¥å…·"><a href="#å¸¸ç”¨å·¥å…·" class="headerlink" title="å¸¸ç”¨å·¥å…·"></a><em>å¸¸ç”¨å·¥å…·</em></h2><h4 id="hrut-bpuprofile"><a href="#hrut-bpuprofile" class="headerlink" title="hrut_bpuprofile"></a><em>hrut_bpuprofile</em></h4><p><em>hrut_bpuprofileå·¥å…·å¯ç”¨æ¥è°ƒé¢‘ï¼Œå¼€å…³bpuç”µæºï¼Œå¼€å…³bpu clockï¼ŒæŸ¥çœ‹ä½¿ç”¨ç‡ï¼Œè·å–fcæ—¶é—´ç­‰ã€‚</em></p>
<p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230508105126487.png"
                      class="" title="image-20230508105126487"
                ></em></p>
<p><em>å‚æ•°å¦‚ä¸‹ï¼š</em></p>
<ul>
<li><p><em>-b</em></p>
<p><em>æŒ‡å®šå“ªä¸ªbpuï¼Œ0-bpu0ï¼Œ1-bpu1ï¼Œ2-all</em></p>
</li>
<li><p><em>-p</em></p>
<p><em>ç”µæºæ‰ç”µ&#x2F;ä¸Šç”µï¼Œ0-offï¼Œ1-on</em></p>
</li>
<li><p><em>-c</em></p>
<p><em>clock on&#x2F;offï¼Œ0-offï¼Œ1-on</em></p>
</li>
<li><p><em>-f</em></p>
<p><em>è®¾ç½®bpué¢‘ç‡ï¼Œn-è®¾ç½®bpué¢‘ç‡ä¸ºn</em></p>
</li>
<li><p><em>-r</em></p>
<p><em>æŸ¥çœ‹bpuä½¿ç”¨ç‡ï¼Œn-æŸ¥çœ‹næ¬¡ï¼Œ0-å§‹ç»ˆæŸ¥çœ‹</em></p>
</li>
<li><p><em>-e</em></p>
<p><em>ä½¿èƒ½æŸ¥çœ‹fcæ‰§è¡Œæ—¶é—´åŠŸèƒ½(å…¼å®¹å‚æ•°ï¼ŒJ5é»˜è®¤å·²å¼€å¯ä¸”æ— æ³•å…³é—­)</em></p>
</li>
<li><p><em>-t</em></p>
<p><em>æŸ¥çœ‹å‰50æ¬¡æ¯ä¸ªfcçš„æ‰§è¡Œæ—¶é—´</em></p>
</li>
<li><p><em>-h</em></p>
<p><em>å¸®åŠ©ä¿¡æ¯</em></p>
</li>
</ul>
<p><em>æŸ¥çœ‹2ä¸ªbpuçš„ä½¿ç”¨ç‡ï¼ˆalwaysï¼‰</em></p>
<p><em>BPU Core0:</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hrut_bpuprofile -b 0 -r 1</span><br></pre></td></tr></table></figure></div>

<p><em>æŸ¥çœ‹BPU Core0çš„ä½¿ç”¨ç‡ï¼Œ-r 1ä»£è¡¨åªæ‰§è¡Œä¸€æ¬¡ï¼Œ-r nä»£è¡¨æ‰§è¡Œnæ¬¡ï¼Œé—´éš”1s, n&#x3D;0è¡¨ç¤ºä¸€ç›´å¾ªç¯æ‰§è¡Œã€‚</em></p>
<p><em>BPU Core1:</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hrut_bpuprofile -b 1 -r 1</span><br></pre></td></tr></table></figure></div>

<p><em>æŸ¥çœ‹BPU Core1çš„ä½¿ç”¨ç‡ï¼Œ-r 1ä»£è¡¨åªæ‰§è¡Œä¸€æ¬¡ï¼Œ-r nä»£è¡¨æ‰§è¡Œnæ¬¡ï¼Œé—´éš”1sï¼Œn&#x3D;0è¡¨ç¤ºä¸€ç›´å¾ª ç¯æ‰§è¡Œã€‚</em></p>
<p><em>BPU Core0&#x2F;1ï¼š</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hrut_bpuprofile -b 2 -r 1</span><br></pre></td></tr></table></figure></div>

<p><em>åŒæ—¶æŸ¥çœ‹BPU Core0å’ŒCore1çš„ä½¿ç”¨ç‡ï¼Œ-r 1ä»£è¡¨åªæ‰§è¡Œä¸€æ¬¡ï¼Œ-r nä»£è¡¨æ‰§è¡Œnæ¬¡ï¼Œé—´éš”1s, n&#x3D;0 è¡¨ç¤ºä¸€ç›´å¾ªç¯æ‰§è¡Œã€‚</em></p>
<p><em>è®¾ç½®2ä¸ªbpuçš„é¢‘ç‡</em></p>
<p><em>BPU Core0ï¼š</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hrut_bpuprofile -b 0 -f 400000000 è®¾ç½®bpu0çš„é¢‘ç‡ä¸º400M</span><br></pre></td></tr></table></figure></div>

<p><em>æŸ¥çœ‹æ”¯æŒå“ªäº›é¢‘ç‡ï¼š</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /sys/devices/system/bpu/bpu0/devfreq/*/available_frequencies</span><br></pre></td></tr></table></figure></div>

<p><em>æŸ¥çœ‹é¢‘ç‡æœ‰æ²¡æœ‰è®¾ç½®æˆåŠŸï¼š</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /sys/devices/system/bpu/bpu0/devfreq/*/cur_freq</span><br></pre></td></tr></table></figure></div>

<p><em>BPU Core1:</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hrut_bpuprofile -b 1 -f 400000000 è®¾ç½®bpu1çš„é¢‘ç‡ä¸º400M</span><br></pre></td></tr></table></figure></div>

<p><em>æŸ¥çœ‹æ”¯æŒå“ªäº›é¢‘ç‡ï¼š</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /sys/devices/system/bpu/bpu1/devfreq/*/available_frequencies</span><br></pre></td></tr></table></figure></div>

<p><em>æŸ¥çœ‹é¢‘ç‡æœ‰æ²¡æœ‰è®¾ç½®æˆåŠŸï¼š</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /sys/devices/system/bpu/bpu1/devfreq/*/cur_freq</span><br></pre></td></tr></table></figure></div>

<p><em>BPU Core0&#x2F;1ï¼š</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hrut_bpuprofile -b 2 -f 400000000è®¾ç½®bpu0/bpu1çš„é¢‘ç‡ä¸º400M</span><br></pre></td></tr></table></figure></div>

<p><em>BPU coreæ”¯æŒé¢‘ç‡çš„æŸ¥çœ‹æ–¹æ³•åŒä¸Š</em></p>
<p><em>ç»™2ä¸ªbpuä¸Šä¸‹ç”µ</em></p>
<p><em>BPU Core0:</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hrut_bpuprofile -b 0 -p 0</span><br></pre></td></tr></table></figure></div>

<p><em>å°†BPU Core 0ä¸‹ç”µ</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hrut_bpuprofile -b 0 -p 1</span><br></pre></td></tr></table></figure></div>

<p><em>å°†BPU Core 0ä¸Šç”µ</em></p>
<p><em>BPU Core1:</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hrut_bpuprofile -b 1 -p 0</span><br></pre></td></tr></table></figure></div>

<p><em>å°†BPU Core 1ä¸‹ç”µ</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hrut_bpuprofile -b 1 -p 1</span><br></pre></td></tr></table></figure></div>

<p><em>å°†BPU Core 1ä¸Šç”µ</em></p>
<p><em>BPU Core0&#x2F;1ï¼š</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hrut_bpuprofile -b 2 -p 0</span><br></pre></td></tr></table></figure></div>

<p><em>åŒæ—¶å°†BPU Core 0&#x2F;1ä¸‹ç”µ</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hrut_bpuprofile -b 2 -p 1</span><br></pre></td></tr></table></figure></div>

<p><em>åŒæ—¶å°†BPU Core 0&#x2F;1ä¸Šç”µ</em></p>
<p><em>æŸ¥çœ‹fcæ‰§è¡Œæ—¶é—´</em></p>
<p><em>BPU Core0:</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hrut_bpuprofile -b 0 -t 1</span><br></pre></td></tr></table></figure></div>

<p><em>æ˜¾ç¤ºBPU Core0æœ€è¿‘å·²å¤„ç†fcä»»åŠ¡çš„æ‰§è¡Œæ—¶é—´ä¿¡æ¯</em></p>
<p><em>BPU Core1:</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hrut_bpuprofile -b 1 -t 1</span><br></pre></td></tr></table></figure></div>

<p><em>æ˜¾ç¤ºBPU Core1æœ€è¿‘å·²å¤„ç†fcä»»åŠ¡çš„æ‰§è¡Œæ—¶é—´ä¿¡æ¯</em></p>
<p><em>è¾“å‡ºä¿¡æ¯å¦‚ä¸‹ï¼š</em></p>
<ul>
<li><em>indexï¼šè¯¥ä»»åŠ¡ä½äºBPUç¡¬ä»¶FIFOä¸­çš„ä½ç½®</em></li>
<li><em>idï¼šç”¨æˆ·è®¾ç½®çš„ä¸­æ–­id</em></li>
<li><em>hwidï¼šåº•å±‚é©±åŠ¨ç»´æŠ¤çš„ä¸­æ–­id</em></li>
<li><em>groupï¼šç”¨æˆ·è®¾ç½®çš„ç»„idï¼Œç”¨æˆ·è¿›ç¨‹å·</em></li>
<li><em>prioï¼šä»»åŠ¡ä¼˜å…ˆçº§</em></li>
<li><em>s_timeï¼šä»»åŠ¡å¤„ç†å¼€å§‹çš„æ—¶é—´æˆ³</em></li>
<li><em>e_timeï¼šä»»åŠ¡å¤„ç†ç»“æŸçš„æ—¶é—´æˆ³</em></li>
<li><em>r_timeï¼šä»»åŠ¡è¢«å¤„ç†çš„æ€»è€—æ—¶</em></li>
</ul>
<h4 id="hrut-ddr"><a href="#hrut-ddr" class="headerlink" title="hrut_ddr"></a><em>hrut_ddr</em></h4><p><em>ä½¿ç”¨ hrut_ddr ç”¨æ¥å®æ—¶é‡‡é›†å†…å­˜çš„ååé‡ï¼Œæ–¹ä¾¿åˆ†æç¨‹åºå®é™…çš„å†…å­˜ä½¿ç”¨é‡ã€‚</em></p>
<p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230508105624157.png"
                      class="" title="image-20230508105624157"
                ></em></p>
<p><em>å‚æ•°å¦‚ä¸‹ï¼š</em></p>
<ul>
<li><p><em>-t</em></p>
<p><em>æŒ‡å®šéœ€è¦é‡‡é›†çš„ç«¯å£ï¼Œé»˜è®¤æ˜¯é‡‡é›†æ‰€æœ‰ç«¯å£çš„å†…å­˜ååé‡</em></p>
</li>
<li><p><em>-p</em></p>
<p><em>æŒ‡å®šé‡‡é›†çš„å‘¨æœŸï¼Œå•ä½ usï¼Œå»ºè®®æœ€å°è®¾ç½®ä¸º 10000ï¼Œé˜²æ­¢é‡‡é›†ä¸­æ–­è¿‡å¤š</em></p>
</li>
<li><p><em>-d</em></p>
<p><em>æŒ‡å®šé‡‡é›†çš„ DDR è®¾å¤‡ï¼Œé»˜è®¤ä¼šé‡‡é›†ä¸¤ä¸ª DDR ä¸Šçš„å†…å­˜ååé‡</em></p>
</li>
<li><p><em>-n</em></p>
<p><em>æŒ‡å®šé‡‡æ ·æ•°é‡ï¼Œé»˜è®¤å€¼ä¸º 100</em></p>
</li>
<li><p><em>-r</em></p>
<p><em>é‡‡é›†åŸå§‹å¯„å­˜å™¨é‡Œé¢çš„æ•°æ®ï¼Œä¸åšä»»ä½•è½¬æ¢</em></p>
</li>
</ul>
<p><em>è¾“å…¥ç»“æœå¦‚ä¸‹ï¼š</em></p>
<p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230508105637087.png"
                      class="" title="image-20230508105637087"
                ></em></p>
<h4 id="hrut-mac-utility"><a href="#hrut-mac-utility" class="headerlink" title="hrut_mac_utility"></a><em>hrut_mac_utility</em></h4><p><em>ä½¿ç”¨ hrut_mac utility ç”¨æ¥ä¿å­˜å½“å‰æ¿å­ç½‘å¡ MAC ç›¸å…³å‚æ•°çš„ utilityã€‚</em></p>
<p><em>ç”¨æ³•ï¼š</em></p>
<ol>
<li><em>å†™å…¥</em></li>
</ol>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hrut_mac s [eth0/eth1] aa:bb:cc:dd:ee:ff</span><br></pre></td></tr></table></figure></div>

<p><em>é…ç½®æˆåŠŸåï¼Œé‡å¯ç”Ÿæ•ˆã€‚</em></p>
<ol>
<li><em>è¯»å‡º</em></li>
</ol>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hrut_mac g [eth0/eth1]</span><br></pre></td></tr></table></figure></div>

<ol>
<li><em>æ¸…é™¤</em></li>
</ol>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hrut_mac c [eth0/eth1]</span><br></pre></td></tr></table></figure></div>

<h4 id="hrut-ipfull-utility"><a href="#hrut-ipfull-utility" class="headerlink" title="hrut_ipfull_utility"></a><em>hrut_ipfull_utility</em></h4><p><em>hrut_ipfull utility æ˜¯ç”¨æ¥ä¿å­˜å½“å‰æ¿å­å†…æ ¸ä¸‹ IP ç›¸å…³å‚æ•°çš„å·¥å…·ï¼ŒIP é…ç½®å®Œæˆåï¼Œæ¿å­ä¸‹æ¬¡ä¸Šç”µä¼šè‡ªåŠ¨é…ç½®ç½‘ç»œå‚æ•° (IPã€mask), å¹¶æ·»åŠ ç½‘å…³ (gateway) åˆ°è·¯ç”±ã€‚</em></p>
<p><em>æ³¨æ„ï¼šéƒ¨åˆ†äº§å“ IP è¢«é”æ­»ï¼Œæ— æ³•é€šè¿‡æœ¬å·¥å…·è¿›è¡Œé…ç½®ã€‚Uboot ä¸‹çš„ IP åœ°å€ï¼Œåœ¨ Uboot ä¸‹ä½¿ç”¨ setenv ipaddr 192.168.1.10 æ¥å®ç°ã€‚</em></p>
<p><em>ç”¨æ³•ï¼š</em></p>
<ol>
<li><em>å†™å…¥</em></li>
</ol>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hrut_ipfull s [eth0/eth1] IP MASK GATEWAY</span><br></pre></td></tr></table></figure></div>

<p><em>e.g. hrut_ipfull s [eth0&#x2F;eth1] 192.168.1.10 255.255.255.0 192.168.1.1</em></p>
<p><em>é…ç½®æˆåŠŸåï¼Œå°†åœ¨ä¸‹ä¸€æ¬¡å¯åŠ¨ç”Ÿæ•ˆã€‚GATEWAYæ˜¯å¯é€‰å‚æ•°ï¼Œeth0&#x2F;eth1ä¹Ÿæ˜¯å¯é€‰å‚æ•°ï¼Œå¦‚æœä¸æŒ‡å®šç½‘å£åˆ™é»˜è®¤è®¾ç½®eth0</em></p>
<ol>
<li><em>è¯»å‡º</em></li>
</ol>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hrut_ipfull g [eth0/eth1]</span><br></pre></td></tr></table></figure></div>

<p><em>ä¸‹é¢æ‰“å°åº”å½“å‡ºç°ï¼š</em></p>
<ul>
<li><em>ip&#x3D;192.168.1.10</em></li>
<li><em>mask&#x3D;255.255.255.0</em></li>
<li><em>gw&#x3D;192.168.1.1</em></li>
</ul>
<ol>
<li><em>æ¸…é™¤</em></li>
</ol>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hrut_ipfull c  [eth0/eth1]</span><br></pre></td></tr></table></figure></div>

<p><em>æ³¨æ„ï¼šä¸€æ—¦é…ç½®æˆåŠŸï¼Œé‡å¯ååœ¨&#x2F;tmpä¸‹é¢ä¼šæœ‰å‡ ä¸ªæ–‡ä»¶ï¼Œè®°å½•äº†å½“å‰çš„é…ç½®çš„å€¼ï¼Œå…¶å«ä¹‰å¦‚åå­—</em></p>
<ul>
<li><em>&#x2F;tmp&#x2F;ip_mac_eth0</em></li>
<li><em>&#x2F;tmp&#x2F;ip_ip_eth0</em></li>
<li><em>&#x2F;tmp&#x2F;ip_mask_eth0</em></li>
<li><em>&#x2F;tmp&#x2F;ip_gw_eth0</em></li>
<li><em>&#x2F;tmp&#x2F;ip_mac_eth0</em></li>
<li><em>&#x2F;tmp&#x2F;ip_ip_eth0</em></li>
<li><em>&#x2F;tmp&#x2F;ip_mask_eth0</em></li>
<li><em>&#x2F;tmp&#x2F;ip_gw_eth0</em></li>
</ul>
<h4 id="hrut-boardid"><a href="#hrut-boardid" class="headerlink" title="hrut_boardid"></a><em>hrut_boardid</em></h4><p><em>hrut_boardid utility æ˜¯ç”¨æ¥è·å–å½“å‰å¼€å‘æ¿ Board ID çš„å·¥å…·ã€‚</em></p>
<p><em>ç”¨æ³•ï¼š</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hrut_boardid</span><br></pre></td></tr></table></figure></div>

<h4 id="hrut-somstatus"><a href="#hrut-somstatus" class="headerlink" title="hrut_somstatus"></a><em>hrut_somstatus</em></h4><p><em>hrut_somstatus utility æ˜¯ç”¨æ¥è·å–å½“å‰å¼€å‘æ¿ SOM çŠ¶æ€çš„å·¥å…·ï¼ŒåŒ…å«æ¸©åº¦ã€CPU é¢‘ç‡ã€BPU çŠ¶æ€ã€‚</em></p>
<p><em>ç”¨æ³•ï¼š</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hrut_somstatus</span><br></pre></td></tr></table></figure></div>

<blockquote>
<p><em>SOM æ˜¯ System-on-Module çš„ç¼©å†™ï¼Œæ„ä¸ºæ¨¡å—åŒ–ç³»ç»Ÿã€‚SOM æ˜¯ä¸€ç§åµŒå…¥å¼ç³»ç»Ÿå¼€å‘çš„æ¨¡å—åŒ–è§£å†³æ–¹æ¡ˆï¼Œå®ƒå°†å„ç§æ ¸å¿ƒç»„ä»¶å’Œç”µè·¯é›†æˆåœ¨ä¸€ä¸ªå°å‹çš„æ¨¡å—ä¸­ï¼ŒåŒ…æ‹¬å¤„ç†å™¨ã€å†…å­˜ã€å­˜å‚¨ã€é€šä¿¡æ¥å£å’Œå…¶ä»–å‘¨è¾¹è®¾å¤‡ã€‚</em></p>
</blockquote>
<h1 id="åœ°å¹³çº¿å¾ç¨‹5-èŠ¯ç‰‡ç®—æ³•å·¥å…·é“¾"><a href="#åœ°å¹³çº¿å¾ç¨‹5-èŠ¯ç‰‡ç®—æ³•å·¥å…·é“¾" class="headerlink" title="åœ°å¹³çº¿å¾ç¨‹5 èŠ¯ç‰‡ç®—æ³•å·¥å…·é“¾"></a><em>åœ°å¹³çº¿å¾ç¨‹5 èŠ¯ç‰‡ç®—æ³•å·¥å…·é“¾</em></h1><p><em>åœ°å¹³çº¿å¾ç¨‹5ï¼ˆä¹Ÿç§°Journey5ã€J5ï¼‰èŠ¯ç‰‡ç®—æ³•å·¥å…·é“¾æ˜¯åŸºäºåœ°å¹³çº¿å¾ç¨‹5ä»£èŠ¯ç‰‡ç ”å‘çš„èŠ¯ç‰‡ç®—æ³•è§£å†³æ–¹æ¡ˆã€‚ å®ƒåŒ…å«ï¼š <strong>æ¨¡å‹ç®—æ³•å¤„ç†</strong> å’Œ <strong>åµŒå…¥å¼æ¨¡å‹é¢„æµ‹åº“</strong> ä¸¤å¤§é‡è¦ç»„ä»¶ã€‚ æ¨¡å‹ç®—æ³•å¤„ç†æä¾›PTQè®­ç»ƒåé‡åŒ–æ–¹æ¡ˆå’ŒQATé‡åŒ–æ„ŸçŸ¥è®­ç»ƒæ–¹æ¡ˆã€‚ è½¬æ¢åå¾—åˆ°çš„å®šç‚¹æ¨¡å‹é…åˆæ¨¡å‹ç¼–è¯‘å·¥å…·å¤„ç†åå°±å¯ä»¥åœ¨åœ°å¹³çº¿èŠ¯ç‰‡ä¸Šæ‰§è¡Œã€‚ åµŒå…¥å¼æ¨¡å‹é¢„æµ‹åº“æä¾›åˆ©ç”¨å®šç‚¹æ¨¡å‹å®Œæˆæ¨ç†çš„ç³»åˆ—æ”¯æŒæ¥å£ã€‚</em></p>
<blockquote>
<p><em><strong>æ¨¡å‹ç®—æ³•å¤„ç†æŒ‡çš„æ˜¯åˆ©ç”¨æ•°å­¦æ¨¡å‹å’Œç®—æ³•æ¥è§£å†³å®é™…é—®é¢˜çš„è¿‡ç¨‹</strong>ã€‚åœ¨æœºå™¨å­¦ä¹ å’Œæ•°æ®åˆ†æé¢†åŸŸä¸­ï¼Œæ¨¡å‹ç®—æ³•å¤„ç†é€šå¸¸åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªä¸»è¦æ­¥éª¤ï¼š</em></p>
<ol>
<li><em>æ•°æ®é‡‡é›†å’Œé¢„å¤„ç†ï¼šè·å–åŸå§‹æ•°æ®é›†å¹¶è¿›è¡Œæ¸…æ´—ã€å¤„ç†ã€è½¬æ¢ç­‰é¢„å¤„ç†ï¼Œä»¥ä¾¿äºåç»­çš„å»ºæ¨¡å’Œç®—æ³•å¤„ç†ã€‚</em></li>
<li><em>ç‰¹å¾æå–å’Œé€‰æ‹©ï¼šæ ¹æ®ä¸šåŠ¡ç‰¹å®šéœ€è¦å’Œç®—æ³•è¦æ±‚ï¼Œä»åŸå§‹æ•°æ®ä¸­æå–å‡ºç‰¹å¾å˜é‡ï¼Œå¹¶å¯¹å…¶è¿›è¡Œé€‰æ‹©å’Œè¿‡æ»¤ï¼Œä»¥æé«˜æ¨¡å‹çš„å‡†ç¡®æ€§å’Œæ³›åŒ–èƒ½åŠ›ã€‚</em><u>æ¨¡å‹çš„æ³›åŒ–èƒ½åŠ›æŒ‡çš„æ˜¯æ¨¡å‹å¯¹æœªè§è¿‡çš„æ•°æ®çš„é€‚åº”èƒ½åŠ›ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ¨¡å‹åœ¨è®­ç»ƒé›†ä¸Šè®­ç»ƒå¾—å¾ˆå¥½ï¼Œä½†åœ¨æµ‹è¯•é›†æˆ–å®é™…åº”ç”¨ä¸­è¡¨ç°ä¸ä½³çš„æƒ…å†µã€‚</u> </li>
<li><em>æ¨¡å‹é€‰æ‹©å’Œè®­ç»ƒï¼šæ ¹æ®é—®é¢˜çš„å¤æ‚åº¦å’Œæ•°æ®é›†çš„å¤§å°ï¼Œé€‰æ‹©é€‚å½“çš„æ¨¡å‹ç®—æ³•ï¼Œå¦‚å†³ç­–æ ‘ã€æ”¯æŒå‘é‡æœºã€ç¥ç»ç½‘ç»œç­‰ï¼Œè¿›è¡Œæ¨¡å‹è®­ç»ƒå’Œä¼˜åŒ–ã€‚</em></li>
<li><em>æ¨¡å‹è¯„ä¼°å’ŒéªŒè¯ï¼šé€šè¿‡äº¤å‰éªŒè¯ã€ROCæ›²çº¿ç­‰æ–¹æ³•å¯¹æ¨¡å‹è¿›è¡Œè¯„ä¼°å’ŒéªŒè¯ï¼Œä»¥ç¡®ä¿æ¨¡å‹çš„æ€§èƒ½å’Œæ³›åŒ–èƒ½åŠ›ã€‚</em></li>
<li><em>æ¨¡å‹éƒ¨ç½²å’Œåº”ç”¨ï¼šå°†è®­ç»ƒå¥½çš„æ¨¡å‹éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒæˆ–åº”ç”¨åœºæ™¯ä¸­ï¼Œå¹¶åˆ©ç”¨å…¶è¿›è¡Œæ•°æ®é¢„æµ‹ã€åˆ†ç±»ã€å›å½’ã€èšç±»ç­‰ä»»åŠ¡ï¼Œå®ç°å¯¹å®é™…é—®é¢˜çš„ä¼˜åŒ–å’Œè§£å†³ã€‚</em></li>
</ol>
<p><em>æ€»ä¹‹ï¼Œæ¨¡å‹ç®—æ³•å¤„ç†æ˜¯ä¸€ç§å¤æ‚çš„æ•°æ®åˆ†æå’Œæœºå™¨å­¦ä¹ è¿‡ç¨‹ï¼Œéœ€è¦ç»¼åˆè¿ç”¨æ•°å­¦ã€æ•°æ®ç§‘å­¦ã€è®¡ç®—æœºç§‘å­¦ç­‰çŸ¥è¯†å’ŒæŠ€èƒ½ã€‚é€šè¿‡æ¨¡å‹ç®—æ³•å¤„ç†ï¼Œå¯ä»¥é«˜æ•ˆåœ°è§£å†³å®é™…é—®é¢˜ï¼Œå¹¶æé«˜ä¼ä¸šå’Œä¸ªäººçš„å†³ç­–æ•ˆç‡å’Œç²¾åº¦ã€‚</em></p>
</blockquote>
<blockquote>
<p><em><strong>åµŒå…¥å¼æ¨¡å‹é¢„æµ‹åº“æ˜¯ä¸€ç§ç”¨äºåœ¨åµŒå…¥å¼è®¾å¤‡ä¸Šè¿›è¡Œæœºå™¨å­¦ä¹ æ¨¡å‹æ¨ç†çš„è½¯ä»¶åº“ã€‚</strong>è¿™äº›æ¨¡å‹é€šå¸¸åœ¨äº‘ç«¯æˆ–å…¶ä»–é«˜æ€§èƒ½è®¡ç®—æœºä¸Šè®­ç»ƒï¼Œç„¶ååœ¨è¾ƒå¼±çš„åµŒå…¥å¼è®¾å¤‡ä¸Šéƒ¨ç½²ï¼Œä»¥å®Œæˆç‰¹å®šçš„æ¨ç†ä»»åŠ¡ï¼Œä¾‹å¦‚å›¾åƒåˆ†ç±»ã€è¯­éŸ³è¯†åˆ«ç­‰ã€‚</em></p>
<p><em>åµŒå…¥å¼æ¨¡å‹é¢„æµ‹åº“æ—¨åœ¨æä¾›å¿«é€Ÿã€è½»ä¾¿çš„æ¨¡å‹æ¨ç†åŠŸèƒ½ï¼Œä»¥é€‚åº”åµŒå…¥å¼è®¾å¤‡çš„èµ„æºé™åˆ¶ï¼Œä¾‹å¦‚å†…å­˜ã€å¤„ç†èƒ½åŠ›ã€å­˜å‚¨ç­‰ã€‚è¿™äº›åº“é€šå¸¸æ˜¯ä¸ºå…·ä½“çš„åµŒå…¥å¼å¤„ç†å™¨æ¶æ„å’Œæ“ä½œç³»ç»Ÿå¼€å‘çš„ï¼Œå¯ä»¥ä¼˜åŒ–åº•å±‚ç¡¬ä»¶èµ„æºä»¥æé«˜æ€§èƒ½ã€‚</em></p>
<p><em>åµŒå…¥å¼æ¨¡å‹é¢„æµ‹åº“é€šå¸¸å®ç°äº†ä¸€äº›é«˜æ•ˆçš„æœºå™¨å­¦ä¹ ç®—æ³•å’ŒæŠ€æœ¯ï¼Œä¾‹å¦‚å·ç§¯ç¥ç»ç½‘ç»œï¼ˆConvolutional Neural Networks, CNNsï¼‰ã€å¾ªç¯ç¥ç»ç½‘ç»œï¼ˆRecurrent Neural Networks, RNNs)ç­‰ï¼Œä»¥é€‚åº”ä¸åŒçš„åº”ç”¨åœºæ™¯ã€‚æ­¤å¤–ï¼Œå®ƒä»¬é€šå¸¸è¿˜æä¾›äº†ç®€å•æ˜“ç”¨çš„APIæ¥å£ï¼Œç”¨äºåŠ è½½å’Œè¿è¡Œæ¨¡å‹ï¼Œä»¥åŠè·å–ç»“æœã€‚</em></p>
<p><em>éšç€åµŒå…¥å¼è®¾å¤‡å˜å¾—è¶Šæ¥è¶Šæ™®åŠï¼Œè¶Šæ¥è¶Šå¤šçš„åµŒå…¥å¼æ¨¡å‹é¢„æµ‹åº“è¢«å¼€å‘å‡ºæ¥ï¼Œç”¨äºå°†æœºå™¨å­¦ä¹ å¸¦åˆ°åµŒå…¥å¼ç³»ç»Ÿä¸­ï¼Œä»¥æä¾›æ›´åŠ æ™ºèƒ½çš„åŠŸèƒ½å’Œåº”ç”¨ã€‚</em></p>
</blockquote>
<blockquote>
<p><em><strong>é‡åŒ–æ˜¯ä¸€ç§å°†æ¨¡å‹ä¸­å‚æ•°å’Œè®¡ç®—è½¬åŒ–ä¸ºä½ç²¾åº¦è¡¨ç¤ºçš„è¿‡ç¨‹</strong>ï¼Œå¯ä»¥é™ä½è®¡ç®—é‡å’Œå­˜å‚¨éœ€æ±‚ï¼Œä»è€Œä½¿æ¨¡å‹åœ¨åµŒå…¥å¼è®¾å¤‡ç­‰èµ„æºæœ‰é™çš„åœºæ™¯ä¸‹å…·æœ‰æ›´å¥½çš„æ€§èƒ½ã€‚PTQæ˜¯ä¸€ç§å°†ç»è¿‡è®­ç»ƒçš„æ¨¡å‹ä¸­çš„æ‰€æœ‰å‚æ•°è½¬ä¸ºæ•´æ•°çš„é‡åŒ–æ–¹å¼ï¼Œå¸¸ç”¨äºå¯¹å·²è®­ç»ƒçš„æ¨¡å‹è¿›è¡Œåå¤„ç†æ¥å®ç°ä½ç²¾åº¦è®¡ç®—ã€‚QATæ˜¯ä¸€ç§åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­å°±è€ƒè™‘é‡åŒ–è¯¯å·®çš„æ–¹æ³•ã€‚ä¸ PTQ ä¸åŒçš„æ˜¯ï¼Œ</em><em>QAT ä»¥è®­ç»ƒæ‰€å¾—çš„æ¨¡å‹çš„ç»“æ„å’Œæƒé‡ä½œä¸ºåŸºç¡€ï¼Œé€šè¿‡é¢å¤–çš„é‡åŒ–æ„ŸçŸ¥æŸå¤±å‡½æ•°æ¨¡æ‹Ÿé‡åŒ–è¯¯å·®ï¼Œä»¥æé«˜æ¨¡å‹çš„ç²¾åº¦å’Œé²æ£’æ€§**ã€‚</em></p>
<p><em>å› æ­¤ï¼Œâ€œæ¨¡å‹ç®—æ³•å¤„ç†æä¾›PTQè®­ç»ƒåé‡åŒ–æ–¹æ¡ˆå’ŒQATé‡åŒ–æ„ŸçŸ¥è®­ç»ƒæ–¹æ¡ˆâ€æ„å‘³ç€è¯¥å¤„ç†æä¾›ä¸¤ç§ä¸åŒçš„æ¨¡å‹é‡åŒ–æ–¹æ³•ï¼Œå¯ä»¥è®©ç”¨æˆ·çµæ´»åœ°é€‰æ‹©é‡åŒ–æ–¹å¼æ¥æ»¡è¶³ä¸åŒçš„ä½¿ç”¨éœ€æ±‚ï¼Œæé«˜äº†æ¨¡å‹åœ¨æœ‰é™çš„è®¡ç®—èµ„æºä¸­çš„æ€§èƒ½å’Œæ•ˆç‡ã€‚</em></p>
</blockquote>
<blockquote>
<p><em>å®šç‚¹æ¨¡å‹ï¼ˆFixed-Point Modelï¼‰æ˜¯ä¸€ç§åœ¨è®¡ç®—æœºé¢†åŸŸå¸¸ç”¨çš„æ•°å€¼è¡¨ç¤ºæ–¹å¼ã€‚ç›¸å¯¹äºå¸¸ç”¨çš„æµ®ç‚¹æ•°è¡¨ç¤ºï¼Œ<strong>å®šç‚¹æ¨¡å‹é‡‡ç”¨å›ºå®šä½æ•°çš„æ•´æ•°æ¥è¡¨ç¤ºå®æ•°ï¼Œå…·æœ‰èŠ‚çœå­˜å‚¨ç©ºé—´ã€è¿ç®—é€Ÿåº¦è¾ƒå¿«ç­‰ä¼˜ç‚¹</strong>ï¼Œåœ¨åµŒå…¥å¼è®¾å¤‡ã€ç§»åŠ¨è®¾å¤‡ç­‰èµ„æºæœ‰é™çš„åœºæ™¯ä¸‹å¾—åˆ°å¹¿æ³›åº”ç”¨ã€‚</em></p>
</blockquote>
<p><em>ä¸ºäº†è®©å¼€å‘è€…å¿«é€Ÿä¸Šæ‰‹ä½“éªŒæ¨¡å‹è®­ç»ƒ&#x2F;è½¬æ¢ã€éƒ¨ç½²ã€éªŒè¯ã€æ¨ç†ç­‰å…³é”®æ­¥éª¤ï¼ŒèŠ¯ç‰‡å·¥å…·é“¾çš„å„ç»„ä»¶è¿˜æä¾› <strong>ç¤ºä¾‹åŒ…</strong> ä»¥åŠé…åˆç¤ºä¾‹åŒ…ä½¿ç”¨çš„Dockeré•œåƒå’Œæ¨¡å‹å‘å¸ƒç‰©ã€‚ è¿™äº›ç¤ºä¾‹åŒ…å°†å„å·¥å…·æ ¸å¿ƒä¸šåŠ¡é€»è¾‘å’Œå…³é”®é…ç½®å‚æ•°å°è£…æˆè„šæœ¬ï¼›æ¨¡å‹å‘å¸ƒç‰©å†…ç½®äº†ä¸°å¯Œçš„ç®—æ³•æ¨¡å‹ï¼›Dockeré•œåƒé¢„ç½®äº†ä½¿ç”¨ç¤ºä¾‹åŒ…æ‰€éœ€çš„å¼€å‘ç¯å¢ƒã€‚</em></p>
<h3 id="äº§å“ç®€ä»‹"><a href="#äº§å“ç®€ä»‹" class="headerlink" title="äº§å“ç®€ä»‹"></a><em>äº§å“ç®€ä»‹</em></h3><p>åœ°å¹³çº¿J5èŠ¯ç‰‡ç®—æ³•å·¥å…·é“¾ï¼ˆä»¥ä¸‹ç®€ç§° å·¥å…·é“¾ï¼‰æ˜¯ä¸€å¥—å®Œæ•´çš„<strong>è¾¹ç¼˜èŠ¯ç‰‡ç®—æ³•</strong>è½åœ°è§£å†³æ–¹æ¡ˆï¼Œå¯ä»¥å¸®åŠ©æ‚¨æŠŠæµ®ç‚¹æ¨¡å‹é‡åŒ–ä¸ºå®šç‚¹æ¨¡å‹ï¼Œ å¹¶åœ¨åœ°å¹³çº¿èŠ¯ç‰‡ä¸Šå¿«é€Ÿéƒ¨ç½²è‡ªç ”ç®—æ³•æ¨¡å‹ã€‚</p>
<blockquote>
<p>è¾¹ç¼˜èŠ¯ç‰‡ç®—æ³•æŒ‡çš„æ˜¯åœ¨è¾¹ç¼˜è®¾å¤‡ä¸Šè¿è¡Œçš„æœºå™¨å­¦ä¹ ç®—æ³•ã€‚è¾¹ç¼˜èŠ¯ç‰‡ç®—æ³•æ˜¯é€šè¿‡<strong>åœ¨å±€éƒ¨æ‰§è¡Œæ•°æ®å¤„ç†å’Œå†³ç­–</strong>ï¼Œå°†æ›´å¤šçš„æ™ºèƒ½ç§»åˆ°æ•°æ®ç”Ÿæˆçš„åœ°æ–¹æ¥å®ç°æ™ºèƒ½åŒ–çš„æ–¹å¼ã€‚ä¼ ç»Ÿä¸Šï¼Œé‡‡é›†çš„æ•°æ®é€šå¸¸åœ¨è¢«ä¼ è¾“åˆ°åå°æœåŠ¡å™¨æˆ–äº‘ç«¯å¤„ç†å‰ä¼šå…ˆè¢«å­˜å‚¨åœ¨è¾¹ç¼˜è®¾å¤‡ä¸­ã€‚è€Œå±€éƒ¨æ‰§è¡Œçš„æ–¹æ³•ï¼Œå¯ä»¥åœ¨æ•°æ®å‘é€åˆ°åç«¯ä¹‹å‰æˆ–ä¸ç»è¿‡åç«¯ï¼Œç›´æ¥åœ¨æ•°æ®æºå¤„æ‰§è¡Œæ•°æ®å¤„ç†å’Œå†³ç­–ä»£ç ï¼Œä»è€Œé™ä½äº†å»¶è¿Ÿå’Œç½‘ç»œè´Ÿè½½ï¼Œé¿å…äº†æ•°æ®å®‰å…¨çš„éšæ‚£ã€‚</p>
</blockquote>
<h4 id="OEæ–‡æ¡£è„‰ç»œ"><a href="#OEæ–‡æ¡£è„‰ç»œ" class="headerlink" title="OEæ–‡æ¡£è„‰ç»œ"></a><em>OEæ–‡æ¡£è„‰ç»œ</em></h4><blockquote>
<p><em>äº§å“ç®€ä»‹</em></p>
</blockquote>
<p><em>OEæ˜¯Open Explorerçš„ç¼©å†™ç®€ç§°ï¼Œä¸­æ–‡åä¸ºå¤©å·¥å¼€ç‰©ï¼ˆä»¥ä¸‹ç®€ç§°OEï¼‰ï¼Œå®ƒæ˜¯åŸºäºåœ°å¹³çº¿è‡ªç ”èŠ¯ç‰‡æ‰“é€ çš„å…¨ç”Ÿå‘½å‘¨æœŸå¼€å‘å¹³å°ï¼Œ ä¸»è¦åŒ…æ‹¬æ¨¡å‹ç¼–è¯‘ä¼˜åŒ–å·¥å…·é›†ã€èŠ¯ç‰‡ç®—æ³•ä»“åº“å’Œåº”ç”¨å¼€å‘SDKä¸‰å¤§åŠŸèƒ½æ¨¡å—ã€‚åŸºäºè¿™ä¸‰å¤§åŠŸèƒ½æ¨¡å—å¼€å‘çš„åº”ç”¨å‚è€ƒè§£å†³æ–¹æ¡ˆï¼Œä¸ºæ™ºèƒ½é©¾é©¶ã€æ™ºèƒ½ç‰©è”ç½‘ç­‰è¡Œä¸šæ–¹æ¡ˆæä¾›äº†æ¡ˆä¾‹æ”¯æ’‘ã€‚</em></p>
<p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230508143642837.png"
                      class="" title="image-20230508143642837"
                ></em></p>
<ol>
<li><em>æ¨¡å‹ç¼–è¯‘ä¼˜åŒ–å·¥å…·é›†ï¼šå¦‚ä¸Šå›¾ä¸­é»„è‰²æ¡†å†…çš„éƒ¨åˆ†ï¼Œèšç„¦äºäººå·¥æ™ºèƒ½ä¸šåŠ¡åœºæ™¯ï¼ŒåŒ…æ‹¬å®Œæˆç®—æ³•æ¨¡å‹è½¬æ¢ä¸éƒ¨ç½²å…¨æµç¨‹ä¸­æ‰€æ¶‰åŠåˆ°çš„ä¸€ç³»åˆ—è½¯ä»¶å·¥å…·é›†ï¼Œå…·æœ‰æ¨¡å‹é‡åŒ–ã€ä¼˜åŒ–ã€ç¼–è¯‘ã€ä»¿çœŸã€éƒ¨ç½²ã€è°ƒè¯•ç­‰åŠŸèƒ½ã€‚</em></li>
<li><em>èŠ¯ç‰‡ç®—æ³•ä»“åº“ï¼šåŒ…æ‹¬äº§å“çº§ç®—æ³•ã€åŸºç¡€ç®—æ³•å’Œäº§å“å‚è€ƒç®—æ³•ä¸‰ç±»ç®—æ³•èµ„æºï¼Œèµ‹èƒ½åœ°å¹³çº¿èŠ¯ç‰‡åˆä½œä¼™ä¼´æ›´å¿«ã€æ›´çœåœ°å¼€å‘å‡ºè‡ªå·±çš„äººå·¥æ™ºèƒ½äº§å“ã€‚</em></li>
<li><em>åº”ç”¨å¼€å‘SDKï¼šæä¾›ä¸°å¯Œçš„ã€é«˜åº¦å¯å¤ç”¨çš„ç®—æ³•æ¨¡å—ã€ä¸šåŠ¡ç­–ç•¥æ¨¡å—ã€åº”ç”¨ç»„ä»¶å’Œåœºæ™¯åº”ç”¨å‚è€ƒæ–¹æ¡ˆï¼Œæ—¨åœ¨åŠ é€Ÿå®¢æˆ·ä»ä¸šåŠ¡æ¨¡å‹é›†æˆåˆ°åº”ç”¨ç¨‹åºå¼€å‘æµç¨‹ã€‚</em></li>
</ol>
<blockquote>
<p><em>SOMå¼€å‘æ¿æŒ‡çš„æ˜¯æ­è½½SOMï¼ˆSystem On Moduleï¼‰æ¨¡å—çš„å¼€å‘æ¿ã€‚SOMæ˜¯ä¸€ç§åµŒå…¥å¼è®¡ç®—æ¨¡å—ï¼Œé€šå¸¸åŒ…å«å¤„ç†å™¨ã€å†…å­˜ã€å­˜å‚¨å™¨ã€é€šä¿¡æ¥å£ã€ä¼ æ„Ÿå™¨ç­‰æ ¸å¿ƒç»„ä»¶ã€‚å®ƒçš„ç‰¹ç‚¹æ˜¯å°è£…åº¦é«˜ã€æ˜“äºé›†æˆå’Œç»´æŠ¤ï¼Œå¯ä»¥å¤§å¤§é™ä½åµŒå…¥å¼ç³»ç»Ÿçš„å¼€å‘éš¾åº¦å’Œæˆæœ¬ã€‚</em></p>
<p><em><strong>SOMå¼€å‘æ¿é€šå¸¸æ˜¯åœ¨SOMæ¨¡å—ä¸Šæä¾›ä¸€ç³»åˆ—æ‰©å±•æ¥å£å’Œå¤–å›´ç¡¬ä»¶ï¼Œå¦‚ç½‘å£ã€USBæ¥å£ã€HDMIæ¥å£ã€GPIOã€SPIã€I2Cç­‰ï¼Œæ–¹ä¾¿å¼€å‘è€…è¿›è¡Œç¡¬ä»¶æ‰©å±•å’Œè½¯ä»¶å¼€å‘ã€‚</strong>SOMå¼€å‘æ¿å…·æœ‰ä¸°å¯Œçš„åŠŸèƒ½å’Œæ€§èƒ½ï¼Œå¹¶ä¸”æ˜“äºä½¿ç”¨å’Œç»´æŠ¤ï¼Œéå¸¸é€‚åˆç”¨äºç‰©è”ç½‘ã€æ™ºèƒ½å®¶å±…ã€æ™ºèƒ½åˆ¶é€ ã€æ™ºèƒ½åŒ»ç–—ç­‰åµŒå…¥å¼åº”ç”¨é¢†åŸŸã€‚</em></p>
<p><em>SOMå¼€å‘æ¿é€šå¸¸ç”±ç¡¬ä»¶è®¾è®¡ã€åµŒå…¥å¼è½¯ä»¶å¼€å‘ã€ç³»ç»Ÿé›†æˆç­‰å¤šä¸ªæ–¹é¢çš„å·¥ç¨‹å¸ˆåˆä½œå¼€å‘ã€‚å› æ­¤ï¼ŒSOMå¼€å‘æ¿çš„å¼€å‘å‘¨æœŸä¸€èˆ¬è¾ƒé•¿ï¼Œä½†æ˜¯å¯ä»¥å¤§å¤§æé«˜äº§å“å¼€å‘å’Œç”Ÿäº§çš„æ•ˆç‡å’Œè´¨é‡ã€‚</em></p>
</blockquote>
<blockquote>
<p><em>EVMå¼€å‘æ¿æ˜¯ä¸€ç§ç”¨äºå¿«é€ŸåŸå‹è®¾è®¡å’Œç ”ç©¶çš„åµŒå…¥å¼ç³»ç»Ÿå¼€å‘æ¿ã€‚EVMæ˜¯è‹±æ–‡Evaluation Moduleçš„ç¼©å†™ï¼Œ<strong>æ„ä¸ºè¯„ä¼°æ¨¡å—ï¼Œå…¶ä¸»è¦åŠŸèƒ½æ˜¯ä¸ºç”¨æˆ·æä¾›ä¸€ä¸ªä½æˆæœ¬ã€é«˜å¯é æ€§çš„ç¡¬ä»¶å¹³å°ï¼Œç”¨äºéªŒè¯å’Œæµ‹è¯•ç¡¬ä»¶å’Œè½¯ä»¶è®¾è®¡</strong>ã€‚EVMå¼€å‘æ¿é€šå¸¸æ­è½½äº†å¤„ç†å™¨ã€å­˜å‚¨å™¨ã€é€šä¿¡æ¥å£ã€ä¼ æ„Ÿå™¨ç­‰æ ¸å¿ƒç»„ä»¶ï¼Œå¯ä»¥é€šè¿‡æ‰©å±•æ¥å£æ¥å®ç°æ›´å¤šçš„ç¡¬ä»¶æ‰©å±•å’ŒåŠŸèƒ½å¢å¼ºï¼Œä»è€Œæ»¡è¶³å„ç§ä¸åŒçš„åº”ç”¨éœ€æ±‚ã€‚å‚å•†ä¸€èˆ¬æä¾›ç›¸å…³çš„è½¯ä»¶å¼€å‘åŒ…å’ŒæŠ€æœ¯æ”¯æŒï¼Œä¸ºç”¨æˆ·æä¾›æ–¹ä¾¿çš„ä½¿ç”¨å’Œå¼€å‘ç¯å¢ƒï¼Œä½¿å¾—ç”¨æˆ·èƒ½å¤Ÿå¿«é€Ÿåœ°å¼€å‘å‡ºé€‚åˆè‡ªå·±åº”ç”¨åœºæ™¯çš„åµŒå…¥å¼äº§å“ã€‚</em></p>
<p><em>EVMå¼€å‘æ¿çš„è®¾è®¡å‘¨æœŸæ¯”è¾ƒçŸ­ï¼Œæ¯”SOMå¼€å‘æ¿æ›´å…·æœ‰çµæ´»æ€§å’Œé€‚åº”æ€§ï¼Œ<strong>ä¸»è¦ç”¨äºå°†åµŒå…¥å¼ç³»ç»Ÿå¿«é€ŸæŠ•å…¥åˆ°å¸‚åœºä¸­ï¼Œå…·æœ‰ä¸€å®šçš„ä¸´æ—¶æ€§å’Œåº”æ€¥æ€§ã€‚</strong></em></p>
<ol>
<li>èŠ¯ç‰‡è¯„ä¼°å’Œæµ‹è¯•ï¼š EVMå¼€å‘æ¿å¸¸ç”¨äºè¯„ä¼°å’Œæµ‹è¯•æ–°çš„èŠ¯ç‰‡æˆ–å¤„ç†å™¨ã€‚é€šè¿‡ä½¿ç”¨EVMå¼€å‘æ¿ï¼Œå·¥ç¨‹å¸ˆå¯ä»¥å¿«é€Ÿäº†è§£èŠ¯ç‰‡çš„æ€§èƒ½å’ŒåŠŸèƒ½ï¼Œæå‰è¯„ä¼°å…¶æ˜¯å¦ç¬¦åˆç³»ç»Ÿè®¾è®¡çš„è¦æ±‚ã€‚</li>
<li>åŸå‹è®¾è®¡ï¼š EVMå¼€å‘æ¿å¯ä»¥ç”¨äºå¿«é€ŸåŸå‹è®¾è®¡å’Œç³»ç»ŸåŸå‹éªŒè¯ã€‚å®ƒå…è®¸å¼€å‘è€…å¿«é€Ÿæ­å»ºä¸€ä¸ªåŸå‹ç³»ç»Ÿï¼Œæµ‹è¯•ç³»ç»Ÿçš„å„ä¸ªç»„ä»¶å’ŒåŠŸèƒ½ï¼Œå¹¶å¿«é€Ÿè¿­ä»£å’Œä¼˜åŒ–ç³»ç»Ÿã€‚</li>
<li>ç¡¬ä»¶è°ƒè¯•ï¼š å½“å‡ºç°é—®é¢˜æˆ–æ•…éšœæ—¶ï¼Œ EVMå¼€å‘æ¿å¯ä»¥ä½œä¸ºæ•…éšœæ’æŸ¥çš„å·¥å…·ï¼Œå¸®åŠ©å·¥ç¨‹å¸ˆå¿«é€Ÿæ’é™¤ç¡¬ä»¶é—®é¢˜ã€‚å®ƒå¯ä»¥ç”¨æ¥æ£€æŸ¥èŠ¯ç‰‡ã€å¯„å­˜å™¨ã€æ€»çº¿ç­‰ç¡¬ä»¶ç»„ä»¶æ˜¯å¦æ­£å¸¸ã€‚</li>
<li>é©±åŠ¨ç¨‹åºçš„å¼€å‘è°ƒè¯•ï¼š EVMå¼€å‘æ¿å¯ä»¥ç”¨äºé©±åŠ¨ç¨‹åºçš„å¼€å‘è°ƒè¯•ï¼Œä¸ºå¼€å‘äººå‘˜æä¾›æµ‹è¯•å’Œè°ƒè¯•æ•´ä¸ªç³»ç»Ÿçš„å·¥å…·ã€‚</li>
</ol>
</blockquote>
<blockquote>
<p><em>PACå¼€å‘æ¿æ˜¯ä¸€ç§åŸºäºPACï¼ˆProgrammable Automation Controllerï¼‰æŠ€æœ¯çš„åµŒå…¥å¼æ§åˆ¶å™¨å¼€å‘æ¿ã€‚PACæ˜¯ä¸€ç§æ–°å‹çš„å·¥ä¸šè‡ªåŠ¨åŒ–æ§åˆ¶å™¨ï¼Œå…·æœ‰é«˜æ•ˆã€çµæ´»ã€å¯ç¼–ç¨‹çš„ç‰¹ç‚¹ã€‚PACç»“åˆäº†PLCï¼ˆProgrammable Logic Controllerï¼‰å’ŒPCï¼ˆPersonal Computerï¼‰çš„ä¼˜ç‚¹ï¼Œå…·æœ‰æ›´é«˜çš„è®¡ç®—èƒ½åŠ›å’Œæ›´å¼ºçš„è‡ªé€‚åº”èƒ½åŠ›ã€‚</em></p>
<p><em>PACå¼€å‘æ¿é€šå¸¸æ­è½½äº†PACèŠ¯ç‰‡ã€è¿ç®—å™¨ã€å†…å­˜ã€ä»¥å¤ªç½‘æ¥å£ã€ä¸²å£ã€GPIOç­‰æ ¸å¿ƒç»„ä»¶ã€‚ç”¨æˆ·å¯ä»¥é€šè¿‡æ‰©å±•æ¥å£å’Œç¼–ç¨‹è¯­è¨€æ¥å®ç°å„ç§ä¸åŒçš„æ§åˆ¶ä»»åŠ¡ï¼Œå¦‚è¿åŠ¨æ§åˆ¶ã€æœºå™¨è§†è§‰ã€æ•°æ®é‡‡é›†ã€æ•°æ®å¤„ç†ç­‰ã€‚</em></p>
<p><em>PACå¼€å‘æ¿çš„ä¼˜åŠ¿ä¸»è¦ä½“ç°åœ¨ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š</em></p>
<ol>
<li>æ•°æ®é‡‡é›†å’Œå¤„ç†ï¼šPACå¼€å‘æ¿å…·æœ‰å¼ºå¤§çš„æ•°æ®é‡‡é›†å’Œå¤„ç†åŠŸèƒ½ï¼Œå¯ä¸å¤šç§ä¼ æ„Ÿå™¨è¿›è¡Œè¿æ¥ï¼Œå¹¶èƒ½å¤Ÿå¿«é€Ÿå¤„ç†å’Œåˆ†æé‡‡é›†åˆ°çš„æ•°æ®ï¼Œæé«˜æ§åˆ¶ç³»ç»Ÿçš„ç¨³å®šæ€§å’Œæ•ˆç‡ã€‚</li>
<li>æœºå™¨æ§åˆ¶ï¼šPACå¼€å‘æ¿å¯ä»¥ç”¨äºæœºå™¨æ§åˆ¶ï¼ŒåŒ…æ‹¬æœºæ¢°æ‰‹è‡‚ã€è¿åŠ¨æ§åˆ¶ç³»ç»Ÿç­‰ï¼Œæé«˜ç³»ç»Ÿçš„è¿åŠ¨ç²¾åº¦å’Œæ§åˆ¶é€Ÿåº¦ã€‚</li>
<li>å·¥ä¸šè‡ªåŠ¨åŒ–æ§åˆ¶ï¼šPACå¼€å‘æ¿å…·æœ‰é«˜å¯é æ€§å’Œå®‰å…¨æ€§ï¼Œå¯ç”¨äºå·¥ä¸šè‡ªåŠ¨åŒ–æ§åˆ¶ç³»ç»Ÿï¼Œå¦‚è‡ªåŠ¨åŒ–ç”Ÿäº§çº¿ã€å·¥ä¸šæœºå™¨äººç­‰ï¼Œæé«˜å·¥ä¸šç”Ÿäº§çš„æ•ˆç‡å’Œè´¨é‡ã€‚</li>
<li>æ™ºèƒ½å»ºç­‘æ§åˆ¶ï¼šPACå¼€å‘æ¿å¯è¿æ¥åˆ°å»ºç­‘è‡ªåŠ¨åŒ–ç³»ç»Ÿä¸­ï¼Œå¹¶å¯é€šè¿‡ä¸å…¶ä»–ä¼ æ„Ÿå™¨å’Œè®¾å¤‡çš„åä½œï¼Œå®ç°å¯¹å»ºç­‘ç‰©èƒ½è€—ã€ç¯å¢ƒã€å®‰å…¨ç­‰æ–¹é¢çš„ç®¡ç†å’Œæ§åˆ¶ã€‚</li>
</ol>
</blockquote>
<blockquote>
<p><em>Matrixå¼€å‘æ¿æ˜¯ç”±ç¾å›½ä¼ä¸šMakerï¼ˆMake with Adaï¼‰å¼€å‘çš„ä¸€ç§åŸºäºARMæ¶æ„çš„å¼€æºåµŒå…¥å¼ç³»ç»Ÿå¼€å‘æ¿ã€‚å®ƒæä¾›äº†ä¸°å¯Œçš„ç¡¬ä»¶æ¥å£å’Œå…¨é¢çš„é…å¥—è½¯ä»¶æ”¯æŒï¼Œé€‚ç”¨äºå„ç§ä¸åŒè§„æ¨¡å’Œé¢†åŸŸçš„åµŒå…¥å¼åº”ç”¨å¼€å‘ã€‚</em></p>
<ol>
<li>å®ç°ç‰©è”ç½‘åº”ç”¨ï¼šMatrixå¼€å‘æ¿å¯ä»¥é€šè¿‡è¿æ¥å„ç§ä¼ æ„Ÿå™¨å’Œè®¾å¤‡ï¼Œå®ç°æ•°æ®é‡‡é›†å’Œå¤„ç†ï¼Œä»è€Œå®ç°æ™ºèƒ½åŒ–çš„ç‰©è”ç½‘åº”ç”¨ï¼Œå¦‚ç¯å¢ƒç›‘æµ‹ã€æ™ºèƒ½å®¶å±…ç­‰ã€‚</li>
<li>ç ”ç©¶å’Œå¼€å‘äººå·¥æ™ºèƒ½ç®—æ³•ï¼šMatrixå¼€å‘æ¿é‡‡ç”¨äº†å…ˆè¿›çš„äººå·¥æ™ºèƒ½èŠ¯ç‰‡ï¼Œæ”¯æŒæ·±åº¦å­¦ä¹ ã€ç¥ç»ç½‘ç»œç­‰æŠ€æœ¯ï¼Œå¼€å‘è€…å¯ä»¥åœ¨å…¶ä¸­è¿è¡Œå’Œæµ‹è¯•è‡ªå·±çš„äººå·¥æ™ºèƒ½ç®—æ³•ï¼Œå¦‚å›¾åƒè¯†åˆ«ã€è‡ªç„¶è¯­è¨€å¤„ç†ç­‰ï¼Œä»è€Œå¼€å‘æ›´æ™ºèƒ½åŒ–ã€ä¼˜åŒ–çš„äººå·¥æ™ºèƒ½åº”ç”¨ã€‚</li>
<li>é«˜æ€§èƒ½è®¡ç®—ï¼šMatrixå¼€å‘æ¿é…å¤‡é«˜æ€§èƒ½çš„å¤„ç†å™¨å’Œå†…å­˜ï¼Œå¯ç”¨äºè®¡ç®—å¯†é›†å‹åº”ç”¨ï¼Œå¦‚ç§‘å­¦è®¡ç®—ã€å¤§æ•°æ®åˆ†æç­‰ã€‚</li>
<li>æ•™è‚²å’Œå­¦ä¹ ï¼šMatrixå¼€å‘æ¿æ˜“äºä½¿ç”¨ï¼ŒåŠŸèƒ½å¼ºå¤§ï¼Œå› æ­¤å¯ä»¥ä½œä¸ºæ•™è‚²å’Œå­¦ä¹ çš„å·¥å…·ï¼Œä½¿å­¦ç”Ÿå’Œçˆ±å¥½è€…äº†è§£äººå·¥æ™ºèƒ½æŠ€æœ¯å¹¶å¼€å‘è‡ªå·±çš„åº”ç”¨ã€‚</li>
</ol>
</blockquote>
<p><em>OEå¯ä»¥ä¸ºåœ°å¹³çº¿èŠ¯ç‰‡åˆä½œä¼™ä¼´æä¾›ä¸°å¯Œå¤šæ ·çš„ç®—æ³•èµ„æºã€çµæ´»é«˜æ•ˆçš„å¼€å‘å·¥å…·å’Œç®€å•æ˜“ç”¨çš„å¼€å‘æ¡†æ¶ã€‚ OEçš„ç‰¹è‰²å’Œä¼˜åŠ¿å¯ä»¥æ¦‚æ‹¬ä¸ºä»¥ä¸‹å››ä¸ªæ–¹é¢ï¼š</em></p>
<p><em><a target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/_images/learn_oe_2.png"><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/J5/image-20230508144405157.png"
                      alt="image-20230508144405157"
                ></a></em></p>
<p><em>ä¸ºäº†æ–¹ä¾¿ç”¨æˆ·å°†å„ç§è§£å†³æ–¹æ¡ˆéƒ¨ç½²åˆ°åœ°å¹³çº¿ä¸€ç³»åˆ—å¼€å‘æ¿ä¸Šï¼Œæˆ‘ä»¬æä¾›äº†é›†å¼€å‘æ¿ç³»ç»Ÿé•œåƒã€å¼€å‘ç¯å¢ƒéƒ¨ç½²ã€åº”ç”¨å‚è€ƒè§£å†³æ–¹æ¡ˆç¤ºä¾‹ä»£ç ä»¥åŠç”¨æˆ·æ‰‹å†Œç­‰æ–‡ä»¶äºä¸€ä½“çš„å…¨é‡å¼€å‘åŒ…ï¼Œç§°ä¹‹ä¸ºOEåŒ…ã€‚ åœ¨æ‚¨è·å–åˆ°OEåŒ…åï¼Œå¯ä»¥å…ˆæŒ‰ç…§ä»¥ä¸‹æ­¥éª¤å¯¹OEè¿›è¡Œäº†è§£ã€‚</em></p>
<ol>
<li><em>å…ˆå‚è€ƒ <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/preface/learn_oe.html#post-item" >å‘å¸ƒç‰©å†…å®¹ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> äº†è§£å‘å¸ƒåŒ…çš„ç›®å½•ç»“æ„ï¼›</em></li>
<li><em>å†å‚è€ƒ <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/appendix/hardware/system_image.html" >ç³»ç»Ÿé•œåƒå‡çº§ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ç« èŠ‚è¿›è¡Œæ¿ç«¯ç³»ç»Ÿé•œåƒå®‰è£…&#x2F;å‡çº§ï¼›</em></li>
<li><em>æ¥ç€é€šè¿‡å‚è€ƒ <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/model_conversion.html" >æµ®ç‚¹æ¨¡å‹è½¬å®šç‚¹æ¨¡å‹æŒ‡å¯¼æ‰‹å†Œ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> å’Œ <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/runtime/source/runtime_dev.html" >åµŒå…¥å¼åº”ç”¨å¼€å‘æŒ‡å¯¼ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> å®Œæˆæ¨¡å‹è½¬æ¢ä¸éƒ¨ç½²çš„å…¨æµç¨‹ã€‚</em></li>
</ol>
<p><em>æ›´å¤šæ›´å…¨çš„OEåŒ…ä½¿ç”¨æ•™ç¨‹ï¼Œæ¬¢è¿å‚è€ƒä¸‹æ–¹æŒ‡å¯¼æ‰‹å†Œè¿›è¡Œäº†è§£ï¼Œç›¸ä¿¡åœ°å¹³çº¿çš„OEåŒ…å¯ä»¥è®©æ‚¨å¼€å‘æ›´é«˜æ•ˆï¼Œéƒ¨ç½²æ›´ç®€ä¾¿ï¼</em></p>
<p><em>æ›´å¤šå…³äºOEé€‚é…çš„ç¡¬ä»¶å†…å®¹ï¼Œè¯·ä½ è¯¦è§é™„å½•ä¸­çš„ <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/appendix/hardware/dev_board_kit.html" >å¼€å‘æ¿å¥—ä»¶ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ç« èŠ‚ã€‚</em></p>
<blockquote>
<p><em>å‘å¸ƒç‰©å†…å®¹</em></p>
</blockquote>
<ul>
<li><em><strong>bsp</strong>ï¼šbspç›®å½•ä¸‹åŒ…å« <code>resolve.sh</code> è„šæœ¬å’Œ <code>tools</code> æ–‡ä»¶å¤¹ã€‚</em><em>å…¶ä¸­ï¼š<code>resolve.sh</code> è„šæœ¬ç”¨äºä¸‹è½½é•œåƒåŒ…ï¼Œä½†ä¸‹è½½çš„é•œåƒä»…é€‚ç”¨äºJ5 DVBå¼€å‘æ¿ï¼Œè‹¥éœ€è¦å…¶ä»–å¼€å‘æ¿é•œåƒï¼Œéœ€è”ç³»åœ°å¹³çº¿è¿›è¡Œè·å–ã€‚<code>tools</code> æ–‡ä»¶å¤¹ä¸‹çš„ <code>resolve.sh</code> è„šæœ¬ç”¨äºä¸‹è½½hbupdateæ¿ç«¯å‡çº§å·¥å…·å’Œä¸€äº›æ‚¨åœ¨Windowsä¸‹ä¼šä½¿ç”¨åˆ°çš„USB_Driverç­‰**ã€‚ å…¶ä¸­ï¼Œhbupdateæ¿ç«¯å‡çº§å·¥å…·æˆ‘ä»¬ä¸ºæ‚¨æä¾›äº†å¤šå¹³å°ï¼ˆwin&#x2F;linuxï¼‰çš„ç‰ˆæœ¬ï¼Œå†…å®¹åŒ…æ‹¬ï¼š</em><ul>
<li><em>hbupdate_linux_cli_{version}.tgzï¼›</em></li>
<li><em>hbupdate_linux_gui_{version}.tgzï¼›</em></li>
<li><em>hbupdate_win64_{version}.zipã€‚</em></li>
</ul>
</li>
</ul>
<blockquote>
<p><em><strong>DVBï¼ˆDigital Video Broadcastingï¼‰å¼€å‘æ¿æ˜¯ä¸€ç§ç”¨äºæ•°å­—ç”µè§†ä¿¡å·æ¥æ”¶å’Œè§£ç çš„åµŒå…¥å¼ç³»ç»Ÿå¼€å‘æ¿</strong>ã€‚å®ƒåœ¨ç¡¬ä»¶å±‚é¢æä¾›äº†å„ç§é€šä¿¡æ¥å£å’Œä¸“ä¸šçš„è§£ç å™¨èŠ¯ç‰‡ä»¥åŠä¼˜è´¨çš„è§†é¢‘æ˜¾ç¤ºå¤„ç†å™¨ï¼Œä½†åŒæ—¶ä¹Ÿéœ€è¦åœ¨è½¯ä»¶å±‚é¢ä¸Šæä¾›ç›¸åº”çš„ç¼–è§£ç å™¨å¹¶æ”¯æŒç›¸å…³çš„æ ‡å‡†åè®®ã€‚</em></p>
<p><em>DVBå¼€å‘æ¿é€šå¸¸èƒ½å¤Ÿæ”¯æŒæ•°å­—åœ°é¢ç”µè§†ï¼ˆDVB-Tï¼‰ã€æœ‰çº¿ç”µè§†ï¼ˆDVB-Cï¼‰ã€å«æ˜Ÿç”µè§†ï¼ˆDVB-Sï¼‰ä»¥åŠé«˜æ¸…ç”µè§†ï¼ˆDVB-HDï¼‰ç­‰å¤šç§æ•°å­—ç”µè§†ä¿¡å·çš„æ¥æ”¶å’Œè§£ç ï¼ŒåŒæ—¶ä¹Ÿæ”¯æŒå¤šç§æ•°å­—éŸ³é¢‘æ ¼å¼çš„è§£ç ä»¥åŠä¼—å¤šçš„äº’è”ç½‘è§†é¢‘å’ŒéŸ³é¢‘è§£ç åè®®ï¼Œå¦‚ RTSP, HLS, RTP, MPEG-DASHç­‰ã€‚å®ƒè¿˜å¯ä»¥é€šè¿‡ä»¥å¤ªç½‘æˆ–USBç­‰æ¥å£ï¼Œè¿æ¥åˆ°äº’è”ç½‘ä¸Šè¿›è¡Œç½‘ç»œè§†é¢‘å’ŒéŸ³é¢‘æµåª’ä½“çš„æ¥æ”¶å’Œè§£ç ã€‚</em></p>
<p><em>DVBå¼€å‘æ¿çš„åº”ç”¨èŒƒå›´éå¸¸å¹¿æ³›ï¼ŒåŒ…æ‹¬æ•°å­—ç”µè§†æ¥æ”¶æœºå¼€å‘ã€åµŒå…¥å¼å¤šåª’ä½“åº”ç”¨å¼€å‘ã€å®‰é˜²ç›‘æ§ã€æ•™è‚²åŸ¹è®­ç­‰é¢†åŸŸã€‚åŒæ—¶ï¼ŒDVBå¼€å‘æ¿ä¹Ÿå¯ä»¥ä¸ºæ•°å­—ç”µè§†äº§ä¸šé“¾ä¸Šæ¸¸çš„å¸¸è§„å«æ˜Ÿæ¥æ”¶å™¨ã€è°ƒåˆ¶å™¨ã€ç¼–ç å™¨ç­‰è®¾å¤‡æä¾›æ•°å­—ç”µè§†ä¿¡å·æºã€‚</em></p>
<p><em>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸åŒçš„å›½å®¶æˆ–åœ°åŒºå¯èƒ½ä½¿ç”¨ä¸åŒæ ‡å‡†çš„æ•°å­—ç”µè§†ï¼Œå› æ­¤ï¼Œåœ¨é€‰æ‹©DVBå¼€å‘æ¿æ—¶ï¼Œéœ€è¦é€‰æ‹©æ”¯æŒå½“åœ°ä½¿ç”¨çš„æ•°å­—ç”µè§†æ ‡å‡†ã€‚</em></p>
</blockquote>
<ul>
<li><em><strong>ddk</strong>ï¼šddkç›®å½•ä¸ºä¸»è¦çš„å¼€å‘ç»„ä»¶ç›®å½•ï¼Œç›®å½•ä¸‹åŒ…å«äº† packageå’Œsamlesæ–‡ä»¶å¤¹ã€‚</em><ul>
<li><em>ddk.package</em><ul>
<li><em>ddk.package.board</em><ul>
<li><em><code>ddk.package.board</code> æ–‡ä»¶å¤¹ä¸‹ä¸ºæ¿ç«¯å¯æ‰§è¡Œç¨‹åºã€‚</em></li>
<li><em><code>hrt_model_exec</code> æ˜¯ä¸€ä¸ªæ¨¡å‹æ‰§è¡Œå·¥å…· ï¼Œ<strong>å¯ç›´æ¥åœ¨ å¼€å‘æ¿ä¸Š è¿›è¡Œè¯„æµ‹æ¨¡å‹çš„æ¨ç†æ€§èƒ½ã€è·å–æ¨¡å‹ä¿¡æ¯ã€‚</strong>å·¥å…·åˆ†åˆ«æä¾›äº† <code>infer</code> ã€æ¨¡å‹æ€§èƒ½åˆ†æ <code>perf</code> å’ŒæŸ¥çœ‹æ¨¡å‹ä¿¡æ¯ <code>model_info</code> ä¸‰ç±»åŠŸèƒ½ã€‚</em></li>
<li><em><code>hrt_bin_dump</code> æ˜¯ptq debugæ¨¡å‹çš„layer dumpå·¥å…·ï¼Œå·¥å…·çš„è¾“å‡ºæ–‡ä»¶ä¸ºäºŒè¿›åˆ¶æ–‡ä»¶ã€‚</em></li>
<li><em><code>install.sh</code> æ˜¯ä¸€é”®å®‰è£…è„šæœ¬ï¼Œ<strong>å¯ä»¥ä¸€é”®å°†hrtå·¥å…·å®‰è£…åˆ°æŒ‡å®šçš„å¼€å‘æ¿</strong>ã€‚</em></li>
</ul>
</li>
<li>*ddk.package.hostï¼š<code>ddk.package.host</code> æ–‡ä»¶å¤¹ä¸‹ä¸ºå‘å¸ƒç‰©åœ¨x86å¼€å‘ç¯å¢ƒä¸‹çš„ç¯å¢ƒä¾èµ–å’Œå·¥å…·ä¾èµ–ç­‰ã€‚ <strong>é€šè¿‡æ‰§è¡Œè¯¥ç›®å½•ä¸‹çš„è„šæœ¬ <code>install.sh</code> å³å¯åœ¨å¼€å‘æœºä¸Šå®‰è£…ç¨‹åºè¿è¡Œçš„æ‰€æœ‰ç¯å¢ƒå’Œå·¥å…·ä¾èµ–</strong>ã€‚ <strong>é€šè¿‡æ‰§è¡Œè¯¥ç›®å½•ä¸‹çš„è„šæœ¬ <code>resolve.sh</code> å³å¯ä¸‹è½½äº¤å‰ç¼–è¯‘å·¥å…·ã€torchç­‰ä¾èµ–ã€‚</strong>*</li>
</ul>
</li>
<li><em>ddk.samplesï¼š<code>ddk.samples</code> ä¸‹åŒ…å«äº† <strong>ai_benchmarkã€ai_toolchainã€ai_forward_view_sampleã€vdsp_rpc_sampleå’Œmodel_zoo</strong> ã€‚</em><ul>
<li><em>ai_benchmark æä¾›äº†å¸¸è§çš„åˆ†ç±»ã€æ£€æµ‹å’Œåˆ†å‰²æ¨¡å‹çš„<strong>è¯„æµ‹ç¤ºä¾‹</strong>ï¼ŒåŒ…æ‹¬æ€§èƒ½è¯„æµ‹å’Œç²¾åº¦è¯„æµ‹ä¸¤éƒ¨åˆ†ã€‚</em></li>
<li><em>ai_toolchain æä¾›äº†ä¸€äº›æ¨¡å‹ç®—æ³•çš„ä¸€ç³»åˆ—ç¤ºä¾‹ã€‚ ï¼ˆå…¶ä¸­ horizon_model_train_samples ä¸ºæµ®ç‚¹æ¨¡å‹è®­ç»ƒæ¡†æ¶ç¤ºä¾‹, horizon_model_convert_sample ä¸ºæµ®ç‚¹æ¨¡å‹è½¬å®šç‚¹æ¨¡å‹çš„è½¬æ¢ç¤ºä¾‹, horizon_runtime_sample ä¸ºå®šç‚¹æ¨¡å‹çš„ä¸Šæ¿ç¤ºä¾‹ã€‚ï¼‰</em></li>
<li><em><strong>ai_forward_view_sample ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•åœ¨J5ä¸Šè¿è¡Œä¸€ä¸ªæ£€æµ‹æ¨¡å‹å¹¶å±•ç¤ºç‰©ä½“æ¡†ã€‚</strong></em></li>
<li><em>vdsp_rpc_sample ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•åœ¨j5ä¸Šä½¿ç”¨dspè¿›è¡Œä»»åŠ¡å¤„ç†ã€‚</em></li>
<li><em>model_zoo æ˜¯ä¸€ä¸ªæ¨¡å‹åº“ï¼Œç”¨äºæ”¾ç½®å·¥å…·é“¾ç¤ºä¾‹æ¨¡å‹ç¼–è¯‘çš„æºæ¨¡å‹å’Œruntimeæ¨¡å‹ã€‚</em></li>
</ul>
</li>
</ul>
</li>
<li><em><strong>resolve_all.sh</strong>ï¼šç”¨äºè‡ªåŠ¨ä¸‹è½½OEåŒ…å†…æ‰€æœ‰å¯ä¸‹è½½çš„ä¾èµ–é¡¹çš„è„šæœ¬ã€‚</em></li>
<li><em><strong>run_docker.sh</strong>ï¼šåœ¨ä½¿ç”¨æŒ‡å®šçš„æ•°æ®é›†å’ŒOEåŒ…è¿è¡Œç¨‹åºä¹‹å‰ï¼Œéœ€è¦ç¡®ä¿å·²ç»ä¸‹è½½å’Œå®‰è£…å®Œæˆï¼Œç„¶åä½¿ç”¨run_docker.shè„šæœ¬å¯åŠ¨dockerï¼Œè¯¥è„šæœ¬ä¼šè‡ªåŠ¨å°†æ•°æ®é›†æŒ‚è½½åˆ°dockerä¸­ï¼Œå¹¶ç¡®ä¿OEåŒ…çš„å¿…è¦å†…å®¹åœ¨dockerç¯å¢ƒä¸­å¯ç”¨ã€‚</em></li>
</ul>
<blockquote>
<p><em>å…³é”®æ¦‚å¿µ</em></p>
</blockquote>
<ul>
<li><em><strong>åŸå§‹æµ®ç‚¹æ¨¡å‹</strong>ï¼ŒæŒ‡æ‚¨é€šè¿‡TensorFlow&#x2F;PyTorchç­‰ç­‰DLæ¡†æ¶è®­ç»ƒå¾—åˆ°çš„å¯ç”¨æ¨¡å‹ï¼Œè¿™ä¸ªæ¨¡å‹çš„è®¡ç®—ç²¾åº¦ä¸ºfloat32ã€‚</em></li>
<li><em><strong>æ··åˆå¼‚æ„æ¨¡å‹</strong>ï¼Œæ˜¯ä¸€ç§é€‚åˆåœ¨åœ°å¹³çº¿èŠ¯ç‰‡ä¸Šè¿è¡Œçš„æ¨¡å‹æ ¼å¼ã€‚</em></li>
<li><em><strong>æ¨¡å‹è½¬æ¢</strong>ï¼ŒæŒ‡çš„æ˜¯å°†åŸå§‹æµ®ç‚¹æ¨¡å‹æˆ–QATè½¬æ¢å¾—åˆ°çš„onnxæ¨¡å‹è½¬æ¢ä¸ºåœ°å¹³çº¿æ··åˆå¼‚æ„æ¨¡å‹çš„è¿‡ç¨‹ã€‚</em></li>
<li><em><strong>æ¨¡å‹é‡åŒ–</strong>ï¼Œç›®å‰å·¥ä¸šç•Œæœ€æœ‰æ•ˆçš„æ¨¡å‹ä¼˜åŒ–æ–¹æ³•ä¹‹ä¸€ï¼Œé‡åŒ–æ˜¯æŒ‡å®šç‚¹ä¸æµ®ç‚¹ç­‰æ•°æ®ä¹‹é—´å»ºç«‹ä¸€ç§æ•°æ®æ˜ å°„å…³ç³»ï¼Œä½¿å¾—ä»¥è¾ƒå°çš„ç²¾åº¦æŸå¤±ä»£ä»·è·å¾—äº†æ¨ç†æ€§èƒ½æ”¶ç›Šï¼Œå¯ç®€å•ç†è§£ä¸ºç”¨â€œä½æ¯”ç‰¹â€æ•°å­—è¡¨ç¤ºFP32ç­‰æ•°å€¼ï¼Œå¦‚FP32â€“&gt;INT8å¯ä»¥å®ç°4å€çš„å‚æ•°å‹ç¼©ï¼Œåœ¨å‹ç¼©å†…å­˜çš„åŒæ—¶å¯ä»¥å®ç°æ›´å¿«é€Ÿçš„è®¡ç®—ã€‚</em></li>
<li><em><strong>hbmæ–‡ä»¶</strong>ï¼Œå³Horizon BPU Modelï¼ŒHBDKç¼–è¯‘å™¨ç”Ÿæˆçš„æ¨¡å‹æ–‡ä»¶ï¼ŒhbmåŒ…å«BPUæŒ‡ä»¤ã€æ¨¡å‹å‚æ•°ã€è¾“å…¥è¾“å‡ºæè¿°ç­‰ä¿¡æ¯ã€‚</em></li>
<li><em><strong>PTQ</strong>ï¼Œå³è®­ç»ƒåé‡åŒ–æ–¹æ¡ˆï¼Œå…ˆè®­ç»ƒæµ®ç‚¹æ¨¡å‹ï¼Œç„¶åä½¿ç”¨æ ¡å‡†å›¾ç‰‡è®¡ç®—é‡åŒ–å‚æ•°ï¼Œå°†æµ®ç‚¹æ¨¡å‹è½¬ä¸ºé‡åŒ–æ¨¡å‹çš„é‡åŒ–æ–¹æ³•ã€‚</em></li>
<li><em><strong>QAT</strong>ï¼Œå³é‡åŒ–æ„ŸçŸ¥è®­ç»ƒæ–¹æ³•</em></li>
</ul>
<blockquote>
<p><em>æ··åˆå¼‚æ„æ¨¡å‹ï¼ˆMixed Heterogeneous Modelï¼‰æ˜¯æŒ‡ä½¿ç”¨ä¸åŒçš„ç¡¬ä»¶å®ç°æ·±åº¦ç¥ç»ç½‘ç»œæ¨ç†ï¼ˆInferenceï¼‰è¿‡ç¨‹ï¼Œä»¥å®ç°æ›´é«˜æ€§èƒ½å’Œæ›´é«˜èƒ½æ•ˆçš„æ·±åº¦å­¦ä¹ è®¡ç®—ã€‚æ··åˆå¼‚æ„æ¨¡å‹å°†å¤šç§ç¡¬ä»¶å¹³å°è¿›è¡Œé›†æˆï¼Œå…¶ä¸­åŒ…æ‹¬ä¸­å¤®å¤„ç†å™¨ï¼ˆCPUï¼‰ã€å›¾å½¢å¤„ç†å™¨ï¼ˆGPUï¼‰ã€æ•°å­—ä¿¡å·å¤„ç†å™¨ï¼ˆDSPï¼‰ã€ç¥ç»ç½‘ç»œå¤„ç†å™¨ï¼ˆNPUï¼‰ç­‰ï¼Œæ¯ä¸ªç¡¬ä»¶å¹³å°é’ˆå¯¹è‡ªå·±çš„ä¼˜åŠ¿è¿›è¡Œè®¡ç®—ï¼Œä»è€Œå……åˆ†åˆ©ç”¨å„ç¡¬ä»¶å¹³å°çš„ç‰¹ç‚¹ã€‚</em></p>
</blockquote>
<h4 id="å·¥å…·é“¾æ¦‚è§ˆ"><a href="#å·¥å…·é“¾æ¦‚è§ˆ" class="headerlink" title="å·¥å…·é“¾æ¦‚è§ˆ"></a><em>å·¥å…·é“¾æ¦‚è§ˆ</em></h4><p><em>åœ°å¹³çº¿J5èŠ¯ç‰‡ç®—æ³•å·¥å…·é“¾ï¼ˆä»¥ä¸‹ç®€ç§°å·¥å…·é“¾ï¼‰æ˜¯ä¸€å¥—å®Œæ•´çš„è¾¹ç¼˜èŠ¯ç‰‡ç®—æ³•è½åœ°è§£å†³æ–¹æ¡ˆï¼Œå¯ä»¥å¸®åŠ©æ‚¨æŠŠæµ®ç‚¹æ¨¡å‹é‡åŒ–ä¸ºå®šç‚¹æ¨¡å‹ï¼Œ å¹¶åœ¨åœ°å¹³çº¿èŠ¯ç‰‡ä¸Šå¿«é€Ÿéƒ¨ç½²è‡ªç ”ç®—æ³•æ¨¡å‹ã€‚</em></p>
<p><em>ç›®å‰åœ¨GPUä¸Šè®­ç»ƒçš„æ¨¡å‹å¤§éƒ¨åˆ†éƒ½æ˜¯æµ®ç‚¹æ¨¡å‹ï¼Œå³å‚æ•°ä½¿ç”¨çš„æ˜¯floatç±»å‹å­˜å‚¨ã€‚ åœ°å¹³çº¿BPUæ¶æ„çš„èŠ¯ç‰‡ä½¿ç”¨çš„æ˜¯int8çš„è®¡ç®—ç²¾åº¦ï¼ˆä¸šå†…èŠ¯ç‰‡çš„é€šç”¨ç²¾åº¦ï¼‰ï¼Œèƒ½è¿è¡Œå®šç‚¹é‡åŒ–æ¨¡å‹ã€‚ é‚£ä¹ˆä»è®­ç»ƒå‡ºçš„æµ®ç‚¹ç²¾åº¦è½¬ä¸ºå®šç‚¹æ¨¡å‹çš„è¿‡ç¨‹ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºé‡åŒ–ã€‚ åŒæ—¶æ¨¡å‹é‡åŒ–åèƒ½å¤Ÿæœ‰æ•ˆå‡å°‘æ¨¡å‹å¤§å°ï¼ŒåŠ é€Ÿæ·±åº¦å­¦ä¹ æ¨ç†çš„é€Ÿåº¦ï¼Œå› æ­¤ä¹Ÿåœ¨å­¦æœ¯ç•Œå’Œå·¥ä¸šç•Œè¢«å¹¿æ³›ç ”ç©¶å’Œåº”ç”¨ã€‚</em></p>
<p><em>ä¾æ®æ˜¯å¦è¦å¯¹é‡åŒ–åçš„å‚æ•°è¿›è¡Œè°ƒæ•´ï¼Œæˆ‘ä»¬å¯ä»¥å°†é‡åŒ–æ–¹æ³•åˆ†ä¸ºé‡åŒ–æ„ŸçŸ¥è®­ç»ƒï¼ˆQATï¼‰å’Œè®­ç»ƒåé‡åŒ–ï¼ˆPTQï¼‰ã€‚ è¿™ä¸¤ç§æ–¹æ³•çš„æ“ä½œåŒºåˆ«å¦‚ä¸‹å›¾æ‰€ç¤ºï¼ˆå›¾å·¦ä¸ºQATï¼Œå›¾å³ä¸ºPTQï¼‰ï¼š</em></p>
<blockquote>
<p><em>BPUæ¶æ„æ˜¯ç™¾åº¦å…¬å¸ç ”å‘çš„ä¸“é—¨ç”¨äºæ·±åº¦å­¦ä¹ æ¨ç†çš„ç¡¬ä»¶æ¶æ„ï¼Œå…¨åä¸ºâ€œBrain Processing Unitâ€ã€‚BPUé‡‡ç”¨å®šåˆ¶åŒ–çš„ç¡¬ä»¶è®¾è®¡å’Œç®—æ³•ä¼˜åŒ–ï¼Œèƒ½å¤Ÿåœ¨åº•å±‚å®ç°æ›´åŠ é«˜æ•ˆã€çµæ´»çš„æ·±åº¦ç¥ç»ç½‘ç»œçš„è®¡ç®—ã€‚ä¸ä¼ ç»Ÿçš„CPUã€GPUç›¸æ¯”ï¼ŒBPUåœ¨å¤„ç†æ·±åº¦å­¦ä¹ æ¨ç†æ—¶å…·æœ‰æ›´é«˜çš„æ€§èƒ½å’Œæ›´ä½çš„èƒ½è€—ã€‚</em></p>
<p><em>BPUçš„è®¾è®¡æ¶æ„å…·æœ‰ä¸‰ä¸ªé¢†åŸŸï¼šæ¨¡å‹è®­ç»ƒï¼ˆTrainingï¼‰ã€æ¨¡å‹è¯„ä¼°å’Œä¼˜åŒ–ï¼ˆOptimizationï¼‰ä»¥åŠæ¨¡å‹æ¨ç†ï¼ˆInferenceï¼‰ã€‚ä¸ä¼ ç»Ÿçš„GPUç­‰èŠ¯ç‰‡ç›¸æ¯”ï¼Œ<strong>BPUæ¶æ„åœ¨ä¼˜åŒ–æ·±åº¦å­¦ä¹ æ¨¡å‹è¿ç®—ã€æ§åˆ¶è®¾è®¡å’Œæ•°æ®ä¼ è¾“æ–¹é¢æ›´åŠ é«˜æ•ˆï¼Œå¯ä»¥å®ç°æ›´é«˜çš„è®¡ç®—æ€§èƒ½å’Œæ›´ä½çš„èƒ½è€—ã€‚</strong></em></p>
<p><em>BPUæ¶æ„ä¸»è¦ç”±ä¸¤ä¸ªéƒ¨åˆ†ç»„æˆï¼š<strong>è®¡ç®—èŠ¯ç‰‡å’Œè®¡ç®—æ¡†æ¶</strong>ã€‚è®¡ç®—èŠ¯ç‰‡ä½¿ç”¨å®šåˆ¶åŒ–çš„ç®—æ³•å’Œç¡¬ä»¶ä¼˜åŒ–ï¼Œå¯ä»¥é«˜æ•ˆåœ°å®ç°æ·±åº¦ç¥ç»ç½‘ç»œçš„è®¡ç®—ä»»åŠ¡ã€‚è®¡ç®—æ¡†æ¶åŒ…æ‹¬ä¸€ç³»åˆ—åŸºäºæ·±åº¦å­¦ä¹ æ¨ç†çš„è½¯ä»¶å¼€å‘å’Œä¼˜åŒ–å·¥å…·ï¼Œæ—¨åœ¨ä¼˜åŒ–æ¨¡å‹è®¡ç®—å’Œéƒ¨ç½²ã€‚</em></p>
</blockquote>
<p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230508153214469.png"
                      class="" title="image-20230508153214469"
                ></em></p>
<p><em>é‡åŒ–æ„ŸçŸ¥è®­ç»ƒQATæ˜¯å°†è®­ç»ƒè¿‡çš„æ¨¡å‹é‡åŒ–ååˆå†è¿›è¡Œé‡è®­ç»ƒã€‚<u>ç”±äºå®šç‚¹æ•°å€¼æ— æ³•ç”¨äºåå‘æ¢¯åº¦è®¡ç®—ï¼Œå®é™…æ“ä½œè¿‡ç¨‹æ˜¯åœ¨æŸäº›OPå‰æ’å…¥ä¼ªé‡åŒ–èŠ‚ç‚¹ï¼ˆfake quantization nodesï¼‰ï¼Œ ç”¨äºåœ¨è®­ç»ƒæ—¶è·å–æµç»è¯¥OPçš„æ•°æ®çš„æˆªæ–­å€¼ï¼Œä¾¿äºåœ¨éƒ¨ç½²é‡åŒ–æ¨¡å‹æ—¶å¯¹èŠ‚ç‚¹è¿›è¡Œé‡åŒ–æ—¶è¿›è¡Œä½¿ç”¨ã€‚</u>æˆ‘ä»¬éœ€è¦åœ¨è®­ç»ƒä¸­é€šè¿‡ä¸æ–­ä¼˜åŒ–ç²¾åº¦æ¥è·å–æœ€ä½³çš„é‡åŒ–å‚æ•°ã€‚ç”±äºå®ƒéœ€è¦å¯¹æ¨¡å‹è¿›è¡Œè®­ç»ƒï¼Œå› æ­¤å¯¹æ“ä½œäººå‘˜æŠ€æœ¯è¦æ±‚è¾ƒé«˜ã€‚ æœ‰å…³QATæ–¹æ¡ˆçš„è¯¦ç»†ä¿¡æ¯è¯·é˜…è¯» <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/plugin/source/index.html" >é‡åŒ–æ„ŸçŸ¥è®­ç»ƒï¼ˆQATï¼‰ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ç« èŠ‚å†…å®¹ã€‚</em></p>
<p><u>è®­ç»ƒåé‡åŒ–PTQæ˜¯ä½¿ç”¨ä¸€æ‰¹æ ¡å‡†æ•°æ®å¯¹è®­ç»ƒå¥½çš„æ¨¡å‹è¿›è¡Œæ ¡å‡†ï¼Œå°†è®­ç»ƒè¿‡çš„FP32æ¨¡å‹ç›´æ¥è½¬æ¢ä¸ºå®šç‚¹è®¡ç®—çš„æ¨¡å‹</u>ï¼Œè¿‡ç¨‹ä¸­æ— éœ€å¯¹åŸå§‹æ¨¡å‹è¿›è¡Œä»»ä½•è®­ç»ƒï¼Œåªéœ€è¦å¯¹å‡ ä¸ªè¶…å‚æ•°è¿›è¡Œè°ƒæ•´å°±å¯ä»¥å®Œæˆé‡åŒ–è¿‡ç¨‹ï¼Œ ä¸”è¿‡ç¨‹ç®€å•å¿«é€Ÿï¼Œæ— éœ€è®­ç»ƒï¼Œå› æ­¤è¯¥æ–¹æ³•å·²è¢«å¹¿æ³›åœ°åº”ç”¨äºå¤§é‡çš„ç«¯ä¾§å’Œäº‘ä¾§éƒ¨ç½²åœºæ™¯ã€‚æˆ‘ä»¬ä¼˜å…ˆæ¨èæ‚¨å°è¯•PTQæ–¹æ³•æ¥æŸ¥çœ‹æ˜¯å¦æ»¡è¶³æ‚¨çš„éƒ¨ç½²ç²¾åº¦å’Œæ€§èƒ½è¦æ±‚ã€‚ æœ‰å…³PTQæ–¹æ¡ˆçš„è¯¦ç»†ä¿¡æ¯è¯·é˜…è¯»è®­ç»ƒåé‡åŒ–ï¼ˆPTQï¼‰ç« èŠ‚å†…å®¹ã€‚</p>
<p><em>å·¥å…·é“¾ç”±PTQã€QATå’ŒåµŒå…¥å¼ç¼–è¯‘ç­‰éƒ¨åˆ†ç»„æˆï¼Œå·¥å…·é“¾ç»„æˆç¤ºæ„å›¾å¦‚ä¸‹ï¼š</em></p>
<p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230508153238553.png"
                      class="" title="image-20230508153238553"
                ></em></p>
<p><em>å…¶ä¸­ï¼š</em></p>
<p><em>Runtime SDK æä¾›äº†å¼‚æ„æ¨¡å‹çš„è¿è¡Œåº“æ”¯æŒï¼Œè¿è¡Œåº“åŒ…å«armå’Œx86(æš‚æœªæä¾›)ä¸¤ä¸ªéƒ¨åˆ†ï¼Œåˆ†åˆ«ç”¨äºåœ¨åœ°å¹³çº¿èŠ¯ç‰‡å¹³å°å’ŒX86ä»¿çœŸå¹³å°æ‰§è¡Œå¼‚æ„æ¨¡å‹ã€‚ æœ‰å…³åµŒå…¥å¼åº”ç”¨å¼€å‘è¯·é˜…è¯» <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/runtime/source/runtime_dev.html" >åµŒå…¥å¼åº”ç”¨å¼€å‘æŒ‡å¯¼ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ç« èŠ‚å†…å®¹ã€‚</em></p>
<p><em>æ­¤å¤–ï¼Œå·¥å…·é“¾æä¾›äº†ä¸°å¯Œçš„å¼€å‘å·¥å…·ã€ç¤ºä¾‹ä»¥åŠå†…ç½®äº†å¤§é‡ç®—æ³•æ¨¡å‹çš„æ¨¡å‹å‘å¸ƒç‰©å¸®åŠ©ç”¨æˆ·ä¸Šæ‰‹ç†è§£ï¼Œå¹¶å¯ä»¥æé«˜ç”¨æˆ·çš„å¼€å‘æ•ˆç‡ã€‚</em></p>
<p><em>å·¥å…·é“¾çš„æ•´ä½“ä½¿ç”¨æµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œåœ°å¹³çº¿æ¨èæ‚¨å…ˆå°è¯•PTQæ–¹å¼æ¥æŸ¥çœ‹æ˜¯å¦æ»¡è¶³æ‚¨çš„éƒ¨ç½²ç²¾åº¦å’Œæ€§èƒ½è¦æ±‚ã€‚</em></p>
<p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230508153303552.png"
                      class="" title="image-20230508153303552"
                ></em></p>
<h3 id="ç¯å¢ƒå®‰è£…"><a href="#ç¯å¢ƒå®‰è£…" class="headerlink" title="ç¯å¢ƒå®‰è£…"></a><em>ç¯å¢ƒå®‰è£…</em></h3><h4 id="ç¯å¢ƒéƒ¨ç½²"><a href="#ç¯å¢ƒéƒ¨ç½²" class="headerlink" title="ç¯å¢ƒéƒ¨ç½²"></a><em>ç¯å¢ƒéƒ¨ç½²</em></h4><blockquote>
<p><em>å‰è¨€</em></p>
</blockquote>
<p><em>åœ°å¹³çº¿OpenExplorerç›®å‰åŒæ—¶æä¾›äº†2å¥—æ¨¡å‹é‡åŒ–æ–¹æ¡ˆï¼š</em></p>
<ul>
<li><em>PTQï¼šPost-training Quantizationï¼Œè®­ç»ƒåé‡åŒ–ã€‚</em></li>
<li><em>QATï¼šQuantization aware trainingï¼Œé‡åŒ–æ„ŸçŸ¥è®­ç»ƒï¼ˆæš‚æ—¶åªæ”¯æŒPytorchæ¡†æ¶ï¼‰ã€‚</em></li>
</ul>
<p><em>å…¶ä¸­ï¼šä¸¤å¥—æ–¹æ¡ˆå‡ä¸å¹²æ¶‰æµ®ç‚¹æ¨¡å‹çš„è®­ç»ƒé˜¶æ®µï¼Œæ‚¨éœ€è¦è‡ªè¡Œè´Ÿè´£ã€‚åœ°å¹³çº¿ä¹Ÿåœ¨ä»¥ä¸‹è·¯å¾„å¼€æºäº†ä¸€äº›åˆ†ç±»&#x2F;æ£€æµ‹&#x2F;åˆ†å‰²ç­‰åœºæ™¯ é«˜æ•ˆæ¨¡å‹çš„å…¬ç‰ˆPytorchå®ç°ä»¥ä¾›å‚è€ƒï¼Œå¹¶æ”¯æŒåœ¨å®¿ä¸»æœºä¸Šè¿›è¡Œè®­ç»ƒå’Œå¤ç°ã€‚</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ddk/samples/ai_toolchain/horizon_model_train_sample</span><br></pre></td></tr></table></figure></div>

<ul>
<li><em>å¯¹äºPTQæ–¹æ¡ˆï¼Œæ‚¨éœ€è¦åœ¨å®¿ä¸»æœºçš„å¼€å‘ç¯å¢ƒå®Œæˆæ¨¡å‹çš„é‡åŒ–è½¬æ¢ï¼Œå†å°†ç¼–è¯‘ç”Ÿæˆçš„ <code>.bin</code> æ¨¡å‹æ‹·è´è‡³å¼€å‘æ¿ç¯å¢ƒ å®Œæˆåç»­çš„éƒ¨ç½²å·¥ä½œã€‚</em></li>
<li><em>å¯¹äºQATæ–¹æ¡ˆï¼Œæ‚¨åˆ™éœ€è¦åœ¨å®¿ä¸»æœºçš„å¼€å‘ç¯å¢ƒå…ˆå®Œæˆæ¨¡å‹çš„QATè®­ç»ƒï¼Œå†è¿›è¡Œé‡åŒ–è½¬æ¢ï¼Œå†å°†ç¼–è¯‘ç”Ÿæˆçš„ <code>.bin</code> æ¨¡å‹ æ‹·è´è‡³å¼€å‘æ¿ç¯å¢ƒå®Œæˆåç»­çš„éƒ¨ç½²å·¥ä½œã€‚</em></li>
</ul>
<p><em>ä¸¤ç§é‡åŒ–æ–¹æ¡ˆä»¥åŠé«˜æ•ˆæ¨¡å‹çš„å¼€å‘ç¯å¢ƒï¼Œåœ°å¹³çº¿éƒ½æä¾›äº†æœ¬åœ°æ‰‹åŠ¨å®‰è£…å’ŒDockerå®¹å™¨ä¸¤ç§æ–¹å¼ã€‚æˆ‘ä»¬ä¼˜å…ˆæ¨èä½¿ç”¨ ä¸æ±¡æŸ“æœ¬åœ°ç¯å¢ƒï¼Œä¸”ä½¿ç”¨æ–¹ä¾¿çš„Dockerå®¹å™¨ï¼Œä»¥ä¸‹ä¹Ÿå°†åˆ†åˆ«è¿›è¡Œä»‹ç»ã€‚</em></p>
<blockquote>
<p><em>å¼€å‘ç¯å¢ƒéƒ¨ç½²</em></p>
</blockquote>
<p><em><strong>å¼€å‘æœºå‡†å¤‡</strong></em></p>
<p><em>å¼€å‘æœºåº”æ»¡è¶³ä»¥ä¸‹è¦æ±‚ï¼š</em></p>
<p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230508160041194.png"
                      class="" title="image-20230508160041194"
                ></em></p>
<p><em>æ­¤å¤–ï¼ŒåµŒå…¥å¼å¼€å‘éœ€è¦å®‰è£…äº¤å‰ç¼–è¯‘å·¥å…·ï¼ˆ <code>gcc-ubuntu-9.3.0-2020.03-x86_64-aarch64-linux-gnu.tar.xz</code> ï¼‰ï¼Œè¯·ä» <code>ddk/package/host</code> ç›®å½•ä¸‹é€šè¿‡æ‰§è¡Œ <code>resolve.sh</code> è¿›è¡Œè·å–ï¼Œå¹¶å°†å…¶è§£å‹ åˆ°å¼€å‘æœºçš„ <code>/opt</code> ç›®å½•ä¸‹ï¼ˆ <strong>ä½¿ç”¨ Docker å¯è·³è¿‡æ­¤æ­¥éª¤</strong> ï¼‰ã€‚</em></p>
<p><em>è§£å‹å‘½ä»¤ä¸ºï¼š</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar xvf gcc-ubuntu-9.3.0-2020.03-x86_64-aarch64-linux-gnu.tar.xz</span><br></pre></td></tr></table></figure></div>

<p><em>å¦å¤–æ‚¨éœ€è¦åœ¨ç¯å¢ƒä¸­æ–°å¢ä¸€ä¸ªå˜é‡ <code>LINARO_GCC_ROOT</code>ï¼Œå€¼ä¸ºäº¤å‰ç¼–è¯‘å™¨çš„å®Œæ•´è·¯å¾„ï¼Œå‚è€ƒå¦‚ä¸‹ï¼š</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export LINARO_GCC_ROOT=/opt/gcc-ubuntu-9.3.0-2020.03-x86_64-aarch64-linux-gnu</span><br></pre></td></tr></table></figure></div>

<p><em><strong>æ³¨æ„ï¼šç¯å¢ƒå˜é‡ <code>LINARO_GCC_ROOT</code> çš„è®¾ç½®è·¯å¾„éœ€è¦ä¸äº¤å‰ç¼–è¯‘å·¥å…·è§£å‹çš„ç›®å½•ç›¸åŒï¼Œå¦åˆ™ä¼šå¯¼è‡´å¤±è´¥ã€‚</strong></em></p>
<p><em>å¯¹äºhostç«¯ï¼ˆx86ï¼‰ä¾èµ–çš„åº“ï¼Œæ¯”å¦‚isl,gmp,mpc,mpfrç­‰ï¼Œåœ¨lib&#x2F;x86_64-linux-gnuä¸‹ï¼Œå¦‚æœç¼–è¯‘æŠ¥é”™ï¼Œ è¯·åœ¨ç¼–è¯‘å·¥ç¨‹ä¸­é€šè¿‡LD_LIBRARY_PATHæ¥æŒ‡å®šã€‚</em></p>
<p><em>å¦‚æœç¼–è¯‘è¿‡ç¨‹ä¸­å‡ºç°glibcåº“ç‰ˆæœ¬å†²çªçš„é—®é¢˜ï¼Œä¾‹å¦‚ï¼šxxx@GLIBC_xxxçš„æœªå®šä¹‰ç¬¦å·çš„é”™è¯¯ï¼Œ è¯·åœ¨ç¼–è¯‘å·¥ç¨‹ä¸­é€šè¿‡-rpath-linkæ¥æŒ‡å®šåˆ°å·¥å…·é“¾çš„aarch64-linux-gnu&#x2F;libè·¯å¾„ä¸‹, åŒæ—¶åœ¨ç¼–è¯‘å·¥ç¨‹ä¸­åŠ ä¸Š-lxxx, ä¾‹å¦‚ï¼š-lpthreadã€‚</em></p>
<p><em>å¦å¤–éœ€è¦ç‰¹åˆ«æ³¨æ„çš„æ˜¯ä¸‹å›¾æ¡†èµ·æ¥çš„è®°å½•æºæ–‡ä»¶çš„å˜é‡SRCSï¼Œæœ€å¥½æ”¾åœ¨${LIBS}é“¾æ¥åº“çš„å‰é¢ï¼Œå¦åˆ™å¯èƒ½ä¹Ÿä¼šæŠ¥æœªå®šä¹‰çš„ç¬¦å·ã€‚</em></p>
<p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230508162216452.png"
                      class="" title="image-20230508162216452"
                ></em></p>
<blockquote>
<p><em><strong>LINARO_GCC_ROOTç¯å¢ƒå˜é‡æ˜¯æŒ‡ç”¨äºæŒ‡å®šäº¤å‰ç¼–è¯‘å™¨GCCçš„è·¯å¾„çš„ç¯å¢ƒå˜é‡ã€‚</strong>å®ƒé€šå¸¸ç”¨äºåœ¨Linuxæ“ä½œç³»ç»Ÿä¸‹è¿›è¡Œäº¤å‰ç¼–è¯‘ï¼Œä»¥ä¾¿ç”Ÿæˆèƒ½å¤Ÿåœ¨ä¸åŒçš„å¤„ç†å™¨ä½“ç³»ç»“æ„ä¸‹è¿è¡Œçš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚</em></p>
</blockquote>
<blockquote>
<p><strong>LD_LIBRARY_PATHç¯å¢ƒå˜é‡æ˜¯ä¸€ä¸ªç”¨äºæŒ‡å®šåŠ¨æ€é“¾æ¥åº“æœç´¢è·¯å¾„çš„ç¯å¢ƒå˜é‡ã€‚</strong>åœ¨Linuxç³»ç»Ÿä¸­ï¼ŒåŠ¨æ€é“¾æ¥åº“æ˜¯åœ¨è¿è¡Œæ—¶åŠ è½½çš„å…±äº«åº“ï¼Œå®ƒä»¬æä¾›äº†ä¸€äº›å¯å¤ç”¨çš„å‡½æ•°å’Œèµ„æºï¼Œç”¨äºè¢«ä¸åŒçš„ç¨‹åºå…±äº«ã€‚è€ŒLD_LIBRARY_PATHç¯å¢ƒå˜é‡åˆ™ç”¨äºæŒ‡å®šåŠ¨æ€é“¾æ¥åº“çš„æœç´¢è·¯å¾„ã€‚</p>
<p><em>å½“ä¸€ä¸ªç¨‹åºéœ€è¦åŠ è½½ä¸€ä¸ªå…±äº«åº“æ—¶ï¼ŒLinuxç³»ç»Ÿä¼šé¦–å…ˆæœç´¢é»˜è®¤è·¯å¾„ï¼ˆä¾‹å¦‚&#x2F;usr&#x2F;libã€&#x2F;usr&#x2F;local&#x2F;libç­‰ï¼‰ï¼Œå¦‚æœéœ€è¦çš„å…±äº«åº“æ²¡æœ‰åœ¨é»˜è®¤è·¯å¾„ä¸­æ‰¾åˆ°ï¼Œå°±ä¼šå»LD_LIBRARY_PATHç¯å¢ƒå˜é‡æ‰€æŒ‡å®šçš„è·¯å¾„ä¸­å¯»æ‰¾ã€‚å› æ­¤ï¼Œè®¾ç½®LD_LIBRARY_PATHç¯å¢ƒå˜é‡å¯ä»¥å¸®åŠ©åœ¨ç¨‹åºåŠ è½½å…±äº«åº“æ—¶æ‰¾åˆ°æ­£ç¡®çš„è·¯å¾„ï¼Œé¿å…å› ä¸ºç¼ºå°‘åŠ¨æ€åº“å¯¼è‡´ç¨‹åºè¿è¡Œå¤±è´¥ã€‚</em></p>
</blockquote>
<blockquote>
<p><em>Dockerå®¹å™¨éƒ¨ç½²</em></p>
</blockquote>
<p><strong>DockeråŸºç¡€ç¯å¢ƒ</strong></p>
<p><em>åœ°å¹³çº¿è¦æ±‚çš„DockeråŸºç¡€ç¯å¢ƒå¦‚ä¸‹ï¼Œè¯·æå‰åœ¨æ‚¨çš„å®¿ä¸»æœºä¸Šå®Œæˆå®‰è£…ï¼š</em></p>
<ul>
<li><em>Dockerï¼ˆ&gt;&#x3D;1.12 å»ºè®®å®‰è£…18.03.0-ceï¼‰ï¼Œè¯¦è§ <a class="link"   target="_blank" rel="noopener" href="https://docs.docker.com/install/" >Dockerå®‰è£…æ‰‹å†Œ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ã€‚</em></li>
<li><em>NVIDIA Dockerï¼ˆ2.0.3ï¼‰ï¼Œè¯¦è§ <a class="link"   target="_blank" rel="noopener" href="https://github.com/nvidia/nvidia-docker/wiki" >NVIDIA Dockerå®‰è£…æ‰‹å†Œ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ã€‚</em></li>
</ul>
<blockquote>
<p>Nvidia Dockeræ˜¯ä¸€ä¸ªç”¨äºåœ¨GPUåŠ é€Ÿçš„ç¯å¢ƒä¸­è¿è¡ŒDockerå®¹å™¨çš„å·¥å…·ï¼Œå®ƒæ˜¯åŸºäºDockerçš„ä¸€ä¸ªæ‰©å±•ã€‚å®ƒçš„ä¸»è¦ç›®çš„æ˜¯ç®€åŒ–åœ¨ä½¿ç”¨NVIDIA GPUçš„ç³»ç»Ÿä¸­è¿è¡Œå®¹å™¨çš„è¿‡ç¨‹ï¼Œå¹¶æä¾›äº†é’ˆå¯¹GPUåŠ é€Ÿçš„å®¹å™¨åŒ–åº”ç”¨çš„ä¼˜åŒ–å’Œæ”¯æŒã€‚<code>dpkg -l | grep nvidia-docker</code>æŸ¥çœ‹nvidia-dockerç‰ˆæœ¬</p>
</blockquote>
<p><em>å®ŒæˆDockeråŸºç¡€ç¯å¢ƒå®‰è£…åï¼Œè¿˜éœ€è¦å°†æ— rootæƒé™çš„ç”¨æˆ·æ·»åŠ åˆ°Dockerç”¨æˆ·ç»„ä¸­ã€‚å‚è€ƒå‘½ä»¤å¦‚ä¸‹ï¼š</em></p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sudo groupadd docker				<span class="comment">#æ·»åŠ dockerç”¨æˆ·ç»„</span></span><br><span class="line">sudo gpasswd -a <span class="variable">$&#123;USER&#125;</span> docker		<span class="comment">#ç”¨æˆ·åŠ å…¥dockerç»„</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#ä¿®æ”¹dockerç»„æƒé™ä¸ºrootæƒé™åœ¨è¯¥è¡Œçš„ä¸‹æ–¹æ·»åŠ ä¸€è¡Œ</span></span><br><span class="line">sudo visudo				<span class="comment">#åœ¨sudoersæ–‡ä»¶ä¸­æ‰¾åˆ°%sudo   ALL=(ALL:ALL) ALLï¼Œåœ¨è¯¥è¡Œçš„ä¸‹æ–¹æ·»åŠ ä¸€è¡Œï¼š%&lt;group_name&gt;   ALL=(ALL:ALL) ALL</span></span><br><span class="line"></span><br><span class="line">sudo service docker restart</span><br></pre></td></tr></table></figure></div>



<p><em><strong>Dockeré•œåƒä½¿ç”¨</strong></em></p>
<p><em>ä¸ºäº†å¸®åŠ©ç”¨æˆ·å¿«é€Ÿä½¿ç”¨å·¥å…·é“¾ï¼Œåœ°å¹³çº¿æä¾›äº†åŒ…å«å®Œæ•´å¼€å‘ç¯å¢ƒçš„Dockeré•œåƒï¼Œå¤§å¤§ç®€åŒ–äº†å¼€å‘ç¯å¢ƒçš„éƒ¨ç½²è¿‡ç¨‹ã€‚</em></p>
<p><em>æ‚¨å¯ä»¥åœ¨OEåŒ…çš„ä¸€çº§ç›®å½•ä¸‹ç›´æ¥è¿è¡Œä»¥ä¸‹è„šæœ¬å¯åŠ¨å½“å‰OEç‰ˆæœ¬æ‰€å¯¹åº”çš„Dockerå®¹å™¨ï¼ˆå¦‚æœä¸ºé¦–æ¬¡å¯åŠ¨ï¼Œåˆ™è„šæœ¬ä¼šè‡ªåŠ¨æ‹‰å–é•œåƒï¼‰ï¼š</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sh run_docker.sh data/</span><br></pre></td></tr></table></figure></div>

<p><em><strong>å…¶ä¸­ï¼Œ <code>data</code> ä¸ºè¯„æµ‹æ•°æ®é›†æ–‡ä»¶å¤¹è·¯å¾„ï¼Œè¯·æå‰åˆ›å»ºå¥½åå†è¿è¡Œå‘½ä»¤ï¼Œå¦åˆ™å°†å¯¼è‡´åŠ è½½é—®é¢˜ã€‚</strong></em></p>
<blockquote>
<p>åœ¨å¤§å¤šæ•°Linuxç³»ç»Ÿä¸­ï¼Œ<code>bash</code>å’Œ<code>sh</code>æ˜¯ä¸¤ä¸ªä¸åŒçš„Shellè§£é‡Šå™¨ã€‚</p>
<p><code>bash</code>æ˜¯Bourne Again Shellçš„ç¼©å†™ï¼Œå®ƒæ˜¯Unixå’ŒLinuxç³»ç»Ÿä¸­æœ€å¸¸ç”¨çš„Shellã€‚å®ƒæä¾›äº†æ›´å¤šçš„åŠŸèƒ½å’Œæ‰©å±•æ€§ï¼ŒåŒ…æ‹¬å‘½ä»¤è¡¥å…¨ã€å‘½ä»¤å†å²è®°å½•ã€æ¡ä»¶è¯­å¥ã€å¾ªç¯ç»“æ„ç­‰ã€‚**<code>bash</code>æ˜¯<code>sh</code>çš„æ‰©å±•ç‰ˆæœ¬**ï¼Œå‘åå…¼å®¹Bourne Shellï¼ˆshï¼‰ã€‚</p>
<p><code>echo $0</code>å¯ä»¥åŒºåˆ†å½“å‰è§£æå™¨æ˜¯<code>bash</code>è¿˜æ˜¯<code>sh</code></p>
</blockquote>
<p><em>è‹¥æ‚¨æƒ³è¦ä½¿ç”¨ CPU ç‰ˆæœ¬ Docker é•œåƒåˆ™éœ€è¦å¢åŠ  <code>cpu</code> å‚æ•°ï¼š</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sh run_docker.sh data/ cpu</span><br></pre></td></tr></table></figure></div>

<p><em>OEåŒ…ç¤ºä¾‹æ‰€ä¾èµ–çš„ç›¸å…³å…¬å¼€è¯„æµ‹æ•°æ®é›†çš„ä¸‹è½½é“¾æ¥ä¸ºï¼š</em></p>
<table>
<thead>
<tr>
<th align="left"><em><strong>æ•°æ®é›†</strong></em></th>
<th align="left"><em><strong>ä¸‹è½½åœ°å€</strong></em></th>
<th align="left"><em><strong>ä¸‹è½½ç»“æ„</strong></em></th>
</tr>
</thead>
<tbody><tr>
<td align="left"><em>ImageNet</em></td>
<td align="left"><em><a class="link"   target="_blank" rel="noopener" href="https://www.image-net.org/download.php" >https://www.image-net.org/download.php <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></em></td>
<td align="left"><em>ä¸‹è½½ç»“æ„è¯·æ‚¨å‚è€ƒ <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/ptq/ptq_sample/algorithm_sample.html#imagenet-prepare" >ImageNetæ•°æ®é›†å‚è€ƒç»“æ„ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></em></td>
</tr>
<tr>
<td align="left"><em>COCO</em></td>
<td align="left"><em><a class="link"   target="_blank" rel="noopener" href="https://cocodataset.org/" >https://cocodataset.org/ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></em></td>
<td align="left"><em>ä¸‹è½½ç»“æ„è¯·æ‚¨å‚è€ƒ <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/ptq/ptq_sample/algorithm_sample.html#coco-prepare" >COCOæ•°æ®é›†å‚è€ƒç»“æ„ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></em></td>
</tr>
<tr>
<td align="left"><em>VOC</em></td>
<td align="left"><em><a class="link"   target="_blank" rel="noopener" href="http://host.robots.ox.ac.uk/pascal/VOC/" >http://host.robots.ox.ac.uk/pascal/VOC/ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></em></td>
<td align="left"><em>éœ€è¦ä¸‹è½½2007å’Œ2012ä¸¤ä¸ªç‰ˆæœ¬ï¼Œä¸‹è½½ç»“æ„è¯·æ‚¨å‚è€ƒ <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/ptq/ptq_sample/algorithm_sample.html#voc-prepare" >VOCæ•°æ®é›†å‚è€ƒç»“æ„ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></em></td>
</tr>
<tr>
<td align="left"><em>Cityscapes</em></td>
<td align="left"><em><a class="link"   target="_blank" rel="noopener" href="https://github.com/mcordts/cityscapesScripts" >https://github.com/mcordts/cityscapesScripts <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></em></td>
<td align="left"><em>ä¸‹è½½ç»“æ„è¯·æ‚¨å‚è€ƒ <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/ptq/ptq_sample/algorithm_sample.html#cityscapes-prepare" >Cityscapesæ•°æ®é›†å‚è€ƒç»“æ„ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></em></td>
</tr>
<tr>
<td align="left"><em>CIFAR-10</em></td>
<td align="left"><em><a class="link"   target="_blank" rel="noopener" href="http://www.cs.toronto.edu/~kriz/cifar.html" >http://www.cs.toronto.edu/~kriz/cifar.html <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></em></td>
<td align="left"><em>ä¸‹è½½ç»“æ„è¯·æ‚¨å‚è€ƒ <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/ptq/ptq_sample/algorithm_sample.html#cifar-prepare" >CIFAR-10æ•°æ®é›†å‚è€ƒç»“æ„ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></em></td>
</tr>
<tr>
<td align="left"><em>FlyingChairs</em></td>
<td align="left"><em><a class="link"   target="_blank" rel="noopener" href="https://lmb.informatik.uni-freiburg.de/resources/datasets/FlyingChairs.en.html" >https://lmb.informatik.uni-freiburg.de/resources/datasets/FlyingChairs.en.html <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></em></td>
<td align="left"><em>ä¸‹è½½ç»“æ„è¯·æ‚¨å‚è€ƒ <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/runtime/source/ai_benchmark/source/ai-benchmark.html#qat-dataset-prepare" >QATæ¨¡å‹æ•°æ®é¢„å¤„ç† <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ä¸­çš„ç›¸å…³æè¿°</em></td>
</tr>
<tr>
<td align="left"><em>KITTI3D</em></td>
<td align="left"><em><a class="link"   target="_blank" rel="noopener" href="https://www.cvlibs.net/datasets/kitti/eval_object.php?obj_benchmark=3d" >https://www.cvlibs.net/datasets/kitti/eval_object.php?obj_benchmark=3d <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></em></td>
<td align="left"><em>ä¸‹è½½ç»“æ„è¯·æ‚¨å‚è€ƒ <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/runtime/source/ai_benchmark/source/ai-benchmark.html#qat-dataset-prepare" >QATæ¨¡å‹æ•°æ®é¢„å¤„ç† <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ä¸­çš„ç›¸å…³æè¿°</em></td>
</tr>
<tr>
<td align="left"><em>CULane</em></td>
<td align="left"><em><a class="link"   target="_blank" rel="noopener" href="https://xingangpan.github.io/projects/CULane.html" >https://xingangpan.github.io/projects/CULane.html <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></em></td>
<td align="left"><em>ä¸‹è½½ç»“æ„è¯·æ‚¨å‚è€ƒ <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/runtime/source/ai_benchmark/source/ai-benchmark.html#qat-dataset-prepare" >QATæ¨¡å‹æ•°æ®é¢„å¤„ç† <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ä¸­çš„ç›¸å…³æè¿°</em></td>
</tr>
<tr>
<td align="left"><em>nuScenes</em></td>
<td align="left"><em><a class="link"   target="_blank" rel="noopener" href="https://www.nuscenes.org/nuscenes" >https://www.nuscenes.org/nuscenes <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></em></td>
<td align="left"><em>ä¸‹è½½ç»“æ„è¯·æ‚¨å‚è€ƒ <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/runtime/source/ai_benchmark/source/ai-benchmark.html#qat-dataset-prepare" >QATæ¨¡å‹æ•°æ®é¢„å¤„ç† <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ä¸­çš„ç›¸å…³æè¿°</em></td>
</tr>
</tbody></table>
<p><em>å¦‚æœæ‚¨å¸Œæœ›æ‰‹åŠ¨å¯åŠ¨Dockerå®¹å™¨ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤æ‹‰å–å¯¹åº”çš„Dockeré•œåƒï¼Œå…¶ä¸­{version}ä¸ºæ‚¨å½“å‰æ‰€ç”¨çš„OEç‰ˆæœ¬å·ã€‚</em></p>
<p><em><strong>æ³¨æ„ï¼šä¸ºæ–¹ä¾¿ä½¿ç”¨ï¼Œæˆ‘ä»¬ä¸ºæ‚¨æä¾›äº†ä¸¤ç§CPU Dockerä»¥åŠGPU Dockerï¼Œå¯æŒ‰éœ€é€‰æ‹©ã€‚</strong></em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># CPU Docker</span><br><span class="line">docker pull openexplorer/ai_toolchain_ubuntu_20_j5_cpu:&#123;version&#125;</span><br><span class="line"># GPU Docker</span><br><span class="line">docker pull openexplorer/ai_toolchain_ubuntu_20_j5_gpu:&#123;version&#125;</span><br></pre></td></tr></table></figure></div>

<p><em>æˆåŠŸè¿›å…¥Dockerå®¹å™¨åï¼Œ æ‚¨å¯ä»¥é”®å…¥ <code>ddk_vcs list</code> å‘½ä»¤æŸ¥çœ‹å½“å‰ç‰ˆæœ¬æ˜¯å¦ä¸ºæ‚¨çš„é¢„æœŸç‰ˆæœ¬ã€‚</em></p>
<blockquote>
<p><em>æœ¬åœ°æ‰‹åŠ¨å®‰è£…</em></p>
</blockquote>
<p><em>æœ¬èŠ‚å°†åˆ†åˆ«ä»‹ç»ä¸¤ç§é‡åŒ–æ–¹æ¡ˆå’Œåœ°å¹³çº¿å¼€æºçš„é«˜æ•ˆæ¨¡å‹è®­ç»ƒæ‰€ä¾èµ–çš„ç¯å¢ƒéƒ¨ç½²æ–¹æ³•ã€‚æˆ‘ä»¬æ¨èæ‚¨åœ¨æµ®ç‚¹æ¨¡å‹è®­ç»ƒå®Œæˆåä¼˜å…ˆ é€‰æ‹©ç®€å•æ˜“ç”¨çš„PTQé‡åŒ–æ–¹æ¡ˆï¼Œåªåœ¨ç²¾åº¦é—®é¢˜ç¡®å®æ— æ³•è§£å†³æ—¶å†åˆ‡æ¢åˆ°QATé‡åŒ–æ–¹æ¡ˆã€‚</em></p>
<p><em><strong>PTQé‡åŒ–ç¯å¢ƒéƒ¨ç½²</strong></em></p>
<p><em>PTQé‡åŒ–æ–¹æ¡ˆå¯¹äºå¼€å‘æœºæ“ä½œç¯å¢ƒçš„åŸºç¡€è½¯ä»¶ä¾èµ–å¦‚ä¸‹ï¼š</em></p>
<ul>
<li><em>æ“ä½œç³»ç»Ÿï¼šUbuntu20.04</em></li>
<li><em>Python3.8</em></li>
<li><em>libpython3.8</em></li>
<li><em>python3-devel</em></li>
<li><em>python3-pip</em></li>
<li><em>gcc&amp;c++: 5.4.0</em></li>
<li><em>graphviz</em></li>
</ul>
<blockquote>
<p><strong><code>libpython3.8</code> æ˜¯æŒ‡ Python 3.8 ç‰ˆæœ¬çš„å…±äº«åº“ï¼ˆåŠ¨æ€é“¾æ¥åº“ï¼‰æ–‡ä»¶</strong>ã€‚å…±äº«åº“åŒ…å«äº† Python è§£é‡Šå™¨çš„æ ¸å¿ƒåŠŸèƒ½å’Œæ¨¡å—ï¼Œå¯ä»¥è¢«å…¶ä»–ç¨‹åºåŠ¨æ€é“¾æ¥å’Œä½¿ç”¨ã€‚å®ƒä»¬æä¾›äº†å¯¹ Python 3.8 ç‰ˆæœ¬çš„æ ‡å‡†åº“å’Œæ‰©å±•åº“çš„è®¿é—®ã€‚<strong>é€šè¿‡ä½¿ç”¨ <code>libpython3.8</code>ï¼Œå…¶ä»–ç¨‹åºå¯ä»¥è°ƒç”¨å’Œæ‰§è¡Œ Python 3.8 çš„ä»£ç ï¼Œå¹¶ä¸ Python ç¯å¢ƒè¿›è¡Œäº¤äº’ã€‚</strong></p>
</blockquote>
<blockquote>
<p><strong><code>python3-devel</code> æ˜¯æŒ‡é’ˆå¯¹ Python 3 çš„å¼€å‘å·¥å…·åŒ…æˆ–å¼€å‘ç¯å¢ƒã€‚</strong>å®ƒåŒ…å«äº†ç¼–è¯‘å’Œæ„å»º Python 3 æ‰©å±•æ¨¡å—æ‰€éœ€çš„å¤´æ–‡ä»¶ã€åº“æ–‡ä»¶å’Œå…¶ä»–å¼€å‘å·¥å…·ã€‚</p>
<p>å®‰è£… <code>python3-devel</code> åŒ…å¯ä»¥æä¾›ä½ åœ¨å¼€å‘ Python 3 åº”ç”¨ç¨‹åºæˆ–æ‰©å±•æ—¶æ‰€éœ€çš„æ„å»ºå’Œè°ƒè¯•å·¥å…·ã€‚å®ƒåŒ…å«äº†å¿…è¦çš„å¤´æ–‡ä»¶å’Œåº“æ–‡ä»¶ï¼Œä½¿ä½ èƒ½å¤Ÿç¼–è¯‘å’Œé“¾æ¥ Python 3 çš„æ‰©å±•æ¨¡å—ï¼Œä»¥åŠå…¶ä»–å¼€å‘å·¥å…·ï¼Œä¾‹å¦‚è°ƒè¯•å™¨å’Œæ€§èƒ½åˆ†æå·¥å…·ã€‚</p>
</blockquote>
<blockquote>
<p>Graphvizæ˜¯ä¸€ä¸ªå¼€æºçš„å›¾å½¢å¯è§†åŒ–å·¥å…·ï¼Œç”¨äºç»˜åˆ¶å›¾å½¢å’Œå›¾è¡¨ã€‚å®ƒæä¾›äº†ä¸€ç»„ç”¨äºåˆ›å»ºå’Œæ’åˆ—å›¾å½¢å…ƒç´ çš„å‘½ä»¤è¡Œå·¥å…·å’Œåº“ã€‚Graphvizæ”¯æŒå¤šç§å›¾å½¢ç±»å‹ï¼ŒåŒ…æ‹¬æœ‰å‘å›¾ã€æ— å‘å›¾ã€æµç¨‹å›¾ã€ç»„ç»‡ç»“æ„å›¾ç­‰ã€‚</p>
</blockquote>
<p><em>åœ¨ç¡®è®¤æ»¡è¶³ä»¥ä¸Šæ¡ä»¶åï¼Œå³å¯è¿›è¡ŒAIå·¥å…·å®‰è£…ã€‚å› ä¸ºå…¶ä¸­åŒ…å«ä¸€ç³»åˆ—å†…éƒ¨å·¥å…·ï¼Œæ‰€ä»¥OEåŒ…æä¾›äº†è„šæœ¬æ–‡ä»¶ æ¥æ‰“åŒ…æ‰€æœ‰çš„å®‰è£…è¿‡ç¨‹ä»¥ç®€åŒ–æµç¨‹ï¼Œå¯å‚è€ƒä»¥ä¸‹å‘½ä»¤æ‰§è¡Œï¼š</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd ddk/package/host/ai_toolchain</span><br><span class="line">bash install_ai_toolchain.sh</span><br></pre></td></tr></table></figure></div>

<p><em>å®‰è£…è„šæœ¬ä¼šè‡ªåŠ¨æ£€æŸ¥ç›¸åº”çš„ç¯å¢ƒï¼Œç¼ºå°‘ç›¸åº”ä¾èµ–æˆ–é…ç½®ä¼šä¸­æ–­å®‰è£…è¿‡ç¨‹ï¼Œå¹¶ç»™å‡ºä¿®æ­£å»ºè®®å¦‚ä¸‹å›¾ã€‚</em></p>
<p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230508163604194.png"
                      class="" title="image-20230508163604194"
                ></em></p>
<p><em>æ ¹æ®å»ºè®®è¡¥å……ä¾èµ–åï¼Œé‡æ–°æ‰§è¡Œinstallè„šæœ¬å³å¯ã€‚</em></p>
<p><em><strong>æ³¨æ„ï¼šå¦‚æœä¿®æ­£å»ºè®®æŒ‡å‡ºæ˜¯gcc&#x2F;g++ç‰ˆæœ¬ä¸ç¬¦åˆè¦æ±‚ï¼Œåœ¨å®‰è£…å®ŒæŒ‡å®šç‰ˆæœ¬ä¹‹åï¼Œæ‚¨éœ€è¦é‡æ–°å»ºç«‹gccå’Œg++è½¯é“¾æ¥ä¸ºgcc-5.4.0å’Œg++-5.4.0ã€‚</strong></em></p>
<p><em>åœ¨é¡ºåˆ©å®Œæˆinstallè„šæœ¬åï¼Œæ‚¨å¯ä»¥é”®å…¥ <code>ddk_vcs list</code> å‘½ä»¤éªŒè¯ä¸‹æ‚¨æ‰€éœ€çš„å·¥å…·å’Œä¾èµ–æ˜¯å¦è¢«æ­£ç¡®å®‰è£…ã€‚</em></p>
<blockquote>
<p><em>QATé‡åŒ–ç¯å¢ƒéƒ¨ç½²</em></p>
</blockquote>
<p><em>QATé‡åŒ–ç¯å¢ƒåœ¨æœ¬åœ°ç¯å¢ƒè¿›è¡Œå®‰è£…ï¼Œéœ€è¦å…ˆç¡®ä¿å·²æ»¡è¶³ä»¥ä¸‹åŸºç¡€ç¯å¢ƒæ¡ä»¶ã€‚ é‡åŒ–è®­ç»ƒå·¥å…·èƒ½å¤Ÿè®­ç»ƒèµ·æ¥æ‰€å¿…éœ€çš„ç¯å¢ƒä¾èµ–å¦‚ä¸‹è¡¨ï¼š</em></p>
<p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230508163753480.png"
                      class="" title="image-20230508163753480"
                ></em></p>
<p><em>åœ¨å®ŒæˆQATæ¨¡å‹çš„è®­ç»ƒåï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©ä»¥ä¸‹ä¸¤ç§è·¯å¾„å®Œæˆåç»­çš„æ¨¡å‹è½¬æ¢å·¥ä½œï¼š</em></p>
<p><u><em>è·¯å¾„1ï¼šå…ˆå¯¼å‡ºonnxæ¨¡å‹ï¼Œå†åŸºäºPTQï¼ˆPost Training Quantizationï¼Œè®­ç»ƒåé‡åŒ–ï¼‰è·¯çº¿é€šè¿‡yamlæ–‡ä»¶å®Œæˆæ¨¡å‹è½¬æ¢ã€‚</em></u></p>
<p><em>è·¯å¾„2ï¼šåœ¨å½“å‰è®­ç»ƒç¯å¢ƒå®‰è£…ç›¸å…³å·¥å…·åŒ…ï¼Œå¹¶ç›´æ¥é€šè¿‡æ¥å£è°ƒç”¨çš„æ–¹å¼å®Œæˆæ¨¡å‹è½¬æ¢ã€‚</em></p>
<p><em>å¯¹äºè·¯å¾„1ï¼Œæˆ‘ä»¬å»ºè®®ç›´æ¥ä½¿ç”¨åœ°å¹³çº¿æä¾›çš„Dockerã€‚</em></p>
<p><em>å¯¹äºè·¯å¾„2ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è¿è¡Œä»¥ä¸‹è„šæœ¬å®ŒæˆèŠ¯ç‰‡ç®—æ³•å·¥å…·é“¾çš„ç¯å¢ƒé…ç½®ã€‚</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd ddk/package/host/ai_toolchain</span><br><span class="line">bash install_ai_toolchain.sh</span><br></pre></td></tr></table></figure></div>

<p><em><strong>æ³¨æ„ï¼š</strong></em></p>
<ul>
<li><em>å®‰è£…è„šæœ¬ä¼šè‡ªåŠ¨æ£€æŸ¥ç›¸åº”çš„ç¯å¢ƒï¼Œç¼ºå°‘ç›¸åº”ä¾èµ–æˆ–é…ç½®ä¼šä¸­æ–­å®‰è£…è¿‡ç¨‹ï¼Œå¯ä»¥æ ¹æ®æç¤ºè¡¥å……ä¾èµ–ï¼Œå¹¶é‡æ–°æ‰§è¡Œinstallè„šæœ¬ã€‚</em></li>
<li><em>è„šæœ¬æ‰§è¡ŒæˆåŠŸåï¼Œä¼šåœ¨ <code>~/.bashrc</code> ç³»ç»Ÿç¯å¢ƒå˜é‡ä¸­æ·»åŠ Pathç­‰ä¿¡æ¯ï¼Œè¯·æ‰§è¡Œ <code>source ~/.bashrc</code> æ¥ä½¿å½“å‰terminalçš„é…ç½®ç”Ÿæ•ˆã€‚</em></li>
<li><em>torch ç‰ˆæœ¬åº”æ»¡è¶³ 1.10.2ï¼Œtorchvisionç‰ˆæœ¬åº”æ»¡è¶³0.11.3ã€‚</em></li>
</ul>
<p><em><strong>åœ°å¹³çº¿åœ¨ <code>ddk/samples/ai_toolchain/horizon_model_train_sample</code> è·¯å¾„ä¸‹å¼€æºäº†ä¸€äº›é«˜æ•ˆæ¨¡å‹æºç ï¼Œå…¶æµ®ç‚¹åŠQATè®­ç»ƒåŸºç¡€ç¯å¢ƒ</strong></em></p>
<blockquote>
<p><em>è¿è¡Œç¯å¢ƒéƒ¨ç½²</em></p>
</blockquote>
<p><em>å½“æ¨¡å‹å®Œæˆé‡åŒ–è½¬æ¢åï¼Œå³å¯å°†ç¼–è¯‘å¥½çš„æ¨¡å‹éƒ¨ç½²åœ¨å¼€å‘æ¿ç¯å¢ƒæ¨ç†è¿è¡Œã€‚è¿è¡Œç¯å¢ƒçš„éƒ¨ç½²éœ€è¦æ‚¨å…ˆå‡†å¤‡å¥½ä¸€å—çƒ§å†™å¥½ç³»ç»Ÿé•œåƒçš„ å¼€å‘æ¿ï¼Œå†å°†ç›¸å…³è¡¥å……æ–‡ä»¶æ‹·è´åˆ°å¼€å‘æ¿ä¸­å³å¯ã€‚</em></p>
<ul>
<li><strong>å¼€å‘æ¿å‡†å¤‡ï¼š</strong>æ­¤é˜¶æ®µéœ€è¦éªŒè¯ä¸‹å¼€å‘æ¿çš„å¯ç”¨æ€§ï¼Œå°†å¯ç”¨ç³»ç»Ÿé•œåƒçƒ§å†™åˆ°å¼€å‘æ¿ä¸­ã€‚å…·ä½“è¿‡ç¨‹è¯·å‚è€ƒ <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/appendix/hardware/system_image.html" >ç³»ç»Ÿé•œåƒå‡çº§ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ç« èŠ‚å†…å®¹ã€‚</li>
<li><strong>æ¿ç«¯å·¥å…·å®‰è£…ï¼š</strong>å·¥å…·é“¾çš„éƒ¨åˆ†è¡¥å……å·¥å…·æœªåŒ…å«åœ¨ç³»ç»Ÿé•œåƒä¸­ï¼Œ<u>ä½†å¯ä»¥åœ¨å®¿ä¸»æœºç¯å¢ƒä¸‹æ‰§è¡ŒOEåŒ…ä¸­çš„å®‰è£…è„šæœ¬ å°†å…¶æ‹·è´è‡³å¼€å‘æ¿</u>ï¼Œå…¶å‚è€ƒå‘½ä»¤å¦‚ä¸‹ï¼š</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd ddk/package/board</span><br><span class="line">bash install.sh $&#123;board_ip&#125;</span><br></pre></td></tr></table></figure></div>

<p><em>å…¶ä¸­ï¼Œ<code>$&#123;board_ip&#125;</code> æ˜¯æ‚¨ä¸ºå¼€å‘æ¿è®¾ç½®çš„IPåœ°å€ï¼Œè¯·ç¡®ä¿åœ¨å¼€å‘æœºä¸Šå¯ä»¥æˆåŠŸè®¿é—®è¯¥IPã€‚ è¡¥å……æ–‡ä»¶æˆåŠŸå®‰è£…åï¼Œè¯·é‡æ–°å¯åŠ¨å¼€å‘æ¿ï¼Œåœ¨å¼€å‘æ¿ä¸Šæ‰§è¡Œ <code>hrt_model_exec --help</code> å³å¯éªŒè¯å®‰è£…æ˜¯å¦æˆåŠŸã€‚</em></p>
<h4 id="OEåŒ…ç‰ˆæœ¬ç®¡ç†"><a href="#OEåŒ…ç‰ˆæœ¬ç®¡ç†" class="headerlink" title="OEåŒ…ç‰ˆæœ¬ç®¡ç†"></a><em>OEåŒ…ç‰ˆæœ¬ç®¡ç†</em></h4><p><em>ç»Ÿä¸€å‘ç‰ˆhost packageç‰ˆæœ¬ç®¡ç†å·¥å…·ddk_vcsç”¨äºå¯¹åœ°å¹³çº¿OEåŒ…ä¸­çš„ä¾èµ–åº“åŠwhlåŒ…çš„ç‰ˆæœ¬è¿›è¡Œç®¡ç†</em></p>
<blockquote>
<p><em>åŠŸèƒ½æ¦‚è¦</em></p>
</blockquote>
<p><em>å·¥å…·åŒ…æ‹¬ä»¥ä¸‹åŠŸèƒ½ï¼š</em></p>
<ul>
<li><em>ddk_vcs listã€‚</em></li>
<li><em>ddk_vcs installã€‚</em></li>
<li><em>ddk_vcs uninstallã€‚</em></li>
<li><em>ddk_vcs patchã€‚</em></li>
<li><em>ddk_vcs showã€‚</em></li>
</ul>
<blockquote>
<p><em>å‡†å¤‡å·¥ä½œ</em></p>
</blockquote>
<p><em>å®Œæˆå®‰è£…åï¼Œåœ¨ä½¿ç”¨ddk_vcså·¥å…·å‰ï¼Œæ‚¨éœ€è¦å…ˆå¯¹ç¯å¢ƒå˜é‡è¿›è¡Œè®¾ç½®ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼Œå½“æ‚¨è¾“å…¥ <code>ddk_vcs --help</code> æ—¶ï¼Œä¼šå‡ºç°æç¤ºï¼Œè¯·å…ˆè®¾ç½®ç¯å¢ƒå˜é‡ã€‚</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[horizon@gpu-dev067 ai_toolchain]$ ddk_vcs --help</span><br><span class="line">Please set the value (xj3/j5) of environment variable DDK_VCS_MODE and run it again.</span><br></pre></td></tr></table></figure></div>

<p><em>ç¯å¢ƒå˜é‡çš„è®¾ç½®æ–¹æ³•ï¼šåœ¨ <code>~/.bashrc</code> ä¸­å¢åŠ ä¸€è¡Œ <code>export DDK_VCS_MODE=j5</code> ï¼Œä¿å­˜åï¼Œä½¿ç”¨å‘½ä»¤ <code>source ~/.bashrc</code> ä½¿å…¶ç”Ÿæ•ˆå³å¯ã€‚</em></p>
<p><em><strong>æ³¨æ„ï¼šå¦‚æ‚¨ä½¿ç”¨OEåŒ…æä¾›çš„ <code>install.sh</code> è¿›è¡Œå®‰è£…æˆ–ä½¿ç”¨dockerç¯å¢ƒæ“ä½œï¼Œæˆ‘ä»¬å·²ä¸ºæ‚¨é¢„å…ˆå®Œæˆäº†è®¾ç½®ï¼Œæ— éœ€è¿›è¡Œæ­¤é¡¹å‡†å¤‡å·¥ä½œã€‚</strong></em></p>
<blockquote>
<p><em>è¯¦ç»†ä¿¡æ¯</em></p>
</blockquote>
<p><em><strong>ddk_vcs list</strong>ï¼šddk_vcs list ç”¨äºåˆ—å‡ºå·²å®‰è£…çš„è½¯ä»¶åŒ…ã€‚</em></p>
<p><em>å‚æ•°å¦‚ä¸‹ï¼š</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[horizon@gpu-dev067 ai_toolchain]$ ddk_vcs list --help</span><br><span class="line">Usage: ddk_vcs list [OPTIONS]</span><br><span class="line"></span><br><span class="line">  List installed packages.</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">  -l, --local  Show all existing packages(*.tar.gz) on host machine.</span><br><span class="line">  --help       Show this message and exit.</span><br></pre></td></tr></table></figure></div>

<p><em>ä¸åŠ å‚æ•°æ‰§è¡Œæ­¤å‘½ä»¤æ—¶ï¼Œç»“æœä¼šå±•ç¤ºå½“å‰å·²å®‰è£…çš„å„ä¸ªæ¨¡å—çš„ä¿¡æ¯ã€‚ä½¿ç”¨ç¤ºä¾‹å¦‚ä¸‹ï¼š</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[horizon@gpu-dev067 ai_toolchain]$ ddk_vcs list</span><br><span class="line">Host package version: v2.0.3</span><br><span class="line">The following packages versions</span><br><span class="line">Platform           Package         Version MD5</span><br><span class="line">---------------    --------------- ------- -------------</span><br><span class="line">aarch_64           appsdk          032419  093e13b44e</span><br><span class="line">aarch_64           dnn             1.8.1g  aff0f6f4de</span><br><span class="line">x86_64_gcc5.4.0    dnn_x86         1.8.1g  e8e6bf9ed5</span><br><span class="line">x86_64_gcc5.4.0    horizon-nn      0.13.3  origin:0.13.3</span><br><span class="line">x86_64_gcc5.4.0    horizon-nn-gpu  0.13.3  origin:N/A</span><br><span class="line">x86_64_gcc5.4.0    horizon-tc-ui   1.6.4   origin:1.6.4</span><br><span class="line">x86_64_gcc5.4.0    hbdk            3.28.3  origin:3.28.3</span><br></pre></td></tr></table></figure></div>

<p><em><strong>æ³¨æ„ï¼šæœ€åå‡ è¡Œçš„originä¿¡æ¯ä¼šåœ¨æ¯æ¬¡ä½¿ç”¨OEåŒ…å†…çš„installè„šæœ¬è¿›è¡Œå®‰è£…åæ›´æ–°ä¸ºå½“å‰ç¯å¢ƒä¸‹çš„ç‰ˆæœ¬ï¼Œ åç»­åœ¨ä½¿ç”¨ddk_vcsè¿›è¡Œå®‰è£…æ—¶åˆ™ä¸ä¼šæ”¹å˜ï¼Œåªä¼šæ”¹å˜Versionçš„å€¼ã€‚</strong></em></p>
<p><em>ä½¿ç”¨ <code>-l</code> æˆ– <code>--local</code> å‚æ•°ä»¥åä¼šæ˜¾ç¤ºå½“å‰å¯ä»¥å®‰è£…çš„æ¨¡å—ç‰ˆæœ¬æƒ…å†µï¼Œå¯ä»¥é€šè¿‡ <code>ddk_vcs install</code> è¿›è¡Œå®‰è£…ï¼Œä½¿ç”¨ç¤ºä¾‹å¦‚ä¸‹ï¼š</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[horizon@gpu-dev004]$ ddk_vcs list -l</span><br><span class="line">Host package version: 1.5.1</span><br><span class="line">The following packages versions</span><br><span class="line">Platform        Local Package                 Version MD5</span><br><span class="line">--------------- ----------------------------- ------- ----------</span><br><span class="line">aarch_64        appsdk_1.9.0.tar.gz           1.9.0   bf01140c9d</span><br><span class="line">aarch_64        bpu_predict_1.10.2.tar.gz     1.10.2  5b6e5dd6c5</span><br><span class="line">aarch_64        dnn_1.1.2a.tar.gz             1.1.2a  fdb5729f4f</span><br><span class="line">x86_64_gcc5.4.0 bpu_predict_1.10.2.tar.gz     1.10.2  4dbdd980a7</span><br><span class="line">x86_64_gcc5.4.0 dnn_x86_1.1.2a.tar.gz         1.1.2a  5bf5fcd4fe</span><br></pre></td></tr></table></figure></div>

<p><em><strong>ddk_vcs installï¼š</strong>ddk_vcs install ç”¨äºå¯¹å®‰è£…åŒ…è¿›è¡Œå®‰è£…</em></p>
<p><em>å‚æ•°å¦‚ä¸‹ï¼š</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[horizon@gpu-dev067 ai_toolchain]$ ddk_vcs install --help</span><br><span class="line">Usage: ddk_vcs install [OPTIONS] MODULE_FILE...</span><br><span class="line"></span><br><span class="line">  Install packages.</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">  -p, --platform [aarch_64|x86_64_gcc5.4.0]</span><br><span class="line">                                  Platform name</span><br><span class="line">  --help                          Show this message and exit.</span><br></pre></td></tr></table></figure></div>

<p><em>ç”¨æˆ·å¯ä»¥ç›´æ¥é€šè¿‡ <code>ddk_vcs install</code> å°†å¯¹åº”çš„æ¨¡å—taråŒ…è¿›è¡Œå®‰è£…ã€‚<strong>å®‰è£…æ—¶éœ€è¦æŒ‡å®šå¯¹åº”çš„platform</strong>ã€‚ä½¿ç”¨ç¤ºä¾‹å¦‚ä¸‹ï¼š</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[horizon@gpu-dev004]$ ddk_vcs install bpu_predict_1.10.2.tar.gz -p aarch_64</span><br><span class="line">bpu_predict installed successfully, version: 1.10.2, platform: aarch_64</span><br><span class="line">[horizon@gpu-dev067 ai_toolchain]$ ddk_vcs install hbdk-3.28.3-py3-none-linux_x86_64.whl  horizon_nn-0.13.3-py3-none-any.whl</span><br><span class="line">hbdk-3.28.3-py3-none-linux_x86_64.whl installed successfully</span><br><span class="line">horizon_nn-0.13.3-py3-none-any.whl installed successfully</span><br></pre></td></tr></table></figure></div>

<p><em>åœ¨ä½¿ç”¨ <code>ddk_vcs list -l</code> åç”¨æˆ·å¯ä»¥å¾—åˆ°è‡ªå·±å½“å‰host packageä¸­å„ä¸ªæ¨¡å—åŒ…çš„ç‰ˆæœ¬ä¿¡æ¯ï¼Œ ç„¶åä½¿ç”¨ <code>ddk_vcs install</code> å¯ä»¥å¾ˆæ–¹ä¾¿åœ°åˆ‡æ¢å„ä¸ªç‰ˆæœ¬ï¼Œä½¿ç”¨ç¤ºä¾‹å¦‚ä¸‹ï¼š</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[horizon@gpu-dev004]$ ddk_vcs install bpu_predict==1.7.2  --platform aarch_64</span><br><span class="line">bpu_predict installed successfully, version: 1.7.2, platform: aarch_64</span><br></pre></td></tr></table></figure></div>

<p><em>å¦‚æœæœ¬åœ°æ²¡æœ‰å¯¹åº”ç‰ˆæœ¬å¯ä»¥æŒ‡å®šå®‰è£…åŒ…ä½ç½®è¿›è¡Œå®‰è£…ã€‚</em></p>
<p><em><strong>ddk_vcs uninstallï¼š</strong>ç”¨äºå¸è½½æŒ‡å®šæ¨¡å—</em></p>
<p><em>å‚æ•°å¦‚ä¸‹ï¼š</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[horizon@gpu-dev067 ai_toolchain]$ ddk_vcs uninstall --help</span><br><span class="line">Usage: ddk_vcs uninstall [OPTIONS] MODULE...</span><br><span class="line"></span><br><span class="line">  Uninstall packages.</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">  -p, --platform [aarch_64|x86_64_gcc5.4.0]</span><br><span class="line">                                  Platform name  [required]</span><br><span class="line">  --help                          Show this message and exit.</span><br></pre></td></tr></table></figure></div>

<p><em>ä½¿ç”¨ç¤ºä¾‹å¦‚ä¸‹ï¼š</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[horizon@gpu-dev004]$ ddk_vcs uninstall bpu_predict --platform aarch_64</span><br><span class="line">Start to uninstall modules, platform: aarch_64</span><br><span class="line">bpu_predict uninstalled successfully, version: 1.10.2, platform: aarch_64</span><br></pre></td></tr></table></figure></div>

<p><em><strong>ddk_vcs patchï¼š</strong>ä½¿ç”¨ <code>ddk_vcs patch ddk_patch.tar.gz</code> å¯ä»¥å®‰è£…é¢„å…ˆåˆ¶ä½œå¥½çš„patchåŒ…ã€‚</em></p>
<p><em>ä½¿ç”¨ç¤ºä¾‹å¦‚ä¸‹ï¼š</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[horizon@gpu-dev004]$ ddk_vcs patch ddk_patch.tar.gz</span><br><span class="line">bpu_predict installed successfully, version: 1.7.2_patch0, platform: aarch64</span><br></pre></td></tr></table></figure></div>

<p><em><strong>ddk_vcs showï¼š</strong>ç”¨äºæ˜¾ç¤ºæœ‰å…³å·²å®‰è£…è½¯ä»¶åŒ…çš„ä¿¡æ¯ã€‚ä½¿ç”¨ <code>ddk_vcs show [æ¨¡å—å]</code> ï¼Œå¯ä»¥å±•ç¤ºå¯¹åº”æ¨¡å—çš„ä¿¡æ¯ã€‚</em></p>
<p><em>å‚æ•°å¦‚ä¸‹ï¼š</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[horizon@gpu-dev067 ai_toolchain]$ ddk_vcs show --help</span><br><span class="line">Usage: ddk_vcs show [OPTIONS] MODULE</span><br><span class="line"></span><br><span class="line">  Show information about installed packages.</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">  -p, --platform [aarch_64|x86_64_gcc5.4.0]</span><br><span class="line">                                  Platform name</span><br><span class="line">  --help                          Show this message and exit.</span><br></pre></td></tr></table></figure></div>

<p><em>ä½¿ç”¨ç¤ºä¾‹å¦‚ä¸‹ï¼š</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[horizon@gpu-dev004]$ ddk_vcs show bpu_predict</span><br><span class="line">Host package version 1.5.1</span><br><span class="line">The following packages versions</span><br><span class="line">Platform        Package     Version       MD5</span><br><span class="line">--------------- ----------- ------------- ----------</span><br><span class="line">aarch_64        bpu_predict 1.10.2        5b6e5dd6c5</span><br><span class="line">x86_64_gcc5.4.0 bpu_predict 1.10.2_patch1 d4f8e37921</span><br></pre></td></tr></table></figure></div>

<p><em>å¦‚æœ2ä¸ªæ¶æ„å†…æœ‰åŒåä¾èµ–ï¼Œå¯ä»¥ä½¿ç”¨ <code>-p/--platform</code> æŒ‡å®šæ¶æ„åè¿›è¡Œè¿‡æ»¤ã€‚ä½¿ç”¨ç¤ºä¾‹å¦‚ä¸‹ï¼š</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[horizon@gpu-dev004]$ ddk_vcs show bpu_predict -p aarch_64</span><br><span class="line">Host package version 1.5.1</span><br><span class="line">The following packages versions</span><br><span class="line">Platform Package     Version MD5</span><br><span class="line">-------- ----------- ------- ----------</span><br><span class="line">aarch_64 bpu_predict 1.10.2  5b6e5dd6c5</span><br></pre></td></tr></table></figure></div>

<h3 id="å¿«é€Ÿå…¥é—¨"><a href="#å¿«é€Ÿå…¥é—¨" class="headerlink" title="å¿«é€Ÿå…¥é—¨"></a><em>å¿«é€Ÿå…¥é—¨</em></h3><h4 id="QATã€PTQç®€ä»‹"><a href="#QATã€PTQç®€ä»‹" class="headerlink" title="QATã€PTQç®€ä»‹"></a><em>QATã€PTQç®€ä»‹</em></h4><p><em>ä¾æ®æ˜¯å¦è¦å¯¹é‡åŒ–åçš„å‚æ•°è¿›è¡Œè°ƒæ•´ï¼Œæˆ‘ä»¬å¯ä»¥å°†é‡åŒ–æ–¹æ³•åˆ†ä¸ºé‡åŒ–æ„ŸçŸ¥è®­ç»ƒï¼ˆQATï¼‰å’Œè®­ç»ƒåé‡åŒ–ï¼ˆPTQï¼‰ã€‚ è¿™ä¸¤ç§æ–¹æ³•çš„æ“ä½œåŒºåˆ«å¦‚ä¸‹å›¾æ‰€ç¤ºï¼ˆå›¾å·¦ä¸ºQATï¼Œå›¾å³ä¸ºPTQï¼‰ï¼š</em></p>
<p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230508182313277.png"
                      class="" title="image-20230508182313277"
                ></em></p>
<p><em><strong>é‡åŒ–è®­ç»ƒ QAT</strong> æ˜¯å°†è®­ç»ƒè¿‡çš„æ¨¡å‹é‡åŒ–ååˆå†è¿›è¡Œé‡è®­ç»ƒã€‚ç”±äºå®šç‚¹æ•°å€¼æ— æ³•ç”¨äºåå‘æ¢¯åº¦è®¡ç®—ï¼Œ</em><em>å®é™…æ“ä½œè¿‡ç¨‹æ˜¯åœ¨æŸäº›opå‰æ’å…¥ä¼ªé‡åŒ–èŠ‚ç‚¹ï¼ˆfake quantization nodesï¼‰ï¼Œ ç”¨äºåœ¨è®­ç»ƒæ—¶è·å–æµç»è¯¥opçš„æ•°æ®çš„æˆªæ–­å€¼ï¼Œä¾¿äºåœ¨éƒ¨ç½²é‡åŒ–æ¨¡å‹æ—¶å¯¹èŠ‚ç‚¹è¿›è¡Œé‡åŒ–æ—¶ä½¿ç”¨**ã€‚æˆ‘ä»¬éœ€è¦åœ¨è®­ç»ƒä¸­é€šè¿‡ä¸æ–­ä¼˜åŒ–ç²¾åº¦æ¥è·å–æœ€ä½³çš„é‡åŒ–å‚æ•°ã€‚ç”±äºå®ƒéœ€è¦å¯¹æ¨¡å‹è¿›è¡Œè®­ç»ƒ, å¯¹æ“ä½œäººå‘˜æŠ€æœ¯è¦æ±‚è¾ƒé«˜ã€‚</em></p>
<p><em><strong>è®­ç»ƒåé‡åŒ– PTQ</strong> æ˜¯ä½¿ç”¨ä¸€æ‰¹æ ¡å‡†æ•°æ®å¯¹è®­ç»ƒå¥½çš„æ¨¡å‹è¿›è¡Œæ ¡å‡†ï¼Œå°†è®­ç»ƒè¿‡çš„FP32æ¨¡å‹ç›´æ¥è½¬æ¢ä¸ºå®šç‚¹è®¡ç®—çš„æ¨¡å‹ï¼Œè¿‡ç¨‹ä¸­æ— éœ€å¯¹åŸå§‹æ¨¡å‹è¿›è¡Œä»»ä½•è®­ç»ƒã€‚åªå¯¹å‡ ä¸ªè¶…å‚æ•°è°ƒæ•´å°±å¯å®Œæˆé‡åŒ–è¿‡ç¨‹ï¼Œ ä¸”è¿‡ç¨‹ç®€å•å¿«é€Ÿï¼Œæ— éœ€è®­ç»ƒï¼Œå› æ­¤æ­¤æ–¹æ³•å·²è¢«å¹¿æ³›åº”ç”¨äºå¤§é‡çš„ç«¯ä¾§å’Œäº‘ä¾§éƒ¨ç½²åœºæ™¯ï¼Œ <strong>æˆ‘ä»¬ä¼˜å…ˆæ¨èæ‚¨å°è¯•PTQæ–¹æ³•æ¥æŸ¥çœ‹æ˜¯å¦æ»¡è¶³æ‚¨çš„éƒ¨ç½²ç²¾åº¦å’Œæ€§èƒ½è¦æ±‚</strong> ã€‚</em></p>
<blockquote>
<p><em>åœ¨é‡åŒ–è®­ç»ƒä¸­ï¼Œç”±äºå®šç‚¹æ•°å€¼æ— æ³•ç›´æ¥ç”¨äºåå‘æ¢¯åº¦è®¡ç®—ï¼ˆå› ä¸ºæ¢¯åº¦é€šå¸¸æ˜¯æµ®ç‚¹æ•°ï¼‰ï¼Œå› æ­¤éœ€è¦åœ¨æŸäº›æ“ä½œï¼ˆopï¼‰ä¹‹å‰æ’å…¥ä¼ªé‡åŒ–èŠ‚ç‚¹ï¼ˆfake quantization nodesï¼‰ã€‚è¿™äº›ä¼ªé‡åŒ–èŠ‚ç‚¹åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ç”¨äºè·å–æµç»è¯¥æ“ä½œçš„æ•°æ®çš„æˆªæ–­å€¼ï¼Œå³å°†æµ®ç‚¹æ•°å€¼æˆªæ–­ä¸ºå›ºå®šç²¾åº¦çš„å®šç‚¹æ•°å€¼ã€‚è¿™æ ·ï¼Œæ¨¡å‹å¯ä»¥åœ¨é‡åŒ–è®­ç»ƒæœŸé—´è€ƒè™‘é‡åŒ–è¿‡ç¨‹çš„å½±å“ï¼Œå¹¶é€šè¿‡æ¢¯åº¦åå‘ä¼ æ’­æ¥ä¼˜åŒ–é‡åŒ–å‚æ•°ã€‚</em></p>
<p><em>è¿™äº›ä¼ªé‡åŒ–èŠ‚ç‚¹åœ¨é‡åŒ–è®­ç»ƒæœŸé—´èµ·åˆ°ä¸¤ä¸ªä½œç”¨ï¼š</em></p>
<ol>
<li><em>åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­è·å–æµç»è¯¥æ“ä½œçš„æ•°æ®çš„æˆªæ–­å€¼ï¼Œä»¥ä¾¿è®¡ç®—æ¢¯åº¦å¹¶è¿›è¡Œåå‘ä¼ æ’­ã€‚</em></li>
<li><em>ä¸ºåç»­çš„é‡åŒ–æ¨¡å‹éƒ¨ç½²æä¾›å‚è€ƒï¼Œä»¥ä¾¿åœ¨æ¨ç†é˜¶æ®µå¯¹èŠ‚ç‚¹è¿›è¡ŒçœŸå®çš„é‡åŒ–æ“ä½œã€‚</em></li>
</ol>
<p><em>å®šç‚¹æ•°æ˜¯ä¸€ç§è¡¨ç¤ºæ•°å€¼çš„æ–¹å¼ï¼Œå®ƒä½¿ç”¨å›ºå®šçš„å°æ•°ä½æ•°ã€‚åœ¨é‡åŒ–è®­ç»ƒä¸­ï¼Œæµ®ç‚¹æ•°çš„æ•°å€¼èŒƒå›´è¢«é‡åŒ–ä¸ºä¸€ä¸ªæœ‰é™çš„æ•´æ•°èŒƒå›´ã€‚è¿™ä¸ªæ•´æ•°èŒƒå›´é€šå¸¸è¢«åˆ’åˆ†ä¸ºå¤šä¸ªç­‰é—´éš”çš„æ•´æ•°å€¼ï¼Œæ¯ä¸ªæ•´æ•°å€¼è¡¨ç¤ºä¸€ä¸ªå®šç‚¹æ•°ã€‚é€šè¿‡å°†æµ®ç‚¹æ•°æ˜ å°„åˆ°æœ€æ¥è¿‘çš„å®šç‚¹æ•°ï¼Œå¯ä»¥å°†æµ®ç‚¹æ•°é‡åŒ–ä¸ºå®šç‚¹æ•°ã€‚</em></p>
</blockquote>
<h4 id="èŠ¯ç‰‡ç®—æ³•æ¨¡å‹PTQé‡åŒ–-ä¸Šæ¿-å¿«é€Ÿä¸Šæ‰‹"><a href="#èŠ¯ç‰‡ç®—æ³•æ¨¡å‹PTQé‡åŒ–-ä¸Šæ¿-å¿«é€Ÿä¸Šæ‰‹" class="headerlink" title="èŠ¯ç‰‡ç®—æ³•æ¨¡å‹PTQé‡åŒ–+ä¸Šæ¿ å¿«é€Ÿä¸Šæ‰‹"></a><em>èŠ¯ç‰‡ç®—æ³•æ¨¡å‹PTQé‡åŒ–+ä¸Šæ¿ å¿«é€Ÿä¸Šæ‰‹</em></h4><p><em>æœ¬ç« èŠ‚ä¸­ï¼Œå°†ä»‹ç»è®­ç»ƒåé‡åŒ–PTQæ–¹æ¡ˆçš„åŸºæœ¬ä½¿ç”¨æµç¨‹ï¼Œä¾¿äºå®ç°å¿«é€Ÿä¸Šæ‰‹ã€‚ è¿™é‡Œæˆ‘ä»¬ä»¥MobileNet-v1æ¨¡å‹ä¸ºä¾‹ï¼Œè¿›è¡Œä½¿ç”¨æ¼”ç¤ºï¼Œè¯¦ç»†å†…å®¹å°†åœ¨åç»­ç« èŠ‚å±•å¼€ä»‹ç»ï¼ŒåŸºæœ¬å·¥ä½œæµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</em></p>
<p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230508183501325.png"
                      class="" title="image-20230508183501325"
                ></em></p>
<p><em><strong>è¯·æ³¨æ„ï¼Œåœ¨æ‚¨è¿›è¡Œä»¥ä¸‹æ“ä½œå‰ï¼Œè¯·ç¡®ä¿æ‚¨å·²ç»å‚è€ƒ <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/env_install/env_deploy.html" >ç¯å¢ƒéƒ¨ç½² <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ç« èŠ‚å®Œæˆäº†å¼€å‘æœºå’Œå¼€å‘æ¿ä¸Šçš„ç¯å¢ƒå®‰è£…ã€‚</strong></em></p>
<blockquote>
<p><em>æµ®ç‚¹æ¨¡å‹å‡†å¤‡</em></p>
</blockquote>
<p><em>åœ°å¹³çº¿ä¸ºæ‚¨æä¾›äº†ä¸°å¯Œçš„PTQç¤ºä¾‹æ¨¡å‹ã€‚æ‚¨å¯ä»¥æ ¹æ®éœ€è¦ï¼Œåœ¨å¯¹åº”çš„ç¤ºä¾‹æ–‡ä»¶å¤¹å†…æ‰§è¡Œå…¶ä¸­çš„ <code>00_init.sh</code> è„šæœ¬æ¥è·å–ç¤ºä¾‹å¯¹åº”çš„æ ¡å‡†æ•°æ®é›†å’ŒåŸå§‹æ¨¡å‹ã€‚ ç¤ºä¾‹æ¨¡å‹çš„æ¨¡å‹æ¥æºå’Œç›¸å…³è¯´æ˜è¯·å‚è€ƒ <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/ptq/ptq_sample/algorithm_sample.html#prepare-ptq-model" >å¦‚ä½•å‡†å¤‡æ¨¡å‹ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ç« èŠ‚ã€‚</em></p>
<p>*å¦‚æ‚¨éœ€è¦è½¬æ¢ç§æœ‰æ¨¡å‹ï¼Œè¯·å‚è€ƒ <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/ptq/ptq_usage/model_prepare.html" >æµ®ç‚¹æ¨¡å‹å‡†å¤‡ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ç« èŠ‚å†…å®¹ æå‰å‡†å¤‡å¥½ <strong>caffe1.0 æˆ– opset&#x3D;10&#x2F;11 çš„ onnx æ¨¡å‹</strong>ã€‚ä¸‹è¡¨ä¸ºä¸åŒæ¡†æ¶åˆ°ONNXæ¨¡å‹æ ¼å¼è½¬æ¢çš„å‚è€ƒæ–¹æ¡ˆï¼š*</p>
<table>
<thead>
<tr>
<th align="left"><em>è®­ç»ƒæ¡†æ¶</em></th>
<th align="left"><em>å‚è€ƒæ–¹æ¡ˆ</em></th>
</tr>
</thead>
<tbody><tr>
<td align="left"><em>Pytorch</em></td>
<td align="left"><em>ä½¿ç”¨å®˜æ–¹APIå¯¼å‡ºï¼š <a class="link"   target="_blank" rel="noopener" href="https://pytorch.org/tutorials/advanced/super_resolution_with_onnxruntime.html" >https://pytorch.org/tutorials/advanced/super_resolution_with_onnxruntime.html <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></em></td>
</tr>
<tr>
<td align="left"><em>Tensorflow</em></td>
<td align="left"><em>ä½¿ç”¨ONNXç¤¾åŒºçš„onnx&#x2F;tensorflow-onnxå·¥å…·è½¬æ¢ï¼š <a class="link"   target="_blank" rel="noopener" href="https://github.com/onnx/tensorflow-onnx" >https://github.com/onnx/tensorflow-onnx <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></em></td>
</tr>
<tr>
<td align="left"><em>MXNet2Onnx</em></td>
<td align="left"><em>ä½¿ç”¨å®˜æ–¹APIå¯¼å‡ºï¼š <a class="link"   target="_blank" rel="noopener" href="https://github.com/dotnet/machinelearning/blob/main/test/Microsoft.ML.Tests/OnnxConversionTest.cs" >https://github.com/dotnet/machinelearning/blob/main/test/Microsoft.ML.Tests/OnnxConversionTest.cs <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></em></td>
</tr>
<tr>
<td align="left"><em>å…¶ä»–æ¡†æ¶</em></td>
<td align="left"><em><a class="link"   target="_blank" rel="noopener" href="https://github.com/onnx/tutorials#converting-to-onnx-format" >https://github.com/onnx/tutorials#converting-to-onnx-format <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></em></td>
</tr>
</tbody></table>
<blockquote>
<p><em>æ¨¡å‹éªŒè¯</em></p>
</blockquote>
<p><em>åœ¨æµ®ç‚¹æ¨¡å‹å‡†å¤‡å¥½ä¹‹åï¼Œæˆ‘ä»¬å»ºè®®å…ˆè¿›è¡Œå¿«é€Ÿçš„æ¨¡å‹éªŒè¯ï¼Œä»¥ç¡®ä¿å…¶ç¬¦åˆèŠ¯ç‰‡çš„æ”¯æŒçº¦æŸã€‚ å¯¹äº<strong>Caffe</strong>æ¡†æ¶çš„MobileNetæ¨¡å‹ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å‘½ä»¤è¡Œä¸­é”®å…¥ä»¥ä¸‹å‘½ä»¤å®Œæˆæ¨¡å‹éªŒè¯ï¼š</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">hb_mapper checker --model-type caffe \</span><br><span class="line">                  --prototxt mobilenet_deploy.prototxt \</span><br><span class="line">                  --model mobilenet.caffemodel \</span><br><span class="line">                  --march bayes</span><br></pre></td></tr></table></figure></div>

<blockquote>
<p><em>Caffe æ˜¯ä¸€ä¸ªåŸºäºå›¾çš„æ·±åº¦å­¦ä¹ æ¡†æ¶ï¼Œä¸»è¦ç”¨äºè®¡ç®—æœºè§†è§‰ä»»åŠ¡ï¼Œå¦‚å›¾åƒåˆ†ç±»ã€ç›®æ ‡æ£€æµ‹å’Œå›¾åƒåˆ†å‰²ã€‚å®ƒä»¥é€Ÿåº¦ã€æ¨¡å—åŒ–å’Œå¯æ‰©å±•æ€§ä¸ºè®¾è®¡ç›®æ ‡ï¼Œæä¾›äº†ä¸€ä¸ªç®€å•è€Œé«˜æ•ˆçš„å·¥å…·é“¾ï¼Œç”¨äºå®šä¹‰ã€è®­ç»ƒå’Œéƒ¨ç½²æ·±åº¦ç¥ç»ç½‘ç»œæ¨¡å‹ã€‚</em></p>
</blockquote>
<p><em>å¯¹äº<strong>ONNX</strong>æ ¼å¼çš„Efficientnet_lite0æ¨¡å‹ï¼Œåˆ™é”®å…¥ä»¥ä¸‹å‘½ä»¤ï¼š</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hb_mapper checker --model-type onnx \</span><br><span class="line">                  --model efficientnet_lite0_fp32.onnx \</span><br><span class="line">                  --march bayes</span><br></pre></td></tr></table></figure></div>

<p><em>å…¶ä¸­ï¼Œä¸¤ä¸ªæ¨¡å‹æ–‡ä»¶éƒ½å¯ä» <code>ddk/samples/model_zoo/mapper/classification</code> è·¯å¾„è·å–ã€‚ è€Œ <code>hb_mapper checker</code> å·¥å…·çš„ä¸»è¦å‚æ•°å¦‚ä¸‹ï¼Œæ›´å¤šå‚æ•°è¯´æ˜è¿˜è¯·å‚è€ƒ <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/ptq/ptq_usage/check_model.html" >éªŒè¯æ¨¡å‹ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ç« èŠ‚ã€‚</em></p>
<table>
<thead>
<tr>
<th align="left"><em>å‚æ•°</em></th>
<th align="left"><em>è¯´æ˜</em></th>
</tr>
</thead>
<tbody><tr>
<td align="left"><em>â€“model-type</em></td>
<td align="left"><em>ç”¨äºæŒ‡å®šæ£€æŸ¥è¾“å…¥çš„æ¨¡å‹ç±»å‹ï¼Œç›®å‰åªæ”¯æŒè®¾ç½® <strong>caffe</strong> æˆ–è€… <strong>onnx</strong> ã€‚</em></td>
</tr>
<tr>
<td align="left"><em>â€“march</em></td>
<td align="left"><em>ç”¨äºæŒ‡å®šéœ€è¦é€‚é…çš„èŠ¯ç‰‡ç±»å‹ï¼ŒJ5èŠ¯ç‰‡è¯·è®¾ç½®ä¸º <strong>bayes</strong> ï¼ˆé»˜è®¤å€¼ï¼‰ã€‚</em></td>
</tr>
<tr>
<td align="left"><em>â€“proto</em></td>
<td align="left"><em>æ­¤å‚æ•°ä»…åœ¨model-typeæŒ‡å®šcaffeæ—¶æœ‰æ•ˆï¼Œå–å€¼ä¸ºcaffeæ¨¡å‹çš„ <strong>prototxt</strong> æ–‡ä»¶åç§°ï¼› <strong>onnxæ¨¡å‹å¯ä»¥ä¸é…ç½®è¯¥å‚æ•°ã€‚</strong></em></td>
</tr>
<tr>
<td align="left"><em>â€“model</em></td>
<td align="left"><em>åœ¨model-typeè¢«æŒ‡å®šä¸ºcaffeæ—¶ï¼Œå–å€¼ä¸ºCaffeæ¨¡å‹çš„ <strong>caffemodel</strong> æ–‡ä»¶åç§°ï¼› åœ¨model-typeè¢«æŒ‡å®šä¸ºonnxæ—¶ï¼Œå–å€¼ä¸º <strong>ONNXæ¨¡å‹</strong> æ–‡ä»¶åç§°ã€‚</em></td>
</tr>
</tbody></table>
<p><em>ä»¥MobileNet-v1æ¨¡å‹ä¸ºä¾‹ï¼Œæ‚¨ä¹Ÿå¯ä»¥åŸºäºæˆ‘ä»¬ç¤ºä¾‹ä¸­çš„ <code>01_checker.sh</code> è„šæœ¬è¿›è¡Œå¯¹åº”ä¿®æ”¹åä½¿ç”¨ï¼Œå‚è€ƒå‘½ä»¤å¦‚ä¸‹ï¼š</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cd ddk/samples/ai_toolchain/horizon_model_convert_sample/   # PTQç¤ºä¾‹ç›®å½•</span><br><span class="line">cd 03_classification/01_mobilenet/mapper                    # mobilenetç¤ºä¾‹ç›®å½•</span><br><span class="line">vim 01_checker.sh                                           # å¯¹åº”ä¿®æ”¹è„šæœ¬</span><br><span class="line">bash 01_checker.sh                                          # è¿è¡Œè„šæœ¬æ£€æŸ¥æ¨¡å‹</span><br></pre></td></tr></table></figure></div>

<p><em>01_checker.shè„šæœ¬æ–‡ä»¶ä¸­çš„ä¸»è¦å†…å®¹å¦‚ä¸‹æ‰€ç¤ºï¼š</em></p>
<p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230508185808895.png"
                      class="" title="image-20230508185808895"
                ></em></p>
<p><em>å¦‚æœæ¨¡å‹éªŒè¯ä¸é€šè¿‡ï¼Œè¯·æ ¹æ®ç»ˆç«¯æ‰“å°æˆ–åœ¨å½“å‰è·¯å¾„ä¸‹ç”Ÿæˆçš„ <code>hb_mapper_checker_&#123;date_time&#125;.log</code> æ—¥å¿—æ–‡ä»¶ç¡®è®¤æŠ¥é”™ä¿¡æ¯å’Œä¿®æ”¹å»ºè®®ï¼Œ æ›´å¤šè¯´æ˜è¯·å‚è€ƒ <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/ptq/ptq_usage/check_model.html" >éªŒè¯æ¨¡å‹ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ç« èŠ‚ã€‚</em></p>
<blockquote>
<p><em>æ¨¡å‹è½¬æ¢</em></p>
</blockquote>
<p><em>æ¨¡å‹éªŒè¯é€šè¿‡åï¼Œå°±å¯ä»¥ä½¿ç”¨ <code>hb_mapper makertbin</code> å·¥å…·è¿›è¡Œæ¨¡å‹è½¬æ¢ï¼Œå‚è€ƒå‘½ä»¤å¦‚ä¸‹ï¼š</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hb_mapper makertbin --config mobilenet_config.yaml \</span><br><span class="line">                    --model-type caffe</span><br></pre></td></tr></table></figure></div>

<p>*å…¶ä¸­ï¼Œ <code>mobilenet_config.yaml</code> <strong>ä¸ºæ¨¡å‹è½¬æ¢å¯¹åº”çš„é…ç½®æ–‡ä»¶</strong>ï¼Œå°†åœ¨ <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/faststart/quickstart.html#yaml-config" >Yamlé…ç½®æ–‡ä»¶ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ä¸­è¿›è¡Œä»‹ç»ã€‚ <code>model-type</code> åˆ™ç”¨äºæŒ‡å®šæ£€æŸ¥è¾“å…¥çš„æ¨¡å‹ç±»å‹ï¼Œ å¯é…ç½®ä¸ºcaffeæˆ–è€…onnxï¼Œä¸åŒæ¨¡å‹ç±»å‹å¯¹åº”çš„é…ç½®æ–‡ä»¶å‚æ•°ä¼šç¨æœ‰ä¸åŒã€‚*</p>
<p><em>å¦å¤–ï¼ŒPTQ æ–¹æ¡ˆçš„æ¨¡å‹é‡åŒ–è¿˜éœ€è¦ä¾èµ–ä¸€å®šæ•°é‡é¢„å¤„ç†åçš„æ ·æœ¬è¿›è¡Œæ ¡å‡†ï¼Œå°†åœ¨ <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/faststart/quickstart.html#calibration-data-preprocess" >æ ¡å‡†æ•°æ®é¢„å¤„ç† <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ä¸­è¿›è¡Œä»‹ç»ã€‚</em></p>
<p><em><strong>Yamlé…ç½®æ–‡ä»¶</strong></em></p>
<p><em>Yamlé…ç½®æ–‡ä»¶å…±åŒ…å«4ä¸ªå¿…é€‰å‚æ•°ç»„ï¼ˆ <code>model_parameters</code> ã€ <code>input_parameters</code> ã€ <code>calibration_parameters</code> ã€ <code>compiler_parameters</code> ï¼‰å’Œ 1ä¸ªå¯é€‰å‚æ•°ç»„ï¼ˆ <code>custom_op</code> ï¼‰ï¼Œæ¯ä¸ªå‚æ•°ç»„ä¸‹ä¹ŸåŒºåˆ†å¿…é€‰å’Œå¯é€‰å‚æ•°ï¼ˆå¯é€‰å‚æ•°é»˜è®¤éšè—ï¼‰ï¼Œå…·ä½“è¦æ±‚å’Œå¡«å†™æ–¹å¼å¯ä»¥å‚è€ƒæ¨¡å‹ç¤ºä¾‹ åŠ <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/ptq/ptq_usage/quantize_compile.html" >æ¨¡å‹é‡åŒ–ä¸ç¼–è¯‘ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ç« èŠ‚ã€‚ä»¥ä¸‹ä¸ºMobileNet-v1æ¨¡å‹çš„é…ç½®æ–‡ä»¶ï¼š</em></p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ¨¡å‹è½¬åŒ–ç›¸å…³çš„å‚æ•°</span></span><br><span class="line">model_parameters:</span><br><span class="line"></span><br><span class="line">  <span class="comment"># Caffeæµ®ç‚¹ç½‘ç»œæ•°æ®æ¨¡å‹æ–‡ä»¶</span></span><br><span class="line">  caffe_model: <span class="string">&#x27;mobilenet.caffemodel&#x27;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Caffeç½‘ç»œæè¿°æ–‡ä»¶</span></span><br><span class="line">  prototxt: <span class="string">&#x27;mobilenet_deploy.prototxt&#x27;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># é€‚ç”¨BPUæ¶æ„</span></span><br><span class="line">  march: <span class="string">&quot;bayes&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># æŒ‡å®šæ¨¡å‹è½¬æ¢è¿‡ç¨‹ä¸­æ˜¯å¦è¾“å‡ºå„å±‚çš„ä¸­é—´ç»“æœï¼Œå¦‚æœä¸ºTrueï¼Œåˆ™è¾“å‡ºæ‰€æœ‰å±‚çš„ä¸­é—´è¾“å‡ºç»“æœ</span></span><br><span class="line">  layer_out_dump: <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># æ¨¡å‹è½¬æ¢è¾“å‡ºçš„ç»“æœçš„å­˜æ”¾ç›®å½•</span></span><br><span class="line">  working_dir: <span class="string">&#x27;model_output&#x27;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># æ¨¡å‹è½¬æ¢è¾“å‡ºçš„ç”¨äºä¸Šæ¿æ‰§è¡Œçš„æ¨¡å‹æ–‡ä»¶çš„åç§°å‰ç¼€</span></span><br><span class="line">  output_model_file_prefix: <span class="string">&#x27;mobilenetv1_224x224_nv12&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¨¡å‹è¾“å…¥ç›¸å…³å‚æ•°, è‹¥è¾“å…¥å¤šä¸ªèŠ‚ç‚¹, åˆ™åº”ä½¿ç”¨&#x27;;&#x27;è¿›è¡Œåˆ†éš”, ä½¿ç”¨é»˜è®¤ç¼ºçœè®¾ç½®åˆ™å†™None</span></span><br><span class="line">input_parameters:</span><br><span class="line"></span><br><span class="line">  <span class="comment"># (é€‰å¡«) æ¨¡å‹è¾“å…¥çš„èŠ‚ç‚¹åç§°, æ­¤åç§°åº”ä¸æ¨¡å‹æ–‡ä»¶ä¸­çš„åç§°ä¸€è‡´, å¦åˆ™ä¼šæŠ¥é”™, ä¸å¡«åˆ™ä¼šä½¿ç”¨æ¨¡å‹æ–‡ä»¶ä¸­çš„èŠ‚ç‚¹åç§°</span></span><br><span class="line">  input_name: <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># ç½‘ç»œå®é™…æ‰§è¡Œæ—¶ï¼Œè¾“å…¥ç»™ç½‘ç»œçš„æ•°æ®æ ¼å¼ï¼ŒåŒ…æ‹¬ nv12/rgb/bgr/yuv444/gray/featuremap</span></span><br><span class="line">  input_type_rt: <span class="string">&#x27;nv12&#x27;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># ç½‘ç»œè®­ç»ƒæ—¶è¾“å…¥çš„æ•°æ®æ ¼å¼ï¼Œå¯é€‰çš„å€¼ä¸ºrgb/bgr/gray/featuremap/yuv444</span></span><br><span class="line">  input_type_train: <span class="string">&#x27;bgr&#x27;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># ç½‘ç»œè®­ç»ƒæ—¶è¾“å…¥çš„æ•°æ®æ’å¸ƒ, å¯é€‰å€¼ä¸º NHWC/NCHW</span></span><br><span class="line">  input_layout_train: <span class="string">&#x27;NCHW&#x27;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># (é€‰å¡«) æ¨¡å‹ç½‘ç»œçš„è¾“å…¥å¤§å°, ä»¥&#x27;x&#x27;åˆ†éš”, ä¸å¡«åˆ™ä¼šä½¿ç”¨æ¨¡å‹æ–‡ä»¶ä¸­çš„ç½‘ç»œè¾“å…¥å¤§å°ï¼Œå¦åˆ™ä¼šè¦†ç›–æ¨¡å‹æ–‡ä»¶ä¸­è¾“å…¥å¤§å°</span></span><br><span class="line">  input_shape: <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># ç½‘ç»œå®é™…æ‰§è¡Œæ—¶ï¼Œè¾“å…¥ç»™ç½‘ç»œçš„batch_size, é»˜è®¤å€¼ä¸º1</span></span><br><span class="line">  <span class="comment">#input_batch: 1</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># ç½‘ç»œè¾“å…¥çš„é¢„å¤„ç†æ–¹æ³•ï¼Œä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§ï¼š</span></span><br><span class="line">  <span class="comment"># no_preprocess ä¸åšä»»ä½•æ“ä½œ</span></span><br><span class="line">  <span class="comment"># data_mean å‡å»é€šé“å‡å€¼mean_value</span></span><br><span class="line">  <span class="comment"># data_scale å¯¹å›¾åƒåƒç´ ä¹˜ä»¥data_scaleç³»æ•°</span></span><br><span class="line">  <span class="comment"># data_mean_and_scale å‡å»é€šé“å‡å€¼åå†ä¹˜ä»¥scaleç³»æ•°</span></span><br><span class="line">  norm_type: <span class="string">&#x27;data_mean_and_scale&#x27;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># å›¾åƒå‡å»çš„å‡å€¼, å¦‚æœæ˜¯é€šé“å‡å€¼ï¼Œvalueä¹‹é—´å¿…é¡»ç”¨ç©ºæ ¼åˆ†éš”</span></span><br><span class="line">  mean_value: <span class="number">103.94</span> <span class="number">116.78</span> <span class="number">123.68</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># å›¾åƒé¢„å¤„ç†ç¼©æ”¾æ¯”ä¾‹ï¼Œå¦‚æœæ˜¯é€šé“ç¼©æ”¾æ¯”ä¾‹ï¼Œvalueä¹‹é—´å¿…é¡»ç”¨ç©ºæ ¼åˆ†éš”</span></span><br><span class="line">  scale_value: <span class="number">0.017</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¨¡å‹é‡åŒ–ç›¸å…³å‚æ•°</span></span><br><span class="line">calibration_parameters:</span><br><span class="line"></span><br><span class="line">  <span class="comment"># æ¨¡å‹é‡åŒ–çš„å‚è€ƒå›¾åƒçš„å­˜æ”¾ç›®å½•ï¼Œå›¾ç‰‡æ ¼å¼æ”¯æŒJpegã€Bmpç­‰æ ¼å¼ï¼Œè¾“å…¥çš„å›¾ç‰‡</span></span><br><span class="line">  <span class="comment"># åº”è¯¥æ˜¯ä½¿ç”¨çš„å…¸å‹åœºæ™¯ï¼Œä¸€èˆ¬æ˜¯ä»æµ‹è¯•é›†ä¸­é€‰æ‹©20~100å¼ å›¾ç‰‡ï¼Œå¦å¤–è¾“å…¥</span></span><br><span class="line">  <span class="comment"># çš„å›¾ç‰‡è¦è¦†ç›–å…¸å‹åœºæ™¯ï¼Œä¸è¦æ˜¯ååƒ»åœºæ™¯ï¼Œå¦‚è¿‡æ›å…‰ã€é¥±å’Œã€æ¨¡ç³Šã€çº¯é»‘ã€çº¯ç™½ç­‰å›¾ç‰‡</span></span><br><span class="line">  <span class="comment"># è‹¥æœ‰å¤šä¸ªè¾“å…¥èŠ‚ç‚¹, åˆ™åº”ä½¿ç”¨&#x27;;&#x27;è¿›è¡Œåˆ†éš”</span></span><br><span class="line">  cal_data_dir: <span class="string">&#x27;./calibration_data_bgr&#x27;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># æ ¡å‡†æ•°æ®äºŒè¿›åˆ¶æ–‡ä»¶çš„æ•°æ®å­˜å‚¨ç±»å‹ï¼Œå¯é€‰å€¼ä¸ºï¼šfloat32, uint8. è‹¥æœ‰å¤šä¸ªè¾“å…¥èŠ‚ç‚¹, åˆ™åº”ä½¿ç”¨&#x27;;&#x27;è¿›è¡Œåˆ†éš”</span></span><br><span class="line">  cal_data_type: <span class="string">&#x27;float32&#x27;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># æ¨¡å‹é‡åŒ–çš„ç®—æ³•ç±»å‹ï¼Œæ”¯æŒdefaultã€mixã€klã€maxã€loadï¼Œé€šå¸¸é‡‡ç”¨defaultå³å¯æ»¡è¶³è¦æ±‚</span></span><br><span class="line">  <span class="comment"># å¦‚ä¸ç¬¦åˆé¢„æœŸå¯å…ˆå°è¯•ä¿®æ”¹ä¸ºmix ä»ä¸ç¬¦åˆé¢„æœŸå†å°è¯•klæˆ–max</span></span><br><span class="line">  <span class="comment"># å½“ä½¿ç”¨QATå¯¼å‡ºæ¨¡å‹æ—¶ï¼Œæ­¤å‚æ•°åˆ™åº”è®¾ç½®ä¸ºload</span></span><br><span class="line">  <span class="comment"># ç›¸å…³å‚æ•°çš„æŠ€æœ¯åŸç†åŠè¯´æ˜è¯·æ‚¨å‚è€ƒç”¨æˆ·æ‰‹å†Œä¸­çš„PTQåŸç†åŠæ­¥éª¤ä¸­å‚æ•°ç»„è¯¦ç»†ä»‹ç»éƒ¨åˆ†</span></span><br><span class="line">  calibration_type: <span class="string">&#x27;max&#x27;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># è¯¥å‚æ•°ä¸º&#x27;max&#x27;æ ¡å‡†æ–¹æ³•çš„å‚æ•°ï¼Œç”¨ä»¥è°ƒæ•´&#x27;max&#x27;æ ¡å‡†çš„æˆªå–ç‚¹ã€‚æ­¤å‚æ•°ä»…åœ¨calibration_typeä¸º&#x27;max&#x27;æ—¶æœ‰æ•ˆã€‚</span></span><br><span class="line">  <span class="comment"># è¯¥å‚æ•°å–å€¼èŒƒå›´ï¼š0.0 ~ 1.0ã€‚å¸¸ç”¨é…ç½®é€‰é¡¹æœ‰ï¼š0.99999/0.99995/0.99990/0.99950/0.99900ã€‚</span></span><br><span class="line">  max_percentile: <span class="number">0.9999</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¼–è¯‘å™¨ç›¸å…³å‚æ•°</span></span><br><span class="line">compiler_parameters:</span><br><span class="line"></span><br><span class="line">  <span class="comment"># ç¼–è¯‘ç­–ç•¥ï¼Œæ”¯æŒbandwidthå’Œlatencyä¸¤ç§ä¼˜åŒ–æ¨¡å¼;</span></span><br><span class="line">  <span class="comment"># bandwidthä»¥ä¼˜åŒ–ddrçš„è®¿é—®å¸¦å®½ä¸ºç›®æ ‡ï¼›</span></span><br><span class="line">  <span class="comment"># latencyä»¥ä¼˜åŒ–æ¨ç†æ—¶é—´ä¸ºç›®æ ‡</span></span><br><span class="line">  compile_mode: <span class="string">&#x27;latency&#x27;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># è®¾ç½®debugä¸ºTrueå°†æ‰“å¼€ç¼–è¯‘å™¨çš„debugæ¨¡å¼ï¼Œèƒ½å¤Ÿè¾“å‡ºæ€§èƒ½ä»¿çœŸçš„ç›¸å…³ä¿¡æ¯ï¼Œå¦‚å¸§ç‡ã€DDRå¸¦å®½å ç”¨ç­‰</span></span><br><span class="line">  debug: <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># ä¼˜åŒ–ç­‰çº§å¯é€‰èŒƒå›´ä¸ºO0~O3</span></span><br><span class="line">  <span class="comment"># O0ä¸åšä»»ä½•ä¼˜åŒ–, ç¼–è¯‘é€Ÿåº¦æœ€å¿«ï¼Œä¼˜åŒ–ç¨‹åº¦æœ€ä½,</span></span><br><span class="line">  <span class="comment"># O1-O3éšç€ä¼˜åŒ–ç­‰çº§æé«˜ï¼Œé¢„æœŸç¼–è¯‘åçš„æ¨¡å‹çš„æ‰§è¡Œé€Ÿåº¦ä¼šæ›´å¿«ï¼Œä½†æ˜¯æ‰€éœ€ç¼–è¯‘æ—¶é—´ä¹Ÿä¼šå˜é•¿ã€‚</span></span><br><span class="line">  <span class="comment"># æ¨èç”¨O2åšæœ€å¿«éªŒè¯</span></span><br><span class="line">  optimize_level: <span class="string">&#x27;O3&#x27;</span></span><br></pre></td></tr></table></figure></div>

<p><em>å…¶ä¸­ï¼ŒONNXæ¨¡å‹æ— éœ€é…ç½® <code>model_parameters</code> å‚æ•°ç»„ä¸­çš„ <code>caffe_model</code> å’Œ <code>prototxt</code> å‚æ•°ï¼Œè€Œæ˜¯æ›¿æ¢ä¸ºé…ç½® <code>onnx_model</code> å‚æ•°ã€‚</em></p>
<p><em><code>input_parameters</code> å‚æ•°ç»„ä¸­çš„ <code>input_type_rt</code> å’Œ <code>input_type_train</code> å‚æ•°åˆ†åˆ«ç”¨äºæŒ‡å®šæ¨¡å‹åœ¨æ¿ç«¯å®é™…éƒ¨ç½²æ—¶ä¼šæ¥æ”¶åˆ°çš„æ•°æ®ç±»å‹ ï¼ˆå¦‚ nv12ï¼‰å’Œæœ¬èº«è®­ç»ƒæ—¶çš„æ•°æ®ç±»å‹ï¼ˆå¦‚ rgbï¼‰ã€‚å½“ä¸¤ç§æ•°æ®ç±»å‹ä¸ä¸€è‡´æ—¶ï¼Œè½¬æ¢å·¥å…·ä¼šè‡ªåŠ¨åœ¨æ¨¡å‹å‰ç«¯æ’å…¥ä¸€ä¸ªèƒ½ BPU åŠ é€Ÿçš„é¢„å¤„ç†èŠ‚ç‚¹ï¼Œä»¥å®Œæˆå¯¹åº”çš„é¢œè‰²ç©ºé—´è½¬æ¢ã€‚ åŒæ—¶ï¼Œè¯¥å‚æ•°ç»„ä¸­çš„ <code>norm_type</code> ã€ <code>mean_value</code> ã€ <code>scale_value</code> å‚æ•°è¿˜èƒ½ç”¨äºé…ç½®å›¾ç‰‡è¾“å…¥æ¨¡å‹çš„æ•°æ®å½’ä¸€åŒ–æ“ä½œï¼Œ é…ç½®åè½¬æ¢å·¥å…·ä¹Ÿä¼šå°†å…¶é›†æˆè¿›é¢„å¤„ç†èŠ‚ç‚¹å®ç°BPUåŠ é€Ÿã€‚æ•°æ®å½’ä¸€åŒ–çš„è®¡ç®—å…¬å¼ä¸ºï¼š</em></p>
<p><em><strong>data_norm&#x3D;(data - mean_value) * scale_value</strong></em></p>
<p><em><code>calibration_parameters</code> å‚æ•°ç»„ä¸­çš„ <code>cal_data_dir</code> å‚æ•°éœ€è¦é…ç½®é¢„å¤„ç†å¥½çš„æ ¡å‡†æ•°æ®æ–‡ä»¶å¤¹è·¯å¾„ï¼Œ é¢„å¤„ç†æ–¹å¼çš„è¯´æ˜è¯·å‚è€ƒ <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/faststart/quickstart.html#calibration-data-preprocess" >æ ¡å‡†æ•°æ®é¢„å¤„ç† <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ã€‚</em></p>
<p><em><strong>æ ¡å‡†æ•°æ®é¢„å¤„ç†</strong></em></p>
<p><em><strong>æ³¨æ„ï¼š</strong></em></p>
<ul>
<li><em>è¯·æ³¨æ„ï¼Œåœ¨è¿›è¡Œæ­¤æ­¥ä¹‹å‰ï¼Œè¯·ç¡®ä¿æ‚¨å·²ç»é€šè¿‡æ‰§è¡Œå¯¹åº”ç¤ºä¾‹ç›®å½•ä¸‹çš„ <code>00_init.sh</code> è„šæœ¬å®Œæˆäº†æ ¡å‡†æ•°æ®é›†çš„è·å–ã€‚</em></li>
<li><em>å¦‚æœå½“å‰åªå…³æ³¨æ¨¡å‹æ€§èƒ½ï¼Œé‚£ä¹ˆå¯ä»¥å°†yamlæ–‡ä»¶ä¸­çš„ <code>calibration_type</code> å‚æ•°ç›´æ¥é…ç½®ä¸º <code>skip</code> ï¼Œå¹¶è·³è¿‡æœ¬å°èŠ‚ï¼Œ å·¥å…·ä¼šåœ¨æ¨¡å‹è½¬æ¢æ—¶è‡ªåŠ¨å¿½ç•¥ <code>cal_data_dir</code> å‚æ•°ã€‚</em></li>
</ul>
<p><em>PTQæ–¹æ¡ˆçš„æ ¡å‡†æ•°æ®ä¸€èˆ¬æ˜¯ä»è®­ç»ƒé›†æˆ–éªŒè¯é›†ä¸­ç­›é€‰100ä»½å·¦å³ï¼ˆå¯é€‚å½“å¢å‡ï¼‰çš„å…¸å‹æ•°æ®ï¼Œå¹¶åº”é¿å…éå¸¸å°‘è§çš„å¼‚å¸¸æ ·æœ¬ï¼Œ å¦‚çº¯è‰²å›¾ç‰‡ã€ä¸å«ä»»ä½•æ£€æµ‹æˆ–åˆ†ç±»ç›®æ ‡çš„å›¾ç‰‡ç­‰ã€‚<strong>ç­›é€‰å‡ºçš„æ ¡å‡†æ•°æ®è¿˜éœ€è¿›è¡Œä¸æ¨¡å‹inferenceå‰ä¸€è‡´çš„é¢„å¤„ç†æ“ä½œï¼Œ å¤„ç†åä¿æŒä¸åŸå§‹æ¨¡å‹ä¸€æ ·çš„æ•°æ®ç±»å‹ï¼ˆ <code>input_type_train</code> ï¼‰ã€layout ï¼ˆ <code>input_layout_train</code> ï¼‰å’Œå°ºå¯¸ï¼ˆ <code>input_shape</code> ï¼‰ã€‚</strong></em></p>
<p><em>å¯¹äºæ ¡å‡†æ•°æ®çš„é¢„å¤„ç†ï¼Œåœ°å¹³çº¿å»ºè®®ç›´æ¥å‚è€ƒç¤ºä¾‹ä»£ç è¿›è¡Œä¿®æ”¹ä½¿ç”¨ã€‚ä»¥MobileNet-v1æ¨¡å‹ä¸ºä¾‹ï¼Œpreprocess.pyæ–‡ä»¶ä¸­ çš„calibration_transformerså‡½æ•°çš„åŒ…å«äº†å…¶æ ¡å‡†æ•°æ®çš„å‰å¤„ç† transformersï¼Œå¤„ç†å®Œçš„æ ¡å‡†æ•°æ®ä¸å…¶ yaml é…ç½®æ–‡ä»¶ä¿æŒä¸€è‡´ï¼Œå³ï¼š</em></p>
<ul>
<li><em><strong>input_type_train</strong> ï¼š â€˜bgrâ€™</em></li>
<li><em><strong>input_layout_train</strong> ï¼šâ€™NCHWâ€™</em></li>
</ul>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">calibration_transformers</span>():</span><br><span class="line">    transformers = [</span><br><span class="line">        ShortSideResizeTransformer(short_size=<span class="number">256</span>),</span><br><span class="line">        CenterCropTransformer(crop_size=<span class="number">224</span>),</span><br><span class="line">        HWC2CHWTransformer(),</span><br><span class="line">        RGB2BGRTransformer(data_format=<span class="string">&quot;CHW&quot;</span>),</span><br><span class="line">        ScaleTransformer(scale_value=<span class="number">255</span>),</span><br><span class="line">    ]</span><br><span class="line">    <span class="keyword">return</span> transformers</span><br></pre></td></tr></table></figure></div>

<p><em>å…¶ä¸­ï¼Œtransformerséƒ½å®šä¹‰åœ¨ <code>../../../01_common/python/data/transformer.py</code> æ–‡ä»¶ä¸­ï¼Œå…·ä½“è¯´æ˜ è¯·å‚è€ƒ <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/ptq/ptq_appendix/transformer.html" >å›¾ç‰‡å¤„ç†transformerè¯´æ˜ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ï¼Œæ‚¨å¯ä»¥æŒ‰éœ€é€‰ç”¨æˆ–è€…è‡ªå®šä¹‰ä¿®æ”¹åŠæ‰©å±•ã€‚</em></p>
<p><em><strong>æ³¨æ„ï¼šéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœå·²ç»åœ¨yamlæ–‡ä»¶ä¸­é…ç½®äº†æ•°æ®å½’ä¸€åŒ–æ¥å¯ç”¨BPUåŠ é€Ÿï¼Œé‚£ä¹ˆåº”é¿å…åœ¨æ­¤å¤„çš„transformersä¸­é‡å¤æ“ä½œã€‚</strong></em></p>
<p><em>ä¿®æ”¹å®Œpreprocess.pyæ–‡ä»¶åï¼Œå³å¯ä¿®æ”¹02_preprocess.shè„šæœ¬å¹¶æ‰§è¡Œï¼Œä»¥å®Œæˆæ ¡å‡†æ•°æ®çš„é¢„å¤„ç†ã€‚</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash 02_preprocess.sh</span><br></pre></td></tr></table></figure></div>

<p><em>02_preprocess.shè„šæœ¬æ–‡ä»¶çš„ä¸»è¦å†…å®¹å¦‚ä¸‹ï¼š</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">set -e -v</span><br><span class="line">cd $(dirname $0) || exit</span><br><span class="line"></span><br><span class="line">python3 ../../../data_preprocess.py \</span><br><span class="line">  --src_dir ../../../01_common/calibration_data/imagenet \</span><br><span class="line">  --dst_dir ./calibration_data_bgr \</span><br><span class="line">  --pic_ext .bgr \</span><br><span class="line">  --read_mode skimage \</span><br><span class="line">  --saved_data_type float32</span><br></pre></td></tr></table></figure></div>

<p><em>data_preprocess.pyæ–‡ä»¶çš„ä¼ å‚è¯´æ˜å¦‚ä¸‹ï¼š</em></p>
<ul>
<li><em>src_dirä¸ºåŸå§‹æ ¡å‡†æ•°æ®è·¯å¾„ã€‚</em></li>
<li><em>dst_dirä¸ºå¤„ç†åæ•°æ®çš„å­˜æ”¾è·¯å¾„ï¼Œå¯è‡ªå®šä¹‰ã€‚</em></li>
<li><em>pic_extä¸ºå¤„ç†åæ•°æ®çš„æ–‡ä»¶åç¼€ï¼Œä¸»è¦ç”¨äºå¸®åŠ©è®°å¿†æ•°æ®ç±»å‹ï¼Œå¯ä¸é…ç½®ã€‚</em></li>
<li><em>read_modeä¸ºå›¾ç‰‡è¯»å–æ–¹å¼ï¼Œå¯é…ç½®ä¸ºskimageæˆ–opencvã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œskimageè¯»å–çš„å›¾ç‰‡ç±»å‹ä¸ºRGBï¼Œ æ•°æ®èŒƒå›´ä¸º0-1ï¼Œè€Œopencvè¯»å–çš„å›¾ç‰‡ç±»å‹ä¸ºBGRï¼Œæ•°æ®èŒƒå›´ä¸º0-255ã€‚</em></li>
<li><em>saved_data_typeä¸ºå¤„ç†åæ•°æ®çš„ä¿å­˜ç±»å‹ã€‚</em></li>
</ul>
<p><em>å¦‚æœæ‚¨é€‰æ‹©è‡ªè¡Œç¼–å†™pythonä»£ç å®ç°æ ¡å‡†æ•°æ®é¢„å¤„ç†ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨ <code>numpy.tofile</code> å‘½ä»¤å°†å…¶ä¿å­˜ä¸ºfloat32 æ ¼å¼çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œ å·¥å…·é“¾æ ¡å‡†æ—¶ä¼šåŸºäº <code>numpy.fromfile</code> å‘½ä»¤è¿›è¡Œè¯»å–ã€‚</em></p>
<p><em><strong>è½¬æ¢æ¨¡å‹</strong></em></p>
<p><em>å‡†å¤‡å®Œæ ¡å‡†æ•°æ®å’Œyamlé…ç½®æ–‡ä»¶åï¼Œå³å¯ä¸€æ­¥å‘½ä»¤å®Œæˆæ¨¡å‹è§£æã€å›¾ä¼˜åŒ–ã€æ ¡å‡†ã€é‡åŒ–ã€ç¼–è¯‘çš„å…¨æµç¨‹è½¬æ¢ï¼Œ å†…éƒ¨è¿‡ç¨‹è¯¦è§£è¯·å‚è€ƒ <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/ptq/ptq_usage/quantize_compile.html#conversion-interpretation" >è½¬æ¢å†…éƒ¨è¿‡ç¨‹è§£è¯» <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ç« èŠ‚ã€‚ ä»¥MobileNet-v1æ¨¡å‹ä¸ºä¾‹çš„æ¨¡å‹è½¬æ¢å‚è€ƒå‘½ä»¤å¦‚ä¸‹ï¼š</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hb_mapper makertbin --config mobilenet_config.yaml \</span><br><span class="line">                    --model-type caffe</span><br></pre></td></tr></table></figure></div>

<p><em>è½¬æ¢å®Œæˆåï¼Œä¼šåœ¨yamlæ–‡ä»¶é…ç½®çš„ <code>working_dir</code> è·¯å¾„ä¸‹ä¿å­˜å„é˜¶æ®µæµç¨‹äº§å‡ºçš„æ¨¡å‹æ–‡ä»¶å’Œç¼–è¯‘å™¨é¢„ä¼°çš„ æ¨¡å‹BPUéƒ¨åˆ†çš„é™æ€æ€§èƒ½è¯„ä¼°æ–‡ä»¶ï¼Œè¯¦ç»†è¯´æ˜è¯·å‚è€ƒ <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/ptq/ptq_usage/quantize_compile.html#conversion-output" >è½¬æ¢äº§å‡ºç‰©è§£è¯» <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ç« èŠ‚ã€‚</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">|-- MOBILENET_subgraph_0.html        # é™æ€æ€§èƒ½è¯„ä¼°æ–‡ä»¶ï¼ˆå¯è¯»æ€§æ›´å¥½ï¼‰</span><br><span class="line">|-- MOBILENET_subgraph_0.json        # é™æ€æ€§èƒ½è¯„ä¼°æ–‡ä»¶</span><br><span class="line">|-- mobilenetv1_224x224_nv12.bin     # ç”¨äºåœ¨åœ°å¹³çº¿AIèŠ¯ç‰‡ä¸ŠåŠ è½½è¿è¡Œçš„æ¨¡å‹</span><br><span class="line">|-- mobilenetv1_224x224_nv12_optimized_float_model.onnx</span><br><span class="line">|-- mobilenetv1_224x224_nv12_original_float_model.onnx</span><br><span class="line">`-- mobilenetv1_224x224_nv12_quantized_model.onnx</span><br></pre></td></tr></table></figure></div>



<blockquote>
<p><em>æ€§èƒ½å¿«é€ŸéªŒè¯</em></p>
</blockquote>
<p><em>é’ˆå¯¹è½¬æ¢ç”Ÿæˆçš„ <code>xxx.bin</code> æ¨¡å‹æ–‡ä»¶ï¼Œåœ°å¹³çº¿æ—¢æ”¯æŒå…ˆåœ¨å¼€å‘æœºç«¯é¢„ä¼°æ¨¡å‹BPUéƒ¨åˆ†çš„çš„é™æ€æ€§èƒ½ï¼Œ ä¹Ÿåœ¨æ¿ç«¯æä¾›ç»™äº†æ— éœ€ä»»ä½•ä»£ç å¼€å‘çš„å¯æ‰§è¡Œå·¥å…·å¿«é€Ÿè¯„æµ‹åŠ¨æ€æ€§èƒ½ï¼Œä»¥ä¸‹å°†åˆ†åˆ«è¿›è¡Œä»‹ç»ã€‚ æ›´è¯¦ç»†çš„è¯´æ˜å’Œæ€§èƒ½è°ƒä¼˜å»ºè®®è¯·å‚è€ƒ <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/ptq/ptq_usage/performance_evaluation.html" >æ¨¡å‹æ€§èƒ½åˆ†æä¸è°ƒä¼˜ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ç« èŠ‚ã€‚</em></p>
<p><em><strong>é™æ€æ€§èƒ½è¯„ä¼°</strong></em></p>
<p><em>å¦‚ <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/faststart/quickstart.html#quickstart-model-conv" >è½¬æ¢æ¨¡å‹ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> æ‰€è¿°ï¼Œæ¨¡å‹æˆåŠŸè½¬æ¢åä¼šåœ¨ <code>working_dir</code> è·¯å¾„ä¸‹ç”ŸæˆåŒ…å«æ¨¡å‹é™æ€æ€§èƒ½é¢„ä¼°çš„htmlå’Œjsonæ–‡ä»¶ï¼Œä¸¤è€…å†…å®¹ç›¸åŒï¼Œ ä½†htmlæ–‡ä»¶çš„å¯è¯»æ€§æ›´å¥½ã€‚ä»¥ä¸‹ä¸ºMobileNet-v1æ¨¡å‹è½¬æ¢ç”Ÿæˆçš„htmlæ–‡ä»¶ï¼Œå…¶ä¸­ï¼š</em></p>
<ul>
<li><em>Summaryé€‰é¡¹å¡æä¾›äº†ç¼–è¯‘å™¨é¢„ä¼°çš„æ¨¡å‹BPUéƒ¨åˆ†æ€§èƒ½ï¼ˆä¸åŒ…å«CPUç®—å­æ€§èƒ½é¢„ä¼°ï¼‰ã€‚</em></li>
</ul>
<p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230508193519478.png"
                      class="" title="image-20230508193519478"
                ></em></p>
<ul>
<li><em>Temporal Statisticsé€‰é¡¹å¡å†…åˆ™ä¸»è¦æä¾›äº†æ¨¡å‹ä¸€å¸§æ¨ç†æ—¶é—´å†…çš„å¸¦å®½å ç”¨æƒ…å†µã€‚</em></li>
</ul>
<p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230508193533794.png"
                      class="" title="image-20230508193533794"
                ></em></p>
<ul>
<li><em>å¦å¤–ï¼Œå¦‚æœæˆ‘ä»¬åœ¨yamlæ–‡ä»¶ <code>compiler_parameters</code> å‚æ•°ç»„å†…é…ç½®äº† <code>debug</code> å‚æ•°ä¸ºTrueï¼Œé‚£ä¹ˆhtmlæ–‡ä»¶ä¸­ è¿˜ä¼šå¢åŠ Layer Detailsé€‰é¡¹å¡ï¼Œå…¶ä¸­åŒ…å«äº†æ¯ä¸€å±‚BPUç®—å­çš„è®¡ç®—é‡ã€è®¡ç®—è€—æ—¶å’Œæ•°æ®æ¬è¿è€—æ—¶ã€‚</em></li>
</ul>
<p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230508193547284.png"
                      class="" title="image-20230508193547284"
                ></em></p>
<p><em>é’ˆå¯¹ <code>xxx.bin</code> æ¨¡å‹ï¼Œåœ°å¹³çº¿åœ¨å¼€å‘æœºç¯å¢ƒè¿˜æä¾›äº† <code>hb_perf å·¥å…·</code> é‡æ–°ç”Ÿæˆé™æ€æ€§èƒ½é¢„ä¼°æ–‡ä»¶ã€‚å…¶ä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼Œ è¯¦ç»†è¯´æ˜è¯·å‚è€ƒ <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/ptq/ptq_usage/performance_evaluation.html#hb-perf" >ä½¿ç”¨hb_perfå·¥å…·ä¼°è®¡æ€§èƒ½ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ç« èŠ‚ã€‚</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hb_perf xxx.bin</span><br></pre></td></tr></table></figure></div>

<p><em>å½“æ¨¡å‹çš„é™æ€æ€§èƒ½å·²ç»ä¸ç¬¦åˆé¢„æœŸæ—¶ï¼Œè¯·å‚è€ƒ <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/ptq/ptq_usage/performance_evaluation.html#model-performance-optimize" >æ¨¡å‹æ€§èƒ½ä¼˜åŒ– <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ç« èŠ‚è¿›è¡Œæ€§èƒ½è°ƒä¼˜ã€‚</em></p>
<p><em><strong>åŠ¨æ€æ€§èƒ½è¯„ä¼°</strong></em></p>
<p><em>å½“æ¨¡å‹çš„é™æ€æ€§èƒ½ç¬¦åˆé¢„æœŸåï¼Œæˆ‘ä»¬å¯ä»¥è¿›ä¸€æ­¥ä¸Šæ¿å®æµ‹æ¨¡å‹çš„åŠ¨æ€æ€§èƒ½ï¼Œå…¶å‚è€ƒæ–¹å¼å¦‚ä¸‹ï¼š</em></p>
<p><em>1.é¦–å…ˆè¯·ç¡®ä¿å·²æŒ‰ç…§ <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/env_install/env_deploy.html" >ç¯å¢ƒéƒ¨ç½² <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ç« èŠ‚å®Œæˆå¼€å‘æ¿ç¯å¢ƒéƒ¨ç½²ã€‚</em></p>
<p><em>2.å°†è½¬æ¢ç”Ÿæˆçš„ <code>xxx.bin</code> æ¨¡å‹æ‹·è´è‡³å¼€å‘æ¿ <code>/userdata</code> æ–‡ä»¶å¤¹ä¸‹ä»»æ„è·¯å¾„ã€‚</em></p>
<p><em>3.é€šè¿‡ <code>hrt_model_exec perf</code> å·¥å…·å¿«æ·è¯„ä¼°æ¨¡å‹çš„è€—æ—¶å’Œå¸§ç‡ã€‚</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># å°†æ¨¡å‹æ‹·è´è‡³å¼€å‘æ¿</span><br><span class="line">scp model_output/mobilenetv1_224x224_nv12.bin root@&#123;board_ip&#125;:/userdata</span><br><span class="line"></span><br><span class="line"># ç™»å½•å¼€å‘æ¿è¯„æµ‹æ€§èƒ½</span><br><span class="line">ssh root@&#123;board_ip&#125;</span><br><span class="line">cd /userdata</span><br><span class="line"></span><br><span class="line"># å•BPUæ ¸å•çº¿ç¨‹ä¸²è¡ŒçŠ¶æ€ä¸‹è¯„æµ‹latency</span><br><span class="line">hrt_model_exec perf --model_file mobilenetv1_224x224_nv12.bin --thread_num 1 --frame_count 1000</span><br><span class="line"></span><br><span class="line"># åŒBPUæ ¸å¤šçº¿ç¨‹å¹¶å‘çŠ¶æ€ä¸‹è¯„æµ‹FPS</span><br><span class="line">hrt_model_exec perf --model_file mobilenetv1_224x224_nv12.bin --core_id 0 --thread_num 4 --frame_count 1000</span><br></pre></td></tr></table></figure></div>

<p><em><code>hrt_model_exec</code> å·¥å…·çš„ä¸»è¦å‚æ•°è¯´æ˜å¦‚ä¸‹ï¼Œæ›´å¤šè¯´æ˜è¯·å‚è€ƒ <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/runtime/source/tool_introduction/source/hrt_model_exec.html" >hrt_model_execå·¥å…·ä»‹ç» <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ç« èŠ‚ã€‚</em></p>
<table>
<thead>
<tr>
<th align="left"><em>å‚æ•°</em></th>
<th align="left"><em>ç±»å‹</em></th>
<th align="left"><em>è¯´æ˜</em></th>
</tr>
</thead>
<tbody><tr>
<td align="left"><em>model_file</em></td>
<td align="left"><em>string</em></td>
<td align="left"><em>[å¿…é€‰]æ¨¡å‹æ–‡ä»¶è·¯å¾„</em></td>
</tr>
<tr>
<td align="left"><em>core_id</em></td>
<td align="left"><em>int</em></td>
<td align="left"><em>[å¯é€‰]ç”¨äºæŒ‡å®šBPUè¿è¡Œæ ¸å¿ƒï¼Œé»˜è®¤å€¼ä¸º0ã€‚0ï¼šä»»æ„æ ¸ï¼Œé¢„æµ‹åº“ä¼šæ ¹æ®è´Ÿè½½æƒ…å†µè‡ªåŠ¨åˆ†é…è°ƒåº¦ã€‚1ï¼šcore0ã€‚2ï¼šcore1ã€‚</em></td>
</tr>
<tr>
<td align="left"><em>thread_num</em></td>
<td align="left"><em>int</em></td>
<td align="left"><em>[å¯é€‰]ç¨‹åºè¿è¡Œçº¿ç¨‹æ•°ï¼Œå¯é€‰èŒƒå›´[1,8]ï¼Œé»˜è®¤å€¼1ã€‚</em></td>
</tr>
<tr>
<td align="left"><em>frame_count</em></td>
<td align="left"><em>int</em></td>
<td align="left"><em>[å¯é€‰]æ¨¡å‹è¿è¡Œæ€»å¸§æ•°ï¼Œé»˜è®¤å€¼200ã€‚</em></td>
</tr>
<tr>
<td align="left"><em>profile_path</em></td>
<td align="left"><em>string</em></td>
<td align="left"><em>[å¯é€‰]ç»Ÿè®¡å·¥å…·æ—¥å¿—äº§ç”Ÿè·¯å¾„ï¼Œè¿è¡Œäº§ç”Ÿprofiler.logå’Œprofiler.csvï¼Œåˆ†æopè€—æ—¶å’Œè°ƒåº¦è€—æ—¶ã€‚</em></td>
</tr>
</tbody></table>
<p><em>æ³¨è§£</em></p>
<ul>
<li><em>å¦‚æœæ‚¨åœ¨æ¿ç«¯æ— æ³•æ‰¾åˆ° <code>hrt_model_exec</code> å·¥å…·ï¼Œå¯ä»¥å†æ‰§è¡Œä¸€æ¬¡OEåŒ…ä¸­ <code>ddk/package/board</code> è·¯å¾„ä¸‹çš„ <code>install.sh</code> è„šæœ¬ã€‚</em></li>
<li><em>è¯„æµ‹Latencyæ—¶ä¸€èˆ¬é‡‡ç”¨å•çº¿ç¨‹ä¸²è¡Œçš„æ¨ç†æ–¹å¼ï¼Œå¯ä»¥æŒ‡å®š <code>thread_num</code> ä¸º 1ã€‚</em></li>
<li><em>è¯„æµ‹FPSæ—¶ä¸€èˆ¬é‡‡ç”¨å¤šçº¿ç¨‹å¹¶å‘çš„æ¨ç†æ–¹å¼æ¥å æ»¡BPUèµ„æºï¼Œæ­¤æ—¶å¯ä»¥é…ç½® <code>core_id</code> ä¸º 0ï¼Œå¹¶é…ç½® <code>thread_num</code> ä¸ºå¤šçº¿ç¨‹ã€‚</em></li>
<li><em><strong>å¦‚æœæ‚¨é…ç½®äº† <code>profile_path</code> å‚æ•°ï¼Œç¨‹åºéœ€è¦æ­£å¸¸è¿è¡Œç»“æŸæ‰ä¼šç”Ÿæˆ <code>profiler.log</code> å’Œ <code>profiler.csv</code> æ—¥å¿—æ–‡ä»¶ï¼Œè¯·å‹¿ä½¿ç”¨ <code>Ctrl+C</code> å‘½ä»¤ä¸­æ–­ç¨‹åºã€‚</strong></em></li>
</ul>
<p><em>å½“æ¨¡å‹çš„åŠ¨æ€æ€§èƒ½ä¸ç¬¦åˆé¢„æœŸæ—¶ï¼Œè¯·å‚è€ƒ <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/ptq/ptq_usage/performance_evaluation.html#model-performance-optimize" >æ¨¡å‹æ€§èƒ½ä¼˜åŒ– <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ç« èŠ‚è¿›è¡Œæ€§èƒ½è°ƒä¼˜ã€‚</em></p>
<blockquote>
<p><em>åœ¨æ·±åº¦å­¦ä¹ ä¸­ï¼ŒFPSï¼ˆFrames Per Secondï¼‰æ˜¯ç”¨äºè¡¡é‡è®¡ç®—æœºæˆ–å¤„ç†å™¨åœ¨æ¨ç†æˆ–è®­ç»ƒç¥ç»ç½‘ç»œæ¨¡å‹æ—¶ï¼Œ<strong>æ¯ç§’å¯ä»¥å¤„ç†å¤šå°‘ä¸ªæ•°æ®æ ·æœ¬æˆ–å›¾åƒå¸§çš„æŒ‡æ ‡</strong>ã€‚FPSè¶Šé«˜ï¼Œè¯´æ˜å¤„ç†å™¨çš„æ€§èƒ½è¶Šå¥½ï¼Œå¤„ç†é€Ÿåº¦è¶Šå¿«ã€‚</em></p>
<p><em>åœ¨æ¨ç†ä»»åŠ¡ä¸­ï¼ŒFPSé€šå¸¸æŒ‡çš„æ˜¯ç¥ç»ç½‘ç»œæ¨¡å‹çš„å‰å‘è®¡ç®—é€Ÿåº¦ï¼Œå³è¾“å…¥æ•°æ®æ ·æœ¬é€šè¿‡ç¥ç»ç½‘ç»œæ¨¡å‹ï¼Œç”Ÿæˆè¾“å‡ºç»“æœçš„é€Ÿåº¦ã€‚åœ¨è®­ç»ƒä»»åŠ¡ä¸­ï¼ŒFPSé€šå¸¸æŒ‡çš„æ˜¯ç¥ç»ç½‘ç»œæ¨¡å‹æ¯ç§’é’Ÿå¯ä»¥è®­ç»ƒå¤šå°‘ä¸ªæ•°æ®æ ·æœ¬çš„é€Ÿåº¦ï¼Œå³ä¸€æ¬¡åå‘ä¼ æ’­å’Œæ¢¯åº¦æ›´æ–°çš„é€Ÿåº¦ã€‚</em></p>
<p><em>FPSé™¤äº†è¡¡é‡å¤„ç†å™¨çš„æ€§èƒ½å¤–ï¼Œè¿˜å¯ä»¥ç”¨äºç¡®å®šç¥ç»ç½‘ç»œæ¨¡å‹åœ¨ä¸åŒç¡¬ä»¶å¹³å°ä¸Šçš„æ€§èƒ½è¡¨ç°ï¼Œä»¥ä¾¿é€‰æ‹©æœ€é€‚åˆçš„ç¡¬ä»¶è¿›è¡Œæ¨¡å‹éƒ¨ç½²å’Œä¼˜åŒ–ã€‚</em></p>
</blockquote>
<blockquote>
<p><em>åœ¨æ·±åº¦å­¦ä¹ ä¸­ï¼Œå»¶è¿Ÿï¼ˆlatencyï¼‰æŒ‡çš„æ˜¯ä»è¾“å…¥æ•°æ®è¿›å…¥æ¨¡å‹ï¼Œç»è¿‡æ¨¡å‹è®¡ç®—å’Œå¤„ç†ï¼Œåˆ°æœ€ç»ˆè¾“å‡ºç»“æœå¯ç”¨çš„æ—¶é—´é—´éš”ã€‚å®ƒæ˜¯è¡¡é‡æ¨¡å‹æ¨ç†æˆ–è®­ç»ƒè¿‡ç¨‹ä¸­çš„æ—¶é—´å»¶è¿Ÿæˆ–å“åº”æ—¶é—´çš„æŒ‡æ ‡ã€‚</em></p>
<p><em>å¯¹äºæ¨¡å‹æ¨ç†ï¼Œå»¶è¿Ÿæ˜¯æŒ‡ä»è¾“å…¥æ•°æ®ä¼ å…¥æ¨¡å‹ï¼Œé€šè¿‡å‰å‘ä¼ æ’­è®¡ç®—ï¼Œåˆ°è¾“å‡ºç»“æœå¯ç”¨çš„æ—¶é—´ã€‚å¯¹äºå®æ—¶åº”ç”¨ï¼Œå¦‚è§†é¢‘å¤„ç†ã€ç‰©ä½“æ£€æµ‹æˆ–è¯­éŸ³è¯†åˆ«ï¼Œè¾ƒä½çš„å»¶è¿Ÿæ˜¯éå¸¸é‡è¦çš„ï¼Œä»¥ç¡®ä¿ç³»ç»Ÿèƒ½å¤Ÿå¿«é€Ÿå“åº”å’Œå¤„ç†å®æ—¶æ•°æ®ã€‚</em></p>
<p><em>å¯¹äºæ¨¡å‹è®­ç»ƒï¼Œå»¶è¿Ÿæ˜¯æŒ‡æ¯ä¸ªè®­ç»ƒæ­¥éª¤æˆ–æ‰¹æ¬¡çš„è®¡ç®—æ—¶é—´ã€‚è¾ƒä½çš„è®­ç»ƒå»¶è¿Ÿæ„å‘³ç€æ¨¡å‹å¯ä»¥æ›´å¿«åœ°å®Œæˆä¸€è½®è®­ç»ƒæˆ–å¤„ç†æ›´å¤šçš„æ•°æ®ã€‚å‡å°‘è®­ç»ƒå»¶è¿Ÿå¯ä»¥åŠ å¿«æ¨¡å‹çš„è¿­ä»£é€Ÿåº¦ï¼ŒåŠ é€Ÿå®éªŒå’Œè°ƒå‚è¿‡ç¨‹ã€‚</em></p>
<p><em>å»¶è¿Ÿçš„å¤§å°å–å†³äºå¤šä¸ªå› ç´ ï¼ŒåŒ…æ‹¬ç¡¬ä»¶è®¾å¤‡çš„æ€§èƒ½ï¼ˆå¦‚CPUã€GPUæˆ–TPUï¼‰ã€æ¨¡å‹çš„å¤æ‚åº¦å’Œå¤§å°ã€è¾“å…¥æ•°æ®çš„å¤§å°ç­‰ã€‚å¯¹äºå¤§è§„æ¨¡æ·±åº¦å­¦ä¹ æ¨¡å‹å’Œå¤æ‚ä»»åŠ¡ï¼Œå¯èƒ½éœ€è¦æ›´å¼ºå¤§çš„ç¡¬ä»¶è®¾å¤‡å’Œä¼˜åŒ–æŠ€æœ¯æ¥å‡å°å»¶è¿Ÿå¹¶å®ç°å®æ—¶æ€§èƒ½ã€‚</em></p>
</blockquote>
<blockquote>
<p><em>ç²¾åº¦éªŒè¯</em></p>
</blockquote>
<p><em>å½“æ¨¡å‹çš„æ€§èƒ½éªŒè¯ç¬¦åˆé¢„æœŸåï¼Œå³å¯è¿›è¡Œåç»­çš„ç²¾åº¦éªŒè¯ã€‚è¯·é¦–å…ˆç¡®ä¿æ‚¨å·²ç»å‡†å¤‡å¥½ç›¸å…³çš„è¯„æµ‹æ•°æ®é›†ï¼Œå¹¶æŒ‚è½½åœ¨Dockerå®¹å™¨ä¸­ã€‚ ç¤ºä¾‹æ¨¡å‹ä½¿ç”¨çš„æ•°æ®é›†å¯ä»¥ä»ä»¥ä¸‹é“¾æ¥è·å–ï¼š</em></p>
<table>
<thead>
<tr>
<th align="left"><em><strong>æ•°æ®é›†</strong></em></th>
<th align="left"><em><strong>ä¸‹è½½åœ°å€</strong></em></th>
<th align="left"><em><strong>ä¸‹è½½ç»“æ„</strong></em></th>
</tr>
</thead>
<tbody><tr>
<td align="left"><em>ImageNet</em></td>
<td align="left"><em><a class="link"   target="_blank" rel="noopener" href="https://www.image-net.org/download.php" >https://www.image-net.org/download.php <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></em></td>
<td align="left"><em>ä¸‹è½½ç»“æ„è¯·æ‚¨å‚è€ƒ <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/ptq/ptq_sample/algorithm_sample.html#imagenet-prepare" >ImageNetæ•°æ®é›†å‚è€ƒç»“æ„ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></em></td>
</tr>
<tr>
<td align="left"><em>COCO</em></td>
<td align="left"><em><a class="link"   target="_blank" rel="noopener" href="https://cocodataset.org/" >https://cocodataset.org/ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></em></td>
<td align="left"><em>ä¸‹è½½ç»“æ„è¯·æ‚¨å‚è€ƒ <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/ptq/ptq_sample/algorithm_sample.html#coco-prepare" >COCOæ•°æ®é›†å‚è€ƒç»“æ„ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></em></td>
</tr>
<tr>
<td align="left"><em>VOC</em></td>
<td align="left"><em><a class="link"   target="_blank" rel="noopener" href="http://host.robots.ox.ac.uk/pascal/VOC/" >http://host.robots.ox.ac.uk/pascal/VOC/ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></em></td>
<td align="left"><em>éœ€è¦ä¸‹è½½2007å’Œ2012ä¸¤ä¸ªç‰ˆæœ¬ï¼Œä¸‹è½½ç»“æ„è¯·æ‚¨å‚è€ƒ <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/ptq/ptq_sample/algorithm_sample.html#voc-prepare" >VOCæ•°æ®é›†å‚è€ƒç»“æ„ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></em></td>
</tr>
<tr>
<td align="left"><em>Cityscapes</em></td>
<td align="left"><em><a class="link"   target="_blank" rel="noopener" href="https://github.com/mcordts/cityscapesScripts" >https://github.com/mcordts/cityscapesScripts <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></em></td>
<td align="left"><em>ä¸‹è½½ç»“æ„è¯·æ‚¨å‚è€ƒ <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/ptq/ptq_sample/algorithm_sample.html#cityscapes-prepare" >Cityscapesæ•°æ®é›†å‚è€ƒç»“æ„ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></em></td>
</tr>
<tr>
<td align="left"><em>CIFAR-10</em></td>
<td align="left"><em><a class="link"   target="_blank" rel="noopener" href="http://www.cs.toronto.edu/~kriz/cifar.html" >http://www.cs.toronto.edu/~kriz/cifar.html <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></em></td>
<td align="left"><em>ä¸‹è½½ç»“æ„è¯·æ‚¨å‚è€ƒ <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/ptq/ptq_sample/algorithm_sample.html#cifar-prepare" >CIFAR-10æ•°æ®é›†å‚è€ƒç»“æ„ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></em></td>
</tr>
<tr>
<td align="left"><em>FlyingChairs</em></td>
<td align="left"><em><a class="link"   target="_blank" rel="noopener" href="https://lmb.informatik.uni-freiburg.de/resources/datasets/FlyingChairs.en.html" >https://lmb.informatik.uni-freiburg.de/resources/datasets/FlyingChairs.en.html <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></em></td>
<td align="left"><em>ä¸‹è½½ç»“æ„è¯·æ‚¨å‚è€ƒ <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/runtime/source/ai_benchmark/source/ai-benchmark.html#qat-dataset-prepare" >QATæ¨¡å‹æ•°æ®é¢„å¤„ç† <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ä¸­çš„ç›¸å…³æè¿°</em></td>
</tr>
<tr>
<td align="left"><em>KITTI3D</em></td>
<td align="left"><em><a class="link"   target="_blank" rel="noopener" href="https://www.cvlibs.net/datasets/kitti/eval_object.php?obj_benchmark=3d" >https://www.cvlibs.net/datasets/kitti/eval_object.php?obj_benchmark=3d <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></em></td>
<td align="left"><em>ä¸‹è½½ç»“æ„è¯·æ‚¨å‚è€ƒ <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/runtime/source/ai_benchmark/source/ai-benchmark.html#qat-dataset-prepare" >QATæ¨¡å‹æ•°æ®é¢„å¤„ç† <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ä¸­çš„ç›¸å…³æè¿°</em></td>
</tr>
<tr>
<td align="left"><em>CULane</em></td>
<td align="left"><em><a class="link"   target="_blank" rel="noopener" href="https://xingangpan.github.io/projects/CULane.html" >https://xingangpan.github.io/projects/CULane.html <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></em></td>
<td align="left"><em>ä¸‹è½½ç»“æ„è¯·æ‚¨å‚è€ƒ <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/runtime/source/ai_benchmark/source/ai-benchmark.html#qat-dataset-prepare" >QATæ¨¡å‹æ•°æ®é¢„å¤„ç† <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ä¸­çš„ç›¸å…³æè¿°</em></td>
</tr>
<tr>
<td align="left"><em>nuScenes</em></td>
<td align="left"><em><a class="link"   target="_blank" rel="noopener" href="https://www.nuscenes.org/nuscenes" >https://www.nuscenes.org/nuscenes <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></em></td>
<td align="left"><em>ä¸‹è½½ç»“æ„è¯·æ‚¨å‚è€ƒ <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/runtime/source/ai_benchmark/source/ai-benchmark.html#qat-dataset-prepare" >QATæ¨¡å‹æ•°æ®é¢„å¤„ç† <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ä¸­çš„ç›¸å…³æè¿°</em></td>
</tr>
</tbody></table>
<p><em>å¦‚æœæ‚¨åœ¨æ•°æ®å‡†å¤‡è¿‡ç¨‹ä¸­æœ‰é‡åˆ°é—®é¢˜ï¼Œå¯ä»¥å‰å¾€ <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/forum" >åœ°å¹³çº¿å¼€å‘è€…ç¤¾åŒº <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> å‘å¸–è¿›è¡Œæ±‚åŠ©ã€‚</em></p>
<p><em>å¦‚ <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/faststart/quickstart.html#quickstart-model-conv" >è½¬æ¢æ¨¡å‹ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> æ‰€è¿°ï¼Œæ¨¡å‹è½¬æ¢ä¼šç”Ÿæˆ <code>xxx_quantized_model.onnx</code> å’Œ <code>xxx.bin</code> ä¸¤ä¸ªé‡åŒ–æ¨¡å‹ï¼Œä¸¤è€…è¾“å‡ºæ˜¯ä¿æŒæ•°å€¼ä¸€è‡´çš„ã€‚ æ‚¨ä¹Ÿå¯ä»¥åœ¨å¼€å‘æœºç¯å¢ƒä½¿ç”¨ <code>hb_verifier</code> å·¥å…·è¿›è¡Œä¸€è‡´æ€§éªŒè¯ï¼Œå‚è€ƒå‘½ä»¤å¦‚ä¸‹ï¼Œ è¯¦ç»†è¯´æ˜è¯·å‚è€ƒ <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/ptq/ptq_tool/hb_verifier.html" >hb_verifier å·¥å…· <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ç« èŠ‚ã€‚</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hb_verifier -m quanti.onnx,model.bin -b *.*.*.* -s True (-i é€‰å¡«)</span><br></pre></td></tr></table></figure></div>

<p><em><code>hb_verifier</code> å·¥å…·çš„å‚æ•°è¯´æ˜å¦‚ä¸‹ï¼š</em></p>
<table>
<thead>
<tr>
<th align="left"><em>å‚æ•°</em></th>
<th align="left"><em>è¯´æ˜</em></th>
</tr>
</thead>
<tbody><tr>
<td align="left"><em>â€“model, -m</em></td>
<td align="left"><em>[å¿…é€‰]å®šç‚¹æ¨¡å‹åç§°å’Œbinæ¨¡å‹åç§°ï¼Œå¤šæ¨¡å‹ä¹‹é—´ç”¨â€,â€è¿›è¡ŒåŒºåˆ†ã€‚</em></td>
</tr>
<tr>
<td align="left"><em>â€“board-ip&#x2F;-b</em></td>
<td align="left"><em>[å¯é€‰]ä¸Šæ¿æµ‹è¯•ä½¿ç”¨çš„arm board ipåœ°å€ã€‚</em></td>
</tr>
<tr>
<td align="left"><em>â€“run-sim&#x2F;-s</em></td>
<td align="left"><em>[å¯é€‰]è®¾ç½®æ˜¯å¦ä½¿ç”¨X86ç¯å¢ƒçš„libdnnåšbinæ¨¡å‹æ¨ç†ï¼Œé»˜è®¤ä¸ºFalseã€‚ï¼ˆ<strong>libdnnæŒ‡çš„æ˜¯ç”¨äºæ·±åº¦ç¥ç»ç½‘ç»œçš„åº“æˆ–è½¯ä»¶åŒ…</strong>ï¼‰</em></td>
</tr>
<tr>
<td align="left"><em>â€“input-img&#x2F;-i</em></td>
<td align="left"><em>[å¯é€‰]æŒ‡å®šæ¨ç†æµ‹è¯•æ—¶ä½¿ç”¨çš„å›¾ç‰‡ã€‚è‹¥ä¸æŒ‡å®šåˆ™ä¼šä½¿ç”¨éšæœºç”Ÿæˆçš„tensoræ•°æ®ã€‚ è‹¥æŒ‡å®šå›¾ç‰‡ä¸ºäºŒè¿›åˆ¶å½¢å¼çš„å›¾ç‰‡æ–‡ä»¶ï¼Œå…¶æ–‡ä»¶å½¢å¼éœ€è¦ä¸ºåç¼€åä¸º <code>.bin</code> å½¢å¼ã€‚å¤šè¾“å…¥æ¨¡å‹æ·»åŠ å›¾ç‰‡çš„æ–¹å¼æœ‰ä»¥ä¸‹ä¸¤ç§ä¼ å‚æ–¹å¼ï¼Œå¤šå¼ å›¾ç‰‡ä¹‹é—´ç”¨â€,â€åˆ†å‰²ï¼šinput_name1:image1,input_name2:image2, â€¦image1,image2â€¦</em></td>
</tr>
<tr>
<td align="left"><em>â€“compare_digits&#x2F;-c</em></td>
<td align="left"><em>[å¯é€‰]è®¾ç½®æ¯”è¾ƒæ¨ç†ç»“æœçš„æ•°å€¼ç²¾ç¡®åº¦ï¼ˆå³æ¯”è¾ƒæ•°å€¼å°æ•°ç‚¹åçš„ä½æ•°ï¼‰ï¼Œ è‹¥ä¸è¿›è¡ŒæŒ‡å®šåˆ™å·¥å…·ä¼šé»˜è®¤æ¯”è¾ƒè‡³å°æ•°ç‚¹åäº”ä½ã€‚</em></td>
</tr>
<tr>
<td align="left"><em>â€“dump-all-nodes-results&#x2F;-r</em></td>
<td align="left"><em>[å¯é€‰]è®¾ç½®æ˜¯å¦ä¿å­˜æ¨¡å‹ä¸­å„ä¸ªç®—å­çš„è¾“å‡ºç»“æœï¼Œå¹¶å¯¹ç®—å­è¾“å‡ºåç§°ç›¸åŒçš„ç»“æœè¿›è¡Œå¯¹æ¯”ï¼Œé»˜è®¤ä¸ºFalseã€‚å½“è¯¥å‚æ•°è®¾ç½®ä¸º <code>True</code> æ—¶ï¼Œå·¥å…·å°†ä¼šè·å–æ¨¡å‹ä¸­æ‰€æœ‰èŠ‚ç‚¹çš„è¾“å‡ºï¼Œå¹¶æ ¹æ®èŠ‚ç‚¹è¾“å‡ºçš„åå­—åšåŒ¹é…ï¼Œä»è€Œè¿›è¡Œå¯¹æ¯”ã€‚å½“è¯¥å‚æ•°è®¾ç½®ä¸º <code>False</code> æ—¶ï¼Œå·¥å…·å°†ä¼šåªè·å–æ¨¡å‹æœ€ç»ˆè¾“å‡ºçš„ç»“æœï¼Œå¹¶è¿›è¡Œå¯¹æ¯”ã€‚<strong>è¯·æ‚¨æ³¨æ„ï¼Œç›®å‰åŸºäºæ€§èƒ½è€ƒè™‘ï¼Œæš‚ä¸æ”¯æŒæ‚¨åœ¨X86ç¯å¢ƒä¸‹ä½¿ç”¨dumpåŠŸèƒ½ã€‚</strong></em></td>
</tr>
</tbody></table>
<p><em>ç›¸æ¯”äº <code>xxx.bin</code> ï¼Œ<strong>åœ°å¹³çº¿æ›´å»ºè®®ä¼˜å…ˆåœ¨å¼€å‘æœºPythonç¯å¢ƒè¯„æµ‹ <code>xxx_quantized_model.onnx</code> æ¨¡å‹çš„é‡åŒ–ç²¾åº¦</strong>ï¼Œå…¶è¯„æµ‹æ–¹å¼æ›´åŠ ç®€å•å¿«æ·ï¼Œ å…·ä½“è¯·è§ <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/faststart/quickstart.html#board-python-env" >å¼€å‘æœºPythonç¯å¢ƒéªŒè¯ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ã€‚ <code>xxx.bin</code> åœ¨æ¿ç«¯åŸºäºC++ä»£ç çš„è¯„æµ‹è¯´æ˜è¯·è§ <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/faststart/quickstart.html#board-cpp-env" >å¼€å‘æ¿C++ç¯å¢ƒéªŒè¯ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ï¼Œ æ›´è¯¦ç»†çš„ç²¾åº¦éªŒè¯å’Œä¼˜åŒ–å»ºè®®è¯·å‚è€ƒ <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/ptq/ptq_usage/accuracy_evaluation.html" >æ¨¡å‹ç²¾åº¦åˆ†æä¸è°ƒä¼˜ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ç« èŠ‚ã€‚</em></p>
<p><em><strong>å¼€å‘æœºPythonç¯å¢ƒéªŒè¯</strong></em></p>
<p><em>ä»¥ MobileNet-v1 æ¨¡å‹ä¸ºä¾‹ï¼Œmobilenetv1_224x224_nv12_quantized_model.onnxé‡åŒ–æ¨¡å‹çš„å•å¼ æ¨ç†å’ŒéªŒè¯é›†ç²¾åº¦è¯„æµ‹ç¤ºä¾‹è¯·å‚è€ƒ ç¤ºä¾‹ç›®å½•ä¸­çš„ <code>04_inference.sh</code> å’Œ <code>05_evaluate.sh</code> è„šæœ¬ï¼Œå‚è€ƒå‘½ä»¤å¦‚ä¸‹ï¼š</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># æµ‹è¯•é‡åŒ–æ¨¡å‹å•å¼ å›¾ç‰‡æ¨ç†ç»“æœ</span><br><span class="line">bash 04_inference.sh</span><br><span class="line"></span><br><span class="line"># æµ‹è¯•æµ®ç‚¹æ¨¡å‹å•å¼ å›¾ç‰‡æ¨ç†ç»“æœï¼ˆå¯é€‰ï¼‰</span><br><span class="line">bash 04_inference.sh origin</span><br><span class="line"></span><br><span class="line"># æµ‹è¯•é‡åŒ–æ¨¡å‹ç²¾åº¦ï¼Œè¯·ç¡®ä¿æ‚¨çš„è¯„æµ‹æ•°æ®é›†å·²æ­£ç¡®æŒ‚è½½åœ¨Dockerå®¹å™¨ä¸­</span><br><span class="line">bash 05_evaluate.sh</span><br><span class="line"></span><br><span class="line"># æµ‹è¯•æµ®ç‚¹æ¨¡å‹ç²¾åº¦ï¼ˆå¯é€‰ï¼‰</span><br><span class="line">bash 05_evaluate.sh origin</span><br></pre></td></tr></table></figure></div>

<p><em>ä¸¤ä¸ªè„šæœ¬ä¼šåˆ†åˆ«è°ƒç”¨ <code>../../cls_inference.py</code> å’Œ <code>../../cls_evaluate.py</code> æ–‡ä»¶è¿›è¡Œæ¨ç†ï¼Œ ä»¥ <code>cls_inference.py</code> æ–‡ä»¶ä¸ºä¾‹ï¼Œä»£ç ä¸­çš„ä¸»è¦æ¥å£ä½¿ç”¨é€»è¾‘å¦‚ä¸‹ï¼š</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">from horizon_tc_ui import HB_ONNXRuntime</span><br><span class="line">from preprocess import infer_image_preprocess</span><br><span class="line">from postprocess import postprocess</span><br><span class="line"></span><br><span class="line">def inference(sess, image_name, input_layout, input_offset):</span><br><span class="line">  if input_layout is None:</span><br><span class="line">        input_layout = sess.layout[0]</span><br><span class="line">    # å‰å¤„ç†</span><br><span class="line">    image_data = infer_image_preprocess(image_name, input_layout)</span><br><span class="line">    input_name = sess.input_names[0]</span><br><span class="line">    output_name = sess.output_names</span><br><span class="line">    # æ¨¡å‹æ¨ç†</span><br><span class="line">    output = sess.run(output_name, &#123;input_name: image_data&#125;,</span><br><span class="line">                      input_offset=input_offset)</span><br><span class="line">    # åå¤„ç†</span><br><span class="line">    top_five_label_probs = postprocess(output)</span><br><span class="line"></span><br><span class="line">def main(model, image, input_layout, input_offset):</span><br><span class="line">    sess = HB_ONNXRuntime(model_file=model)</span><br><span class="line">    sess.set_dim_param(0, 0, &#x27;?&#x27;)</span><br><span class="line">    inference(sess, image, input_layout, input_offset)</span><br><span class="line"></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure></div>

<p><em>å…¶ä¸­ï¼Œinfer_image_preprocesså‡½æ•°çš„å‰å¤„ç†æ“ä½œæ¥æºäº <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/faststart/quickstart.html#calibration-data-preprocess" >æ ¡å‡†æ•°æ®é¢„å¤„ç† <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ç« èŠ‚ æ‰€è¿°preprocess.pyæ–‡ä»¶ï¼Œç›¸æ¯”äºcalibration_transformerså‡½æ•°ä¼šé¢å¤–å¢åŠ  <code>input_type_train</code> åˆ° <code>input_type_rt</code> ï¼ˆå‚æ•°è¯´æ˜è¯·è§ <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/faststart/quickstart.html#yaml-config" >Yamlé…ç½®æ–‡ä»¶ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ç« èŠ‚ï¼‰é¢œè‰²ç©ºé—´çš„è½¬æ¢æ¥å¯¹é½æ¨¡å‹å®é™…éƒ¨ç½²æ—¶çš„è¾“å…¥æ•°æ®ç±»å‹ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">def infer_transformers(input_layout=&quot;NHWC&quot;):</span><br><span class="line">    transformers = [</span><br><span class="line">        ShortSideResizeTransformer(short_size=256),</span><br><span class="line">        CenterCropTransformer(crop_size=224),</span><br><span class="line">        RGB2BGRTransformer(data_format=&quot;HWC&quot;),</span><br><span class="line">        ScaleTransformer(scale_value=255),</span><br><span class="line">        BGR2NV12Transformer(data_format=&quot;HWC&quot;),</span><br><span class="line">        NV12ToYUV444Transformer((224, 224),</span><br><span class="line">                                yuv444_output_layout=input_layout[1:]),</span><br><span class="line">    ]</span><br><span class="line">    return transformers</span><br><span class="line"></span><br><span class="line">def infer_image_preprocess(image_file, input_layout):</span><br><span class="line">    transformers = infer_transformers(input_layout)</span><br><span class="line">    image = SingleImageDataLoader(transformers,</span><br><span class="line">                                  image_file,</span><br><span class="line">                                  imread_mode=&#x27;skimage&#x27;)</span><br><span class="line">    return image</span><br></pre></td></tr></table></figure></div>

<p><em>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ <code>xxx.bin</code> æ¨¡å‹å¯¹äº <code>input_type_train</code> åˆ° <code>input_type_rt</code> é¢œè‰²ç©ºé—´çš„è½¬æ¢ä¼šé…åˆèŠ¯ç‰‡ç¡¬ä»¶å®Œæˆã€‚ è€Œæ¨¡å‹è½¬æ¢ç”Ÿæˆçš„å‡ ä¸ªONNXæ¨¡å‹å‰ç«¯æ’å…¥çš„é¢„å¤„ç†èŠ‚ç‚¹ä¸åŒ…å«ç¡¬ä»¶è½¬æ¢é€»è¾‘ï¼Œæ‰€ä»¥å…¶å®é™…è¾“å…¥åªæ˜¯ä¸€ç§ä¸­é—´ç±»å‹ï¼Œå¯¹åº”ç¡¬ä»¶ å¯¹ <code>input_type_rt</code> ç±»å‹çš„å¤„ç†ç»“æœã€‚ä¸‹è¡¨ä¸ºæ¯ç§ <code>input_type_rt</code> æ•°æ®ç±»å‹å¯¹åº”çš„ä¸­é—´ç±»å‹ã€‚ ä»¥MobileNet-v1æ¨¡å‹ä¸ºä¾‹ï¼Œå…¶ <code>input_type_rt</code> é…ç½®ä¸ºnv12ï¼Œæ­¤å¤„transformersä¸­å°±ä¼šä»BGRå¤„ç†æˆNV12ï¼Œ å†å¤„ç†æˆYUV444ï¼Œ-128ï¼ˆå¯¹åº”uint8è½¬int8ï¼‰çš„æ“ä½œåˆ™ä¼šåœ¨sess.runæ¨ç†æ¥å£ä¸­ç”± <code>input_offset</code> å‚æ•°ä¼ å…¥ã€‚</em></p>
<table>
<thead>
<tr>
<th align="left"><em>input_type_rt</em></th>
<th align="left"><em>nv12</em></th>
<th align="left"><em>yuv444</em></th>
<th align="left"><em>rgb</em></th>
<th align="left"><em>bgr</em></th>
<th align="left"><em>gray</em></th>
<th align="left"><em>featuremap</em></th>
</tr>
</thead>
<tbody><tr>
<td align="left"><em>ä¸­é—´ç±»å‹</em></td>
<td align="left"><em>yuv444_128</em></td>
<td align="left"><em>yuv444_128</em></td>
<td align="left"><em>RGB_128</em></td>
<td align="left"><em>BGR_128</em></td>
<td align="left"><em>GRAY_128</em></td>
<td align="left"><em>featuremap</em></td>
</tr>
</tbody></table>
<p><em>æ³¨è§£</em></p>
<p><em>_128è¡¨ç¤ºæ•°æ®ä¼šå‡å»128ï¼Œç”±uint8ç±»å‹è½¬æ¢ä¸ºint8ç±»å‹ã€‚</em></p>
<p><em><strong>å¼€å‘æ¿C++ç¯å¢ƒéªŒè¯</strong></em></p>
<p><em>åœ¨å¼€å‘æ¿ç«¯ï¼Œåœ°å¹³çº¿ä¹Ÿæä¾›äº†ä¸€å¥—é€‚é…æ‰€æœ‰ç¡¬ä»¶å¹³å°çš„åµŒå…¥å¼ç«¯é¢„æµ‹åº“LibDNNï¼Œæ¥å¸®åŠ©ç”¨æˆ·å¿«é€Ÿå®Œæˆæ¨¡å‹çš„éƒ¨ç½²å·¥ä½œï¼Œ å¹¶æä¾›äº†ç›¸å…³ç¤ºä¾‹ã€‚æ‚¨å¯ä»¥é¦–å…ˆå‚è€ƒ <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/faststart/quickstart.html#quickstart-model-deploy" >æ¨¡å‹éƒ¨ç½² <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ç« èŠ‚å­¦ä¹ æ¨¡å‹éƒ¨ç½²å’ŒBPU SDK APIæ¥å£çš„åŸºç¡€ä½¿ç”¨ï¼Œ å†å‚è€ƒ <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/faststart/quickstart.html#quickstart-ai-benchmark" >AI-Benchmark <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ç« èŠ‚å­¦ä¹ ç¤ºä¾‹æ¨¡å‹ç²¾åº¦è¯„æµ‹çš„å®Œæ•´ä»£ç æ¡†æ¶ã€‚</em></p>
<ul>
<li><em>æ¨¡å‹éƒ¨ç½²</em></li>
</ul>
<p><em>OEåŒ…æä¾›äº†æ¨¡å‹éƒ¨ç½²çš„åŸºç¡€ç¤ºä¾‹ï¼Œä»¥ä¾¿äºç”¨æˆ·å­¦ä¹ LibDNNé¢„æµ‹åº“APIæ¥å£çš„ä½¿ç”¨æ–¹å¼ï¼Œ ç¤ºä¾‹çš„è¯¦ç»†è¯´æ˜å¯ä»¥å‚è€ƒ <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/runtime/source/basic_sample/source/index.html" >åŸºç¡€ç¤ºä¾‹åŒ…ä½¿ç”¨è¯´æ˜ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ç« èŠ‚ã€‚</em></p>
<p><em>æ³¨æ„ï¼šåœ¨è¿›è¡Œæ¨¡å‹éƒ¨ç½²å‰ï¼Œéœ€è¦å…ˆè·å–ä¸Šæ¿ä½¿ç”¨çš„æ¨¡å‹ï¼š</em></p>
<ul>
<li><em>åœ¨ <code>ddk/samples/ai_toolchain/model_zoo/runtime/ai_benchmark</code> ç›®å½•ä¸‹ï¼Œ æ‰§è¡Œ <code>resolve_ai_benchmark_ptq.sh</code> ã€ <code>resolve_ai_benchmark_qat.sh</code> ã€‚</em></li>
<li><em>åœ¨ <code>ddk/samples/ai_toolchain/model_zoo/runtime/horizon_runtime_sample</code> ç›®å½•ä¸‹ï¼Œ æ‰§è¡Œ <code>resolve_runtime_sample.sh</code> ã€‚</em></li>
</ul>
<p><em>å…¶ä¸­ï¼Œç¤ºä¾‹ç›®å½•ä¸‹çš„ <code>code/00_quick_start/src/run_mobileNetV1_224x224.cc</code> æ–‡ä»¶æä¾›äº†MobileNet-v1æ¨¡å‹ ä»DDRè¯»å–æ•°æ®ï¼Œåˆ°æ¨¡å‹æ¨ç†ï¼Œå†æ‰§è¡Œåå¤„ç†å‡ºåˆ†ç±»ç»“æœçš„å®Œæ•´æµç¨‹ä»£ç ã€‚ä»æ‘„åƒå¤´è¾“å…¥çš„å…¨é“¾è·¯ç¤ºä¾‹å¯ä»¥ å‚è€ƒ <code>ddk/samples/ai_forward_view_sample</code> ã€‚</em></p>
<p><em>run_mobileNetV1_224x224.ccä¸­çš„ä¸»è¦ä»£ç é€»è¾‘åŒ…æ‹¬ä»¥ä¸‹6ä¸ªæ­¥éª¤ï¼Œä»£ç ä¸­æ‰€æ¶‰åŠçš„APIæ¥å£çš„å…·ä½“è¯´æ˜ å¯ä»¥å‚è€ƒ <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/runtime/source/bpu_sdk_api/source/index.html" >BPU SDK APIæ‰‹å†Œ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ç« èŠ‚ã€‚</em></p>
<p><em>1.åŠ è½½æ¨¡å‹ï¼Œè·å–æ¨¡å‹å¥æŸ„ã€‚</em></p>
<p><em>2.å‡†å¤‡æ¨¡å‹è¾“å…¥è¾“å‡ºtensorï¼Œç”³è¯·å¯¹åº”çš„BPUå†…å­˜ç©ºé—´ã€‚</em></p>
<p><em>3.è¯»å–æ¨¡å‹è¾“å…¥æ•°æ®ï¼Œå¹¶æ”¾å…¥ç”³è¯·å¥½çš„è¾“å…¥tensorä¸­ã€‚</em></p>
<p><em>4.æ¨ç†æ¨¡å‹ï¼Œè·å–æ¨¡å‹è¾“å‡ºã€‚</em></p>
<p><em>5.åŸºäºè¾“å‡ºtensorä¸­çš„æ•°æ®å®ç°æ¨¡å‹åå¤„ç†ã€‚</em></p>
<p><em>6.é‡Šæ”¾ç›¸å…³èµ„æºã€‚</em></p>
<div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> **argv)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Step1: get model handle</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">hbDNNInitializeFromFiles</span>(&amp;packed_dnn_handle, &amp;modelFileName, <span class="number">1</span>);</span><br><span class="line">    <span class="built_in">hbDNNGetModelNameList</span>(&amp;model_name_list, &amp;model_count, packed_dnn_handle);</span><br><span class="line">    <span class="built_in">hbDNNGetModelHandle</span>(&amp;dnn_handle, packed_dnn_handle, model_name_list[<span class="number">0</span>]);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Step2: prepare input and output tensor</span></span><br><span class="line">  std::vector&lt;hbDNNTensor&gt; input_tensors;</span><br><span class="line">  std::vector&lt;hbDNNTensor&gt; output_tensors;</span><br><span class="line">  <span class="type">int</span> input_count = <span class="number">0</span>;</span><br><span class="line">  <span class="type">int</span> output_count = <span class="number">0</span>;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">hbDNNGetInputCount</span>(&amp;input_count, dnn_handle);</span><br><span class="line">    <span class="built_in">hbDNNGetOutputCount</span>(&amp;output_count, dnn_handle);</span><br><span class="line">    input_tensors.<span class="built_in">resize</span>(input_count);</span><br><span class="line">    output_tensors.<span class="built_in">resize</span>(output_count);</span><br><span class="line">    <span class="built_in">prepare_tensor</span>(input_tensors.<span class="built_in">data</span>(), output_tensors.<span class="built_in">data</span>(), dnn_handle);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Step3: set input data to input tensor</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// read a single picture for input_tensor[0], for multi_input model, you</span></span><br><span class="line">    <span class="comment">// should set other input data according to model input properties.</span></span><br><span class="line">    <span class="built_in">read_image_2_tensor_as_nv12</span>(FLAGS_image_file, input_tensors.<span class="built_in">data</span>());</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Step4: run inference</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// make sure memory data is flushed to DDR before inference</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; input_count; i++) &#123;</span><br><span class="line">      <span class="built_in">hbSysFlushMem</span>(&amp;input_tensors[i].sysMem[<span class="number">0</span>], HB_SYS_MEM_CACHE_CLEAN);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    hbDNNInferCtrlParam infer_ctrl_param;</span><br><span class="line">    <span class="built_in">HB_DNN_INITIALIZE_INFER_CTRL_PARAM</span>(&amp;infer_ctrl_param);</span><br><span class="line">    <span class="built_in">hbDNNInfer</span>(&amp;task_handle,</span><br><span class="line">               &amp;output,</span><br><span class="line">               input_tensors.<span class="built_in">data</span>(),</span><br><span class="line">               dnn_handle,</span><br><span class="line">               &amp;infer_ctrl_param);</span><br><span class="line">    <span class="comment">// wait task done</span></span><br><span class="line">    <span class="built_in">hbDNNWaitTaskDone</span>(task_handle, <span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Step5: do postprocess with output data</span></span><br><span class="line">  std::vector&lt;Classification&gt; top_k_cls;</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// make sure CPU read data from DDR before using output tensor data</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; output_count; i++) &#123;</span><br><span class="line">      <span class="built_in">hbSysFlushMem</span>(&amp;output_tensors[i].sysMem[<span class="number">0</span>], HB_SYS_MEM_CACHE_INVALIDATE);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">get_topk_result</span>(output, top_k_cls, FLAGS_top_k);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; FLAGS_top_k; i++) &#123;</span><br><span class="line">      <span class="built_in">VLOG</span>(EXAMPLE_REPORT) &lt;&lt; <span class="string">&quot;TOP &quot;</span> &lt;&lt; i &lt;&lt; <span class="string">&quot; result id: &quot;</span> &lt;&lt; top_k_cls[i].id;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Step6: release resources</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// release task handle</span></span><br><span class="line">    <span class="built_in">hbDNNReleaseTask</span>(task_handle);</span><br><span class="line">    <span class="comment">// free input mem</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; input_count; i++) &#123;</span><br><span class="line">      <span class="built_in">hbSysFreeMem</span>(&amp;(input_tensors[i].sysMem[<span class="number">0</span>]));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// free output mem</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; output_count; i++) &#123;</span><br><span class="line">      <span class="built_in">hbSysFreeMem</span>(&amp;(output_tensors[i].sysMem[<span class="number">0</span>]));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// release model</span></span><br><span class="line">    <span class="built_in">hbDNNRelease</span>(packed_dnn_handle);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p><em>è¯¥ç¤ºä¾‹è¿è¡Œçš„å‚è€ƒæ–¹å¼å¦‚ä¸‹ï¼š</em></p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¼€å‘æœºç¯å¢ƒæ‰§è¡Œäº¤å‰ç¼–è¯‘ï¼Œç”Ÿæˆå¯æ‰§è¡Œç¨‹åº</span></span><br><span class="line">cd /open_explorer/ddk/samples/ai_toolchain/horizon_runtime_sample/code</span><br><span class="line">bash build_j5.sh</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‹·è´j5ç›®å½•è‡³æ¿ç«¯</span></span><br><span class="line">mkdir ../j5/runtime</span><br><span class="line">scp -r ../j5/ root@&#123;board_ip&#125;:/userdata</span><br><span class="line"><span class="comment"># æ‹·è´æ¨¡å‹æ–‡ä»¶è‡³æ¿ç«¯</span></span><br><span class="line">scp -r ../../model_zoo/runtime/mobilenetv1/ root@&#123;board_ip&#125;:/userdata/j5/model/runtime</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç™»å½•å¼€å‘æ¿ç¯å¢ƒ</span></span><br><span class="line">ssh root@&#123;board_ip&#125;</span><br><span class="line"><span class="comment"># è¿›å…¥j5/script/ç›®å½•ä¸‹ï¼Œæ‰§è¡Œç›¸åº”è¿è¡Œè„šæœ¬å³å¯</span></span><br><span class="line">cd /userdata/j5/script/00_quick_start/</span><br><span class="line">bash run_mobilenetV1.sh</span><br></pre></td></tr></table></figure></div>

<ul>
<li><em><strong>AI-Benchmark</strong></em></li>
</ul>
<p><em>OEåŒ…åœ¨ä»¥ä¸‹è·¯å¾„æä¾›äº†å…¸å‹åˆ†ç±»ã€æ£€æµ‹ã€åˆ†å‰²ã€å…‰æµç¤ºä¾‹æ¨¡å‹æ¿ç«¯æ€§èƒ½å’Œç²¾åº¦è¯„æµ‹çš„ç¤ºä¾‹åŒ…ï¼Œå…¶ä¸­é¢„ç½®äº†æºç ã€å¯æ‰§è¡Œç¨‹åºå’Œè¯„æµ‹è„šæœ¬ï¼Œ æ‚¨å¯ä»¥åŸºäºè¿™äº›ç¤ºä¾‹è¿›è¡Œè¿›ä¸€æ­¥çš„åº”ç”¨å¼€å‘ã€‚ ä»¥ä¸‹ <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/faststart/quickstart.html#quickstart-sample" >ç¤ºä¾‹ä½¿ç”¨ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ç« èŠ‚å°†ä»‹ç»ç¤ºä¾‹çš„ä½¿ç”¨æ–¹å¼ï¼Œ <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/faststart/quickstart.html#quickstart-code-structure" >ä»£ç ç»“æ„ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ç« èŠ‚å°†ç®€å•ä»‹ç»ç¤ºä¾‹çš„ä»£ç ç»“æ„ã€‚</em></p>
<blockquote>
<p><em>ç¤ºä¾‹ä½¿ç”¨</em></p>
</blockquote>
<p><em>ç¤ºä¾‹åŒ…çš„ä½¿ç”¨æµç¨‹ä¸»è¦åŒ…æ‹¬4ä¸ªæ­¥éª¤ï¼Œä»¥ä¸‹å°†ä¾æ¬¡å±•å¼€ä»‹ç»ï¼Œæ›´å¤šè¯´æ˜è¯·è§ <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/runtime/source/ai_benchmark/source/index.html" >AI-Benchmarkä½¿ç”¨è¯´æ˜ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ç« èŠ‚ã€‚</em></p>
<p><em><strong>æ­¥éª¤ä¸€ï¼šç¯å¢ƒéƒ¨ç½²</strong></em></p>
<p><em>AI-Benchmarkç¤ºä¾‹ä½¿ç”¨è¯·é¦–å…ˆç¡®ä¿å·²æŒ‰ç…§ <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/env_install/env_deploy.html" >ç¯å¢ƒéƒ¨ç½² <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ç« èŠ‚å®Œæˆå¼€å‘æœºå’Œå¼€å‘æ¿çš„ç¯å¢ƒéƒ¨ç½²ã€‚</em></p>
<p><em><strong>æ­¥éª¤äºŒï¼šå·¥ç¨‹ç¤ºä¾‹ç¼–è¯‘</strong></em></p>
<p><em>å·¥ç¨‹ç¤ºä¾‹çš„ç¼–è¯‘éœ€è¦åœ¨å¼€å‘æœºç¯å¢ƒå®Œæˆï¼Œå‚è€ƒå‘½ä»¤å¦‚ä¸‹ï¼š</em></p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¼€å‘æœºç¯å¢ƒå®Œæˆäº¤å‰ç¼–è¯‘</span></span><br><span class="line">cd /open_explorer/ddk/samples/ai_benchmark/code</span><br><span class="line">bash build_ptq_j5.sh</span><br></pre></td></tr></table></figure></div>

<p><em>ç¼–è¯‘å®Œæˆåï¼Œå¯æ‰§è¡Œç¨‹åºå’Œå¯¹åº”ä¾èµ–ä¼šè‡ªåŠ¨æ‹·è´è‡³ <code>../j5/ptq/script/aarch64</code> ç›®å½•ä¸‹ï¼Œè¯·å°†ç›¸å…³ç¤ºä¾‹æ‹·è´è‡³æ¿ç«¯ï¼Œå‚è€ƒå‘½ä»¤å¦‚ä¸‹ï¼š</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scp -r ../j5/ptq root@&#123;board_ip&#125;:/userdata</span><br></pre></td></tr></table></figure></div>

<p><em><strong>æ­¥éª¤ä¸‰ï¼šè¯„æµ‹æ•°æ®é›†å‡†å¤‡</strong></em></p>
<blockquote>
<p><em>è¯„æµ‹æ•°æ®é›†å‡†å¤‡åœ¨æœºå™¨å­¦ä¹ å’Œäººå·¥æ™ºèƒ½é¢†åŸŸçš„æ¨¡å‹è¯„ä¼°ä¸­èµ·ç€è‡³å…³é‡è¦çš„ä½œç”¨ã€‚æ•°æ®é›†å‡†å¤‡å·¥ä½œçš„ç›®æ ‡æ˜¯å‡†å¤‡ä¸€ä¸ªç¬¦åˆè¦æ±‚ã€æœ‰æ•ˆä¸”å¯é‡å¤ä½¿ç”¨çš„æ•°æ®é›†ï¼Œä»¥ä¾¿ç”¨äºæœºå™¨å­¦ä¹ æ¨¡å‹è®­ç»ƒå’Œè¯„ä¼°ã€‚</em></p>
</blockquote>
<p><em>æ¨¡å‹çš„ç²¾åº¦è¯„æµ‹éœ€è¦å…ˆåœ¨å¼€å‘æœºç«¯å®Œæˆè¯„æµ‹æ•°æ®çš„é¢„å¤„ç†ï¼Œ <strong>å¦‚æœä»…æ‰§è¡Œæ€§èƒ½è¯„æµ‹å¯ä»¥è·³è¿‡æ­¤æ­¥éª¤</strong> ã€‚ ä»¥MobileNet-v1æ¨¡å‹ä¸ºä¾‹ï¼ŒImageNetæ•°æ®é›†çš„é¢„å¤„ç†å‘½ä»¤å¦‚ä¸‹ï¼š</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hb_eval_preprocess -m mobilenetv1 -i imagenet/val -o ./pre_mobilenetv1</span><br></pre></td></tr></table></figure></div>

<p><em>å…¶ä¸­ï¼Œ <code>hb_evel_preprocess</code> å·¥å…·å°è£…äº†åœ°å¹³çº¿ç¤ºä¾‹æ¨¡å‹å¯¹åº”çš„å‰å¤„ç†æ“ä½œï¼Œå·¥å…·å¸¸ç”¨å‚æ•°å¦‚ä¸‹ï¼Œ æ›´å¤šè¯´æ˜è¯·å‚è€ƒ <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/ptq/ptq_tool/hb_eval_preprocess.html" >hb_eval_preprocess å·¥å…· <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ç« èŠ‚ã€‚</em></p>
<table>
<thead>
<tr>
<th align="left"><em>å‚æ•°</em></th>
<th align="left"><em>è¯´æ˜</em></th>
</tr>
</thead>
<tbody><tr>
<td align="left"><em>-m</em></td>
<td align="left"><em>[å¿…é€‰]æ¨¡å‹åç§°ï¼Œå¦‚mobilenetv1ï¼Œå¯ä»¥é€šè¿‡hb_eval_preprocess -hæŸ¥çœ‹å¯é€‰é¡¹ã€‚</em></td>
</tr>
<tr>
<td align="left"><em>-i</em></td>
<td align="left"><em>[å¿…é€‰]åŸå§‹æ•°æ®é›†è·¯å¾„ã€‚</em></td>
</tr>
<tr>
<td align="left"><em>-o</em></td>
<td align="left"><em>[å¯é€‰]é¢„å¤„ç†åæ•°æ®é›†çš„ä¿å­˜è·¯å¾„ã€‚</em></td>
</tr>
<tr>
<td align="left"><em>-h, â€“help</em></td>
<td align="left"><em>[å¯é€‰]æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯ã€‚</em></td>
</tr>
</tbody></table>
<p><em>é¢„å¤„ç†åç”Ÿæˆçš„pre_mobilenetv1æ–‡ä»¶å¤¹å»ºè®®ä»¥ä»¥ä¸‹ç›®å½•ç»“æ„å­˜æ”¾ï¼š</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">|-- nfs</span><br><span class="line">|   |-- data</span><br><span class="line">|   |   |-- imagenet</span><br><span class="line">|   |   |   |-- pre_mobilenetv1</span><br><span class="line">|   |   |   |   |-- xxxx.bin         # é¢„å¤„ç†å¥½çš„äºŒè¿›åˆ¶æ–‡ä»¶</span><br></pre></td></tr></table></figure></div>

<p><em>å› ä¸ºè¯„æµ‹æ•°æ®é›†ä¸€èˆ¬è¾ƒå¤§ï¼Œä¸é€‚åˆç›´æ¥å­˜æ”¾åœ¨å¼€å‘æ¿ä¸Šï¼Œæ‰€ä»¥æ›´æ¨èé‡‡ç”¨æŒ‚è½½çš„æ–¹å¼ï¼ˆå¼€å‘æœºç«¯éœ€è¦å…·å¤‡rootæƒé™ï¼‰ æä¾›ç»™å¼€å‘æ¿è¯»å–ï¼Œå‚è€ƒæ–¹å¼å¦‚ä¸‹ï¼š</em></p>
<ul>
<li><p><em><strong>å¼€å‘æœºç«¯ï¼š</strong></em></p>
<p><em>1.ç¼–è¾‘ <code>/etc/exports</code> ï¼Œå¢åŠ ä¸€è¡Œ:</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/nfs *(insecure,rw,sync,all_squash,anonuid=1000,anongid=1000,no_subtree_check)</span><br></pre></td></tr></table></figure></div>

<p><em>å…¶ä¸­ <code>/nfs</code> ä¸ºæœ¬æœºæŒ‚è½½è·¯å¾„ï¼Œå¯æ›¿æ¢ä¸ºç”¨æˆ·æŒ‡å®šç›®å½•ã€‚</em></p>
<p><em>2.æ‰§è¡Œå‘½ä»¤ <code>exportfs -a -r</code> ï¼Œä½¿ <code>/etc/exports</code> ç”Ÿæ•ˆã€‚</em></p>
</li>
</ul>
<blockquote>
<ol>
<li><em><code>/nfs</code> è¡¨ç¤ºå°† NFS å…±äº«ç›®å½•æŒ‚è½½åˆ°æœ¬åœ°ç›®å½• <code>/nfs</code> ä¸‹ã€‚</em></li>
<li><em><code>*</code> è¡¨ç¤ºä»»ä½•æœºå™¨éƒ½å¯ä»¥è®¿é—®è¯¥å…±äº«ã€‚</em></li>
<li><em><code>insecure</code> é€‰é¡¹ç”¨äºå…è®¸ä¸å—ä¿¡ä»»çš„å®¢æˆ·ç«¯æŒ‚è½½å…±äº«ï¼Œè¿™åœ¨ä¸€äº›æµ‹è¯•æˆ–å¼€å‘åœºæ™¯ä¸­éå¸¸æœ‰ç”¨ã€‚ä½†åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå»ºè®®ä¸ä½¿ç”¨è¯¥é€‰é¡¹ã€‚</em></li>
<li><em><code>rw</code> è¡¨ç¤ºæ–‡ä»¶ç³»ç»Ÿå…·æœ‰è¯»å†™æƒé™ã€‚</em></li>
<li><em><code>sync</code> è¡¨ç¤ºæ–‡ä»¶ç³»ç»Ÿåœ¨å†™å…¥æ•°æ®æ—¶é‡‡ç”¨åŒæ­¥æ¨¡å¼ï¼Œå³æ¯æ¬¡å†™å…¥æ“ä½œéƒ½ä¼šç­‰å¾…å†™å…¥å®Œæˆåå†è¿”å›æˆåŠŸã€‚</em></li>
<li><em><code>all_squash</code> è¡¨ç¤ºå°†æ‰€æœ‰çš„ UID å’Œ GID æ˜ å°„ä¸ºåŒ¿åç”¨æˆ·ï¼Œè¿™é€šå¸¸ç”¨äºä¿æŠ¤ NFS æœåŠ¡ä¸­çš„å®‰å…¨æ€§ã€‚</em></li>
<li><em><code>anonuid=1000</code> å’Œ <code>anongid=1000</code> è¡¨ç¤ºåŒ¿åç”¨æˆ·çš„ UID å’Œ GID å‡ä¸º 1000ã€‚</em></li>
<li><em><code>no_subtree_check</code> è¡¨ç¤ºè¯¥é€‰é¡¹ç¦ç”¨è‡ªåŠ¨æ£€æŸ¥å…±äº«çš„çˆ¶ç›®å½•ä»¥ä¿è¯å®‰å…¨æ€§ã€‚</em></li>
</ol>
</blockquote>
<ul>
<li><em><strong>å¼€å‘æ¿ç«¯ï¼š</strong></em></li>
</ul>
<p><em>1.åˆ›å»ºéœ€è¦æŒ‚è½½çš„ç›®å½•ï¼Œä¾‹å¦‚ï¼š <code>mkdir -p /mnt</code> ã€‚</em></p>
<p><em>2.è¾“å…¥æŒ‡ä»¤å®ŒæˆæŒ‚è½½ï¼š <code>mount -t nfs &#123;PCç«¯ip&#125;:/nfs /mnt -o nolock</code> ã€‚å…¶ä¸­ <code>/nfs</code> ä¸ºæœ¬æœºæŒ‚è½½è·¯å¾„ï¼Œ <code>/mnt</code> ä¸ºæ¿ç«¯è¢«æŒ‚è½½è·¯å¾„ï¼Œå‡å¯æ›¿æ¢ä¸ºç”¨æˆ·æŒ‡å®šç›®å½•ã€‚æ‰§è¡ŒæˆåŠŸåéœ€è¦å†å°†æŒ‚è½½çš„é¢„å¤„ç†æ•°æ®ç›®å½•çš„è½¯è¿æ¥æ›¿æ¢è‡³ <code>/userdata/ptq/data</code> è·¯å¾„ä¸‹ï¼š</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># è¿›å…¥åˆ°å¼€å‘æ¿ptqæ–‡ä»¶å¤¹ä¸‹</span><br><span class="line">cd /userdata/ptq</span><br><span class="line">rm -rf ./data</span><br><span class="line">ln -s /mnt/data ./data</span><br></pre></td></tr></table></figure></div>

<p><em>æœ€åè¿˜éœ€è¦åœ¨æ¿ç«¯æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å®Œæˆlstæ–‡ä»¶çš„ç”Ÿæˆï¼Œlstæ–‡ä»¶åŒ…å«äº†æ¯ä¸€ä¸ªé¢„å¤„ç†æ–‡ä»¶çš„è·¯å¾„ã€‚</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find /userdata/ptq/data/imagenet/pre_mobilenetv1 -name &quot;*bin&quot; &gt; /userdata/ptq/data/imagenet/pre_mobilenetv1.lst</span><br></pre></td></tr></table></figure></div>

<p><em>ä»¥ä¸Šå‡†å¤‡å·¥ä½œå®Œæˆåçš„æ¿ç«¯ç›®å½•ç»“æ„åº”è¯¥å¦‚ä¸‹æ‰€ç¤ºï¼š</em></p>
<p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230508210604846.png"
                      class="" title="image-20230508210604846"
                ></em></p>
<blockquote>
<p><em>mkdir -p file</em></p>
<p><em><strong>ä¸Šè¿°å‘½ä»¤çš„<code>-p</code> å‚æ•°ç”¨äºåˆ›å»ºæŒ‡å®šç›®å½•çš„æ‰€æœ‰çˆ¶ç›®å½•ï¼Œå³ä½¿è¿™äº›ç›®å½•ä¸å­˜åœ¨ã€‚</strong></em></p>
<p><em>ä¾‹å¦‚ï¼Œå¦‚æœè¦åœ¨ <code>/home/chatgpt/test/folder</code> ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªæ–°ç›®å½• <code>new_folder</code>ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /home/chatgpt/test/folder/new_folder</span><br></pre></td></tr></table></figure></div>

<p><em>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå¦‚æœ <code>/home/chatgpt</code> ç›®å½•ä¸‹çš„ <code>test</code> å’Œ <code>folder</code> ç›®å½•ä¸å­˜åœ¨ï¼Œ<code>mkdir -p</code> å‘½ä»¤å°†ä¼šåŒæ—¶åˆ›å»ºè¿™ä¸¤ä¸ªç›®å½•ã€‚å¦‚æœ <code>-p</code> é€‰é¡¹æ²¡æœ‰ä½¿ç”¨ï¼Œé‚£ä¹ˆå¦‚æœ <code>test</code> å’Œ <code>folder</code> ç›®å½•æ²¡æœ‰ä¸€ä¸ªå­˜åœ¨ï¼Œå°†ä¼šåˆ›å»º <code>folder</code> ç›®å½•çš„å¤±è´¥ï¼Œå› ä¸ºç¼ºå°‘å…¶çˆ¶ç›®å½•ã€‚</em></p>
</blockquote>
<blockquote>
<p><em><strong>NFSv3 çš„é”å®šæœºåˆ¶æ˜¯ä¸€ç§ç”¨äºç¡®ä¿å…±äº«æ–‡ä»¶ç³»ç»ŸåŒæ­¥çš„æœºåˆ¶ï¼Œå®ƒä¸»è¦ç”¨äºé˜²æ­¢å¤šä¸ªä½¿ç”¨è€…åŒæ—¶å¯¹åŒä¸€æ–‡ä»¶è¿›è¡Œæ›´æ”¹ã€‚</strong></em></p>
<p><em>NFSv3 é”å®šæœºåˆ¶çš„ä¼˜ç‚¹æ˜¯å¯ä»¥ç¡®ä¿å…±äº«æ–‡ä»¶ç³»ç»Ÿçš„åŒæ­¥æ€§å’Œä¸€è‡´æ€§ã€‚æ— è®ºæ˜¯åœ¨å±€åŸŸç½‘å†…è¿˜æ˜¯åœ¨å¹¿åŸŸç½‘ä¸Šï¼Œå¤šä¸ªå®¢æˆ·ç«¯è®¿é—®åŒä¸€å…±äº«çš„æ–‡ä»¶ç³»ç»Ÿæ—¶ï¼Œéƒ½å¯ä»¥ä½¿ç”¨è¯¥é”å®šæœºåˆ¶æ¥é¿å…å†²çªå’Œæ•°æ®ç ´åã€‚</em></p>
<p><em>ç„¶è€Œï¼ŒNFSv3 é”å®šæœºåˆ¶ä¹Ÿå­˜åœ¨ä¸€äº›ç¼ºç‚¹ï¼Œä¾‹å¦‚æ€§èƒ½ä¸‹é™ã€æ­»é”å’Œå®¹é”™æ€§çš„é—®é¢˜ã€‚å› æ­¤ï¼Œæœ€å¥½åœ¨ä½¿ç”¨ NFSv3 é”å®šæœºåˆ¶æ—¶ï¼Œè°¨æ…é…ç½®é€‰é¡¹ï¼Œä»¥ç¡®ä¿å®ç°æœ€ä½³æ€§èƒ½å’Œå¯é æ€§ã€‚</em></p>
<p><em><strong><code>-o nolock</code> è¡¨ç¤ºåœ¨æŒ‚è½½å…±äº«ç›®å½•æ—¶ä¸ä½¿ç”¨ NFSv3 çš„é”å®šæœºåˆ¶ã€‚è¿™ä¸ªé€‰é¡¹å¯èƒ½å¯¹æ€§èƒ½æœ‰ç§¯æçš„å½±å“ï¼Œä½†ä¹Ÿå¯èƒ½ä¼šä½¿å…±äº«ç›®å½•å®¹æ˜“å‡ºç°æ–‡ä»¶å†²çªç­‰é—®é¢˜ã€‚å¦‚æœä¸æ˜¯å¿…éœ€çš„ï¼Œå»ºè®®ä¸ä½¿ç”¨è¯¥é€‰é¡¹ã€‚</strong></em></p>
</blockquote>
<blockquote>
<p><em><code>rm -rf ./data</code> åˆ é™¤å½“å‰ç›®å½•ä¸‹çš„ <code>data</code> ç›®å½•ï¼Œå…¶ä¸­ <code>-rf</code> é€‰é¡¹è¡¨ç¤ºå¼ºåˆ¶åˆ é™¤ç›®å½•åŠå…¶å­ç›®å½•ï¼Œå¦‚æœæœ‰å¿…è¦çš„è¯ï¼Œè¿˜å°†å¿½ç•¥æ‰€æœ‰æç¤ºå’Œè­¦å‘Šã€‚</em></p>
<p><em><code>ln -s /mnt/data ./data</code> åˆ›å»ºäº†ä¸€ä¸ªåä¸º <code>data</code> çš„è½¯é“¾æ¥ï¼Œå°†å…¶é“¾æ¥åˆ° <code>/mnt/data</code> ç›®å½•ã€‚è¿™æ„å‘³ç€ä»»ä½•ä½¿ç”¨ <code>data</code> ç›®å½•çš„æ“ä½œå®é™…ä¸Šéƒ½å°†åœ¨ <code>/mnt/data</code> ä¸­æ‰§è¡Œã€‚</em></p>
</blockquote>
<blockquote>
<ol>
<li><em><code>find /userdata/ptq/data/imagenet/pre_mobilenetv1</code>ï¼šç”¨äºæœç´¢ <code>/userdata/ptq/data/imagenet/pre_mobilenetv1</code> ç›®å½•ä¸‹çš„æ–‡ä»¶å’Œå­ç›®å½•ã€‚<code>find</code> å‘½ä»¤æ˜¯åœ¨ Linux ä¸­ç”¨äºæœç´¢æ–‡ä»¶å’Œç›®å½•çš„å‘½ä»¤ï¼Œå®ƒå¯ä»¥ä½¿ç”¨å„ç§é€‰é¡¹å’Œæ¡ä»¶ï¼Œè¿‡æ»¤æ–‡ä»¶å’Œç›®å½•ã€‚</em></li>
<li><em><code>-name &quot;*bin&quot;</code>ï¼šè¡¨ç¤ºæŸ¥æ‰¾æ–‡ä»¶åä»¥ <code>.bin</code> ç»“å°¾çš„æ‰€æœ‰æ–‡ä»¶ã€‚</em><em><code>-name</code> æ˜¯ <code>find</code> å‘½ä»¤çš„ä¸€ä¸ªé€‰é¡¹ï¼Œç”¨äºæ ¹æ®æ–‡ä»¶åæ¨¡å¼åŒ¹é…æœç´¢ç»“æœã€‚</em>**</li>
<li><em><code>&gt; /userdata/ptq/data/imagenet/pre_mobilenetv1.lst</code>ï¼šå°†å‰é¢æ‰¾åˆ°çš„<strong>æ‰€æœ‰æ–‡ä»¶çš„è·¯å¾„å’Œåç§°</strong>è¾“å‡ºåˆ° <code>userdata/ptq/data/imagenet/pre_mobilenetv1.lst</code> æ–‡ä»¶ä¸­ã€‚*</em><code>&gt;</code> æ˜¯è¾“å‡ºé‡å®šå‘æ“ä½œç¬¦*<em>ï¼Œç”¨äºå°†è¾“å‡ºå†™å…¥åˆ°æŒ‡å®šçš„æ–‡ä»¶ä¸­ã€‚å¦‚æœæŒ‡å®šçš„æ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ™ä¼šè‡ªåŠ¨åˆ›å»ºè¯¥æ–‡ä»¶ï¼Œå¦‚æœè¯¥æ–‡ä»¶å·²ç»å­˜åœ¨ï¼Œåˆ™ä¼šè¦†ç›–åŸæœ‰å†…å®¹ã€‚</em></li>
</ol>
<p><em>é€šè¿‡ä¸Šè¿°å‘½ä»¤ï¼Œå¯ä»¥å°†æŒ‡å®šç›®å½•ä¸‹æ‰€æœ‰ä»¥ <code>.bin</code> ç»“å°¾çš„æ–‡ä»¶çš„è·¯å¾„åç§°å­˜å‚¨åˆ° <code>pre_mobilenetv1.lst</code> æ–‡ä»¶ä¸­ã€‚è¿™ä¸ªæ“ä½œé€šå¸¸ç”¨äºç®¡ç†å¤§é‡çš„å›¾ç‰‡æ•°æ®ï¼Œä¾¿äºä½¿ç”¨å…¶ä»–æ•°æ®å¤„ç†å·¥å…·å¯¹è¿™äº›æ–‡ä»¶è¿›è¡Œå¤„ç†ã€‚</em></p>
</blockquote>
<p><em><strong>æ­¥éª¤å››ï¼šæ€§èƒ½&#x2F;ç²¾åº¦è¯„æµ‹</strong></em></p>
<p><em>ä»¥MobileNet-v1æ¨¡å‹ä¸ºä¾‹ï¼Œå…¶æ€§èƒ½è¯„æµ‹çš„æ‰§è¡Œå‘½ä»¤å‚è€ƒå¦‚ä¸‹ï¼š</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /userdata/ptq/script/classification/mobilenetv1</span><br><span class="line">bash fps.sh        # è¯„æµ‹å¸§ç‡</span><br><span class="line">bash latency.sh    # è¯„æµ‹è€—æ—¶</span><br></pre></td></tr></table></figure></div>

<p><em>ç²¾åº¦è¯„æµ‹çš„æ‰§è¡Œå‘½ä»¤å‚è€ƒå¦‚ä¸‹ï¼š</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash accuracy.sh</span><br></pre></td></tr></table></figure></div>

<p><em>è„šæœ¬æ‰§è¡Œå®Œæˆåï¼Œä¼šåœ¨å½“å‰è·¯å¾„ç”Ÿæˆæ¨¡å‹é¢„æµ‹ç»“æœæ–‡ä»¶ <code>eval.log</code> ã€‚è¯·å°†è¯¥æ—¥å¿—æ–‡ä»¶æ‹·è´å›å¼€å‘æœºç«¯OEåŒ…ä»»æ„ä½ç½®ï¼Œ å¹¶æ‰§è¡Œä»¥ä¸‹è„šæœ¬ï¼Œå³å¯å¾—åˆ°MobileNet-v1æ¨¡å‹çš„é‡åŒ–ç²¾åº¦ï¼š</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">python3 /open_explorer/ddk/samples/ai_benchmark/j5/ptq/tools/python_tools/accuracy_tools/cls_eval.py \</span><br><span class="line">  --log_file ./eval.log \</span><br><span class="line">  --gt_file /data/horizon_j5/data/imagenet/val.txt</span><br></pre></td></tr></table></figure></div>

<blockquote>
<p><em>ä»£ç ç»“æ„</em></p>
</blockquote>
<p><em>ä»¥ç²¾åº¦è¯„æµ‹è„šæœ¬ä¸ºä¾‹ï¼Œå…¶å¯æ‰§è¡Œç¨‹åºæºç çš„mainå‡½æ•°å®šä¹‰åœ¨ <code>code/src/simple_example.cc</code> ï¼Œå¹¶ç”± <code>workflow_accuracy.json</code> æ–‡ä»¶ä¼ å…¥ç›¸å…³å‚æ•°ã€‚</em></p>
<p><em>simple_example.ccçš„ä¸»è¦ä»£ç å¦‚ä¸‹ï¼š</em></p>
<div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fstream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;plugin/input_plugin.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;plugin/output_plugin.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;plugin/workflow_plugin.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;rapidjson/document.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;rapidjson/istreamwrapper.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;rapidjson/writer.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> EMPTY <span class="string">&quot;&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> **argv)</span> </span>&#123;</span><br><span class="line">  <span class="comment">// Parsing command line arguments; Init logging</span></span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Parsing config</span></span><br><span class="line">  <span class="function">std::ifstream <span class="title">ifs</span><span class="params">(FLAGS_config_file)</span></span>;</span><br><span class="line">  <span class="function">rapidjson::IStreamWrapper <span class="title">isw</span><span class="params">(ifs)</span></span>;</span><br><span class="line">  rapidjson::Document document;</span><br><span class="line">  document.<span class="built_in">ParseStream</span>(isw);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Input plugin</span></span><br><span class="line">  <span class="keyword">auto</span> input_plg = InputProducerPlugin::<span class="built_in">GetInstance</span>();</span><br><span class="line">  <span class="type">int</span> ret_code =</span><br><span class="line">      input_plg-&gt;<span class="built_in">Init</span>(EMPTY, <span class="built_in">json_to_string</span>(document[<span class="string">&quot;input_config&quot;</span>]));</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Workflow plugin</span></span><br><span class="line">  <span class="keyword">auto</span> workflow_plg = WorkflowPlugin::<span class="built_in">GetInstance</span>();</span><br><span class="line">  ret_code = workflow_plg-&gt;<span class="built_in">Init</span>(EMPTY, <span class="built_in">json_to_string</span>(document));</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Output plugin</span></span><br><span class="line">  <span class="keyword">auto</span> output_plg = OutputConsumerPlugin::<span class="built_in">GetInstance</span>();</span><br><span class="line">  ret_code = output_plg-&gt;<span class="built_in">Init</span>(EMPTY,</span><br><span class="line">                              <span class="built_in">json_to_string</span>(document[<span class="string">&quot;output_config&quot;</span>]));</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Start</span></span><br><span class="line">  ret_code = input_plg-&gt;<span class="built_in">Start</span>();</span><br><span class="line">  ret_code = workflow_plg-&gt;<span class="built_in">Start</span>();</span><br><span class="line">  ret_code = output_plg-&gt;<span class="built_in">Start</span>();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!input_plg-&gt;<span class="built_in">IsRunning</span>()) &#123;    <span class="comment">// finish</span></span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Stop</span></span><br><span class="line">  input_plg-&gt;<span class="built_in">Stop</span>();</span><br><span class="line">  workflow_plg-&gt;<span class="built_in">Stop</span>();</span><br><span class="line">  output_plg-&gt;<span class="built_in">Stop</span>();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p><em>å…¶ä¸­ï¼Œ <code>ai_benchmark/code/src/plugin</code> è·¯å¾„ä¸‹åŒ…å«äº†input_plgã€workflow_plgã€output_plgä¸‰ä¸ªçº¿ç¨‹å®ä¾‹çš„ç±»å®šä¹‰ï¼Œ å…¶ä¸»è¦ä½œç”¨åˆ†åˆ«æ˜¯ï¼š</em></p>
<ul>
<li><em><strong>input_plg</strong>ï¼šç”¨äºè¿­ä»£æ¨¡å‹çš„è¾“å…¥æ•°æ®ã€‚</em></li>
<li><em><strong>workflow_plg</strong>ï¼šç”¨äºå®ç°æ¨¡å‹çš„å‰å‘æ¨ç†å’Œåå¤„ç†ã€‚å„ä¸ªæ¨¡å‹çš„åå¤„ç†å®ç°å’Œç»Ÿä¸€çš„æ¨¡å‹å‰å‘å®ç°éƒ½å®šä¹‰åœ¨ <code>code/src/method</code> è·¯å¾„ä¸‹ã€‚</em></li>
<li><em><strong>output_plg</strong>ï¼šç”¨äºæ¨¡å‹æ¨ç†æ—¶çš„æ€§èƒ½æŒ‡æ ‡ç»Ÿè®¡å’Œæ‰“å°ï¼Œå¸§idçš„é¡ºåºä¿æŒï¼Œç²¾åº¦è¯„æµ‹æ—¶çš„ <code>eval.log</code> æ—¥å¿—ç”Ÿæˆç­‰ã€‚</em></li>
</ul>
<blockquote>
<p><em>åº”ç”¨å¼€å‘</em></p>
</blockquote>
<p><em>å½“æ¨¡å‹çš„æ€§èƒ½å’Œç²¾åº¦éªŒè¯éƒ½ç¬¦åˆé¢„æœŸåï¼Œå³å¯å‚è€ƒ <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/runtime/source/runtime_dev.html" >åµŒå…¥å¼åº”ç”¨å¼€å‘æŒ‡å¯¼ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ç« èŠ‚å®ç°ä¸Šå±‚åº”ç”¨çš„å…·ä½“å¼€å‘ã€‚</em> </p>
<h3 id="æµ®ç‚¹æ¨¡å‹è½¬å®šç‚¹æ¨¡å‹æ‰‹å†Œ"><a href="#æµ®ç‚¹æ¨¡å‹è½¬å®šç‚¹æ¨¡å‹æ‰‹å†Œ" class="headerlink" title="æµ®ç‚¹æ¨¡å‹è½¬å®šç‚¹æ¨¡å‹æ‰‹å†Œ"></a><em>æµ®ç‚¹æ¨¡å‹è½¬å®šç‚¹æ¨¡å‹æ‰‹å†Œ</em></h3><p><em>åœ°å¹³çº¿æä¾›äº†ä¸¤ç§æµ®ç‚¹æ¨¡å‹è½¬å®šç‚¹æ¨¡å‹çš„æ–¹æ³•ï¼Œåˆ†åˆ«ä¸ºPTQæ¨¡å‹é‡åŒ–æ‰‹æ®µå’ŒQATæ¨¡å‹é‡åŒ–æ‰‹æ®µï¼Œ æœ¬ç« å†…å®¹åŒ…æ‹¬ <strong>è®­ç»ƒåé‡åŒ–ï¼ˆPTQï¼‰</strong> å’Œ <strong>é‡åŒ–æ„ŸçŸ¥è®­ç»ƒï¼ˆQATï¼‰</strong></em></p>
<h4 id="è®­ç»ƒåé‡åŒ–ï¼ˆPTQï¼‰"><a href="#è®­ç»ƒåé‡åŒ–ï¼ˆPTQï¼‰" class="headerlink" title="è®­ç»ƒåé‡åŒ–ï¼ˆPTQï¼‰"></a><em>è®­ç»ƒåé‡åŒ–ï¼ˆPTQï¼‰</em></h4><h5 id="PTQåŸç†åŠæ­¥éª¤"><a href="#PTQåŸç†åŠæ­¥éª¤" class="headerlink" title="PTQåŸç†åŠæ­¥éª¤"></a><em>PTQåŸç†åŠæ­¥éª¤</em></h5><p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230509081114868.png"
                      class="" title="image-20230509081114868"
                ></em></p>
<p><em><strong>ç¯å¢ƒéƒ¨ç½²ï¼š</strong>ç”¨äºæ„å»ºæ¨¡å‹è½¬æ¢å’Œåº”ç”¨å¼€å‘çš„ä¾èµ–ç¯å¢ƒï¼Œè¿™ä¸ªåŠ¨ä½œåªéœ€è¦åœ¨æ‚¨ç¬¬ä¸€æ¬¡å·¥å…·é“¾æ—¶åšä¸€éå³å¯ã€‚ å…·ä½“éƒ¨ç½²æ–¹å¼è¯·å‚è€ƒ <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/env_install/env_deploy.html" >ç¯å¢ƒéƒ¨ç½² <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ç« èŠ‚ã€‚</em></p>
<p><em><strong>æ¨¡å‹è®­ç»ƒï¼š</strong>ï¼ŒæŒ‡ä½¿ç”¨TensorFlowã€PyTorchã€Caffeç­‰å…¬å¼€æ·±åº¦å­¦ä¹ æ¡†æ¶å¾—åˆ°å¯ç”¨æ¨¡å‹çš„è¿‡ç¨‹ï¼Œé€šè¿‡è®­ç»ƒå¾—åˆ°çš„å¯ç”¨æ¨¡å‹å°†ä½œä¸ºæ¨¡å‹è½¬æ¢é˜¶æ®µçš„è¾“å…¥ã€‚ å·¥å…·é“¾æœ¬èº«ä¸ä¼šæä¾›è®­ç»ƒç›¸å…³çš„åº“æˆ–å·¥å…·ï¼Œå…·ä½“æ”¯æŒçš„å…¬å¼€å­¦ä¹ æ¡†æ¶å¯ä»¥å‚è€ƒ <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/ptq/ptq_usage/model_prepare.html" >æµ®ç‚¹æ¨¡å‹å‡†å¤‡ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ç« èŠ‚ä¸­çš„è¯´æ˜ã€‚</em></p>
<p><em><strong>æ¨¡å‹è½¬æ¢ï¼š</strong>æœ¬é˜¶æ®µä»¥æ¨¡å‹è®­ç»ƒå¾—åˆ°çš„æµ®ç‚¹æ¨¡å‹ä¸ºè¾“å…¥ï¼Œé€šè¿‡æ¨¡å‹ç»“æ„ä¼˜åŒ–ã€æ¨¡å‹æ ¡å‡†é‡åŒ–ç­‰é‡è¦æ­¥éª¤ï¼Œ å°†æµ®ç‚¹æ¨¡å‹è½¬æ¢ä¸ºå¯ä»¥åœ¨åœ°å¹³çº¿èŠ¯ç‰‡å¹³å°é«˜æ•ˆè¿è¡Œçš„æ··åˆå¼‚æ„æ¨¡å‹ã€‚ ä¸ºäº†éªŒè¯å¼‚æ„æ¨¡å‹çš„å¯ç”¨æ€§ï¼Œå·¥å…·é“¾è¿˜æä¾›äº†æ€§èƒ½åˆ†æã€ç²¾åº¦åˆ†æå’Œä¸°å¯Œçš„å¼‚å¸¸è°ƒè¯•å·¥å…·ä¸å»ºè®®ã€‚ å…·ä½“ä½¿ç”¨è¯·å‚è€ƒ <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/ptq/ptq_usage/quantize_compile.html" >æ¨¡å‹é‡åŒ–å’Œç¼–è¯‘ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ã€ <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/ptq/ptq_usage/performance_evaluation.html" >æ¨¡å‹æ€§èƒ½åˆ†æä¸è°ƒä¼˜ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ã€ <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/ptq/ptq_usage/accuracy_evaluation.html" >æ¨¡å‹ç²¾åº¦åˆ†æä¸è°ƒä¼˜ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ç« èŠ‚ä¸­çš„è¯´æ˜ã€‚</em></p>
<p><em><strong>ç®—å­å¼€å‘ï¼š</strong>æœ¬é˜¶æ®µæ˜¯ä¸€ä¸ªå¯é€‰é˜¶æ®µï¼Œä¸»è¦æ˜¯è§£å†³æ¨¡å‹å­˜åœ¨å·¥å…·é“¾ä¸æ”¯æŒç®—å­çš„æƒ…å†µï¼Œå¦‚æœæ‚¨æ²¡æœ‰æ­¤ç§æƒ…å†µï¼Œå¯ä»¥ç›´æ¥å¿½ç•¥æœ¬é˜¶æ®µçš„å¤„ç†ã€‚ å…·ä½“ä½¿ç”¨æ–¹å¼è¯·å‚è€ƒ <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/ptq/ptq_usage/custom_op.html" >è‡ªå®šä¹‰ç®—å­å¼€å‘ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ç« èŠ‚ä¸­çš„è¯´æ˜ã€‚</em></p>
<blockquote>
<p><em>â€œæ¨¡å‹å­˜åœ¨å·¥å…·é“¾ä¸æ”¯æŒç®—å­çš„æƒ…å†µâ€ æ„å‘³ç€åœ¨ä½¿ç”¨æŸä¸ªç‰¹å®šçš„æ¨¡å‹å·¥å…·é“¾ï¼ˆä¾‹å¦‚æ·±åº¦å­¦ä¹ æ¡†æ¶æˆ–æ¨ç†å¼•æ“ï¼‰æ—¶ï¼Œå¯èƒ½ä¼šé‡åˆ°æ— æ³•æ”¯æŒæ¨¡å‹ä¸­çš„æŸäº›ç®—å­ï¼ˆæ“ä½œï¼‰çš„æƒ…å†µã€‚</em></p>
<p><em>åœ¨æ·±åº¦å­¦ä¹ ä¸­ï¼Œæ¨¡å‹é€šå¸¸ç”±å¤šä¸ªç®—å­ç»„æˆï¼Œæ¯ä¸ªç®—å­æ‰§è¡Œç‰¹å®šçš„æ“ä½œï¼Œå¦‚å·ç§¯ã€æ± åŒ–ã€æ¿€æ´»å‡½æ•°ç­‰ã€‚è¿™äº›ç®—å­åœ¨ä¸åŒçš„æ¨¡å‹å·¥å…·é“¾ä¸­å¯èƒ½å…·æœ‰ä¸åŒçš„å®ç°æ–¹å¼å’Œæ”¯æŒæƒ…å†µã€‚</em></p>
<p><em>å½“æ¨¡å‹ä¸­åŒ…å«ä¸€äº›ç‰¹å®šçš„ç®—å­ï¼Œè€Œæ‰€é€‰çš„æ¨¡å‹å·¥å…·é“¾ä¸æ”¯æŒè¿™äº›ç®—å­æ—¶ï¼Œå°±ä¼šå‡ºç°å·¥å…·é“¾ä¸æ”¯æŒç®—å­çš„æƒ…å†µã€‚è¿™å¯èƒ½æ˜¯ç”±äºå·¥å…·é“¾ç‰ˆæœ¬è¿‡ä½ã€ç®—å­åœ¨è¯¥å·¥å…·é“¾ä¸­å°šæœªå®ç°æˆ–ä¼˜åŒ–ï¼Œæˆ–è€…å·¥å…·é“¾æœ¬èº«ä¸æ”¯æŒç‰¹å®šç±»å‹çš„ç®—å­ã€‚</em></p>
<p><em>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œé€šå¸¸ä¼šæœ‰å‡ ç§å¤„ç†æ–¹å¼ï¼š</em></p>
<ol>
<li><em>å‡çº§å·¥å…·é“¾ï¼šå°è¯•å‡çº§æ‰€ä½¿ç”¨çš„æ¨¡å‹å·¥å…·é“¾åˆ°æ›´é«˜ç‰ˆæœ¬ï¼Œä»¥è·å¾—å¯¹æ›´å¤šç®—å­çš„æ”¯æŒã€‚æ–°ç‰ˆæœ¬çš„å·¥å…·é“¾é€šå¸¸ä¼šå¼•å…¥æ–°çš„åŠŸèƒ½å’Œç®—å­æ”¯æŒã€‚</em></li>
<li><em>ç®—å­æ›¿æ¢ï¼šå°è¯•ä½¿ç”¨å·¥å…·é“¾ä¸­æä¾›çš„å…¶ä»–ç®—å­æˆ–ç®—å­çš„æ›¿ä»£æ–¹å¼æ¥é‡æ–°è®¾è®¡æ¨¡å‹ï¼Œä»¥é¿å…ä½¿ç”¨ä¸å—æ”¯æŒçš„ç®—å­ã€‚</em></li>
<li><em>è‡ªå®šä¹‰å®ç°ï¼šåœ¨å·¥å…·é“¾ä¸­æ·»åŠ è‡ªå®šä¹‰çš„ç®—å­å®ç°ï¼Œä»¥ä½¿å…¶èƒ½å¤Ÿæ”¯æŒæ¨¡å‹ä¸­çš„ç‰¹å®šç®—å­ã€‚è¿™é€šå¸¸éœ€è¦æ·±å…¥äº†è§£å·¥å…·é“¾çš„æ‰©å±•æœºåˆ¶å’Œç¼–ç¨‹æ¥å£ã€‚</em></li>
<li><em>åˆ‡æ¢å·¥å…·é“¾ï¼šå¦‚æœå½“å‰å·¥å…·é“¾æ— æ³•æ»¡è¶³æ¨¡å‹çš„éœ€æ±‚ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨å…¶ä»–æ”¯æŒæ‰€éœ€ç®—å­çš„æ¨¡å‹å·¥å…·é“¾æˆ–æ¨ç†å¼•æ“ã€‚</em></li>
</ol>
<p><em>æ€»ä¹‹ï¼Œå½“æ¨¡å‹ä¸­çš„æŸäº›ç®—å­æ— æ³•åœ¨ç‰¹å®šçš„æ¨¡å‹å·¥å…·é“¾ä¸­å¾—åˆ°æ”¯æŒæ—¶ï¼Œéœ€è¦è€ƒè™‘å‡çº§å·¥å…·é“¾ã€æ›¿æ¢ç®—å­ã€è‡ªå®šä¹‰å®ç°æˆ–åˆ‡æ¢å·¥å…·é“¾ç­‰æ–¹å¼æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</em></p>
</blockquote>
<p><em><strong>åµŒå…¥å¼åº”ç”¨å¼€å‘ï¼š</strong>å·¥å…·é“¾æ”¯æŒäº†åœ¨X86ä»¿çœŸç¯å¢ƒå’ŒçœŸå®åµŒå…¥å¼ç¯å¢ƒçš„åº”ç”¨å¼€å‘èƒ½åŠ›ï¼Œåœ¨ä¸æ–¹ä¾¿ä½¿ç”¨å¼€å‘æ¿çš„æƒ…å†µä¸‹ï¼Œ æ‚¨åœ¨ä»¿çœŸç¯å¢ƒå®Œæˆç¨‹åºçš„è°ƒè¯•å’Œè®¡ç®—ç»“æœçš„éªŒè¯ã€‚ ä¸ºäº†é™ä½ä»¿çœŸéªŒè¯çš„ä»£ä»·ï¼Œå·¥å…·é“¾æä¾›çš„ä»¿çœŸåº“æ¥å£ä¸åµŒå…¥å¼æ¥å£å®Œå…¨ä¸€è‡´ï¼Œåªæ˜¯é‡‡ç”¨äº†ä¸åŒçš„ç¼–è¯‘é…ç½®ã€‚ å…·ä½“ä½¿ç”¨æ–¹å¼è¯·å‚è€ƒ <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/runtime/source/runtime_dev.html" >åµŒå…¥å¼åº”ç”¨å¼€å‘æŒ‡å¯¼ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ç« èŠ‚ä¸­çš„è¯´æ˜ã€‚</em></p>
<blockquote>
<p><em><strong>PTQè½¬æ¢çš„æµç¨‹ä¸æ­¥éª¤</strong></em></p>
</blockquote>
<p><em>æ¨¡å‹è½¬æ¢æ˜¯æŒ‡å°†åŸå§‹æµ®ç‚¹æ¨¡å‹è½¬æ¢ä¸ºåœ°å¹³çº¿æ··åˆå¼‚æ„æ¨¡å‹çš„è¿‡ç¨‹ã€‚</em></p>
<p><em>åŸå§‹æµ®ç‚¹æ¨¡å‹ï¼ˆæ–‡ä¸­éƒ¨åˆ†åœ°æ–¹ä¹Ÿç§°ä¸ºæµ®ç‚¹æ¨¡å‹ï¼‰æ˜¯æŒ‡æ‚¨é€šè¿‡TensorFlow&#x2F;PyTorchç­‰ç­‰DLæ¡†æ¶è®­ç»ƒå¾—åˆ°çš„å¯ç”¨æ¨¡å‹ï¼Œè¿™ä¸ªæ¨¡å‹çš„è®¡ç®—ç²¾åº¦ä¸ºfloat32ï¼›æ··åˆå¼‚æ„æ¨¡å‹æ˜¯ä¸€ç§é€‚åˆåœ¨åœ°å¹³çº¿èŠ¯ç‰‡ä¸Šè¿è¡Œçš„æ¨¡å‹æ ¼å¼ã€‚</em></p>
<p><em>æœ¬ç« èŠ‚å°†åå¤ä½¿ç”¨åˆ°è¿™ä¸¤ç§æ¨¡å‹åè¯ï¼Œä¸ºé¿å…ç†è§£æ­§ä¹‰ï¼Œè¯·å…ˆç†è§£è¿™ä¸ªæ¦‚å¿µå†é˜…è¯»ä¸‹æ–‡ã€‚</em></p>
<p><em>é…åˆåœ°å¹³çº¿å·¥å…·é“¾çš„æ¨¡å‹å®Œæ•´å¼€å‘è¿‡ç¨‹ï¼Œéœ€è¦ç»è¿‡ <strong>æµ®ç‚¹æ¨¡å‹å‡†å¤‡</strong> ã€ <strong>æ¨¡å‹æ£€æŸ¥</strong> ã€ <strong>æ¨¡å‹è½¬æ¢</strong> ã€ <strong>æ€§èƒ½è¯„ä¼°</strong> å’Œ <strong>ç²¾åº¦è¯„ä¼°</strong> å…±äº”ä¸ªé‡è¦é˜¶æ®µï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</em></p>
<p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230509082134522.png"
                      class="" title="image-20230509082134522"
                ></em></p>
<p><em><strong>æµ®ç‚¹æ¨¡å‹å‡†å¤‡</strong> é˜¶æ®µçš„äº§å‡ºæ˜¯è¾“å…¥åˆ°æ¨¡å‹è½¬æ¢å·¥å…·çš„æµ®ç‚¹æ¨¡å‹ï¼Œ è¿™äº›æ¨¡å‹ä¸€èˆ¬éƒ½æ˜¯åŸºäºå…¬å¼€DLè®­ç»ƒæ¡†æ¶å¾—åˆ°çš„ï¼Œ éœ€è¦æ‚¨æ³¨æ„çš„æ˜¯å°†æ¨¡å‹å¯¼å‡ºä¸ºåœ°å¹³çº¿å·¥å…·æ”¯æŒçš„æ ¼å¼ã€‚ å…·ä½“è¦æ±‚ä¸å»ºè®®è¯·å‚è€ƒ <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/ptq/ptq_usage/model_prepare.html" >æµ®ç‚¹æ¨¡å‹å‡†å¤‡ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ç« èŠ‚ã€‚</em></p>
<p><em><strong>æ¨¡å‹æ£€æŸ¥</strong> é˜¶æ®µç”¨æ¥ç¡®ä¿ç®—æ³•æ¨¡å‹æ˜¯ç¬¦åˆèŠ¯ç‰‡è¦æ±‚çš„ã€‚ åœ°å¹³çº¿æä¾›äº†æŒ‡å®šå·¥å…·å®Œæˆæ­¤é˜¶æ®µæ£€æŸ¥ï¼Œå¯¹äºä¸ç¬¦åˆè¦æ±‚çš„æƒ…å†µï¼Œ æ£€æŸ¥å·¥å…·ä¼šæ˜ç¡®ç»™å‡ºä¸ç¬¦åˆè¦æ±‚çš„å…·ä½“ç®—å­ä¿¡æ¯ï¼Œæ–¹ä¾¿æ‚¨ç»“åˆç®—å­çº¦æŸçš„è¯´æ˜å°†æ¨¡å‹è°ƒæ•´è¿‡æ¥ã€‚ å…·ä½“ä½¿ç”¨è¯·å‚è€ƒ <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/ptq/ptq_usage/check_model.html" >éªŒè¯æ¨¡å‹ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ç« èŠ‚ã€‚</em></p>
<p><em><strong>æ¨¡å‹è½¬æ¢</strong> é˜¶æ®µå°†å®Œæˆæµ®ç‚¹æ¨¡å‹åˆ°åœ°å¹³çº¿æ··åˆå¼‚æ„æ¨¡å‹çš„è½¬æ¢ã€‚ ä¸ºäº†æ¨¡å‹èƒ½åœ¨åœ°å¹³çº¿èŠ¯ç‰‡ä¸Šé«˜æ•ˆè¿è¡Œï¼Œåœ°å¹³çº¿è½¬æ¢å·¥å…·å†…éƒ¨ä¼šå®Œæˆæ¨¡å‹ä¼˜åŒ–ã€é‡åŒ–å’Œç¼–è¯‘ç­‰å…³é”®æ­¥éª¤ï¼Œ åœ°å¹³çº¿çš„é‡åŒ–æ–¹æ³•ç»è¿‡äº†é•¿æœŸçš„æŠ€æœ¯ä¸ç”Ÿäº§éªŒè¯ï¼Œåœ¨å¤§éƒ¨åˆ†å…¸å‹æ¨¡å‹ä¸Šå¯ä»¥ä¿è¯ç²¾åº¦æŸå¤±å°äº1%ã€‚ å…·ä½“ä½¿ç”¨è¯·å‚è€ƒ <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/ptq/ptq_usage/prepare_calibration_data.html" >æ ¡å‡†æ•°æ®å‡†å¤‡ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> åŠ <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/ptq/ptq_usage/quantize_compile.html" >æ¨¡å‹é‡åŒ–ä¸ç¼–è¯‘ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ç« èŠ‚ã€‚</em></p>
<p><em><strong>æ€§èƒ½è¯„ä¼°</strong> é˜¶æ®µæä¾›äº†ç³»åˆ—è¯„ä¼°æ¨¡å‹æ€§èƒ½çš„å·¥å…·ã€‚ åœ¨åº”ç”¨éƒ¨ç½²å‰ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨è¿™äº›å·¥å…·éªŒè¯æ¨¡å‹æ€§èƒ½æ˜¯å¦è¾¾åˆ°åº”ç”¨è¦æ±‚ã€‚ å¯¹äºéƒ¨åˆ†æ€§èƒ½ä¸åŠé¢„æœŸçš„æƒ…å†µï¼Œä¹Ÿå¯ä»¥å‚è€ƒåœ°å¹³çº¿æä¾›çš„æ€§èƒ½ä¼˜åŒ–å»ºè®®è¿›è¡Œè°ƒä¼˜ã€‚ å…·ä½“è¯„ä¼°è¯·å‚è€ƒ <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/ptq/ptq_usage/performance_evaluation.html" >æ¨¡å‹æ€§èƒ½åˆ†æä¸è°ƒä¼˜ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ç« èŠ‚ã€‚</em></p>
<p><em><strong>ç²¾åº¦è¯„ä¼°</strong> é˜¶æ®µæä¾›äº†ç³»åˆ—è¯„ä¼°æ¨¡å‹ç²¾åº¦çš„å·¥å…·ã€‚ å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œåœ°å¹³çº¿è½¬æ¢åæ¨¡å‹å¯ä»¥ä¿æŒä¸åŸå§‹æµ®ç‚¹æ¨¡å‹åŸºæœ¬ä¸€è‡´çš„ç²¾åº¦æ•ˆæœï¼Œ åœ¨åº”ç”¨éƒ¨ç½²å‰ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨åœ°å¹³çº¿å·¥å…·éªŒè¯æ¨¡å‹çš„ç²¾åº¦æ˜¯å¦ç¬¦åˆé¢„æœŸã€‚ å¯¹äºéƒ¨åˆ†ç²¾åº¦ä¸åŠé¢„æœŸçš„æƒ…å†µï¼Œä¹Ÿå¯ä»¥å‚è€ƒåœ°å¹³çº¿æä¾›çš„æ€§èƒ½ä¼˜åŒ–å»ºè®®è¿›è¡Œè°ƒä¼˜ã€‚ å…·ä½“è¯„ä¼°è¯·å‚è€ƒ <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/ptq/ptq_usage/accuracy_evaluation.html" >æ¨¡å‹ç²¾åº¦åˆ†æä¸è°ƒä¼˜ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ç« èŠ‚ã€‚</em></p>
<p><em>æ³¨æ„ï¼š</em></p>
<ul>
<li><em>é€šå¸¸åœ¨æ¨¡å‹è½¬æ¢åå°±å·²ç»å¾—åˆ°äº†å¯ä»¥ä¸Šæ¿çš„æ¨¡å‹ï¼Œ ä½†æ˜¯ä¸ºäº†ç¡®ä¿æ‚¨å¾—åˆ°çš„æ¨¡å‹æ€§èƒ½å’Œç²¾åº¦éƒ½æ˜¯ç¬¦åˆåº”ç”¨è¦æ±‚çš„ï¼Œ åœ°å¹³çº¿å¼ºçƒˆå»ºè®®æ¯æ¬¡è½¬æ¢åéƒ½å®Œæˆåç»­çš„æ€§èƒ½è¯„ä¼°ä¸ç²¾åº¦è¯„ä¼°æ­¥éª¤ã€‚</em></li>
<li><em>æ¨¡å‹è½¬æ¢è¿‡ç¨‹ä¼šç”Ÿæˆonnxæ¨¡å‹ï¼Œè¯¥æ¨¡å‹å‡ä¸ºä¸­é—´äº§ç‰©ï¼Œåªæ˜¯ä¾¿äºç”¨æˆ·éªŒè¯æ¨¡å‹ç²¾åº¦æƒ…å†µï¼Œ å› æ­¤ä¸ä¿è¯å…¶åœ¨ç‰ˆæœ¬é—´çš„å…¼å®¹æ€§ã€‚è‹¥ä½¿ç”¨ç¤ºä¾‹ä¸­çš„è¯„æµ‹è„šæœ¬å¯¹onnxæ¨¡å‹å•å¼ æˆ–åœ¨æµ‹è¯•é›†ä¸Šè¿›è¡Œè¯„æµ‹æ—¶ï¼Œ è¯·ä½¿ç”¨å½“å‰ç‰ˆæœ¬å·¥å…·ç”Ÿæˆçš„onnxæ¨¡å‹è¿›è¡Œæ“ä½œã€‚</em></li>
</ul>
<blockquote>
<p><em>ç®—å­çº¦æŸ</em></p>
</blockquote>
<p><em>ä¸ºäº†ç¡®ä¿æ¨¡å‹èƒ½é¡ºåˆ©åœ¨åœ°å¹³çº¿å¹³å°é«˜æ•ˆè¿è¡Œï¼Œæ¨¡å‹ä¸­æ‰€ä½¿ç”¨çš„ç®—å­éœ€è¦ç¬¦åˆå¹³å°çš„ç®—å­çº¦æŸã€‚ å› æ­¤ï¼Œä¸ºæ–¹ä¾¿æ‚¨äº†è§£å½“å‰ç‰ˆæœ¬æ”¯æŒçš„ç®—å­ä¿¡æ¯åŠå¯¹åº”çº¦æŸæ¡ä»¶ï¼Œæ‚¨å¯ä»¥åœ¨è¿›è¡Œæµ®ç‚¹æ¨¡å‹å‡†å¤‡å‰ï¼Œ å…ˆå‚ç…§ <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/appendix/supported_op_list.html" >æ¨¡å‹è½¬æ¢å·¥å…·é“¾ç®—å­æ”¯æŒçº¦æŸåˆ—è¡¨ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ç« èŠ‚ä¸­å†…å®¹è¿›è¡ŒæŸ¥è¯¢ã€‚</em></p>
<blockquote>
<p><em>æµ®ç‚¹æ¨¡å‹å‡†å¤‡</em></p>
</blockquote>
<p><em>åœ¨æ‚¨é˜…è¯»æœ¬èŠ‚å†…å®¹å‰ï¼Œæˆ‘ä»¬å»ºè®®æ‚¨å…ˆé˜…è¯»æˆ‘ä»¬çš„ç®—å­æ”¯æŒåˆ—è¡¨ï¼Œå¯¹åœ°å¹³çº¿æ”¯æŒçš„ç®—å­åŠçº¦æŸæ¡ä»¶è¿›è¡Œäº†è§£ï¼Œ æˆ–åœ¨æ‚¨å¯¼å‡ºONNXæ¨¡å‹åï¼Œå¯ä»¥å…ˆå‚è€ƒ <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/ptq/ptq_usage/check_model.html" >éªŒè¯æ¨¡å‹ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ç« èŠ‚çš„å†…å®¹ï¼Œ éªŒè¯æ¨¡å‹æ˜¯å¦èƒ½è¢«åœ°å¹³çº¿æ”¯æŒå®Œæˆæ­£å¸¸è½¬æ¢éƒ¨ç½²ã€‚</em></p>
<p><em>åŸºäºå…¬å¼€DLæ¡†æ¶è®­ç»ƒå¾—åˆ°çš„æµ®ç‚¹æ¨¡å‹æ˜¯è½¬æ¢å·¥å…·çš„è¾“å…¥ï¼Œç›®å‰è½¬æ¢å·¥å…·æ”¯æŒçš„DLæ¡†æ¶å¦‚ä¸‹ï¼š</em></p>
<p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230509082954384.png"
                      class="" title="image-20230509082954384"
                ></em></p>
<p><em>ä»¥ä¸Šæ¡†æ¶ä¸­ï¼ŒCaffeå¯¼å‡ºçš„caffemodelæ˜¯ç›´æ¥æ”¯æŒçš„ï¼› PyTorchã€TensorFlowå’ŒMXNetæ˜¯é€šè¿‡è½¬åˆ°ONNXå®ç°é—´æ¥æ”¯æŒï¼Œ ONNXç›®å‰ä¸»è¦æ”¯æŒçš„opsetç‰ˆæœ¬æ˜¯opset10å’Œopset11ã€‚</em></p>
<p><em>å¯¹äºä¸åŒæ¡†æ¶åˆ°ONNXçš„è½¬æ¢ï¼Œç›®å‰éƒ½æœ‰å¯¹åº”çš„æ ‡å‡†åŒ–æ–¹æ¡ˆï¼Œå‚è€ƒå¦‚ä¸‹ï¼š</em></p>
<ul>
<li><p><em>ğŸ”— Pytorch2Onnxï¼šPytTorchå®˜æ–¹APIæ”¯æŒç›´æ¥å°†æ¨¡å‹å¯¼å‡ºä¸ºONNXæ¨¡å‹ï¼Œå‚è€ƒé“¾æ¥ï¼š</em></p>
<p><em><a class="link"   target="_blank" rel="noopener" href="https://pytorch.org/tutorials/advanced/super_resolution_with_onnxruntime.html%E3%80%82" >https://pytorch.org/tutorials/advanced/super_resolution_with_onnxruntime.htmlã€‚ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></em></p>
</li>
<li><p><em>ğŸ”— Tensorflow2Onnxï¼šåŸºäºONNXç¤¾åŒºçš„onnx&#x2F;tensorflow-onnx è¿›è¡Œè½¬æ¢ï¼Œå‚è€ƒé“¾æ¥ï¼š</em></p>
<p><em><a class="link"   target="_blank" rel="noopener" href="https://github.com/onnx/tensorflow-onnx%E3%80%82" >https://github.com/onnx/tensorflow-onnxã€‚ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></em></p>
</li>
<li><p><em>ğŸ”— MXNet2Onnxï¼šMXNetå®˜æ–¹APIæ”¯æŒç›´æ¥å°†æ¨¡å‹å¯¼å‡ºä¸ºONNXæ¨¡å‹ï¼Œå‚è€ƒé“¾æ¥ï¼š</em></p>
<p><em><a class="link"   target="_blank" rel="noopener" href="https://github.com/dotnet/machinelearning/blob/master/test/Microsoft.ML.Tests/OnnxConversionTest.cs%E3%80%82" >https://github.com/dotnet/machinelearning/blob/master/test/Microsoft.ML.Tests/OnnxConversionTest.csã€‚ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></em></p>
</li>
<li><p><em>ğŸ”— æ›´å¤šæ¡†æ¶çš„ONNXè½¬æ¢æ”¯æŒï¼Œå‚è€ƒé“¾æ¥ï¼š</em></p>
<p><em><a class="link"   target="_blank" rel="noopener" href="https://github.com/onnx/tutorials#converting-to-onnx-format%E3%80%82" >https://github.com/onnx/tutorials#converting-to-onnx-formatã€‚ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></em></p>
</li>
</ul>
<p><em><strong>æ³¨æ„ï¼šåŸå§‹æ¨¡å‹é™åˆ¶ï¼šir_versionâ‰¤7, opset&#x3D;10æˆ–11ï¼Œir_versionä¸onnxç‰ˆæœ¬çš„å¯¹åº”å…³ç³»è¯·å‚è€ƒ <a class="link"   target="_blank" rel="noopener" href="https://github.com/onnx/onnx/blob/main/docs/Versioning.md" >onnxå®˜æ–¹æ–‡æ¡£ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ã€‚</strong></em></p>
<blockquote>
<p><em>â€œOpsetâ€ æ˜¯æŒ‡æ“ä½œé›†ç‰ˆæœ¬ï¼ˆOperation Set Versionï¼‰ï¼Œåœ¨æ·±åº¦å­¦ä¹ æ¡†æ¶ä¸­ç”¨äºæè¿°å’Œæ ‡è¯†æ”¯æŒçš„æ“ä½œé›†åˆå’Œå¯¹åº”ç‰ˆæœ¬ã€‚</em></p>
<p><em>æ·±åº¦å­¦ä¹ æ¡†æ¶é€šå¸¸æ”¯æŒä¸€ç³»åˆ—æ“ä½œï¼ˆç®—å­ï¼‰ï¼Œä¾‹å¦‚å·ç§¯ã€æ± åŒ–ã€æ¿€æ´»å‡½æ•°ç­‰ã€‚è¿™äº›æ“ä½œå¯ä»¥æŒ‰ç…§ä¸åŒçš„ç‰ˆæœ¬è¿›è¡Œç»„ç»‡å’Œå®šä¹‰ã€‚æ¯ä¸ªæ“ä½œé›†ç‰ˆæœ¬éƒ½å®šä¹‰äº†ä¸€ç»„æ“ä½œåŠå…¶è§„èŒƒï¼Œä»¥ç¡®ä¿åœ¨è¯¥ç‰ˆæœ¬ä¸‹çš„æ¨¡å‹å¯ä»¥æ­£ç¡®æ‰§è¡Œå’Œè¿è¡Œã€‚</em></p>
<p><em><strong>Opset çš„ç‰ˆæœ¬å·é€šå¸¸ä¸æ·±åº¦å­¦ä¹ æ¡†æ¶çš„ç‰ˆæœ¬å·ç›¸å…³è”ã€‚æ¯ä¸ªæ¡†æ¶ç‰ˆæœ¬ä¼šå¼•å…¥æ–°çš„æ“ä½œæˆ–å¯¹å·²æœ‰æ“ä½œè¿›è¡Œä¿®æ”¹ã€ä¼˜åŒ–æˆ–ä¿®å¤ï¼Œå› æ­¤å¯¹åº”çš„æ“ä½œé›†ç‰ˆæœ¬ä¹Ÿä¼šç›¸åº”æ›´æ–°ã€‚</strong></em></p>
<p><em>åœ¨ä½¿ç”¨æ·±åº¦å­¦ä¹ æ¨¡å‹æ—¶ï¼Œéœ€è¦ç¡®ä¿æ‰€é€‰æ¡†æ¶ç‰ˆæœ¬æ”¯æŒæ¨¡å‹ä¸­ä½¿ç”¨çš„æ“ä½œã€‚è¿™å°±éœ€è¦æ£€æŸ¥æ¨¡å‹çš„æ“ä½œé›†ç‰ˆæœ¬å’Œæ‰€é€‰æ¡†æ¶çš„æ“ä½œé›†ç‰ˆæœ¬æ˜¯å¦å…¼å®¹ã€‚å¦‚æœæ¨¡å‹ä¸­ä½¿ç”¨äº†ä¸å—æ‰€é€‰æ¡†æ¶æ”¯æŒçš„æ“ä½œï¼Œå°±å¯èƒ½ä¼šé‡åˆ°ä¸å…¼å®¹æˆ–æ— æ³•æ­£ç¡®è¿è¡Œçš„é—®é¢˜ã€‚</em></p>
<p><em>å› æ­¤ï¼Œåœ¨å¯¼å…¥æˆ–åŠ è½½æ¨¡å‹æ—¶ï¼Œéœ€è¦ç¡®ä¿æ‰€é€‰æ¡†æ¶çš„æ“ä½œé›†ç‰ˆæœ¬ä¸æ¨¡å‹ä¸­ä½¿ç”¨çš„æ“ä½œé›†ç‰ˆæœ¬åŒ¹é…ã€‚è¿™é€šå¸¸æ¶‰åŠåˆ°å¯¹æ¨¡å‹è¿›è¡Œè½¬æ¢æˆ–æ›´æ–°ä»¥é€‚åº”æ‰€é€‰æ¡†æ¶çš„æ“ä½œé›†ç‰ˆæœ¬ã€‚</em></p>
</blockquote>
<blockquote>
<p><em>éªŒè¯æ¨¡å‹</em></p>
</blockquote>
<p><em>ä¸ºäº†ç¡®ä¿æ¨¡å‹èƒ½é¡ºåˆ©åœ¨åœ°å¹³çº¿å¹³å°é«˜æ•ˆè¿è¡Œï¼Œæ¨¡å‹ä¸­æ‰€ä½¿ç”¨çš„ç®—å­éœ€è¦ç¬¦åˆå¹³å°çš„ç®—å­çº¦æŸã€‚ ç®—å­çº¦æŸéƒ¨åˆ†ç»™å‡ºäº†æˆ‘ä»¬æ”¯æŒçš„å…·ä½“ç®—å­ï¼Œæ¯ä¸ªç®—å­éƒ½ç»™å‡ºäº†å…·ä½“çš„å‚æ•°é™åˆ¶ï¼Œ å…·ä½“è¯¦ç»†ä¿¡æ¯è¯·å‚è€ƒ <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/appendix/supported_op_list.html" >æ¨¡å‹è½¬æ¢å·¥å…·é“¾ç®—å­æ”¯æŒçº¦æŸåˆ—è¡¨ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ç« èŠ‚çš„å†…å®¹ã€‚ è€ƒè™‘åˆ°åœ°å¹³çº¿æ”¯æŒçš„ç®—å­è¾ƒå¤šï¼Œä¸ºäº†é¿å…äººå·¥é€æ¡æ ¡å¯¹çš„éº»çƒ¦ï¼Œ æˆ‘ä»¬æä¾›äº† <code>hb_mapper checker</code> å·¥å…·ç”¨äºéªŒè¯æ¨¡å‹æ‰€ä½¿ç”¨ç®—å­çš„æ”¯æŒæƒ…å†µã€‚</em></p>
<p><em><strong>ä½¿ç”¨hb_mappercheckerå·¥å…·éªŒè¯æ¨¡å‹</strong></em></p>
<p><em>hb_mapper checker å·¥å…·çš„ä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">hb_mapper checker --model-type $&#123;model_type&#125; \</span><br><span class="line">                  --march $&#123;march&#125; \</span><br><span class="line">                  --proto $&#123;proto&#125; \</span><br><span class="line">                  --model $&#123;caffe_model/onnx_model&#125; \</span><br><span class="line">                  --input-shape $&#123;input_node&#125; $&#123;input_shape&#125; \</span><br><span class="line">                  --output $&#123;output&#125;</span><br></pre></td></tr></table></figure></div>

<p><em>hb_mapper checker å‚æ•°è§£é‡Šï¼š</em></p>
<ul>
<li><p><em>â€“model-type</em></p>
<p><em>ç”¨äºæŒ‡å®šæ£€æŸ¥è¾“å…¥çš„æ¨¡å‹ç±»å‹ï¼Œç›®å‰åªæ”¯æŒè®¾ç½® <code>caffe</code> æˆ–è€… <code>onnx</code>ã€‚</em></p>
</li>
<li><p><em>â€“march</em></p>
<p><em>ç”¨äºæŒ‡å®šéœ€è¦é€‚é…çš„èŠ¯ç‰‡ç±»å‹ï¼Œå¯è®¾ç½®å€¼ä¸º <code>bernoulli2</code> å’Œ <code>bayes</code>ï¼Œ åˆ†åˆ«å¯¹åº”X3&amp;J3å’ŒJ5èŠ¯ç‰‡ï¼Œæ ¹æ®æ‚¨éœ€è¦é€‚é…çš„å¹³å°é€‰æ‹©å³å¯ã€‚</em></p>
</li>
<li><p><em>â€“proto</em></p>
<p><em>æ­¤å‚æ•°ä»…åœ¨ <code>model-type</code> æŒ‡å®š <code>caffe</code> æ—¶æœ‰æ•ˆï¼Œå–å€¼ä¸ºCaffeæ¨¡å‹çš„prototxtæ–‡ä»¶åç§°ã€‚</em></p>
</li>
<li><p><em>â€“model</em></p>
<p><em>åœ¨ <code>model-type</code> è¢«æŒ‡å®šä¸º <code>caffe</code> æ—¶ï¼Œå–å€¼ä¸ºCaffeæ¨¡å‹çš„caffemodelæ–‡ä»¶åç§°ã€‚ åœ¨ <code>model-type</code> è¢«æŒ‡å®šä¸º <code>onnx</code> æ—¶ï¼Œå–å€¼ä¸ºONNXæ¨¡å‹æ–‡ä»¶åç§°ã€‚</em></p>
</li>
<li><p><em>â€“input-shape</em></p>
<p><em>å¯é€‰å‚æ•°ï¼Œæ˜ç¡®æŒ‡å®šæ¨¡å‹çš„è¾“å…¥shapeã€‚ å–å€¼ä¸º <code>&#123;input_name&#125; &#123;NxHxWxC/NxCxHxW&#125;</code> ï¼Œ<code>input_name</code> ä¸shapeä¹‹é—´ä»¥ç©ºæ ¼åˆ†éš”ã€‚ ä¾‹å¦‚æ¨¡å‹è¾“å…¥åç§°ä¸º <code>data1</code>ï¼Œè¾“å…¥shapeä¸º <code>[1,224,224,3]</code>ï¼Œ åˆ™é…ç½®åº”è¯¥ä¸º <code>--input-shape data1 1x224x224x3</code>ã€‚ å¦‚æœæ­¤å¤„é…ç½®shapeä¸æ¨¡å‹å†…shapeä¿¡æ¯ä¸ä¸€è‡´ï¼Œä»¥æ­¤å¤„é…ç½®ä¸ºå‡†ã€‚</em></p>
</li>
</ul>
<p><em><strong>æ³¨æ„ï¼š</strong></em></p>
<ul>
<li><em><strong>ä¸€ä¸ª <code>--input-shape</code> åªæ¥å—ä¸€ä¸ªnameå’Œshapeç»„åˆï¼Œå¦‚æœæ‚¨çš„æ¨¡å‹æœ‰å¤šä¸ªè¾“å…¥èŠ‚ç‚¹ï¼Œ åœ¨å‘½ä»¤ä¸­å¤šæ¬¡é…ç½® <code>--input-shape</code> å‚æ•°å³å¯ã€‚</strong></em></li>
<li><em><strong>â€“outputå‚æ•°å·²ç»åºŸå¼ƒï¼Œlogä¿¡æ¯é»˜è®¤å­˜å‚¨äº <code>hb_mapper_checker.log</code> ä¸­ã€‚</strong></em></li>
</ul>
<p><em><strong>æ£€æŸ¥å¼‚å¸¸å¤„ç†</strong></em></p>
<p><em>å¦‚æœæ¨¡å‹æ£€æŸ¥ä¸é€šè¿‡ï¼Œ <code>hb_mapper checker</code> å·¥å…·ä¼šæŠ¥å‡ºERRORã€‚ åœ¨å½“å‰å·¥ä½œç›®å½•ä¸‹ä¼šç”Ÿæˆ <code>hb_mapper_checker_&#123;date_time&#125;.log</code> æ–‡ä»¶ï¼Œä»æ–‡ä»¶ä¸­å¯ä»¥æŸ¥çœ‹åˆ°å…·ä½“çš„æŠ¥é”™ã€‚ ä¾‹å¦‚ä»¥ä¸‹é…ç½®ä¸­å«ä¸å¯è¯†åˆ«ç®—å­ç±»å‹ <code>Accuracy</code>ï¼š</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">layer &#123;</span><br><span class="line">  name: &quot;data&quot;</span><br><span class="line">  type: &quot;Input&quot;</span><br><span class="line">  top: &quot;data&quot;</span><br><span class="line">  input_param &#123; shape: &#123; dim: 1 dim: 3 dim: 224 dim: 224 &#125; &#125;</span><br><span class="line">&#125;</span><br><span class="line">layer &#123;</span><br><span class="line">  name: &quot;Convolution1&quot;</span><br><span class="line">  type: &quot;Convolution&quot;</span><br><span class="line">  bottom: &quot;data&quot;</span><br><span class="line">  top: &quot;Convolution1&quot;</span><br><span class="line">  convolution_param &#123;</span><br><span class="line">    num_output: 128</span><br><span class="line">    bias_term: false</span><br><span class="line">    pad: 0</span><br><span class="line">    kernel_size: 1</span><br><span class="line">    group: 1</span><br><span class="line">    stride: 1</span><br><span class="line">    weight_filler &#123;</span><br><span class="line">      type: &quot;msra&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">layer &#123;</span><br><span class="line">  name: &quot;accuracy&quot;</span><br><span class="line">  type: &quot;Accuracy&quot;</span><br><span class="line">  bottom: &quot;Convolution3&quot;</span><br><span class="line">  top: &quot;accuracy&quot;</span><br><span class="line">  include &#123;</span><br><span class="line">    phase: TEST</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p><em>ä½¿ç”¨ <code>hb_mapper checker</code> æ£€æŸ¥è¿™ä¸ªæ¨¡å‹ï¼Œæ‚¨ä¼šåœ¨ <code>hb_mapper_checker_&#123;date_time&#125;.log</code> ä¸­å¾—åˆ°å¦‚ä¸‹ä¿¡æ¯ï¼š</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ValueError: Not support layer name=accuracy type=Accuracy</span><br></pre></td></tr></table></figure></div>

<p><em><strong>æ£€æŸ¥ç»“æœè§£è¯»</strong></em></p>
<p><em>å¦‚æœä¸å­˜åœ¨ERRORï¼Œåˆ™é¡ºåˆ©é€šè¿‡æ ¡éªŒã€‚ <code>hb_mapper checker</code> å·¥å…·å°†ç›´æ¥è¾“å‡ºå¦‚ä¸‹ä¿¡æ¯ï¼š</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">==============================================</span><br><span class="line">Node         ON   Subgraph  Type</span><br><span class="line">----------------------------------------------</span><br><span class="line">conv1        BPU  id(0)     HzSQuantizedConv</span><br><span class="line">conv2_1/dw   BPU  id(0)     HzSQuantizedConv</span><br><span class="line">conv2_1/sep  BPU  id(0)     HzSQuantizedConv</span><br><span class="line">conv2_2/dw   BPU  id(0)     HzSQuantizedConv</span><br><span class="line">conv2_2/sep  BPU  id(0)     HzSQuantizedConv</span><br><span class="line">conv3_1/dw   BPU  id(0)     HzSQuantizedConv</span><br><span class="line">conv3_1/sep  BPU  id(0)     HzSQuantizedConv</span><br><span class="line">...</span><br></pre></td></tr></table></figure></div>

<p><em>ç»“æœä¸­æ¯è¡Œéƒ½ä»£è¡¨ä¸€ä¸ªæ¨¡å‹èŠ‚ç‚¹çš„checkæƒ…å†µï¼Œæ¯è¡Œå«Nodeã€ONã€Subgraphå’ŒTypeå››åˆ—ï¼Œ åˆ†åˆ«ä¸ºèŠ‚ç‚¹åç§°ã€æ‰§è¡ŒèŠ‚ç‚¹è®¡ç®—çš„ç¡¬ä»¶ã€èŠ‚ç‚¹æ‰€å±å­å›¾å’ŒèŠ‚ç‚¹æ˜ å°„åˆ°çš„åœ°å¹³çº¿å†…éƒ¨å®ç°åç§°ã€‚ <strong>å¦‚æœæ¨¡å‹åœ¨éè¾“å…¥å’Œè¾“å‡ºéƒ¨åˆ†å‡ºç°äº†CPUè®¡ç®—çš„ç®—å­ï¼Œå·¥å…·å°†æŠŠè¿™ä¸ªç®—å­å‰åè¿ç»­åœ¨BPUè®¡ç®—çš„éƒ¨åˆ†æ‹†åˆ†ä¸ºä¸¤ä¸ªSubgraphï¼ˆå­å›¾ï¼‰ã€‚</strong></em></p>
<p><em><strong>æ£€æŸ¥ç»“æœçš„è°ƒä¼˜æŒ‡å¯¼</strong></em></p>
<p><em>åœ¨æœ€ç†æƒ³çš„æƒ…å†µä¸‹ï¼Œéè¾“å…¥å’Œè¾“å‡ºéƒ¨åˆ†éƒ½åº”è¯¥åœ¨BPUä¸Šè¿è¡Œï¼Œä¹Ÿå°±æ˜¯åªæœ‰ä¸€ä¸ªå­å›¾ã€‚ å¦‚æœå‡ºç°äº†CPUç®—å­å¯¼è‡´æ‹†åˆ†å¤šä¸ªå­å›¾ï¼Œ <code>hb_mapper checker</code> å·¥å…·ä¼šç»™å‡ºå¯¼è‡´CPUç®—å­å‡ºç°çš„å…·ä½“åŸå› ã€‚ ä¾‹å¦‚ä»¥ä¸‹ONNXæ¨¡å‹çš„å‡ºç°äº†Mul + Add + Mulçš„ç»“æ„ï¼Œä»ç®—å­çº¦æŸåˆ—è¡¨ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒMulå’ŒAddç®—å­åœ¨äº”ç»´ä¸Šæ”¯æŒBPUè¿è¡Œæœ‰çº¦æŸæ¡ä»¶ã€‚</em></p>
<p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230509085125392.png"
                      class="" title="image-20230509085125392"
                ></em></p>
<p><em>å› æ­¤æ¨¡å‹æœ€ç»ˆæ£€æŸ¥ç»“æœä¹Ÿä¼šå‡ºç°åˆ†æ®µæƒ…å†µï¼Œå¦‚ä¸‹:</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">====================================================================================</span><br><span class="line">Node                                    ON   Subgraph  Type</span><br><span class="line">-------------------------------------------------------------------------------------</span><br><span class="line">Reshape_199                             BPU  id(0)     Reshape</span><br><span class="line">Transpose_200                           BPU  id(0)     Transpose</span><br><span class="line">Sigmoid_201                             BPU  id(0)     HzLut</span><br><span class="line">Split_202                               BPU  id(0)     Split</span><br><span class="line">Mul_204                                 CPU  --        Mul</span><br><span class="line">Add_206                                 CPU  --        Add</span><br><span class="line">Mul_208                                 CPU  --        Mul</span><br><span class="line">Mul_210                                 CPU  --        Mul</span><br><span class="line">Pow_211                                 BPU  id(1)     HzLut</span><br><span class="line">Mul_213                                 CPU  --        Mul</span><br><span class="line">Concat_214                              CPU  --        Concat</span><br><span class="line">Reshape_215                             CPU  --        Reshape</span><br><span class="line">Conv_216                                BPU  id(0)     HzSQuantizedConv</span><br><span class="line">Reshape_217                             BPU  id(0)     Reshape</span><br><span class="line">Transpose_218                           BPU  id(0)     Transpose</span><br><span class="line">Sigmoid_219                             BPU  id(0)     HzLut</span><br><span class="line">Split_220                               BPU  id(0)     Split</span><br><span class="line">Mul_222                                 CPU  --        Mul</span><br><span class="line">Add_224                                 CPU  --        Add</span><br><span class="line">Mul_226                                 CPU  --        Mul</span><br><span class="line">Mul_228                                 CPU  --        Mul</span><br><span class="line">Pow_229                                 BPU  id(2)     HzLut</span><br><span class="line">Mul_231                                 CPU  --        Mul</span><br><span class="line">Concat_232                              CPU  --        Concat</span><br><span class="line">Reshape_233                             CPU  --        Reshape</span><br><span class="line">Conv_234                                BPU  id(0)     HzSQuantizedConv</span><br><span class="line">Reshape_235                             BPU  id(0)     Reshape</span><br><span class="line">Transpose_236                           BPU  id(0)     Transpose</span><br><span class="line">Sigmoid_237                             BPU  id(0)     HzLut</span><br><span class="line">Split_238                               BPU  id(0)     Split</span><br><span class="line">Mul_240                                 CPU  --        Mul</span><br><span class="line">Add_242                                 CPU  --        Add</span><br><span class="line">Mul_244                                 CPU  --        Mul</span><br><span class="line">Mul_246                                 CPU  --        Mul</span><br><span class="line">Pow_247                                 BPU  id(3)     HzLut</span><br><span class="line">Mul_249                                 CPU  --        Mul</span><br><span class="line">Concat_250                              CPU  --        Concat</span><br><span class="line">Reshape_251                             CPU  --        Reshape</span><br><span class="line">Concat_252                              CPU  --        Concat</span><br></pre></td></tr></table></figure></div>

<p><em>æ ¹æ® hb_mapper checker ç»™å‡ºçš„æç¤ºï¼Œä¸€èˆ¬æ¥è¯´ç®—å­è¿è¡Œåœ¨BPUä¸Šä¼šæœ‰æ›´å¥½çš„æ€§èƒ½è¡¨ç°ã€‚ <strong>å½“ç„¶ï¼Œå¤šä¸ªå­å›¾ä¹Ÿä¸ä¼šå½±å“æ•´ä¸ªè½¬æ¢æµç¨‹ï¼Œä½†ä¼šè¾ƒå¤§ç¨‹åº¦åœ°å½±å“æ¨¡å‹æ€§èƒ½ï¼Œå»ºè®®å°½é‡è°ƒæ•´è‡³å…¨BPUæ‰§è¡Œã€‚</strong></em></p>
<blockquote>
<p><em>ä¸€ä¸ªæ¨¡å‹å¯ä»¥ç”±å¤šä¸ªå­å›¾ç»„æˆï¼Œæ¯ä¸ªå­å›¾ä»£è¡¨äº†ä¸€ç»„ç›¸å…³æ“ä½œçš„è®¡ç®—å›¾ã€‚è€Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå·¥å…·å°†æ ¹æ®è¿ç»­çš„CPUè®¡ç®—ç®—å­å°†åŸæœ¬åº”è¯¥åœ¨BPUï¼ˆè¾¹ç¼˜å¤„ç†å•å…ƒï¼‰è¿›è¡Œè®¡ç®—çš„éƒ¨åˆ†æ‹†åˆ†ä¸ºä¸¤ä¸ªå­å›¾ã€‚</em></p>
<p><em>è¿™æ ·åšçš„ç›®çš„å¯èƒ½æ˜¯ä¸ºäº†åœ¨æ¨¡å‹éƒ¨ç½²å’Œæ‰§è¡Œè¿‡ç¨‹ä¸­è¿›è¡Œä¼˜åŒ–ã€‚è¾¹ç¼˜å¤„ç†å•å…ƒï¼ˆBPUï¼‰é€šå¸¸æ˜¯ä¸“é—¨ç”¨äºæ‰§è¡Œæ·±åº¦å­¦ä¹ è®¡ç®—çš„ç¡¬ä»¶åŠ é€Ÿå™¨ï¼Œè€ŒCPUåˆ™æ˜¯é€šç”¨çš„å¤„ç†å•å…ƒã€‚é€šè¿‡å°†è¿ç»­çš„CPUè®¡ç®—éƒ¨åˆ†æ‹†åˆ†ä¸ºä¸¤ä¸ªå­å›¾ï¼Œå¯ä»¥å°†è¿™äº›éƒ¨åˆ†åˆ†åˆ«äº¤ç»™é€‚å½“çš„å¤„ç†å•å…ƒæ¥æ‰§è¡Œï¼Œä»¥è·å¾—æ›´å¥½çš„æ€§èƒ½å’Œæ•ˆç‡ã€‚</em></p>
</blockquote>
<blockquote>
<p><em>è¿™æ„å‘³ç€åœ¨ç†æƒ³æƒ…å†µä¸‹ï¼Œæ•´ä¸ªæ¨¡å‹åº”è¯¥åœ¨BPUä¸Šè¿›è¡Œè®¡ç®—ï¼Œä»¥å……åˆ†åˆ©ç”¨ç¡¬ä»¶åŠ é€Ÿå™¨çš„æ€§èƒ½ã€‚ç„¶è€Œï¼Œå¦‚æœæ¨¡å‹ä¸­å­˜åœ¨CPUç®—å­ï¼Œè¿™å¯èƒ½å¯¼è‡´æ— æ³•å°†æ•´ä¸ªè®¡ç®—è¿‡ç¨‹æ”¾åœ¨BPUä¸Šæ‰§è¡Œï¼Œè€Œéœ€è¦å°†éƒ¨åˆ†è®¡ç®—æ‹†åˆ†ä¸ºå¤šä¸ªå­å›¾ã€‚</em></p>
<p><em>hb_mapper checker å·¥å…·å¯ä»¥å¸®åŠ©åˆ†ææ¨¡å‹ä¸­CPUç®—å­å‡ºç°çš„åŸå› ã€‚å®ƒå¯ä»¥æä¾›æœ‰å…³CPUç®—å­é™åˆ¶å’Œçº¦æŸçš„ä¿¡æ¯ï¼Œä»¥å¸®åŠ©ç†è§£ä¸ºä»€ä¹ˆéœ€è¦å°†è®¡ç®—æ‹†åˆ†ä¸ºå¤šä¸ªå­å›¾ã€‚</em></p>
<p><em>ä¸¾ä¾‹æ¥è¯´ï¼Œå¦‚æœæ¨¡å‹ä¸­å­˜åœ¨ Mul + Add + Mul çš„ç»“æ„ï¼Œè€Œåœ¨ç®—å­çº¦æŸåˆ—è¡¨ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ° Mul å’Œ Add ç®—å­åœ¨äº”ç»´ä¸Šæ”¯æŒBPUè¿è¡Œæœ‰çº¦æŸæ¡ä»¶ï¼Œé‚£ä¹ˆè¿™å¯èƒ½æ˜¯å¯¼è‡´æ‹†åˆ†å­å›¾çš„åŸå› ã€‚è¿™æ„å‘³ç€åœ¨è¿™ä¸ªç‰¹å®šçš„æ¨¡å‹ç»“æ„ä¸­ï¼Œ<strong>Mul å’Œ Add ç®—å­åœ¨æŸäº›ç»´åº¦ä¸Šæ— æ³•åœ¨BPUä¸Šè¿è¡Œï¼Œä»è€Œå¯¼è‡´äº†å¤šä¸ªå­å›¾çš„å‡ºç°ã€‚</strong></em></p>
<p><em>é€šè¿‡åˆ†æ hb_mapper checker å·¥å…·æä¾›çš„ä¿¡æ¯ï¼Œå¯ä»¥äº†è§£CPUç®—å­å‡ºç°çš„å…·ä½“åŸå› ï¼Œå¹¶å°è¯•ä¼˜åŒ–æ¨¡å‹æˆ–è°ƒæ•´ç®—å­çš„ä½¿ç”¨æ–¹å¼ï¼Œä»¥è¾¾åˆ°åœ¨BPUä¸Šæœ€å¤§åŒ–è¿è¡Œæ¨¡å‹çš„ç›®æ ‡ã€‚</em></p>
</blockquote>
<blockquote>
<p><em>æ ¡å‡†æ•°æ®å‡†å¤‡</em></p>
</blockquote>
<p><em><strong>æ³¨æ„ï¼šå¦‚æœæœ¬è¿‡ç¨‹ï¼Œæ‚¨éœ€åœ¨ç¤ºä¾‹æ–‡ä»¶å¤¹å†…è¿›è¡Œï¼Œé‚£ä¹ˆæ‚¨éœ€è¦å…ˆæ‰§è¡Œæ–‡ä»¶å¤¹ä¸­çš„ <code>00_init.sh</code> è„šæœ¬ä»¥è·å–å¯¹åº”çš„åŸå§‹æ¨¡å‹å’Œæ•°æ®é›†ã€‚</strong></em></p>
<p><em>åœ¨è¿›è¡Œæ¨¡å‹è½¬æ¢æ—¶ï¼Œæ ¡å‡†é˜¶æ®µä¼šéœ€è¦20~100ä»½çš„æ ‡å®šæ ·æœ¬è¾“å…¥ï¼Œæ¯ä¸€ä»½æ ·æœ¬éƒ½æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„æ•°æ®æ–‡ä»¶ã€‚ ä¸ºäº†ç¡®ä¿è½¬æ¢åæ¨¡å‹çš„ç²¾åº¦æ•ˆæœï¼Œæˆ‘ä»¬å¸Œæœ›è¿™äº›æ ¡å‡†æ ·æœ¬æ¥è‡ªäºæ‚¨è®­ç»ƒæ¨¡å‹ä½¿ç”¨çš„è®­ç»ƒé›†æˆ–éªŒè¯é›†ï¼Œ ä¸è¦ä½¿ç”¨éå¸¸å°‘è§çš„å¼‚å¸¸æ ·æœ¬ï¼Œä¾‹å¦‚çº¯è‰²å›¾ç‰‡ã€ä¸å«ä»»ä½•æ£€æµ‹æˆ–åˆ†ç±»ç›®æ ‡çš„å›¾ç‰‡ç­‰ã€‚</em></p>
<p><em>è½¬æ¢é…ç½®æ–‡ä»¶ä¸­çš„ <code>preprocess_on</code> å‚æ•°ï¼Œè¯¥å‚æ•°å¯ç”¨å’Œå…³é—­çŠ¶æ€ä¸‹åˆ†åˆ«å¯¹åº”äº†ä¸¤ç§ä¸åŒçš„é¢„å¤„ç†æ ·æœ¬è¦æ±‚ã€‚ (æœ‰å…³å‚æ•°çš„è¯¦ç»†é…ç½®å¯å‚è€ƒåæ–‡æ ¡å‡†å‚æ•°ç»„ä¸­ç›¸å…³è¯´æ˜)</em></p>
<p><em><strong><code>preprocess_on</code> å…³é—­çŠ¶æ€ä¸‹ï¼Œæ‚¨éœ€è¦æŠŠå–è‡ªè®­ç»ƒé›†&#x2F;éªŒè¯é›†çš„æ ·æœ¬åšä¸inferenceå‰ä¸€æ ·çš„å‰å¤„ç†</strong>ï¼Œ å¤„ç†å®Œåçš„æ ¡å‡†æ ·æœ¬ä¼šä¸åŸå§‹æ¨¡å‹å…·å¤‡ä¸€æ ·çš„æ•°æ®ç±»å‹( <code>input_type_train</code> )ã€å°ºå¯¸( <code>input_shape</code> )å’Œ layout( <code>input_layout_train</code> )ï¼Œå¯¹äºfeaturemapè¾“å…¥çš„æ¨¡å‹ï¼Œæ‚¨å¯ä»¥é€šè¿‡ <code>numpy.tofile</code> å‘½ä»¤å°†æ•°æ®ä¿å­˜ä¸ºfloat32æ ¼å¼çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œ å·¥å…·é“¾æ ¡å‡†æ—¶ä¼šåŸºäº <code>numpy.fromfile</code> å‘½ä»¤è¿›è¡Œè¯»å–ã€‚ ä¾‹å¦‚ï¼Œæœ‰ä¸€ä¸ªä½¿ç”¨ImageNetè®­ç»ƒçš„ç”¨äºåˆ†ç±»çš„åŸå§‹æµ®ç‚¹æ¨¡å‹ï¼Œå®ƒåªæœ‰ä¸€ä¸ªè¾“å…¥èŠ‚ç‚¹ï¼Œè¾“å…¥ä¿¡æ¯æè¿°å¦‚ä¸‹ï¼š</em></p>
<ul>
<li><em>è¾“å…¥ç±»å‹ï¼š<code>BGR</code>ã€‚</em></li>
<li><em>è¾“å…¥layoutï¼š<code>NCHW</code>ã€‚</em></li>
<li><em>è¾“å…¥å°ºå¯¸ï¼š<code>1x3x224x224</code>ã€‚</em></li>
</ul>
<p><em>ä½¿ç”¨éªŒè¯é›†åšInferenceæ—¶çš„æ•°æ®é¢„å¤„ç†æ­¥éª¤å¦‚ä¸‹ï¼š</em></p>
<ol>
<li><em>å›¾åƒé•¿å®½ç­‰æ¯”scaleï¼ŒçŸ­è¾¹ç¼©æ”¾åˆ°256ã€‚</em></li>
<li><em><code>center_crop</code> æ–¹æ³•è·å–224x224å¤§å°å›¾åƒã€‚</em></li>
<li><em>æŒ‰é€šé“å‡meanã€‚</em></li>
<li><em>æ•°æ®ä¹˜ä»¥scaleç³»æ•°ã€‚</em></li>
</ol>
<blockquote>
<p><em>ç‰¹å¾å›¾æ˜¯æŒ‡åœ¨å·ç§¯ç¥ç»ç½‘ç»œï¼ˆCNNï¼‰ä¸­ç»è¿‡å·ç§¯å±‚æˆ–å…¶ä»–å±‚å¤„ç†åå¾—åˆ°çš„è¾“å‡ºã€‚å®ƒæ˜¯ä¸€ä¸ªä¸‰ç»´çš„å¼ é‡ï¼Œå…·æœ‰é«˜åº¦ã€å®½åº¦å’Œé€šé“æ•°ä¸‰ä¸ªç»´åº¦ã€‚æ¯ä¸ªé€šé“ä»£è¡¨äº†ä¸€ç§ç‰¹å®šçš„ç‰¹å¾åœ¨å›¾åƒä¸­çš„è¡¨ç¤ºã€‚</em></p>
<p><em>è¿™ç§è®¾è®¡æ–¹å¼çš„ä¼˜ç‚¹æ˜¯å¯ä»¥åˆ©ç”¨å…ˆå‰å±‚æ¬¡çš„ç‰¹å¾æå–å’Œå¤„ç†ç»“æœï¼Œä½¿å¾—æ¨¡å‹èƒ½å¤Ÿæ›´åŠ é«˜æ•ˆåœ°å­¦ä¹ å’Œè¡¨ç¤ºå›¾åƒä¸­çš„ç‰¹å¾ã€‚é€šè¿‡ä½¿ç”¨ç‰¹å¾å›¾ä½œä¸ºè¾“å…¥ï¼Œæ¨¡å‹å¯ä»¥æ›´å¥½åœ°æ•æ‰åˆ°å›¾åƒçš„å±€éƒ¨ä¿¡æ¯å’ŒæŠ½è±¡ç‰¹å¾ï¼Œä»è€Œæé«˜æ¨¡å‹çš„æ€§èƒ½å’Œæ³›åŒ–èƒ½åŠ›ã€‚</em></p>
</blockquote>
<p><em>ä¾ç…§ <code>preprocess_on</code> å…³é—­çŠ¶æ€ä¸‹çš„æ ·æœ¬æ–‡ä»¶åˆ¶ä½œåŸåˆ™ï¼Œé’ˆå¯¹ä¸Šè¿°ä¸¾ä¾‹æ¨¡å‹çš„æ ·æœ¬å¤„ç†ä»£ç å¦‚ä¸‹ (ä¸ºé¿å…è¿‡é•¿ä»£ç ç¯‡å¹…ï¼Œå„ç§ç®€å•transformerå®ç°ä»£ç æœªè´´å‡ºï¼Œtransformerä½¿ç”¨æ–¹æ³•å¯å‚è€ƒ <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/ptq/ptq_appendix/transformer.html" >å›¾ç‰‡å¤„ç†transformerè¯´æ˜ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ã€‚</em></p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æœ¬ç¤ºä¾‹ä½¿ç”¨skimageï¼Œå¦‚æœæ˜¯opencvä¼šæœ‰æ‰€åŒºåˆ«</span></span><br><span class="line"><span class="comment"># éœ€è¦æ‚¨ç‰¹åˆ«æ³¨æ„çš„æ˜¯ï¼Œtransformersä¸­å¹¶æ²¡æœ‰ä½“ç°å‡meanå’Œä¹˜scaleçš„å¤„ç†</span></span><br><span class="line"><span class="comment"># meanå’Œscaleæ“ä½œå·²ç»èåˆåˆ°äº†æ¨¡å‹ä¸­ï¼Œå‚è€ƒå‰æ–‡norm_type/mean_values/scale_valuesé…ç½®</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">data_transformer</span>():</span><br><span class="line">  transformers = [</span><br><span class="line">  <span class="comment"># é•¿å®½ç­‰æ¯”scaleï¼ŒçŸ­è¾¹ç¼©æ”¾è‡³256</span></span><br><span class="line">  ShortSideResizeTransformer(short_size=<span class="number">256</span>),</span><br><span class="line">  <span class="comment"># CenterCropè·å–224x224å›¾åƒ</span></span><br><span class="line">  CenterCropTransformer(crop_size=<span class="number">224</span>),</span><br><span class="line">  <span class="comment"># skimageè¯»å–ç»“æœä¸ºNHWCæ’å¸ƒï¼Œè½¬æ¢ä¸ºæ¨¡å‹éœ€è¦çš„NCHW</span></span><br><span class="line">  HWC2CHWTransformer(),</span><br><span class="line">  <span class="comment"># skimageè¯»å–ç»“æœé€šé“é¡ºåºä¸ºRGBï¼Œè½¬æ¢ä¸ºæ¨¡å‹éœ€è¦çš„BGR</span></span><br><span class="line">  RGB2BGRTransformer(),</span><br><span class="line">  <span class="comment"># skimageè¯»å–æ•°å€¼èŒƒå›´ä¸º[0.0,1.0]ï¼Œè°ƒæ•´ä¸ºæ¨¡å‹éœ€è¦çš„æ•°å€¼èŒƒå›´</span></span><br><span class="line">  ScaleTransformer(scale_value=<span class="number">255</span>)</span><br><span class="line">  ]</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> transformers</span><br><span class="line"></span><br><span class="line"><span class="comment"># src_image æ ‡å®šé›†ä¸­çš„åŸå›¾ç‰‡</span></span><br><span class="line"><span class="comment"># dst_file å­˜æ”¾æœ€ç»ˆæ ‡å®šæ ·æœ¬æ•°æ®çš„æ–‡ä»¶åç§°</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">convert_image</span>(<span class="params">src_image, dst_file, transformers</span>):</span><br><span class="line">  image = skimage.img_as_float(skimage.io.imread(src_file))</span><br><span class="line">  <span class="keyword">for</span> trans <span class="keyword">in</span> transformers:</span><br><span class="line">      image = trans(image)</span><br><span class="line">  <span class="comment"># æ¨¡å‹æŒ‡å®šçš„input_type_train BGRæ•°å€¼ç±»å‹æ˜¯UINT8</span></span><br><span class="line">  image = image.astype(np.uint8)</span><br><span class="line">  <span class="comment"># äºŒè¿›åˆ¶å­˜å‚¨æ ‡å®šæ ·æœ¬åˆ°æ•°æ®æ–‡ä»¶</span></span><br><span class="line">  image.tofile(dst_file)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">  <span class="comment"># æ­¤å¤„è¡¨ç¤ºåŸå§‹æ ‡å®šå›¾ç‰‡é›†åˆï¼Œä¼ªä»£ç </span></span><br><span class="line">  src_images = [<span class="string">&#x27;ILSVRC2012_val_00000001.JPEG&#x27;</span>, ...]</span><br><span class="line">  <span class="comment"># æ­¤å¤„è¡¨ç¤ºæœ€ç»ˆæ ‡å®šæ–‡ä»¶åç§°ï¼ˆåç¼€åä¸é™åˆ¶ï¼‰ï¼Œä¼ªä»£ç </span></span><br><span class="line">  <span class="comment"># calibration_data_bgr_f32æ˜¯æ‚¨åœ¨é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šçš„cal_data_dir</span></span><br><span class="line">  dst_files = [<span class="string">&#x27;./calibration_data_bgr_f32/ILSVRC2012_val_00000001.bgr&#x27;</span>, ...]</span><br><span class="line"></span><br><span class="line">  transformers = data_transformer()</span><br><span class="line">  <span class="keyword">for</span> src_image, dst_file <span class="keyword">in</span> <span class="built_in">zip</span>(src_images, dst_files):</span><br><span class="line">      convert_image(src_image, dst_file, transformers)</span><br></pre></td></tr></table></figure></div>

<p><em><strong>æ³¨æ„ï¼š</strong></em></p>
<ul>
<li><p><em><strong><code>preprocess_on</code> å¯ç”¨çŠ¶æ€ä¸‹ï¼Œæ ‡å®šæ ·æœ¬ä½¿ç”¨skimageæ”¯æŒè¯»å–å›¾ç‰‡æ ¼å¼çš„æ–‡ä»¶å³å¯ã€‚ è½¬æ¢å·¥å…·è¯»å–è¿™äº›å›¾ç‰‡åï¼Œä¼šå°†å…¶ç¼©æ”¾åˆ°æ¨¡å‹è¾“å…¥èŠ‚ç‚¹è¦æ±‚çš„å°ºå¯¸å¤§å°ï¼Œä»¥æ­¤ç»“æœä½œä¸ºæ ¡å‡†çš„è¾“å…¥ã€‚ è¿™æ ·çš„æ“ä½œä¼šç®€å•ï¼Œä½†æ˜¯å¯¹äºé‡åŒ–çš„ç²¾åº¦æ²¡æœ‰ä¿éšœï¼Œå› æ­¤æˆ‘ä»¬å¼ºçƒˆå»ºè®®æ‚¨ä½¿ç”¨å…³é—­ <code>preprocess_on</code> çš„æ–¹å¼ã€‚</strong></em></p>
</li>
<li><p><em>è¯·æ³¨æ„ï¼Œyamlæ–‡ä»¶ä¸­input_shapeå‚æ•°ä½œç”¨ä¸ºæŒ‡å®šåŸå§‹æµ®ç‚¹æ¨¡å‹çš„è¾“å…¥æ•°æ®å°ºå¯¸ã€‚è‹¥ä¸ºåŠ¨æ€è¾“å…¥æ¨¡å‹åˆ™å¯é€šè¿‡è¿™ä¸ªå‚æ•°è®¾ç½®è½¬æ¢åçš„è¾“å…¥å¤§å°ï¼Œè€Œæ ¡å‡†æ•°æ®çš„shapeå¤§å°åº”ä¸input_shapeä¿æŒä¸€è‡´ã€‚</em></p>
<p><em>ä¾‹å¦‚ï¼šè‹¥åŸå§‹æµ®ç‚¹æ¨¡å‹è¾“å…¥èŠ‚ç‚¹shapeä¸º?x3x224x224ï¼ˆâ€œ?â€å·ä»£è¡¨å ä½ç¬¦ï¼Œå³è¯¥æ¨¡å‹ç¬¬ä¸€ç»´ä¸ºåŠ¨æ€è¾“å…¥ï¼‰, è½¬æ¢é…ç½®æ–‡ä»¶ä¸­è®¾ç½®input_shape: 8x3x224x224ï¼Œåˆ™ç”¨æˆ·éœ€è¦å‡†å¤‡çš„æ¯ä»½æ ¡å‡†æ•°æ®å¤§å°ä¸º 8x3x224x224ã€‚ ï¼ˆ<strong>è¯·çŸ¥æ‚‰ï¼Œæ­¤ç±»è¾“å…¥shapeç¬¬ä¸€ç»´ä¸ç­‰äº1çš„æ¨¡å‹ï¼Œä¸æ”¯æŒé€šè¿‡input_batchå‚æ•°ä¿®æ”¹æ¨¡å‹batchä¿¡æ¯</strong>ã€‚ï¼‰</em></p>
</li>
</ul>
<blockquote>
<p><em>æ¨¡å‹é‡åŒ–ä¸ç¼–è¯‘</em></p>
</blockquote>
<p><em>è½¬æ¢æ¨¡å‹é˜¶æ®µä¼šå®Œæˆæµ®ç‚¹æ¨¡å‹åˆ°åœ°å¹³çº¿æ··åˆå¼‚æ„æ¨¡å‹çš„è½¬æ¢ï¼Œç»è¿‡è¿™ä¸ªé˜¶æ®µï¼Œæ‚¨å°†å¾—åˆ°ä¸€ä¸ªå¯ä»¥åœ¨åœ°å¹³çº¿èŠ¯ç‰‡ä¸Šè¿è¡Œçš„æ¨¡å‹ã€‚ åœ¨è¿›è¡Œè½¬æ¢ä¹‹å‰ï¼Œè¯·ç¡®ä¿å·²ç»é¡ºåˆ©é€šè¿‡äº† <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/ptq/ptq_usage/check_model.html" >éªŒè¯æ¨¡å‹ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> å°èŠ‚çš„è¿‡ç¨‹ã€‚</em></p>
<p><em>æ¨¡å‹è½¬æ¢ä½¿ç”¨ <code>hb_mapper makertbin</code> å·¥å…·å®Œæˆï¼Œè½¬æ¢æœŸé—´ä¼šå®Œæˆæ¨¡å‹ä¼˜åŒ–å’Œæ ¡å‡†é‡åŒ–ç­‰é‡è¦è¿‡ç¨‹ï¼Œæ ¡å‡†éœ€è¦ä¾ç…§æ¨¡å‹é¢„å¤„ç†è¦æ±‚å‡†å¤‡æ ¡å‡†æ•°æ®ï¼Œ æ‚¨å¯ä»¥å‚è€ƒ <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/ptq/ptq_usage/prepare_calibration_data.html" >æ ¡å‡†æ•°æ®å‡†å¤‡ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ç« èŠ‚å†…å®¹å¯¹æ ¡å‡†æ•°æ®è¿›è¡Œé¢„å…ˆå‡†å¤‡ã€‚ ä¸ºäº†æ–¹ä¾¿æ‚¨å…¨é¢äº†è§£æ¨¡å‹è½¬æ¢ï¼Œæœ¬èŠ‚å°†ä¾æ¬¡ä»‹ç»è½¬æ¢å·¥å…·ä½¿ç”¨ã€è½¬æ¢å†…éƒ¨è¿‡ç¨‹è§£è¯»ã€è½¬æ¢ç»“æœè§£è¯»å’Œè½¬æ¢äº§å‡ºç‰©è§£è¯»ã€‚</em></p>
<p><em><strong>ä½¿ç”¨ <code>hb_mapper makertbin</code> å·¥å…·è½¬æ¢æ¨¡å‹</strong></em></p>
<p><em>hb_mapper makertbinå‘½ä»¤ä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hb_mapper makertbin --config $&#123;config_file&#125;  \</span><br><span class="line">                    --model-type  $&#123;model_type&#125;</span><br></pre></td></tr></table></figure></div>

<p><em>hb_mapper makertbinå‚æ•°è§£é‡Šï¼š</em></p>
<ul>
<li><p><em>â€“model-type</em></p>
<p><em>ç”¨äºæŒ‡å®šè½¬æ¢è¾“å…¥çš„æ¨¡å‹ç±»å‹ï¼Œç›®å‰æ”¯æŒè®¾ç½® <code>caffe</code> æˆ–è€… <code>onnx</code>ã€‚</em></p>
</li>
<li><p><em>â€“config</em></p>
<p><em>æ¨¡å‹ç¼–è¯‘çš„é…ç½®æ–‡ä»¶ï¼Œå†…å®¹é‡‡ç”¨yamlæ ¼å¼ï¼Œæ–‡ä»¶åä½¿ç”¨.yamlåç¼€ã€‚ä¸€ä»½å®Œæ•´çš„é…ç½®æ–‡ä»¶æ¨¡æ¿å¦‚ä¸‹ï¼š</em></p>
</li>
</ul>
<p><em><strong>æ³¨æ„ï¼š</strong>æ­¤å¤„é…ç½®æ–‡ä»¶ä»…ä½œå±•ç¤ºï¼Œåœ¨å®é™…æ¨¡å‹é…ç½®æ–‡ä»¶ä¸­ <code>caffe_model</code> ä¸ <code>onnx_model</code> ä¸¤ç§åªå­˜åœ¨å…¶ä¸­ä¹‹ä¸€ã€‚</em></p>
<p><em>å³ï¼Œè¦ä¹ˆæ˜¯Caffeæ¨¡å‹ï¼Œè¦ä¹ˆæ˜¯ONNXæ¨¡å‹ã€‚å³ <code>caffe_model</code> + <code>prototxt</code> æˆ–è€… <code>onnx_model</code> äºŒé€‰ä¸€ã€‚</em></p>
<ul>
<li><pre><code class="python"># æ¨¡å‹å‚æ•°ç»„
model_parameters:
  # åŸå§‹Caffeæµ®ç‚¹æ¨¡å‹æè¿°æ–‡ä»¶
  prototxt: &#39;***.prototxt&#39;

  # åŸå§‹Caffeæµ®ç‚¹æ¨¡å‹æ•°æ®æ¨¡å‹æ–‡ä»¶
  caffe_model: &#39;****.caffemodel&#39;

  # åŸå§‹Onnxæµ®ç‚¹æ¨¡å‹æ–‡ä»¶
  onnx_model: &#39;****.onnx&#39;

  # è½¬æ¢çš„ç›®æ ‡èŠ¯ç‰‡æ¶æ„
  march: &#39;bayes&#39;

  # æ¨¡å‹è½¬æ¢è¾“å‡ºçš„ç”¨äºä¸Šæ¿æ‰§è¡Œçš„æ¨¡å‹æ–‡ä»¶çš„åç§°å‰ç¼€
  output_model_file_prefix: &#39;mobilenetv1&#39;

  # æ¨¡å‹è½¬æ¢è¾“å‡ºçš„ç»“æœçš„å­˜æ”¾ç›®å½•
  working_dir: &#39;./model_output_dir&#39;

  # æŒ‡å®šè½¬æ¢åæ··åˆå¼‚æ„æ¨¡å‹æ˜¯å¦ä¿ç•™è¾“å‡ºå„å±‚çš„ä¸­é—´ç»“æœçš„èƒ½åŠ›
  layer_out_dump: False

  # æŒ‡å®šæ¨¡å‹çš„è¾“å‡ºèŠ‚ç‚¹
  output_nodes: &#123;OP_name&#125;

  # æ‰¹é‡åˆ é™¤æŸä¸€ç±»å‹çš„èŠ‚ç‚¹
  remove_node_type: Dequantize

  # åˆ é™¤æŒ‡å®šåç§°çš„èŠ‚ç‚¹
  remove_node_name: &#123;OP_name&#125;

# è¾“å…¥ä¿¡æ¯å‚æ•°ç»„
input_parameters:
  # åŸå§‹æµ®ç‚¹æ¨¡å‹çš„è¾“å…¥èŠ‚ç‚¹åç§°
  input_name: &quot;data&quot;

  # åŸå§‹æµ®ç‚¹æ¨¡å‹çš„è¾“å…¥æ•°æ®æ ¼å¼ï¼ˆæ•°é‡/é¡ºåºä¸input_nameä¸€è‡´ï¼‰
  input_type_train: &#39;bgr&#39;

  # åŸå§‹æµ®ç‚¹æ¨¡å‹çš„è¾“å…¥æ•°æ®æ’å¸ƒï¼ˆæ•°é‡/é¡ºåºä¸input_nameä¸€è‡´ï¼‰
  input_layout_train: &#39;NCHW&#39;

  # åŸå§‹æµ®ç‚¹æ¨¡å‹çš„è¾“å…¥æ•°æ®å°ºå¯¸
  input_shape: &#39;1x3x224x224&#39;

  # ç½‘ç»œå®é™…æ‰§è¡Œæ—¶ï¼Œè¾“å…¥ç»™ç½‘ç»œçš„batch_size, é»˜è®¤å€¼ä¸º1
  input_batch: 1

  # åœ¨æ¨¡å‹ä¸­æ·»åŠ çš„è¾“å…¥æ•°æ®é¢„å¤„ç†æ–¹æ³•
  norm_type: &#39;data_mean_and_scale&#39;

  # é¢„å¤„ç†æ–¹æ³•çš„å›¾åƒå‡å»çš„å‡å€¼, å¦‚æœæ˜¯é€šé“å‡å€¼ï¼Œvalueä¹‹é—´å¿…é¡»ç”¨ç©ºæ ¼åˆ†éš”
  mean_value: &#39;103.94 116.78 123.68&#39;

  # é¢„å¤„ç†æ–¹æ³•çš„å›¾åƒç¼©æ”¾æ¯”ä¾‹ï¼Œå¦‚æœæ˜¯é€šé“ç¼©æ”¾æ¯”ä¾‹ï¼Œvalueä¹‹é—´å¿…é¡»ç”¨ç©ºæ ¼åˆ†éš”
  scale_value: &#39;0.017&#39;

  # è½¬æ¢åæ··åˆå¼‚æ„æ¨¡å‹éœ€è¦é€‚é…çš„è¾“å…¥æ•°æ®æ ¼å¼ï¼ˆæ•°é‡/é¡ºåºä¸input_nameä¸€è‡´ï¼‰
  input_type_rt: &#39;yuv444&#39;

  # è¾“å…¥æ•°æ®æ ¼å¼çš„ç‰¹æ®Šåˆ¶å¼
  input_space_and_range: &#39;regular&#39;

  # è½¬æ¢åæ··åˆå¼‚æ„æ¨¡å‹éœ€è¦é€‚é…çš„è¾“å…¥æ•°æ®æ’å¸ƒï¼ˆæ•°é‡/é¡ºåºä¸input_nameä¸€è‡´ï¼‰ï¼Œè‹¥input_type_rté…ç½®ä¸ºnv12ï¼Œåˆ™æ­¤å¤„å‚æ•°ä¸éœ€è¦é…ç½®
  input_layout_rt: &#39;NHWC&#39;

# æ ¡å‡†å‚æ•°ç»„
calibration_parameters:
  # æ¨¡å‹æ ¡å‡†ä½¿ç”¨çš„æ ‡å®šæ ·æœ¬çš„å­˜æ”¾ç›®å½•
  cal_data_dir: &#39;./calibration_data&#39;

  # æŒ‡å®šæ ¡å‡†æ•°æ®äºŒè¿›åˆ¶æ–‡ä»¶çš„æ•°æ®å­˜å‚¨ç±»å‹ã€‚
  cal_data_type: &#39;float32&#39;

  # å¼€å¯å›¾ç‰‡æ ¡å‡†æ ·æœ¬è‡ªåŠ¨å¤„ç†ï¼ˆskimage read; resizeåˆ°è¾“å…¥èŠ‚ç‚¹å°ºå¯¸ï¼‰
  #preprocess_on: False

  # æ ¡å‡†ä½¿ç”¨çš„ç®—æ³•ç±»å‹
  calibration_type: &#39;kl&#39;

  # max æ ¡å‡†æ–¹å¼çš„å‚æ•°
  max_percentile: 1.0

  # å¼ºåˆ¶æŒ‡å®šOPåœ¨CPUä¸Šè¿è¡Œ
  run_on_cpu:  &#123;OP_name&#125;

  # å¼ºåˆ¶æŒ‡å®šOPåœ¨BPUä¸Šè¿è¡Œ
  run_on_bpu:  &#123;OP_name&#125;

  # æŒ‡å®šæ˜¯å¦é’ˆå¯¹æ¯ä¸ªchannelè¿›è¡Œæ ¡å‡†
  per_channel: False

  # æŒ‡å®šè¾“å‡ºèŠ‚ç‚¹çš„æ•°æ®ç²¾åº¦
  optimization: set_model_output_int16

# ç¼–è¯‘å‚æ•°ç»„
compiler_parameters:
  # ç¼–è¯‘ç­–ç•¥é€‰æ‹©
  compile_mode: &#39;latency&#39;

  # æ˜¯å¦æ‰“å¼€ç¼–è¯‘çš„debugä¿¡æ¯
  debug: False

  # æ¨¡å‹è¿è¡Œæ ¸å¿ƒæ•°
  core_num: 1

  # æ¨¡å‹ç¼–è¯‘çš„ä¼˜åŒ–ç­‰çº§é€‰æ‹©
  optimize_level: &#39;O2&#39;

  # æŒ‡å®šåç§°ä¸ºdataçš„è¾“å…¥æ•°æ®æ¥æº
  input_source: &#123;&quot;data&quot;: &quot;pyramid&quot;&#125;

  # æŒ‡å®šæ¨¡å‹çš„æ¯ä¸ªfunction callçš„æœ€å¤§å¯è¿ç»­æ‰§è¡Œæ—¶é—´
  max_time_per_fc: 1000

  # æŒ‡å®šç¼–è¯‘æ¨¡å‹æ—¶çš„è¿›ç¨‹æ•°
  jobs: 8

custom_op:
  # è‡ªå®šä¹‰opçš„æ ¡å‡†æ–¹å¼
  custom_op_method: register

  # è‡ªå®šä¹‰OPçš„å®ç°æ–‡ä»¶, è¯¥æ–‡ä»¶å¯ç”±æ¨¡æ¿ç”Ÿæˆ, è¯¦æƒ…è§è‡ªå®šä¹‰OPç›¸å…³æ–‡æ¡£
  op_register_files: sample_custom.py

  # è‡ªå®šä¹‰OPå®ç°æ–‡ä»¶æ‰€åœ¨çš„æ–‡ä»¶å¤¹, è¯·ä½¿ç”¨ç›¸å¯¹è·¯å¾„
  custom_op_dir: ./custom_op
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">*é…ç½®æ–‡ä»¶ä¸»è¦åŒ…å«æ¨¡å‹å‚æ•°ç»„ã€è¾“å…¥ä¿¡æ¯å‚æ•°ç»„ã€æ ¡å‡†å‚æ•°ç»„å’Œç¼–è¯‘å‚æ•°ç»„ã€‚ åœ¨æ‚¨çš„é…ç½®æ–‡ä»¶ä¸­ï¼Œå››ä¸ªå‚æ•°ç»„ä½ç½®éƒ½éœ€è¦å­˜åœ¨ï¼Œå…·ä½“å‚æ•°åˆ†ä¸ºå¯é€‰å’Œå¿…é€‰ï¼Œå¯é€‰å‚æ•°å¯ä»¥ä¸é…ç½®ã€‚*</span><br><span class="line"></span><br><span class="line">***param_valueé…ç½®***</span><br><span class="line"></span><br><span class="line">*å…·ä½“å‚æ•°çš„è®¾ç½®å½¢å¼ä¸ºï¼š`param_name: &#x27;param_value&#x27;` ï¼Œå‚æ•°å­˜åœ¨å¤šä¸ªå€¼æ—¶ä½¿ç”¨ `&#x27;;&#x27;` ç¬¦å·åˆ†éš”ï¼š `param_name: &#x27;param_value1; param_value2; param_value3&#x27;` ã€‚*</span><br><span class="line"></span><br><span class="line">***æ³¨æ„ï¼š***</span><br><span class="line"></span><br><span class="line">- *å½“æ¨¡å‹ä¸ºå¤šè¾“å…¥æ¨¡å‹æ—¶ï¼Œå¼ºçƒˆå»ºè®®æ‚¨å°† `input_shape` ç­‰å‚æ•°ä»¬æ˜¾å¼çš„å†™å‡ºï¼Œä»¥å…é€ æˆå‚æ•°å¯¹åº”é¡ºåºä¸Šçš„é”™è¯¯ã€‚*</span><br><span class="line">- *å¦‚æœè®¾ç½® `input_type_rt` ä¸º `nv12` æˆ– `yuv444` ï¼Œåˆ™æ¨¡å‹çš„è¾“å…¥å°ºå¯¸ä¸­ä¸èƒ½å‡ºç°å¥‡æ•°ã€‚*</span><br><span class="line"></span><br><span class="line">&gt; *å½“æ¨¡å‹çš„è¾“å…¥ä¸º nv12 æˆ– yuv444 æ ¼å¼æ—¶ï¼Œé€šå¸¸è¦æ±‚è¾“å…¥å°ºå¯¸ä¸­çš„å®½åº¦å’Œé«˜åº¦éƒ½æ˜¯å¶æ•°ï¼Œè€Œä¸å…è®¸å‡ºç°å¥‡æ•°ã€‚*</span><br><span class="line">&gt;</span><br><span class="line">&gt; *è¿™è¦æ±‚çš„åŸå› ä¸»è¦ä¸è§†é¢‘ç¼–ç å’Œå›¾åƒå¤„ç†ç›¸å…³ã€‚åœ¨ nv12 æˆ– yuv444 æ ¼å¼ä¸­ï¼Œå›¾åƒçš„äº®åº¦å’Œè‰²åº¦ä¿¡æ¯è¢«åˆ†ç¦»å­˜å‚¨ã€‚nv12 æ˜¯ä¸€ç§å¹¿æ³›ç”¨äºè§†é¢‘ç¼–ç å’Œå›¾åƒå¤„ç†çš„æ ¼å¼ï¼Œå…¶ä¸­äº®åº¦ä¿¡æ¯ï¼ˆYï¼‰ä¸è‰²åº¦ä¿¡æ¯ï¼ˆUVï¼‰äº¤é”™å­˜å‚¨ã€‚yuv444 åˆ™æ˜¯ä¸€ç§ä¸äº¤é”™å­˜å‚¨çš„æ ¼å¼ï¼Œå®ƒå°†äº®åº¦å’Œè‰²åº¦ä¿¡æ¯åˆ†åˆ«å­˜å‚¨ã€‚*</span><br><span class="line">&gt;</span><br><span class="line">&gt; *åœ¨è¿™äº›æ ¼å¼ä¸­ï¼Œ**äº®åº¦å’Œè‰²åº¦ä¿¡æ¯çš„é‡‡æ ·æ˜¯ä»¥4:2:0æˆ–4:4:4çš„æ¯”ä¾‹è¿›è¡Œçš„ï¼Œå…¶ä¸­ &quot;4&quot; è¡¨ç¤ºæ¯ 4 ä¸ªäº®åº¦åƒç´ å¯¹åº”ä¸€ä¸ªè‰²åº¦åƒç´ **ã€‚ç”±äºé‡‡æ ·æ¯”ä¾‹çš„é™åˆ¶ï¼Œè¦ä¿è¯æ­£ç¡®çš„é‡‡æ ·å’Œå¤„ç†ï¼Œè¾“å…¥å›¾åƒçš„å®½åº¦å’Œé«˜åº¦é€šå¸¸éœ€è¦æ˜¯å¶æ•°ã€‚*</span><br><span class="line">&gt;</span><br><span class="line">&gt; *å¦‚æœè¾“å…¥å›¾åƒçš„å®½åº¦æˆ–é«˜åº¦æ˜¯å¥‡æ•°ï¼Œé‚£ä¹ˆåœ¨è¿›è¡Œè‰²åº¦ä¿¡æ¯çš„é‡‡æ ·å’Œå¤„ç†æ—¶ä¼šå‡ºç°å¯¹é½é—®é¢˜ï¼Œå¯èƒ½å¯¼è‡´å›¾åƒè´¨é‡ä¸‹é™æˆ–å¤„ç†é”™è¯¯ã€‚ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œé€šå¸¸è¦æ±‚è¾“å…¥å›¾åƒçš„å®½åº¦å’Œé«˜åº¦éƒ½æ˜¯å¶æ•°ï¼Œä»¥ç¡®ä¿æ­£ç¡®çš„é‡‡æ ·å’Œå¤„ç†ã€‚*</span><br><span class="line"></span><br><span class="line">***int16é…ç½®è¯´æ˜***</span><br><span class="line"></span><br><span class="line">*åœ¨æ¨¡å‹è½¬æ¢çš„è¿‡ç¨‹ä¸­ï¼Œæ¨¡å‹ä¸­çš„å¤§éƒ¨åˆ†ç®—å­éƒ½ä¼šè¢«é‡åŒ–åˆ°int8è¿›è¡Œè®¡ç®—ï¼Œè€Œé€šè¿‡é…ç½® `set_node_data_type` å‚æ•°ï¼Œ å¯ä»¥è¯¦ç»†æŒ‡å®šæŸä¸ªopï¼ˆå½“å‰ç‰ˆæœ¬åªæ”¯æŒconvï¼Œåç»­åœ°å¹³çº¿ä¼šé‡Šæ”¾æ›´å¤šopï¼‰çš„è¾“å‡ºä¸ºint16è®¡ç®—ï¼ŒåŸºæœ¬åŸç†å¦‚ä¸‹ï¼š*</span><br><span class="line"></span><br><span class="line">***åœ¨ç”¨æˆ·é…ç½®äº†æŸä¸ªopè¾“å‡ºä¸ºint16åï¼Œæ¨¡å‹è½¬æ¢å†…éƒ¨ä¼šè‡ªåŠ¨è¿›è¡Œopè¾“å…¥è¾“å‡ºä¸Šä¸‹æ–‡ï¼ˆcontextï¼‰int16é…ç½®çš„æ›´æ–°å’Œæ£€æŸ¥**ã€‚ ä¾‹å¦‚ï¼Œå½“é…ç½®conv_1ä¸ºint16è®¡ç®—è¾“å‡ºæ—¶ï¼Œå®é™…ä¸Šæ½œåœ¨åŒæ—¶æŒ‡å®šäº†conv_1çš„ä¸‹ä¸€ä¸ªopéœ€è¦æ”¯æŒä»¥int16è¾“å…¥è®¡ç®—ã€‚ å¯¹äºä¸æ”¯æŒçš„åœºæ™¯ï¼Œæ¨¡å‹è½¬æ¢å·¥å…·ä¼šæ‰“å°logæç¤ºè¯¥int16é…ç½®ç»„åˆæš‚æ—¶ä¸è¢«æ”¯æŒå¹¶å›é€€åˆ°int8è®¡ç®—ã€‚*</span><br><span class="line"></span><br><span class="line">*ä»¥ä¸‹æ˜¯å…·ä½“å‚æ•°ä¿¡æ¯ï¼Œå‚æ•°ä¼šæ¯”è¾ƒå¤šï¼Œæˆ‘ä»¬ä¾ç…§ä¸Šè¿°çš„å‚æ•°ç»„æ¬¡åºä»‹ç»ã€‚*</span><br><span class="line"></span><br><span class="line">*ğŸ› ï¸ **æ¨¡å‹å‚æ•°ç»„***</span><br><span class="line"></span><br><span class="line">| *ç¼– å·* | *å‚æ•°åç§°*                   | *å‚æ•°é…ç½®è¯´æ˜*                                               | *å¯é€‰/å¿…é€‰* |</span><br><span class="line">| :------ | :--------------------------- | :----------------------------------------------------------- | :---------- |</span><br><span class="line">| *1*     | *`prototxt`*                 | ***å‚æ•°ä½œç”¨**ï¼šæŒ‡å®šCaffeæµ®ç‚¹æ¨¡å‹çš„prototxtæ–‡ä»¶åç§°ã€‚**å–å€¼èŒƒå›´**ï¼šæ— ã€‚**é»˜è®¤é…ç½®**ï¼šæ— ã€‚**å‚æ•°è¯´æ˜**ï¼šåœ¨ `hb_mapper makertbin` çš„ `model-type` ä¸º `caffe` æ—¶å¿…é¡»é…ç½®ã€‚* | *å¯é€‰*      |</span><br><span class="line">| *2*     | *`caffe_model`*              | ***å‚æ•°ä½œç”¨**ï¼šæŒ‡å®šCaffeæµ®ç‚¹æ¨¡å‹çš„caffemodelæ–‡ä»¶åç§°ã€‚**å–å€¼èŒƒå›´**ï¼šæ— ã€‚**é»˜è®¤é…ç½®**ï¼šæ— ã€‚**å‚æ•°è¯´æ˜**ï¼šåœ¨ `hb_mapper makertbin` çš„ `model-type` ä¸º `caffe` æ—¶å¿…é¡»é…ç½®ã€‚* | *å¯é€‰*      |</span><br><span class="line">| *3*     | *`onnx_model`*               | ***å‚æ•°ä½œç”¨**ï¼šæŒ‡å®šONNXæµ®ç‚¹æ¨¡å‹çš„onnxæ–‡ä»¶åç§°ã€‚**å–å€¼èŒƒå›´**ï¼šæ— ã€‚**é»˜è®¤é…ç½®**ï¼šæ— ã€‚**å‚æ•°è¯´æ˜**ï¼šåœ¨ `hb_mapper makertbin` çš„ `model-type` ä¸º `onnx` æ—¶å¿…é¡»é…ç½®ã€‚* | *å¯é€‰*      |</span><br><span class="line">| *4*     | *`march`*                    | ***å‚æ•°ä½œç”¨**ï¼šæŒ‡å®šäº§å‡ºæ··åˆå¼‚æ„æ¨¡å‹éœ€è¦æ”¯æŒçš„å¹³å°æ¶æ„ã€‚**å–å€¼èŒƒå›´**ï¼š `bayes` æˆ– `bernoulli2` ã€‚**é»˜è®¤é…ç½®**ï¼š æ— ã€‚**å‚æ•°è¯´æ˜**ï¼š ä¸¤ä¸ªå¯é€‰é…ç½®å€¼ä¾æ¬¡å¯¹åº”J5å’ŒX3&amp;J3èŠ¯ç‰‡ï¼Œ æ ¹æ®æ‚¨ä½¿ç”¨çš„å¹³å°é€‰æ‹©ã€‚* | *å¿…é€‰*      |</span><br><span class="line">| *5*     | *`output_model_file_prefix`* | ***å‚æ•°ä½œç”¨**ï¼šæŒ‡å®šè½¬æ¢äº§å‡ºæ··åˆå¼‚æ„æ¨¡å‹çš„åç§°å‰ç¼€ã€‚**å–å€¼èŒƒå›´**ï¼šæ— ã€‚**é»˜è®¤é…ç½®**ï¼š`model`ã€‚**å‚æ•°è¯´æ˜**ï¼šè¾“å‡ºçš„å®šç‚¹æ¨¡å‹æ–‡ä»¶çš„åç§°å‰ç¼€ã€‚* | *å¯é€‰*      |</span><br><span class="line">| *6*     | *`working_dir`*              | ***å‚æ•°ä½œç”¨**ï¼šæŒ‡å®šæ¨¡å‹è½¬æ¢è¾“å‡ºçš„ç»“æœçš„å­˜æ”¾ç›®å½•ã€‚**å–å€¼èŒƒå›´**ï¼šæ— ã€‚**é»˜è®¤é…ç½®**ï¼š`model_output`ã€‚**å‚æ•°è¯´æ˜**ï¼šè‹¥è¯¥ç›®å½•ä¸å­˜åœ¨ï¼Œåˆ™å·¥å…·ä¼šè‡ªåŠ¨åˆ›å»ºç›®å½•ã€‚* | *å¯é€‰*      |</span><br><span class="line">| *7*     | *`layer_out_dump`*           | ***å‚æ•°ä½œç”¨**ï¼šæŒ‡å®šæ··åˆå¼‚æ„æ¨¡å‹æ˜¯å¦ä¿ç•™è¾“å‡ºä¸­é—´å±‚å€¼çš„èƒ½åŠ›ã€‚**å–å€¼èŒƒå›´**ï¼š`True` ã€ `False`ã€‚**é»˜è®¤é…ç½®**ï¼š`False`ã€‚**å‚æ•°è¯´æ˜**ï¼šè¾“å‡ºä¸­é—´å±‚çš„å€¼æ˜¯è°ƒè¯•éœ€è¦ç”¨åˆ°çš„æ‰‹æ®µï¼Œ å¸¸è§„çŠ¶æ€ä¸‹è¯·ä¸è¦å¼€å¯ã€‚* | *å¯é€‰*      |</span><br><span class="line">| *8*     | *`output_nodes`*             | ***å‚æ•°ä½œç”¨**ï¼šæŒ‡å®šæ¨¡å‹çš„è¾“å‡ºèŠ‚ç‚¹ã€‚**å–å€¼èŒƒå›´**ï¼šæ— ã€‚**é»˜è®¤é…ç½®**ï¼šæ— ã€‚**å‚æ•°è¯´æ˜**ï¼šä¸€èˆ¬æƒ…å†µä¸‹ï¼Œè½¬æ¢å·¥å…·ä¼šè‡ªåŠ¨è¯†åˆ«æ¨¡å‹çš„è¾“å‡ºèŠ‚ç‚¹ã€‚æ­¤å‚æ•°ç”¨äºæ”¯æŒæ‚¨æŒ‡å®šä¸€äº›ä¸­é—´å±‚æ¬¡ä½œä¸ºè¾“å‡ºã€‚è®¾ç½®å€¼ä¸ºæ¨¡å‹ä¸­çš„å…·ä½“èŠ‚ç‚¹åç§°ï¼Œ å¤šä¸ªå€¼çš„é…ç½®æ–¹æ³•è¯·å‚è€ƒ [param_valueé…ç½®](https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/ptq/ptq_usage/quantize_compile.html#param-value)ã€‚éœ€è¦æ‚¨æ³¨æ„çš„æ˜¯ï¼Œ**ä¸€æ—¦è®¾ç½®æ­¤å‚æ•°åï¼Œå·¥å…·å°†ä¸å†è‡ªåŠ¨è¯†åˆ«è¾“å‡ºèŠ‚ç‚¹ï¼Œ æ‚¨é€šè¿‡æ­¤å‚æ•°æŒ‡å®šçš„èŠ‚ç‚¹å°±æ˜¯å…¨éƒ¨çš„è¾“å‡ºã€‚*** | ***å¯é€‰***  |</span><br><span class="line">| *9*     | *`remove_node_type`*         | ***å‚æ•°ä½œç”¨**ï¼šè®¾ç½®åˆ é™¤èŠ‚ç‚¹çš„ç±»å‹ã€‚**å–å€¼èŒƒå›´**ï¼šâ€Quantizeâ€, â€œTransposeâ€, â€œDequantizeâ€, â€œCastâ€, â€œReshapeâ€, â€œSoftmaxâ€ã€‚ä¸åŒç±»å‹ç”¨â€;â€åˆ†å‰²ã€‚**é»˜è®¤é…ç½®**ï¼šæ— ã€‚**å‚æ•°è¯´æ˜**ï¼šè¯¥å‚æ•°ä¸ºéšè—å‚æ•°ï¼Œ ä¸è®¾ç½®æˆ–è®¾ç½®ä¸ºç©ºä¸å½±å“æ¨¡å‹è½¬æ¢è¿‡ç¨‹ã€‚ æ­¤å‚æ•°ç”¨äºæ”¯æŒæ‚¨è®¾ç½®å¾…åˆ é™¤èŠ‚ç‚¹çš„ç±»å‹ä¿¡æ¯ã€‚è¢«åˆ é™¤çš„èŠ‚ç‚¹å¿…é¡»åœ¨æ¨¡å‹çš„å¼€å¤´æˆ–è€…æœ«å°¾, ä¸æ¨¡å‹çš„è¾“å…¥æˆ–è¾“å‡ºè¿æ¥ã€‚**æ³¨æ„ï¼šå¾…åˆ é™¤èŠ‚ç‚¹ä¼šæŒ‰é¡ºåºä¾æ¬¡åˆ é™¤ï¼Œå¹¶åŠ¨æ€æ›´æ–°æ¨¡å‹ç»“æ„ï¼› åŒæ—¶åœ¨èŠ‚ç‚¹åˆ é™¤å‰è¿˜ä¼šåˆ¤æ–­è¯¥èŠ‚ç‚¹æ˜¯å¦ä½äºæ¨¡å‹çš„è¾“å…¥è¾“å‡ºå¤„ã€‚ å› æ­¤èŠ‚ç‚¹çš„åˆ é™¤é¡ºåºå¾ˆé‡è¦ã€‚*** | *å¯é€‰*      |</span><br><span class="line">| *10*    | *`remove_node_name`*         | ***å‚æ•°ä½œç”¨**ï¼šè®¾ç½®åˆ é™¤èŠ‚ç‚¹çš„åç§°ã€‚**å–å€¼èŒƒå›´**ï¼šæ— ã€‚ä¸åŒåç§°ç”¨â€;â€åˆ†å‰²ã€‚**é»˜è®¤é…ç½®**ï¼šæ— ã€‚**å‚æ•°è¯´æ˜**ï¼šè¯¥å‚æ•°ä¸ºéšè—å‚æ•°ï¼Œ ä¸è®¾ç½®æˆ–è®¾ç½®ä¸ºç©ºä¸å½±å“æ¨¡å‹è½¬æ¢è¿‡ç¨‹ã€‚ æ­¤å‚æ•°ç”¨äºæ”¯æŒæ‚¨è®¾ç½®å¾…åˆ é™¤èŠ‚ç‚¹çš„åç§°ã€‚è¢«åˆ é™¤çš„èŠ‚ç‚¹å¿…é¡»åœ¨æ¨¡å‹çš„å¼€å¤´æˆ–è€…æœ«å°¾, ä¸æ¨¡å‹çš„è¾“å…¥æˆ–è¾“å‡ºè¿æ¥ã€‚æ³¨æ„ï¼šå¾…åˆ é™¤èŠ‚ç‚¹ä¼šæŒ‰é¡ºåºä¾æ¬¡åˆ é™¤ï¼Œå¹¶åŠ¨æ€æ›´æ–°æ¨¡å‹ç»“æ„ï¼› åŒæ—¶åœ¨èŠ‚ç‚¹åˆ é™¤å‰è¿˜ä¼šåˆ¤æ–­è¯¥èŠ‚ç‚¹æ˜¯å¦ä½äºæ¨¡å‹çš„è¾“å…¥è¾“å‡ºå¤„ã€‚ å› æ­¤èŠ‚ç‚¹çš„åˆ é™¤é¡ºåºå¾ˆé‡è¦ã€‚* | *å¯é€‰*      |</span><br><span class="line">| *11*    | *`set_node_data_type`*       | ***å‚æ•°ä½œç”¨**ï¼šé…ç½®æŒ‡å®šopçš„è¾“å‡ºæ•°æ®ç±»å‹ä¸ºint16ã€‚**å–å€¼èŒƒå›´**ï¼šå½“å‰åªæ”¯æŒé…ç½®convèŠ‚ç‚¹ã€‚**é»˜è®¤é…ç½®**ï¼šæ— ã€‚**å‚æ•°è¯´æ˜**ï¼šåœ¨æ¨¡å‹è½¬æ¢è¿‡ç¨‹ä¸­ï¼Œå¤§å¤šæ•°opçš„é»˜è®¤è¾“å…¥è¾“å‡ºæ•°æ®ç±»å‹ä¸ºint8ï¼Œ é€šè¿‡è¯¥å‚æ•°å¯ä»¥æŒ‡å®šç‰¹å®šopçš„è¾“å‡ºæ•°æ®ç±»å‹ä¸ºint16ï¼ˆåœ¨æ»¡è¶³ä¸€å®šçš„çº¦æŸæ¡ä»¶ä¸‹ï¼‰ã€‚ int16ç›¸å…³è¯´æ˜è¯¦è§ [int16é…ç½®è¯´æ˜](https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/ptq/ptq_usage/quantize_compile.html#int16-config) éƒ¨åˆ†çš„æè¿°ã€‚ å…·ä½“ç®—å­int16æ”¯æŒæƒ…å†µè¯¦è§ [æ¨¡å‹è½¬æ¢å·¥å…·é“¾ç®—å­æ”¯æŒçº¦æŸåˆ—è¡¨](https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/appendix/supported_op_list.html) ã€‚* | *å¯é€‰*      |</span><br><span class="line">| *12*    | *`debug_mode`*               | ***å‚æ•°ä½œç”¨**ï¼šä¿å­˜ç”¨äºç²¾åº¦debugåˆ†æçš„æ ¡å‡†æ•°æ®ã€‚**å–å€¼èŒƒå›´**ï¼š`&quot;dump_calibration_data&quot;`**é»˜è®¤é…ç½®**ï¼šæ— ã€‚**å‚æ•°è¯´æ˜**ï¼šè¯¥å‚æ•°ä½œç”¨ä¸ºä¿å­˜ç”¨äºç²¾åº¦debugåˆ†æçš„æ ¡å‡†æ•°æ®ï¼Œæ•°æ®æ ¼å¼ä¸º.npyã€‚ è¯¥æ•°æ®é€šè¿‡np.load()å¯ç›´æ¥é€å…¥æ¨¡å‹è¿›è¡Œæ¨ç†ã€‚ è‹¥ä¸è®¾ç½®æ­¤å‚æ•°ï¼Œæ‚¨ä¹Ÿå¯è‡ªè¡Œä¿å­˜æ•°æ®å¹¶ä½¿ç”¨ç²¾åº¦debugå·¥å…·è¿›è¡Œç²¾åº¦åˆ†æã€‚* | *å¯é€‰*      |</span><br><span class="line"></span><br><span class="line">&gt;*è¾“å‡ºçš„å®šç‚¹æ¨¡å‹æ–‡ä»¶çš„åç§°å‰ç¼€æŒ‡çš„æ˜¯æ–‡ä»¶åçš„ä¸€éƒ¨åˆ†ã€‚æ–‡ä»¶åå‰ç¼€æ˜¯æŒ‡æ–‡ä»¶åçš„å¼€å¤´éƒ¨åˆ†ï¼Œå®ƒé€šå¸¸ç”¨äºæ ‡è¯†æ–‡ä»¶çš„ç±»å‹ã€ç”¨é€”æˆ–å…¶ä»–ç›¸å…³ä¿¡æ¯ã€‚*</span><br><span class="line">&gt;</span><br><span class="line">&gt;*åœ¨ç”Ÿæˆå®šç‚¹æ¨¡å‹æ–‡ä»¶æ—¶ï¼Œä¸ºäº†ä¸åŸå§‹çš„æµ®ç‚¹æ¨¡å‹æ–‡ä»¶åŒºåˆ†å¼€æ¥ï¼Œå¹¶ä¸”ä¾¿äºæ ‡è¯†è¯¥æ–‡ä»¶æ˜¯å®šç‚¹æ¨¡å‹ï¼Œå¯ä»¥åœ¨æ–‡ä»¶åå‰æ·»åŠ ä¸€ä¸ªç‰¹å®šçš„å‰ç¼€ã€‚è¿™ä¸ªå‰ç¼€å¯ä»¥æ˜¯ä»»æ„å­—ç¬¦æˆ–å­—ç¬¦ä¸²ï¼Œé€šå¸¸é€‰æ‹©ä¸æ¨¡å‹ç±»å‹ã€è½¬æ¢å·¥å…·ã€ç²¾åº¦ç­‰ç›¸å…³çš„æ ‡è¯†ç¬¦ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨&quot;quantized&quot;ã€&quot;fixed&quot;ã€&quot;int_&quot;ç­‰å‰ç¼€æ¥è¡¨ç¤ºå®šç‚¹æ¨¡å‹ã€‚*</span><br><span class="line"></span><br><span class="line">*ğŸ› ï¸ **è¾“å…¥ä¿¡æ¯å‚æ•°ç»„***</span><br><span class="line"></span><br><span class="line">| *ç¼– å·* | *å‚æ•°åç§°*                | *å‚æ•°é…ç½®è¯´æ˜*                                               | *å¯é€‰/å¿…é€‰* |</span><br><span class="line">| :------ | :------------------------ | :----------------------------------------------------------- | :---------- |</span><br><span class="line">| *1*     | *`input_name`*            | ***å‚æ•°ä½œç”¨**ï¼šæŒ‡å®šåŸå§‹æµ®ç‚¹æ¨¡å‹çš„è¾“å…¥èŠ‚ç‚¹åç§°ã€‚**å–å€¼èŒƒå›´**ï¼šæ— ã€‚**é»˜è®¤é…ç½®**ï¼šæ— ã€‚**å‚æ•°è¯´æ˜**ï¼šæµ®ç‚¹æ¨¡å‹åªæœ‰ä¸€ä¸ªè¾“å…¥èŠ‚ç‚¹æƒ…å†µæ—¶ä¸éœ€è¦é…ç½®ï¼Œ å¤šäºä¸€ä¸ªè¾“å…¥èŠ‚ç‚¹æ—¶å¿…é¡»é…ç½®ä»¥ä¿è¯åç»­ç±»å‹åŠæ ¡å‡†æ•°æ®è¾“å…¥é¡ºåºçš„å‡†ç¡®æ€§ã€‚å¤šä¸ªå€¼çš„é…ç½®æ–¹æ³•è¯·å‚è€ƒ [param_valueé…ç½®](https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/ptq/ptq_usage/quantize_compile.html#param-value)ã€‚* | *å¯é€‰*      |</span><br><span class="line">| *2*     | *`input_type_train`*      | ***å‚æ•°ä½œç”¨**ï¼šæŒ‡å®šåŸå§‹æµ®ç‚¹æ¨¡å‹çš„è¾“å…¥æ•°æ®ç±»å‹ã€‚**å–å€¼èŒƒå›´**ï¼š `rgb` ã€ `bgr` ã€ `yuv444` ã€ `gray` ã€ `featuremap`ã€‚**é»˜è®¤é…ç½®**ï¼šæ— ã€‚**å‚æ•°è¯´æ˜**ï¼šæ¯ä¸€ä¸ªè¾“å…¥èŠ‚ç‚¹éƒ½éœ€è¦é…ç½®ä¸€ä¸ªç¡®å®šçš„è¾“å…¥æ•°æ®ç±»å‹ï¼Œ å­˜åœ¨å¤šä¸ªè¾“å…¥èŠ‚ç‚¹æ—¶ï¼Œè®¾ç½®çš„èŠ‚ç‚¹é¡ºåºéœ€è¦ä¸ `input_name` é‡Œçš„é¡ºåºä¸¥æ ¼ä¿æŒä¸€è‡´ã€‚å¤šä¸ªå€¼çš„é…ç½®æ–¹æ³•è¯·å‚è€ƒ [param_valueé…ç½®](https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/ptq/ptq_usage/quantize_compile.html#param-value)ã€‚æ•°æ®ç±»å‹çš„é€‰æ‹©è¯·å‚è€ƒï¼š [è½¬æ¢å†…éƒ¨è¿‡ç¨‹è§£è¯»](https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/ptq/ptq_usage/quantize_compile.html#conversion-interpretation) éƒ¨åˆ†çš„ä»‹ç»ã€‚* | *å¿…é€‰*      |</span><br><span class="line">| *3*     | *`input_layout_train`*    | ***å‚æ•°ä½œç”¨**ï¼šæŒ‡å®šåŸå§‹æµ®ç‚¹æ¨¡å‹çš„è¾“å…¥æ•°æ®æ’å¸ƒã€‚**å–å€¼èŒƒå›´**ï¼š`NHWC` ã€ `NCHW`ã€‚**é»˜è®¤é…ç½®**ï¼šæ— ã€‚**å‚æ•°è¯´æ˜**ï¼šæ¯ä¸€ä¸ªè¾“å…¥èŠ‚ç‚¹éƒ½éœ€è¦é…ç½®ä¸€ä¸ªç¡®å®šçš„è¾“å…¥æ•°æ®æ’å¸ƒï¼Œ è¿™ä¸ªæ’å¸ƒå¿…é¡»ä¸åŸå§‹æµ®ç‚¹æ¨¡å‹æ‰€é‡‡ç”¨çš„æ•°æ®æ’å¸ƒç›¸åŒã€‚å­˜åœ¨å¤šä¸ªè¾“å…¥èŠ‚ç‚¹æ—¶ï¼Œ è®¾ç½®çš„èŠ‚ç‚¹é¡ºåºéœ€è¦ä¸ `input_name` é‡Œçš„é¡ºåºä¸¥æ ¼ä¿æŒä¸€è‡´ã€‚å¤šä¸ªå€¼çš„é…ç½®æ–¹æ³•è¯·å‚è€ƒ [param_valueé…ç½®](https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/ptq/ptq_usage/quantize_compile.html#param-value)ã€‚ä»€ä¹ˆæ˜¯æ•°æ®æ’å¸ƒè¯·å‚è€ƒï¼š [è½¬æ¢å†…éƒ¨è¿‡ç¨‹è§£è¯»](https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/ptq/ptq_usage/quantize_compile.html#conversion-interpretation) éƒ¨åˆ†çš„ä»‹ç»ã€‚* | *å¿…é€‰*      |</span><br><span class="line">| *4*     | *`input_type_rt`*         | ***å‚æ•°ä½œç”¨**ï¼šè½¬æ¢åæ··åˆå¼‚æ„æ¨¡å‹éœ€è¦é€‚é…çš„è¾“å…¥æ•°æ®æ ¼å¼ã€‚**å–å€¼èŒƒå›´**ï¼š`rgb` ã€ `bgr` ã€ `yuv444` ã€`nv12` ã€ `gray` ã€ `featuremap`ã€‚**é»˜è®¤é…ç½®**ï¼šæ— ã€‚**å‚æ•°è¯´æ˜**ï¼šè¿™é‡Œæ˜¯æŒ‡æ˜æ‚¨éœ€è¦ä½¿ç”¨çš„æ•°æ®æ ¼å¼ã€‚**ä¸è¦æ±‚ä¸åŸå§‹æ¨¡å‹çš„æ•°æ®æ ¼å¼ä¸€è‡´ã€‚ä½†æ˜¯éœ€è¦æ³¨æ„åœ¨è¾¹ç¼˜å¹³å°å–‚ç»™æ¨¡å‹çš„æ•°æ®æ˜¯ä½¿ç”¨è¿™ä¸ªæ ¼å¼**ã€‚æ¯ä¸€ä¸ªè¾“å…¥èŠ‚ç‚¹éƒ½éœ€è¦é…ç½®ä¸€ä¸ªç¡®å®šçš„è¾“å…¥æ•°æ®ç±»å‹ï¼Œå­˜åœ¨å¤šä¸ªè¾“å…¥èŠ‚ç‚¹æ—¶ï¼Œ è®¾ç½®çš„èŠ‚ç‚¹é¡ºåºéœ€è¦ä¸ `input_name` é‡Œçš„é¡ºåºä¸¥æ ¼ä¿æŒä¸€è‡´ã€‚å¤šä¸ªå€¼çš„é…ç½®æ–¹æ³•è¯·å‚è€ƒ [param_valueé…ç½®](https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/ptq/ptq_usage/quantize_compile.html#param-value)ã€‚æ•°æ®ç±»å‹çš„é€‰æ‹©è¯·å‚è€ƒï¼š [è½¬æ¢å†…éƒ¨è¿‡ç¨‹è§£è¯»](https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/ptq/ptq_usage/quantize_compile.html#conversion-interpretation) éƒ¨åˆ†çš„ä»‹ç»ã€‚* | *å¿…é€‰*      |</span><br><span class="line">| *5*     | *`input_layout_rt`*       | ***å‚æ•°ä½œç”¨**ï¼šè½¬æ¢åæ··åˆå¼‚æ„æ¨¡å‹éœ€è¦é€‚é…çš„è¾“å…¥æ•°æ®æ’å¸ƒã€‚**å–å€¼èŒƒå›´**ï¼š `NCHW` ã€ `NHWC`ã€‚**é»˜è®¤é…ç½®**ï¼šæ— ã€‚**å‚æ•°è¯´æ˜**ï¼šæ¯ä¸€ä¸ªè¾“å…¥èŠ‚ç‚¹éƒ½éœ€è¦é…ç½®ä¸€ä¸ªç¡®å®šçš„è¾“å…¥æ•°æ®æ’å¸ƒã€‚ è¿™ä¸ªè¾“å…¥æ˜¯æ‚¨å¸Œæœ›ç»™æ··åˆå¼‚æ„æ¨¡å‹æŒ‡å®šçš„æ’å¸ƒã€‚ä¸åˆé€‚çš„è¾“å…¥æ•°æ®çš„æ’å¸ƒè®¾ç½®å°†ä¼šå½±å“æ€§èƒ½ï¼Œ å­˜åœ¨å¤šä¸ªè¾“å…¥èŠ‚ç‚¹æ—¶ï¼Œè®¾ç½®çš„èŠ‚ç‚¹é¡ºåºéœ€è¦ä¸ `input_name` é‡Œçš„é¡ºåºä¸¥æ ¼ä¿æŒä¸€è‡´ã€‚å¤šä¸ªå€¼çš„é…ç½®æ–¹æ³•è¯·å‚è€ƒ [param_valueé…ç½®](https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/ptq/ptq_usage/quantize_compile.html#param-value)ã€‚ä»€ä¹ˆæ˜¯æ•°æ®æ’å¸ƒè¯·å‚è€ƒï¼š [è½¬æ¢å†…éƒ¨è¿‡ç¨‹è§£è¯»](https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/ptq/ptq_usage/quantize_compile.html#conversion-interpretation) éƒ¨åˆ†çš„ä»‹ç»ã€‚* | *å¯é€‰*      |</span><br><span class="line">| *6*     | *`input_space_and_range`* | ***å‚æ•°ä½œç”¨**ï¼šæŒ‡å®šè¾“å…¥æ•°æ®æ ¼å¼çš„ç‰¹æ®Šåˆ¶å¼ã€‚**å–å€¼èŒƒå›´**ï¼š `regular` , `bt601_video`ã€‚**é»˜è®¤é…ç½®**ï¼š `regular`ã€‚**å‚æ•°è¯´æ˜**ï¼š**è¿™ä¸ªå‚æ•°æ˜¯ä¸ºäº†é€‚é…ä¸åŒISPè¾“å‡ºçš„yuv420æ ¼å¼ï¼Œ åœ¨ç›¸åº” `input_type_rt` ä¸º `nv12` æ—¶ï¼Œè¯¥é…ç½®æ‰æœ‰æ•ˆã€‚**`regular` å°±æ˜¯å¸¸è§çš„yuv420æ ¼å¼ï¼Œæ•°å€¼èŒƒå›´ä¸º `[0,255]`ï¼›`bt601_video` æ˜¯å¦ä¸€ç§è§†é¢‘åˆ¶å¼yuv420ï¼Œæ•°å€¼èŒƒå›´ä¸º `[16,235]`ã€‚æ›´å¤šä¿¡æ¯å¯ä»¥é€šè¿‡ç½‘ç»œèµ„æ–™äº†è§£bt601ã€‚åœ¨æ²¡æœ‰æ˜ç¡®éœ€è¦çš„æƒ…å†µä¸‹ï¼Œæ‚¨ä¸è¦é…ç½®æ­¤å‚æ•°ã€‚* | *å¯é€‰*      |</span><br><span class="line">| *7*     | *`input_shape`*           | ***å‚æ•°ä½œç”¨**ï¼šæŒ‡å®šåŸå§‹æµ®ç‚¹æ¨¡å‹çš„è¾“å…¥æ•°æ®å°ºå¯¸ã€‚**å–å€¼èŒƒå›´**ï¼šæ— ã€‚**é»˜è®¤é…ç½®**ï¼šæ— ã€‚**å‚æ•°è¯´æ˜**ï¼šshapeçš„å‡ ä¸ªç»´åº¦ä»¥ `x` è¿æ¥ï¼Œä¾‹å¦‚ `1x3x224x224`ã€‚åŸå§‹æµ®ç‚¹æ¨¡å‹åªæœ‰ä¸€ä¸ªè¾“å…¥èŠ‚ç‚¹æƒ…å†µæ—¶å¯ä»¥ä¸é…ç½®ï¼Œ å·¥å…·ä¼šè‡ªåŠ¨è¯»å–æ¨¡å‹æ–‡ä»¶ä¸­çš„å°ºå¯¸ä¿¡æ¯ã€‚é…ç½®å¤šä¸ªè¾“å…¥èŠ‚ç‚¹æ—¶ï¼Œè®¾ç½®çš„èŠ‚ç‚¹é¡ºåºéœ€è¦ä¸ `input_name` é‡Œçš„é¡ºåºä¸¥æ ¼ä¿æŒä¸€è‡´ã€‚å¤šä¸ªå€¼çš„é…ç½®æ–¹æ³•è¯·å‚è€ƒ [param_valueé…ç½®](https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/ptq/ptq_usage/quantize_compile.html#param-value)ã€‚* | *å¯é€‰*      |</span><br><span class="line">| *8*     | *`input_batch`*           | ***å‚æ•°ä½œç”¨**ï¼šæŒ‡å®šè½¬æ¢åæ··åˆå¼‚æ„æ¨¡å‹éœ€è¦é€‚é…çš„è¾“å…¥batchæ•°é‡ã€‚**å–å€¼èŒƒå›´**ï¼š`1-4096`ã€‚**é»˜è®¤é…ç½®**ï¼š`1`ã€‚**å‚æ•°è¯´æ˜**ï¼šè¿™é‡Œinput_batchä¸ºè½¬æ¢åæ··åˆå¼‚æ„binæ¨¡å‹è¾“å…¥batchæ•°é‡ï¼Œ ä½†ä¸å½±å“è½¬æ¢åonnxçš„æ¨¡å‹çš„è¾“å…¥batchæ•°é‡ã€‚æ­¤å‚æ•°ä¸é…ç½®æ—¶é»˜è®¤ä¸º1ã€‚æ­¤å‚æ•°ä»…åœ¨å•è¾“å…¥ä¸” `input_shape` ç¬¬ä¸€ç»´ä¸º1çš„æ—¶å€™å¯ä»¥ä½¿ç”¨ã€‚* | *å¯é€‰*      |</span><br><span class="line">| *9*     | *`norm_type`*             | ***å‚æ•°ä½œç”¨**ï¼šåœ¨æ¨¡å‹ä¸­æ·»åŠ çš„è¾“å…¥æ•°æ®é¢„å¤„ç†æ–¹æ³•ã€‚**å–å€¼èŒƒå›´**ï¼š `data_mean_and_scale` ã€ `data_mean` ã€`data_scale` ã€ `no_preprocess`ã€‚**é»˜è®¤é…ç½®**ï¼š`no_preprocess`ã€‚**å‚æ•°è¯´æ˜**ï¼š `no_preprocess` è¡¨ç¤ºä¸æ·»åŠ ä»»ä½•æ•°æ®é¢„å¤„ç†ï¼›`data_mean` è¡¨ç¤ºæä¾›å‡å‡å€¼é¢„å¤„ç†ï¼›`data_scale` è¡¨ç¤ºæä¾›ä¹˜scaleç³»æ•°é¢„å¤„ç†ï¼›`data_mean_and_scale` è¡¨ç¤ºæä¾›å…ˆå‡å‡å€¼å†ä¹˜scaleç³»æ•°å‰å¤„ç†ã€‚è¾“å…¥èŠ‚ç‚¹æ—¶å¤šäºä¸€ä¸ªæ—¶ï¼Œè®¾ç½®çš„èŠ‚ç‚¹é¡ºåºéœ€è¦ä¸ `input_name` é‡Œçš„é¡ºåºä¸¥æ ¼ä¿æŒä¸€è‡´ï¼Œ å¤šä¸ªå€¼çš„é…ç½®æ–¹æ³•è¯·å‚è€ƒ [param_valueé…ç½®](https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/ptq/ptq_usage/quantize_compile.html#param-value)ã€‚é…ç½®è¯¥å‚æ•°çš„å½±å“è¯·å‚è€ƒï¼š [è½¬æ¢å†…éƒ¨è¿‡ç¨‹è§£è¯»](https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/ptq/ptq_usage/quantize_compile.html#conversion-interpretation) éƒ¨åˆ†çš„ä»‹ç»ã€‚* | *å¯é€‰*      |</span><br><span class="line">| *10*    | *`mean_value`*            | ***å‚æ•°ä½œç”¨**ï¼šæŒ‡å®šé¢„å¤„ç†æ–¹æ³•çš„å›¾åƒå‡å»çš„å‡å€¼ã€‚**å–å€¼èŒƒå›´**ï¼šæ— ã€‚**é»˜è®¤é…ç½®**ï¼šæ— ã€‚**å‚æ•°è¯´æ˜**ï¼šå½“ `norm_type` å­˜åœ¨ `data_mean_and_scale`æˆ– `data_mean` æ—¶éœ€è¦é…ç½®è¯¥å‚æ•°ã€‚å¯¹äºæ¯ä¸€ä¸ªè¾“å…¥èŠ‚ç‚¹è€Œè¨€ï¼Œå­˜åœ¨ä¸¤ç§é…ç½®æ–¹å¼ã€‚ç¬¬ä¸€ç§æ˜¯ä»…é…ç½®ä¸€ä¸ªæ•°å€¼ï¼Œè¡¨ç¤ºæ‰€æœ‰é€šé“éƒ½å‡å»è¿™ä¸ªå‡å€¼ï¼›ç¬¬äºŒç§æ˜¯æä¾›ä¸é€šé“æ•°é‡ä¸€è‡´çš„æ•°å€¼ï¼ˆè¿™äº›æ•°å€¼ä»¥ç©ºæ ¼åˆ†éš”å¼€ï¼‰ï¼Œ è¡¨ç¤ºæ¯ä¸ªé€šé“éƒ½ä¼šå‡å»ä¸åŒçš„å‡å€¼ã€‚é…ç½®çš„è¾“å…¥èŠ‚ç‚¹æ•°é‡å¿…é¡»ä¸ `norm_type` é…ç½®çš„èŠ‚ç‚¹æ•°é‡ä¸€è‡´ã€‚å¦‚æœå­˜åœ¨æŸä¸ªèŠ‚ç‚¹ä¸éœ€è¦ `mean` å¤„ç†ï¼Œåˆ™ä¸ºè¯¥èŠ‚ç‚¹é…ç½® `&#x27;None&#x27;`ã€‚å¤šä¸ªå€¼çš„é…ç½®æ–¹æ³•è¯·å‚è€ƒ [param_valueé…ç½®](https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/ptq/ptq_usage/quantize_compile.html#param-value)ã€‚* | *å¯é€‰*      |</span><br><span class="line">| *11*    | *`scale_value`*           | ***å‚æ•°ä½œç”¨**ï¼šæŒ‡å®šé¢„å¤„ç†æ–¹æ³•çš„æ•°å€¼scaleç³»æ•°ã€‚**å–å€¼èŒƒå›´**ï¼šæ— ã€‚**é»˜è®¤é…ç½®**ï¼šæ— ã€‚**å‚æ•°è¯´æ˜**ï¼šå½“ `norm_type` å­˜åœ¨ `data_mean_and_scale` æˆ–`data_scale` æ—¶éœ€è¦é…ç½®è¯¥å‚æ•°ã€‚å¯¹äºæ¯ä¸€ä¸ªè¾“å…¥èŠ‚ç‚¹è€Œè¨€ï¼Œå­˜åœ¨ä¸¤ç§é…ç½®æ–¹å¼ã€‚ç¬¬ä¸€ç§æ˜¯ä»…é…ç½®ä¸€ä¸ªæ•°å€¼ï¼Œè¡¨ç¤ºæ‰€æœ‰é€šé“éƒ½ä¹˜ä»¥è¿™ä¸ªç³»æ•°ï¼›ç¬¬äºŒç§æ˜¯æä¾›ä¸é€šé“æ•°é‡ä¸€è‡´çš„æ•°å€¼ï¼ˆè¿™äº›æ•°å€¼ä»¥ç©ºæ ¼åˆ†éš”å¼€ï¼‰ï¼Œ è¡¨ç¤ºæ¯ä¸ªé€šé“éƒ½ä¼šä¹˜ä»¥ä¸åŒçš„ç³»æ•°ã€‚é…ç½®çš„è¾“å…¥èŠ‚ç‚¹æ•°é‡å¿…é¡»ä¸ `norm_type` é…ç½®çš„èŠ‚ç‚¹æ•°é‡ä¸€è‡´ã€‚å¦‚æœå­˜åœ¨æŸä¸ªèŠ‚ç‚¹ä¸éœ€è¦ `scale` å¤„ç†ï¼Œåˆ™ä¸ºè¯¥èŠ‚ç‚¹é…ç½® `&#x27;None&#x27;`ã€‚å¤šä¸ªå€¼çš„é…ç½®æ–¹æ³•è¯·å‚è€ƒ [param_valueé…ç½®](https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/ptq/ptq_usage/quantize_compile.html#param-value)ã€‚* |             |</span><br><span class="line"></span><br><span class="line">*ğŸ› ï¸ **æ ¡å‡†å‚æ•°ç»„***</span><br><span class="line"></span><br><span class="line">| *ç¼– å·* | *å‚æ•°åç§°*           | *å‚æ•°é…ç½®è¯´æ˜*                                               | *å¯é€‰/å¿…é€‰* |</span><br><span class="line">| :------ | :------------------- | :----------------------------------------------------------- | :---------- |</span><br><span class="line">| *1*     | *`cal_data_dir`*     | ***å‚æ•°ä½œç”¨**ï¼šæŒ‡å®šæ¨¡å‹æ ¡å‡†ä½¿ç”¨çš„æ ‡å®šæ ·æœ¬çš„å­˜æ”¾ç›®å½•ã€‚**å–å€¼èŒƒå›´**ï¼šæ— ã€‚**é»˜è®¤é…ç½®**ï¼šæ— ã€‚**å‚æ•°è¯´æ˜**ï¼šç›®å½•å†…æ ¡å‡†æ•°æ®éœ€è¦ç¬¦åˆè¾“å…¥é…ç½®çš„è¦æ±‚ã€‚å…·ä½“è¯·å‚è€ƒ [æ ¡å‡†æ•°æ®å‡†å¤‡](https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/ptq/ptq_usage/prepare_calibration_data.html) éƒ¨åˆ†çš„ä»‹ç»ã€‚é…ç½®å¤šä¸ªè¾“å…¥èŠ‚ç‚¹æ—¶ï¼Œ è®¾ç½®çš„èŠ‚ç‚¹é¡ºåºéœ€è¦ä¸ `input_name` é‡Œçš„é¡ºåºä¸¥æ ¼ä¿æŒä¸€è‡´ã€‚å¤šä¸ªå€¼çš„é…ç½®æ–¹æ³•è¯·å‚è€ƒ [param_valueé…ç½®](https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/ptq/ptq_usage/quantize_compile.html#param-value)ã€‚**å½“calibration_typeä¸º `load`, `skip` æ—¶ï¼Œcal_data_dirä¸ç”¨å¡«**ã€‚æ³¨æ„ï¼š ä¸ºäº†æ–¹ä¾¿æ‚¨çš„ä½¿ç”¨ï¼Œå¦‚æœæœªå‘ç°cal_data_typeçš„é…ç½®ï¼Œæˆ‘ä»¬å°†æ ¹æ®æ–‡ä»¶å¤¹ åç¼€å¯¹æ•°æ®ç±»å‹è¿›è¡Œé…ç½®ã€‚å¦‚æœæ–‡ä»¶å¤¹åç¼€ä»¥ `_f32` ç»“å°¾ï¼Œåˆ™è®¤ä¸ºæ•°æ® ç±»å‹æ˜¯float32ï¼Œå¦åˆ™è®¤ä¸ºæ•°æ®ç±»å‹æ˜¯uint8ã€‚ å½“ç„¶ï¼Œæˆ‘ä»¬å¼ºçƒˆå»ºè®®æ‚¨é€šè¿‡cal_data_typeå‚æ•°å¯¹æ•°æ®ç±»å‹è¿›è¡Œçº¦æŸã€‚* | *å¯é€‰*      |</span><br><span class="line">| *2*     | *`cal_data_type`*    | ***å‚æ•°ä½œç”¨**ï¼šæŒ‡å®šæ ¡å‡†æ•°æ®äºŒè¿›åˆ¶æ–‡ä»¶çš„æ•°æ®å­˜å‚¨ç±»å‹ã€‚**å–å€¼èŒƒå›´**ï¼š`float32`ã€`uint8`ã€‚**é»˜è®¤é…ç½®**ï¼šæ— ã€‚**å‚æ•°è¯´æ˜**ï¼šæŒ‡å®šæ¨¡å‹æ ¡å‡†æ—¶ä½¿ç”¨çš„äºŒè¿›åˆ¶æ–‡ä»¶çš„æ•°æ®å­˜å‚¨ç±»å‹ã€‚æ²¡æœ‰æŒ‡å®šå€¼çš„æƒ…å†µä¸‹å°†ä¼šä½¿ç”¨æ–‡ä»¶å¤¹åå­—åç¼€æ¥åšåˆ¤æ–­ã€‚å¤šä¸ªå€¼çš„é…ç½®æ–¹æ³•è¯·å‚è€ƒ [param_valueé…ç½®](https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/ptq/ptq_usage/quantize_compile.html#param-value)ã€‚* | *å¯é€‰*      |</span><br><span class="line">| *3*     | *`preprocess_on`*    | ***å‚æ•°ä½œç”¨**ï¼šå¼€å¯å›¾ç‰‡æ ¡å‡†æ ·æœ¬è‡ªåŠ¨å¤„ç†ã€‚**å–å€¼èŒƒå›´**ï¼š `True` ã€ `False`ã€‚**é»˜è®¤é…ç½®**ï¼š `False`ã€‚**å‚æ•°è¯´æ˜**ï¼š**è¯¥é€‰é¡¹ä»…é€‚ç”¨äº4ç»´å›¾åƒè¾“å…¥çš„æ¨¡å‹ï¼Œ é4ç»´æ¨¡å‹ä¸è¦æ‰“å¼€è¯¥é€‰é¡¹ã€‚**åœ¨å¯åŠ¨è¯¥åŠŸèƒ½æ—¶ï¼Œcal_data_dir ç›®å½•ä¸‹å­˜æ”¾çš„éƒ½æ˜¯jpg/bmp/png ç­‰å›¾ç‰‡æ•°æ®ï¼Œå·¥å…·ä¼šä½¿ç”¨skimageè¯»å–å›¾ç‰‡ï¼Œ å¹¶resizeåˆ°è¾“å…¥èŠ‚ç‚¹éœ€è¦çš„å°ºå¯¸ã€‚ä¸ºäº†ä¿è¯æ ¡å‡†çš„æ•ˆæœï¼Œå»ºè®®æ‚¨ä¿æŒè¯¥å‚æ•°å…³é—­ã€‚ä½¿ç”¨çš„å½±å“è¯·å‚è€ƒ [æ ¡å‡†æ•°æ®å‡†å¤‡](https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/ptq/ptq_usage/prepare_calibration_data.html) éƒ¨åˆ†çš„ä»‹ç»ã€‚* | *å¯é€‰*      |</span><br><span class="line">| *4*     | *`calibration_type`* | ***å‚æ•°ä½œç”¨**ï¼šæ ¡å‡†ä½¿ç”¨çš„ç®—æ³•ç±»å‹ã€‚**å–å€¼èŒƒå›´**ï¼š`default`ã€`mix`ã€`kl`ã€`max` ã€ `load` å’Œ `skip`ã€‚**é»˜è®¤é…ç½®**ï¼š`default`ã€‚**å‚æ•°è¯´æ˜**ï¼š `kl` å’Œ `max` éƒ½æ˜¯å…¬å¼€çš„æ ¡å‡†é‡åŒ–ç®—æ³•ï¼Œ å…¶åŸºæœ¬åŸç†å¯ä»¥é€šè¿‡ç½‘ç»œèµ„æ–™æŸ¥é˜…ã€‚ä½¿ç”¨ `load` æ–¹å¼æ ¡å‡†æ—¶, qatæ¨¡å‹å¿…é¡»æ˜¯é€šè¿‡plugin å¯¼å‡ºçš„æ¨¡å‹ã€‚è¯¦æƒ…å‚è§ [ä½¿ç”¨QATé‡åŒ–æ„ŸçŸ¥è®­ç»ƒæ–¹æ¡ˆè¿›ä¸€æ­¥æå‡æ¨¡å‹ç²¾åº¦](https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/ptq/ptq_usage/accuracy_evaluation.html#qat-accuracy) ã€‚`default` æ˜¯ä¸€ä¸ªè‡ªåŠ¨æœç´¢çš„ç­–ç•¥ï¼Œ ä¼šå°è¯•ä»ç³»åˆ—æ ¡å‡†é‡åŒ–å‚æ•°ä¸­è·å¾—ä¸€ä¸ªç›¸å¯¹æ•ˆæœè¾ƒå¥½çš„ç»„åˆã€‚`mix` æ˜¯ä¸€ä¸ªé›†æˆå¤šç§æ ¡å‡†æ–¹æ³•çš„æœç´¢ç­–ç•¥ï¼Œ èƒ½å¤Ÿè‡ªåŠ¨ç¡®å®šé‡åŒ–æ•æ„ŸèŠ‚ç‚¹ï¼Œå¹¶åœ¨èŠ‚ç‚¹ç²’åº¦ä¸Šä»ä¸åŒçš„æ ¡å‡†æ–¹æ³• ä¸­æŒ‘é€‰å‡ºæœ€ä½³æ–¹æ³•ï¼Œæœ€ç»ˆæ„å»ºä¸€ä¸ªèåˆäº†å¤šç§æ ¡å‡†æ–¹æ³•ä¼˜åŠ¿çš„ç»„åˆæ ¡å‡†æ–¹å¼ã€‚å¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯QATå¯¼å‡ºçš„æ¨¡å‹ï¼Œåˆ™åº”é€‰æ‹© `load`ã€‚å»ºè®®æ‚¨å…ˆå°è¯• `default`ï¼Œ å¦‚æœæœ€ç»ˆçš„ç²¾åº¦ç»“æœä¸æ»¡è¶³é¢„æœŸï¼Œ å†æ ¹æ® [ç²¾åº¦è°ƒä¼˜](https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/ptq/ptq_usage/accuracy_evaluation.html#accuracy-optimization) éƒ¨åˆ†çš„å»ºè®®é…ç½®ä¸åŒçš„æ ¡å‡†å‚æ•°ã€‚è‹¥æ‚¨åªæƒ³å°è¯•å¯¹æ¨¡å‹æ€§èƒ½è¿›è¡ŒéªŒè¯ï¼Œä½†å¯¹ç²¾åº¦æ²¡æœ‰è¦æ±‚ï¼Œ åˆ™å¯ä»¥å°è¯• â€œskipâ€ æ–¹å¼è¿›è¡Œæ ¡å‡†ã€‚è¯¥æ–¹å¼ä¼šä½¿ç”¨éšæœºæ•°è¿›è¡Œæ ¡å‡†ï¼Œ ä¸éœ€è¦æ‚¨å‡†å¤‡æ ¡å‡†æ•°æ®ï¼Œæ¯”è¾ƒé€‚åˆåˆæ¬¡å°è¯•å¯¹æ¨¡å‹ç»“æ„è¿›è¡ŒéªŒè¯ã€‚æ³¨æ„ï¼š ä½¿ç”¨skipæ–¹å¼æ—¶ï¼Œå› ä½¿ç”¨éšæœºæ•°æ ¡å‡†, å¾—åˆ°çš„æ¨¡å‹ä¸å¯ç”¨äºç²¾åº¦éªŒè¯ã€‚* | *å¯é€‰*      |</span><br><span class="line">| *5*     | *`max_percentile`*   | ***å‚æ•°ä½œç”¨**ï¼šè¯¥å‚æ•°ä¸º `max` æ ¡å‡†æ–¹æ³•çš„å‚æ•°ï¼Œç”¨ä»¥è°ƒæ•´ `max` æ ¡å‡†çš„æˆªå–ç‚¹ã€‚**å–å€¼èŒƒå›´**ï¼š `0.0` ~ `1.0`ã€‚**é»˜è®¤é…ç½®**ï¼š `1.0`ã€‚**å‚æ•°è¯´æ˜**ï¼šæ­¤å‚æ•°ä»…åœ¨ `calibration_type` ä¸º `max` æ—¶æœ‰æ•ˆï¼Œå¸¸ç”¨é…ç½®é€‰é¡¹æœ‰ï¼š0.99999/0.99995/0.99990/0.99950/0.99900ã€‚å»ºè®®æ‚¨å…ˆå°è¯• `calibration_type` é…ç½® `default`ï¼Œ å¦‚æœæœ€ç»ˆçš„ç²¾åº¦ç»“æœä¸æ»¡è¶³é¢„æœŸï¼Œ å†æ ¹æ® [ç²¾åº¦è°ƒä¼˜](https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/ptq/ptq_usage/accuracy_evaluation.html#accuracy-optimization) éƒ¨åˆ†å»ºè®®è°ƒæ•´è¯¥å‚æ•°ã€‚* | *å¯é€‰*      |</span><br><span class="line">| *6*     | *`per_channel`*      | ***å‚æ•°ä½œç”¨**ï¼šæ§åˆ¶æ˜¯å¦é’ˆå¯¹featuremapçš„æ¯ä¸ªchannelè¿›è¡Œæ ¡å‡†ã€‚**å–å€¼èŒƒå›´**ï¼š `True` ã€ `False`ã€‚**é»˜è®¤é…ç½®**ï¼š `False`ã€‚**å‚æ•°è¯´æ˜**ï¼š **`calibration_type` è®¾ç½®édefaultã€émixæ—¶æœ‰æ•ˆ**ã€‚å»ºè®®æ‚¨å…ˆå°è¯• `default`ï¼Œ å¦‚æœæœ€ç»ˆçš„ç²¾åº¦ç»“æœä¸æ»¡è¶³é¢„æœŸï¼Œ å†æ ¹æ® [ç²¾åº¦è°ƒä¼˜](https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/ptq/ptq_usage/accuracy_evaluation.html#accuracy-optimization) éƒ¨åˆ†å»ºè®®è°ƒæ•´è¯¥å‚æ•°ã€‚* | *å¯é€‰*      |</span><br><span class="line">| *7*     | *`run_on_cpu`*       | ***å‚æ•°ä½œç”¨**ï¼šå¼ºåˆ¶æŒ‡å®šç®—å­åœ¨CPUä¸Šè¿è¡Œã€‚**å–å€¼èŒƒå›´**ï¼šæ— ã€‚**é»˜è®¤é…ç½®**ï¼šæ— ã€‚**å‚æ•°è¯´æ˜**ï¼šCPUä¸Šè™½ç„¶æ€§èƒ½ä¸åŠBPUï¼Œä½†æ˜¯æä¾›çš„æ˜¯floatç²¾åº¦è®¡ç®—ã€‚å¦‚æœæ‚¨ç¡®å®šæŸäº›ç®—å­éœ€è¦åœ¨CPUä¸Šè®¡ç®—ï¼Œ å¯ä»¥é€šè¿‡è¯¥å‚æ•°æŒ‡å®šã€‚è®¾ç½®å€¼ä¸ºæ¨¡å‹ä¸­çš„å…·ä½“èŠ‚ç‚¹åç§°ã€‚å¤šä¸ªå€¼çš„é…ç½®æ–¹æ³•è¯·å‚è€ƒ [param_valueé…ç½®](https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/ptq/ptq_usage/quantize_compile.html#param-value)ã€‚* | *å¯é€‰*      |</span><br><span class="line">| *8*     | *`run_on_bpu`*       | ***å‚æ•°ä½œç”¨**ï¼šå¼ºåˆ¶æŒ‡å®šOPåœ¨BPUä¸Šè¿è¡Œã€‚**å–å€¼èŒƒå›´**ï¼šæ— ã€‚**é»˜è®¤é…ç½®**ï¼šæ— ã€‚**å‚æ•°è¯´æ˜**ï¼šä¸ºäº†ä¿è¯æœ€ç»ˆé‡åŒ–æ¨¡å‹çš„ç²¾åº¦ï¼Œå°‘éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œ è½¬æ¢å·¥å…·ä¼šå°†ä¸€äº›å…·å¤‡BPUè®¡ç®—æ¡ä»¶çš„ç®—å­æ”¾åœ¨CPUä¸Šè¿è¡Œã€‚å¦‚æœæ‚¨å¯¹æ€§èƒ½æœ‰è¾ƒé«˜çš„è¦æ±‚ï¼Œæ„¿æ„ä»¥æ›´å¤šä¸€äº›é‡åŒ–æŸå¤±ä¸ºä»£ä»·ï¼Œ åˆ™å¯ä»¥é€šè¿‡è¯¥å‚æ•°æ˜ç¡®æŒ‡å®šç®—å­è¿è¡Œåœ¨BPUä¸Šã€‚è®¾ç½®å€¼ä¸ºæ¨¡å‹ä¸­çš„å…·ä½“èŠ‚ç‚¹åç§°ã€‚å¤šä¸ªå€¼çš„é…ç½®æ–¹æ³•è¯·å‚è€ƒ [param_valueé…ç½®](https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/ptq/ptq_usage/quantize_compile.html#param-value)ã€‚* | *å¯é€‰*      |</span><br><span class="line">| *9*     | *`optimization`*     | ***å‚æ•°ä½œç”¨**ï¼šä½¿æ¨¡å‹ä»¥ int8/int16 æ ¼å¼è¾“å‡ºã€‚**å–å€¼èŒƒå›´**ï¼š`set_model_output_int8` æˆ–è€… `set_model_output_int16` ã€‚**é»˜è®¤é…ç½®**ï¼šæ— ã€‚**å‚æ•°è¯´æ˜**ï¼šæŒ‡å®šå€¼ä¸ºset_model_output_int8æ—¶ï¼Œè®¾ç½®æ¨¡å‹ä¸º int8 æ ¼å¼ä½ç²¾åº¦è¾“å‡ºï¼›æŒ‡å®šå€¼ä¸ºset_model_output_int16æ—¶ï¼Œè®¾ç½®æ¨¡å‹ä¸º int16 æ ¼å¼ä½ç²¾åº¦è¾“å‡ºã€‚* |             |</span><br><span class="line"></span><br><span class="line">&gt; 1. *Defaultï¼ˆé»˜è®¤ï¼‰ï¼šé»˜è®¤æ ¡å‡†ç®—æ³•é€šå¸¸æ˜¯æŒ‡ä¸€ç§åŸºæœ¬çš„æ ¡å‡†æ–¹æ³•ï¼Œç”¨äºå¯¹æ¨¡å‹è¿›è¡Œæ ¡å‡†ã€‚å®ƒå¯èƒ½æ˜¯ä¸€ç§ç®€å•çš„ç»Ÿè®¡æ–¹æ³•æˆ–è§„åˆ™ï¼Œé€‚ç”¨äºå¤§å¤šæ•°æƒ…å†µä¸‹ã€‚*</span><br><span class="line">&gt; 2. *Mixï¼ˆæ··åˆï¼‰ï¼šæ··åˆæ ¡å‡†ç®—æ³•æ˜¯æŒ‡å°†å¤šç§æ ¡å‡†æ–¹æ³•ç»“åˆä½¿ç”¨çš„ç®—æ³•ã€‚å®ƒå¯ä»¥å°†ä¸åŒçš„æ ¡å‡†æŠ€æœ¯æˆ–ç­–ç•¥ç»„åˆåœ¨ä¸€èµ·ï¼Œä»¥å®ç°æ›´å¥½çš„æ ¡å‡†æ•ˆæœã€‚é€šè¿‡ä½¿ç”¨ä¸åŒçš„æ–¹æ³•æ¥æ ¡å‡†æ¨¡å‹ï¼Œå¯ä»¥æ›´å¥½åœ°é€‚åº”ä¸åŒçš„æ•°æ®åˆ†å¸ƒå’Œç‰¹æ€§ã€‚*</span><br><span class="line">&gt; 3. *KLï¼ˆKullback-Leiblerï¼‰ï¼šKLæ ¡å‡†ç®—æ³•åŸºäºKullback-Leibleræ•£åº¦ï¼Œç”¨äº**åº¦é‡ä¸¤ä¸ªæ¦‚ç‡åˆ†å¸ƒä¹‹é—´çš„å·®å¼‚**ã€‚KLæ ¡å‡†ç®—æ³•çš„ç›®æ ‡æ˜¯é€šè¿‡è°ƒæ•´æ¨¡å‹è¾“å‡ºçš„åˆ†å¸ƒï¼Œä½¿å…¶ä¸æœŸæœ›çš„æ ‡ç­¾åˆ†å¸ƒæ›´æ¥è¿‘ã€‚å®ƒé€šå¸¸ç”¨äºè§£å†³åˆ†ç±»é—®é¢˜ä¸­çš„æ ¡å‡†æŒ‘æˆ˜ï¼Œä½¿å¾—æ¨¡å‹çš„ç½®ä¿¡åº¦èƒ½å¤Ÿæ›´å¥½åœ°åæ˜ çœŸå®æ¦‚ç‡ã€‚*</span><br><span class="line">&gt; 4. *Maxï¼ˆæœ€å¤§åŒ–ï¼‰ï¼šæœ€å¤§åŒ–æ ¡å‡†ç®—æ³•æ˜¯ä¸€ç§é€šè¿‡**æœ€å¤§åŒ–æ¨¡å‹è¾“å‡ºçš„å¯¹æ•°ä¼¼ç„¶**æ¥è¿›è¡Œæ ¡å‡†çš„æ–¹æ³•ã€‚å®ƒåŸºäºç»Ÿè®¡æ–¹æ³•å’Œä¼˜åŒ–æŠ€æœ¯ï¼Œé€šè¿‡è°ƒæ•´æ¨¡å‹çš„å‚æ•°æˆ–é¢„æµ‹åˆ†æ•°ï¼Œä½¿å¾—æ¨¡å‹åœ¨è®­ç»ƒé›†ä¸Šçš„å¯¹æ•°ä¼¼ç„¶æœ€å¤§åŒ–ã€‚æœ€å¤§åŒ–æ ¡å‡†ç®—æ³•é€šå¸¸ç”¨äºæ¦‚ç‡æ¨¡å‹æˆ–ç”Ÿæˆæ¨¡å‹çš„æ ¡å‡†ï¼Œä»¥æé«˜æ¨¡å‹çš„å‡†ç¡®æ€§å’Œé²æ£’æ€§ã€‚*</span><br><span class="line">&gt; 5. *Loadï¼ˆåŠ è½½ï¼‰ï¼šåŠ è½½æ ¡å‡†ç®—æ³•æ˜¯æŒ‡ä»å¤–éƒ¨æ–‡ä»¶æˆ–æ•°æ®æºåŠ è½½æ ¡å‡†å‚æ•°æˆ–é…ç½®çš„æ–¹æ³•ã€‚æ ¡å‡†å‚æ•°å¯ä»¥æ˜¯é¢„å…ˆè®­ç»ƒå¥½çš„æƒé‡ã€åç½®ã€æ ‡å®šæ•°æ®ç­‰ä¿¡æ¯ï¼Œç”¨äºè°ƒæ•´æ¨¡å‹çš„è¾“å‡ºæˆ–é¢„æµ‹ç»“æœã€‚åŠ è½½æ ¡å‡†ç®—æ³•å¯ä»¥å¸®åŠ©å¿«é€Ÿåº”ç”¨å·²ç»è®­ç»ƒå¥½çš„æ ¡å‡†å‚æ•°ï¼Œä»¥ä¾¿åœ¨æ–°çš„æ•°æ®ä¸Šè¿›è¡Œæ ¡å‡†å’Œé¢„æµ‹ã€‚*</span><br><span class="line">&gt; 6. *Skipï¼ˆè·³è¿‡ï¼‰ï¼šè·³è¿‡æ ¡å‡†ç®—æ³•æŒ‡çš„æ˜¯åœ¨æ ¡å‡†è¿‡ç¨‹ä¸­è·³è¿‡ç‰¹å®šçš„æ•°æ®æˆ–æ­¥éª¤ã€‚è¿™ç§ç®—æ³•é€šå¸¸ç”¨äºæ ¹æ®ç‰¹å®šæ¡ä»¶æˆ–éœ€æ±‚é€‰æ‹©æ€§åœ°è·³è¿‡æ ¡å‡†è¿‡ç¨‹ä¸­çš„ä¸€äº›æ“ä½œæˆ–æ ·æœ¬ã€‚é€šè¿‡è·³è¿‡æ ¡å‡†ç®—æ³•ï¼Œå¯ä»¥åŠ å¿«æ ¡å‡†è¿‡ç¨‹æˆ–é¿å…ä¸å¿…è¦çš„è®¡ç®—å¼€é”€ã€‚*</span><br><span class="line"></span><br><span class="line">&gt; *æœ€å¤§åŒ–æ¨¡å‹è¾“å‡ºçš„å¯¹æ•°ä¼¼ç„¶æ˜¯ä¸€ç§æ ¡å‡†æ–¹æ³•ï¼Œç”¨äºè°ƒæ•´æ¨¡å‹çš„é¢„æµ‹åˆ†æ•°æˆ–æ¦‚ç‡åˆ†å¸ƒï¼Œä½¿å…¶åœ¨è®­ç»ƒé›†ä¸Šçš„å¯¹æ•°ä¼¼ç„¶æœ€å¤§åŒ–ã€‚*</span><br><span class="line">&gt;</span><br><span class="line">&gt; *åœ¨åˆ†ç±»é—®é¢˜ä¸­ï¼Œæ¨¡å‹é€šå¸¸ä¼šè¾“å‡ºä¸€ä¸ªåˆ†æ•°æˆ–æ¦‚ç‡åˆ†å¸ƒæ¥è¡¨ç¤ºæ¯ä¸ªç±»åˆ«çš„é¢„æµ‹ç½®ä¿¡åº¦ã€‚**å¯¹æ•°ä¼¼ç„¶æ˜¯ä¸€ç§è¡¡é‡æ¨¡å‹é¢„æµ‹ç»“æœä¸çœŸå®æ ‡ç­¾ä¹‹é—´çš„åŒ¹é…ç¨‹åº¦çš„æŒ‡æ ‡**ã€‚**å¯¹æ•°ä¼¼ç„¶è¶Šå¤§ï¼Œè¡¨ç¤ºæ¨¡å‹çš„é¢„æµ‹ç»“æœä¸çœŸå®æ ‡ç­¾è¶ŠåŒ¹é…ã€‚***</span><br><span class="line">&gt;</span><br><span class="line">&gt; *æœ€å¤§åŒ–æ¨¡å‹è¾“å‡ºçš„å¯¹æ•°ä¼¼ç„¶çš„è¿‡ç¨‹å¯ä»¥é€šè¿‡ä¼˜åŒ–ç®—æ³•æ¥å®ç°ã€‚å…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š*</span><br><span class="line">&gt;</span><br><span class="line">&gt; 1. *å®šä¹‰å¯¹æ•°ä¼¼ç„¶å‡½æ•°ï¼šå°†æ¨¡å‹è¾“å‡ºçš„æ¦‚ç‡åˆ†å¸ƒæˆ–åˆ†æ•°è½¬åŒ–ä¸ºå¯¹æ•°æ¦‚ç‡æˆ–å¯¹æ•°åˆ†æ•°ã€‚è¿™å¯ä»¥é€šè¿‡å¯¹é¢„æµ‹åˆ†æ•°æˆ–æ¦‚ç‡å–å¯¹æ•°æ¥å®ç°ã€‚*</span><br><span class="line">&gt; 2. *è®¡ç®—å¯¹æ•°ä¼¼ç„¶ï¼šä½¿ç”¨è®­ç»ƒé›†çš„æ ‡ç­¾å’Œæ¨¡å‹çš„å¯¹æ•°æ¦‚ç‡åˆ†å¸ƒï¼ˆæˆ–å¯¹æ•°åˆ†æ•°ï¼‰æ¥è®¡ç®—å¯¹æ•°ä¼¼ç„¶ã€‚å¯¹æ•°ä¼¼ç„¶å¯ä»¥é€šè¿‡æ¯”è¾ƒæ¨¡å‹é¢„æµ‹ç»“æœä¸çœŸå®æ ‡ç­¾çš„å·®å¼‚æ¥è¡¡é‡ã€‚*</span><br><span class="line">&gt; 3. *ä¼˜åŒ–è¿‡ç¨‹ï¼šä½¿ç”¨ä¼˜åŒ–ç®—æ³•ï¼Œä¾‹å¦‚æ¢¯åº¦ä¸‹é™ï¼Œè¿­ä»£åœ°è°ƒæ•´æ¨¡å‹çš„å‚æ•°æˆ–é¢„æµ‹åˆ†æ•°ï¼Œä»¥æœ€å¤§åŒ–å¯¹æ•°ä¼¼ç„¶ã€‚ä¼˜åŒ–è¿‡ç¨‹çš„ç›®æ ‡æ˜¯æ‰¾åˆ°æœ€ä¼˜çš„æ¨¡å‹å‚æ•°ï¼Œä½¿å¾—æ¨¡å‹åœ¨è®­ç»ƒé›†ä¸Šçš„å¯¹æ•°ä¼¼ç„¶è¾¾åˆ°æœ€å¤§å€¼ã€‚*</span><br><span class="line"></span><br><span class="line">*ğŸ› ï¸ **ç¼–è¯‘å‚æ•°ç»„***</span><br><span class="line"></span><br><span class="line">| *ç¼– å·* | *å‚æ•°åç§°*          | *å‚æ•°é…ç½®è¯´æ˜*                                               | *å¯é€‰/å¿…é€‰* |</span><br><span class="line">| :------ | :------------------ | :----------------------------------------------------------- | :---------- |</span><br><span class="line">| *1*     | *`compile_mode`*    | ***å‚æ•°ä½œç”¨**ï¼šç¼–è¯‘ç­–ç•¥é€‰æ‹©ã€‚**å–å€¼èŒƒå›´**ï¼š `latency`ã€ `bandwidth`ã€‚**é»˜è®¤é…ç½®**ï¼š `latency`ã€‚**å‚æ•°è¯´æ˜**ï¼š `latency` ä»¥ä¼˜åŒ–æ¨ç†æ—¶é—´ä¸ºç›®æ ‡ï¼›`bandwidth` ä»¥ä¼˜åŒ–ddrçš„è®¿é—®å¸¦å®½ä¸ºç›®æ ‡ã€‚å¦‚æœæ¨¡å‹æ²¡æœ‰ä¸¥é‡è¶…è¿‡é¢„æœŸçš„å¸¦å®½å ç”¨ï¼Œå»ºè®®æ‚¨ä½¿ç”¨ `latency` ç­–ç•¥ã€‚* | *å¯é€‰*      |</span><br><span class="line">| *2*     | *`debug`*           | ***å‚æ•°ä½œç”¨**ï¼šæ˜¯å¦æ‰“å¼€ç¼–è¯‘çš„debugä¿¡æ¯ã€‚**å–å€¼èŒƒå›´**ï¼š `True` ã€ `False`ã€‚**é»˜è®¤é…ç½®**ï¼š `False`ã€‚**å‚æ•°è¯´æ˜**ï¼šå¼€å¯è¯¥å‚æ•°æƒ…å†µä¸‹ï¼Œ ç¼–è¯‘åæ¨¡å‹å°†é™„å¸¦ä¸€äº›è°ƒè¯•ä¿¡æ¯ï¼Œ ç”¨äºæ”¯æŒåç»­çš„è°ƒä¼˜åˆ†æè¿‡ç¨‹ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå»ºè®®æ‚¨ä¿æŒè¯¥å‚æ•°å…³é—­ã€‚* | *å¯é€‰*      |</span><br><span class="line">| *3*     | *`core_num`*        | ***å‚æ•°ä½œç”¨**ï¼šæ¨¡å‹è¿è¡Œæ ¸å¿ƒæ•°ã€‚**å–å€¼èŒƒå›´**ï¼š `1`ã€ `2`ã€‚**é»˜è®¤é…ç½®**ï¼š `1`ã€‚**å‚æ•°è¯´æ˜**ï¼šåœ°å¹³çº¿å¹³å°æ”¯æŒåˆ©ç”¨å¤šä¸ªAIåŠ é€Ÿå™¨æ ¸å¿ƒåŒæ—¶å®Œæˆä¸€ä¸ªæ¨ç†ä»»åŠ¡ï¼Œå¤šæ ¸å¿ƒé€‚ç”¨äºè¾“å…¥å°ºå¯¸è¾ƒå¤§çš„æƒ…å†µï¼Œ ç†æƒ³çŠ¶æ€ä¸‹çš„åŒæ ¸é€Ÿåº¦å¯ä»¥è¾¾åˆ°å•æ ¸çš„1.5å€å·¦å³ã€‚å¦‚æœæ‚¨çš„æ¨¡å‹è¾“å…¥å°ºå¯¸è¾ƒå¤§ï¼Œå¯¹äºæ¨¡å‹é€Ÿåº¦æœ‰æè‡´è¿½æ±‚ï¼Œ å¯ä»¥é…ç½® `core_num=2`ã€‚**è¯¥é€‰é¡¹åœ¨J5ä¸Šå°šä¸æ”¯æŒ, è¯·å‹¿é…ç½®!*** | *å¯é€‰*      |</span><br><span class="line">| *4*     | *`optimize_level`*  | ***å‚æ•°ä½œç”¨**ï¼šæ¨¡å‹ç¼–è¯‘çš„ä¼˜åŒ–ç­‰çº§é€‰æ‹©ã€‚**å–å€¼èŒƒå›´**ï¼š `O0` ã€ `O1` ã€ `O2` ã€ `O3`ã€‚**é»˜è®¤é…ç½®**ï¼š`O0`ã€‚**å‚æ•°è¯´æ˜**ï¼šä¼˜åŒ–ç­‰çº§å¯é€‰èŒƒå›´ä¸º `O0` ~ `O3`ã€‚`O0` ä¸åšä»»ä½•ä¼˜åŒ–, ç¼–è¯‘é€Ÿåº¦æœ€å¿«ï¼Œä¼˜åŒ–ç¨‹åº¦æœ€ä½ã€‚`O1` - `O3` éšç€ä¼˜åŒ–ç­‰çº§æé«˜ï¼Œ é¢„æœŸç¼–è¯‘åçš„æ¨¡å‹çš„æ‰§è¡Œé€Ÿåº¦ä¼šæ›´å¿«ï¼Œ ä½†æ˜¯æ‰€éœ€ç¼–è¯‘æ—¶é—´ä¹Ÿä¼šå˜é•¿ã€‚æ­£å¸¸ç”¨äºç”Ÿäº§å’ŒéªŒè¯æ€§èƒ½çš„æ¨¡å‹ï¼Œ å¿…é¡»ä½¿ç”¨ `O3` çº§åˆ«ä¼˜åŒ–æ‰èƒ½ä¿è¯å¾—åˆ°æœ€ä¼˜æ€§èƒ½ã€‚æŸäº›æµç¨‹éªŒè¯æˆ–ç²¾åº¦è°ƒè¯•è¿‡ç¨‹ä¸­ï¼Œ å¯ä»¥å°è¯•ä½¿ç”¨æ›´ä½çº§åˆ«ä¼˜åŒ–åŠ å¿«è¿‡ç¨‹é€Ÿåº¦ã€‚* | *å¯é€‰*      |</span><br><span class="line">| *5*     | *`input_source`*    | ***å‚æ•°ä½œç”¨**ï¼šè®¾ç½®ä¸Šæ¿binæ¨¡å‹çš„è¾“å…¥æ•°æ®æ¥æºã€‚**å–å€¼èŒƒå›´**ï¼š `ddr`, `pyramid`, `resizer`ã€‚**é»˜è®¤é…ç½®**ï¼š æ— ï¼Œé»˜è®¤ä¼šæ ¹æ®input_type_rtçš„å€¼ä»å¯é€‰èŒƒå›´ä¸­è‡ªåŠ¨é€‰æ‹©ã€‚**å‚æ•°è¯´æ˜**ï¼šè¿™ä¸ªå‚æ•°æ˜¯é€‚é…å·¥ç¨‹ç¯å¢ƒçš„é€‰é¡¹ï¼Œ å»ºè®®æ‚¨å·²ç»å…¨éƒ¨å®Œæˆæ¨¡å‹æ£€æŸ¥åå†é…ç½®ã€‚`ddr` è¡¨ç¤ºæ•°æ®æ¥è‡ªå†…å­˜ï¼Œ`pyramid` å’Œ `resizer` è¡¨ç¤ºæ¥è‡ªèŠ¯ç‰‡ä¸Šçš„å›ºå®šç¡¬ä»¶ã€‚å…·ä½“åœ¨å·¥ç¨‹ç¯å¢ƒä¸­å¦‚ä½•é€‚é… `pyramid` å’Œ `resizer` æ•°æ®æºï¼Œ è¯·æ‚¨å‚è€ƒ [BPU SDK API æ‰‹å†Œ](https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/runtime/source/bpu_sdk_api/source/index.html)ã€‚æ­¤å‚æ•°é…ç½®æœ‰äº›ç‰¹æ®Šï¼Œä¾‹å¦‚æ¨¡å‹è¾“å…¥åç§°ä¸º data, æ•°æ®æºä¸ºå†…å­˜(ddr), åˆ™æ­¤å¤„åº”è¯¥é…ç½®å€¼ä¸º `&#123;&quot;data&quot;: &quot;ddr&quot;&#125;`ã€‚* | *å¯é€‰*      |</span><br><span class="line">| *6*     | *`max_time_per_fc`* | ***å‚æ•°ä½œç”¨**ï¼šæŒ‡å®šæ¨¡å‹çš„æ¯ä¸ªfunction callçš„æœ€å¤§å¯è¿ç»­æ‰§è¡Œæ—¶é—´(å•ä½Î¼s)ã€‚**å–å€¼èŒƒå›´**ï¼š`0æˆ–1000-4294967295`ã€‚**é»˜è®¤é…ç½®**ï¼š`0`ã€‚**å‚æ•°è¯´æ˜**ï¼šç¼–è¯‘åçš„æ•°æ®æŒ‡ä»¤æ¨¡å‹åœ¨BPUä¸Šè¿›è¡Œæ¨ç†è®¡ç®—æ—¶ï¼Œ å®ƒå°†è¡¨ç°ä¸º1ä¸ªæˆ–è€…å¤šä¸ªfunction-callï¼ˆBPUçš„æ‰§è¡Œç²’åº¦ï¼‰çš„è°ƒç”¨ã€‚ å–å€¼ä¸º0ä»£è¡¨ä¸åšé™åˆ¶ã€‚**è¯¥å‚æ•°ç”¨æ¥é™åˆ¶æ¯ä¸ªfunction-callæœ€å¤§çš„æ‰§è¡Œæ—¶é—´, æ¨¡å‹åªæœ‰åœ¨å•ä¸ªfunction-callæ‰§è¡Œå®Œæ—¶æ‰æœ‰æœºä¼šè¢«æŠ¢å ã€‚**è¯¦æƒ…å‚è§ [æ¨¡å‹ä¼˜å…ˆçº§æ§åˆ¶](https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/runtime/source/runtime_dev.html#preemption) éƒ¨åˆ†çš„ä»‹ç»ã€‚æ³¨æ„ï¼šæ­¤å‚æ•°ä»…ç”¨äºå®ç°æ¨¡å‹æŠ¢å åŠŸèƒ½ï¼Œå¦‚æ— éœ€å®ç°è¯¥åŠŸèƒ½åˆ™å¯ä»¥å¿½ç•¥ã€‚**æ¨¡å‹æŠ¢å åŠŸèƒ½ä»…æ”¯æŒåœ¨æ¿ç«¯å®ç°ï¼Œä¸æ”¯æŒæ¨¡æ‹Ÿå™¨å®ç°ã€‚*** | *å¯é€‰*      |</span><br><span class="line">| *7*     | *`jobs`*            | ***å‚æ•°ä½œç”¨**ï¼šè®¾ç½®ç¼–è¯‘binæ¨¡å‹æ—¶çš„è¿›ç¨‹æ•°ã€‚**å–å€¼èŒƒå›´**ï¼š`æœºå™¨æ”¯æŒçš„æœ€å¤§æ ¸å¿ƒæ•°èŒƒå›´å†…`ã€‚**é»˜è®¤é…ç½®**ï¼šæ— ã€‚**å‚æ•°è¯´æ˜**ï¼šåœ¨ç¼–è¯‘binæ¨¡å‹æ—¶ï¼Œç”¨äºè®¾ç½®è¿›ç¨‹æ•°ã€‚ ä¸€å®šç¨‹åº¦ä¸Šå¯æé«˜ç¼–è¯‘é€Ÿåº¦ã€‚* | *å¯é€‰*      |</span><br><span class="line"></span><br><span class="line">&gt; *æ¨¡å‹æŠ¢å åŠŸèƒ½æŒ‡çš„æ˜¯åœ¨æ·±åº¦å­¦ä¹ æ¨ç†è¿‡ç¨‹ä¸­ï¼Œå½“æ–°çš„ä»»åŠ¡æˆ–è¯·æ±‚åˆ°è¾¾æ—¶ï¼Œç³»ç»Ÿå¯ä»¥ä¸­æ–­å½“å‰æ­£åœ¨è¿›è¡Œçš„æ¨ç†ä»»åŠ¡ï¼Œå¹¶ç«‹å³åˆ‡æ¢åˆ°å¤„ç†æ–°ä»»åŠ¡ã€‚è¿™ç§åŠŸèƒ½å¯ä»¥åœ¨å…·å¤‡å¹¶å‘å¤„ç†èƒ½åŠ›çš„ç³»ç»Ÿä¸­å®ç°ï¼Œä»¥æé«˜ç³»ç»Ÿçš„èµ„æºåˆ©ç”¨ç‡å’Œå®æ—¶æ€§èƒ½ã€‚*</span><br><span class="line"></span><br><span class="line">*ğŸ› ï¸ **è‡ªå®šä¹‰ç®—å­å‚æ•°ç»„***</span><br><span class="line"></span><br><span class="line">| *ç¼– å·* | *å‚æ•°åç§°*            | *å‚æ•°é…ç½®è¯´æ˜*                                               | *å¯é€‰/å¿…é€‰* |</span><br><span class="line">| :------ | :-------------------- | :----------------------------------------------------------- | :---------- |</span><br><span class="line">| *1*     | *`custom_op_method`*  | ***å‚æ•°ä½œç”¨**ï¼šè‡ªå®šä¹‰ç®—å­ç­–ç•¥é€‰æ‹©ã€‚**å–å€¼èŒƒå›´**ï¼š`register`ã€‚**é»˜è®¤é…ç½®**ï¼šæ— ã€‚**å‚æ•°è¯´æ˜**ï¼šç›®å‰ä»…æ”¯æŒregisterç­–ç•¥ï¼Œå…·ä½“ä½¿ç”¨è¯·å‚è€ƒ [è‡ªå®šä¹‰ç®—å­å¼€å‘](https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/ptq/ptq_usage/custom_op.html)ã€‚* | *å¯é€‰*      |</span><br><span class="line">| *2*     | *`op_register_files`* | ***å‚æ•°ä½œç”¨**ï¼šè‡ªå®šä¹‰ç®—å­çš„Pythonå®ç°æ–‡ä»¶åç§°ã€‚**å–å€¼èŒƒå›´**ï¼šæ— ã€‚**é»˜è®¤é…ç½®**ï¼šæ— ã€‚**å‚æ•°è¯´æ˜**ï¼šå¤šä¸ªæ–‡ä»¶å¯ç”¨ `;` åˆ†éš”ï¼Œç®—å­å¦‚ä½•å®ç°è¯·å‚è€ƒ [è‡ªå®šä¹‰ç®—å­å¼€å‘](https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/ptq/ptq_usage/custom_op.html)ã€‚* | *å¯é€‰*      |</span><br><span class="line">| *3*     | *`custom_op_dir`*     | ***å‚æ•°ä½œç”¨**ï¼šè‡ªå®šä¹‰ç®—å­çš„Pythonå®ç°æ–‡ä»¶å­˜æ”¾è·¯å¾„ã€‚**å–å€¼èŒƒå›´**ï¼šæ— ã€‚**é»˜è®¤é…ç½®**ï¼šæ— ã€‚**å‚æ•°è¯´æ˜**ï¼šè®¾ç½®è·¯å¾„æ—¶ï¼Œè¯·ä½¿ç”¨ç›¸å¯¹è·¯å¾„ã€‚* | *å¯é€‰*      |</span><br><span class="line"></span><br><span class="line">***è½¬æ¢å†…éƒ¨è¿‡ç¨‹è§£è¯»***</span><br><span class="line"></span><br><span class="line">*æ¨¡å‹è½¬æ¢å®Œæˆæµ®ç‚¹æ¨¡å‹åˆ°åœ°å¹³çº¿æ··åˆå¼‚æ„æ¨¡å‹çš„è½¬æ¢ã€‚ ä¸ºäº†ä½¿å¾—è¿™ä¸ªå¼‚æ„æ¨¡å‹èƒ½å¿«é€Ÿé«˜æ•ˆåœ°åœ¨åµŒå…¥å¼ç«¯è¿è¡Œï¼Œ æ¨¡å‹è½¬æ¢é‡ç‚¹åœ¨è§£å†³ **è¾“å…¥æ•°æ®å¤„ç†** å’Œ **æ¨¡å‹ä¼˜åŒ–ç¼–è¯‘** ä¸¤ä¸ªé—®é¢˜ï¼Œæœ¬èŠ‚ä¼šä¾æ¬¡å›´ç»•è¿™ä¸¤ä¸ªé‡ç‚¹é—®é¢˜å±•å¼€ã€‚*</span><br><span class="line"></span><br><span class="line">***è¾“å…¥æ•°æ®å¤„ç†** æ–¹é¢åœ°å¹³çº¿çš„è¾¹ç¼˜AIè®¡ç®—å¹³å°ä¼šä¸ºæŸäº›ç‰¹å®šç±»å‹çš„è¾“å…¥é€šè·¯æä¾›ç¡¬ä»¶çº§çš„æ”¯æ’‘æ–¹æ¡ˆï¼Œ ä½†æ˜¯è¿™äº›æ–¹æ¡ˆçš„è¾“å‡ºä¸ä¸€å®šç¬¦åˆæ¨¡å‹è¾“å…¥çš„è¦æ±‚ã€‚ ä¾‹å¦‚è§†é¢‘é€šè·¯æ–¹é¢å°±æœ‰è§†é¢‘å¤„ç†å­ç³»ç»Ÿï¼Œä¸ºé‡‡é›†æä¾›å›¾åƒè£å‰ªã€ç¼©æ”¾å’Œå…¶ä»–å›¾åƒè´¨é‡ä¼˜åŒ–åŠŸèƒ½ï¼Œè¿™äº›å­ç³»ç»Ÿçš„è¾“å‡ºå¾€å¾€æ˜¯yuv420æ ¼å¼å›¾åƒï¼Œ è€Œæˆ‘ä»¬çš„ç®—æ³•æ¨¡å‹å¾€å¾€æ˜¯åŸºäºbgr/rgbç­‰ä¸€èˆ¬å¸¸ç”¨å›¾åƒæ ¼å¼è®­ç»ƒå¾—åˆ°çš„ã€‚ åœ°å¹³çº¿é’ˆå¯¹æ­¤ç§æƒ…å†µæä¾›çš„å›ºå®šè§£å†³æ–¹æ¡ˆæ˜¯ï¼Œæ¯ä¸ªè½¬æ¢æ¨¡å‹éƒ½æä¾›ä¸¤ä»½è¾“å…¥ä¿¡æ¯æè¿°ï¼Œ ä¸€ä»½ç”¨äºæè¿°åŸå§‹æµ®ç‚¹æ¨¡å‹è¾“å…¥ï¼ˆ `input_type_train` å’Œ `input_layout_train`ï¼‰ï¼Œ å¦ä¸€ä»½åˆ™ç”¨äºæè¿°æˆ‘ä»¬éœ€è¦å¯¹æ¥çš„è¾¹ç¼˜å¹³å°è¾“å…¥æ•°æ®ï¼ˆ `input_type_rt` å’Œ `input_layout_rt`ï¼‰ã€‚*</span><br><span class="line"></span><br><span class="line">*å›¾åƒæ•°æ®çš„mean/scaleä¹Ÿæ˜¯æ¯”è¾ƒå¸¸è§çš„æ“ä½œï¼Œæ˜¾ç„¶yuv420ç­‰è¾¹ç¼˜å¹³å°æ•°æ®æ ¼å¼ä¸å†é€‚åˆåšè¿™æ ·çš„æ“ä½œï¼Œ å› æ­¤ï¼Œæˆ‘ä»¬ä¹Ÿå°†è¿™äº›å¸¸è§å›¾åƒå‰å¤„ç†å›ºåŒ–åˆ°äº†æ¨¡å‹ä¸­ã€‚ ç»è¿‡ä»¥ä¸Šä¸¤ç§å¤„ç†åï¼Œè½¬æ¢äº§å‡ºçš„å¼‚æ„æ¨¡å‹çš„è¾“å…¥éƒ¨åˆ†å°†å˜æˆå¦‚ä¸‹å›¾çŠ¶æ€ã€‚*</span><br><span class="line"></span><br><span class="line">*![image-20230509104049706](J5/image-20230509104049706.png)*</span><br><span class="line"></span><br><span class="line">*ä¸Šå›¾ä¸­çš„æ•°æ®æ’å¸ƒå°±åªæœ‰NCHWå’ŒNHWCä¸¤ç§æ•°æ®æ’å¸ƒæ ¼å¼ï¼ŒNä»£è¡¨æ•°é‡ã€Cä»£è¡¨channelã€Hä»£è¡¨é«˜åº¦ã€Wä»£è¡¨å®½åº¦ï¼Œ ä¸¤ç§ä¸åŒçš„æ’å¸ƒä½“ç°çš„æ˜¯ä¸åŒçš„å†…å­˜è®¿é—®ç‰¹æ€§ã€‚åœ¨TensorFlowæ¨¡å‹NHWCè¾ƒå¸¸ç”¨ï¼ŒCaffeä¸­å°±éƒ½ä½¿ç”¨NCHWï¼Œ åœ°å¹³çº¿å¹³å°ä¸ä¼šé™åˆ¶ä½¿ç”¨çš„æ•°æ®æ’å¸ƒï¼Œä½†æ˜¯æœ‰ä¸¤æ¡è¦æ±‚ï¼šç¬¬ä¸€æ˜¯ `input_layout_train` å¿…é¡»ä¸åŸå§‹æ¨¡å‹çš„æ•°æ®æ’å¸ƒä¸€è‡´ï¼› ç¬¬äºŒæ˜¯åœ¨è¾¹ç¼˜AIå¹³å°å‡†å¤‡å¥½ä¸ `input_layout_rt` ä¸€è‡´æ’å¸ƒçš„æ•°æ®ï¼Œæ­£ç¡®çš„æ•°æ®æ’å¸ƒæŒ‡å®šæ˜¯é¡ºåˆ©è§£ææ•°æ®çš„åŸºç¡€ã€‚*</span><br><span class="line"></span><br><span class="line">*å·¥å…·ä¼šæ ¹æ® `input_type_rt` å’Œ `input_type_train` æŒ‡å®šçš„æ•°æ®æ ¼å¼è‡ªåŠ¨æ·»åŠ æ•°æ®è½¬æ¢èŠ‚ç‚¹ï¼Œæ ¹æ®åœ°å¹³çº¿çš„å®é™…ç”Ÿäº§ç»éªŒï¼Œ å¹¶ä¸æ˜¯ä»»æ„typeç»„åˆéƒ½æ˜¯éœ€è¦çš„ï¼Œä¸ºäº†é¿å…æ‚¨è¯¯ç”¨ï¼Œæˆ‘ä»¬åªå¼€æ”¾äº†ä¸€äº›å›ºå®šçš„typeç»„åˆå¦‚ä¸‹è¡¨ã€‚*</span><br><span class="line"></span><br><span class="line">| *`input_type_train` \ `input_type_rt`* | *nv12* | *yuv444* | *rgb* | *bgr* | *gray* | *featuremap* |</span><br><span class="line">| -------------------------------------- | ------ | -------- | ----- | ----- | ------ | ------------ |</span><br><span class="line">| *yuv444*                               | *Y*    | *Y*      | *N*   | *N*   | *N*    | *N*          |</span><br><span class="line">| *rgb*                                  | *Y*    | *Y*      | *Y*   | *Y*   | *N*    | *N*          |</span><br><span class="line">| *bgr*                                  | *Y*    | *Y*      | *Y*   | *Y*   | *N*    | *N*          |</span><br><span class="line">| *gray*                                 | *N*    | *N*      | *N*   | *N*   | *Y*    | *N*          |</span><br><span class="line">| *featuremap*                           | *N*    | *N*      | *N*   | *N*   | *N*    | *Y*          |</span><br><span class="line"></span><br><span class="line">*è¡¨æ ¼ä¸­ç¬¬ä¸€è¡Œæ˜¯ `input_type_rt` ä¸­æ”¯æŒçš„ç±»å‹ï¼Œç¬¬ä¸€åˆ—æ˜¯ `input_type_train` æ”¯æŒçš„ç±»å‹ï¼Œ å…¶ä¸­çš„ **Y/N** è¡¨ç¤ºæ˜¯å¦æ”¯æŒç›¸åº”çš„ `input_type_rt` åˆ° `input_type_train` çš„è½¬æ¢ã€‚ **åœ¨è½¬æ¢å¾—åˆ°çš„æœ€ç»ˆäº§å‡ºbinæ¨¡å‹ä¸­ï¼Œ `input_type_rt` åˆ° `input_type_train` æ˜¯ä¸€ä¸ªå†…éƒ¨çš„è¿‡ç¨‹ï¼Œ æ‚¨åªéœ€è¦å…³æ³¨ `input_type_rt` çš„æ•°æ®æ ¼å¼å³å¯**ã€‚ **æ­£ç¡®ç†è§£æ¯ç§** `input_type_rt` **çš„è¦æ±‚ï¼Œå¯¹äºåµŒå…¥å¼åº”ç”¨å‡†å¤‡æ¨ç†æ•°æ®å¾ˆé‡è¦ï¼Œä»¥ä¸‹æ˜¯å¯¹** `input_type_rt` **æ¯ç§æ ¼å¼çš„è¯´æ˜ï¼š***</span><br><span class="line"></span><br><span class="line">- *rgbã€bgrå’Œgrayéƒ½æ˜¯æ¯”è¾ƒå¸¸è§çš„å›¾åƒæ•°æ®ï¼Œæ³¨æ„æ¯ä¸ªæ•°å€¼éƒ½é‡‡ç”¨UINT8è¡¨ç¤ºã€‚*</span><br><span class="line">- *yuv444æ˜¯ä¸€ç§å¸¸è§çš„å›¾åƒæ ¼å¼ï¼Œæ³¨æ„æ¯ä¸ªæ•°å€¼éƒ½é‡‡ç”¨UINT8è¡¨ç¤ºã€‚*</span><br><span class="line">- *nv12æ˜¯å¸¸è§çš„yuv420å›¾åƒæ•°æ®ï¼Œæ¯ä¸ªæ•°å€¼éƒ½é‡‡ç”¨UINT8è¡¨ç¤ºã€‚*</span><br><span class="line">- *nv12æœ‰ä¸ªæ¯”è¾ƒç‰¹åˆ«çš„æƒ…å†µæ˜¯ `input_space_and_range` è®¾ç½® `bt601_video` ï¼ˆå‚è€ƒå‰æ–‡å¯¹ `input_space_and_range` å‚æ•°çš„ä»‹ç»ï¼‰ï¼Œè¾ƒäºå¸¸è§„nv12æƒ…å†µï¼Œå®ƒçš„æ•°å€¼èŒƒå›´ç”±[0,255]å˜æˆäº†[16,235]ï¼Œ æ¯ä¸ªæ•°å€¼ä»ç„¶é‡‡ç”¨UINT8è¡¨ç¤ºã€‚*</span><br><span class="line">- *featuremapé€‚ç”¨äºä»¥ä¸Šåˆ—ä¸¾æ ¼å¼ä¸æ»¡è¶³æ‚¨éœ€æ±‚çš„æƒ…å†µï¼Œæ­¤typeæ¯ä¸ªæ•°å€¼é‡‡ç”¨float32è¡¨ç¤ºã€‚ ä¾‹å¦‚é›·è¾¾å’Œè¯­éŸ³ç­‰æ¨¡å‹å¤„ç†å°±å¸¸ç”¨è¿™ä¸ªæ ¼å¼ã€‚*</span><br><span class="line"></span><br><span class="line">***æ³¨æ„ï¼š***</span><br><span class="line"></span><br><span class="line">- *ä»¥ä¸Š `input_type_rt` ä¸ `input_type_train` æ˜¯å›ºåŒ–åœ¨å·¥å…·é“¾çš„å¤„ç†æµç¨‹ä¸­ï¼Œå¦‚æœæ‚¨éå¸¸ç¡®å®šä¸éœ€è¦è½¬æ¢ï¼Œ å°†ä¸¤ä¸ª `input_type` è®¾ç½®æˆä¸€æ ·å°±å¯ä»¥äº†ï¼Œä¸€æ ·çš„ `input_type` ä¼šåšç›´é€šå¤„ç†ï¼Œä¸ä¼šå½±å“æ¨¡å‹çš„å®é™…æ‰§è¡Œæ€§èƒ½ã€‚*</span><br><span class="line"></span><br><span class="line">- *åŒæ ·çš„ï¼Œæ•°æ®å‰å¤„ç†ä¹Ÿæ˜¯å›ºåŒ–åœ¨æµç¨‹ä¸­ï¼Œå¦‚æœæ‚¨ä¸éœ€è¦åšä»»ä½•å‰å¤„ç†ï¼Œé€šè¿‡ `norm_type` é…ç½®å…³é—­è¿™ä¸ªåŠŸèƒ½å³å¯ï¼Œä¸ä¼šå½±å“æ¨¡å‹çš„å®é™…æ‰§è¡Œæ€§èƒ½ã€‚*</span><br><span class="line"></span><br><span class="line">***æ¨¡å‹ä¼˜åŒ–ç¼–è¯‘** æ–¹é¢å®Œæˆäº†æ¨¡å‹è§£æã€æ¨¡å‹ä¼˜åŒ–ã€æ¨¡å‹æ ¡å‡†ä¸é‡åŒ–ã€æ¨¡å‹ç¼–è¯‘å‡ ä¸ªé‡è¦é˜¶æ®µï¼Œå…¶å†…éƒ¨å·¥ä½œè¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚*</span><br><span class="line"></span><br><span class="line">*![image-20230509105524772](J5/image-20230509105524772.png)*</span><br><span class="line"></span><br><span class="line">***æ¨¡å‹è§£æé˜¶æ®µ** å¯¹äºCaffeæµ®ç‚¹æ¨¡å‹ä¼šå®Œæˆåˆ°ONNXæµ®ç‚¹æ¨¡å‹çš„è½¬æ¢ã€‚ åœ¨åŸå§‹æµ®ç‚¹æ¨¡å‹ä¸Šä¼šæ ¹æ®è½¬æ¢é…ç½®ä¸­çš„é…ç½®å‚æ•°å†³å®šæ˜¯å¦åŠ å…¥æ•°æ®é¢„å¤„ç†èŠ‚ç‚¹ï¼Œæ­¤é˜¶æ®µäº§å‡ºä¸€ä¸ªoriginal_float_model.onnxã€‚ è¿™ä¸ªONNXæ¨¡å‹è®¡ç®—ç²¾åº¦ä»ç„¶æ˜¯float32ï¼Œåœ¨è¾“å…¥éƒ¨åˆ†åŠ å…¥äº†ä¸€ä¸ªæ•°æ®é¢„å¤„ç†èŠ‚ç‚¹ã€‚*</span><br><span class="line"></span><br><span class="line">*ç†æƒ³çŠ¶æ€ä¸‹ï¼Œè¿™ä¸ªé¢„å¤„ç†èŠ‚ç‚¹åº”è¯¥å®Œæˆ `input_type_rt` åˆ° `input_type_train` çš„å®Œæ•´è½¬æ¢ï¼Œ å®é™…æƒ…å†µæ˜¯æ•´ä¸ªtypeè½¬æ¢è¿‡ç¨‹ä¼šé…åˆåœ°å¹³çº¿èŠ¯ç‰‡ç¡¬ä»¶å®Œæˆï¼Œ**ONNXæ¨¡å‹é‡Œé¢å¹¶æ²¡æœ‰åŒ…å«ç¡¬ä»¶è½¬æ¢çš„éƒ¨åˆ†**ã€‚ **å› æ­¤ONNXçš„çœŸå®è¾“å…¥ç±»å‹ä¼šä½¿ç”¨ä¸€ç§ä¸­é—´ç±»å‹ï¼Œè¿™ç§ä¸­é—´ç±»å‹å°±æ˜¯ç¡¬ä»¶å¯¹ `input_type_rt` çš„å¤„ç†ç»“æœç±»å‹**ï¼Œ æ•°æ®layout(NCHW/NHWC)ä¼šä¿æŒåŸå§‹æµ®ç‚¹æ¨¡å‹çš„è¾“å…¥layoutä¸€è‡´ã€‚ æ¯ç§ `input_type_rt` éƒ½æœ‰ç‰¹å®šçš„å¯¹åº”ä¸­é—´ç±»å‹ï¼Œå¦‚ä¸‹è¡¨ï¼š*</span><br><span class="line"></span><br><span class="line">| ***nv12***   | ***yuv444*** | ***rgb*** | ***bgr*** | ***gray*** | *featuremap* |</span><br><span class="line">| ------------ | ------------ | --------- | --------- | ---------- | ------------ |</span><br><span class="line">| *yuv444_128* | *yuv444_128* | *RGB_128* | *BGR_128* | *GRAY_128* | *featuremap* |</span><br><span class="line"></span><br><span class="line">*æ³¨è§£*</span><br><span class="line"></span><br><span class="line">*è¡¨æ ¼ä¸­ç¬¬ä¸€è¡ŒåŠ ç²—éƒ¨åˆ†æ˜¯ `input_type_rt` æŒ‡å®šçš„æ•°æ®ç±»å‹ï¼Œç¬¬äºŒè¡Œæ˜¯ç‰¹å®š `input_type_rt` å¯¹åº”çš„ä¸­é—´ç±»å‹ï¼Œ è¿™ä¸ªä¸­é—´ç±»å‹å°±æ˜¯original_float_model.onnxçš„è¾“å…¥ç±»å‹ã€‚æ¯ä¸ªç±»å‹è§£é‡Šå¦‚ä¸‹ï¼š*</span><br><span class="line"></span><br><span class="line">- *yuv444_128 æ˜¯yuv444æ•°æ®å‡å»128ç»“æœï¼Œæ¯ä¸ªæ•°å€¼é‡‡ç”¨int8è¡¨ç¤ºã€‚*</span><br><span class="line">- *RGB_128 æ˜¯RGBæ•°æ®å‡å»128çš„ç»“æœï¼Œæ¯ä¸ªæ•°å€¼é‡‡ç”¨int8è¡¨ç¤ºã€‚*</span><br><span class="line">- *BGR_128 æ˜¯BGRæ•°æ®å‡å»128çš„ç»“æœï¼Œæ¯ä¸ªæ•°å€¼é‡‡ç”¨int8è¡¨ç¤ºã€‚*</span><br><span class="line">- *GRAY_128 æ˜¯grayæ•°æ®å‡å»128çš„ç»“æœï¼Œæ¯ä¸ªæ•°å€¼é‡‡ç”¨int8è¡¨ç¤ºã€‚*</span><br><span class="line">- *featuremap æ˜¯ä¸€ä¸ªå››ç»´å¼ é‡æ•°æ®ï¼Œæ¯ä¸ªæ•°å€¼é‡‡ç”¨float32è¡¨ç¤ºã€‚*</span><br><span class="line"></span><br><span class="line">***æ¨¡å‹ä¼˜åŒ–é˜¶æ®µ** å®ç°æ¨¡å‹çš„ä¸€äº›é€‚ç”¨äºåœ°å¹³çº¿å¹³å°çš„ç®—å­ä¼˜åŒ–ç­–ç•¥ï¼Œä¾‹å¦‚BNèåˆåˆ°Convç­‰ã€‚ æ­¤é˜¶æ®µçš„äº§å‡ºæ˜¯ä¸€ä¸ªoptimized_float_model.onnxï¼Œè¿™ä¸ªONNXæ¨¡å‹çš„è®¡ç®—ç²¾åº¦ä»ç„¶æ˜¯float32ï¼Œç»è¿‡ä¼˜åŒ–åä¸ä¼šå½±å“æ¨¡å‹çš„è®¡ç®—ç»“æœã€‚ æ¨¡å‹çš„è¾“å…¥æ•°æ®è¦æ±‚è¿˜æ˜¯ä¸å‰é¢çš„original_float_modelä¸€è‡´ã€‚*</span><br><span class="line"></span><br><span class="line">***æ¨¡å‹æ ¡å‡†é˜¶æ®µ** ä¼šä½¿ç”¨æ‚¨æä¾›çš„æ ¡å‡†æ•°æ®æ¥è®¡ç®—å¿…è¦çš„é‡åŒ–å‚æ•°ï¼Œé€šè¿‡æ ¡å‡†æ•°æ®è®¡ç®—å¾—åˆ°çš„æ¯ä¸ªèŠ‚ç‚¹å¯¹åº”çš„é‡åŒ–å‚æ•°å¹¶å°†å…¶ä¿å­˜åœ¨æ ¡å‡†èŠ‚ç‚¹ä¸­ï¼Œæ­¤é˜¶æ®µçš„äº§å‡ºæ˜¯calibrated_model.onnxã€‚*</span><br><span class="line"></span><br><span class="line">***æ¨¡å‹é‡åŒ–é˜¶æ®µ** ä½¿ç”¨æ ¡å‡†å¾—åˆ°çš„å‚æ•°å®Œæˆæ¨¡å‹é‡åŒ–ï¼Œæ­¤é˜¶æ®µçš„äº§å‡ºæ˜¯ä¸€ä¸ªquantized_model.onnxã€‚ è¿™ä¸ªæ¨¡å‹çš„è®¡ç®—ç²¾åº¦å·²ç»æ˜¯int8ï¼Œä½¿ç”¨è¿™ä¸ªæ¨¡å‹å¯ä»¥è¯„ä¼°åˆ°æ¨¡å‹é‡åŒ–å¸¦æ¥çš„ç²¾åº¦æŸå¤±æƒ…å†µã€‚ è¿™ä¸ªæ¨¡å‹è¦æ±‚è¾“å…¥çš„åŸºæœ¬æ•°æ®æ ¼å¼å’Œlayoutä»ç„¶ä¸ `original_float_model` ä¸€æ ·ï¼Œä¸è¿‡å–å€¼èŒƒå›´å·²ç»å‘ç”Ÿäº†å˜åŒ–ï¼Œ æ•´ä½“è¾ƒäº `original_float_model` è¾“å…¥çš„å˜åŒ–æƒ…å†µæè¿°å¦‚ä¸‹ï¼š*</span><br><span class="line"></span><br><span class="line">- *å½“ `input_type_rt` çš„å–å€¼ä¸ºé `featuremap` æ—¶ï¼Œåˆ™è¾“å…¥çš„æ•°æ®ç±»å‹å‡ä½¿ç”¨INT8ï¼Œ åä¹‹ï¼Œ å½“ `input_type_rt` å–å€¼ä¸º `featuremap` æ—¶ï¼Œåˆ™è¾“å…¥çš„æ•°æ®ç±»å‹åˆ™ä¸ºfloat32ã€‚*</span><br><span class="line"></span><br><span class="line">*æ•°æ®æ’å¸ƒlayoutå…³ç³»å¯¹åº”å¦‚ä¸‹ä¾‹ï¼š*</span><br><span class="line"></span><br><span class="line">- *åŸæ¨¡å‹è¾“å…¥layoutï¼šNCHWã€‚*</span><br><span class="line">- *input_layout_trainï¼š NCHWã€‚*</span><br><span class="line">- *origin.onnxè¾“å…¥layoutï¼šNCHWã€‚*</span><br><span class="line">- *calibrated_model.onnxè¾“å…¥layoutï¼šNCHWã€‚*</span><br><span class="line">- *quanti.onnxè¾“å…¥layoutï¼šNCHWã€‚*</span><br><span class="line"></span><br><span class="line">*å³ï¼šinput_layout_trainã€origin.onnxã€calibrated_model.onnxã€quanti.onnxè¾“å…¥çš„layoutä¸åŸæ¨¡å‹è¾“å…¥çš„layoutä¸€è‡´ã€‚*</span><br><span class="line"></span><br><span class="line">***æ³¨æ„ï¼šå¦‚æœinput_type_rtä¸ºnv12æ—¶ï¼Œå¯¹åº”quanti.onnxçš„è¾“å…¥layoutéƒ½æ˜¯NHWCã€‚***</span><br><span class="line"></span><br><span class="line">***æ¨¡å‹ç¼–è¯‘é˜¶æ®µ** ä¼šä½¿ç”¨åœ°å¹³çº¿æ¨¡å‹ç¼–è¯‘å™¨ï¼Œå°†é‡åŒ–æ¨¡å‹è½¬æ¢ä¸ºåœ°å¹³çº¿å¹³å°æ”¯æŒçš„è®¡ç®—æŒ‡ä»¤å’Œæ•°æ®ï¼Œ è¿™ä¸ªé˜¶æ®µçš„äº§å‡ºä¸€ä¸ª***.binæ¨¡å‹ï¼Œè¿™ä¸ªbinæ¨¡å‹æ˜¯åç»­å°†åœ¨åœ°å¹³çº¿è¾¹ç¼˜åµŒå…¥å¼å¹³å°è¿è¡Œçš„æ¨¡å‹ï¼Œä¹Ÿå°±æ˜¯æ¨¡å‹è½¬æ¢çš„æœ€ç»ˆäº§å‡ºç»“æœã€‚*</span><br><span class="line"></span><br><span class="line">***è½¬æ¢ç»“æœè§£è¯»***</span><br><span class="line"></span><br><span class="line">*æœ¬èŠ‚å°†ä¾æ¬¡ä»‹ç»æ¨¡å‹è½¬æ¢æˆåŠŸçŠ¶æ€çš„è§£è¯»ã€è½¬æ¢ä¸æˆåŠŸçš„åˆ†ææ–¹å¼ã€‚ ç¡®è®¤æ¨¡å‹è½¬æ¢æˆåŠŸï¼Œéœ€è¦æ‚¨ä» `makertbin` çŠ¶æ€ä¿¡æ¯ã€ç›¸ä¼¼åº¦ä¿¡æ¯å’Œ `working_dir` äº§å‡ºä¸‰ä¸ªæ–¹é¢ç¡®è®¤ã€‚ `makertbin` çŠ¶æ€ä¿¡æ¯æ–¹é¢ï¼Œè½¬æ¢æˆåŠŸå°†åœ¨æ§åˆ¶å°è¾“å‡ºä¿¡æ¯å°¾éƒ¨ç»™å‡ºæ˜ç¡®çš„æç¤ºä¿¡æ¯å¦‚ä¸‹ï¼š*</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>
</code></pre>
</li>
</ul>
<h1 id="2021-04-21-11-13-08-337-INFO-Convert-to-runtime-bin-file-successfully-2021-04-21-11-13-08-337-INFO-End-Model-Convert"><a href="#2021-04-21-11-13-08-337-INFO-Convert-to-runtime-bin-file-successfully-2021-04-21-11-13-08-337-INFO-End-Model-Convert" class="headerlink" title="2021-04-21 11:13:08,337 INFO Convert to runtime bin file successfully!2021-04-21 11:13:08,337 INFO End Model Convert"></a>2021-04-21 11:13:08,337 INFO Convert to runtime bin file successfully!<br>2021-04-21 11:13:08,337 INFO End Model Convert<br><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">*ç›¸ä¼¼åº¦ä¿¡æ¯ä¹Ÿå­˜åœ¨äº `makertbin` çš„æ§åˆ¶å°è¾“å‡ºå†…å®¹ä¸­ï¼Œåœ¨ `makertbin` çŠ¶æ€ä¿¡æ¯ä¹‹å‰ï¼Œå…¶å†…å®¹å½¢å¼å¦‚ä¸‹ï¼š*</span><br><span class="line"></span><br></pre></td></tr></table></figure></div></h1><h2 id="Node-ON-Subgraph-Type-Cosine-Similarity-Threshold"><a href="#Node-ON-Subgraph-Type-Cosine-Similarity-Threshold" class="headerlink" title="Node    ON   Subgraph  Type     Cosine Similarity  Threshold"></a>Node    ON   Subgraph  Type     Cosine Similarity  Threshold</h2><p>â€¦    â€¦     â€¦     â€¦       0.999936           127.000000<br>â€¦    â€¦     â€¦     â€¦       0.999868           2.557209<br>â€¦    â€¦     â€¦     â€¦       0.999268           2.133924<br>â€¦    â€¦     â€¦     â€¦       0.996023           3.251645<br>â€¦    â€¦     â€¦     â€¦       0.996656           4.495638</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">*ä¸Šé¢åˆ—ä¸¾çš„è¾“å‡ºå†…å®¹ä¸­ï¼ŒNodeã€ONã€Subgraphã€Typeä¸ `hb_mapper checker` å·¥å…·çš„è§£è¯»æ˜¯ä¸€è‡´çš„ï¼Œ è¯·å‚è€ƒå‰æ–‡ [æ£€æŸ¥ç»“æœè§£è¯»](https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/ptq/ptq_usage/check_model.html#check-result) ï¼› Thresholdæ˜¯æ¯ä¸ªå±‚æ¬¡çš„æ ¡å‡†é˜ˆå€¼ï¼Œç”¨äºå¼‚å¸¸çŠ¶æ€ä¸‹å‘åœ°å¹³çº¿æŠ€æœ¯æ”¯æŒåé¦ˆä¿¡æ¯ï¼Œæ­£å¸¸çŠ¶å†µä¸‹ä¸éœ€è¦å…³æ³¨ï¼› **Cosine Similarityåæ˜ çš„NodeæŒ‡ç¤ºçš„èŠ‚ç‚¹ä¸­ï¼ŒåŸå§‹æµ®ç‚¹æ¨¡å‹ä¸é‡åŒ–æ¨¡å‹è¾“å‡ºç»“æœçš„ä½™å¼¦ç›¸ä¼¼åº¦ã€‚***</span><br><span class="line"></span><br><span class="line">***æ³¨æ„ï¼š**éœ€è¦æ‚¨ç‰¹åˆ«æ³¨æ„çš„æ˜¯ï¼ŒCosine Similarityåªæ˜¯æŒ‡æ˜é‡åŒ–åæ•°æ®ç¨³å®šæ€§çš„ä¸€ç§å‚è€ƒæ–¹å¼ï¼Œå¯¹äºæ¨¡å‹ç²¾åº¦çš„å½±å“ä¸å­˜åœ¨æ˜æ˜¾çš„ç›´æ¥å…³è”å…³ç³»ã€‚ ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œè¾“å‡ºèŠ‚ç‚¹çš„ç›¸ä¼¼åº¦ä½äº0.8å°±æœ‰äº†è¾ƒæ˜æ˜¾çš„ç²¾åº¦æŸå¤±ï¼Œå½“ç„¶ç”±äºä¸ç²¾åº¦ä¸å­˜åœ¨ç»å¯¹çš„ç›´æ¥å…³è”ï¼Œ å®Œå…¨å‡†ç¡®çš„ç²¾åº¦æƒ…å†µè¿˜éœ€è¦æ‚¨å‚è€ƒ [æ¨¡å‹ç²¾åº¦åˆ†æä¸è°ƒä¼˜](https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/ptq/ptq_usage/accuracy_evaluation.html) çš„ä»‹ç»ã€‚*</span><br><span class="line"></span><br><span class="line">*è½¬æ¢äº§å‡ºå­˜æ”¾åœ¨è½¬æ¢é…ç½®å‚æ•° `working_dir` æŒ‡å®šçš„è·¯å¾„ä¸­ï¼ŒæˆåŠŸå®Œæˆæ¨¡å‹è½¬æ¢åï¼Œ æ‚¨å¯ä»¥åœ¨è¯¥ç›®å½•ä¸‹å¾—åˆ°ä»¥ä¸‹æ–‡ä»¶(***éƒ¨åˆ†æ˜¯æ‚¨é€šè¿‡è½¬æ¢é…ç½®å‚æ•° `output_model_file_prefix` æŒ‡å®šçš„å†…å®¹)ï¼š*</span><br><span class="line"></span><br><span class="line">- ****_original_float_model.onnx*</span><br><span class="line">- ****_optimized_float_model.onnx*</span><br><span class="line">- ****_calibrated_model.onnx*</span><br><span class="line">- ****_quantized_model.onnx*</span><br><span class="line">- ****.bin*</span><br><span class="line"></span><br><span class="line">*[è½¬æ¢äº§å‡ºç‰©è§£è¯»](https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/ptq/ptq_usage/quantize_compile.html#conversion-output) ä»‹ç»äº†æ¯ä¸ªäº§å‡ºç‰©çš„ç”¨é€”ã€‚ ä¸è¿‡åœ¨ä¸Šæ¿è¿è¡Œå‰ï¼Œæˆ‘ä»¬å¼ºçƒˆå»ºè®®æ‚¨å®Œæˆ [éªŒè¯æ¨¡å‹](https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/ptq/ptq_usage/check_model.html) å’Œ [æ¨¡å‹æ€§èƒ½åˆ†æä¸è°ƒä¼˜](https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/ptq/ptq_usage/performance_evaluation.html) ä»‹ç»çš„æ€§èƒ½&amp;ç²¾åº¦è¯„æµ‹è¿‡ç¨‹ï¼Œé¿å…å°†æ¨¡å‹è½¬æ¢é—®é¢˜å»¶ä¼¸åˆ°åç»­åµŒå…¥å¼ç«¯ã€‚*</span><br><span class="line"></span><br><span class="line">*å¦‚æœä»¥ä¸ŠéªŒè¯æ¨¡å‹è½¬æ¢æˆåŠŸçš„ä¸‰ä¸ªæ–¹é¢ä¸­ï¼Œæœ‰ä»»ä¸€ä¸ªå‡ºç°ç¼ºå¤±éƒ½è¯´æ˜æ¨¡å‹è½¬æ¢å‡ºç°äº†é”™è¯¯ã€‚ ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œ`makertbin` å·¥å…·ä¼šåœ¨å‡ºç°é”™è¯¯æ—¶å°†é”™è¯¯ä¿¡æ¯è¾“å‡ºè‡³æ§åˆ¶å°ï¼Œ ä¾‹å¦‚æˆ‘ä»¬åœ¨Caffeæ¨¡å‹è½¬æ¢æ—¶ä¸é…ç½® `prototxt` å’Œ `caffe_model` å‚æ•°ï¼Œå·¥å…·ç»™å‡ºå¦‚ä¸‹æç¤ºã€‚*</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>
<p>2021-04-21 14:45:34,085 ERROR Key â€˜model_parametersâ€™ error:<br>Missing keys: â€˜caffe_modelâ€™, â€˜prototxtâ€™<br>2021-04-21 14:45:34,085 ERROR yaml file parse failed. Please double check your input<br>2021-04-21 14:45:34,085 ERROR exception in command: makertbin</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">*å¦‚æœä»¥ä¸Šæ­¥éª¤ä¸èƒ½å¸®åŠ©æ‚¨å‘ç°é—®é¢˜ï¼Œæ¬¢è¿åœ¨åœ°å¹³çº¿å”¯ä¸€å®˜æ–¹æŠ€æœ¯ç¤¾åŒºï¼ˆhttps://developer.horizon.ai/ï¼‰æå‡ºæ‚¨çš„é—®é¢˜ï¼Œ æˆ‘ä»¬å°†åœ¨24å°æ—¶å†…ç»™æ‚¨æä¾›æ”¯æŒã€‚*</span><br><span class="line"></span><br><span class="line">***è½¬æ¢äº§å‡ºç‰©è§£è¯»***</span><br><span class="line"></span><br><span class="line">*ä¸Šæ–‡æåˆ°æ¨¡å‹æˆåŠŸè½¬æ¢çš„äº§å‡ºç‰©åŒ…æ‹¬ä»¥ä¸‹å››ä¸ªéƒ¨åˆ†ï¼Œæœ¬èŠ‚å°†ä»‹ç»æ¯ä¸ªäº§å‡ºç‰©çš„ç”¨é€”ï¼š*</span><br><span class="line"></span><br><span class="line">- ****_original_float_model.onnx*</span><br><span class="line">- ****_optimized_float_model.onnx*</span><br><span class="line">- ****_calibrated_model.onnx*</span><br><span class="line">- ****_quantized_model.onnx*</span><br><span class="line">- ****.bin*</span><br><span class="line"></span><br><span class="line">****_original_float_model.onnxçš„äº§å‡ºè¿‡ç¨‹å¯ä»¥å‚è€ƒ [è½¬æ¢å†…éƒ¨è¿‡ç¨‹è§£è¯»](https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/ptq/ptq_usage/quantize_compile.html#conversion-interpretation) çš„ä»‹ç»ï¼Œ è¿™ä¸ªæ¨¡å‹è®¡ç®—ç²¾åº¦ä¸è½¬æ¢è¾“å…¥çš„åŸå§‹æµ®ç‚¹æ¨¡å‹æ˜¯ä¸€æ¨¡ä¸€æ ·çš„ï¼Œæœ‰ä¸ªé‡è¦çš„å˜åŒ–å°±æ˜¯ä¸ºäº†é€‚é…åœ°å¹³çº¿å¹³å°æ·»åŠ äº†ä¸€äº›æ•°æ®é¢„å¤„ç†è®¡ç®—ã€‚ ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæ‚¨ä¸éœ€è¦ä½¿ç”¨è¿™ä¸ªæ¨¡å‹ï¼Œåœ¨è½¬æ¢ç»“æœå‡ºç°å¼‚å¸¸æ—¶ï¼Œå¦‚æœèƒ½æŠŠè¿™ä¸ªæ¨¡å‹æä¾›ç»™åœ°å¹³çº¿çš„æŠ€æœ¯æ”¯æŒï¼Œå°†æœ‰åŠ©äºå¸®åŠ©æ‚¨å¿«é€Ÿè§£å†³é—®é¢˜ã€‚*</span><br><span class="line"></span><br><span class="line">****_optimized_float_model.onnxçš„äº§å‡ºè¿‡ç¨‹å¯ä»¥å‚è€ƒ [è½¬æ¢å†…éƒ¨è¿‡ç¨‹è§£è¯»](https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/ptq/ptq_usage/quantize_compile.html#conversion-interpretation) çš„ä»‹ç»ï¼Œ è¿™ä¸ªæ¨¡å‹ç»è¿‡ä¸€äº›ç®—å­çº§åˆ«çš„ä¼˜åŒ–æ“ä½œï¼Œå¸¸è§çš„å°±æ˜¯ç®—å­èåˆã€‚ é€šè¿‡ä¸original_floatæ¨¡å‹çš„å¯è§†åŒ–å¯¹æ¯”ï¼Œæ‚¨å¯ä»¥æ˜æ˜¾çœ‹åˆ°ä¸€äº›ç®—å­ç»“æ„çº§åˆ«çš„å˜åŒ–ï¼Œä¸è¿‡è¿™äº›éƒ½ä¸å½±å“æ¨¡å‹çš„è®¡ç®—ç²¾åº¦ã€‚ ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæ‚¨ä¸éœ€è¦ä½¿ç”¨è¿™ä¸ªæ¨¡å‹ï¼Œåœ¨è½¬æ¢ç»“æœå‡ºç°å¼‚å¸¸æ—¶ï¼Œå¦‚æœèƒ½æŠŠè¿™ä¸ªæ¨¡å‹æä¾›ç»™åœ°å¹³çº¿çš„æŠ€æœ¯æ”¯æŒï¼Œå°†æœ‰åŠ©äºå¸®åŠ©æ‚¨å¿«é€Ÿè§£å†³é—®é¢˜ã€‚*</span><br><span class="line"></span><br><span class="line">****_calibrated_model.onnxçš„äº§å‡ºè¿‡ç¨‹å¯ä»¥å‚è€ƒ [è½¬æ¢å†…éƒ¨è¿‡ç¨‹è§£è¯»](https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/ptq/ptq_usage/quantize_compile.html#conversion-interpretation) çš„ä»‹ç»ï¼Œ è¿™ä¸ªæ¨¡å‹æ˜¯æ¨¡å‹è½¬æ¢å·¥å…·é“¾å°†æµ®ç‚¹æ¨¡å‹ç»è¿‡ç»“æ„ä¼˜åŒ–åï¼Œé€šè¿‡æ ¡å‡†æ•°æ®è®¡ç®—å¾—åˆ°çš„æ¯ä¸ªèŠ‚ç‚¹å¯¹åº”çš„é‡åŒ–å‚æ•°å¹¶å°†å…¶ä¿å­˜åœ¨æ ¡å‡†èŠ‚ç‚¹ä¸­å¾—åˆ°çš„ä¸­é—´äº§ç‰©ã€‚*</span><br><span class="line"></span><br><span class="line">**** _quantized_model.onnxçš„äº§å‡ºè¿‡ç¨‹å¯ä»¥å‚è€ƒ [è½¬æ¢å†…éƒ¨è¿‡ç¨‹è§£è¯»](https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/ptq/ptq_usage/quantize_compile.html#conversion-interpretation) çš„ä»‹ç»ï¼Œ è¿™ä¸ªæ¨¡å‹å·²ç»å®Œæˆäº†æ ¡å‡†å’Œé‡åŒ–è¿‡ç¨‹ï¼Œé‡åŒ–åçš„ç²¾åº¦æŸå¤±æƒ…å†µå¯ä»¥ä»è¿™é‡ŒæŸ¥çœ‹ã€‚ è¿™ä¸ªæ¨¡å‹æ˜¯ç²¾åº¦éªŒè¯è¿‡ç¨‹ä¸­å¿…é¡»è¦ä½¿ç”¨çš„æ¨¡å‹ï¼Œå…·ä½“ä½¿ç”¨æ–¹å¼è¯·å‚è€ƒ [æ¨¡å‹ç²¾åº¦åˆ†æä¸è°ƒä¼˜](https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/ptq/ptq_usage/accuracy_evaluation.html) éƒ¨åˆ†çš„ä»‹ç»ã€‚*</span><br><span class="line"></span><br><span class="line">***.binå°±æ˜¯å¯ä»¥ç”¨äºåœ¨åœ°å¹³çº¿èŠ¯ç‰‡ä¸ŠåŠ è½½è¿è¡Œçš„æ¨¡å‹ï¼Œ é…åˆ [åµŒå…¥å¼åº”ç”¨å¼€å‘æŒ‡å¯¼](https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/runtime/source/runtime_dev.html) éƒ¨åˆ†ä»‹ç»çš„å†…å®¹ï¼Œ æ‚¨å°±å¯ä»¥å°†æ¨¡å‹å¿«é€Ÿåœ¨èŠ¯ç‰‡éƒ¨ç½²è¿è¡Œã€‚ä¸è¿‡ä¸ºäº†ç¡®ä¿æ¨¡å‹çš„æ€§èƒ½ä¸ç²¾åº¦æ•ˆæœæ˜¯ç¬¦åˆæ‚¨çš„é¢„æœŸçš„ï¼Œ æˆ‘ä»¬å¼ºçƒˆå»ºè®®å®Œæˆ [æ¨¡å‹æ€§èƒ½åˆ†æä¸è°ƒä¼˜](https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/ptq/ptq_usage/performance_evaluation.html) å’Œ [æ¨¡å‹ç²¾åº¦åˆ†æä¸è°ƒä¼˜](https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/ptq/ptq_usage/accuracy_evaluation.html) ä»‹ç»çš„æ€§èƒ½å’Œç²¾åº¦åˆ†æè¿‡ç¨‹åå†è¿›å…¥åˆ°åº”ç”¨å¼€å‘å’Œéƒ¨ç½²ã€‚***</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&gt; *æ¨¡å‹æ€§èƒ½åˆ†æä¸è°ƒä¼˜*</span><br><span class="line"></span><br><span class="line">*æœ¬èŠ‚ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨åœ°å¹³çº¿æä¾›çš„å·¥å…·è¯„ä¼°æ¨¡å‹æ€§èƒ½ã€‚ å¦‚æœæ­¤é˜¶æ®µå‘ç°è¯„ä¼°ç»“æœä¸ç¬¦åˆé¢„æœŸï¼Œå¼ºçƒˆå»ºè®®æ‚¨å°½é‡åœ¨æ­¤é˜¶æ®µæ ¹æ®åœ°å¹³çº¿çš„ä¼˜åŒ–å»ºè®®è§£å†³æ€§èƒ½é—®é¢˜ï¼Œ ä¸å»ºè®®å°†æ¨¡å‹çš„é—®é¢˜å»¶ä¼¸åˆ°åº”ç”¨å¼€å‘é˜¶æ®µã€‚*</span><br><span class="line"></span><br><span class="line">***ä½¿ç”¨ `hb_perf` å·¥å…·ä¼°è®¡æ€§èƒ½***</span><br><span class="line"></span><br><span class="line">*åœ°å¹³çº¿æä¾›çš„ `hb_perf` ä»¥æ¨¡å‹è½¬æ¢å¾—åˆ°çš„ ***.binä¸ºè¾“å…¥ï¼Œå¯ä»¥ç›´æ¥å¾—åˆ°æ¨¡å‹é¢„æœŸä¸Šæ¿æ€§èƒ½ï¼ˆä¸å«CPUéƒ¨åˆ†çš„è®¡ç®—è¯„ä¼°ï¼‰ï¼Œå·¥å…·ä½¿ç”¨æ–¹å¼å¦‚ä¸‹ï¼š*</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>
<p>hb_perf  ***.bin</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">***æ³¨æ„ï¼šå¦‚æœåˆ†æçš„æ˜¯ `pack` åæ¨¡å‹ï¼Œéœ€è¦åŠ ä¸Šä¸€ä¸ª `-p` å‚æ•°ï¼Œå‘½ä»¤ä¸º `hb_perf -p ***.bin`ã€‚ å…³äºæ¨¡å‹ `pack`ï¼Œè¯·æŸ¥çœ‹ [å…¶ä»–æ¨¡å‹å·¥å…·ï¼ˆå¯é€‰ï¼‰](https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/ptq/ptq_usage/other_tools.html) éƒ¨åˆ†çš„ä»‹ç»ã€‚***</span><br><span class="line"></span><br><span class="line">*å‘½ä»¤ä¸­çš„ ***.binå°±æ˜¯æ¨¡å‹è½¬æ¢äº§å‡ºçš„binæ¨¡å‹ï¼Œå‘½ä»¤æ‰§è¡Œå®Œæˆåï¼Œ åœ¨å½“å‰å·¥ä½œç›®å½•ä¸‹ä¼šå¾—åˆ°ä¸€ä¸ª `hb_perf_result` ç›®å½•ï¼Œåˆ†æç»“æœä»¥htmlå½¢å¼æä¾›ã€‚ ä»¥ä¸‹æ˜¯æˆ‘ä»¬åˆ†æä¸€ä¸ªMobileNetçš„ç¤ºä¾‹ç»“æœï¼Œå…¶ä¸­mobilenetv1_224x224_nv12.htmlå°±æ˜¯æŸ¥çœ‹åˆ†æç»“æœçš„ä¸»é¡µé¢ã€‚*</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>
<p>hb_perf_result&#x2F;<br>â””â”€â”€ mobilenetv1_224x224_nv12<br>    â”œâ”€â”€ MOBILENET_subgraph_0.html<br>    â”œâ”€â”€ MOBILENET_subgraph_0.json<br>    â”œâ”€â”€ mobilenetv1_224x224_nv12<br>    â”œâ”€â”€ mobilenetv1_224x224_nv12.html<br>    â”œâ”€â”€ mobilenetv1_224x224_nv12.png<br>    â””â”€â”€ temp.hbm</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">*é€šè¿‡æµè§ˆå™¨æ‰“å¼€ç»“æœä¸»é¡µé¢ï¼Œå…¶å†…å®¹å¦‚ä¸‹å›¾ï¼š*</span><br><span class="line"></span><br><span class="line">*![image-20230509134200321](J5/image-20230509134200321.png)*</span><br><span class="line"></span><br><span class="line">*åˆ†æç»“æœä¸»è¦ç”±Model Performance Summaryã€Detailså’ŒBIN Model Structureä¸‰ä¸ªéƒ¨åˆ†ç»„æˆã€‚ Model Performance Summaryæ˜¯æ•´ä¸ªbinæ¨¡å‹çš„æ•´ä½“æ€§èƒ½è¯„ä¼°ç»“æœï¼Œå…¶ä¸­å„é¡¹æŒ‡æ ‡ä¸º:*</span><br><span class="line"></span><br><span class="line">- *Model Nameâ€”â€”æ¨¡å‹åç§°ã€‚*</span><br><span class="line">- *BPU Model Latency(ms)â€”â€”æ¨¡å‹æ•´ä½“å•å¸§è®¡ç®—è€—æ—¶(å•ä½ä¸ºms)ã€‚*</span><br><span class="line">- *Total DDR (loaded+stored) bytes per frame(MB per frame)â€”â€”æ¨¡å‹æ•´ä½“BPUéƒ¨åˆ†æ•°æ®åŠ è½½å’Œå­˜å‚¨æ‰€å ç”¨çš„DDRæ€»é‡ï¼ˆå•ä½ä¸ºMB/frameï¼‰ã€‚*</span><br><span class="line">- *Loaded Bytes per Frameâ€”â€”æ¨¡å‹è¿è¡Œæ¯å¸§è¯»å–æ•°æ®é‡ã€‚*</span><br><span class="line">- *Stored Bytes per Frameâ€”â€”æ¨¡å‹è¿è¡Œæ¯å¸§å­˜å‚¨æ•°æ®é‡ã€‚*</span><br><span class="line"></span><br><span class="line">*åœ¨äº†è§£Detailså’ŒBIN Model Structureå‰ï¼Œæ‚¨éœ€è¦äº†è§£å­å›¾ï¼ˆsubgraphï¼‰çš„æ¦‚å¿µã€‚ å¦‚æœæ¨¡å‹åœ¨éè¾“å…¥å’Œè¾“å‡ºéƒ¨åˆ†å‡ºç°äº†CPUè®¡ç®—çš„ç®—å­ï¼Œæ¨¡å‹è½¬æ¢å·¥å…·å°†æŠŠè¿™ä¸ªç®—å­å‰åè¿ç»­åœ¨BPUè®¡ç®—çš„éƒ¨åˆ†æ‹†åˆ†ä¸ºä¸¤ä¸ªç‹¬ç«‹çš„å­å›¾ï¼ˆsubgraphï¼‰ã€‚ å…·ä½“å¯ä»¥å‚è€ƒ [éªŒè¯æ¨¡å‹](https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/ptq/ptq_usage/check_model.html) éƒ¨åˆ†çš„ä»‹ç»ã€‚*</span><br><span class="line"></span><br><span class="line">*Detailsæ˜¯æ¯ä»½æ¨¡å‹BPUå­å›¾çš„å…·ä½“ä¿¡æ¯ï¼Œåœ¨ä¸»é¡µé¢ä¸­ï¼Œæ¯ä¸ªå­å›¾æä¾›çš„æŒ‡æ ‡è§£è¯»å¦‚ä¸‹ï¼š*</span><br><span class="line"></span><br><span class="line">- *Model Subgraph Nameâ€”â€”å­å›¾åç§°ã€‚*</span><br><span class="line">- *Model Subgraph Calculation Load (OPpf)â€”â€”å­å›¾çš„å•å¸§è®¡ç®—é‡ã€‚*</span><br><span class="line">- *Model Subgraph DDR Occupation(Mbpf)â€”â€”å­å›¾çš„å•å¸§è¯»å†™æ•°æ®é‡ï¼ˆå•ä½ä¸ºMBï¼‰ã€‚*</span><br><span class="line">- *Model Subgraph Latency(ms)â€”â€”å­å›¾çš„å•å¸§è®¡ç®—è€—æ—¶ï¼ˆå•ä½ä¸ºmsï¼‰ã€‚*</span><br><span class="line"></span><br><span class="line">*æ¯ä»½å­å›¾ç»“æœæä¾›äº†ä¸€ä¸ªæ˜ç»†å…¥å£ï¼Œä»¥ä¸ŠæŒ‡æ ‡éƒ½æ˜¯æ˜ç»†é¡µé¢æå–åˆ°çš„ï¼Œè¿›å…¥åˆ°æ˜ç»†é¡µé¢å¯ä»¥ç»™æ‚¨æ›´åŠ ç»†è‡´çš„å‚è€ƒä¿¡æ¯ã€‚*</span><br><span class="line"></span><br><span class="line">***æ³¨æ„ï¼šéœ€è¦ç‰¹åˆ«æ³¨æ„çš„æ˜¯ï¼Œæ˜ç»†é¡µé¢ä¼šæ ¹æ®æ‚¨æ˜¯å¦å¯ç”¨è°ƒè¯•å‚æ•°ï¼ˆ `debug` ï¼‰è€Œæœ‰æ‰€åŒºåˆ«ï¼Œ ä¸‹å›¾ä¸­çš„Layer Detailsä»…å½“åœ¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½® `debug` å‚æ•°ä¸º `True` æ—¶æ‰å¯ä»¥æ‹¿åˆ°ï¼Œ è¿™ä¸ª `debug` å‚æ•°é…ç½®æ–¹æ³•è¯·å‚è€ƒ [ä½¿ç”¨ hb_mapper makertbin å·¥å…·è½¬æ¢æ¨¡å‹](https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/ptq/ptq_usage/quantize_compile.html#makertbin) éƒ¨åˆ†çš„ä»‹ç»ã€‚***</span><br><span class="line"></span><br><span class="line">*Layer Detailsæä¾›åˆ°äº†å…·ä½“ç®—å­çº§åˆ«çš„åˆ†æï¼Œåœ¨è°ƒè¯•åˆ†æé˜¶æ®µä¹Ÿæ˜¯æ¯”è¾ƒä¸é”™çš„å‚è€ƒï¼Œ å¦‚æœæ˜¯æŸäº›BPUç®—å­å¯¼è‡´æ€§èƒ½ä½ï¼Œå¯ä»¥å¸®åŠ©æ‚¨å®šä½åˆ°è¿™ä¸ªå…·ä½“ç®—å­ã€‚*</span><br><span class="line"></span><br><span class="line">*![image-20230509134410094](J5/image-20230509134410094.png)*</span><br><span class="line"></span><br><span class="line">*BIN Model Structureéƒ¨åˆ†æä¾›çš„æ˜¯binæ¨¡å‹çš„å­å›¾çº§å¯è§†åŒ–ç»“æœï¼Œå›¾ä¸­æ·±è‰²èŠ‚ç‚¹è¡¨ç¤ºè¿è¡Œåœ¨BPUä¸Šçš„èŠ‚ç‚¹ï¼Œç°è‰²èŠ‚ç‚¹è¡¨ç¤ºåœ¨CPUä¸Šè®¡ç®—çš„èŠ‚ç‚¹ã€‚*</span><br><span class="line"></span><br><span class="line">*ä½¿ç”¨ `hb_perf` çš„æ„ä¹‰åœ¨äºäº†è§£binæ¨¡å‹å­å›¾ç»“æ„ï¼Œå¯¹äºBPUä¸Šè®¡ç®—éƒ¨åˆ†ï¼Œè¯¥å·¥å…·ä¹Ÿèƒ½æä¾›è¾ƒå…¨é¢çš„é™æ€åˆ†ææŒ‡æ ‡ã€‚ **ä¸è¿‡ `hb_perf` ä¸å«CPUéƒ¨åˆ†çš„è®¡ç®—è¯„ä¼°**ï¼Œ**å¦‚æœCPUè®¡ç®—ä»…é™äºæ¨¡å‹è¾“å…¥æˆ–è¾“å‡ºéƒ¨åˆ†çš„å¸¸è§„æ€§å¤„ç†ï¼Œä¸å«è®¡ç®—å¯†é›†å‹è®¡ç®—èŠ‚ç‚¹ï¼Œè¿™ä¸ªå½±å“ä¸å¤§ã€‚ å¦åˆ™ï¼Œæ‚¨å°±ä¸€å®šéœ€è¦åˆ©ç”¨å¼€å‘æ¿å·¥å…·å®æµ‹æ€§èƒ½ã€‚***</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">***å¼€å‘æ¿å®æµ‹æ€§èƒ½***</span><br><span class="line"></span><br><span class="line">*å‘æ¿ä¸Šå®æµ‹æ¨¡å‹æ€§èƒ½ä½¿ç”¨çš„æ˜¯å¼€å‘æ¿ä¸Š `hrt_model_exec perf` å·¥å…·ï¼Œ `hrt _model_exec` æ˜¯ä¸€ä¸ªæ¨¡å‹æ‰§è¡Œå·¥å…·ï¼Œå¯ç›´æ¥åœ¨å¼€å‘æ¿ä¸Šè¯„æµ‹æ¨¡å‹çš„æ¨ç†æ€§èƒ½ã€è·å–æ¨¡å‹ä¿¡æ¯ã€‚ ä¸€æ–¹é¢å¯ä»¥è®©ç”¨æˆ·æ‹¿åˆ°æ¨¡å‹æ—¶å®é™…äº†è§£æ¨¡å‹çœŸå®æ€§èƒ½ï¼› å¦ä¸€æ–¹é¢ä¹Ÿå¯ä»¥å¸®åŠ©ç”¨æˆ·äº†è§£æ¨¡å‹å¯ä»¥åšåˆ°çš„é€Ÿåº¦æé™ï¼Œå¯¹äºåº”ç”¨è°ƒä¼˜çš„ç›®æ ‡æé™å…·æœ‰æŒ‡å¯¼æ„ä¹‰ã€‚*</span><br><span class="line"></span><br><span class="line">*ä½¿ç”¨ `hrt_model_exec perf` å·¥å…·å‰ï¼Œæœ‰ä¸¤ä¸ªå‡†å¤‡å·¥ä½œã€‚*</span><br><span class="line"></span><br><span class="line">1. *ç¡®ä¿æ‚¨å·²ç»å‚è€ƒ [ç¯å¢ƒéƒ¨ç½²](https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/env_install/env_deploy.html) ä»‹ç»å®Œæˆäº†å¼€å‘æ¿ä¸Šå·¥å…·å®‰è£…ã€‚*</span><br><span class="line">2. *ç¬¬äºŒæ˜¯éœ€è¦å°†Ubuntuå¼€å‘æœºä¸Šå¾—åˆ°çš„binæ¨¡å‹æ‹·è´åˆ°å¼€å‘æ¿ä¸Šï¼ˆå»ºè®®æ”¾åœ¨/userdataç›®å½•ï¼‰ï¼Œ å¼€å‘æ¿ä¸Šæ˜¯ä¸€ä¸ªLinuxç³»ç»Ÿï¼Œå¯ä»¥é€šè¿‡ `scp` ç­‰Linuxç³»ç»Ÿå¸¸ç”¨æ–¹å¼å®Œæˆè¿™ä¸ªæ‹·è´è¿‡ç¨‹ã€‚*</span><br><span class="line"></span><br><span class="line">***æ³¨æ„ï¼šæ­¤æ—¶ä½¿ç”¨çš„æ¨¡å‹ä¸éœ€è¦æ‰“å¼€debugï¼Œdebugæ‰“å¼€ä¼šå½±å“æ¨¡å‹åœ¨å¼€å‘æ¿çš„æµ‹è¯•ç»“æœã€‚***</span><br><span class="line"></span><br><span class="line">*ä½¿ç”¨ `hrt_model_exec perf` å®æµ‹æ€§èƒ½çš„å‚è€ƒå‘½ä»¤å¦‚ä¸‹ï¼ˆ**æ³¨æ„æ˜¯åœ¨å¼€å‘æ¿ä¸Šæ‰§è¡Œ**ï¼‰ï¼š*</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>
<p>.&#x2F;hrt_model_exec perf â€“model_file mobilenetv1_224x224_nv12.bin <br>                      â€“model_name&#x3D;â€â€ <br>                      â€“core_id&#x3D;0 <br>                      â€“frame_count&#x3D;200 <br>                      â€“perf_time&#x3D;0 <br>                      â€“thread_num&#x3D;1 <br>                      â€“profile_path&#x3D;â€.â€</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">*å…¶ä¸­ï¼Œå„å‚æ•°å«ä¹‰å¦‚ä¸‹ï¼š*</span><br><span class="line"></span><br><span class="line">*`model_file`ï¼š éœ€è¦åˆ†ææ€§èƒ½çš„binæ¨¡å‹åç§°ã€‚*</span><br><span class="line"></span><br><span class="line">*`model_name`ï¼š éœ€è¦åˆ†ææ€§èƒ½çš„binæ¨¡å‹åå­—ã€‚è‹¥ `model_file` åªå«ä¸€ä¸ªæ¨¡å‹ï¼Œåˆ™å¯ä»¥çœç•¥ã€‚*</span><br><span class="line"></span><br><span class="line">*`core_id`ï¼š é»˜è®¤å€¼ `0`ï¼Œè¿è¡Œæ¨¡å‹ä½¿ç”¨çš„æ ¸å¿ƒidï¼Œ`0` ä»£è¡¨ä»»æ„æ ¸å¿ƒï¼Œ`1` ä»£è¡¨æ ¸å¿ƒ0ï¼Œ`2` ä»£è¡¨æ ¸å¿ƒ1ã€‚è‹¥è¦åˆ†æåŒæ ¸æé™å¸§ç‡ï¼Œè¯·å°†æ­¤å¤„è®¾ä¸º `0`ã€‚*</span><br><span class="line"></span><br><span class="line">*`frame_count`ï¼š é»˜è®¤å€¼ `200`ï¼Œè®¾ç½®æ¨ç†å¸§æ•°ï¼Œå·¥å…·ä¼šæ‰§è¡ŒæŒ‡å®šæ¬¡æ•°åå†åˆ†æå¹³å‡è€—æ—¶ã€‚ å½“ `perf_time` ä¸º `0` æ—¶ç”Ÿæ•ˆã€‚*</span><br><span class="line"></span><br><span class="line">*`perf_time`ï¼š é»˜è®¤å€¼ `0`ï¼Œå•ä½åˆ†é’Ÿã€‚è®¾ç½®æ¨ç†æ—¶é—´ï¼Œå·¥å…·ä¼šæ‰§è¡ŒæŒ‡å®šæ—¶é—´åå†åˆ†æå¹³å‡è€—æ—¶ã€‚*</span><br><span class="line"></span><br><span class="line">*`thread_num`ï¼š é»˜è®¤å€¼ `1`ï¼Œè®¾ç½®è¿è¡Œçš„çº¿ç¨‹æ•°ï¼Œå–å€¼èŒƒå›´ `[1,8]`ã€‚è‹¥è¦åˆ†ææé™å¸§ç‡ï¼Œè¯·å°†çº¿ç¨‹æ•°æ”¹å¤§ã€‚*</span><br><span class="line"></span><br><span class="line">*`profile_path`ï¼š é»˜è®¤å…³é—­ï¼Œç»Ÿè®¡å·¥å…·æ—¥å¿—äº§ç”Ÿè·¯å¾„ã€‚è¯¥å‚æ•°å¼•å…¥çš„åˆ†æç»“æœä¼šå­˜æ”¾åœ¨æŒ‡å®šç›®å½•ä¸‹çš„profiler.logå’Œprofiler.csvæ–‡ä»¶ä¸­ã€‚*</span><br><span class="line"></span><br><span class="line">*å‘½ä»¤æ‰§è¡Œå®Œæˆåï¼Œæ‚¨å°†åœ¨æ§åˆ¶å°å¾—åˆ°å¦‚ä¸‹ç»“æœã€‚ æœ€ç»ˆçš„è¯„ä¼°ç»“æœå°±æ˜¯ `Average latency` å’Œ `Frame rate`ï¼Œåˆ†åˆ«è¡¨ç¤ºå¹³å‡å•å¸§æ¨ç†å»¶æ—¶å’Œæ¨¡å‹æé™å¸§ç‡ã€‚ å¦‚æœæƒ³è·å¾—æ¨¡å‹åœ¨æ¿å­ä¸Šè¿è¡Œçš„æé™å¸§ç‡ï¼Œéœ€å°† `thread_num` è®¾ç½®å¾—è¶³å¤Ÿå¤§ã€‚*</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>
<p>Running condition:<br>  Thread number is: 4<br>  Frame count   is: 1000<br>  Program run time: 279.004000 ms<br>Perf result:<br>  Frame totally latency is: 1084.040527 ms<br>  Average    latency    is: 1.084041 ms<br>  Frame      rate       is: 3584.178005 FPS</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">*æ§åˆ¶å°å¾—åˆ°çš„ä¿¡æ¯åªæœ‰æ•´ä½“æƒ…å†µï¼Œé€šè¿‡ `profile_path` æ§åˆ¶äº§ç”Ÿçš„ `profiler.log` å’Œ `profiler.csv` æ–‡ä»¶è®°å½•äº†æ›´åŠ ä¸°å¯Œçš„ä¿¡æ¯å¦‚ä¸‹ï¼š*</span><br><span class="line"></span><br><span class="line">```python</span><br><span class="line">&#123;</span><br><span class="line">  &quot;perf_result&quot;: &#123;</span><br><span class="line">    &quot;FPS&quot;: 3718.384436330103,</span><br><span class="line">    &quot;average_latency&quot;: 1.0366870164871216</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;running_condition&quot;: &#123;</span><br><span class="line">    &quot;core_id&quot;: 0,</span><br><span class="line">    &quot;frame_count&quot;: 1000,</span><br><span class="line">    &quot;model_name&quot;: &quot;mobilenetv1_224x224_nv12&quot;,</span><br><span class="line">    &quot;run_time&quot;: 268.934,</span><br><span class="line">    &quot;thread_num&quot;: 4</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">***</span><br><span class="line">&#123;</span><br><span class="line">  &quot;chip_latency&quot;: &#123;</span><br><span class="line">    &quot;BPU_inference_time_cost&quot;: &#123;</span><br><span class="line">      &quot;avg_time&quot;: 0.8493590000000001,</span><br><span class="line">      &quot;max_time&quot;: 1.328,</span><br><span class="line">      &quot;min_time&quot;: 0.766</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;CPU_inference_time_cost&quot;: &#123;</span><br><span class="line">      &quot;avg_time&quot;: 0.074976,</span><br><span class="line">      &quot;max_time&quot;: 0.382,</span><br><span class="line">      &quot;min_time&quot;: 0.066</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;model_latency&quot;: &#123;</span><br><span class="line">    &quot;BPU_MOBILENET_subgraph_0&quot;: &#123;</span><br><span class="line">      &quot;avg_time&quot;: 0.8493590000000001,</span><br><span class="line">      &quot;max_time&quot;: 1.328,</span><br><span class="line">      &quot;min_time&quot;: 0.766</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;Dequantize_fc7_1_HzDequantize&quot;: &#123;</span><br><span class="line">      &quot;avg_time&quot;: 0.029727,</span><br><span class="line">      &quot;max_time&quot;: 0.124,</span><br><span class="line">      &quot;min_time&quot;: 0.028</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;MOBILENET_subgraph_0_output_layout_convert&quot;: &#123;</span><br><span class="line">      &quot;avg_time&quot;: 0.011379,</span><br><span class="line">      &quot;max_time&quot;: 0.077,</span><br><span class="line">      &quot;min_time&quot;: 0.008</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;Preprocess&quot;: &#123;</span><br><span class="line">      &quot;avg_time&quot;: 0.005363000000000001,</span><br><span class="line">      &quot;max_time&quot;: 0.039,</span><br><span class="line">      &quot;min_time&quot;: 0.003</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;Softmax_prob&quot;: &#123;</span><br><span class="line">      &quot;avg_time&quot;: 0.028507,</span><br><span class="line">      &quot;max_time&quot;: 0.142,</span><br><span class="line">      &quot;min_time&quot;: 0.027</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;task_latency&quot;: &#123;</span><br><span class="line">    &quot;TaskPendingTime&quot;: &#123;</span><br><span class="line">      &quot;avg_time&quot;: 0.021235,</span><br><span class="line">      &quot;max_time&quot;: 0.336,</span><br><span class="line">      &quot;min_time&quot;: 0.002</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;TaskRunningTime&quot;: &#123;</span><br><span class="line">      &quot;avg_time&quot;: 0.983558,</span><br><span class="line">      &quot;max_time&quot;: 2.208,</span><br><span class="line">      &quot;min_time&quot;: 0.904</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p><em>è¿™é‡Œçš„å†…å®¹ä¼šå¯¹åº”åˆ° <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/ptq/ptq_usage/performance_evaluation.html#hb-perf" >ä½¿ç”¨hb_perfå·¥å…·ä¼°è®¡æ€§èƒ½ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ä¸­çš„BIN Model Structureéƒ¨åˆ†ä»‹ç»çš„binå¯è§†åŒ–å›¾ä¸­ï¼Œ å›¾ä¸­æ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰ä¸€ä¸ªå¯¹åº”èŠ‚ç‚¹åœ¨profiler.logæ–‡ä»¶ä¸­ï¼Œå¯ä»¥é€šè¿‡ <code>name</code> å¯¹åº” èµ·æ¥ã€‚ <code>profiler.log</code> æ–‡ä»¶ä¸­è®°å½•äº†æ¯ä¸ªèŠ‚ç‚¹çš„æ‰§è¡Œæ—¶é—´ï¼Œå¯¹ä¼˜åŒ–èŠ‚ç‚¹æœ‰é‡è¦çš„å‚è€ƒæ„ä¹‰ã€‚ ç”±äºæ¨¡å‹ä¸­çš„BPUèŠ‚ç‚¹å¯¹è¾“å…¥è¾“å‡ºæœ‰ç‰¹æ®Šè¦æ±‚ï¼Œå¦‚ç‰¹æ®Šçš„layoutå’Œpaddingå¯¹é½è¦æ±‚ï¼Œå› æ­¤éœ€è¦å¯¹BPUèŠ‚ç‚¹çš„è¾“å…¥ã€è¾“å‡ºæ•°æ®è¿›è¡Œå¤„ç†ã€‚</em></p>
<ul>
<li><em><code>Preprocess</code>ï¼šè¡¨ç¤ºå¯¹æ¨¡å‹è¾“å…¥æ•°æ®è¿›è¡Œpaddingå’Œlayoutè½¬æ¢æ“ä½œï¼Œå…¶è€—æ—¶ç»Ÿè®¡åœ¨Preprocessä¸­ã€‚</em></li>
<li><em><code>xxxx_input_layout_convert</code>ï¼š è¡¨ç¤ºå¯¹BPUèŠ‚ç‚¹çš„è¾“å…¥æ•°æ®è¿›è¡Œpaddingå’Œlayoutè½¬æ¢çš„æ“ä½œï¼Œå…¶è€—æ—¶ç»Ÿè®¡åœ¨xxxx_input_layout_convertä¸­ã€‚</em></li>
<li><em><code>xxxx_output_layout_convert</code>ï¼š è¡¨ç¤ºå¯¹BPUèŠ‚ç‚¹è¾“å‡ºæ•°æ®è¿›è¡Œå»æ‰paddingå’Œlayoutè½¬æ¢çš„æ“ä½œï¼Œå…¶è€—æ—¶ç»Ÿè®¡åœ¨xxxx_output_layout_convertä¸­ã€‚</em></li>
</ul>
<p><em><code>profiler</code> åˆ†ææ˜¯ç»å¸¸ä½¿ç”¨çš„æ“ä½œï¼Œå‰æ–‡ <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/ptq/ptq_usage/check_model.html#check-result" >æ£€æŸ¥ç»“æœè§£è¯» <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> éƒ¨åˆ†æåˆ°æ£€æŸ¥é˜¶æ®µä¸ç”¨è¿‡äº å…³æ³¨CPUç®—å­ï¼Œ æ­¤é˜¶æ®µå°±èƒ½çœ‹åˆ°CPUç®—å­çš„å…·ä½“è€—æ—¶æƒ…å†µäº†ï¼Œå¦‚æœæ ¹æ®è¿™é‡Œçš„è¯„ä¼°è®¤ä¸ºCPUè€—æ—¶å¤ªé•¿ï¼Œé‚£å°±å€¼å¾—ä¼˜åŒ–äº†ã€‚</em></p>
<p><em><strong>æ¨¡å‹æ€§èƒ½ä¼˜åŒ–</strong></em></p>
<p>*æ ¹æ®ä»¥ä¸Šæ€§èƒ½åˆ†æç»“æœï¼Œæ‚¨å¯èƒ½å‘ç°æ€§èƒ½ç»“æœä¸åŠé¢„æœŸï¼Œæœ¬ç« èŠ‚å†…å®¹ä»‹ç»äº†åœ°å¹³çº¿å¯¹æå‡æ¨¡å‹æ€§èƒ½çš„å»ºè®®ä¸æªæ–½ï¼ŒåŒ…æ‹¬ï¼š <strong>æ£€æŸ¥yamlé…ç½®å‚æ•°</strong>ã€ <strong>å¤„ç†CPUç®—å­</strong>ã€ <strong>é«˜æ€§èƒ½æ¨¡å‹è®¾è®¡å»ºè®®</strong>ã€ <strong>ä½¿ç”¨åœ°å¹³çº¿å¹³å°å‹å¥½ç»“æ„&amp;æ¨¡å‹</strong> å…±å››ä¸ªæ–¹é¢ã€‚*</p>
<p><em>éƒ¨åˆ†ä¿®æ”¹å¯èƒ½ä¼šå½±å“åŸå§‹æµ®ç‚¹æ¨¡å‹çš„å‚æ•°ç©ºé—´ï¼Œæ„å‘³ç€éœ€è¦æ‚¨é‡è®­æ¨¡å‹ï¼Œä¸ºäº†é¿å…æ€§èƒ½è°ƒä¼˜è¿‡ç¨‹ä¸­åå¤è°ƒæ•´å¹¶è®­ç»ƒçš„ä»£ä»·ï¼Œ <strong>åœ¨å¾—åˆ°æ»¡æ„æ€§èƒ½æ•ˆæœå‰ï¼Œå»ºè®®æ‚¨ä½¿ç”¨éšæœºå‚æ•°å¯¼å‡ºæ¨¡å‹æ¥éªŒè¯æ€§èƒ½å³å¯ã€‚</strong></em></p>
<p><em><strong>æ£€æŸ¥å½±å“æ¨¡å‹æ€§èƒ½çš„yamlå‚æ•°</strong></em></p>
<p><em>åœ¨æ¨¡å‹è½¬æ¢çš„yamlé…ç½®æ–‡ä»¶ä¸­ï¼Œéƒ¨åˆ†å‚æ•°ä¼šå®é™…å½±å“æ¨¡å‹çš„æœ€ç»ˆæ€§èƒ½ï¼Œå¯ä»¥å…ˆæ£€æŸ¥ä¸‹æ˜¯å¦å·²æ­£ç¡®æŒ‰ç…§é¢„æœŸé…ç½®ï¼Œ å„å‚æ•°çš„å…·ä½“å«ä¹‰å’Œä½œç”¨è¯·å‚è€ƒ <code>hb_mapper å·¥å…·ä»‹ç»</code> ç« èŠ‚ä¸­çš„ <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/ptq/ptq_tool/hb_mapper.html#hb-mapper-config" >é…ç½®æ–‡ä»¶è¯¦ç»†ä»‹ç» <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> å°èŠ‚çš„å†…å®¹ã€‚</em></p>
<ul>
<li><em><code>layer_out_dump</code>ï¼šæŒ‡å®šæ¨¡å‹è½¬æ¢è¿‡ç¨‹ä¸­æ˜¯å¦è¾“å‡ºæ¨¡å‹çš„ä¸­é—´ç»“æœï¼Œä¸€èˆ¬ä»…ç”¨äºè°ƒè¯•åŠŸèƒ½ã€‚ å¦‚æœå°†å…¶é…ç½®ä¸º <code>True</code>ï¼Œåˆ™ä¼šä¸ºæ¯ä¸ªå·ç§¯ç®—å­å¢åŠ ä¸€ä¸ªåé‡åŒ–è¾“å‡ºèŠ‚ç‚¹ï¼Œå®ƒä¼šæ˜¾è‘—çš„é™ä½æ¨¡å‹ä¸Šæ¿åçš„æ€§èƒ½ã€‚ æ‰€ä»¥åœ¨æ€§èƒ½è¯„æµ‹æ—¶ï¼ŒåŠ¡å¿…è¦å°†è¯¥å‚æ•°é…ç½®ä¸º <code>False</code>ã€‚</em></li>
<li><em><code>compile_mode</code>ï¼šè¯¥å‚æ•°ç”¨äºé€‰æ‹©æ¨¡å‹ç¼–è¯‘æ—¶çš„ä¼˜åŒ–æ–¹å‘ä¸ºå¸¦å®½è¿˜æ˜¯æ—¶å»¶ï¼Œå…³æ³¨æ€§èƒ½æ—¶è¯·é…ç½®ä¸º <code>latency</code>ã€‚</em></li>
<li><em><code>optimize_level</code>ï¼šè¯¥å‚æ•°ç”¨äºé€‰æ‹©ç¼–è¯‘å™¨çš„ä¼˜åŒ–ç­‰çº§ï¼Œå®é™…ç”Ÿäº§ä¸­åº”é…ç½®ä¸º <code>O3</code> è·å–æœ€ä½³æ€§èƒ½ã€‚</em></li>
<li><em><code>debug</code>ï¼šé…ç½®ä¸º <code>True</code> å°†æ‰“å¼€ç¼–è¯‘å™¨çš„debugæ¨¡å¼ï¼Œèƒ½å¤Ÿè¾“å‡ºæ€§èƒ½ä»¿çœŸçš„ç›¸å…³ä¿¡æ¯ï¼Œå¦‚å¸§ç‡ã€DDR å¸¦å®½å ç”¨ç­‰ã€‚ ä¸€èˆ¬ç”¨äºæ€§èƒ½è¯„ä¼°é˜¶æ®µï¼Œåœ¨äº§å“åŒ–äº¤ä»˜æ—¶å€™ï¼Œå¯å…³é—­è¯¥å‚æ•°å‡å°æ¨¡å‹å¤§å°ï¼Œæé«˜æ¨¡å‹æ‰§è¡Œæ•ˆç‡ã€‚</em></li>
<li><em><code>max_time_per_fc</code>ï¼šè¯¥å‚æ•°ç”¨äºæ§åˆ¶ç¼–è¯‘åçš„æ¨¡å‹æ•°æ®æŒ‡ä»¤çš„function-callçš„æ‰§è¡Œæ—¶é•¿ï¼Œä»è€Œå®ç°æ¨¡å‹ä¼˜å…ˆçº§æŠ¢å åŠŸèƒ½ã€‚ è®¾ç½®æ­¤å‚æ•°æ›´æ”¹è¢«æŠ¢å æ¨¡å‹çš„function-callæ‰§è¡Œæ—¶é•¿ä¼šå½±å“è¯¥æ¨¡å‹çš„ä¸Šæ¿æ€§èƒ½ã€‚</em></li>
</ul>
<p><em><strong>å¤„ç†CPUç®—å­</strong></em></p>
<p><em>æ ¹æ® <code>hrt_model_exec perf</code> çš„è¯„ä¼°ï¼Œå·²ç»ç¡®è®¤çªå‡ºçš„æ€§èƒ½ç“¶é¢ˆæ˜¯CPUç®—å­å¯¼è‡´çš„ã€‚ æ­¤ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å»ºè®®æ‚¨å…ˆæŸ¥çœ‹ <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/appendix/supported_op_list.html" >æ¨¡å‹è½¬æ¢å·¥å…·é“¾ç®—å­æ”¯æŒçº¦æŸåˆ—è¡¨ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ç« èŠ‚ï¼Œç¡®è®¤å½“å‰è¿è¡Œåœ¨CPUä¸Šçš„ç®—å­æ˜¯å¦å…·å¤‡BPUæ”¯æŒçš„èƒ½åŠ›ã€‚</em></p>
<p><em>å¦‚æœç®—å­ä¸å…·å¤‡BPUæ”¯æŒèƒ½åŠ›ï¼Œé‚£ä¹ˆå°±æ˜¯æ‚¨çš„ç®—å­å‚æ•°è¶…è¿‡äº†BPUæ”¯æŒçš„å‚æ•°çº¦æŸèŒƒå›´ï¼Œ å°†ç›¸åº”åŸå§‹æµ®ç‚¹æ¨¡å‹è®¡ç®—å‚æ•°è°ƒæ•´åˆ°çº¦æŸèŒƒå›´å†…å³å¯ã€‚ ä¸ºäº†æ–¹ä¾¿æ‚¨å¿«é€ŸçŸ¥æ™“è¶…å‡ºçº¦æŸçš„å…·ä½“å‚æ•°ï¼Œå»ºè®®æ‚¨å†ä½¿ç”¨ <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/ptq/ptq_usage/check_model.html" >éªŒè¯æ¨¡å‹ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> éƒ¨åˆ†ä»‹ç»çš„æ–¹æ³•åšä¸€éæ£€æŸ¥ï¼Œ å·¥å…·å°†ä¼šç›´æ¥ç»™å‡ºè¶…å‡ºBPUæ”¯æŒèŒƒå›´çš„å‚æ•°æç¤ºã€‚</em></p>
<p><em><strong>æ³¨æ„ï¼šä¿®æ”¹åŸå§‹æµ®ç‚¹æ¨¡å‹å‚æ•°å¯¹æ¨¡å‹è®¡ç®—ç²¾åº¦çš„å½±å“éœ€è¦æ‚¨è‡ªå·±æŠŠæ§ï¼Œ ä¾‹å¦‚Convolutionçš„ <code>input_channel</code> æˆ– <code>output_channel</code> è¶…å‡ºèŒƒå›´å°±æ˜¯ä¸€ç§è¾ƒå…¸å‹çš„æƒ…å†µï¼Œ å‡å°‘channelå¿«é€Ÿä½¿å¾—è¯¥ç®—å­è¢«BPUæ”¯æŒï¼Œå•å•åªåšè¿™ä¸€å¤„ä¿®æ”¹ä¹Ÿé¢„è®¡ä¼šå¯¹æ¨¡å‹ç²¾åº¦äº§ç”Ÿå½±å“ã€‚</strong></em></p>
<p><em>å¦‚æœç®—å­å¹¶ä¸å…·å¤‡BPUæ”¯æŒèƒ½åŠ›ï¼Œå°±éœ€è¦æ‚¨æ ¹æ®ä»¥ä¸‹æƒ…å†µåšå‡ºå¯¹åº”ä¼˜åŒ–æ“ä½œï¼š</em></p>
<ul>
<li><p><em>CPU ç®—å­å¤„äºæ¨¡å‹ä¸­éƒ¨</em></p>
<p><em>å¯¹äºCPU ç®—å­å¤„äºæ¨¡å‹ä¸­éƒ¨çš„æƒ…å†µï¼Œå»ºè®®æ‚¨ä¼˜å…ˆå°è¯•å‚æ•°è°ƒæ•´ã€ç®—å­æ›¿æ¢æˆ–ä¿®æ”¹æ¨¡å‹ã€‚</em></p>
</li>
<li><p><em>CPUç®—å­å¤„äºæ¨¡å‹é¦–å°¾éƒ¨</em></p>
<p><em>å¯¹äºCPUç®—å­å¤„äºæ¨¡å‹é¦–å°¾éƒ¨çš„æƒ…å†µï¼Œè¯·å‚è€ƒä»¥ä¸‹ç¤ºä¾‹ï¼Œä¸‹é¢ä»¥é‡åŒ–&#x2F;åé‡åŒ–èŠ‚ç‚¹ä¸ºä¾‹ï¼š</em></p>
<ul>
<li><p><em>å¯¹äºä¸æ¨¡å‹è¾“å…¥è¾“å‡ºç›¸è¿çš„èŠ‚ç‚¹ï¼Œå¯ä»¥åœ¨yamlæ–‡ä»¶model_parametersé…ç½®ç»„ï¼ˆæ¨¡å‹å‚æ•°ç»„ï¼‰ä¸­å¢åŠ  <code>remove_node_type</code> å‚æ•°ï¼Œå¹¶é‡æ–°ç¼–è¯‘æ¨¡å‹ã€‚</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">remove_node_type: &quot;Quantize; Dequantize&quot;</span><br></pre></td></tr></table></figure></div>

<p><em>æˆ–ä½¿ç”¨hb_model_modifier å·¥å…·å¯¹binæ¨¡å‹è¿›è¡Œä¿®æ”¹ï¼š</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hb_model_modifier x.bin -a Quantize -a Dequantize</span><br></pre></td></tr></table></figure></div>
</li>
<li><p><em>å¯¹äºä¸‹å›¾è¿™ç§æ²¡æœ‰ä¸è¾“å…¥è¾“å‡ºèŠ‚ç‚¹ç›¸è¿çš„æ¨¡å‹ï¼Œåˆ™éœ€è¦ä½¿ç”¨hb_model_modifierå·¥å…·åˆ¤æ–­ç›¸è¿èŠ‚ç‚¹æ˜¯å¦æ”¯æŒåˆ é™¤åæŒ‰ç…§é¡ºåºé€ä¸ªè¿›è¡Œåˆ é™¤ã€‚</em></p>
</li>
</ul>
</li>
</ul>
<p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230509142108471.png"
                      class="" title="image-20230509142108471"
                ></em></p>
<p><em>å…ˆä½¿ç”¨hb_perfå·¥å…·è·å–æ¨¡å‹ç»“æ„å›¾ç‰‡ï¼Œç„¶åä½¿ç”¨ä»¥ä¸‹ä¸¤æ¡å‘½ä»¤å¯ä»¥è‡ªä¸Šè€Œä¸‹ç§»é™¤QuantizeèŠ‚ç‚¹ï¼Œ å¯¹äºDequantizeèŠ‚ç‚¹è‡ªä¸‹è€Œä¸Šé€ä¸ªåˆ é™¤å³å¯ï¼Œæ¯ä¸€æ­¥å¯åˆ é™¤èŠ‚ç‚¹çš„åç§°å¯ä»¥é€šè¿‡ <code>hb_model_modifier x.bin</code> è¿›è¡ŒæŸ¥çœ‹ã€‚</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hb_model_modifier x.bin -r res2a_branch1_NCHW2NHWC_LayoutConvert_Input0</span><br><span class="line">hb_model_modifier x_modified.bin -r data_res2a_branch1_HzQuantize</span><br></pre></td></tr></table></figure></div>

<p><em><strong>æ€§èƒ½æ¨¡å‹è®¾è®¡å»ºè®®</strong></em></p>
<p>*æ ¹æ®æ€§èƒ½è¯„ä¼°ç»“æœï¼ŒCPUä¸Šè€—æ—¶å æ¯”å¯èƒ½å¾ˆå°ï¼Œä¸»è¦çš„æ€§èƒ½ç“¶é¢ˆè¿˜æ˜¯BPUæ¨ç†æ—¶é—´è¿‡é•¿ã€‚ è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å·²ç»æŠŠè®¡ç®—å™¨ä»¶éƒ½ç”¨ä¸Šäº†ï¼Œå‘åŠ›çš„ç©ºé—´å°±åœ¨äºæå‡è®¡ç®—èµ„æºçš„åˆ©ç”¨ç‡ã€‚ <strong>æ¯ç§èŠ¯ç‰‡éƒ½æœ‰è‡ªå·±çš„ç¡¬ä»¶ç‰¹æ€§ï¼Œç®—æ³•æ¨¡å‹çš„è®¡ç®—å‚æ•°æ˜¯å¦å¾ˆå¥½åœ°ç¬¦åˆäº†ç¡¬ä»¶ç‰¹æ€§ï¼Œ ç›´æ¥å†³å®šäº†è®¡ç®—èµ„æºçš„åˆ©ç”¨ç‡ï¼Œç¬¦åˆåº¦è¶Šé«˜åˆ™åˆ©ç”¨ç‡è¶Šé«˜ï¼Œåä¹‹åˆ™ä½</strong>ã€‚ æœ¬éƒ¨åˆ†ä»‹ç»é‡ç‚¹åœ¨äºé˜æ˜åœ°å¹³çº¿çš„ç¡¬ä»¶ç‰¹æ€§ã€‚ é¦–å…ˆï¼Œåœ°å¹³çº¿çš„èŠ¯ç‰‡æ˜¯ä¸€æ¬¾æ—¨åœ¨åŠ é€ŸCNNï¼ˆå·ç§¯ç¥ç»ç½‘ç»œï¼‰çš„èŠ¯ç‰‡ï¼Œä¸»è¦çš„è®¡ç®—èµ„æºéƒ½é›†ä¸­åœ¨å¤„ç†å„ç§å·ç§¯è®¡ç®—ã€‚ æ‰€ä»¥ï¼Œæˆ‘ä»¬å¸Œæœ›æ‚¨çš„æ¨¡å‹æ˜¯ä»¥å·ç§¯è®¡ç®—ä¸ºä¸»çš„æ¨¡å‹ï¼Œå·ç§¯ä¹‹å¤–çš„ç®—å­éƒ½ä¼šå¯¼è‡´è®¡ç®—èµ„æºçš„åˆ©ç”¨ç‡é™ä½ï¼Œä¸åŒOPçš„å½±å“ç¨‹åº¦ä¼šæœ‰æ‰€ä¸åŒã€‚*</p>
<p><em><strong>å…¶ä»–å»ºè®®</strong></em></p>
<p><em>åœ°å¹³çº¿èŠ¯ç‰‡ä¸Šçš„depthwise convolutionçš„è®¡ç®—æ•ˆç‡æ¥è¿‘100%ï¼Œæ‰€ä»¥å¯¹äºMobileNetç±»çš„æ¨¡å‹ï¼ŒBPUèŠ¯ç‰‡å…·æœ‰æ•ˆç‡ä¼˜åŠ¿ã€‚</em></p>
<p><em>å¦å¤–ï¼Œåœ¨æ¨¡å‹è®¾è®¡æ—¶ï¼Œæˆ‘ä»¬åº”å°½é‡è®©æ¨¡å‹BPUæ®µçš„è¾“å…¥è¾“å‡ºç»´åº¦é™ä½ï¼Œä»¥å‡å°‘é‡åŒ–ã€åé‡åŒ–èŠ‚ç‚¹çš„è€—æ—¶å’Œç¡¬ä»¶çš„å¸¦å®½å‹åŠ›ã€‚ ä»¥å…¸å‹çš„åˆ†å‰²æ¨¡å‹ä¸ºä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥å°†Argmaxç®—å­ç›´æ¥åˆå…¥æ¨¡å‹æœ¬èº«ã€‚ ä½†éœ€æ³¨æ„ï¼Œåªæœ‰æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼ŒArgmaxæ‰æ”¯æŒBPUåŠ é€Ÿï¼š</em></p>
<ol>
<li><em>Caffeä¸­çš„Softmaxå±‚é»˜è®¤axis&#x3D;1ï¼Œè€ŒArgMaxå±‚åˆ™é»˜è®¤axis&#x3D;0ï¼Œç®—å­æ›¿æ¢æ—¶è¦ä¿æŒaxisçš„ä¸€è‡´ã€‚</em></li>
<li><em>Argmaxçš„Channeléœ€å°äºç­‰äº64ï¼Œå¦åˆ™åªèƒ½åœ¨CPUä¸Šè®¡ç®—ã€‚</em></li>
</ol>
<blockquote>
<p><em>Depthwise convolutionæ˜¯å·ç§¯ç¥ç»ç½‘ç»œä¸­çš„ä¸€ç§ç‰¹æ®Šç±»å‹çš„å·ç§¯æ“ä½œï¼Œå®ƒåœ¨å·ç§¯å±‚ä¸­è¢«å¹¿æ³›ä½¿ç”¨ã€‚</em></p>
<p><em>ä¼ ç»Ÿçš„å·ç§¯æ“ä½œæ˜¯åœ¨è¾“å…¥æ•°æ®çš„æ¯ä¸ªé€šé“ä¸Šåº”ç”¨ä¸€ä¸ªå·ç§¯æ ¸ï¼Œå¹¶é€šè¿‡å¯¹æ‰€æœ‰é€šé“çš„è¾“å‡ºè¿›è¡Œæ±‚å’Œæ¥ç”Ÿæˆæœ€ç»ˆçš„è¾“å‡ºã€‚è€Œ<strong>depthwise convolutionå°†æ¯ä¸ªè¾“å…¥é€šé“ä¸ä¸€ä¸ªç‹¬ç«‹çš„å·ç§¯æ ¸è¿›è¡Œå·ç§¯æ“ä½œï¼Œç”Ÿæˆç›¸åº”çš„è¾“å‡ºé€šé“</strong>ã€‚æ¢å¥è¯è¯´ï¼Œdepthwise convolutionåœ¨æ¯ä¸ªè¾“å…¥é€šé“ä¸Šéƒ½æœ‰ä¸€ä¸ªå•ç‹¬çš„å·ç§¯æ ¸è¿›è¡Œæ»‘åŠ¨çª—å£è®¡ç®—ï¼Œè€Œä¸æ˜¯åœ¨æ•´ä¸ªè¾“å…¥å¼ é‡ä¸Šè¿›è¡Œå·ç§¯ã€‚</em></p>
<p><em>Depthwise convolutionçš„ä¸»è¦ç‰¹ç‚¹æ˜¯å®ƒå…·æœ‰è¾ƒå°‘çš„å‚æ•°é‡å’Œè®¡ç®—é‡ã€‚ç”±äºæ¯ä¸ªè¾“å…¥é€šé“éƒ½æœ‰ä¸€ä¸ªç‹¬ç«‹çš„å·ç§¯æ ¸ï¼Œå› æ­¤å‚æ•°çš„æ•°é‡è¾ƒå°ã€‚è¿™ä½¿å¾—depthwise convolutionåœ¨èµ„æºå—é™çš„è®¾å¤‡ä¸Šï¼ˆå¦‚ç§»åŠ¨è®¾å¤‡ã€åµŒå…¥å¼è®¾å¤‡ï¼‰å…·æœ‰æ›´ä½çš„è®¡ç®—å¤æ‚åº¦å’Œæ›´å°çš„æ¨¡å‹å°ºå¯¸ï¼Œä»è€ŒèŠ‚çœäº†å­˜å‚¨ç©ºé—´å’Œè®¡ç®—èµ„æºã€‚</em></p>
<p><em>ç„¶è€Œï¼Œdepthwise convolutionçš„è¾“å‡ºé€šé“ä»ç„¶æ˜¯è¾“å…¥é€šé“çš„çº¿æ€§ç»„åˆï¼Œé€šå¸¸éœ€è¦ä½¿ç”¨pointwise convolutionï¼ˆ1x1å·ç§¯ï¼‰æ¥å¢åŠ è¾“å‡ºé€šé“çš„æ•°é‡å’Œæ¨¡å‹çš„è¡¨è¾¾èƒ½åŠ›ã€‚é€šè¿‡depthwise convolutionå’Œpointwise convolutionçš„ç»„åˆï¼Œå¯ä»¥æ„å»ºè½»é‡çº§çš„å·ç§¯ç¥ç»ç½‘ç»œæ¨¡å‹ï¼Œå¦‚MobileNetç³»åˆ—ï¼Œä»¥åœ¨èµ„æºæœ‰é™çš„è®¾å¤‡ä¸Šå®ç°é«˜æ•ˆçš„å›¾åƒåˆ†ç±»ã€ç›®æ ‡æ£€æµ‹å’Œè¯­ä¹‰åˆ†å‰²ç­‰ä»»åŠ¡ã€‚</em></p>
</blockquote>
<blockquote>
<p><em>MobileNetæ˜¯ä¸€ç§è½»é‡çº§çš„å·ç§¯ç¥ç»ç½‘ç»œæ¶æ„ï¼Œæ—¨åœ¨åœ¨ç§»åŠ¨è®¾å¤‡å’ŒåµŒå…¥å¼è®¾å¤‡ä¸Šå®ç°é«˜æ•ˆçš„å›¾åƒåˆ†ç±»å’Œç›®æ ‡æ£€æµ‹ä»»åŠ¡ã€‚å®ƒæ˜¯ç”±Googleå›¢é˜Ÿæå‡ºçš„ï¼Œæ—¨åœ¨è§£å†³åœ¨èµ„æºå—é™çš„è®¾å¤‡ä¸Šéƒ¨ç½²æ·±åº¦å­¦ä¹ æ¨¡å‹çš„æŒ‘æˆ˜ã€‚</em></p>
<p><em>MobileNetçš„è®¾è®¡ç›®æ ‡æ˜¯åœ¨ä¿æŒè¾ƒé«˜çš„å‡†ç¡®æ€§çš„åŒæ—¶ï¼Œå¤§å¹…å‡å°‘æ¨¡å‹çš„å‚æ•°é‡å’Œè®¡ç®—å¤æ‚åº¦ã€‚å®ƒé‡‡ç”¨äº†ä¸¤ä¸ªä¸»è¦çš„æŠ€æœ¯ï¼šæ·±åº¦å¯åˆ†ç¦»å·ç§¯å’Œå®½åº¦å¯è°ƒèŠ‚ï¼ˆé€šé“æ•°å¯å˜ï¼‰ã€‚</em></p>
<ol>
<li><em>æ·±åº¦å¯åˆ†ç¦»å·ç§¯ï¼ˆDepthwise Separable Convolutionï¼‰ï¼šMobileNetä½¿ç”¨äº†ä¸€ç§æ·±åº¦å¯åˆ†ç¦»å·ç§¯çš„æ“ä½œï¼Œå°†æ ‡å‡†çš„å·ç§¯æ“ä½œåˆ†è§£ä¸ºä¸¤ä¸ªæ­¥éª¤ï¼š<strong>æ·±åº¦å·ç§¯å’Œé€ç‚¹å·ç§¯</strong>ã€‚æ·±åº¦å·ç§¯é¦–å…ˆåœ¨è¾“å…¥é€šé“ä¸Šåº”ç”¨å·ç§¯æ ¸ï¼Œç„¶åé€ç‚¹å·ç§¯å°†è¾“å‡ºé€šé“ä¸è¾“å…¥é€šé“è¿›è¡Œçº¿æ€§ç»„åˆã€‚è¿™ç§åˆ†è§£å‡å°‘äº†æ¨¡å‹çš„å‚æ•°é‡å’Œè®¡ç®—é‡ï¼ŒåŒæ—¶ä¿æŒäº†ä¸€å®šçš„ç‰¹å¾æå–èƒ½åŠ›ã€‚</em></li>
<li><em><strong>å®½åº¦å¯è°ƒèŠ‚</strong>ï¼ˆWidth Multiplierï¼‰ï¼šMobileNeté€šè¿‡æ§åˆ¶æ¯ä¸ªå·ç§¯å±‚çš„é€šé“æ•°æ¥è°ƒèŠ‚æ¨¡å‹çš„å®½åº¦ã€‚é€šé“æ•°å†³å®šäº†æ¨¡å‹çš„å¤æ‚åº¦å’Œè®¡ç®—é‡ï¼Œé€šè¿‡å‡å°‘é€šé“æ•°ï¼Œå¯ä»¥è¿›ä¸€æ­¥å‡å°æ¨¡å‹çš„å°ºå¯¸å’Œè®¡ç®—å¤æ‚åº¦ã€‚å®½åº¦å¯è°ƒèŠ‚ä½¿å¾—MobileNetå¯ä»¥åœ¨ä¸åŒçš„èµ„æºé™åˆ¶æ¡ä»¶ä¸‹è¿›è¡Œçµæ´»çš„æ¨¡å‹å¤§å°å’Œæ€§èƒ½æƒè¡¡ã€‚</em></li>
</ol>
<p><em>MobileNetçš„è®¾è®¡ä½¿å¾—å®ƒéå¸¸é€‚åˆåœ¨ç§»åŠ¨è®¾å¤‡å’ŒåµŒå…¥å¼è®¾å¤‡ä¸Šéƒ¨ç½²ã€‚å®ƒåœ¨ä¿æŒè¾ƒä½çš„æ¨¡å‹å°ºå¯¸å’Œè®¡ç®—å¤æ‚åº¦çš„åŒæ—¶ï¼Œä»ç„¶èƒ½å¤Ÿæä¾›ç›¸å¯¹è¾ƒé«˜çš„å›¾åƒåˆ†ç±»å’Œç›®æ ‡æ£€æµ‹å‡†ç¡®æ€§</em></p>
</blockquote>
<blockquote>
<p><em><strong>åœ¨æ·±åº¦å­¦ä¹ ä¸­ï¼Œaxisï¼ˆè½´ï¼‰æ˜¯æŒ‡æ•°æ®å¼ é‡ä¸­çš„ä¸€ä¸ªç‰¹å®šç»´åº¦ã€‚</strong>å¼ é‡æ˜¯å¤šç»´æ•°ç»„ï¼Œæ¯ä¸ªç»´åº¦å¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ªè½´ã€‚é€šè¿‡æŒ‡å®šè½´ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å¼ é‡ä¸­é€‰æ‹©ç‰¹å®šçš„ç»´åº¦è¿›è¡Œæ“ä½œï¼Œå¦‚æ±‚å’Œã€å¹³å‡ã€æœ€å¤§å€¼ç­‰ã€‚</em></p>
<p><em>è½´(axis)é€šå¸¸ç”¨æ•´æ•°è¡¨ç¤ºï¼Œä»0å¼€å§‹è®¡æ•°ã€‚å¯¹äºäºŒç»´å¼ é‡ï¼Œç¬¬ä¸€ä¸ªè½´æ˜¯è¡Œè½´ï¼Œç¬¬äºŒä¸ªè½´æ˜¯åˆ—è½´ã€‚å¯¹äºä¸‰ç»´å¼ é‡ï¼Œç¬¬ä¸€ä¸ªè½´æ˜¯æ·±åº¦è½´ï¼Œç¬¬äºŒä¸ªè½´æ˜¯è¡Œè½´ï¼Œç¬¬ä¸‰ä¸ªè½´æ˜¯åˆ—è½´ã€‚å¯¹äºæ›´é«˜ç»´åº¦çš„å¼ é‡ï¼Œå¯ä»¥ç±»ä¼¼åœ°é€šè¿‡è½´çš„ç´¢å¼•æ¥è®¿é—®å’Œæ“ä½œä¸åŒçš„ç»´åº¦ã€‚</em></p>
<p><em>åœ¨æ·±åº¦å­¦ä¹ ä¸­ï¼Œè½´(axis)å¸¸ç”¨äºè¿›è¡Œå„ç§å¼ é‡æ“ä½œï¼Œä¾‹å¦‚ï¼š</em></p>
<ol>
<li><em>æ±‚å’Œï¼ˆSummationï¼‰ï¼šé€šè¿‡æŒ‡å®šè½´ï¼Œå¯ä»¥æ²¿ç€è¯¥è½´å°†å¼ é‡çš„å…ƒç´ ç›¸åŠ ï¼Œå¾—åˆ°ä¸€ä¸ªç»´åº¦æ›´ä½çš„å¼ é‡ã€‚</em></li>
<li><em>å¹³å‡ï¼ˆAverageï¼‰ï¼šç±»ä¼¼äºæ±‚å’Œï¼Œé€šè¿‡æŒ‡å®šè½´ï¼Œå¯ä»¥è®¡ç®—æ²¿ç€è¯¥è½´çš„å…ƒç´ çš„å¹³å‡å€¼ã€‚</em></li>
<li><em>æœ€å¤§å€¼ï¼ˆMaximumï¼‰ï¼šé€šè¿‡æŒ‡å®šè½´ï¼Œå¯ä»¥æ‰¾åˆ°æ²¿ç€è¯¥è½´çš„å…ƒç´ çš„æœ€å¤§å€¼ã€‚</em></li>
<li><em>æ‹¼æ¥ï¼ˆConcatenationï¼‰ï¼šé€šè¿‡æŒ‡å®šè½´ï¼Œå¯ä»¥å°†å¤šä¸ªå¼ é‡æ²¿ç€è¯¥è½´è¿›è¡Œæ‹¼æ¥ï¼Œç”Ÿæˆä¸€ä¸ªæ›´å¤§çš„å¼ é‡ã€‚</em></li>
</ol>
<p><em>è½´(axis)çš„é€‰æ‹©å–å†³äºæ‰€éœ€æ“ä½œçš„ç»´åº¦å’Œä¸Šä¸‹æ–‡ã€‚</em></p>
</blockquote>
<blockquote>
<p><em><strong>ArgMaxæ˜¯ä¸€ç§æ•°å­¦è¿ç®—ï¼Œå¸¸ç”¨äºæœºå™¨å­¦ä¹ å’Œæ·±åº¦å­¦ä¹ ä¸­ã€‚å®ƒè¡¨ç¤ºåœ¨ä¸€ç»„å€¼ä¸­æ‰¾åˆ°æœ€å¤§å€¼æ‰€å¯¹åº”çš„ç´¢å¼•æˆ–ä½ç½®ã€‚</strong></em></p>
<p><em>å…·ä½“è€Œè¨€ï¼Œç»™å®šä¸€ç»„æ•°å€¼ï¼ŒArgMaxæ“ä½œä¼šè¿”å›å…¶ä¸­æœ€å¤§å€¼æ‰€å¯¹åº”çš„ç´¢å¼•æˆ–ä½ç½®ã€‚è¿™å¯ä»¥ç†è§£ä¸ºæ‰¾åˆ°æ•°ç»„ä¸­å–å¾—æœ€å¤§å€¼çš„å…ƒç´ çš„ä¸‹æ ‡ã€‚å¦‚æœæœ‰å¤šä¸ªæœ€å¤§å€¼ï¼ŒArgMaxé€šå¸¸åªè¿”å›å…¶ä¸­ä¸€ä¸ªã€‚</em></p>
<p><em>ArgMaxæ“ä½œåœ¨æœºå™¨å­¦ä¹ å’Œæ·±åº¦å­¦ä¹ ä¸­å¹¿æ³›åº”ç”¨äºå„ç§ä»»åŠ¡ï¼Œå¦‚åˆ†ç±»ã€ç›®æ ‡æ£€æµ‹å’Œè¯­ä¹‰åˆ†å‰²ç­‰ã€‚åœ¨åˆ†ç±»ä»»åŠ¡ä¸­ï¼Œé€šå¸¸ä½¿ç”¨ArgMaxæ“ä½œæ¥ç¡®å®šæ¨¡å‹å¯¹äºè¾“å…¥æ ·æœ¬çš„é¢„æµ‹ç±»åˆ«ã€‚åœ¨ç›®æ ‡æ£€æµ‹å’Œè¯­ä¹‰åˆ†å‰²ä»»åŠ¡ä¸­ï¼ŒArgMaxæ“ä½œå¯ä»¥ç”¨äºç¡®å®šåƒç´ çš„ç±»åˆ«æˆ–ç‰©ä½“çš„è¾¹ç•Œæ¡†ã€‚</em></p>
<p><em>ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾æœ‰ä¸€ä¸ªæ•°ç»„ [5, 2, 9, 1, 7]ï¼Œä½¿ç”¨ArgMaxæ“ä½œåä¼šè¿”å›ç´¢å¼•2ï¼Œå› ä¸ºå€¼9åœ¨æ•°ç»„ä¸­çš„ä½ç½®æ˜¯2ï¼Œå¹¶ä¸”æ˜¯æœ€å¤§å€¼ã€‚</em></p>
<p><em>éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒArgMaxæ“ä½œä»…è¿”å›æœ€å¤§å€¼çš„ç´¢å¼•æˆ–ä½ç½®ï¼Œè€Œä¸æ˜¯æœ€å¤§å€¼æœ¬èº«ã€‚å¦‚æœéœ€è¦è·å–æœ€å¤§å€¼æœ¬èº«ï¼Œå¯ä»¥é€šè¿‡ä½¿ç”¨ç´¢å¼•æ¥è·å–æ•°ç»„ä¸­çš„å…ƒç´ ã€‚</em></p>
</blockquote>
<p><em><strong>BPUé¢å‘é«˜æ•ˆç‡æ¨¡å‹ä¼˜åŒ–</strong></em></p>
<p><em>å­¦æœ¯ç•Œåœ¨æŒç»­ä¼˜åŒ–ç®—æ³•æ¨¡å‹çš„è®¡ç®—æ•ˆç‡ï¼ˆåŒæ ·ç®—æ³•ç²¾åº¦ä¸‹æ‰€éœ€çš„ç†è®ºè®¡ç®—é‡è¶Šå°è¶Šé«˜æ•ˆï¼‰ã€å‚æ•°æ•ˆç‡ï¼ˆåŒæ ·ç®—æ³•ç²¾åº¦ä¸‹æ‰€ç”¨å‚æ•°é‡è¶Šå°è¶Šé«˜æ•ˆï¼‰ã€‚ è¿™æ–¹é¢çš„ä»£è¡¨å·¥ä½œæœ‰EfficientNetå’ŒResNeXtï¼ŒäºŒè€…åˆ†åˆ«ä½¿ç”¨äº†Depthwise Convolutionå’ŒGroup Convolutionã€‚ é¢å¯¹è¿™æ ·çš„é«˜æ•ˆç‡æ¨¡å‹ï¼ŒGPU&#x2F;TPUæ”¯æŒæ•ˆç‡å¾ˆä½ï¼Œä¸èƒ½å……åˆ†å‘æŒ¥ç®—æ³•æ•ˆæœï¼Œå­¦æœ¯ç•Œè¢«è¿«é’ˆå¯¹GPU&#x2F;TPUåˆ†åˆ«ä¼˜åŒ–äº†EfficientNet V2&#x2F;Xå’ŒNFNetï¼Œ ä¼˜åŒ–è¿‡ç¨‹ä¸»è¦æ˜¯é€šè¿‡å‡å°‘Depthwise Convolutionçš„ä½¿ç”¨ä»¥åŠå¤§å¹…æ‰©å¤§Group Convolutionä¸­çš„Groupå¤§å°ï¼Œ è¿™äº›è°ƒæ•´éƒ½é™ä½äº†åŸæœ¬æ¨¡å‹çš„è®¡ç®—æ•ˆç‡å’Œå‚æ•°æ•ˆç‡ã€‚</em></p>
<p><em>åœ¨J5èŠ¯ç‰‡ä¸Šï¼ŒBPU é’ˆå¯¹ GroupConvï¼Œç”šè‡³ DepthwiseConv åšäº†é’ˆå¯¹æ€§çš„ä¼˜åŒ–ï¼Œæ‰€ä»¥æˆ‘ä»¬æ›´æ¨èé‡‡ç”¨*<em>Depthwise+Pointwise</em></em> ç»“æ„çš„ <strong>MobileNetv2ã€EfficientNet_lite</strong>ï¼Œ ä»¥åŠåœ°å¹³çº¿åŸºäº GroupConv æ‰‹å·¥è®¾è®¡è‡ªç ”çš„ <strong>VarGNet</strong> ä½œä¸ºæ¨¡å‹çš„ Backboneï¼Œä»¥ä¾¿è·å¾—æ›´é«˜çš„æ€§èƒ½æ”¶ç›Šã€‚*</p>
<p><em>æ›´å¤šçš„æ¨¡å‹ç»“æ„å’Œä¸šåŠ¡æ¨¡å‹éƒ½åœ¨æŒç»­æ¢ç´¢ä¸­ï¼Œæˆ‘ä»¬å°†æä¾›æ›´åŠ ä¸°å¯Œçš„æ¨¡å‹ç»™æ‚¨ä½œä¸ºç›´æ¥çš„å‚è€ƒï¼Œ è¿™äº›äº§å‡ºå°†ä¸å®šæœŸæ›´æ–°è‡³ <a class="link"   target="_blank" rel="noopener" href="https://github.com/HorizonRobotics-Platform/ModelZoo/tree/master%E3%80%82" >https://github.com/HorizonRobotics-Platform/ModelZoo/tree/masterã€‚ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></em></p>
<blockquote>
<p><em><strong>Group Convolutionï¼ˆåˆ†ç»„å·ç§¯ï¼‰æ˜¯ä¸€ç§å·ç§¯ç¥ç»ç½‘ç»œä¸­çš„æ“ä½œï¼Œå®ƒå°†è¾“å…¥ç‰¹å¾å›¾åˆ†æˆå¤šä¸ªç»„ï¼Œå¹¶å¯¹æ¯ä¸ªç»„åˆ†åˆ«è¿›è¡Œå·ç§¯æ“ä½œã€‚</strong>åœ¨æ¯ä¸ªç»„å†…éƒ¨ï¼Œè¾“å…¥ç‰¹å¾å›¾çš„é€šé“è¢«åˆ†å‰²æˆè¾ƒå°çš„å­é›†ï¼Œæ¯ä¸ªå­é›†ä¸ä¸€ç»„å·ç§¯æ ¸è¿›è¡Œå·ç§¯è®¡ç®—ï¼Œç„¶åå°†æ¯ä¸ªç»„çš„è¾“å‡ºç‰¹å¾å›¾è¿›è¡Œæ‹¼æ¥ã€‚</em></p>
<p><em>Group Convolutionçš„ä¸»è¦ç›®çš„æ˜¯å‡å°‘å·ç§¯æ“ä½œçš„è®¡ç®—é‡å’Œå‚æ•°é‡ã€‚é€šè¿‡å°†è¾“å…¥ç‰¹å¾å›¾åˆ†æˆå¤šä¸ªç»„ï¼Œæ¯ä¸ªç»„åªéœ€è¦ä¸ä¸€éƒ¨åˆ†å·ç§¯æ ¸è¿›è¡Œå·ç§¯æ“ä½œï¼Œä»è€Œå‡å°‘äº†è®¡ç®—çš„å¤æ‚åº¦ã€‚æ­¤å¤–ï¼Œç”±äºæ¯ä¸ªç»„å†…çš„é€šé“æ•°è¾ƒå°‘ï¼Œå› æ­¤å‚æ•°é‡ä¹Ÿç›¸åº”å‡å°‘ã€‚</em></p>
<p><em>å…·ä½“è€Œè¨€ï¼Œå‡è®¾è¾“å…¥ç‰¹å¾å›¾çš„é€šé“æ•°ä¸ºCï¼Œå°†å…¶åˆ†ä¸ºGä¸ªç»„ï¼Œæ¯ä¸ªç»„æœ‰C&#x2F;Gä¸ªé€šé“ã€‚å¯¹äºæ¯ä¸ªç»„ï¼Œä½¿ç”¨C&#x2F;Gä¸ªå·ç§¯æ ¸è¿›è¡Œå·ç§¯æ“ä½œï¼Œè¾“å‡ºç‰¹å¾å›¾çš„é€šé“æ•°ä¹Ÿä¸ºC&#x2F;Gã€‚æœ€åï¼Œå°†æ¯ä¸ªç»„çš„è¾“å‡ºç‰¹å¾å›¾æŒ‰é¡ºåºè¿›è¡Œæ‹¼æ¥ï¼Œå¾—åˆ°æœ€ç»ˆçš„è¾“å‡ºç‰¹å¾å›¾ã€‚</em></p>
<p><em>Group Convolutionåœ¨ä¸€äº›æ·±åº¦å­¦ä¹ æ¨¡å‹ä¸­è¢«å¹¿æ³›åº”ç”¨ï¼Œç‰¹åˆ«æ˜¯åœ¨ä¸€äº›è½»é‡çº§æ¨¡å‹ä¸­ï¼Œå¦‚MobileNetå’ŒShuffleNetã€‚é€šè¿‡é€‚å½“é€‰æ‹©ç»„çš„æ•°é‡å’Œé€šé“æ•°ï¼Œå¯ä»¥åœ¨å‡å°‘è®¡ç®—é‡å’Œå‚æ•°é‡çš„åŒæ—¶ï¼Œä»ç„¶ä¿æŒä¸€å®šçš„æ¨¡å‹æ€§èƒ½ã€‚</em></p>
</blockquote>
<blockquote>
<p><em>Depthwise Convolutionï¼ˆæ·±åº¦å·ç§¯ï¼‰æ˜¯å·ç§¯ç¥ç»ç½‘ç»œä¸­çš„ä¸€ç§å·ç§¯æ“ä½œï¼Œå®ƒä¸ä¼ ç»Ÿçš„å·ç§¯æ“ä½œï¼ˆä¹Ÿç§°ä¸ºPointwise Convolutionï¼Œå³ç‚¹å·ç§¯ï¼‰ç›¸æ¯”å…·æœ‰æ›´è½»é‡çº§çš„ç‰¹ç‚¹ã€‚</em></p>
<p><em><strong>åœ¨ä¼ ç»Ÿçš„å·ç§¯æ“ä½œä¸­ï¼Œå·ç§¯æ ¸åŒæ—¶æ“ä½œè¾“å…¥å¼ é‡çš„æ‰€æœ‰é€šé“ï¼Œå¹¶ç”Ÿæˆä¸å·ç§¯æ ¸æ•°é‡ç›¸ç­‰çš„è¾“å‡ºé€šé“ã€‚</strong>è¿™æ ·çš„æ“ä½œéœ€è¦å¤§é‡çš„è®¡ç®—èµ„æºå’Œå‚æ•°ã€‚è€ŒDepthwise Convolutionåˆ™å°†å·ç§¯æ“ä½œåˆ†è§£ä¸ºä¸¤ä¸ªæ­¥éª¤ï¼šDepthwise Convolutionå’ŒPointwise Convolutionã€‚</em></p>
<ol>
<li><em>Depthwise Convolutionï¼ˆæ·±åº¦å·ç§¯ï¼‰ï¼š<strong>Depthwise Convolutionåªåœ¨è¾“å…¥å¼ é‡çš„æ¯ä¸ªé€šé“(B,G,Rä¸‰ä¸ªé€šé“)ä¸Šåº”ç”¨ä¸€ä¸ªç‹¬ç«‹çš„å·ç§¯æ ¸</strong>ï¼Œç”Ÿæˆä¸è¾“å…¥é€šé“æ•°ç›¸ç­‰çš„è¾“å‡ºé€šé“æ•°ï¼ˆ<strong>æ²¡æœ‰åç»­å·ç§¯æ“ä½œ</strong>ï¼‰ã€‚å®ƒé€šè¿‡åœ¨é€šé“ç»´åº¦ä¸Šè¿›è¡Œå·ç§¯æ“ä½œï¼Œæ•æ‰è¾“å…¥å¼ é‡çš„ç©ºé—´ç‰¹å¾ã€‚</em></li>
<li><em>Pointwise Convolutionï¼ˆç‚¹å·ç§¯ï¼‰ï¼šPointwise Convolutionæ˜¯ä¼ ç»Ÿçš„å·ç§¯æ“ä½œï¼Œå®ƒåœ¨æ·±åº¦å·ç§¯çš„è¾“å‡ºä¸Šåº”ç”¨1x1çš„å·ç§¯æ ¸ï¼Œç”¨äºå°†ä¸åŒé€šé“ä¹‹é—´çš„ç‰¹å¾è¿›è¡Œç»„åˆå’Œæ··åˆã€‚å®ƒé€šè¿‡åœ¨é€šé“ç»´åº¦ä¸Šè¿›è¡Œå·ç§¯æ“ä½œï¼Œå®ç°é€šé“ä¹‹é—´çš„ç‰¹å¾äº¤äº’ã€‚</em></li>
</ol>
<p><em>é€šè¿‡å°†æ·±åº¦å·ç§¯å’Œç‚¹å·ç§¯ç»“åˆèµ·æ¥ï¼ŒDepthwise Convolutionèƒ½å¤Ÿæœ‰æ•ˆåœ°å‡å°‘å‚æ•°é‡å’Œè®¡ç®—é‡ã€‚å› ä¸ºæ·±åº¦å·ç§¯åªåœ¨æ¯ä¸ªé€šé“ä¸Šè¿›è¡Œå·ç§¯æ“ä½œï¼Œæ‰€ä»¥å‚æ•°æ•°é‡å¤§å¤§å‡å°‘ï¼›è€Œç‚¹å·ç§¯åˆ™ç”¨äºå¯¹é€šé“è¿›è¡Œçº¿æ€§ç»„åˆï¼Œå¢åŠ äº†æ¨¡å‹çš„è¡¨è¾¾èƒ½åŠ›ã€‚</em></p>
<p><em>Depthwise Convolutionå¹¿æ³›åº”ç”¨äºè½»é‡çº§çš„ç¥ç»ç½‘ç»œæ¶æ„ï¼Œå¦‚MobileNetç³»åˆ—ã€‚å®ƒåœ¨ä¿æŒç›¸å¯¹è¾ƒé«˜çš„å‡†ç¡®æ€§çš„åŒæ—¶ï¼Œå¤§å¹…å‡å°äº†æ¨¡å‹çš„å¤§å°å’Œè®¡ç®—å¤æ‚åº¦ï¼Œé€‚åˆäºåœ¨èµ„æºå—é™çš„è®¾å¤‡ä¸Šè¿›è¡Œæ¨ç†å’Œéƒ¨ç½²ã€‚</em></p>
</blockquote>
<blockquote>
<p><em>æ¨¡å‹ç²¾åº¦åˆ†æä¸è°ƒä¼˜</em></p>
</blockquote>
<p><em>åŸºäºå‡ åæˆ–ä¸Šç™¾å¼ æ ¡å‡†æ•°æ®å®ç°æµ®ç‚¹æ¨¡å‹åˆ°å®šç‚¹æ¨¡å‹è½¬æ¢çš„åé‡åŒ–æ–¹å¼ï¼Œä¸å¯é¿å…åœ°ä¼šå­˜åœ¨ä¸€å®šçš„ç²¾åº¦æŸå¤±ã€‚ ä½†ç»è¿‡å¤§é‡å®é™…ç”Ÿäº§ç»éªŒéªŒè¯ï¼Œå¦‚æœèƒ½ç­›é€‰å‡ºæœ€ä¼˜çš„é‡åŒ–å‚æ•°ç»„åˆï¼Œåœ°å¹³çº¿çš„è½¬æ¢å·¥å…·åœ¨å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œéƒ½å¯ä»¥å°†ç²¾åº¦æŸå¤±ä¿æŒåœ¨1%ä»¥å†…ã€‚</em></p>
<p><em>æœ¬èŠ‚å…ˆä»‹ç»äº†å¦‚ä½•æ­£ç¡®åœ°è¿›è¡Œæ¨¡å‹ç²¾åº¦åˆ†æï¼Œå¦‚æœé€šè¿‡è¯„ä¼°å‘ç°ä¸åŠé¢„æœŸï¼Œåˆ™å¯ä»¥å‚è€ƒ <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/ptq/ptq_usage/accuracy_evaluation.html#accuracy-optimization" >ç²¾åº¦è°ƒä¼˜ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> å°èŠ‚çš„å†…å®¹å°è¯•è°ƒä¼˜ï¼Œ å®åœ¨æ— æ³•è§£å†³å¯å¯»æ±‚åœ°å¹³çº¿çš„æŠ€æœ¯æ”¯æŒã€‚</em></p>
<p><em><strong>æ¨¡å‹ç²¾åº¦åˆ†æ</strong></em></p>
<p><em>åœ¨è¿›å…¥åˆ°æ­¤éƒ¨åˆ†ä»‹ç»å‰ï¼Œæˆ‘ä»¬å¸Œæœ›æ‚¨å·²ç»äº†è§£å¦‚ä½•å¯¹ä¸€ä¸ªæ¨¡å‹è¿›è¡Œç²¾åº¦è¯„æµ‹ã€‚æœ¬èŠ‚ä»‹ç»çš„å†…å®¹æ˜¯å¦‚ä½•ä½¿ç”¨æ¨¡å‹è½¬æ¢çš„äº§å‡ºç‰©è¿›è¡Œæ¨ç†ã€‚</em></p>
<p><em>å‰æ–‡æåˆ°æ¨¡å‹æˆåŠŸè½¬æ¢çš„äº§å‡ºç‰©åŒ…æ‹¬ä»¥ä¸‹å››ä¸ªéƒ¨åˆ†ï¼š</em></p>
<ul>
<li>****_original_float_model.onnx*</li>
<li>****_optimized_float_model.onnx*</li>
<li>****_quantized_model.onnx*</li>
<li>****.bin*</li>
</ul>
<p><em>è™½ç„¶æœ€åçš„binæ¨¡å‹æ‰æ˜¯å°†éƒ¨ç½²åˆ°èŠ¯ç‰‡çš„æ¨¡å‹ï¼Œè€ƒè™‘åˆ°æ–¹ä¾¿åœ¨Ubuntuå¼€å‘æœºä¸Šå®Œæˆç²¾åº¦è¯„æµ‹ï¼Œ æˆ‘ä»¬æä¾›äº†</em>**_quantized_model.onnxå®Œæˆè¿™ä¸ªç²¾åº¦è¯„æµ‹çš„è¿‡ç¨‹ã€‚ quantizedæ¨¡å‹å·²ç»å®Œæˆäº†é‡åŒ–ï¼Œä¸æœ€åçš„binæ¨¡å‹å…·æœ‰ä¸€è‡´çš„ç²¾åº¦æ•ˆæœã€‚ ä½¿ç”¨åœ°å¹³çº¿å¼€å‘åº“åŠ è½½ONNXæ¨¡å‹æ¨ç†çš„åŸºæœ¬æµç¨‹å¦‚ä¸‹æ‰€ç¤ºï¼Œè¿™ä»½ç¤ºæ„ä»£ç ä¸ä»…é€‚ç”¨äºquantizedæ¨¡å‹ï¼Œ å¯¹originalå’Œoptimizedæ¨¡å‹åŒæ ·é€‚ç”¨ï¼Œæ ¹æ®ä¸åŒæ¨¡å‹çš„è¾“å…¥ç±»å‹å’Œlayoutè¦æ±‚å‡†å¤‡æ•°æ®å³å¯ã€‚*</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åŠ è½½åœ°å¹³çº¿ä¾èµ–åº“</span></span><br><span class="line"><span class="keyword">from</span> horizon_tc_ui <span class="keyword">import</span> HB_ONNXRuntime</span><br><span class="line"></span><br><span class="line"><span class="comment"># å‡†å¤‡æ¨¡å‹è¿è¡Œçš„feed_dict</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">prepare_input_dict</span>(<span class="params">input_names</span>):</span><br><span class="line">  feed_dict = <span class="built_in">dict</span>()</span><br><span class="line">  <span class="keyword">for</span> input_name <span class="keyword">in</span> input_names:</span><br><span class="line">      <span class="comment"># your_custom_data_prepareä»£è¡¨æ‚¨çš„è‡ªå®šä¹‰æ•°æ®</span></span><br><span class="line">      <span class="comment"># æ ¹æ®è¾“å…¥èŠ‚ç‚¹çš„ç±»å‹å’Œlayoutè¦æ±‚å‡†å¤‡æ•°æ®å³å¯</span></span><br><span class="line">      feed_dict[input_name] = your_custom_data_prepare(input_name)</span><br><span class="line">  <span class="keyword">return</span> feed_dict</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">  <span class="comment"># åˆ›å»ºæ¨ç†Session</span></span><br><span class="line">  sess = HB_ONNXRuntime(model_file=<span class="string">&#x27;***_quantized_model.onnx&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment"># è·å–è¾“å…¥èŠ‚ç‚¹åç§°</span></span><br><span class="line">  input_names = [<span class="built_in">input</span>.name <span class="keyword">for</span> <span class="built_in">input</span> <span class="keyword">in</span> sess.get_inputs()]</span><br><span class="line">  <span class="comment"># æˆ–</span></span><br><span class="line">  input_names = sess.input_names</span><br><span class="line"></span><br><span class="line">  <span class="comment"># è·å–è¾“å‡ºèŠ‚ç‚¹åç§°</span></span><br><span class="line">  output_names = [output.name <span class="keyword">for</span> output <span class="keyword">in</span> sess.get_outputs()]</span><br><span class="line">  <span class="comment"># æˆ–</span></span><br><span class="line">  output_names = sess.output_names</span><br><span class="line"></span><br><span class="line">  <span class="comment"># å‡†å¤‡æ¨¡å‹è¾“å…¥æ•°æ®</span></span><br><span class="line">  feed_dict = prepare_input_dict(input_names)</span><br><span class="line">  <span class="comment"># å¼€å§‹æ¨¡å‹æ¨ç†ï¼Œæ¨ç†çš„è¿”å›å€¼æ˜¯ä¸€ä¸ªlistï¼Œä¾æ¬¡ä¸output_namesæŒ‡å®šåç§°ä¸€ä¸€å¯¹åº”</span></span><br><span class="line">  <span class="comment"># è¾“å…¥å›¾åƒçš„ç±»å‹èŒƒå›´ä¸ºï¼ˆRGB/BGR/NV12/YUV444/GRAYï¼‰</span></span><br><span class="line">  outputs = sess.run(output_names, feed_dict, input_offset=<span class="number">128</span>)</span><br><span class="line">  <span class="comment"># è¾“å…¥æ•°æ®çš„ç±»å‹èŒƒå›´ä¸ºï¼ˆFEATUREï¼‰</span></span><br><span class="line">  outputs = sess.run_feature(output_names, feed_dict, input_offset=<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">  <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">  Modification  history:</span></span><br><span class="line"><span class="string">    OE 1.3 ~ 1.6</span></span><br><span class="line"><span class="string">        outputs = sess.run(output_names, feed_dict, input_type_rt=None, float_offset=0)</span></span><br><span class="line"><span class="string">        outputs = sess.run_feature(output_names, feed_dict, &#123;input_name: &quot;featuremap&quot;&#125;, float_offset=0)</span></span><br><span class="line"><span class="string">    OE 1.7</span></span><br><span class="line"><span class="string">        outputs = sess.run(output_names, feed_dict, input_type_rt=None, float_offset=None, input_offset=128)</span></span><br><span class="line"><span class="string">        outputs = sess.run_feature(output_names, feed_dict, &#123;input_name: &quot;featuremap&quot;&#125;, float_offset=0)</span></span><br><span class="line"><span class="string">    OE 1.8 ~ 1.9</span></span><br><span class="line"><span class="string">        outputs = sess.run(output_names, feed_dict, input_offset=128)</span></span><br><span class="line"><span class="string">        outputs = sess.run_feature(output_names, feed_dict, input_offset=128)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    note: OE 1.5 åæ¶æ„ä¸Šçš„è°ƒæ•´ï¼Œå¦‚æœæ›´æ–° OE éœ€è¦é‡æ–°ç¼–è¯‘æ¨¡å‹</span></span><br><span class="line"><span class="string">  &quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure></div>

<p><em>ä¸Šè¿°ä»£ç ä¸­ï¼Œ <code>input_offset</code> å‚æ•°å¯ä»¥ä¸æä¾›ï¼Œå…¶é»˜è®¤å€¼ä¸º128ã€‚å¯¹äºæœ‰å‰å¤„ç†èŠ‚ç‚¹çš„æ¨¡å‹ï¼Œè¿™é‡Œéƒ½éœ€è¦åš-128çš„æ“ä½œã€‚å¦‚æœæ¨¡å‹è¾“å…¥å‰å¹¶æœªæ·»åŠ å‰å¤„ç†èŠ‚ç‚¹ï¼Œåˆ™éœ€è¦å°† <code>input_offset</code> è®¾ç½®ä¸º0ã€‚</em></p>
<p><em><strong>æ³¨æ„ï¼š</strong>å¯¹äºå¤šè¾“å…¥æ¨¡å‹ï¼š</em></p>
<ul>
<li><em>å¦‚æœè¾“å…¥input_typeå‡å±äºï¼ˆRGB&#x2F;BGR&#x2F;NV12&#x2F;YUV444&#x2F;GRAYï¼‰ï¼Œå¯ä»¥é‡‡ç”¨ <code>sess.run</code> æ–¹æ³•åšæ¨ç†ã€‚</em></li>
<li><em>å¦‚æœè¾“å…¥input_typeå‡å±äºï¼ˆFEATUREï¼‰ï¼Œå¯ä»¥é‡‡ç”¨ <code>sess.run_feature</code> æ–¹æ³•åšæ¨ç†ã€‚</em></li>
<li><em>è¯·æ³¨æ„ï¼Œç›®å‰æš‚ä¸æ”¯æŒè¾“å…¥ input_type ä¸ºæ··åˆç±»å‹ã€‚</em></li>
</ul>
<p><em>æ­¤å¤–ï¼Œ <code>your_custom_data_prepare</code> æ‰€ä»£è¡¨çš„è¾“å…¥æ•°æ®å‡†å¤‡è¿‡ç¨‹æ˜¯æœ€å®¹æ˜“å‡ºç°è¯¯æ“ä½œçš„éƒ¨åˆ†ã€‚ è¾ƒäºæ‚¨è®¾è®¡&amp;è®­ç»ƒåŸå§‹æµ®ç‚¹æ¨¡å‹çš„ç²¾åº¦éªŒè¯è¿‡ç¨‹ï¼Œæˆ‘ä»¬éœ€è¦æ‚¨åœ¨æ•°æ®é¢„å¤„ç†åå°†æ¨ç†è¾“å…¥æ•°æ®è¿›ä¸€æ­¥è°ƒæ•´ï¼Œ è¿™äº›è°ƒæ•´ä¸»è¦æ˜¯æ•°æ®æ ¼å¼ï¼ˆRGBã€NV12ç­‰ï¼‰ã€æ•°æ®ç²¾åº¦ï¼ˆint8ã€float32ç­‰ï¼‰å’Œæ•°æ®æ’å¸ƒï¼ˆNCHWæˆ–NHWCï¼‰ã€‚ è‡³äºå…·ä½“æ€ä¹ˆè°ƒæ•´ï¼Œè¿™ä¸ªæ˜¯ç”±æ‚¨åœ¨æ¨¡å‹è½¬æ¢æ—¶è®¾ç½®çš„ <code>input_type_train</code> ã€ <code>input_layout_train</code> ã€ <code>input_type_rt</code> å’Œ <code>input_layout_rt</code> å››ä¸ªå‚æ•°å…±åŒå†³å®šçš„ï¼Œå…¶è¯¦ç»†è§„åˆ™è¯·å‚è€ƒ <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/ptq/ptq_usage/quantize_compile.html#conversion-interpretation" >è½¬æ¢å†…éƒ¨è¿‡ç¨‹è§£è¯» <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> éƒ¨åˆ†çš„ä»‹ç»ã€‚</em></p>
<p><em>ä¸¾ä¸ªä¾‹å­ï¼Œæœ‰ä¸€ä¸ªä½¿ç”¨ImageNetè®­ç»ƒçš„ç”¨äºåˆ†ç±»çš„åŸå§‹æµ®ç‚¹æ¨¡å‹ï¼Œå®ƒåªæœ‰ä¸€ä¸ªè¾“å…¥èŠ‚ç‚¹ã€‚ è¿™ä¸ªèŠ‚ç‚¹æ¥å—BGRé¡ºåºçš„ä¸‰é€šé“å›¾ç‰‡ï¼Œè¾“å…¥æ•°æ®æ’å¸ƒä¸ºNCHWã€‚åŸå§‹æµ®ç‚¹æ¨¡å‹è®¾è®¡&amp;è®­ç»ƒé˜¶æ®µï¼ŒéªŒè¯é›†æ¨ç†å‰åšçš„æ•°æ®é¢„å¤„ç†å¦‚ä¸‹ï¼š</em></p>
<ol>
<li><em>å›¾åƒé•¿å®½ç­‰æ¯”scale,çŸ­è¾¹ç¼©æ”¾åˆ°256ã€‚</em></li>
<li><em><code>center_crop</code> æ–¹æ³•è·å–224x224å¤§å°å›¾åƒã€‚</em></li>
<li><em>æŒ‰é€šé“å‡meanã€‚</em></li>
<li><em>æ•°æ®ä¹˜ä»¥scaleç³»æ•°ã€‚</em></li>
</ol>
<p><em>ä½¿ç”¨åœ°å¹³çº¿è½¬æ¢è¿™ä¸ªåŸå§‹æµ®ç‚¹æ¨¡å‹æ—¶ï¼Œ <code>input_type_train</code> è®¾ç½® <code>bgr</code> ã€ <code>input_layout_train</code> è®¾ç½® <code>NCHW</code> ã€ <code>input_type_rt</code> è®¾ç½® <code>bgr</code> ã€ <code>input_layout_rt</code> è®¾ç½® <code>NHWC</code> ã€‚</em></p>
<p>*æ ¹æ® <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/ptq/ptq_usage/quantize_compile.html#conversion-interpretation" >è½¬æ¢å†…éƒ¨è¿‡ç¨‹è§£è¯» <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> éƒ¨åˆ†ä»‹ç»çš„è§„åˆ™ï¼Œ ***_quantized_model.onnxæ¥å—çš„è¾“å…¥åº”è¯¥ä¸ºbgr_128ã€NCHWæ’å¸ƒã€‚ å¯¹åº”åˆ°å‰æ–‡çš„ç¤ºä¾‹ä»£ç ï¼Œ <code>your_custom_data_prepare</code> éƒ¨åˆ†æä¾›çš„æ•°æ®å¤„ç†åº”è¯¥ä¸€ä¸ªè¿™æ ·çš„è¿‡ç¨‹ï¼š*</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æœ¬ç¤ºä¾‹ä½¿ç”¨skimageï¼Œå¦‚æœæ˜¯opencvä¼šæœ‰æ‰€åŒºåˆ«</span></span><br><span class="line"><span class="comment"># éœ€è¦æ‚¨ç‰¹åˆ«æ³¨æ„çš„æ˜¯ï¼Œtransformersä¸­å¹¶æ²¡æœ‰ä½“ç°å‡meanå’Œä¹˜scaleçš„å¤„ç†</span></span><br><span class="line"><span class="comment"># meanå’Œscaleæ“ä½œå·²ç»èåˆåˆ°äº†æ¨¡å‹ä¸­ï¼Œå‚è€ƒå‰æ–‡norm_type/mean_values/scale_valuesé…ç½®</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">your_custom_data_prepare_sample</span>(<span class="params">image_file</span>):</span><br><span class="line">  <span class="comment"># skimageè¯»å–å›¾ç‰‡ï¼Œå·²ç»æ˜¯NHWCæ’å¸ƒ</span></span><br><span class="line">  image = skimage.img_as_float(skimage.io.imread(image_file))</span><br><span class="line">  <span class="comment"># é•¿å®½ç­‰æ¯”scaleï¼ŒçŸ­è¾¹ç¼©æ”¾è‡³256</span></span><br><span class="line">  image = ShortSideResize(image, short_size=<span class="number">256</span>)</span><br><span class="line">  <span class="comment"># CenterCropè·å–224x224å›¾åƒ</span></span><br><span class="line">  image = CenterCrop(image, crop_size=<span class="number">224</span>)</span><br><span class="line">  <span class="comment"># skimageè¯»å–ç»“æœé€šé“é¡ºåºä¸ºRGBï¼Œè½¬æ¢ä¸ºbgr_128éœ€è¦çš„BGRé¡ºåº</span></span><br><span class="line">  image = RGB2BGR(image)</span><br><span class="line">  <span class="comment"># å¦‚æœåŸæ¨¡å‹æ˜¯ NCHW è¾“å…¥ï¼ˆinput_type_rtä¸ºnv12é™¤å¤–ï¼‰</span></span><br><span class="line">  <span class="keyword">if</span> layout == <span class="string">&quot;NCHW&quot;</span>:</span><br><span class="line">    image = HWC2CHW(image)</span><br><span class="line">  <span class="comment"># skimageè¯»å–æ•°å€¼èŒƒå›´ä¸º[0.0,1.0]ï¼Œè°ƒæ•´ä¸ºbgréœ€è¦çš„æ•°å€¼èŒƒå›´</span></span><br><span class="line">  image = image * <span class="number">255</span></span><br><span class="line">  <span class="comment"># bgr_128æ˜¯bgrå‡å»128</span></span><br><span class="line">  image = image - <span class="number">128</span></span><br><span class="line">  <span class="comment">#bgr_128ä½¿ç”¨int8</span></span><br><span class="line">  image = image.astype(np.int8)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> image</span><br></pre></td></tr></table></figure></div>



<p><em><strong>ç²¾åº¦è°ƒä¼˜</strong></em></p>
<p><em>åŸºäºå‰æ–‡çš„ç²¾åº¦åˆ†æå·¥ä½œï¼Œå¦‚æœç¡®å®šæ¨¡å‹çš„é‡åŒ–ç²¾åº¦ä¸ç¬¦åˆé¢„æœŸï¼Œåˆ™ä¸»è¦å¯åˆ†ä¸ºä»¥ä¸‹ä¸¤ç§æƒ…å†µè¿›è¡Œè§£å†³ï¼š</em></p>
<p><em>1.ç²¾åº¦æœ‰è¾ƒæ˜æ˜¾æŸå¤±ï¼ˆæŸå¤±å¤§äº4%ï¼‰ã€‚</em></p>
<p><em>è¿™ç§é—®é¢˜å¾€å¾€æ˜¯ç”±äºyamlé…ç½®ä¸å½“ï¼Œæ ¡éªŒæ•°æ®é›†ä¸å‡è¡¡ç­‰å¯¼è‡´çš„ï¼Œå¯ä»¥æ ¹æ®æˆ‘ä»¬æ¥ä¸‹æ¥æä¾›çš„å»ºè®®é€ä¸€æ’æŸ¥ã€‚</em></p>
<p><em>2.ç²¾åº¦æŸå¤±è¾ƒå°ï¼ˆ1.5%~3%ï¼‰ã€‚</em></p>
<p><em>æ’é™¤1å¯¼è‡´çš„ç²¾åº¦é—®é¢˜åï¼Œå¦‚æœä»ç„¶å‡ºç°ç²¾åº¦æœ‰å°å¹…åº¦æŸå¤±ï¼Œå¾€å¾€æ˜¯ç”±äºæ¨¡å‹è‡ªèº«çš„æ•æ„Ÿæ€§å¯¼è‡´ï¼Œå¯ä»¥ä½¿ç”¨æˆ‘ä»¬æä¾›çš„ç²¾åº¦è°ƒä¼˜å·¥å…·è¿›è¡Œè°ƒä¼˜ã€‚</em></p>
<p><em>3.åœ¨å°è¯•1å’Œ2åï¼Œå¦‚æœç²¾åº¦ä»æ— æ³•æ»¡è¶³é¢„æœŸï¼Œå¯ä»¥å°è¯•ä½¿ç”¨æˆ‘ä»¬æä¾›çš„ç²¾åº¦debugå·¥å…·è¿›è¡Œè¿›ä¸€æ­¥å°è¯•ã€‚</em></p>
<p><em>æ•´ä½“ç²¾åº¦é—®é¢˜è§£å†³æµç¨‹ç¤ºæ„å¦‚ä¸‹å›¾ï¼š</em></p>
<p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230509154920761.png"
                      class="" title="image-20230509154920761"
                ></em></p>
<p><em>ä¸€ã€ <strong>ç²¾åº¦æœ‰æ˜æ˜¾æŸå¤±ï¼ˆ4%ä»¥ä¸Šï¼‰</strong></em></p>
<p><em>é€šå¸¸æƒ…å†µä¸‹ï¼Œæ˜æ˜¾çš„ç²¾åº¦æŸå¤±å¾€å¾€æ˜¯ç”±äºå„ç§é…ç½®ä¸å½“å¼•èµ·çš„ï¼Œæˆ‘ä»¬å»ºè®®æ‚¨ä¾æ¬¡ä»pipelineã€æ¨¡å‹è½¬æ¢é…ç½®å’Œä¸€è‡´æ€§ä¸‰ä¸ªæ–¹é¢æ£€æŸ¥ã€‚</em></p>
<p><em><strong>pipelineæ£€æŸ¥</strong>ï¼š</em></p>
<p><em>pipelineæ˜¯æŒ‡æ‚¨å®Œæˆæ•°æ®å‡†å¤‡ã€æ¨¡å‹æ¨ç†ã€åå¤„ç†ã€ç²¾åº¦è¯„æµ‹Metricçš„å…¨è¿‡ç¨‹ã€‚ åœ¨ä»¥å¾€çš„å®é™…é—®é¢˜è·Ÿè¿›ç»éªŒä¸­ï¼Œæˆ‘ä»¬å‘ç°è¿™äº›éƒ¨åˆ†åœ¨åŸå§‹æµ®ç‚¹æ¨¡å‹è®­ç»ƒé˜¶æ®µä¸­æœ‰å˜åŠ¨ï¼Œå´æ²¡æœ‰åŠæ—¶æ›´æ–°åˆ°æ¨¡å‹è½¬æ¢çš„ç²¾åº¦éªŒè¯è¿‡ç¨‹æ¥æ˜¯æ¯”è¾ƒå¸¸è§çš„æƒ…å†µã€‚</em></p>
<p><em><strong>æ¨¡å‹è½¬æ¢é…ç½®æ£€æŸ¥</strong>ï¼š</em></p>
<ul>
<li><em><code>input_type_rt</code> å’Œ <code>input_type_train</code> è¯¥å‚æ•°ç”¨æ¥åŒºåˆ†è½¬åæ··åˆå¼‚æ„æ¨¡å‹ä¸åŸå§‹æµ®ç‚¹æ¨¡å‹éœ€è¦çš„æ•°æ®æ ¼å¼ï¼Œéœ€è¦è®¤çœŸæ£€æŸ¥æ˜¯å¦ç¬¦åˆé¢„æœŸï¼Œå°¤å…¶æ˜¯BGRå’ŒRGBé€šé“é¡ºåºæ˜¯å¦æ­£ç¡®ã€‚</em></li>
<li><em><code>norm_type</code>ã€ <code>mean_values</code>ã€ <code>scale_values</code> ç­‰å‚æ•°æ˜¯å¦é…ç½®æ­£ç¡®ã€‚é€šè¿‡è½¬æ¢é…ç½®å¯ä»¥ç›´æ¥åœ¨æ¨¡å‹ä¸­æ’å…¥meanå’Œscaleæ“ä½œèŠ‚ç‚¹ï¼Œ éœ€è¦ç¡®è®¤æ˜¯å¦å¯¹æ ¡éªŒ&#x2F;æµ‹è¯•å›¾ç‰‡è¿›è¡Œäº†é‡å¤çš„meanå’Œscaleæ“ä½œã€‚<strong>é‡å¤é¢„å¤„ç†æ˜¯é”™è¯¯çš„æ˜“å‘åŒºã€‚</strong></em></li>
</ul>
<p><em><strong>æ•°æ®å¤„ç†ä¸€è‡´æ€§æ£€æŸ¥</strong>ï¼š</em></p>
<ul>
<li><em><code>skimage.read</code> å’Œ <code>opencv.imread</code> æ˜¯ä¸¤ç§å¸¸ç”¨å›¾ç‰‡è¯»å–æ–¹æ³•ï¼Œè¿™ä¸¤ç§æ–¹æ³•åœ¨è¾“å‡ºçš„èŒƒå›´å’Œæ ¼å¼ä¸Šéƒ½æœ‰æ‰€åŒºåˆ«ã€‚ ä½¿ç”¨ <code>skimage</code> çš„å›¾ç‰‡è¯»å–ï¼Œå¾—åˆ°çš„æ˜¯RGBé€šé“é¡ºåºï¼Œå–å€¼èŒƒå›´ä¸º0<del>1ï¼Œæ•°å€¼ç±»å‹ä¸ºfloatï¼›è€Œä½¿ç”¨ <code>opencv</code>ï¼Œå¾—åˆ°çš„æ˜¯BGRé€šé“é¡ºåºï¼Œå–å€¼èŒƒå›´ä¸º0</del>255ï¼Œæ•°æ®ç±»å‹ä¸ºuint8ã€‚</em></li>
<li><em>åœ¨æ ¡å‡†æ•°æ®å‡†å¤‡é˜¶æ®µã€ç»™åº”ç”¨ç¨‹åºå‡†å¤‡åº”ç”¨æ ·æœ¬æ—¶ï¼Œæˆ‘ä»¬å¸¸ä½¿ç”¨numpyçš„tofileåºåˆ—åŒ–æ•°æ®ã€‚è¿™ç§æ–¹å¼ä¸ä¼šä¿å­˜shapeå’Œç±»å‹ä¿¡æ¯ï¼Œ åœ¨åŠ è½½æ—¶éƒ½éœ€è¦æ‰‹åŠ¨æŒ‡å®šï¼Œéœ€è¦æ‚¨ç¡®ä¿è¿™äº›æ–‡ä»¶çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–è¿‡ç¨‹çš„æ•°æ®ç±»å‹ã€æ•°æ®å°ºå¯¸å’Œæ•°æ®æ’å¸ƒç­‰ä¿¡æ¯éƒ½æ˜¯ä¸€è‡´çš„ã€‚</em></li>
<li><em>æ¨èæ‚¨åœ¨åœ°å¹³çº¿å·¥å…·é“¾ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œä¾ç„¶ä½¿ç”¨åŸå§‹æµ®ç‚¹æ¨¡å‹è®­ç»ƒéªŒè¯é˜¶æ®µä¾èµ–çš„æ•°æ®å¤„ç†åº“ã€‚ å¯¹äºé²æ£’æ€§è¾ƒå·®çš„æ¨¡å‹ï¼Œä¸åŒåº“å®ç°çš„åŠŸèƒ½resizeã€cropç­‰å…¸å‹åŠŸèƒ½éƒ½å¯èƒ½å¼•èµ·æ‰°åŠ¨ï¼Œè¿›è€Œå½±å“æ¨¡å‹ç²¾åº¦ã€‚</em></li>
<li><em>æ ¡éªŒå›¾ç‰‡é›†æ˜¯å¦åˆç†è®¾ç½®ã€‚æ ¡å‡†å›¾ç‰‡é›†æ•°é‡åº”è¯¥åœ¨ç™¾å¼ å·¦å³ï¼ŒåŒæ—¶æœ€å¥½å¯ä»¥è¦†ç›–åˆ°æ•°æ®åˆ†å¸ƒçš„å„ç§åœºåˆï¼Œä¾‹å¦‚åœ¨å¤šä»»åŠ¡æˆ–å¤šåˆ†ç±»æ—¶ï¼Œæ ¡éªŒå›¾ç‰‡é›†å¯ä»¥è¦†ç›–åˆ°å„ä¸ªé¢„æµ‹åˆ†æ”¯æˆ–è€…å„ä¸ªç±»åˆ«ã€‚ åŒæ—¶é¿å…åç¦»æ•°æ®åˆ†å¸ƒçš„å¼‚å¸¸å›¾ç‰‡ï¼ˆè¿‡æ›å…‰ç­‰ï¼‰ã€‚</em></li>
<li>*ä½¿ç”¨ ***_original_float_model.onnxå†éªŒè¯ä¸€éç²¾åº¦ï¼Œæ­£å¸¸æƒ…å†µä¸‹ï¼Œè¿™ä¸ªæ¨¡å‹çš„ç²¾åº¦åº”è¯¥æ˜¯ä¸åŸå§‹æµ®ç‚¹æ¨¡å‹ç²¾åº¦ä¿æŒå°æ•°ç‚¹åä¸‰åˆ°äº”ä½å¯¹é½ã€‚ å¦‚æœéªŒè¯å‘ç°ä¸æ»¡è¶³è¿™ç§å¯¹é½ç¨‹åº¦ï¼Œåˆ™è¡¨æ˜æ‚¨çš„æ•°æ®å¤„ç†éœ€è¦å†ä»”ç»†æ£€æŸ¥ã€‚*</li>
</ul>
<p><em>äºŒã€ <strong>è¾ƒå°ç²¾åº¦æŸå¤±æå‡</strong></em></p>
<p><em>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸ºé™ä½æ¨¡å‹ç²¾åº¦è°ƒä¼˜çš„éš¾åº¦ï¼Œæˆ‘ä»¬å»ºè®®æ‚¨åœ¨è½¬æ¢é…ç½®ä¸­ä½¿ç”¨çš„æ˜¯è‡ªåŠ¨å‚æ•°æœç´¢åŠŸèƒ½ã€‚ å¦‚æœå‘ç°è‡ªåŠ¨æœç´¢çš„ç²¾åº¦ç»“æœä»ä¸é¢„æœŸæœ‰ä¸€å®šçš„å·®è·ï¼Œè¾ƒäºåŸå§‹æµ®ç‚¹æ¨¡å‹çš„ç²¾åº¦æŸå¤±åœ¨1.5%åˆ°3%èŒƒå›´å·¦å³ã€‚ å¯ä»¥åˆ†åˆ«å°è¯•ä½¿ç”¨ä»¥ä¸‹å»ºè®®æé«˜ç²¾åº¦ï¼š</em></p>
<ul>
<li><em>å°è¯•åœ¨é…ç½®è½¬æ¢ä¸­æ‰‹åŠ¨æŒ‡å®š <code>calibration_type</code> ï¼Œå¯ä»¥å…ˆé€‰æ‹© <code>mix</code> ï¼Œå¦‚æœæœ€ç»ˆç²¾åº¦ä»ä¸ç¬¦åˆé¢„æœŸï¼Œå†å°è¯• <code>kl</code> &#x2F; <code>max</code> ã€‚</em></li>
<li><em>å°è¯•åœ¨é…ç½®è½¬æ¢ä¸­å¯ç”¨ <code>per_channel</code> ã€‚</em></li>
<li><em>åœ¨ <code>calibration_type</code> è®¾å®šä¸º <code>max</code> æ—¶ï¼Œ åŒæ—¶é…ç½® <code>max_percentile</code> å‚æ•°åˆ†åˆ«ä¸º <code>0.99999</code> ã€ <code>0.99995</code> ã€ <code>0.9999</code> ã€ <code>0.9995</code> ã€ <code>0.999</code> è¿›è¡Œå°è¯•ã€‚</em></li>
</ul>
<p><em>ä¸‰ã€ <strong>ç²¾åº¦debugå·¥å…·</strong></em></p>
<p><em>åœ¨å°è¯•äº†ä¸€å’ŒäºŒä¸­æä¾›çš„æ–¹æ³•åï¼Œå¦‚æœæ‚¨çš„ç²¾åº¦ä»æ— æ³•æ»¡è¶³é¢„æœŸï¼Œä¸ºäº†æ–¹ä¾¿æ‚¨å®šä½é—®é¢˜ï¼Œæˆ‘ä»¬æä¾›äº†ç²¾åº¦debugå·¥å…·ç”¨äºååŠ©æ‚¨å®šä½é—®é¢˜ã€‚ è¯¥å·¥å…·èƒ½å¤ŸååŠ©æ‚¨å¯¹æ ¡å‡†æ¨¡å‹è¿›è¡ŒèŠ‚ç‚¹ç²’åº¦çš„é‡åŒ–è¯¯å·®åˆ†æï¼Œå¿«é€Ÿå®šä½å‡ºç°ç²¾åº¦å¼‚å¸¸çš„èŠ‚ç‚¹ã€‚ å·¥å…·çš„è¯¦ç»†ä»‹ç»åŠä½¿ç”¨æ–¹æ³•æ‚¨å¯å‚è€ƒ <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/ptq/ptq_tool/accuracy_debug.html" >ç²¾åº¦debugå·¥å…· <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ç« èŠ‚ã€‚</em></p>
<p><em>æ ¹æ®ä»¥å¾€çš„å®é™…ç”Ÿäº§ç»éªŒï¼Œä»¥ä¸Šç­–ç•¥å·²ç»å¯ä»¥åº”å¯¹å„ç§å®é™…é—®é¢˜ã€‚ å¦‚æœç»è¿‡ä»¥ä¸Šå°è¯•ä»ç„¶æœªèƒ½è§£å†³æ‚¨çš„é—®é¢˜ï¼Œæ¬¢è¿åœ¨åœ°å¹³çº¿å”¯ä¸€å®˜æ–¹æŠ€æœ¯ç¤¾åŒºï¼ˆ<a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/" >https://developer.horizon.ai <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>ï¼‰å‘å¸–ä¸æˆ‘ä»¬å–å¾—è”ç³»ï¼Œ æˆ‘ä»¬å°†æ ¹æ®æ‚¨çš„å…·ä½“é—®é¢˜æä¾›æ›´å…·é’ˆå¯¹æ€§çš„æŒ‡å¯¼å»ºè®®ã€‚</em></p>
<p><em><strong>æ³¨æ„ï¼š</strong>å¯ä»¥é€šè¿‡é…ç½®éƒ¨åˆ†opä»¥int16è®¡ç®—æ¥è¿›è¡Œå°è¯•ç²¾åº¦è°ƒä¼˜ï¼š</em></p>
<ul>
<li><em>åœ¨æ¨¡å‹è½¬æ¢è¿‡ç¨‹ä¸­ï¼Œå¤§éƒ¨åˆ†opé»˜è®¤ä¼šä»¥int8çš„æ•°æ®è®¡ç®—ï¼Œåœ¨ä¸€äº›åœºæ™¯ä¸‹éƒ¨åˆ†opä½¿ç”¨int8è®¡ç®—ä¼šå¯¼è‡´ç²¾åº¦æŸå¤±æ˜æ˜¾ã€‚ æ–°ç‰ˆæœ¬æ¨¡å‹è½¬æ¢å·¥å…·é“¾å·²ç»æä¾›äº†æŒ‡å®šç‰¹å®šopä»¥int16 bitè®¡ç®—çš„èƒ½åŠ›ï¼Œ è¯¦æƒ…å¯å‚è€ƒ <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/ptq/ptq_usage/quantize_compile.html#model-parameter-group" >æ¨¡å‹å‚æ•°ç»„ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ä¸­å…³äº <code>set_node_data_type</code> å‚æ•°é…ç½®çš„è¯´æ˜ã€‚ é€šè¿‡é…ç½®é‡åŒ–ç²¾åº¦æŸå¤±æ•æ„Ÿopï¼ˆå¯ä»¥ä»¥ä½™å¼¦ç›¸ä¼¼åº¦ä¸ºå‚è€ƒï¼‰ä»¥int16 bitè®¡ç®—ï¼Œä¸€äº›åœºæ™¯ä¸‹å¯ä»¥è§£å†³ç²¾åº¦æŸå¤±é—®é¢˜ã€‚</em></li>
</ul>
<p><em><strong>ä½¿ç”¨QATé‡åŒ–æ„ŸçŸ¥è®­ç»ƒæ–¹æ¡ˆè¿›ä¸€æ­¥æå‡æ¨¡å‹ç²¾åº¦</strong></em></p>
<p><em>å¦‚æœé€šè¿‡ä¸Šè¿°åˆ†æï¼Œå¹¶æ²¡æœ‰å‘ç°ä»»ä½•é…ç½®ä¸Šçš„é—®é¢˜ï¼Œä½†æ˜¯ç²¾åº¦ä»ä¸èƒ½æ»¡è¶³è¦æ±‚ï¼Œåˆ™å¯èƒ½æ˜¯PTQæœ¬èº«çš„é™åˆ¶ã€‚ è¿™æ—¶å€™æˆ‘ä»¬å¯ä»¥æ”¹ç”¨QATçš„æ–¹å¼æ¥å¯¹æ¨¡å‹è¿›è¡Œé‡åŒ–ã€‚</em></p>
<p><em>æœ¬å°èŠ‚å†…å®¹å¯¹QATæ–¹æ¡ˆè¿›è¡Œè¯¦ç»†ä»‹ç»ï¼š</em></p>
<ul>
<li><em>é¦–å…ˆï¼Œ<a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/ptq/ptq_usage/accuracy_evaluation.html#about-quantization" >å…³äºé‡åŒ– <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ä»‹ç»é‡åŒ–çš„æ¦‚å¿µå’Œä¸¤ç§é‡åŒ–æ–¹æ³•ï¼›</em></li>
<li><em>å…¶æ¬¡ï¼Œ<a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/ptq/ptq_usage/accuracy_evaluation.html#about-conversion" >å…³äºæ¨¡å‹è½¬æ¢ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ä»‹ç»åœ°å¹³çº¿æ¨¡å‹è½¬æ¢ã€åŸå§‹æµ®ç‚¹æ¨¡å‹å’Œæ··åˆå¼‚æ„æ¨¡å‹çš„æ¦‚å¿µï¼›</em></li>
<li><em>æ¥ç€ï¼Œåœ¨ç†è§£äº†ä»¥ä¸Šä¸€äº›æ¦‚å¿µåï¼Œ<a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/ptq/ptq_usage/accuracy_evaluation.html#about-quantization-compile" >å…³äºæ¨¡å‹é‡åŒ–ç¼–è¯‘æµç¨‹ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ä¸€å°èŠ‚å†…å®¹ï¼Œè®©æ‚¨ç†è§£åœ°å¹³çº¿PTQå’ŒQATæ–¹æ¡ˆçš„å…³ç³»ï¼Œä¾¿äºæ‚¨å¯ä»¥åœ¨ä¸åŒæƒ…å†µä¸‹é€‰æ‹©æ›´åˆé€‚çš„æ¨¡å‹å¤„ç†æ–¹æ¡ˆï¼›</em></li>
<li><em>æœ€åï¼Œ<a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/ptq/ptq_usage/accuracy_evaluation.html#qat-quantzation-compile" >QATæ¨¡å‹é‡åŒ–ç¼–è¯‘ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> åˆ™æ˜¯ä¸ºæ‚¨å¼•å…¥é€šè¿‡QATæ–¹æ¡ˆå®Œæˆé‡åŒ–æ¨¡å‹ç¼–è¯‘çš„ä»‹ç»ã€‚</em></li>
</ul>
<p><em>ç›®å‰åœ¨GPUä¸Šè®­ç»ƒçš„æ¨¡å‹å¤§éƒ¨åˆ†éƒ½æ˜¯æµ®ç‚¹æ¨¡å‹ï¼Œå³å‚æ•°ä½¿ç”¨çš„æ˜¯floatç±»å‹å­˜å‚¨ã€‚ åœ°å¹³çº¿BPUæ¶æ„çš„AIèŠ¯ç‰‡ä½¿ç”¨çš„æ˜¯int8çš„è®¡ç®—ç²¾åº¦ï¼ˆä¸šå†…AIèŠ¯ç‰‡çš„é€šç”¨ç²¾åº¦ï¼‰ï¼Œèƒ½è¿è¡Œå®šç‚¹é‡åŒ–æ¨¡å‹ã€‚ é‚£ä¹ˆ <strong>ä»è®­ç»ƒå‡ºçš„æµ®ç‚¹ç²¾åº¦è½¬ä¸ºå®šç‚¹æ¨¡å‹çš„è¿‡ç¨‹ï¼Œæˆ‘ä»¬å«åšé‡åŒ–ã€‚</strong></em></p>
<p><em><strong>é‡åŒ–æ–¹æ³•æœ‰ä¸¤ç§ï¼Œåˆ†åˆ«ä¸º</strong>ï¼š</em></p>
<ul>
<li><p><em><strong>åé‡åŒ–ï¼ˆpost training quantizationï¼ŒPTQï¼‰</strong>ï¼š</em></p>
<p><em>å…ˆè®­ç»ƒæµ®ç‚¹æ¨¡å‹ï¼Œç„¶åä½¿ç”¨æ ¡å‡†å›¾ç‰‡è®¡ç®—é‡åŒ–å‚æ•°ï¼Œå°†æµ®ç‚¹æ¨¡å‹è½¬ä¸ºé‡åŒ–æ¨¡å‹ã€‚ è¯¥æ–¹æ³•ç®€å•ã€å¿«æ·ï¼Œä½†å°†æµ®ç‚¹æ¨¡å‹ç›´æ¥è½¬ä¸ºé‡åŒ–æ¨¡å‹éš¾å…ä¼šæœ‰ä¸€äº›é‡åŒ–æŸå¤±ã€‚</em></p>
<p><em><strong>æ³¨æ„</strong>ï¼šå…³äºPTQæ¨¡å‹çš„é‡åŒ–å’Œç¼–è¯‘æµç¨‹ï¼Œ <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/ptq/ptq_usage/quantize_compile.html" >æ¨¡å‹é‡åŒ–ä¸ç¼–è¯‘ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> å·²ä¸ºæ‚¨åšå‡ºäº†è¯¦ç»†ä»‹ç»ã€‚</em></p>
</li>
<li><p><em><strong>é‡åŒ–æ„ŸçŸ¥è®­ç»ƒï¼ˆquantization aware trainingï¼ŒQATï¼‰</strong>ï¼š</em></p>
<p><em>åœ¨æµ®ç‚¹è®­ç»ƒçš„æ—¶å€™ï¼Œå°±å…ˆå¯¹æµ®ç‚¹æ¨¡å‹ç»“æ„è¿›è¡Œå¹²é¢„ï¼Œå¢åŠ é‡åŒ–è¯¯å·®ï¼Œä½¿å¾—æ¨¡å‹èƒ½å¤Ÿæ„ŸçŸ¥åˆ°é‡åŒ–å¸¦æ¥çš„æŸå¤±ã€‚ è¯¥æ–¹æ³•éœ€è¦ç”¨æˆ·åœ¨å…¨é‡è®­ç»ƒé›†ä¸Šé‡æ–°è®­ç»ƒï¼Œèƒ½æœ‰æ•ˆåœ°é™ä½é‡åŒ–éƒ¨ç½²çš„é‡åŒ–è¯¯å·®ã€‚ ä¸€äº›ç¤¾åŒºæ¡†æ¶éƒ½æä¾›QATæ–¹æ¡ˆï¼Œä¾‹å¦‚pytorchçš„eager modeæ–¹æ¡ˆã€pytorchçš„fx graphæ–¹æ¡ˆã€tf-liteé‡åŒ–æ–¹æ¡ˆç­‰ã€‚</em></p>
<p><em><strong>QATè®­ç»ƒä¸æµ®ç‚¹è®­ç»ƒçš„å…³ç³»</strong></em></p>
<p><em>QATè®­ç»ƒæ˜¯ä¸€ç§finetuneæ–¹æ³•ï¼Œæœ€å¥½æ˜¯åœ¨æµ®ç‚¹ç»“æœå·²ç»æ‹Ÿåˆçš„æƒ…å†µä¸‹ï¼Œå†ç”¨QATæ–¹æ³•æå‡é‡åŒ–ç²¾åº¦ã€‚ å³ç”¨æˆ·çš„è®­ç»ƒåˆ†ä¸ºäº†ä¸¤ä¸ªæ­¥éª¤ï¼Œå…ˆè®­ç»ƒæµ®ç‚¹æ¨¡å‹ï¼Œå°†æ¨¡å‹ç²¾åº¦æå‡åˆ°æ»¡æ„çš„æŒ‡æ ‡ï¼›å†é€šè¿‡QATè®­ç»ƒï¼Œæå‡é‡åŒ–ç²¾åº¦ã€‚</em></p>
<p><em>ä¸ºäº†è®©æ¨¡å‹æ›´å¥½çš„æ„ŸçŸ¥åˆ°é‡åŒ–è¯¯å·®ï¼ŒQATè®­ç»ƒéœ€è¦ä½¿ç”¨å…¨é‡çš„è®­ç»ƒæ•°æ®é›†ã€‚ è®­ç»ƒè½®æ•°å’Œæ¨¡å‹éš¾åº¦ç›¸å…³ï¼Œå¤§çº¦æ˜¯åŸæ¥çš„æµ®ç‚¹è®­ç»ƒçš„1&#x2F;10ã€‚ å› ä¸ºæ˜¯åœ¨æµ®ç‚¹æ¨¡å‹ä¸Šfinetuneï¼Œæ‰€ä»¥QATè®­ç»ƒçš„å­¦ä¹ ç‡å°½é‡å’Œæµ®ç‚¹æ¨¡å‹çš„æœ€åå‡ ä¸ªepochä¸€è‡´ã€‚</em></p>
</li>
</ul>
<p><em><strong>å…³äºæ¨¡å‹è½¬æ¢</strong></em></p>
<p><em>æ¨¡å‹è½¬æ¢æ˜¯æŒ‡å°†åŸå§‹æµ®ç‚¹æ¨¡å‹è½¬æ¢ä¸ºåœ°å¹³çº¿æ··åˆå¼‚æ„æ¨¡å‹çš„è¿‡ç¨‹ã€‚ å…¶ä¸­ä¼šåŒ…æ‹¬æ¨¡å‹å‰å¤„ç†èŠ‚ç‚¹ä¿®æ”¹ã€åŸå§‹æ¨¡å‹å›¾ä¼˜åŒ–ã€æ¨¡å‹é‡åŒ–å’Œä¸Šæ¿æ¨¡å‹ç¼–è¯‘ç­‰è¿‡ç¨‹ã€‚</em></p>
<p><em><strong>åŸå§‹æµ®ç‚¹æ¨¡å‹</strong> ï¼ˆæ–‡ä¸­éƒ¨åˆ†åœ°æ–¹ä¹Ÿç§°ä¸ºæµ®ç‚¹æ¨¡å‹ï¼‰æ˜¯æŒ‡æ‚¨é€šè¿‡TensorFlow&#x2F;PyTorchç­‰ç­‰DLæ¡†æ¶è®­ç»ƒå¾—åˆ°çš„å¯ç”¨æ¨¡å‹ï¼Œè¿™ä¸ªæ¨¡å‹çš„è®¡ç®—ç²¾åº¦ä¸ºfloat32ï¼› ç›®å‰æˆ‘ä»¬çš„QATæ–¹æ¡ˆä¸­ï¼Œè®­ç»ƒå·¥å…·åŸºäºPytorchå¼€å‘ï¼Œå› æ­¤åªæ”¯æŒPytorchæ ¼å¼çš„æ¨¡å‹ã€‚ PTQæ–¹æ¡ˆåªæ”¯æŒCaffe&amp;ONNXæ¨¡å‹æ ¼å¼ï¼Œå› æ­¤å¯¹äºTensorFlow&#x2F;PyTorchç­‰æ ¼å¼çš„æ¨¡å‹ï¼Œéœ€è¦å…ˆé€šè¿‡è½¬æ¢åˆ°ONNXæ¨¡å‹åï¼Œæ‰èƒ½å¤Ÿè¢«åœ°å¹³çº¿çš„å·¥å…·è¿›è¡Œé‡åŒ–&amp;ç¼–è¯‘ã€‚</em></p>
<p><em><strong>æ··åˆå¼‚æ„æ¨¡å‹</strong> æ˜¯ä¸€ç§é€‚åˆåœ¨åœ°å¹³çº¿èŠ¯ç‰‡ä¸Šè¿è¡Œçš„æ¨¡å‹æ ¼å¼ï¼Œä¹‹æ‰€ä»¥è¢«ç§°ä¸ºå¼‚æ„æ¨¡å‹æ˜¯å› ä¸ºå®ƒèƒ½å¤Ÿæ”¯æŒæ¨¡å‹åŒæ—¶åœ¨ARM CPUå’ŒBPUä¸Šæ‰§è¡Œã€‚ ç”±äºåœ¨BPUä¸Šçš„è¿ç®—é€Ÿåº¦ä¼šè¿œå¤§äºCPUä¸Šçš„é€Ÿåº¦ï¼Œå› æ­¤ä¼šå°½å¯èƒ½çš„å°†ç®—å­æ”¾åœ¨BPUä¸Šè¿ç®—ã€‚ å¯¹äºBPUä¸Šæš‚æ—¶ä¸æ”¯æŒçš„ç®—å­ï¼Œåˆ™ä¼šæ”¾åœ¨CPUä¸Šè¿›è¡Œè¿ç®—ã€‚</em></p>
<p><em><strong>å…³äºæ¨¡å‹é‡åŒ–ç¼–è¯‘æµç¨‹</strong></em></p>
<p><em>æ­£å¸¸çš„æ¨¡å‹é‡åŒ–ç¼–è¯‘æµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</em></p>
<p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230509161118772.png"
                      class="" title="image-20230509161118772"
                ></em></p>
<p><em><strong>æ³¨æ„ï¼šç”±äºPTQæ–¹å¼çš„ä½¿ç”¨ä»£ä»·å°ï¼Œå› æ­¤æ¨èç”¨æˆ·é¦–å…ˆå°è¯•è¯¥æ–¹æ³•è¿›è¡Œæ¨¡å‹é‡åŒ–ç¼–è¯‘ã€‚ è‹¥å°è¯•å¹¶è°ƒä¼˜åçš„æ¨¡å‹ç²¾åº¦ä¾ç„¶æ— æ³•æ»¡è¶³è¦æ±‚ï¼Œåˆ™å¯ä»¥å†æ”¹ä¸ºå°è¯•QATæ–¹æ¡ˆã€‚</strong></em></p>
<p><em><strong>QATæ¨¡å‹é‡åŒ–ç¼–è¯‘ä»‹ç»</strong></em></p>
<p><em>Horizon Plugin Pytorchå‚è€ƒäº†PyTorchå®˜æ–¹çš„é‡åŒ–æ¥å£å’Œæ€è·¯ï¼ŒPluginé‡‡ç”¨çš„æ˜¯Quantization Aware Training(QAT)æ–¹æ¡ˆï¼Œ å› æ­¤å»ºè®®ç”¨æˆ·å…ˆé˜…è¯» <a class="link"   target="_blank" rel="noopener" href="https://pytorch.org/docs/stable/quantization.html#quantization" >PyTorchå®˜æ–¹æ–‡æ¡£ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ä¸­å’ŒQATç›¸å…³éƒ¨åˆ†ã€‚</em></p>
<p><em>æ›´è¯¦ç»†çš„å…³äºHorizon Plugin Pytorchçš„ä»‹ç»ï¼Œæ‚¨å¯ä»¥å‚è€ƒ <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/plugin/source/index.html" >é‡åŒ–æ„ŸçŸ¥è®­ç»ƒï¼ˆQATï¼‰ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ç« èŠ‚ã€‚</em></p>
<blockquote>
<p><em>å…¶ä»–æ¨¡å‹å·¥å…·</em></p>
</blockquote>
<p><em>æœ¬èŠ‚å°†å¯¹ä¸Šè¿°å¸¸è§„æµç¨‹ä¸­ä¸æ¶‰åŠçš„å·¥å…·åšç»Ÿä¸€ä»‹ç»ï¼Œè¿™äº›å·¥å…·æ˜¯ä¸ºæŸäº›ç‰¹å®šéœ€è¦æä¾›ï¼Œå¦‚æœæœ‰ç±»ä¼¼çš„éœ€æ±‚ï¼Œå¯ä»¥é…Œæƒ…é€‰ç”¨ã€‚</em></p>
<p><em><strong>æ¨¡å‹æ‰“åŒ…</strong></em></p>
<p><em>æ¨¡å‹æ‰“åŒ…æä¾›äº†å°†å¤šä¸ªè½¬æ¢åbinæ¨¡å‹æ•´åˆæˆä¸€ä¸ªæ–‡ä»¶çš„åŠŸèƒ½ï¼Œ åº”ç”¨å¼€å‘é˜¶æ®µï¼Œæˆ‘ä»¬ä¹Ÿä¸ºæ‰“åŒ…åæ¨¡å‹æä¾›äº†ç›¸å…³çš„æ¥å£ï¼Œåœ¨æ‚¨ä¸šåŠ¡åœºæ™¯ä¸­æ¨¡å‹æ¯”è¾ƒå¤šçš„æ—¶å€™å¯ä»¥ä½¿ç”¨ã€‚ æ‰“åŒ…å·¥å…· <code>hb_pack</code> ä½¿ç”¨å‘½ä»¤å¦‚ä¸‹ï¼š</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hb_pack -o dst_name.bin  to_pack_1.bin to_pack_2.bin</span><br></pre></td></tr></table></figure></div>

<p><em>å·¥å…·ä½¿ç”¨ <code>-o</code> å‚æ•°æŒ‡å®šæ‰“åŒ…åæ–‡ä»¶åç§°ã€‚</em></p>
<p><em>éœ€è¦æ‰“åŒ…çš„binæ¨¡å‹ä¾æ¬¡åœ¨å‘½ä»¤å°¾éƒ¨æ·»åŠ ï¼Œä½¿ç”¨ç©ºæ ¼åˆ†éš”å³å¯ã€‚</em></p>
<p><em><strong>æ¨¡å‹ä¿¡æ¯æŸ¥çœ‹</strong></em></p>
<p><em>æ¨¡å‹ä¿¡æ¯æŸ¥çœ‹å·¥å…·å¯ä»¥æä¾›æ¨¡å‹è½¬æ¢æ—¶ä½¿ç”¨çš„é…ç½®å‚æ•°ä¿¡æ¯ï¼Œå…¶ä½¿ç”¨å‘½ä»¤å¦‚ä¸‹ï¼š</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hb_model_info model_name.bin</span><br></pre></td></tr></table></figure></div>

<p><em><code>hb_model_info</code> ååŠ ä¸Šæ¨¡å‹åç§°å³å¯ï¼Œå¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯æ‰“åŒ…åæ¨¡å‹ï¼Œéœ€è¦å¸¦ä¸Šä¸€ä¸ªåœ¨ <code>hb_model_info</code> åå…ˆåŠ ä¸Šä¸€ä¸ª <code>-p</code> å‚æ•°ã€‚ å‘½ä»¤æ‰§è¡Œåä¼šè¾“å‡ºä¸€äº›è½¬æ¢ç¯å¢ƒä¿¡æ¯å’Œè½¬æ¢é…ç½®ä¸­ä½¿ç”¨çš„é…ç½®å‚æ•°ä¿¡æ¯ï¼Œè½¬æ¢é…ç½®å‚æ•°è§£è¯»è¯·å‚è€ƒ <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/ptq/ptq_usage/quantize_compile.html#makertbin" >ä½¿ç”¨ hb_mapper makertbin å·¥å…·è½¬æ¢æ¨¡å‹ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> éƒ¨åˆ†ä»‹ç»ã€‚</em></p>
<p><em><strong>binæ¨¡å‹èŠ‚ç‚¹ä¿®æ”¹</strong></em></p>
<p><em>å‡ºäºæŸäº›æå¤§å°ºå¯¸è¾“å…¥åœºæ™¯ä¸‹çš„æè‡´æ€§èƒ½éœ€æ±‚ï¼Œéƒ¨åˆ†è¾“å…¥çš„é‡åŒ–å’Œè½¬ç½®æ“ä½œå¯ä»¥èåˆåœ¨æ•°æ®å‰å¤„ç†ä¸­ä¸€å¹¶å®Œæˆã€‚ æ­¤æ—¶æ‚¨å¯ä»¥é€‰æ‹©ä½¿ç”¨ <code>hb_model_modifier</code> å·¥å…·ç§»é™¤è¿™äº›èŠ‚ç‚¹ï¼ˆç›®å‰å·¥å…·æ”¯æŒç§»é™¤çš„èŠ‚ç‚¹åŒ…æ‹¬ï¼š æŒ‡å®šçš„runtimeæ¨¡å‹ä¸­è¾“å…¥ç«¯çš„Transposeã€Quantizeã€Castã€ReshapeèŠ‚ç‚¹å’Œè¾“å‡ºç«¯çš„Transposeã€Dequantizeã€Castã€Reshapeã€SoftmaxèŠ‚ç‚¹ï¼‰ï¼Œ ä½¿ç”¨å‘½ä»¤å¦‚ä¸‹ï¼š</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hb_model_modifier  bin_file  -r &#123;node_name&#125;</span><br></pre></td></tr></table></figure></div>

<p><em><code>-r</code> å‚æ•°æŒ‡å®šéœ€è¦åˆ é™¤çš„èŠ‚ç‚¹åç§°ã€‚</em></p>
<p><em><code>-o</code> æŒ‡å®šåˆ é™¤èŠ‚ç‚¹åäº§ç”Ÿçš„æ–°æ¨¡å‹æ–‡ä»¶åç§°ã€‚</em></p>
<p><em><code>-a/--all</code> æŒ‡å®šèŠ‚ç‚¹ç±»å‹ï¼Œæ”¯æŒä¸€é”®åˆ é™¤æ‰€æœ‰å¯¹åº”ç±»å‹çš„åŠŸèƒ½ã€‚è‹¥æœ‰å¤šä¸ªç±»å‹èŠ‚ç‚¹éœ€è¦åˆ é™¤, éœ€è¦æŒ‡å®šå¤šæ¬¡ã€‚</em></p>
<p><em>éœ€è¦åˆ é™¤çš„èŠ‚ç‚¹åç§°å¿…é¡»ä¸binæ¨¡å‹ä¸­çš„åç§°å®Œå…¨ä¸€è‡´ï¼Œä¸”æ¯æ¬¡è°ƒç”¨å·¥å…·åªèƒ½åˆ é™¤ä¸€ä¸ªèŠ‚ç‚¹ã€‚ åœ¨ <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/ptq/ptq_usage/performance_evaluation.html#hb-perf" >ä½¿ç”¨hb_perfå·¥å…·ä¼°è®¡æ€§èƒ½ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> éƒ¨åˆ†ä»‹ç»çš„ <strong>BIN Model Structure</strong> ä¸­å¯ä»¥æŸ¥çœ‹èŠ‚ç‚¹åç§°ã€‚</em></p>
<p><em><strong>æ³¨æ„ï¼šåˆ é™¤èŠ‚ç‚¹çš„æ“ä½œå¯èƒ½ä¼šæ”¹å˜æ¨¡å‹è¾“å…¥è¾“å‡ºä¿¡æ¯ï¼Œå¯ä»¥é€šè¿‡ <code>hb_model_info</code> å·¥å…·æŸ¥çœ‹è¢«åˆ é™¤èŠ‚ç‚¹ä¿¡æ¯ï¼Œè¾“å‡ºä¿¡æ¯æœ«å°¾ä¼šæ‰“å°è¢«åˆ é™¤èŠ‚ç‚¹çš„åç§°ï¼Œ åŒæ—¶ä¼šç”Ÿæˆ <code>deleted_nodes_info.txt</code> æ–‡ä»¶ï¼Œ æ–‡ä»¶ä¸­æ¯ä¸€è¡Œè®°å½•äº†å¯¹åº”è¢«åˆ é™¤èŠ‚ç‚¹çš„åˆå§‹ä¿¡æ¯ï¼Œå¯æ®æ­¤è‡ªè¡Œå®ç°é‡åŒ–&#x2F;åé‡åŒ–ç­‰å¤„ç†é€»è¾‘ã€‚</strong></em></p>
<blockquote>
<p><em>è®­ç»ƒåé‡åŒ–ï¼ˆPTQï¼‰å¸¸è§é—®é¢˜</em></p>
</blockquote>
<p> <em><strong>å¦‚ä½•ç†è§£ç®—å­çº¦æŸä¸­æåŠçš„BPUåŠ é€Ÿå’ŒCPUè®¡ç®—ä¸¤ç§å½¢å¼</strong></em></p>
<ul>
<li><em>BPUåŠ é€Ÿï¼šæ˜¯æŒ‡æ¨¡å‹åœ¨æ¿ç«¯æ¨ç†æ—¶ï¼Œè¯¥ç®—å­å¯ä»¥é€šè¿‡BPUç¡¬ä»¶è¿›è¡Œé‡åŒ–åŠ é€Ÿã€‚å…¶ä¸­ï¼Œå¤§éƒ¨åˆ†ç®—å­ï¼ˆå¦‚convç­‰ï¼‰æ˜¯ç¡¬ä»¶ç›´æ¥æ”¯æŒçš„ï¼› æœ‰äº›ä¼šè¢«æ›¿æ¢æˆå…¶ä»–ç®—å­å®ç°åŠ é€Ÿï¼ˆå¦‚gemmä¼šè¢«æ›¿æ¢æˆconvï¼‰ï¼›è¿˜æœ‰ä¸€äº›åˆ™ä¾èµ–ç‰¹å®šçš„ä¸Šä¸‹æ–‡ï¼ˆå¦‚Reshapeã€Transposeéœ€è¦å‰åå‡ä¸ºBPUç®—å­ï¼‰æ‰èƒ½è¢«åŠ¨é‡åŒ–ã€‚</em></li>
<li><em>CPUè®¡ç®—ï¼šå¯¹äºæ¨¡å‹ä¸­BPUç¡¬ä»¶æ— æ³•ç›´æ¥æˆ–é—´æ¥åŠ é€Ÿçš„ç®—å­ï¼Œå·¥å…·é“¾ä¼šå°†å…¶æ”¾åœ¨CPUä¸Šè®¡ç®—ï¼Œruntimeé¢„æµ‹åº“ä¹Ÿä¼šåœ¨æ¨¡å‹æ¨ç†æ—¶è‡ªåŠ¨å®Œæˆæ‰§è¡Œç¡¬ä»¶çš„å¼‚æ„è°ƒåº¦ã€‚</em></li>
</ul>
<p> <em><strong>å¦‚ä½•ç†è§£æ¨¡å‹åˆ†æ®µçš„æ€§èƒ½å½±å“</strong></em></p>
<p><em>å½“æ¨¡å‹åœ¨BPUç®—å­ä¸­é—´å­˜åœ¨ä¸èƒ½åŠ é€Ÿçš„CPUç®—å­æ—¶ï¼Œå°±ä¼šè¢«åˆ‡åˆ†æˆä¸åŒçš„Subgraphï¼ˆæ¨¡å‹è½¬æ¢æ—¥å¿—ä¸­ä¼šé€šè¿‡ä¸åŒçš„idå·è¿›è¡ŒåŒºåˆ†ï¼‰ï¼Œä»è€Œå¼•å…¥ä¸€å®šçš„æ€§èƒ½æŸè€—ï¼Œå…·ä½“åŒ…æ‹¬ä¸¤æ–¹é¢ï¼š</em></p>
<ul>
<li><em>CPUç®—å­æ€§èƒ½è¿œä½äºBPUç®—å­ï¼›</em></li>
<li><em><strong>CPUå’ŒBPUä¹‹é—´çš„å¼‚æ„è°ƒåº¦è¿˜ä¼šå¼•å…¥é‡åŒ–ã€åé‡åŒ–ç®—å­ï¼ˆè¿è¡Œåœ¨CPUä¸Šï¼‰</strong>ï¼Œä¸”å› ä¸ºå†…éƒ¨è®¡ç®—éœ€è¦éå†æ•°æ®ï¼Œæ‰€ä»¥å…¶è€—æ—¶ä¼šä¸shapeå¤§å°æˆæ­£æ¯”ã€‚</em></li>
</ul>
<p><em>ä»¥ä¸ŠCPUç®—å­å’Œé‡åŒ–ã€åé‡åŒ–ç®—å­å‡å¯é€šè¿‡æ¿ç«¯å·¥å…·hrt_model_execä¼ å…¥ <code>profile_path</code> å‚æ•°å®æµ‹å¾—åˆ°ã€‚åœ°å¹³çº¿å»ºè®®æ‚¨å°½é‡é€‰æ‹©BPUç®—å­æ­å»ºæ¨¡å‹ï¼Œä»¥è·å–æ›´å¥½çš„æ€§èƒ½è¡¨ç°ã€‚</em></p>
<blockquote>
<p><em>åœ¨è¿™ä¸ªå¼‚æ„è°ƒåº¦è¿‡ç¨‹ä¸­ï¼Œå¯èƒ½æ¶‰åŠåˆ°é‡åŒ–å’Œåé‡åŒ–ç®—å­ã€‚é‡åŒ–æ˜¯æŒ‡å°†æµ®ç‚¹å‹æ•°æ®è½¬æ¢ä¸ºå®šç‚¹å‹æˆ–ä½ç²¾åº¦çš„è¡¨ç¤ºå½¢å¼ï¼Œä»¥é™ä½è®¡ç®—å’Œå­˜å‚¨å¼€é”€ã€‚åé‡åŒ–åˆ™æ˜¯å°†å®šç‚¹å‹æˆ–ä½ç²¾åº¦çš„æ•°æ®é‡æ–°è½¬æ¢ä¸ºæµ®ç‚¹å‹æ•°æ®ã€‚è¿™äº›é‡åŒ–å’Œåé‡åŒ–çš„æ“ä½œé€šå¸¸éœ€è¦åœ¨CPUä¸Šè¿›è¡Œï¼Œå› ä¸ºCPUåœ¨å¤„ç†å¤æ‚çš„ç®—æ³•å’Œæ•°æ®ç±»å‹æ—¶å…·æœ‰æ›´çµæ´»çš„èƒ½åŠ›ã€‚</em></p>
</blockquote>
<p><em><strong>å¦‚ä½•ç†è§£æ¨¡å‹å°¾éƒ¨éƒ¨åˆ†BPUå¯åŠ é€Ÿç®—å­è¿è¡Œåœ¨CPUä¸Š</strong></em></p>
<p><em>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦ç†è§£ä»¥ä¸‹ä¸¤ä¸ªæ¦‚å¿µï¼š</em></p>
<ul>
<li><em>J5èŠ¯ç‰‡ç®—æ³•å·¥å…·é“¾ç›®å‰åªåœ¨æ¨¡å‹å°¾éƒ¨æ”¯æŒConvç®—å­ä»¥int32é«˜ç²¾åº¦è¾“å‡ºï¼Œå…¶ä»–ç®—å­éƒ½åªèƒ½ä»¥int8ä½ç²¾åº¦è¾“å‡ºï¼›</em></li>
<li><em>é€šå¸¸æƒ…å†µä¸‹ï¼Œæ¨¡å‹è½¬æ¢ä¼šåœ¨optimizationé˜¶æ®µå°†Convä¸å…¶åçš„BNå’ŒReLU&#x2F;ReLU6èåˆåœ¨ä¸€èµ·è¿›è¡Œè®¡ç®—ã€‚ ä½†ç”±äºBPUç¡¬ä»¶æœ¬èº«é™åˆ¶ï¼Œåœ¨æ¨¡å‹å°¾éƒ¨ä»¥int32é«˜ç²¾åº¦è¾“å‡ºçš„Convå´å¹¶ä¸æ”¯æŒç®—å­èåˆã€‚</em></li>
</ul>
<p><em>æ‰€ä»¥å¦‚æœæ¨¡å‹ä»¥Conv+ReLU&#x2F;ReLU6ç»“å°¾ï¼Œé‚£ä¹ˆä¸ºäº†ä¿è¯é‡åŒ–æ¨¡å‹çš„æ•´ä½“ç²¾åº¦ï¼ŒConvä¼šé»˜è®¤ä»¥int32é«˜ç²¾åº¦è¾“å‡ºï¼ŒReLU&#x2F;ReLU6åˆ™ä¼šè·‘åœ¨CPUä¸Šã€‚ åŒç†ï¼Œå…¶ä»–å°¾éƒ¨å¯åŠ é€Ÿç®—å­è¿è¡Œåœ¨CPUä¸Šä¹Ÿéƒ½æ˜¯é»˜è®¤ç²¾åº¦ä¼˜å…ˆçš„é€‰æ‹©ã€‚ä¸è¿‡ï¼Œåœ°å¹³çº¿æ”¯æŒåœ¨yamlæ–‡ä»¶å°†è¿™äº›ç®—å­é…ç½® <code>run_on_bpu</code> ï¼Œä»è€Œè·å–æ›´å¥½çš„æ€§èƒ½è¡¨ç°ï¼Œä½†ä¼šå¼•å…¥ä¸€å®šçš„ç²¾åº¦æŸå¤±ã€‚</em></p>
<p><em><strong>æ˜¯å¦æ”¯æŒéå¯¹ç§°é‡åŒ–</strong></em></p>
<p><em>ç›®å‰åœ°å¹³çº¿çš„J5èŠ¯ç‰‡ç®—æ³•å·¥å…·é“¾é»˜è®¤ä¸ºå¯¹ç§°é‡åŒ–ï¼Œéå¯¹ç§°é‡åŒ–ä»…ä¼šåœ¨å°‘æ•°æƒ…å†µä¸‹ä¼šè¢«defaultæ ¡å‡†æ–¹å¼æœç´¢åˆ°ï¼Œæš‚ä¸æ”¯æŒç”¨æˆ·ä¸»åŠ¨å¼€å¯ã€‚</em></p>
<p><em><strong>å¦‚ä½•ç†è§£åœ°å¹³çº¿çš„defaultæ ¡å‡†æ–¹å¼</strong></em></p>
<p><em>ä¸ºäº†å‡è½»ç”¨æˆ·è°ƒè¯•æ ¡å‡†æ–¹æ¡ˆçš„å·¥ä½œé‡ï¼Œåœ°å¹³çº¿æä¾›äº†defaultè‡ªåŠ¨æœç´¢ç­–ç•¥ï¼Œå½“å‰å…¶å†…éƒ¨é€»è¾‘å¦‚ä¸‹ï¼š</em></p>
<p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230509163550937.png"
                      class="" title="image-20230509163550937"
                ></em></p>
<ul>
<li><em>Step1ï¼šå°è¯•Maxã€Max-Percentile 0.99995å’ŒKLä¸‰ç§æ ¡å‡†æ–¹æ³•ï¼Œè®¡ç®—å¾—åˆ°åˆ†åˆ«çš„ä½™å¼¦ç›¸ä¼¼åº¦ã€‚ å¦‚æœä¸‰ç§æ–¹æ³•ä¸­çš„æœ€é«˜ä½™å¼¦ç›¸ä¼¼åº¦å°äº0.995ï¼Œè¿›å…¥Step2ï¼›åä¹‹ï¼Œè¿”å›æœ€é«˜ç›¸ä¼¼åº¦å¯¹åº”çš„é˜ˆå€¼ç»„åˆã€‚</em></li>
<li><em>Step2ï¼šå°è¯•Max-Percentile 0.99995å’Œperchannelé‡åŒ–çš„ç»„åˆæ–¹æ³•ï¼Œå¦‚æœå››ç§æ–¹æ³•ä¸­çš„æœ€é«˜ä½™å¼¦ç›¸ä¼¼åº¦å°äº0.995ï¼Œè¿›å…¥Step3ï¼› åä¹‹ï¼Œè¿”å›æœ€é«˜ç›¸ä¼¼åº¦å¯¹åº”çš„é˜ˆå€¼ç»„åˆã€‚</em></li>
<li><em>Step3ï¼šé€‰å–Step2ä¸­æœ€é«˜ä½™å¼¦ç›¸ä¼¼åº¦å¯¹åº”çš„æ–¹æ³•ï¼Œåº”ç”¨éå¯¹ç§°é‡åŒ–ä½œä¸ºç¬¬5ç§æ–¹æ³•ï¼Œæ ¹æ®ä½™å¼¦ç›¸ä¼¼åº¦é€‰å–5ç§æ–¹æ¡ˆä¸­çš„æœ€ä½³æ–¹æ¡ˆï¼Œ è¿”å›å¯¹åº”çš„é˜ˆå€¼ç»„åˆã€‚</em></li>
</ul>
<p><em><strong>å¦‚ä½•ç†è§£åœ°å¹³çº¿çš„mixæ ¡å‡†æ–¹å¼</strong></em></p>
<p><em>ä¸ºäº†é›†æˆä¸åŒæ ¡å‡†æ–¹æ³•çš„ä¼˜åŠ¿ï¼Œåœ°å¹³çº¿æä¾›äº†mixæœç´¢ç­–ç•¥ï¼Œå½“å‰å…¶å†…éƒ¨é€»è¾‘å¦‚ä¸‹ï¼š</em></p>
<p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230509163811644.png"
                      class="" title="image-20230509163811644"
                ></em></p>
<ul>
<li><em>Step1ï¼šé‡‡ç”¨KLæ ¡å‡†æ–¹æ³•ï¼Œè®¡ç®—å½“å‰æ¨¡å‹ä¸­èŠ‚ç‚¹çš„é‡åŒ–æ•æ„Ÿåº¦ï¼ˆä½¿ç”¨ä½™å¼¦ç›¸ä¼¼åº¦æ¥è¡¡é‡ï¼‰ï¼Œå°†å€¼å°äºç‰¹å®šé˜ˆå€¼çš„èŠ‚ç‚¹å®šä¹‰ä¸º é‡åŒ–æ•æ„ŸèŠ‚ç‚¹ï¼ˆå¯¹æ¨¡å‹é‡åŒ–ç²¾åº¦å½±å“è¾ƒå¤§çš„èŠ‚ç‚¹ï¼‰ã€‚</em></li>
<li><em>Step2ï¼šéå†æ‰€æœ‰é‡åŒ–æ•æ„ŸèŠ‚ç‚¹ï¼Œåœ¨æ¯ä¸€ä¸ªèŠ‚ç‚¹ä¸Šå°è¯•Maxã€Max-Percentile 0.99995å’ŒKLä¸‰ç§æ ¡å‡†æ–¹æ³•ï¼Œ å¹¶ä¸ºè¯¥èŠ‚ç‚¹é€‰å‡ºæœ€ä½³çš„æ ¡å‡†æ–¹æ³•ï¼Œæœ€ç»ˆå¾—åˆ°Mixæ ¡å‡†æ¨¡å‹ã€‚</em></li>
<li><em>Step3ï¼šè¯„ä¼°Mixã€Maxã€Max-Percentile 0.99995å’ŒKLæ ¡å‡†æ¨¡å‹çš„ç´¯ç§¯è¯¯å·®æƒ…å†µï¼Œè¾“å‡ºæœ€ä¼˜æ¨¡å‹ã€‚</em></li>
</ul>
<p> <em><strong>å¦‚ä½•ç†è§£yamlæ–‡ä»¶ä¸­çš„ç¼–è¯‘å™¨ä¼˜åŒ–ç­‰çº§å‚æ•°</strong></em></p>
<p><em>åœ¨æ¨¡å‹è½¬æ¢çš„yamlé…ç½®æ–‡ä»¶ä¸­ï¼Œç¼–è¯‘å‚æ•°ç»„æä¾›äº†optimize_levelå‚æ•°æ¥é€‰æ‹©æ¨¡å‹ç¼–è¯‘çš„ä¼˜åŒ–ç­‰çº§ï¼Œå¯é€‰èŒƒå›´ä¸º O0~O3ã€‚å…¶ä¸­ï¼š</em></p>
<ul>
<li><em>O0 ä¸åšä»»ä½•ä¼˜åŒ–ï¼Œ<strong>ç¼–è¯‘é€Ÿåº¦æœ€å¿«ï¼Œé€‚åˆåœ¨æ¨¡å‹è½¬æ¢åŠŸèƒ½éªŒè¯ã€è°ƒè¯•ä¸åŒæ ¡å‡†æ–¹å¼æ—¶ä½¿ç”¨ã€‚</strong></em></li>
<li><em>O3 ä¼˜åŒ–ç­‰çº§æœ€é«˜ï¼Œå¯ä»¥è·å¾—æ¨¡å‹æœ€ä½³æ€§èƒ½ï¼Œä½†ç¼–è¯‘æ—¶é—´ä¹Ÿç›¸å¯¹è¾ƒé•¿ã€‚</em></li>
<li><em>åœ¨ O1ï½O3 èŒƒå›´å†…ï¼Œä¼˜åŒ–ç­‰çº§è¶Šé«˜ï¼Œç¼–è¯‘ä¼˜åŒ–æ—¶çš„æœç´¢ç©ºé—´å°±ä¼šè¶Šå¤§ã€‚åŒæ—¶ï¼Œä¸€äº›æ¯”è¾ƒè€—æ—¶çš„ä¼˜åŒ–ç­–ç•¥ä¹Ÿä»…ä¼šåœ¨ O2&#x2F;O3 ç­‰çº§æ‰ä¼šå¯ç”¨ã€‚</em></li>
<li><em>ç¼–è¯‘å™¨çš„ä¼˜åŒ–ç­–ç•¥å¹¶ä¸æ˜¯ç®—å­ç²’åº¦å±‚é¢çš„ï¼Œè€Œæ˜¯é’ˆå¯¹æ•´ä¸ªæ¨¡å‹çš„å…¨å±€ä¼˜åŒ–ã€‚</em></li>
</ul>
<p><em><strong>ä¸ºä½•nv12 æ¨¡å‹ hb_perf å¾—å‡ºçš„è¾“å…¥å¤§å°å’Œé¢„æµ‹åº“ä¸ä¸€è‡´ï¼Ÿ</strong></em></p>
<p><em>NV12å›¾åƒæ ¼å¼å±äºYUVé¢œè‰²ç©ºé—´ä¸­çš„YUV420SPæ ¼å¼ï¼Œæ˜¯æ‘„åƒå¤´å¯ç›´æ¥è¾“å‡ºçš„è§†é¢‘æ ¼å¼ã€‚ç”±äºä¸€èˆ¬åœ¨å®é™…è®­ç»ƒæ—¶ä¸ä¼šä½¿ç”¨è¿™ç§æ ¼å¼ï¼Œ å› æ­¤åº•å±‚ç¡¬ä»¶æ‹¿åˆ°æ‘„åƒå¤´è¾“å‡ºçš„æ•°æ®åï¼Œä¼šå…ˆå°†å…¶è½¬æ¢ä¸ºyuv444çš„æ ¼å¼å†è¿›è¡Œåç»­æ¨ç†ï¼ˆè¯¥è½¬æ¢è¿‡ç¨‹ç”¨æˆ·ä¸æ„ŸçŸ¥ï¼Œæ¿ç«¯æ¨ç†æ—¶åªéœ€ä¾æ®æ¨¡å‹è½¬æ¢æ—¶é…ç½®çš„input_type_rtå‡†å¤‡å¯¹åº”ç±»å‹çš„æ•°æ®å³å¯ï¼‰ã€‚ hb_perfå·¥å…·æ˜¾ç¤ºçš„æ˜¯nv12æ•°æ®çš„å¤§å°ï¼ˆå³NxHxWx3&#x2F;2ï¼‰ï¼Œè€Œæ¿ç«¯hrt_model_exec model_infoè·å–åˆ°çš„æ•°æ®å¤§å°åˆ™æ˜¯æ¨¡å‹çœŸå®è¾“å…¥çš„æ•°æ®å¤§å°ï¼ˆå³NxHxWx3ï¼‰ã€‚ <strong>ä¸”ç”±äºnv12æ•°æ®å·²ç»ä¸å…·æœ‰channelçš„æ¦‚å¿µäº†ï¼Œæ¿ç«¯éƒ¨ç½²æ—¶ç”¨æˆ·åªéœ€ä¾æ®è¾“å…¥èŠ‚ç‚¹çš„Hå’ŒWä¿¡æ¯ï¼Œå‡†å¤‡å¯¹åº”å¤§å°çš„nv12æ•°æ®å³å¯ã€‚</strong></em></p>
<p><em><strong>é‡åŒ–æ¨¡å‹å’Œä¸Šæ¿binæ¨¡å‹çš„è¾“å…¥çš„æ•°æ®æ’å¸ƒæ˜¯å¦ä¸€å®šä¸€è‡´</strong></em></p>
<p><em>onnxæ¨¡å‹å’Œä¸Šæ¿binæ¨¡å‹çš„è¾“å…¥æ•°æ®æ’å¸ƒ <strong>ä¸ä¸€å®šå®Œå…¨ä¸€è‡´</strong> ã€‚.binçš„è¾“å…¥æ•°æ®æ’å¸ƒä¸yamlé…ç½®æ–‡ä»¶ä¸­çš„input_layout_rtå¯¹é½ï¼Œä½†quanti.onnxçš„æ•°æ®æ’å¸ƒåˆ™ä¼šå› ä¸ºå¤šç§å› ç´ å‘ç”Ÿæ”¹å˜ï¼Œä¾‹å¦‚ï¼š</em></p>
<ul>
<li><em>å½“æ¨¡å‹çš„input type rtè®¾ç½®ä¸º <strong>nv12</strong> æ—¶ï¼Œinput_sourceé»˜è®¤ä¸º <strong>pyramid</strong> ï¼Œ å½“è¾“å…¥ä¸ºpyramidæ—¶ï¼Œé‡åŒ–æ¨¡å‹quanti.onnx çš„è¾“å…¥å‡ä¸ºNHWCã€‚</em></li>
<li><em>å½“input type rtä¸º <strong>yuv444&#x2F;rgb&#x2F;bgr</strong> ç­‰ç±»å‹æ—¶ï¼Œinput_source é»˜è®¤ä¸º <strong>ddr</strong> ï¼Œ æ­¤æ—¶é‡åŒ–æ¨¡å‹quanti.onnx çš„è¾“å…¥ä¸åŸå§‹æµ®ç‚¹æ¨¡å‹ä¸€è‡´ã€‚</em></li>
</ul>
<p><em>æ­¤å¤–å…¶ä»–åœºæ™¯ä¹Ÿæœ‰å¯èƒ½ä¼šå‡ºç°</em><em>.onnxä¸</em><em>.binè¾“å…¥æ•°æ®æ’å¸ƒä¸ä¸€è‡´çš„æƒ…å†µã€‚</em></p>
<p><em>å› æ­¤ï¼Œå½“æ‚¨åœ¨PCç«¯æ¨ç†</em>**.onnxæ—¶ï¼Œå»ºè®®ä½¿ç”¨å¯è§†åŒ–å·¥å…·æŸ¥çœ‹ä¸€ä¸‹onnxæ¨¡å‹çš„è¾“å…¥shapeï¼Œå¹¶å‡†å¤‡å¯¹åº”çš„æ•°æ®ã€‚ å½“åœ¨æ¿ç«¯æ¨ç†.binæ¨¡å‹æ—¶ï¼Œåˆ™ä¾æ®è½¬æ¢æ—¶é…ç½®çš„input_layout_rtæˆ–ä½¿ç”¨å·¥å…·hrt_model_exec model_infoä»¥åŠBPU SDKç›¸å…³APIï¼ˆhbDNNGetInputTensorProperties()ï¼‰è·å–.binæ¨¡å‹çš„è¾“å…¥shapeã€‚ å½“æ‚¨ä½¿ç”¨åŒä¸€å¼ å›¾ç‰‡æ¨ç†quanti.onnxä»¥åŠ.binå‘ç°è¾“å‡ºç»“æœå·®å¼‚å¾ˆå¤§æ—¶ï¼Œå»ºè®®æ‚¨å…ˆæ’æŸ¥è¾“å…¥æ•°æ®æ’å¸ƒæ˜¯å¦æ­£ç¡®ã€‚*</p>
<blockquote>
<p><em>åœ¨æ·±åº¦å­¦ä¹ ä¸­ï¼Œé‡‘å­—å¡”ï¼ˆpyramidï¼‰æ˜¯æŒ‡ä¸€ç§å¤šå°ºåº¦çš„æŠ€æœ¯ï¼Œå…¶å¯ä»¥ä½¿ç”¨ä¸åŒå°ºåº¦çš„ç‰¹å¾å›¾æ¥æ”¹è¿›æ¨¡å‹çš„æ€§èƒ½ã€‚</em></p>
<p><em>é‡‘å­—å¡”æŠ€æœ¯æœ€åˆç”¨äºè®¡ç®—æœºè§†è§‰é¢†åŸŸï¼Œç”¨äºè§£å†³å›¾åƒå°ºåº¦çš„é—®é¢˜ã€‚å½“ä½¿ç”¨ä¸€ä¸ªå›ºå®šçš„å°ºåº¦è¿›è¡Œè®¡ç®—æ—¶ï¼Œæ— æ³•æå–å‡ºå„ç§å°ºåº¦çš„ç‰¹å¾ä¿¡æ¯ï¼Œå› æ­¤éœ€è¦å¯¹å›¾åƒè¿›è¡Œé‡‘å­—å¡”å¤„ç†ï¼Œä»è€Œåœ¨å¤šä¸ªä¸åŒçš„å°ºåº¦ä¸Šè¿›è¡Œåˆ†æã€‚åœ¨æ·±åº¦å­¦ä¹ ä¸­ï¼Œé‡‘å­—å¡”æŠ€æœ¯åŒæ ·é€‚ç”¨äºè§£å†³ç‰¹å¾æå–çš„å°ºåº¦é—®é¢˜ã€‚</em></p>
<p><em>åœ¨æ·±åº¦å­¦ä¹ ä¸­çš„é‡‘å­—å¡”ä¸»è¦æœ‰ä¸¤ç§ç±»å‹ï¼š</em></p>
<ol>
<li><em><strong>å›¾åƒé‡‘å­—å¡”</strong>ï¼šè¿™ç§é‡‘å­—å¡”æ–¹æ³•ä»åŸå§‹å›¾åƒå¼€å§‹ï¼ŒæŒ‰ç…§ä¸åŒçš„å°ºåº¦å¯¹å›¾åƒè¿›è¡Œç¼©æ”¾ï¼Œéšåå°†æ¯ä¸ªå°ºåº¦çš„å›¾åƒè¾“å…¥åˆ°æ¨¡å‹ä¸­è¿›è¡Œç‰¹å¾æå–ï¼Œä»è€Œå¾—åˆ°ä¸åŒå°ºåº¦çš„ç‰¹å¾ã€‚å›¾åƒé‡‘å­—å¡”ä¸€èˆ¬åœ¨å·ç§¯ç¥ç»ç½‘ç»œï¼ˆCNNï¼‰å’Œå›¾åƒåˆ†å‰²ä¸­ä½¿ç”¨ã€‚</em></li>
<li><em><strong>ç‰¹å¾é‡‘å­—å¡”</strong>ï¼šè¿™ç§é‡‘å­—å¡”æ–¹æ³•åœ¨æ¨¡å‹çš„ä¸­é—´å±‚æ”¶é›†å¤šå°ºåº¦çš„ç‰¹å¾å›¾ï¼Œé€šè¿‡ä¸Šé‡‡æ ·ã€æ’å€¼ç­‰æ–¹å¼å°†ä¸åŒå°ºåº¦çš„ç‰¹å¾å›¾è¿›è¡Œå¯¹é½ï¼Œä»è€Œå…è®¸ç‰¹å¾å›¾åœ¨å¤šä¸ªå°ºåº¦ä¸Šè¿›è¡Œåˆ†ç±»æˆ–è€…åˆ†å‰²ã€‚ç‰¹å¾é‡‘å­—å¡”ä¸€èˆ¬åœ¨å®ç°ç›®æ ‡æ£€æµ‹ç­‰ä»»åŠ¡æ—¶ä½¿ç”¨ã€‚</em></li>
</ol>
<p><em>åœ¨æ·±åº¦å­¦ä¹ ä¸­ï¼Œé‡‘å­—å¡”æŠ€æœ¯å¯ä»¥å¢å¼ºæ¨¡å‹å¯¹ä¸åŒå°ºåº¦çš„è¾“å…¥çš„æ•æ„Ÿæ€§ã€‚é€šè¿‡ä½¿ç”¨å¤šå°ºåº¦çš„ç‰¹å¾å›¾ï¼Œæ¨¡å‹èƒ½å¤Ÿåœ¨ä¸åŒçš„å±‚æ¬¡ä¸Šå¯¹è¾“å…¥è¿›è¡Œåˆ†æï¼Œä»è€Œæé«˜åˆ†ç±»ã€æ£€æµ‹ã€åˆ†å‰²ç­‰ä»»åŠ¡çš„ç²¾åº¦å’Œé²æ£’æ€§ã€‚</em></p>
</blockquote>
<p><em><strong>å¦‚ä½•ç¼–è¯‘å¾—åˆ°å¤š batch æ¨¡å‹</strong></em></p>
<p><em>æ ¹æ®åŸæ¨¡å‹ç§ç±»ï¼Œæˆ‘ä»¬å°†åˆ†ä¸ºåŠ¨æ€è¾“å…¥æ¨¡å‹å’ŒéåŠ¨æ€è¾“å…¥æ¨¡å‹æ¥è®¨è®ºè¿™ä¸ªé—®é¢˜ã€‚</em></p>
<p><em><strong>æ³¨æ„ï¼š</strong></em></p>
<ul>
<li><em><code>input_batch</code> å‚æ•°ä»…åœ¨å•è¾“å…¥ä¸” <code>input_shape</code> ç¬¬ä¸€ç»´ä¸º1çš„æ—¶å€™å¯ä»¥ä½¿ç”¨ã€‚</em></li>
<li><em>æ¯ä»½æ ¡å‡†æ•°æ®shapeå¤§å°ï¼Œåº”å’Œ <code>input_shape</code> çš„å¤§å°ä¿æŒä¸€è‡´ã€‚</em></li>
</ul>
<p><em>åŠ¨æ€è¾“å…¥æ¨¡å‹ï¼šå¦‚æœåŸæ¨¡å‹ä¸ºåŠ¨æ€è¾“å…¥æ¨¡å‹æ—¶ï¼Œæ¯”å¦‚ï¼Œ? x3x224x224ï¼ˆåŠ¨æ€è¾“å…¥æ¨¡å‹å¿…é¡»ä½¿ç”¨input_shapeå‚æ•°æŒ‡å®šæ¨¡å‹è¾“å…¥ä¿¡æ¯ï¼‰ã€‚</em></p>
<p><em>1.å½“é…ç½®input_shapeä¸º1x3x224x224æ—¶ï¼Œ å¦‚æœæ‚¨æƒ³ç¼–è¯‘å¾—åˆ°å¤šbatchçš„æ¨¡å‹ï¼Œå¯ä»¥ä½¿ç”¨ <code>input_batch</code> å‚æ•°ï¼Œæ­¤æ—¶æ¯ä»½æ ¡å‡†æ•°æ®shapeå¤§å°ä¸º1x3x224x224ã€‚</em></p>
<p><em>2.å½“é…ç½®input_shapeçš„ç¬¬ä¸€ç»´ä¸ºå¤§äº1çš„æ•´æ•°æ—¶ï¼ŒåŸæ¨¡å‹æœ¬èº«å°†ä¼šè®¤å®šä¸ºå¤šbatchæ¨¡å‹ï¼Œå°†æ— æ³•ä½¿ç”¨ <code>input_batch</code> å‚æ•°ï¼Œä¸”éœ€è¦æ³¨æ„æ¯ä»½æ ¡å‡†æ•°æ®shapeå¤§å°ã€‚ä¾‹å¦‚é…ç½®input_shapeä¸º4x3x224x224æ—¶ï¼Œ æ­¤æ—¶æ¯ä»½æ ¡å‡†æ•°æ®shapeå¤§å°ä¸º4x3x224x224ã€‚</em></p>
<p><em>éåŠ¨æ€è¾“å…¥æ¨¡å‹ï¼š</em></p>
<p><em>1.å½“è¾“å…¥çš„input shape[0]ä¸º1 ï¼Œä¸”æ˜¯å•è¾“å…¥æ¨¡å‹æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ <code>input_batch</code> å‚æ•°ã€‚æ¯ä»½æ ¡å‡†æ•°æ®shapeå¤§å°ä¸åŸæ¨¡å‹shapeä¿æŒä¸€è‡´ã€‚</em></p>
<p><em>2.å½“è¾“å…¥çš„input shape[0]ä¸ä¸º1ï¼Œä¸æ”¯æŒä½¿ç”¨ <code>input_batch</code> å‚æ•°ã€‚</em></p>
<p><em><strong>å¤šè¾“å…¥æ¨¡å‹åœ¨è½¬æ¢è¿‡ç¨‹ä¸­ï¼Œæ¨¡å‹è¾“å…¥é¡ºåºå‘ç”Ÿå˜åŒ–ï¼Œæ­¤ç§æƒ…å†µæ­£å¸¸ä¹ˆ</strong></em></p>
<p><em>æ­¤ç§æƒ…å†µæ˜¯æ­£å¸¸ç°è±¡ï¼Œå¤šè¾“å…¥æ¨¡å‹åœ¨è½¬æ¢è¿‡ç¨‹ä¸­ï¼Œæ¨¡å‹è¾“å…¥é¡ºåºæ˜¯æœ‰å¯èƒ½å‘ç”Ÿå˜åŒ–çš„ã€‚ å¯èƒ½å‘ç”Ÿçš„æƒ…å†µå¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼š</em></p>
<ul>
<li><em>åŸå§‹æµ®ç‚¹æ¨¡å‹è¾“å…¥é¡ºåºï¼šinput1ã€input2ã€input3ã€‚</em></li>
<li><em>original.onnxæ¨¡å‹è¾“å…¥é¡ºåºï¼šinput1ã€input2ã€input3ã€‚</em></li>
<li><em>quanti.onnxæ¨¡å‹è¾“å…¥é¡ºåºï¼šinput2ã€input1ã€input3ã€‚</em></li>
<li><em>binæ¨¡å‹è¾“å…¥é¡ºåºï¼šinput3ã€input2ã€input1ã€‚</em></li>
</ul>
<p><em><strong>æ³¨æ„ï¼š</strong></em></p>
<ul>
<li><em>å½“æ‚¨åšç²¾åº¦ä¸€è‡´æ€§å¯¹é½æ—¶ï¼Œè¯·ç¡®ä¿è¾“å…¥é¡ºåºæ˜¯æ­£ç¡®çš„ï¼Œä¸ç„¶æœ‰å¯èƒ½ä¼šå½±å“ç²¾åº¦ç»“æœã€‚</em></li>
<li><em>å¦‚æœæ‚¨æƒ³æŸ¥çœ‹binæ¨¡å‹è¾“å…¥çš„é¡ºåºï¼Œå¯ä»¥ä½¿ç”¨ <code>hb_model_info</code> æŒ‡ä»¤æ¥æŸ¥çœ‹ï¼Œinput_parameters infoåˆ†ç»„ä¸­åˆ—å‡ºçš„è¾“å…¥é¡ºåºï¼Œå³ä¸ºbinæ¨¡å‹çš„è¾“å…¥é¡ºåºã€‚</em></li>
</ul>
<blockquote>
<p><em>åœ¨å¤šè¾“å…¥æ¨¡å‹çš„è½¬åŒ–è¿‡ç¨‹ä¸­ï¼Œè¾“å…¥é¡ºåºå‘ç”Ÿå˜åŒ–çš„åŸå› æ˜¯ç”±äºåœ¨ä¸åŒæ¡†æ¶ä¹‹é—´ä¼ é€’æ¨¡å‹æ—¶ï¼Œ<strong>è¾“å…¥çš„é¡ºåºå¯èƒ½è¢«è§£é‡Šå™¨é‡æ–°å®‰æ’</strong>ã€‚</em></p>
<p><em>å…·ä½“æ¥è¯´ï¼Œåœ¨æ·±åº¦å­¦ä¹ æ¨¡å‹çš„è½¬åŒ–è¿‡ç¨‹ä¸­ï¼Œé€šå¸¸ä¼šé€šè¿‡å„ç§è§£é‡Šå™¨æˆ–è½¬æ¢å™¨å°†æ¨¡å‹ä»ä¸€ä¸ªæ¡†æ¶è½¬æ¢åˆ°å¦ä¸€ä¸ªæ¡†æ¶ã€‚åœ¨è¿™ä¸€è¿‡ç¨‹ä¸­ï¼Œè§£é‡Šå™¨é€šå¸¸è¦æ±‚æ¨¡å‹çš„è¾“å…¥é¡ºåºä»¥åŠå„ä¸ªè¾“å…¥çš„åç§°ä¸æ¡†æ¶çš„è¦æ±‚ç›¸åŒ¹é…ã€‚å› æ­¤ï¼Œå¦‚æœæºæ¡†æ¶å’Œç›®æ ‡æ¡†æ¶ä¹‹é—´å­˜åœ¨å·®å¼‚ï¼Œä¾‹å¦‚è¾“å…¥é¡ºåºæˆ–è¾“å…¥åç§°ä¸åŒï¼Œé‚£ä¹ˆåœ¨è½¬æ¢è¿‡ç¨‹ä¸­å°±ä¼šå‘ç”Ÿé‡æ–°æ’åˆ—ã€‚</em></p>
<p><em>æ­¤å¤–ï¼Œç”±äºå¤šè¾“å…¥æ¨¡å‹çš„ç¥ç»ç½‘ç»œæ¶æ„é€šå¸¸æ¯”è¾ƒå¤æ‚ï¼Œæœ‰å¤šä¸ªå±‚çº§ï¼Œä¸åŒçš„å±‚çº§å¯èƒ½å¯¹äºä¸åŒçš„è¾“å…¥è¾“å…¥æ•°æ®è¿›è¡Œå¤„ç†å’Œè®¡ç®—ï¼Œå› æ­¤åœ¨ä¸åŒçš„æ¡†æ¶ä¹‹é—´ä¼ é€’å¤šè¾“å…¥æ¨¡å‹æ—¶ï¼Œéœ€è¦ç¡®ä¿è¾“å…¥æ•°æ®å’Œè®¡ç®—ç»“æœçš„é¡ºåºæ­£ç¡®ã€‚å¦‚æœåœ¨æ¨¡å‹è½¬æ¢è¿‡ç¨‹ä¸­å‘ç”Ÿè¾“å…¥é¡ºåºçš„é”™è¯¯æˆ–æ··æ·†ï¼Œå¯èƒ½ä¼šäº§ç”Ÿé”™è¯¯çš„è®¡ç®—ç»“æœï¼Œä»è€Œå½±å“æ¨¡å‹çš„å‡†ç¡®æ€§å’Œæ€§èƒ½ã€‚</em></p>
</blockquote>
<p><em><strong>å¦‚ä½•ç†è§£PTQæ¨¡å‹è½¬æ¢è¿‡ç¨‹ä¸­çš„ä¸»åŠ¨é‡åŒ–å’Œè¢«åŠ¨é‡åŒ–</strong></em></p>
<p><em>åœ¨æ¨¡å‹æˆåŠŸè½¬æ¢æˆbinæ¨¡å‹åï¼Œå¯èƒ½ä¼šå‡ºç°å‘ç°ä»ç„¶æœ‰ä¸ªåˆ«opè¿è¡Œåœ¨CPUä¸Šçš„æƒ…å†µï¼Œä½†å›å¤´ä»”ç»†å¯¹ç…§å·¥å…·é“¾ç®—å­çº¦æŸåˆ—è¡¨ï¼Œæ˜æ˜è¯¥opæ˜¯ç¬¦åˆç®—å­çº¦æŸæ¡ä»¶çš„ï¼Œä¹Ÿå°±æ˜¯ç†è®ºä¸Šè¯¥ç®—å­åº”è¯¥æˆåŠŸè¿è¡Œåœ¨BPUä¸Šï¼Œä¸ºä»€ä¹ˆä»ç„¶æ˜¯CPUè®¡ç®—å‘¢ï¼Ÿ</em></p>
<blockquote>
<p><em>è‡ªå®šä¹‰ç®—å­å¼€å‘</em></p>
</blockquote>
<p><em><strong>ç®€ä»‹</strong></em></p>
<p><em>åœ°å¹³çº¿å·¥å…·é“¾ä¸­å·²ç»æ”¯æŒäº†ä¸°å¯Œçš„ç®—å­ï¼Œåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæ‚¨çš„æ¨¡å‹åº”è¯¥å¯ä»¥é€šè¿‡å‰æ–‡æ‰€è¿°æ¨¡å‹è½¬æ¢é¡ºåˆ©éƒ¨ç½²åˆ°åœ°å¹³çº¿èŠ¯ç‰‡ä¸Šã€‚ å·²æ”¯æŒçš„ç®—å­æƒ…å†µå¯ä»¥å‚è€ƒ <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/appendix/supported_op_list.html" >æ¨¡å‹è½¬æ¢å·¥å…·é“¾ç®—å­æ”¯æŒçº¦æŸåˆ—è¡¨ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ç« èŠ‚ã€‚ å°‘éƒ¨åˆ†ç®—å­ä¸æ”¯æŒæƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¼ºçƒˆå»ºè®®æ‚¨å…ˆå°è¯•ä¸‹æ›¿æ¢ç®—å­çš„å¯èƒ½æ€§ï¼Œè¿™æ ·æœ‰åˆ©äºå°†åœ°å¹³çº¿èŠ¯ç‰‡èƒ½åŠ›å……åˆ†å‘æŒ¥å‡ºæ¥ï¼Œä¸”å¼€å‘æˆæœ¬ä¼šæ›´ä½ã€‚</em></p>
<p><em>è‡ªå®šä¹‰ç®—å­åªæä¾›CPUä¸Šç®—å­å¼€å‘èƒ½åŠ›ï¼Œä¸€ä¸ªå®Œæ•´çš„è‡ªå®šä¹‰ç®—å­åº”ç”¨è¿‡ç¨‹åŒ…æ‹¬åˆ›å»ºæ¨¡æ¿ã€ç®—å­å®ç°ã€ç®—å­ç¼–è¯‘ã€ å«è‡ªå®šä¹‰ç®—å­æ¨¡å‹è½¬æ¢å’Œè¿è¡Œå«è‡ªå®šä¹‰opæ¨¡å‹å‡ ä¸ªé˜¶æ®µã€‚å…·ä½“æµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤º:</em></p>
<p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230509180655936.png"
                      class="" title="image-20230509180655936"
                ></em></p>
<p><em>å¦‚å›¾æ‰€ç¤ºï¼Œå®šä¹‰è‡ªå®šä¹‰OPéœ€è¦æœ‰ä¸¤éƒ¨åˆ†çš„ä»»åŠ¡ï¼šåœ¨æ¨¡å‹è½¬æ¢é˜¶æ®µï¼Œéœ€è¦æä¾›è‡ªå®šä¹‰OPçš„pythonä»£ç ï¼›åœ¨æ¨¡æ‹Ÿå™¨&#x2F;ä¸Šæ¿è¿è¡Œæ¨ç†é˜¶æ®µï¼Œéœ€è¦æä¾›è‡ªå®šä¹‰OPçš„C++ä»£ç ã€‚ è¦ç¡®ä¿è¿™ä¸¤éƒ¨åˆ†çš„ä»£ç è¿ç®—çš„ä¸€è‡´æ€§ã€‚</em></p>
<p><em><strong>å«è‡ªå®šä¹‰ç®—å­çš„æ¨¡å‹è½¬æ¢</strong></em></p>
<p><em><strong>æ¨¡å‹æ–‡ä»¶ä¿®æ”¹</strong></em></p>
<p><em>åœ¨å‡†å¤‡å¥½è‡ªå®šä¹‰ç®—å­å®ç°åï¼Œä¸ºäº†å°†ç®—å­åº”ç”¨èµ·æ¥ï¼Œæ‚¨éœ€è¦ä»åŸå§‹æ¨¡å‹æ–‡ä»¶å’Œæ¨¡å‹è½¬æ¢é…ç½®ä¸¤ä¸ªæ–¹é¢åšå‡ºç›¸åº”è°ƒæ•´ (ä¸‹é¢åˆ†åˆ«ä»¥ <code>Caffe</code> æ¨¡å‹å’Œ <code>ONNX</code> æ¨¡å‹ä¸ºä¾‹)ã€‚</em></p>
<p><em><strong>caffeæ¨¡å‹</strong></em></p>
<p><em>åŸå§‹æ¨¡å‹æ–‡ä»¶ä¸­ï¼Œå°†è‡ªå®šä¹‰ç®—å­å¯¹åº”çš„ç®—å­ç±»å‹æ ‡è®°ä¸º <code>Custom</code>ï¼Œå¹¶æä¾›ä¸€ç»„ <code>custom_param</code>ï¼Œç¤ºä¾‹å¦‚ä¸‹ã€‚</em></p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">layer &#123;</span><br><span class="line">  name: <span class="string">&quot;hr_op&quot;</span></span><br><span class="line">  <span class="built_in">type</span>: <span class="string">&quot;Custom&quot;</span></span><br><span class="line">  bottom: <span class="string">&quot;res3d_in&quot;</span></span><br><span class="line">  top: <span class="string">&quot;res3d&quot;</span></span><br><span class="line">  custom_param &#123;</span><br><span class="line">    kind: <span class="string">&quot;CustomIdentity&quot;</span></span><br><span class="line">    shape &#123;</span><br><span class="line">      dim: <span class="number">1</span></span><br><span class="line">      dim: <span class="number">512</span></span><br><span class="line">      dim: <span class="number">28</span></span><br><span class="line">      dim: <span class="number">28</span></span><br><span class="line">    &#125;</span><br><span class="line">    params: <span class="string">&quot;&#x27;kernel_size&#x27;: 10 \n&#x27;threshold&#x27;: 0.5&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p><em>ä»¥ä¸Šå®Œæ•´ <code>custom_param</code> ç¤ºä¾‹ä¸­ã€‚ <code>kind</code> æ˜¯è‡ªå®šä¹‰ç®—å­çš„å†…éƒ¨å®ç°åç§°ï¼Œè¯¥è‡ªå®šä¹‰OPä¸ºæ’ç­‰OPï¼Œå› æ­¤å‘½åä¸º <code>CustomIdentity</code>ï¼Œè¯¥åç§°åœ¨åç»­PythonåŠC++ä»£ç ä¸­å‡ä¼šä½“ç°ï¼› <code>shape</code> æ˜¯ç®—å­çš„è¾“å‡ºå°ºå¯¸ï¼Œéœ€è¦å®Œæ•´æŒ‡å®šï¼›<code>params</code> æ˜¯ç®—å­çš„ä¼ å…¥å‚æ•°æŒ‡å®šå½¢å¼ä¸º <code>&#39;param_name&#39;: param_value</code>ï¼Œ å¤šä¸ªå‚æ•°ä¹‹é—´ä½¿ç”¨ <code>\n</code> åˆ†éš”ã€‚</em></p>
<blockquote>
<p> <em>â€œkindâ€ æ˜¯æŒ‡è‡ªå®šä¹‰ç®—å­ï¼ˆCustom Operatorï¼‰çš„å†…éƒ¨å®ç°åç§°ã€‚è‡ªå®šä¹‰ç®—å­æ˜¯åœ¨æ·±åº¦å­¦ä¹ æ¡†æ¶ä¸­ç”¨æˆ·è‡ªå®šä¹‰çš„æ“ä½œï¼Œå¯ä»¥æ ¹æ®å…·ä½“éœ€æ±‚å®ç°ä¸€äº›ç‰¹å®šåŠŸèƒ½çš„æ“ä½œã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œè‡ªå®šä¹‰ç®—å­çš„åŠŸèƒ½æ˜¯æ’ç­‰æ“ä½œï¼Œå³è¾“å…¥å’Œè¾“å‡ºå®Œå…¨ç›¸ç­‰ï¼Œä¸åšä»»ä½•å˜æ¢ã€‚</em></p>
<p> <em>ä¸ºäº†åœ¨ä»£ç ä¸­æ ‡è¯†å’Œå¼•ç”¨è¿™ä¸ªè‡ªå®šä¹‰ç®—å­ï¼Œéœ€è¦ç»™å®ƒä¸€ä¸ªåç§°ï¼Œè¿™ä¸ªåç§°åœ¨ä»£ç ä¸­è¢«ç§°ä¸º â€œkindâ€ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œè¿™ä¸ªè‡ªå®šä¹‰ç®—å­çš„åç§°è¢«å‘½åä¸º â€œCustomIdentityâ€ï¼Œè¡¨ç¤ºå®ƒæ˜¯ä¸€ä¸ªè‡ªå®šä¹‰çš„æ’ç­‰æ“ä½œã€‚</em></p>
<p> <em>é€šè¿‡ç»™è‡ªå®šä¹‰ç®—å­å‘½åï¼Œå¯ä»¥åœ¨ä»£ç ä¸­ä½¿ç”¨è¿™ä¸ªåç§°æ¥è°ƒç”¨å’Œä½¿ç”¨è¯¥ç®—å­ã€‚è¿™æ ·ï¼Œå½“éœ€è¦ä½¿ç”¨æ’ç­‰æ“ä½œæ—¶ï¼Œå¯ä»¥ç›´æ¥å¼•ç”¨è¯¥è‡ªå®šä¹‰ç®—å­çš„åç§°ï¼Œè€Œä¸éœ€è¦æ¯æ¬¡éƒ½é‡æ–°ç¼–å†™ç›¸åŒçš„ä»£ç ã€‚è¿™æ ·èƒ½å¤Ÿæé«˜ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚</em></p>
</blockquote>
<p><em>åœ¨æ¨¡å‹è½¬æ¢é…ç½®ä¸­ï¼Œä½¿ç”¨è‡ªå®šä¹‰ç®—å­éœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­åŠ å…¥ä¸€ä¸ªæ–°çš„è‡ªå®šä¹‰opå‚æ•°ç»„å¦‚ä¸‹ï¼š</em></p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#...</span></span><br><span class="line"></span><br><span class="line">custom_op:</span><br><span class="line">  <span class="comment"># è‡ªå®šä¹‰opçš„æ ¡å‡†æ–¹å¼</span></span><br><span class="line">  custom_op_method: register</span><br><span class="line"></span><br><span class="line">  <span class="comment"># è‡ªå®šä¹‰OPçš„å®ç°æ–‡ä»¶</span></span><br><span class="line">  op_register_files: sample_custom.py</span><br></pre></td></tr></table></figure></div>

<p><em>å¯¹äº <code>Caffe</code> æ¨¡å‹ï¼Œä»¥ä¸Šå‚æ•°ç»„ä¸­ï¼Œä¸‰ä¸ªå‚æ•°éƒ½æ˜¯å¿…é¡»é…ç½®çš„ã€‚ <code>custom_op_method</code> å›ºå®šä½¿ç”¨ <code>register</code>ï¼› <code>op_register_files</code> æ˜¯è‡ªå®šä¹‰ç®—å­è®¡ç®—çš„å®ç°æ–‡ä»¶ï¼Œè¯·ä½¿ç”¨ç›¸å¯¹è·¯å¾„ã€‚</em></p>
<p><em>å®Œæˆè¿™äº›é…ç½®åï¼Œæ¨¡å‹è½¬æ¢çš„åç»­æ­¥éª¤ä¸å…¶ä»–ä¸€èˆ¬æ¨¡å‹è½¬æ¢è¿‡ç¨‹ä¸€è‡´ã€‚</em></p>
<p><em><strong>ONNXæ¨¡å‹</strong></em></p>
<ol>
<li><em>å«æœ‰è‡ªå®šä¹‰ç®—å­çš„Onnxæ¨¡å‹çš„è·å–:</em></li>
</ol>
<ul>
<li><em>ä»pytorchç­‰å…¶ä»–æ¡†æ¶è½¬æ¢è€Œæ¥</em></li>
</ul>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">from</span> horizon_nn.horizon_onnx.onnx_pb <span class="keyword">import</span> TensorProto</span><br><span class="line"><span class="keyword">from</span> torch.onnx.symbolic_helper <span class="keyword">import</span> parse_args</span><br><span class="line"><span class="keyword">from</span> torch.onnx.utils <span class="keyword">import</span> register_custom_op_symbolic</span><br><span class="line"><span class="keyword">from</span> torch <span class="keyword">import</span> Tensor</span><br><span class="line"></span><br><span class="line">model = torch.hub.load(<span class="string">&#x27;pytorch/vision:v0.10.0&#x27;</span>, <span class="string">&#x27;googlenet&#x27;</span>, pretrained=<span class="literal">True</span>)	<span class="comment">#ä½¿ç”¨torch.hubåŠ è½½è¯­å¯»æå¨œçš„GoogleNetæ¨¡å‹ï¼Œé€šè¿‡torch.hubå¯ä»¥æ–¹ä¾¿åœ°ä»PyTorchå®˜æ–¹æä¾›çš„é¢„è®­ç»ƒæ¨¡å‹ä¸­åŠ è½½æŒ‡å®šçš„æ¨¡å‹ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">_transform_input</span>(<span class="params">x: Tensor</span>) -&gt; Tensor:	<span class="comment">#è¿™æ˜¯ä¸€ä¸ªè¾…åŠ©å‡½æ•°ï¼Œç”¨äºå¯¹è¾“å…¥è¿›è¡Œè½¬æ¢ã€‚</span></span><br><span class="line">    <span class="keyword">return</span> x</span><br><span class="line"></span><br><span class="line">model._transform_input = _transform_input</span><br><span class="line"></span><br><span class="line"><span class="meta">@parse_args(<span class="params"><span class="string">&quot;v&quot;</span>, <span class="string">&quot;v&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">horizon_pool</span>(<span class="params">g, <span class="built_in">input</span>, output_size</span>):		<span class="comment">#è¿™æ®µä»£ç å®šä¹‰äº†ä¸€ä¸ªåä¸ºhorizon_poolçš„è‡ªå®šä¹‰æ“ä½œã€‚å®ƒæ¥å—ä¸€ä¸ªè¾“å…¥å¼ é‡(input)å’Œè¾“å‡ºå°ºå¯¸(output_size)ä½œä¸ºå‚æ•°ï¼Œå¹¶ä½¿ç”¨g.opå‡½æ•°åˆ›å»ºäº†ä¸€ä¸ªè‡ªå®šä¹‰æ“ä½œèŠ‚ç‚¹ã€‚</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> g.op(</span><br><span class="line">        <span class="string">&#x27;horizon.custom::PyOp&#x27;</span>, <span class="comment">#required, ! must be &#x27;horizon.custom&#x27; domain ! è¿™æ˜¯æ“ä½œèŠ‚ç‚¹çš„ç±»å‹ï¼ŒæŒ‡å®šäº†è‡ªå®šä¹‰æ“ä½œçš„ç±»å‹ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ&#x27;horizon.custom::PyOp&#x27; è¡¨ç¤ºä½¿ç”¨è‡ªå®šä¹‰æ“ä½œ &#x27;PyOp&#x27;ã€‚</span></span><br><span class="line">        <span class="built_in">input</span>,</span><br><span class="line">        class_name_s=<span class="string">&quot;GlobalAveragePool&quot;</span>,  <span class="comment">#required ! must match the class def name in sample_custom python file !</span></span><br><span class="line">        compute_s=<span class="string">&quot;compute&quot;</span>,  <span class="comment">#optional, &#x27;compute&#x27; by default</span></span><br><span class="line">        module_s=<span class="string">&quot;sample_custom&quot;</span>,  <span class="comment">#required ! must match the file name of the &quot;op_register_files&quot; !</span></span><br><span class="line">        input_types_i=[TensorProto.FLOAT],  <span class="comment">#required  è¿™æ˜¯è¾“å…¥å¼ é‡çš„ç±»å‹åˆ—è¡¨ï¼ŒæŒ‡å®šäº†è¾“å…¥å¼ é‡çš„ç±»å‹ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œè¾“å…¥å¼ é‡çš„ç±»å‹ä¸º FLOATã€‚</span></span><br><span class="line">        output_types_i=[TensorProto.FLOAT],  <span class="comment">#required</span></span><br><span class="line">        output_shape_s=[<span class="string">&quot;1, 1024, 1, 1&quot;</span>]) <span class="comment">#required  è¿™æ˜¯è¾“å‡ºå¼ é‡çš„å½¢çŠ¶ï¼ŒæŒ‡å®šäº†è¾“å‡ºå¼ é‡çš„å½¢çŠ¶ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œè¾“å‡ºå¼ é‡çš„å½¢çŠ¶ä¸º [1, 1024, 1, 1]ã€‚</span></span><br><span class="line"></span><br><span class="line">d_input = torch.rand(<span class="number">1</span>, <span class="number">3</span>, <span class="number">224</span>, <span class="number">224</span>)		<span class="comment">#è¿™é‡Œåˆ›å»ºäº†ä¸€ä¸ªå½¢çŠ¶ä¸º(1, 3, 224, 224)çš„éšæœºå¼ é‡ä½œä¸ºè¾“å…¥ã€‚</span></span><br><span class="line">register_custom_op_symbolic(<span class="string">&#x27;::adaptive_avg_pool2d&#x27;</span>,</span><br><span class="line">                            horizon_pool,</span><br><span class="line">                            opset_version=<span class="number">11</span>)		<span class="comment">#è¿™é‡Œæ³¨å†Œäº†ä¸€ä¸ªè‡ªå®šä¹‰æ“ä½œç¬¦å·åŒ–å‡½æ•°ï¼Œç”¨äºå°†è‡ªå®šä¹‰æ“ä½œè½¬æ¢ä¸ºONNXå›¾ä¸­çš„èŠ‚ç‚¹ã€‚</span></span><br><span class="line">torch.onnx.export(model, d_input, <span class="string">&quot;googlenet_cop.onnx&quot;</span>, opset_version=<span class="number">11</span>)		<span class="comment">#é€šè¿‡torch.onnx.exportå‡½æ•°å°†æ¨¡å‹å¯¼å‡ºä¸ºONNXæ ¼å¼ï¼Œå¹¶ä¿å­˜ä¸º&quot;googlenet_cop.onnx&quot;æ–‡ä»¶ã€‚opset_versionå‚æ•°æŒ‡å®šäº†ä½¿ç”¨çš„ONNXç‰ˆæœ¬ã€‚</span></span><br></pre></td></tr></table></figure></div>

<blockquote>
<p><em>æä¾›è¾“å…¥å¼ é‡æ˜¯ä¸ºäº†ç¡®å®šæ¨¡å‹çš„è¾“å…¥å½¢çŠ¶ï¼Œä»¥ä¾¿åœ¨å¯¼å‡ºçš„ONNXæ¨¡å‹ä¸­æ­£ç¡®å®šä¹‰è¾“å…¥èŠ‚ç‚¹ã€‚</em></p>
</blockquote>
<blockquote>
<p><em>åœ¨<code>register_custom_op_symbolic</code>å‡½æ•°ä¸­ï¼Œç¬¬ä¸€ä¸ªå‚æ•°<code>&#39;::adaptive_avg_pool2d&#39;</code>æ˜¯è¦æ³¨å†Œçš„è‡ªå®šä¹‰æ“ä½œçš„åç§°ã€‚è¿™é‡Œçš„åç§°æ˜¯æŒ‡å®šçš„å­—ç¬¦ä¸² <code>&#39;::adaptive_avg_pool2d&#39;</code>ï¼Œå®ƒç”¨äºæ ‡è¯†è¦æ³¨å†Œçš„è‡ªå®šä¹‰æ“ä½œçš„ç¬¦å·åŒ–å‡½æ•°ã€‚è¿™ä¸ªåç§°å¯ä»¥æ˜¯ä»»æ„çš„ï¼Œä½†æ˜¯éœ€è¦ä¸æ¨¡å‹å®šä¹‰ä¸­ä½¿ç”¨çš„ç›¸åº”æ“ä½œåç§°ä¿æŒä¸€è‡´ã€‚</em></p>
</blockquote>
<blockquote>
<p><em>åœ¨ä»£ç ä¸­ä½¿ç”¨è‡ªå®šä¹‰ domain å‰ï¼Œéœ€è¦å…ˆæ³¨å†Œè¯¥ domainã€‚è¿™å¯ä»¥é€šè¿‡è°ƒç”¨ <code>torch.onnx.register_custom_op_symbolic()</code> å‡½æ•°æ¥å®ç°ã€‚</em></p>
<p><em>åœ¨æ³¨å†Œè¿‡ç¨‹ä¸­ï¼Œéœ€è¦æä¾›è‡ªå®šä¹‰ç®—å­çš„åç§°å’Œå¯¹åº”çš„ç¬¦å·å‡½æ•°ã€‚ç¬¦å·å‡½æ•°è´Ÿè´£å®šä¹‰ç®—å­åœ¨ ONNX å›¾ä¸­çš„è¡Œä¸ºå’Œæ“ä½œã€‚å®ƒå°†æ¥æ”¶ç¬¦å·å›¾ (<code>g</code>) å’Œè¾“å…¥å‚æ•°ï¼Œç„¶åè¿”å›ç”¨äºè¡¨ç¤ºç®—å­è¡Œä¸ºçš„ ONNX å›¾èŠ‚ç‚¹ã€‚</em></p>
<p><em>åœ¨æ³¨å†Œè‡ªå®šä¹‰ç®—å­æ—¶ï¼Œéœ€è¦ç¡®ä¿ä¸ºå…¶æŒ‡å®šæ­£ç¡®çš„ domain åç§°ã€‚è¿™æ ·ï¼ŒONNX è§£æå™¨åœ¨è§£ææ¨¡å‹æ—¶èƒ½å¤Ÿè¯†åˆ«å¹¶å¤„ç†è¯¥è‡ªå®šä¹‰ç®—å­ã€‚</em></p>
<p><em>å½“æ²¡æœ‰æŒ‡å®š <code>domain</code> å±æ€§æ—¶ï¼Œ<code>register_custom_op_symbolic</code> å‡½æ•°ä¼šå°†è‡ªå®šä¹‰ç®—å­é»˜è®¤æ³¨å†Œåˆ° ONNX æ ‡å‡†çš„ <code>onnx</code> domain ä¸‹ã€‚è¿™æ„å‘³ç€è‡ªå®šä¹‰ç®—å­ä¼šè¢«é»˜è®¤è§†ä¸ºæ ‡å‡†çš„ ONNX ç®—å­ã€‚</em></p>
<p><em>å¦‚æœå¸Œæœ›å°†è‡ªå®šä¹‰ç®—å­æ³¨å†Œåˆ°ä¸åŒçš„ <code>domain</code> ä¸‹ï¼Œå¯ä»¥åœ¨ <code>register_custom_op_symbolic</code> å‡½æ•°ä¸­æŒ‡å®š <code>domain</code> å‚æ•°çš„å€¼ï¼Œä¾‹å¦‚ï¼š</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pythonCopy code</span><br><span class="line">register_custom_op_symbolic(&#x27;::my_custom_op&#x27;, my_custom_op, domain=&#x27;my_domain&#x27;)</span><br></pre></td></tr></table></figure></div>

<p><em>è¿™æ ·å°±å°†è‡ªå®šä¹‰ç®—å­æ³¨å†Œåˆ°åä¸º <code>&#39;my_domain&#39;</code> çš„è‡ªå®šä¹‰ <code>domain</code> ä¸‹ã€‚è¿™åœ¨å¤„ç†å…·æœ‰å¤šä¸ªè‡ªå®šä¹‰ç®—å­æˆ–å°†è‡ªå®šä¹‰ç®—å­ä¸ç‰¹å®šçš„å®ç°å…³è”æ—¶å¯èƒ½ä¼šæœ‰ç”¨ã€‚</em></p>
</blockquote>
<blockquote>
<p><em>åœ¨æ·±åº¦å­¦ä¹ æ¡†æ¶ä¸­ï¼Œ<code>g.op</code> æ˜¯ä¸€ä¸ªç”¨äºåˆ›å»ºæ“ä½œèŠ‚ç‚¹ï¼ˆOperator Nodeï¼‰çš„å‡½æ•°ã€‚åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œ<code>g.op</code> å‡½æ•°ç”¨äºåˆ›å»ºä¸€ä¸ªæ“ä½œèŠ‚ç‚¹ï¼Œå…·ä½“çš„å‚æ•°è§£æå¦‚ä¸‹ï¼š</em></p>
<ul>
<li><em>ç¬¬ä¸€ä¸ªå‚æ•°ï¼šæ“ä½œèŠ‚ç‚¹çš„åç§°ï¼Œè¿™é‡Œæ˜¯ <code>&#39;horizon.custom::PyOp&#39;</code>ï¼Œå®ƒæŒ‡å®šäº†è‡ªå®šä¹‰ç®—å­çš„åç§°å’Œæ‰€å±çš„ <code>domain</code>ã€‚</em></li>
<li><em>åç»­å‚æ•°ï¼šæ“ä½œèŠ‚ç‚¹çš„è¾“å…¥å’Œå±æ€§ä¿¡æ¯ï¼Œä»¥å…³é”®å­—å‚æ•°çš„å½¢å¼ä¼ é€’ã€‚</em></li>
</ul>
</blockquote>
<ul>
<li><em>ç›´æ¥ç”Ÿæˆonnxæ¨¡å‹</em></li>
</ul>
<p><em>å‚è€ƒä»£ç ï¼š</em></p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> onnx</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> onnx <span class="keyword">import</span> helper, checker, shape_inference, numpy_helper, TensorProto</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">make_normal_data</span>(<span class="params">shape</span>):</span><br><span class="line">    <span class="keyword">return</span> np.random.normal(loc=<span class="number">0.0</span>, scale=<span class="number">1.0</span>, size=shape).astype(np.float32)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># conv</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">make_simple_model</span>():</span><br><span class="line"></span><br><span class="line">    <span class="comment"># create nodes</span></span><br><span class="line">    conv_input_shape = (<span class="number">1</span>, <span class="number">3</span>, <span class="number">224</span>, <span class="number">224</span>)</span><br><span class="line">    conv_output_shape = (<span class="number">1</span>, <span class="number">3</span>, <span class="number">224</span>, <span class="number">224</span>)</span><br><span class="line"></span><br><span class="line">    add_param_shape = (<span class="number">1</span>, <span class="number">3</span>, <span class="number">224</span>, <span class="number">224</span>)</span><br><span class="line">    add_1_param_data = np.zeros(add_param_shape).astype(np.float32)</span><br><span class="line">    add_2_param_data = np.ones(add_param_shape).astype(np.float32)</span><br><span class="line"></span><br><span class="line">    conv_weight_shape = (<span class="number">3</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">3</span>)</span><br><span class="line">    conv_output_shape = (<span class="number">1</span>, <span class="number">3</span>, <span class="number">224</span>, <span class="number">224</span>)</span><br><span class="line">    conv_weight_data = make_normal_data(conv_weight_shape)</span><br><span class="line"></span><br><span class="line">    add_1_node = helper.make_node(</span><br><span class="line">        <span class="string">&quot;PyOp&quot;</span>,  <span class="comment"># required, ç±»å‹å¿…é¡»æ˜¯&#x27;PyOp&#x27;</span></span><br><span class="line">        name=<span class="string">&quot;add_1&quot;</span>,  <span class="comment"># required, ä¸åŒçš„opåç§°ä¸èƒ½ç›¸åŒ</span></span><br><span class="line">        inputs=[<span class="string">&quot;input0&quot;</span>, <span class="string">&quot;add_1_param&quot;</span>],  <span class="comment"># required, éœ€è¦æ˜¯ä¸€ä¸ªlist, ä¸”éœ€è¦ä¸å®ç°æ–‡ä»¶ä¸­çš„è¾“å…¥æ•°é‡ä¿æŒä¸€è‡´</span></span><br><span class="line">        outputs=[<span class="string">&quot;add_1_out&quot;</span>],  <span class="comment"># required, éœ€è¦æ˜¯ä¸€ä¸ªlist, ä¸”éœ€è¦ä¸å®ç°æ–‡ä»¶ä¸­çš„è¾“å‡ºæ•°é‡ä¿æŒä¸€è‡´</span></span><br><span class="line">        </span><br><span class="line">        domain=<span class="string">&quot;horizon.cop1&quot;</span>,  <span class="comment"># required, ä¸åŒå®ç°é€»è¾‘çš„è‡ªå®šä¹‰ç®—å­å®ç°éœ€è¦é€šè¿‡ä¸åŒçš„domainåç§°æ¥å®ç°</span></span><br><span class="line">        </span><br><span class="line">        class_name=<span class="string">&quot;Cop1&quot;</span>,  <span class="comment"># required, éœ€è¦ä¸è‡ªå®šä¹‰ç®—å­çš„å®ç°æ–‡ä»¶ä¸­çš„classåç§°ä¸€è‡´</span></span><br><span class="line">        module=<span class="string">&quot;custom_op.horizon_ops&quot;</span>,  <span class="comment"># required, éœ€è¦ä¸åŒ…å«è‡ªå®šä¹‰ç®—å­çš„å®ç°æ–‡ä»¶çš„è·¯å¾„ä¸€è‡´</span></span><br><span class="line">        compute=<span class="string">&quot;compute&quot;</span>,  <span class="comment"># required, éœ€è¦ä¸è‡ªå®šä¹‰ç®—å­å®ç°classä¸­çš„è®¡ç®—é€»è¾‘å‡½æ•°ä¸€è‡´</span></span><br><span class="line">        input_types=[</span><br><span class="line">            TensorProto.FLOAT,</span><br><span class="line">            TensorProto.FLOAT,</span><br><span class="line">        ],  <span class="comment"># required, éœ€è¦æ˜¯ä¸€ä¸ªlist, å…¶é•¿åº¦éœ€è¦ä¸è¯¥ç®—å­çš„inputså±æ€§æ•°é‡ä¸€è‡´, ä¸”ä¸å®ç°æ–‡ä»¶ä¸­çš„è¾“å…¥æ•°é‡ä¿æŒä¸€è‡´</span></span><br><span class="line">        output_types=[</span><br><span class="line">            TensorProto.FLOAT</span><br><span class="line">        ],  <span class="comment"># required, éœ€è¦æ˜¯ä¸€ä¸ªlist, å…¶é•¿åº¦éœ€è¦ä¸è¯¥ç®—å­çš„outputså±æ€§æ•°é‡ä¸€è‡´, ä¸”ä¸å®ç°æ–‡ä»¶ä¸­çš„è¾“å‡ºæ•°é‡ä¿æŒä¸€è‡´</span></span><br><span class="line">        output_shape=[<span class="string">&quot;1, 3, 224, 224&quot;</span>],  <span class="comment"># optional, åœ¨æ¨¡å‹ä¸­æœªæ·»åŠ pyopçš„è¾“å‡º value_infoæ—¶, å¿…é¡»å¡«å†™</span></span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    add_2_node = helper.make_node(</span><br><span class="line">        <span class="string">&quot;PyOp&quot;</span>,</span><br><span class="line">        name=<span class="string">&quot;add_2&quot;</span>,</span><br><span class="line">        inputs=[<span class="string">&quot;input1&quot;</span>, <span class="string">&quot;add_1_out&quot;</span>, <span class="string">&quot;add_2_param&quot;</span>],</span><br><span class="line">        outputs=[<span class="string">&quot;add_2_out&quot;</span>, <span class="string">&quot;output0&quot;</span>],</span><br><span class="line">        domain=<span class="string">&quot;horizon.cop2&quot;</span>,</span><br><span class="line">        class_name=<span class="string">&quot;Cop2&quot;</span>,</span><br><span class="line">        module=<span class="string">&quot;custom_op.horizon_ops&quot;</span>,</span><br><span class="line">        compute=<span class="string">&#x27;compute&#x27;</span>,</span><br><span class="line">        input_types=[TensorProto.FLOAT, TensorProto.FLOAT,</span><br><span class="line">                     TensorProto.FLOAT],  <span class="comment">#required</span></span><br><span class="line">        output_types=[TensorProto.FLOAT, TensorProto.FLOAT],  <span class="comment">#required</span></span><br><span class="line">        output_shape=[<span class="string">&quot;1, 3, 224, 224&quot;</span>, <span class="string">&quot;1, 3, 224, 224&quot;</span>])</span><br><span class="line"></span><br><span class="line">    conv_1_node = helper.make_node(<span class="string">&quot;Conv&quot;</span>,</span><br><span class="line">                                   inputs=[<span class="string">&quot;add_2_out&quot;</span>, <span class="string">&quot;W0&quot;</span>],</span><br><span class="line">                                   outputs=[<span class="string">&quot;output1&quot;</span>],</span><br><span class="line">                                   dilations=(<span class="number">1</span>, <span class="number">1</span>),</span><br><span class="line">                                   group=<span class="number">1</span>,</span><br><span class="line">                                   kernel_shape=(<span class="number">3</span>, <span class="number">3</span>),</span><br><span class="line">                                   pads=(<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>),</span><br><span class="line">                                   name=<span class="string">&quot;conv_1&quot;</span>)</span><br><span class="line">    <span class="comment"># nodes</span></span><br><span class="line">    nodes = [add_1_node, add_2_node, conv_1_node]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># inputs</span></span><br><span class="line">    model_input_1 = helper.make_tensor_value_info(<span class="string">&quot;input0&quot;</span>, TensorProto.FLOAT,</span><br><span class="line">                                                  conv_input_shape)</span><br><span class="line">    model_input_2 = helper.make_tensor_value_info(<span class="string">&quot;input1&quot;</span>, TensorProto.FLOAT,</span><br><span class="line">                                                  conv_input_shape)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Outputs</span></span><br><span class="line">    model_output_1 = helper.make_tensor_value_info(<span class="string">&quot;output0&quot;</span>,</span><br><span class="line">                                                   TensorProto.FLOAT,</span><br><span class="line">                                                   conv_output_shape)</span><br><span class="line">    model_output_2 = helper.make_tensor_value_info(<span class="string">&quot;output1&quot;</span>,</span><br><span class="line">                                                   TensorProto.FLOAT,</span><br><span class="line">                                                   conv_output_shape)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Intermediate tensors</span></span><br><span class="line">    add_1_out = helper.make_tensor_value_info(<span class="string">&quot;add_1_out&quot;</span>, TensorProto.FLOAT,</span><br><span class="line">                                              conv_output_shape)</span><br><span class="line">    add_2_out = helper.make_tensor_value_info(<span class="string">&quot;add_2_out&quot;</span>, TensorProto.FLOAT,</span><br><span class="line">                                              conv_output_shape)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># create constant tensor</span></span><br><span class="line">    W0_tensor = helper.make_tensor(<span class="string">&quot;W0&quot;</span>, TensorProto.FLOAT, conv_weight_shape,</span><br><span class="line">                                   conv_weight_data.flatten())</span><br><span class="line"></span><br><span class="line">    add_1_param = helper.make_tensor(<span class="string">&quot;add_1_param&quot;</span>,</span><br><span class="line">                                     TensorProto.FLOAT, add_param_shape,</span><br><span class="line">                                     add_1_param_data.flatten())</span><br><span class="line">    add_2_param = helper.make_tensor(<span class="string">&quot;add_2_param&quot;</span>,</span><br><span class="line">                                     TensorProto.FLOAT, add_param_shape,</span><br><span class="line">                                     add_2_param_data.flatten())</span><br><span class="line"></span><br><span class="line">    <span class="comment"># make graph</span></span><br><span class="line">    graph = helper.make_graph(</span><br><span class="line">        nodes,</span><br><span class="line">        <span class="string">&quot;simple_conv_model&quot;</span>,</span><br><span class="line">        inputs=[model_input_1, model_input_2],  <span class="comment"># input</span></span><br><span class="line">        outputs=[model_output_1, model_output_2],  <span class="comment"># output</span></span><br><span class="line">        initializer=[W0_tensor, add_1_param, add_2_param],  <span class="comment"># initializer</span></span><br><span class="line">        value_info=[add_1_out, add_2_out],  <span class="comment"># value_info</span></span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="comment"># make model</span></span><br><span class="line">    onnx_model = helper.make_model(graph,</span><br><span class="line">                                   opset_imports=[</span><br><span class="line">                                       helper.make_opsetid(<span class="string">&quot;&quot;</span>, <span class="number">11</span>),</span><br><span class="line">                                       helper.make_opsetid(<span class="string">&quot;horizon.cop1&quot;</span>, <span class="number">1</span>),</span><br><span class="line">                                       helper.make_opsetid(<span class="string">&quot;horizon.cop2&quot;</span>, <span class="number">1</span>)</span><br><span class="line">                                   ],</span><br><span class="line">                                   producer_name=<span class="string">&quot;onnx-test&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># shape inference</span></span><br><span class="line">    onnx_model = shape_inference.infer_shapes(onnx_model)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># # model check</span></span><br><span class="line">    checker.check_model(onnx_model)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># save model</span></span><br><span class="line">    onnx.save(onnx_model, <span class="string">&quot;custom_op.onnx&quot;</span>)</span><br></pre></td></tr></table></figure></div>

<blockquote>
<p><em>åœ¨æ·±åº¦å­¦ä¹ ä¸­ï¼Œâ€PyOpâ€ æ˜¯æŒ‡åŸºäº Python å®ç°çš„è‡ªå®šä¹‰æ“ä½œï¼ˆCustom Operatorï¼‰ã€‚<strong>PyOp æ˜¯ä¸€ç§æ‰©å±•æœºåˆ¶ï¼Œå…è®¸ç”¨æˆ·æ ¹æ®è‡ªå·±çš„éœ€æ±‚å®šä¹‰å’Œå®ç°è‡ªå·±çš„æ“ä½œï¼Œä»è€Œæ‰©å±•æ·±åº¦å­¦ä¹ æ¡†æ¶çš„åŠŸèƒ½ã€‚</strong></em></p>
<p><em>PyOp æä¾›äº†ä¸€ä¸ªæ¥å£ï¼Œä½¿ç”¨æˆ·èƒ½å¤Ÿç¼–å†™è‡ªå®šä¹‰çš„æ“ä½œé€»è¾‘ï¼ŒåŒ…æ‹¬å‰å‘ä¼ æ’­å’Œåå‘ä¼ æ’­çš„è®¡ç®—ã€‚é€šè¿‡å®šä¹‰è‡ªå·±çš„ PyOpï¼Œç”¨æˆ·å¯ä»¥åœ¨æ·±åº¦å­¦ä¹ æ¡†æ¶ä¸­ä½¿ç”¨è‡ªå®šä¹‰çš„ç®—å­ï¼Œä»è€Œå®ç°æ›´å¤æ‚ã€æ›´çµæ´»çš„è®¡ç®—ã€‚</em></p>
<p><em>PyOp é€šå¸¸éœ€è¦æä¾›è¾“å…¥å’Œè¾“å‡ºçš„æè¿°ä¿¡æ¯ï¼ŒåŒ…æ‹¬è¾“å…¥æ•°æ®ç±»å‹ã€è¾“å‡ºæ•°æ®ç±»å‹ä»¥åŠè¾“å…¥è¾“å‡ºçš„å½¢çŠ¶ç­‰ã€‚è¿™äº›ä¿¡æ¯ç”¨äºåœ¨æ¨¡å‹å¯¼å‡ºæˆ–æ¨ç†è¿‡ç¨‹ä¸­è¿›è¡Œç±»å‹å’Œå½¢çŠ¶çš„åŒ¹é…å’Œæ£€æŸ¥ã€‚</em></p>
</blockquote>
<blockquote>
<p><em>åœ¨ ONNXï¼ˆOpen Neural Network Exchangeï¼‰ä¸­ï¼Œdomainï¼ˆé¢†åŸŸï¼‰ç”¨äºæ ‡è¯†ç‰¹å®šçš„ç®—å­é›†åˆæˆ–è‡ªå®šä¹‰ç®—å­çš„æ¥æºã€‚å®ƒæ˜¯ä¸€ä¸ªç”¨äºåŒºåˆ†ä¸åŒç®—å­ç»„çš„å‘½åç©ºé—´ï¼Œä»¥é¿å…å†²çªå’Œå‘½åé‡å¤ã€‚</em></p>
<p><em>ONNX æ ‡å‡†æä¾›äº†ä¸€äº›å†…ç½®çš„ domainï¼Œå¦‚ â€œai.onnxâ€ã€â€ai.onnx.mlâ€ ç­‰ï¼Œç”¨äºå­˜æ”¾æ ‡å‡†ç®—å­ã€‚è¿™äº› domain æ˜¯ ONNX è§„èŒƒçš„ä¸€éƒ¨åˆ†ã€‚</em></p>
<p><em>å¯¹äºè‡ªå®šä¹‰ç®—å­ï¼Œä¸ºäº†é¿å…ä¸æ ‡å‡†ç®—å­å†²çªï¼Œéœ€è¦å°†å®ƒä»¬å®šä¹‰åœ¨ä¸åŒçš„ domain ä¸‹ã€‚<strong>é€šè¿‡å°†è‡ªå®šä¹‰ç®—å­æ”¾ç½®åœ¨ç‰¹å®šçš„ domain ä¸­ï¼Œå¯ä»¥ç¡®ä¿ç®—å­çš„å”¯ä¸€æ€§ï¼Œå¹¶ä¸”åœ¨æ¨¡å‹å¯¼å‡ºæˆ–è¿è¡Œæ—¶èƒ½å¤Ÿæ­£ç¡®è¯†åˆ«å’ŒåŠ è½½ã€‚</strong></em></p>
<p><em>åœ¨ç»™å®šçš„ä»£ç ä¸­ï¼Œâ€™horizon.custom::PyOpâ€™ ä¸­çš„ â€˜horizon.customâ€™ å°±æ˜¯è‡ªå®šä¹‰ç®—å­æ‰€å±çš„ domainã€‚é€šè¿‡æŒ‡å®šç‰¹å®šçš„ domainï¼Œå¯ä»¥ç¡®ä¿è‡ªå®šä¹‰ç®—å­è¢«æ­£ç¡®åœ°è¯†åˆ«å’Œè§£æï¼Œé¿å…ä¸ ONNX æ ‡å‡†ç®—å­å‘ç”Ÿå†²çªå’Œæ··æ·†ã€‚å¦‚æœä¸æä¾› domainï¼Œé‚£ä¹ˆé»˜è®¤æƒ…å†µä¸‹ä¼šå°†ç®—å­è§†ä¸ºæ ‡å‡†ç®—å­ï¼Œå¹¶å°è¯•åœ¨æ ‡å‡†çš„ ONNX domain ä¸­æŸ¥æ‰¾å¯¹åº”çš„å®ç°ï¼Œè¿™å¯èƒ½å¯¼è‡´é”™è¯¯ã€‚å› æ­¤ï¼Œä¸ºäº†æ­£ç¡®å¤„ç†è‡ªå®šä¹‰ç®—å­ï¼Œéœ€è¦æ˜ç¡®æŒ‡å®šå®ƒä»¬æ‰€å±çš„ domainã€‚</em></p>
<p><em><strong>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå®šä¹‰ domain ä»…é€‚ç”¨äºè‡ªå®šä¹‰ç®—å­æˆ–æ‰©å±•ï¼Œå¯¹äºæ ‡å‡†çš„ ONNX ç®—å­ï¼Œä¸éœ€è¦å®šä¹‰ domainï¼Œå› ä¸ºå®ƒä»¬å·²ç»è¢«åˆ†é…åˆ° ONNX çš„æ ‡å‡† domain ä¸­ã€‚</strong></em></p>
</blockquote>
<p><em><strong>æ³¨æ„ï¼š</strong>Onnxæ¨¡å‹ä¸­PyOpå±æ€§çš„æ³¨æ„ç‚¹:</em></p>
<ol>
<li><em><strong>domainå±æ€§ä¸€å®šè¦è®¾ç½®, ä¸ç„¶çš„è¯ä¼šè¢«é»˜è®¤æˆonnxæ ‡å‡†domainä»è€ŒæŠ¥é”™ã€‚ä¸åŒå®ç°çš„è‡ªå®šä¹‰ç®—å­éœ€è¦è®¾ç½®åœ¨ä¸åŒçš„domainä¸‹</strong>ã€‚</em></li>
<li><em>moduleéœ€è¦ä¸æ³¨å†Œæ—¶ä½¿ç”¨çš„æ³¨å†Œæ–‡ä»¶åŒåã€‚è‹¥æ³¨å†Œæ–‡ä»¶åœ¨å½“å‰ç›®å½•çš„å­æ–‡ä»¶å¤¹ä¸­ï¼Œåˆ™éœ€è¦ä¿®æ”¹moduleå†…å®¹ã€‚ä¾‹å¦‚: è‹¥ <code>sample_custom.py</code> åœ¨å½“å‰è·¯å¾„çš„custom_op æ–‡ä»¶å¤¹ä¸­ï¼Œåˆ™è¯¥moduleåº”è®¾ç½®ä¸º <code>custom_op.sample_custom</code> ã€‚</em></li>
<li><em>ç›®å‰ä»…onnxæ¨¡å‹æ”¯æŒå¤šç§ç±»å‹çš„è‡ªå®šä¹‰ç®—å­ï¼Œå¦‚æ‚¨éœ€è¦åœ¨å…¶ä»–æ¡†æ¶ä¸­æ”¯æŒå¤šç§ç±»å‹çš„è‡ªå®šä¹‰ç®—å­è¯·è”ç³»åœ°å¹³çº¿ã€‚</em></li>
</ol>
<p><em><strong>ç®—å­å®ç°</strong></em></p>
<p><em>åœ¨æ¨¡å‹è½¬æ¢é˜¶æ®µï¼Œéœ€è¦æä¾›è‡ªå®šä¹‰ç®—å­çš„Pythonå®ç°ï¼Œå·¥å…·ä¼šåˆ©ç”¨è¯¥å®ç°å‡½æ•°å®Œæˆæ¨¡å‹æ ¡å‡†å¿…éœ€çš„æ¨ç†é˜¶æ®µã€‚</em></p>
<p><em>Pythonæ¨¡æ¿æ–‡ä»¶(sample_custom.py)å¦‚ä¸‹:</em></p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> horizon_nn.custom.op_registration <span class="keyword">import</span> op_implement_register, op_shape_infer_register</span><br><span class="line"></span><br><span class="line"><span class="meta">@op_implement_register(<span class="params"><span class="string">&quot;CustomIdentity&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CustomIdentity</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, kernel_size, threshold</span>):</span><br><span class="line">        self._kernel_size = kernel_size</span><br><span class="line">        self._default_threshold = threshold</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">compute</span>(<span class="params">self, X</span>):</span><br><span class="line">        <span class="keyword">return</span> X</span><br><span class="line"></span><br><span class="line"><span class="meta">@op_shape_infer_register(<span class="params"><span class="string">&quot;CustomIdentity&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">infer_shape</span>(<span class="params">inputs_shape</span>):</span><br><span class="line">    outputs_shape = inputs_shape</span><br><span class="line">    <span class="keyword">return</span> outputs_shape</span><br></pre></td></tr></table></figure></div>

<p><em>custom_opç¤ºä¾‹ä¸­çš„é…ç½®æ–‡ä»¶(horizon_ops.py)å¦‚ä¸‹:</em></p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> horizon_nn.custom.op_registration <span class="keyword">import</span> op_implement_register</span><br><span class="line"></span><br><span class="line"><span class="meta">@op_implement_register(<span class="params"><span class="string">&quot;Cop1&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Cop1</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, </span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">compute</span>(<span class="params">self, x1, x2</span>):</span><br><span class="line">        out = x1 + x2 + <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> out</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@op_implement_register(<span class="params"><span class="string">&quot;Cop2&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Cop2</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, </span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">compute</span>(<span class="params">self, x1, x2, x3</span>):</span><br><span class="line">        out = x1 + x2 + x3 + <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> out, out</span><br></pre></td></tr></table></figure></div>

<p><em>è¯¥æ–‡ä»¶çš„åå­—(sample_custom.py)éœ€è¦å¡«å…¥æ¨¡å‹è½¬æ¢çš„yamlé…ç½®æ–‡ä»¶ä¸­ <code>op_register_files</code> ï¼Œå¦åˆ™å·¥å…·æ— æ³•æ­£å¸¸importè‡ªå®šä¹‰ç®—å­å®šä¹‰ï¼Œ å¹¶ä¸”ä¿®é¥°å™¨ <code>op_implement_register</code> æ³¨å†Œçš„custom opç±»çš„åç§° <code>CustomIdentity</code> éœ€è¦ä¸Caffeè‡ªå®šä¹‰OPçš„å±æ€§ <code>kind</code> æˆ–è€…Onnxè‡ªå®šä¹‰OPçš„å±æ€§ <code>class_name</code> ä¸€è‡´ã€‚</em></p>
<p><em><strong>å¯¹äº <code>Caffe</code> æ¨¡å‹ï¼Œ <code>init</code> å‡½æ•°ä¸­çš„å‚æ•°(<code>kernel_size, threshold</code>)éƒ½æ˜¯é€šè¿‡prototxtæ–‡ä»¶ä¸­çš„ <code>params</code> ä¼ å…¥çš„ï¼Œ ç”¨äºè‡ªå®šä¹‰opæ¨¡å—çš„åˆå§‹åŒ–ã€‚ <code>op_shape_infer_register</code> ç”¨äºCaffeæ¨¡å‹çš„ç®—å­shapeæ³¨å†Œã€‚</strong></em></p>
<p><em>å¯¹äº <code>Onnx</code> æ¨¡å‹ï¼Œ*<em>è‡ªå®šä¹‰opçš„shapeè§£ææœ‰ä¸¤ç§æ–¹å¼ï¼Œå¯ä»¥é€šè¿‡åœ¨åˆ›å»ºonnxæ¨¡å‹æ—¶ï¼Œå°†pyopè¾“å‡ºçš„value_infoæ·»åŠ åˆ°onnxæ¨¡å‹ä¸­ï¼Œ æˆ–è€…åœ¨å¯¹åº”çš„pyopä¸­åˆ›å»ºoutput_shapeå±æ€§ã€‚</em></em> è¿˜éœ€è¦æ³¨æ„è‡ªå®šä¹‰ç®—å­ä¸­çš„ <code>module</code> å¿…é¡»ä¸å­˜æ”¾è‡ªå®šä¹‰ç®—å­å®ç°çš„æ–‡ä»¶ä¿æŒä¸€è‡´ï¼Œ å¦‚æœå±æ€§è®¾ç½®ä¸º <code>custom_op.horizon_ops</code> ï¼Œ åˆ™è‡ªå®šä¹‰ç®—å­å®ç°çš„æ–‡ä»¶åç§°ä¸º <code>horizon_ops</code> ï¼Œä¸”è¦æ”¾åœ¨ custom_opæ–‡ä»¶å¤¹ä¸­ï¼Œ ä¿æŒä¸onnxæ¨¡å‹çš„å±‚çº§å…³ç³»ã€‚ ç”±äºåŒä¸€ä¸ªdomainä¸­çš„åŒåç®—å­å®ç°å¿…é¡»ç›¸åŒï¼Œ å› æ­¤ä¸åŒçš„è‡ªå®šä¹‰ç®—å­çš„ <code>domain</code> å±æ€§éœ€è¦ä¸åŒã€‚*</p>
<p><em>ä¸Šè¿°æ“ä½œå®Œæˆåå³å¯è¿›è¡Œæµ®ç‚¹è½¬å®šç‚¹çš„æ“ä½œï¼Œå¾—åˆ°ç›¸åº”çš„binæ–‡ä»¶ï¼ˆå³ <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/ptq/ptq_tool/hb_mapper.html#hb-mapper-makertbin" >æ¨¡å‹ç¼–è¯‘å‘½ä»¤ï¼ˆhb_mapper makertbinï¼‰ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ï¼‰ã€‚</em></p>
<blockquote>
<p><em>å«è‡ªå®šä¹‰ç®—å­çš„ä¸Šæ¿è¿è¡Œ</em></p>
</blockquote>
<p><em>åœ¨æ‹¿åˆ°binæ–‡ä»¶åï¼Œè¿˜ä¸èƒ½ç›´æ¥åœ¨å¼€å‘æ¿ä¸Šè¿è¡Œã€‚åœ¨è¿è¡Œä¹‹å‰éœ€è¦å…ˆæä¾›è‡ªå®šä¹‰ç®—å­çš„C++ä»£ç å®ç°ã€‚ <strong>å¯ä»¥ä½¿ç”¨ä¸‹æ–‡æä¾›çš„æ¨¡æ¿è¿›è¡Œä¿®æ”¹å¹¶æ·»åŠ åˆ°ç¤ºä¾‹ä»£ç ä¸­è¿›è¡Œä½¿ç”¨ã€‚</strong></em></p>
<p><em>å¦‚æœæ‚¨åªæ˜¯å¸Œæœ›æµ‹è¯•è‡ªå®šä¹‰ç®—å­çš„åŠŸèƒ½ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨æˆ‘ä»¬æä¾›çš„æ¨¡ç‰ˆæ–‡ä»¶ï¼Œæ¨¡ç‰ˆæ–‡ä»¶ä¸­å°†è¾“å…¥ç›´æ¥èµ‹å€¼ä¸ºè¾“å‡ºä½¿ç”¨ï¼Œ æ‰€ä»¥è¿™ä¸ªè‡ªå®šä¹‰ç®—å­å¹¶ä¸ä¼šå¯¹ç»“æœé€ æˆä»»ä½•å½±å“ã€‚</em></p>
<p><em>Runtimeæ¨¡æ¿æ–‡ä»¶å¦‚ä¸‹:</em></p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">// custom_identity_add1.h		ADVANCED_SAMPLES_CUSTOM_IDENTITY_ADD1_H_ æ¡ä»¶ç¼–è¯‘æŒ‡ä»¤ï¼Œç”¨äºé¿å…å¤´æ–‡ä»¶çš„é‡å¤åŒ…å«</span><br><span class="line"><span class="comment">#ifndef ADVANCED_SAMPLES_CUSTOM_IDENTITY_ADD1_H_     </span></span><br><span class="line"><span class="comment">#define ADVANCED_SAMPLES_CUSTOM_IDENTITY_ADD1_H_</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#include &lt;string&gt;</span></span><br><span class="line"><span class="comment">#include &lt;vector&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#include &quot;dnn/hb_dnn.h&quot;</span></span><br><span class="line"><span class="comment">#include &quot;dnn/plugin/hb_dnn_layer.h&quot;</span></span><br><span class="line"><span class="comment">#include &quot;dnn/plugin/hb_dnn_ndarray.h&quot;</span></span><br><span class="line"></span><br><span class="line">namespace hobot &#123;</span><br><span class="line">namespace dnn &#123;				//åµŒå¥—çš„å‘½åç©ºé—´å£°æ˜ï¼Œå°†åç»­çš„ä»£ç éƒ½æ”¾åœ¨ hobot::dnn å‘½åç©ºé—´ä¸­ã€‚</span><br><span class="line"></span><br><span class="line">Layer *Cop1_layer_creator();</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Cop1</span> : public Layer &#123;</span><br><span class="line">public:</span><br><span class="line">  Cop1() = default;				//åœ¨ä»£ç ä¸­çš„ Cop1() = default; ä¸­ï¼ŒCop1 ç±»çš„é»˜è®¤æ„é€ å‡½æ•°è¢«å®šä¹‰ä¸ºç¼–è¯‘å™¨ç”Ÿæˆçš„é»˜è®¤å®ç°ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ²¡æœ‰æ˜¾å¼æŒ‡å®šæ„é€ å‡½æ•°çš„å…·ä½“å®ç°ï¼Œè€Œæ˜¯ä½¿ç”¨ç¼–è¯‘å™¨æä¾›çš„é»˜è®¤å®ç°ã€‚</span><br><span class="line"></span><br><span class="line">public:</span><br><span class="line">  int32_t Init(const Attribute &amp;attributes) override;	//åœ¨ä»£ç ä¸­çš„ override å…³é”®å­—ç”¨äºå£°æ˜æ´¾ç”Ÿç±»ä¸­çš„ Init å‡½æ•°è¦†ç›–äº†åŸºç±»çš„åŒåè™šå‡½æ•°ã€‚é€šè¿‡ä½¿ç”¨ override å…³é”®å­—ï¼Œå¯ä»¥æé«˜ä»£ç çš„å¯è¯»æ€§ï¼Œæ¸…æ™°åœ°è¡¨è¾¾å‡ºæ´¾ç”Ÿç±»ä¸­çš„å‡½æ•°æ˜¯é‡å†™åŸºç±»ä¸­çš„è™šå‡½æ•°çš„æ„å›¾ï¼Œå¹¶ä¸”åœ¨ç¼–è¯‘é˜¶æ®µè¿›è¡Œé™æ€æ£€æŸ¥ï¼Œä»¥ç¡®ä¿æ­£ç¡®çš„å‡½æ•°è¦†ç›–ã€‚å¦‚æœæ´¾ç”Ÿç±»ä¸­çš„å‡½æ•°å¹¶æ²¡æœ‰æˆåŠŸè¦†ç›–åŸºç±»ä¸­çš„è™šå‡½æ•°ï¼Œç¼–è¯‘å™¨å°†ä¼šå‘å‡ºé”™è¯¯æç¤ºã€‚</span><br><span class="line"></span><br><span class="line">  int32_t Forward(const std::vector&lt;NDArray *&gt; &amp;bottomBlobs,</span><br><span class="line">                  std::vector&lt;NDArray *&gt; &amp;topBlobs,</span><br><span class="line">                  const hbDNNInferCtrlParam *inferCtrlParam) override;</span><br><span class="line"></span><br><span class="line">  std::string GetType() const override &#123; <span class="keyword">return</span> <span class="string">&quot;Cop1&quot;</span>; &#125;</span><br><span class="line"></span><br><span class="line">  uint32_t GetInputCount() const override &#123; <span class="keyword">return</span> num_args_; &#125;</span><br><span class="line"></span><br><span class="line">private:</span><br><span class="line">  std::string custom_op_name_;</span><br><span class="line">  int32_t num_args_;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">&#125;  // namespace dnn</span><br><span class="line">&#125;  // namespace hobot</span><br><span class="line"><span class="comment">#endif</span></span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">// custom_identity_add1.cpp</span><br><span class="line"><span class="comment">#include &quot;custom_identity_add1.h&quot;</span></span><br><span class="line"></span><br><span class="line">namespace hobot &#123;</span><br><span class="line">namespace dnn &#123;</span><br><span class="line"></span><br><span class="line">Layer *Cop1_layer_creator() &#123; <span class="keyword">return</span> new Cop1; &#125;</span><br><span class="line"></span><br><span class="line">int32_t Cop1::Init(const Attribute &amp;attributes) &#123;</span><br><span class="line">  // unused attribute, just demonstrating</span><br><span class="line">  attributes.GetAttributeValue(&amp;custom_op_name_, <span class="string">&quot;custom_op_name&quot;</span>);</span><br><span class="line">  // node<span class="string">&#x27;s input count</span></span><br><span class="line"><span class="string">  attributes.GetAttributeValue(&amp;num_args_, &quot;num_args&quot;);</span></span><br><span class="line"><span class="string">  return 0;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">int32_t Cop1::Forward(const std::vector&lt;NDArray *&gt; &amp;bottomBlobs,</span></span><br><span class="line"><span class="string">                      std::vector&lt;NDArray *&gt; &amp;topBlobs,</span></span><br><span class="line"><span class="string">                      const hbDNNInferCtrlParam *inferCtrlParam) &#123;</span></span><br><span class="line"><span class="string">  const NDArray *input0 = bottomBlobs[0];</span></span><br><span class="line"><span class="string">  const NDArray *input1 = bottomBlobs[1];</span></span><br><span class="line"><span class="string">  NDArray *out = topBlobs[0];</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  const auto *input0_data = input0-&gt;Dptr&lt;float&gt;();</span></span><br><span class="line"><span class="string">  const auto *input1_data = input1-&gt;Dptr&lt;float&gt;();</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  auto *out_data = out-&gt;Dptr&lt;float&gt;();</span></span><br><span class="line"><span class="string">  uint32_t size = out-&gt;Size();</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  for (uint32_t i = 0U; i &lt; size; i++) &#123;</span></span><br><span class="line"><span class="string">    out_data[i] = input0_data[i] + input1_data[i] + 1;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">  return 0;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">&#125;  // namespace dnn</span></span><br><span class="line"><span class="string">&#125;  // namespace hobot</span></span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">// custom_identity_add2.h</span><br><span class="line"><span class="comment">#ifndef ADVANCED_SAMPLES_CUSTOM_IDENTITY_ADD2_H_</span></span><br><span class="line"><span class="comment">#define ADVANCED_SAMPLES_CUSTOM_IDENTITY_ADD2_H_</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#include &lt;string&gt;</span></span><br><span class="line"><span class="comment">#include &lt;vector&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#include &quot;dnn/hb_dnn.h&quot;</span></span><br><span class="line"><span class="comment">#include &quot;dnn/plugin/hb_dnn_layer.h&quot;</span></span><br><span class="line"><span class="comment">#include &quot;dnn/plugin/hb_dnn_ndarray.h&quot;</span></span><br><span class="line"></span><br><span class="line">namespace hobot &#123;</span><br><span class="line">namespace dnn &#123;</span><br><span class="line"></span><br><span class="line">Layer *Cop2_layer_creator();</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Cop2</span> : public Layer &#123;</span><br><span class="line">public:</span><br><span class="line">  Cop2() = default;</span><br><span class="line">  ~Cop2() override = default;</span><br><span class="line"></span><br><span class="line">public:</span><br><span class="line">  int32_t Init(const Attribute &amp;attributes) override;</span><br><span class="line"></span><br><span class="line">  int32_t Forward(const std::vector&lt;NDArray *&gt; &amp;bottomBlobs,</span><br><span class="line">                  std::vector&lt;NDArray *&gt; &amp;topBlobs,</span><br><span class="line">                  const hbDNNInferCtrlParam *inferCtrlParam) override;</span><br><span class="line"></span><br><span class="line">  std::string GetType() const override &#123; <span class="keyword">return</span> <span class="string">&quot;Cop2&quot;</span>; &#125;</span><br><span class="line"></span><br><span class="line">  uint32_t GetInputCount() const override &#123; <span class="keyword">return</span> num_args_; &#125;</span><br><span class="line"></span><br><span class="line">  uint32_t GetOutputCount() const override &#123; <span class="keyword">return</span> 2U; &#125;</span><br><span class="line"></span><br><span class="line">private:</span><br><span class="line">  std::string custom_op_name_;</span><br><span class="line">  int32_t num_args_;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">&#125;  // namespace dnn</span><br><span class="line">&#125;  // namespace hobot</span><br><span class="line"></span><br><span class="line"><span class="comment">#endif</span></span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">// custom_identity_add2.cpp</span><br><span class="line"><span class="comment">#include &quot;custom_identity_add2.h&quot;</span></span><br><span class="line"></span><br><span class="line">namespace hobot &#123;</span><br><span class="line">namespace dnn &#123;</span><br><span class="line"></span><br><span class="line">Layer *Cop2_layer_creator() &#123; <span class="keyword">return</span> new Cop2; &#125;</span><br><span class="line"></span><br><span class="line">int32_t Cop2::Init(const Attribute &amp;attributes) &#123;</span><br><span class="line">  // unused attribute, just demonstrating</span><br><span class="line">  attributes.GetAttributeValue(&amp;custom_op_name_, <span class="string">&quot;custom_op_name&quot;</span>);</span><br><span class="line">  // node<span class="string">&#x27;s input count</span></span><br><span class="line"><span class="string">  attributes.GetAttributeValue(&amp;num_args_, &quot;num_args&quot;);</span></span><br><span class="line"><span class="string">  return 0;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">int32_t Cop2::Forward(const std::vector&lt;NDArray *&gt; &amp;bottomBlobs,</span></span><br><span class="line"><span class="string">                      std::vector&lt;NDArray *&gt; &amp;topBlobs,</span></span><br><span class="line"><span class="string">                      const hbDNNInferCtrlParam *inferCtrlParam) &#123;</span></span><br><span class="line"><span class="string">  const NDArray *input0 = bottomBlobs[0];</span></span><br><span class="line"><span class="string">  const NDArray *input1 = bottomBlobs[1];</span></span><br><span class="line"><span class="string">  const NDArray *input2 = bottomBlobs[2];</span></span><br><span class="line"><span class="string">  NDArray *out0 = topBlobs[0];</span></span><br><span class="line"><span class="string">  NDArray *out1 = topBlobs[1];</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  const auto *input0_data = input0-&gt;Dptr&lt;float&gt;();</span></span><br><span class="line"><span class="string">  const auto *input1_data = input1-&gt;Dptr&lt;float&gt;();</span></span><br><span class="line"><span class="string">  const auto *input2_data = input2-&gt;Dptr&lt;float&gt;();</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  auto *out0_data = out0-&gt;Dptr&lt;float&gt;();</span></span><br><span class="line"><span class="string">  auto *out1_data = out1-&gt;Dptr&lt;float&gt;();</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  uint32_t size = out0-&gt;Size();</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  for (uint32_t i = 0U; i &lt; size; i++) &#123;</span></span><br><span class="line"><span class="string">    out0_data[i] = input0_data[i] + input1_data[i] + input2_data[i] + 1;</span></span><br><span class="line"><span class="string">    out1_data[i] = out0_data[i];</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">  return 0;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">&#125;  // namespace dnn</span></span><br><span class="line"><span class="string">&#125;  // namespace hobot</span></span><br></pre></td></tr></table></figure></div>

<p><em><strong>æ³¨æ„ï¼š</strong></em></p>
<p><em>è¯¥å‡½æ•°åç§°çš„å‰ç¼€(å³ <code>Cop1</code> å’Œ <code>Cop2</code>) éœ€è¦ä¸è‡ªå®šä¹‰OPçš„ç±»å‹ï¼ˆ<code>Kind</code>ï¼‰ä¸€è‡´, å…¶ä¼ å…¥çš„å‚æ•°ä¸º:</em></p>
<ul>
<li><em><code>bottom_blobs</code> ï¼šè‡ªå®šä¹‰OPèŠ‚ç‚¹è¾“å…¥æ•°æ®ã€‚</em></li>
<li><em><code>top_blobs</code> ï¼šè‡ªå®šä¹‰OPèŠ‚ç‚¹è¾“å‡ºæ•°æ®ã€‚</em></li>
<li><em><code>inferCtrlParam</code> ï¼šè‡ªå®šä¹‰ç®—å­åˆå§‹åŒ–é˜¶æ®µçš„è¾“å…¥å‚æ•°ã€‚</em></li>
<li><em><strong>æ¨¡æ¿ä¸­çš„è¿ç®—è§„åˆ™å‡ä¸ºè¾“å‡ºç­‰äºæ‰€æœ‰è¾“å…¥æ•°æ®ç´¯åŠ åå†åŠ ä¸Šæ•°å€¼1, å› æ­¤åç»­ç”¨æˆ·è‹¥è¦å®šä¹‰å…¶ä»–è¡Œä¸º, åˆ™éœ€ç›¸åº”çš„æ›´æ”¹è¿ç®—è§„åˆ™å³å¯ã€‚</strong></em></li>
</ul>
<p><em><strong>è‡ªå®šä¹‰ç®—å­æ³¨å†Œ</strong></em></p>
<p><em>å½“æ‚¨å®ŒæˆC++ç‰ˆæœ¬æ¨¡ç‰ˆçš„ä¿®æ”¹åï¼Œä»…éœ€è¦åœ¨ç¤ºä¾‹çš„CMakeLists.txtä¸­æ·»åŠ å¯¹æ¨¡ç‰ˆæ–‡ä»¶çš„åŒ…å«ï¼Œ å¹¶åœ¨åº”ç”¨ç¨‹åºä¸­å¢åŠ å¯¹ç®—å­çš„æ³¨å†Œå³å¯ï¼Œæ³¨å†Œè¯·å‚è€ƒä»¥ä¸‹ä»£ç ï¼š</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#include &quot;custom_identity_add1.h&quot;</span><br><span class="line">#include &quot;custom_identity_add2.h&quot;</span><br><span class="line"></span><br><span class="line">hbDNNRegisterLayerCreator(&quot;Cop1&quot;, hobot::dnn::Cop1_layer_creator);</span><br><span class="line">hbDNNRegisterLayerCreator(&quot;Cop2&quot;, hobot::dnn::Cop2_layer_creator);</span><br><span class="line">....</span><br></pre></td></tr></table></figure></div>

<p><em>å½“æ‚¨å®Œæˆå¯¹æ¨¡ç‰ˆæ–‡ä»¶çš„ä¾èµ–åŠç®—å­æ³¨å†Œåï¼Œå³å¯å¯¹å«æœ‰è‡ªå®šä¹‰ç®—å­çš„æ¨¡å‹è¿›è¡Œæ‰§è¡Œç­‰æ“ä½œã€‚</em></p>
<p><em><strong>æ³¨æ„ï¼šåœ¨ä½¿ç”¨å‰ï¼Œè¯·æ‚¨ç¡®è®¤æ¨¡å‹çš„è‡ªå®šä¹‰ç®—å­åç§°ä¸æ³¨å†Œçš„ç®—å­åç§°æ˜¯ç›¸åŒçš„ã€‚</strong></em></p>
<h5 id="PTQå·¥å…·æ–‡æ¡£"><a href="#PTQå·¥å…·æ–‡æ¡£" class="headerlink" title="PTQå·¥å…·æ–‡æ¡£"></a><em>PTQå·¥å…·æ–‡æ¡£</em></h5><p><em>æœ¬ç« èŠ‚æ—¨åœ¨è¯´æ˜åœ°å¹³çº¿J5èŠ¯ç‰‡ç®—æ³•å·¥å…·é“¾æ‰€æä¾›çš„PTQæ¨¡å‹è½¬æ¢æ–¹æ¡ˆçš„å·¥å…·åŒ…çš„ä»‹ç»åŠä½¿ç”¨æ–¹æ³•ã€‚</em></p>
<p><em>å»ºè®®åœ¨é˜…è¯»æœ¬ç« å†…å®¹ä¹‹å‰å…ˆå®Œæˆä»¥ä¸‹å‡†å¤‡å·¥ä½œï¼š</em></p>
<ol>
<li><em>é˜…è¯» <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/preface/toolchain_overview.html" >å·¥å…·é“¾æ¦‚è§ˆ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ç« èŠ‚ä¸­PTQæ–¹æ¡ˆçš„ç›¸å…³å†…å®¹å’Œ <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/ptq/ptq_usage/ptq_usage.html" >PTQåŸç†åŠæ­¥éª¤ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ç« èŠ‚çš„å†…å®¹ï¼Œ ä»¥äº†è§£å¯¹PTQæ–¹æ¡ˆå’Œæ¨¡å‹è½¬æ¢æ­¥éª¤ã€‚</em></li>
<li><em>æ ¹æ® <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/env_install/env_deploy.html#model-docker-env" >Dockerå®¹å™¨éƒ¨ç½² <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ç« èŠ‚çš„å†…å®¹å®Œæˆäº†Dockerç¯å¢ƒå®‰è£…é…ç½®å’Œé•œåƒæ‹‰å–ã€‚</em></li>
<li><em>è¿è¡Œ <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/ptq/ptq_sample/ptq_sample.html" >PTQæ¨¡å‹è½¬æ¢ç¤ºä¾‹æ‰‹å†Œ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ç« èŠ‚ä¸­çš„æ¨¡å‹è½¬æ¢ç›¸å…³ç¤ºä¾‹ã€‚</em></li>
</ol>
<p><em>æœ¬ç« å†…å®¹ä¸»è¦ä»‹ç»åœ°å¹³çº¿PTQæ–¹æ¡ˆçš„æ¨¡å‹è½¬æ¢å·¥å…·åŒ…ã€‚ è¯¥å·¥å…·åŒ…å¯åœ¨å¼€å‘æœºæˆ–Dockerç¯å¢ƒä¸‹è¿è¡Œã€‚ å¦‚æœæ‚¨é€‰æ‹©åœ¨å¼€å‘æœºä¸­è¿è¡Œè¯¥å·¥å…·åŒ…ï¼Œåˆ™éœ€è¦åœ¨J5å¤©å·¥å¼€ç‰©å‘å¸ƒç‰©ï¼ˆå³ï¼šhorizon_j5_open_explorerï¼‰çš„ <code>ddk/package/host</code> è·¯å¾„ä¸‹è¿è¡Œ <code>install.sh</code> è„šæœ¬è¿›è¡Œå®‰è£…ã€‚å®‰è£…å®Œæˆåï¼Œè¿è¡Œ <code>hb_mapper --help</code> å‘½ä»¤éªŒè¯å·¥å…·å®‰è£…æ˜¯å¦æˆåŠŸã€‚ å¦‚æœæ‚¨é€‰æ‹©åœ¨Dockerå®¹å™¨ä¸­è¿è¡Œè¯¥å·¥å…·ï¼Œåˆ™æ— éœ€ä»¥ä¸Šå®‰è£…æ­¥éª¤ï¼Œæ ¹æ® <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/env_install/env_deploy.html#model-docker-env" >Dockerå®¹å™¨éƒ¨ç½² <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ç« èŠ‚å†…å®¹ï¼Œ è¿›å…¥Dockerå®¹å™¨åï¼Œç„¶åè¿è¡Œ <code>hb_mapper --help</code> å‘½ä»¤éªŒè¯å·¥å…·å®‰è£…æ˜¯å¦æˆåŠŸã€‚</em></p>
<blockquote>
<p><em>æ¨¡å‹è½¬æ¢è¿‡ç¨‹è¯¦è§£</em></p>
</blockquote>
<p><em>æ¨¡å‹çš„è½¬æ¢é€šå¸¸å¯åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š</em></p>
<ol>
<li><em>æ£€æŸ¥å¾…è½¬æ¢çš„æ¨¡å‹ä¸­æ˜¯å¦åŒ…å«ä¸æ”¯æŒçš„OPç±»å‹ã€‚</em></li>
<li><em>å‡†å¤‡å¥½20-100å¼ æ ¡å‡†ä½¿ç”¨çš„å›¾ç‰‡ï¼Œç”¨äºè½¬æ¢é˜¶æ®µçš„æ ¡å‡†æ“ä½œã€‚</em></li>
<li><em>ä½¿ç”¨æµ®ç‚¹æ¨¡å‹è½¬æ¢å·¥å…·å°†åŸå§‹æµ®ç‚¹æ¨¡å‹è½¬æ¢ä¸ºå®šç‚¹æ¨¡å‹ã€‚</em></li>
<li><em>å¯¹è½¬æ¢åçš„æ¨¡å‹è¿›è¡Œæ€§èƒ½å’Œç²¾åº¦çš„è¯„ä¼°ï¼Œç¡®ä¿è½¬æ¢åçš„å®šç‚¹æ¨¡å‹ç²¾åº¦ä¸ä¹‹å‰ç›¸å·®ä¸å¤§ã€‚</em></li>
<li><em>åœ¨æ¨¡æ‹Ÿå™¨&#x2F;å¼€å‘æ¿ä¸Šè¿è¡Œæ¨¡å‹ï¼Œå¯¹æ¨¡å‹çš„æ€§èƒ½å’Œç²¾åº¦è¿›è¡ŒéªŒè¯ã€‚</em></li>
</ol>
<p><em>æ¨¡å‹è½¬æ¢æ­¥éª¤çš„æµç¨‹å›¾å¦‚ä¸‹:</em></p>
<p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230510101919593.png"
                      class="" title="image-20230510101919593"
                ></em></p>
<p><em>å¯¹åº”åˆ°å·¥å…·ä½¿ç”¨æ–¹é¢ï¼Œå„æ­¥éª¤è¯´æ˜å¦‚ä¸‹ï¼š</em></p>
<p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230510102108014.png"
                      class="" title="image-20230510102108014"
                ></em></p>
<p><em><strong>æ¨¡å‹æ£€æŸ¥ï¼ˆhb_mapper checkerï¼‰</strong></em></p>
<p><em><strong>æ³¨æ„ï¼šå¦‚æœæœ¬è¿‡ç¨‹ï¼Œæ‚¨éœ€åœ¨ç¤ºä¾‹æ–‡ä»¶å¤¹å†…è¿›è¡Œï¼Œé‚£ä¹ˆæ‚¨éœ€è¦å…ˆæ‰§è¡Œæ–‡ä»¶å¤¹ä¸­çš„ <code>00_init.sh</code> è„šæœ¬ä»¥è·å–å¯¹åº”çš„åŸå§‹æ¨¡å‹å’Œæ•°æ®é›†ã€‚</strong></em></p>
<p><em>æ¨¡å‹åœ¨ä»æµ®ç‚¹è½¬æ¢ä¸ºå®šç‚¹æ¨¡å‹ä¹‹å‰ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦é€šè¿‡å·¥å…· <code>hb_mapper checker</code> å­å‘½ä»¤æ£€æŸ¥ä¸€ä¸‹ï¼Œçœ‹çœ‹è¯¥æ¨¡å‹æ˜¯å¦åŒ…å«ä¸èƒ½åœ¨åœ°å¹³çº¿ç¡¬ä»¶ä¸Šè¿è¡Œçš„OPã€‚ å¦‚æœå­˜åœ¨ï¼Œåˆ™ä¼šåœ¨è¯¥é˜¶æ®µæç¤ºä¸è®¤è¯†è¯¥OPï¼Œ<code>hb_mapper checker</code> å­å‘½ä»¤ä½¿ç”¨æ–¹å¼å¯å‚è€ƒ <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/ptq/ptq_tool/hb_mapper.html#hb-mapper-checker" >æ¨¡å‹æ£€æŸ¥å‘½ä»¤ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ä¸€èŠ‚å†…å®¹ã€‚</em></p>
<p><em>è‹¥è¿‡ç¨‹ä¸­å­˜åœ¨ä¸æ”¯æŒOPï¼Œåˆ™ä¼šå‡ºç°å¦‚ä¸‹æç¤º:</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ERROR HorizonRT not support these cpu operators: &#123;ä¸æ”¯æŒçš„OPåç§°&#125;</span><br></pre></td></tr></table></figure></div>

<p><em><strong>æ³¨æ„</strong></em></p>
<ul>
<li><em>æœ‰å…³åœ°å¹³çº¿ç¡¬ä»¶å¯æ”¯æŒçš„OPä¿¡æ¯ï¼Œè¯·å‚è§ <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/appendix/supported_op_list.html" >æ¨¡å‹è½¬æ¢å·¥å…·é“¾ç®—å­æ”¯æŒçº¦æŸåˆ—è¡¨ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ç« èŠ‚å†…å®¹ã€‚</em></li>
<li><em>è‹¥æ— ä¸æ”¯æŒOPï¼Œåˆ™ä¼šè¾“å‡ºæ¨¡å‹è½¬æ¢åçš„å„OPçš„åˆ—è¡¨ï¼Œä»¥åŠå„OPè¢«åˆ’åˆ†åœ¨CPUè¿˜æ˜¯BPUä¸Šæ‰§è¡Œã€‚ è‹¥éªŒè¯ç»“æŸä¸”æ— æŠ¥é”™ï¼Œå³å¯ç»§ç»­è¿›è¡Œåç»­æ­¥éª¤ã€‚å‚è§å¦‚ä¸‹ï¼š</em></li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">hb_mapper checker --model-type caffe --proto mobilenet_deploy.prototxt \</span><br><span class="line">--model mobilenet.caffemodel --march bayes</span><br><span class="line">2021-01-08 17:33:53,117 INFO Start hb_mapper....</span><br><span class="line">2021-01-08 17:33:53,118 INFO hb_mapper version 1.1.42</span><br><span class="line">...</span><br><span class="line">fc7          BPU  id(0)     HzSQuantizedConv</span><br><span class="line">prob         CPU  --        Softmax</span><br><span class="line">2021-01-08 17:33:53,329 INFO [Fri Jan  8 17:33:53 2021] End to Horizon NN Model Convert.</span><br><span class="line">2021-01-08 17:33:53,332 INFO model deps info empty</span><br><span class="line">2021-01-08 17:33:53,351 INFO End model checking....</span><br></pre></td></tr></table></figure></div>

<p><em>è‹¥å­˜åœ¨ä¸æ”¯æŒOPï¼Œå¯å’¨è¯¢åœ°å¹³çº¿æŠ€æœ¯äººå‘˜ç›¸å…³OPå¼€å‘è®¡åˆ’ï¼Œæˆ–è€…é€šè¿‡ <strong>è‡ªå®šä¹‰ç®—å­ï¼ˆCustom OPï¼‰</strong> åŠŸèƒ½æ·»åŠ è¯¥OPã€‚</em></p>
<p><em><strong>å‡†å¤‡æ ¡å‡†å›¾ç‰‡</strong></em></p>
<p><em>å¦‚æœæœ¬è¿‡ç¨‹ï¼Œæ‚¨éœ€åœ¨ç¤ºä¾‹æ–‡ä»¶å¤¹å†…è¿›è¡Œï¼Œé‚£ä¹ˆæ‚¨éœ€è¦å…ˆæ‰§è¡Œæ–‡ä»¶å¤¹ä¸­çš„ <code>00_init.sh</code> è„šæœ¬ä»¥è·å–å¯¹åº”çš„åŸå§‹æ¨¡å‹å’Œæ•°æ®é›†ã€‚</em></p>
<p><em>åœ¨è¿›è¡Œæ¨¡å‹è½¬æ¢æ—¶ï¼Œæ ¡å‡†é˜¶æ®µéœ€è¦20-100å¼ å›¾ç‰‡è¾“å…¥è¿›è¡Œæ ¡å‡†æ“ä½œã€‚ ç”±äºæ¨¡å‹çš„è¾“å…¥ç±»å‹åŠlayoutçš„ä¸åŒï¼Œè¾“å…¥çš„å›¾ç‰‡æ ¼å¼å¯ä»¥å¤šç§å¤šæ ·ã€‚ è¯¥é˜¶æ®µæ—¢å¯ä»¥è¾“å…¥åŸå§‹å›¾ç‰‡ï¼ˆ</em>.jpgç­‰)ï¼Œ ä¹Ÿå¯ä»¥è¾“å…¥å¤„ç†è¿‡çš„ï¼Œæ»¡è¶³æ¨¡å‹è¾“å…¥è¦æ±‚çš„å›¾ç‰‡ã€‚ ç”¨æˆ·å¯ä»¥ç›´æ¥ä»æ¨¡å‹è®­ç»ƒæ—¶çš„æ•°æ®é›†ä¸­è·å–ç›¸åº”çš„æ ¡å‡†å›¾ç‰‡ï¼Œä¹Ÿå¯ä»¥è‡ªè¡Œå¤„ç†å›¾ç‰‡ç”Ÿæˆæ ¡å‡†æ•°æ®é›†ã€‚*</p>
<p><em>æ¨èç”¨æˆ·è‡ªè¡Œå¯¹æ ¡å‡†å›¾ç‰‡è¿›è¡Œå‰å¤„ç†ï¼Œå°†å›¾ç‰‡çš„é€šé“(BGR&#x2F;RGB)ï¼Œæ•°æ®æ’å¸ƒ(NHWC&#x2F;NCHW)ï¼Œå›¾åƒå¤§å°åŠå¡«å……(Resize&amp;Padding)ç­‰æ“ä½œè°ƒæ•´å¥½åï¼Œ è®¾ç½®yamlæ–‡ä»¶(mobilenet_config.yaml) ä¸­çš„ <code>preprocess_on</code> å‚æ•°ä¸º <code>False</code>ï¼Œé‚£ä¹ˆå·¥å…·åˆ™ä¼šé€šè¿‡äºŒè¿›åˆ¶æ–‡ä»¶çš„æ–¹å¼å°†å›¾ç‰‡è¯»å…¥åé€å…¥æ ¡å‡†é˜¶æ®µã€‚</em></p>
<p><em>ä»¥MobileNetä¸ºä¾‹ï¼Œåˆ™éœ€è¦è¿›è¡Œå¦‚ä¸‹transformerçš„æ“ä½œï¼š</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">transformers = [</span><br><span class="line">      ShortSideResizeTransformer(short_size=256),   # çŸ­è¾¹Padåˆ°256, ä¿æŒé•¿å®½æ¯”</span><br><span class="line">      CenterCropTransformer(crop_size=224),         # å›¾åƒä¸­å¿ƒæŠ 224*224çš„å›¾åƒ</span><br><span class="line">      HWC2CHWTransformer(),                         # æ•°æ®æ’å¸ƒä»NHWCè½¬æ¢åˆ°NCHW</span><br><span class="line">      RGB2BGRTransformer(data_format=&quot;CHW&quot;),        # é¢œè‰²é€šé“ä»RGBè½¬æ¢ä¸ºBGR</span><br><span class="line">      ScaleTransformer(scale_value=255),            # æ•°æ®èŒƒå›´ä» 0-1 è½¬ä¸º 0-255</span><br><span class="line">  ]</span><br></pre></td></tr></table></figure></div>

<p><em>æ³¨æ„ï¼š</em></p>
<ul>
<li><p><em>è‹¥æ¨¡å‹è®­ç»ƒæ—¶æ˜¯bgr&#x2F;rgbè‰²å½©ç©ºé—´çš„ï¼Œåˆ™æ ¡å‡†é˜¶æ®µä¼ å…¥å·¥å…·çš„å›¾ç‰‡æ•°æ®éœ€è¦æ˜¯bgr&#x2F;rgbè‰²å½©ç©ºé—´çš„ï¼Œ å·¥å…·å†…éƒ¨ä¼šè‡ªåŠ¨å®Œæˆä»bgr&#x2F;rgbåˆ°yuv444&#x2F;grayç­‰çš„è‰²å½©è½¬æ¢ã€‚</em></p>
<p><em>ä¾‹å¦‚ï¼šç¤ºä¾‹ä¸­çš„MobileNetæ¨¡å‹å®é™…è¾“å…¥è®¾ç½®ä¸ºnv12ï¼Œè€Œ02_preprocess.shè„šæœ¬è½¬æ¢ç»“æŸåæ˜¯bgré¢œè‰²ç©ºé—´çš„ï¼Œ å‰©ä½™çš„ä»bgråˆ°nv12çš„è½¬æ¢æ˜¯ç”±å·¥å…·å†…éƒ¨è‡ªåŠ¨è¡¥å…¨çš„ã€‚</em></p>
</li>
</ul>
<p><em><strong>æ¨¡å‹è½¬æ¢ï¼ˆhb_mapper makertbinï¼‰</strong></em></p>
<p><em>å½“ç”¨æˆ·é€šè¿‡ä¸Šè¿° <code>hb_mapper checker</code> å­å‘½ä»¤ï¼Œç¡®å®šäº†æ¨¡å‹èƒ½å¤Ÿè¢«è½¬æ¢æˆåŠŸï¼Œ æ¥ä¸‹æ¥å¯ä»¥ä½¿ç”¨ <code>hb_mapper makertbin</code> å­å‘½ä»¤æ¥å°†æµ®ç‚¹æ¨¡å‹è½¬æ¢ä¸ºä¸€ä¸ªå¯ä»¥åœ¨åœ°å¹³çº¿ç¡¬ä»¶ä¸Šè¿è¡Œçš„å®šç‚¹æ¨¡å‹ã€‚</em></p>
<p><em>è¯¥å‘½ä»¤éœ€è¦ç”¨æˆ·ä¼ å…¥å¾…è½¬æ¢æ¨¡å‹çš„æ¨¡å‹ç±»å‹(<code>caffe</code> &#x2F; <code>onnx</code> )ä»¥åŠä¸€ä¸ªåŒ…å«è½¬æ¢è¦æ±‚çš„é…ç½®æ–‡ä»¶(</em>.yaml)ã€‚ å…·ä½“çš„é…ç½®æ–‡ä»¶è®¾ç½®ï¼Œè¯·å‚é˜… <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/ptq/ptq_tool/hb_mapper.html#hb-mapper-config" >é…ç½®æ–‡ä»¶è¯¦ç»†ä»‹ç» <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ã€‚*</p>
<p><em>æ¨¡å‹è½¬æ¢è¿‡ç¨‹ç»“æŸåï¼Œè¿˜ä¼šå°†åŸå§‹æ¨¡å‹ä¸è½¬æ¢åçš„å®šç‚¹æ¨¡å‹çš„ç›¸ä¼¼ç¨‹åº¦æ‰“å°åœ¨logä¸­ï¼Œ ç”¨æˆ·å¯æ ¹æ® <code>Cosine Similarity</code> å­—æ®µæ¥åˆ¤æ–­æ¨¡å‹è½¬æ¢å‰åçš„ç›¸ä¼¼åº¦ã€‚ å¦‚ä¸‹æ–¹æ‰€ç¤ºï¼Œæ¨¡<strong>å‹è½¬æ¢åçš„ <code>Cosine Similarity</code> éå¸¸æ¥è¿‘1ï¼Œ å› æ­¤æ¨¡å‹è½¬æ¢åçš„æ¨¡å‹è¡¨ç°ä¼šä¸è½¬æ¢å‰çš„æµ®ç‚¹æ¨¡å‹éå¸¸ç›¸è¿‘ã€‚</strong></em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">config_file=&quot;./mobilenet_config.yaml&quot;</span><br><span class="line">model_type=&quot;caffe&quot;</span><br><span class="line"># build model</span><br><span class="line">hb_mapper makertbin --config $&#123;config_file&#125;  \</span><br><span class="line">                    --model-type  $&#123;model_type&#125;</span><br><span class="line">2023-03-01 20:26:50,149 INFO Start hb_mapper....</span><br><span class="line">......</span><br><span class="line">2023-03-01 20:27:21,427 INFO [Wed Mar  1 20:27:21 2023] End to compile the model with march bayes.</span><br><span class="line">2023-03-01 20:27:21,429 INFO The converted model node information:</span><br><span class="line">======================================================================================================================</span><br><span class="line">Node                    ON   Subgraph  Type                           Cosine Similarity  Threshold   In/Out DataType</span><br><span class="line">----------------------------------------------------------------------------------------------------------------------</span><br><span class="line">HZ_PREPROCESS_FOR_data  BPU  id(0)     HzSQuantizedPreprocess         0.999988           127.000000  int8/int8</span><br><span class="line">conv1                   BPU  id(0)     HzSQuantizedConv               0.999922           2.937425    int8/int8</span><br><span class="line">conv2_1/dw              BPU  id(0)     HzSQuantizedConv               0.999378           2.040827    int8/int8</span><br><span class="line">conv2_1/sep             BPU  id(0)     HzSQuantizedConv               0.996680           4.486579    int8/int8</span><br><span class="line">conv2_2/dw              BPU  id(0)     HzSQuantizedConv               0.997340           3.545496    int8/int8</span><br><span class="line">conv2_2/sep             BPU  id(0)     HzSQuantizedConv               0.996384           2.791299    int8/int8</span><br><span class="line">conv3_1/dw              BPU  id(0)     HzSQuantizedConv               0.994165           1.417208    int8/int8</span><br><span class="line">conv3_1/sep             BPU  id(0)     HzSQuantizedConv               0.985451           2.188753    int8/int8</span><br><span class="line">conv3_2/dw              BPU  id(0)     HzSQuantizedConv               0.994921           1.822225    int8/int8</span><br><span class="line">conv3_2/sep             BPU  id(0)     HzSQuantizedConv               0.994251           1.841765    int8/int8</span><br><span class="line">conv4_1/dw              BPU  id(0)     HzSQuantizedConv               0.988263           1.043535    int8/int8</span><br><span class="line">conv4_1/sep             BPU  id(0)     HzSQuantizedConv               0.990294           1.736999    int8/int8</span><br><span class="line">conv4_2/dw              BPU  id(0)     HzSQuantizedConv               0.992460           0.990603    int8/int8</span><br><span class="line">conv4_2/sep             BPU  id(0)     HzSQuantizedConv               0.993468           1.574677    int8/int8</span><br><span class="line">conv5_1/dw              BPU  id(0)     HzSQuantizedConv               0.988949           0.823123    int8/int8</span><br><span class="line">conv5_1/sep             BPU  id(0)     HzSQuantizedConv               0.990803           1.265912    int8/int8</span><br><span class="line">conv5_2/dw              BPU  id(0)     HzSQuantizedConv               0.990202           0.772344    int8/int8</span><br><span class="line">conv5_2/sep             BPU  id(0)     HzSQuantizedConv               0.983443           1.530479    int8/int8</span><br><span class="line">conv5_3/dw              BPU  id(0)     HzSQuantizedConv               0.986502           0.783812    int8/int8</span><br><span class="line">conv5_3/sep             BPU  id(0)     HzSQuantizedConv               0.977642           1.927324    int8/int8</span><br><span class="line">conv5_4/dw              BPU  id(0)     HzSQuantizedConv               0.982337           0.996043    int8/int8</span><br><span class="line">conv5_4/sep             BPU  id(0)     HzSQuantizedConv               0.962062           2.167391    int8/int8</span><br><span class="line">conv5_5/dw              BPU  id(0)     HzSQuantizedConv               0.978872           1.923361    int8/int8</span><br><span class="line">conv5_5/sep             BPU  id(0)     HzSQuantizedConv               0.960184           3.578415    int8/int8</span><br><span class="line">conv5_6/dw              BPU  id(0)     HzSQuantizedConv               0.980317           2.463874    int8/int8</span><br><span class="line">conv5_6/sep             BPU  id(0)     HzSQuantizedConv               0.981055           4.124151    int8/int8</span><br><span class="line">conv6/dw                BPU  id(0)     HzSQuantizedConv               0.998241           0.667692    int8/int8</span><br><span class="line">conv6/sep               BPU  id(0)     HzSQuantizedConv               0.985220           0.983833    int8/int8</span><br><span class="line">pool6                   BPU  id(0)     HzSQuantizedGlobalAveragePool  0.993602           11.415899   int8/int8</span><br><span class="line">fc7                     BPU  id(0)     HzSQuantizedConv               0.995105           5.843800    int8/int32</span><br><span class="line">prob                    CPU  --        Softmax                        0.985517           --          float/float</span><br><span class="line">2023-03-01 20:27:21,430 INFO The quantify model output:</span><br><span class="line">=======================================================================</span><br><span class="line">Node  Cosine Similarity  L1 Distance  L2 Distance  Chebyshev Distance</span><br><span class="line">-----------------------------------------------------------------------</span><br><span class="line">prob  0.985517           0.000385     0.000203     0.185123</span><br><span class="line">2023-03-01 20:27:21,432 INFO [Wed Mar  1 20:27:21 2023] End to Horizon NN Model Convert.</span><br></pre></td></tr></table></figure></div>

<p><em><strong>æ³¨æ„ï¼šè¯¥ç›¸ä¼¼åº¦ä¸ºæ ¡å‡†å›¾ç‰‡ä¸­çš„ç¬¬ä¸€å¼ çš„ç›¸ä¼¼åº¦æƒ…å†µï¼Œå¹¶ä¸å®Œå…¨ä»£è¡¨æ¨¡å‹è½¬æ¢å‰åçš„ç²¾åº¦ã€‚</strong></em></p>
<p><em>åœ¨æ¨¡å‹è½¬æ¢æˆåŠŸåï¼Œä¼šåœ¨ç”Ÿæˆçš„æ–‡ä»¶å¤¹ (é»˜è®¤ä¸º model_output) ä¸­ç”Ÿæˆå¦‚ä¸‹æ–‡ä»¶ï¼š</em></p>
<ul>
<li>*é™æ€æ€§èƒ½è¯„ä¼°æ–‡ä»¶ï¼ˆå¯è¯»æ€§æ›´å¥½ï¼‰ï¼š ***_subgraph_0.htmlã€‚*</li>
<li>*é™æ€æ€§èƒ½è¯„ä¼°æ–‡ä»¶ï¼š ***_subgraph_0.jsonã€‚*</li>
<li>*åŸå§‹æµ®ç‚¹æ¨¡å‹ï¼š ***_original_float_model.onnxã€‚*</li>
<li>*ä¼˜åŒ–åçš„æµ®ç‚¹æ¨¡å‹ï¼š ***_optimized_float_model.onnxã€‚*</li>
<li>*æ ¡å‡†æ¨¡å‹ï¼šï¼š ***_calibrated_model.onnxã€‚*</li>
<li>*å®šç‚¹æ¨¡å‹ï¼š ***_quantized_model.onnxã€‚*</li>
<li>*ä¸Šæ¿ä½¿ç”¨çš„æ··åˆæ¨¡å‹ï¼š ***.binã€‚*</li>
</ul>
<p><em>è¿™å‡ ä¸ªæ¨¡å‹æ–‡ä»¶æ˜¯æ¨¡å‹è½¬æ¢çš„å‡ ä¸ªå…³é”®é˜¶æ®µäº§å‡ºçš„æ–‡ä»¶ï¼Œå¹¶ä¼šåœ¨åç»­é˜¶æ®µä½¿ç”¨åˆ°ã€‚</em></p>
<p><em><strong>æ³¨æ„ï¼šç”¨æˆ·å¯è°ƒç”¨03_classification&#x2F;01_mobilenet&#x2F;mapper&#x2F;03_build.shè„šæœ¬ï¼Œ æ¥ä½“éªŒ <code>hb_mapper makertbin</code> å­å‘½ä»¤çš„ä½¿ç”¨æ•ˆæœã€‚</strong></em></p>
<p><em><strong>å•å¼ å›¾ç‰‡çš„æ¨¡å‹æ¨ç†</strong></em></p>
<p><em>åœ¨è¿è¡Œæµ®ç‚¹æ¨¡å‹è½¬æ¢ä¹‹åï¼Œå¾—åˆ°äº†å®šç‚¹æ¨¡å‹ï¼Œè¿˜éœ€å¯¹å…¶è‡ªèº«çš„æ­£ç¡®æ€§è¿›è¡ŒéªŒè¯ã€‚</em></p>
<p><em>ç”¨æˆ·éœ€è¦å¯¹æ¨¡å‹çš„è¾“å…¥&#x2F;è¾“å‡ºç»“æ„æ¯”è¾ƒäº†è§£ï¼Œå¹¶èƒ½å¤Ÿæ­£ç¡®åœ°å¯¹æ¨¡å‹è¾“å…¥å›¾ç‰‡åšå‰å¤„ç†ä»¥åŠæ¨¡å‹è¾“å‡ºçš„åå¤„ç†è§£æï¼Œå¹¶è‡ªè¡Œç¼–å†™æ¨¡å‹è¿è¡Œè„šæœ¬ã€‚ åœ¨æ­¤è¿‡ç¨‹ä¸­å¯å‚ç…§äº¤ä»˜åŒ…ä¸­å¯¹åº”æ¨¡å‹çš„ç¤ºä¾‹ä»£ç ã€‚ ä»£ç é€»è¾‘å¦‚ä¸‹:</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">from horizon_tc_ui import HB_ONNXRuntime</span><br><span class="line">sess = HB_ONNXRuntime(model_file=FLAGS.model)</span><br><span class="line">output = sess.run([output_name], &#123;input_name: image_data&#125;, input_offset=input_offset)</span><br></pre></td></tr></table></figure></div>

<p><em>ä½¿ç”¨è¯¥è„šæœ¬åï¼Œä¾¿å¯é€šè¿‡è¾“å…¥å•å¼ å›¾ç‰‡éªŒè¯å…¶è‡ªèº«çš„æ­£ç¡®æ€§ã€‚è¯¥è„šæœ¬çš„è¾“å…¥ä¸ºä¸€å¼ æ–‘é©¬çš„å›¾ç‰‡ï¼Œ åœ¨ç»è¿‡å‰å¤„ç†å°†å›¾ç‰‡æ•°æ®ä»rgbå¤„ç†åˆ°input_type_rtçš„ä¸­é—´ç±»å‹ï¼ˆæ— éœ€-128ï¼‰å ï¼ˆç”±äºç¤ºä¾‹mobilenetçš„ <code>input_type_rt</code> æ˜¯nv12ï¼Œå¯¹åº”çš„ä¸­é—´ç±»å‹ä¸ºyuv444_128ï¼Œ å› æ­¤infer_transformersè¿‡ç¨‹éœ€è¦å®Œæˆrgbâ€“&gt;nv12â€“&gt;yuv444ï¼Œå…³äºä¸­é—´ç±»å‹çš„ä»‹ç»å¯å‚è€ƒ <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/ptq/ptq_usage/quantize_compile.html#conversion-interpretation" >è½¬æ¢è¿‡ç¨‹å†…éƒ¨è§£è¯» <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ï¼‰ï¼Œé€šè¿‡ <code>HB_ONNXRuntime</code> å‘½ä»¤ä¼ å…¥æ¨¡å‹è¿›è¡Œæ¨ç†ï¼Œ å¹¶é€šè¿‡è®¾ç½® <code>input_offset</code> å‚æ•°å®Œæˆ-128çš„æ“ä½œï¼Œæœ€åæ‰“å°å‡ºå…¶æœ€å¯èƒ½çš„5ä¸ªç§ç±»ã€‚</em></p>
<p><em>è¿è¡Œåçš„è¾“å‡ºå¦‚ä¸‹æ‰€ç¤ºï¼Œæœ€å¯èƒ½çš„ç±»åˆ«æ˜¯ <code>label: 340</code>ã€‚</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">I0108 18:11:47.398328 140427646048000 cls_inference.py:89] The input picture is classified to be:</span><br><span class="line">label 340: prob 0.97</span><br><span class="line">label 292: prob 0.02</span><br><span class="line">label 282: prob 0.00</span><br><span class="line">label 83: prob 0.00</span><br></pre></td></tr></table></figure></div>

<p><em><code>label</code> çš„ç±»åˆ«ä½¿ç”¨çš„æ˜¯ImageNetçš„ç±»åˆ«ï¼Œä¹Ÿå¯ä»¥åœ¨ 01_common&#x2F;test_data&#x2F;classes.txt ä¸­æŸ¥åˆ°ï¼Œ <code>340</code> æ­£æ˜¯å¯¹åº”ç€æ–‘é©¬ï¼Œå› æ­¤è¯¥å›¾ç‰‡æ¨ç†æ­£ç¡®ã€‚</em></p>
<p><em><strong>æ¨¡å‹ç²¾åº¦éªŒè¯</strong></em></p>
<p><em>å…‰å¯¹å•å¼ å›¾ç‰‡è¿›è¡ŒéªŒè¯è¿˜ä¸è¶³ä»¥è¯´æ˜æ¨¡å‹çš„ç²¾åº¦ï¼Œå› æ­¤è¿˜æœ‰è„šæœ¬å¯¹æ¨¡å‹è½¬æ¢åçš„ç²¾åº¦è¿›è¡Œè¯„æµ‹ã€‚</em></p>
<p><em>ç”¨æˆ·éœ€è¦ç¼–å†™ä»£ç ä½¿æ¨¡å‹èƒ½å¤Ÿå¾ªç¯æ¨ç†å›¾ç‰‡ï¼Œå¹¶å°†ç»“æœä¸æ ‡å‡†ç»“æœè¿›è¡Œæ¯”è¾ƒï¼Œå¾—åˆ°ç²¾åº¦ç»“æœã€‚</em></p>
<p>*å› ä¸ºç²¾åº¦è¯„æµ‹æ—¶ï¼Œéœ€è¦å¯¹å›¾ç‰‡è¿›è¡Œ <strong>å‰å¤„ç†</strong>ï¼Œå¯¹æ¨¡å‹æ•°æ®è¿›è¡Œ <strong>åå¤„ç†</strong>ï¼Œæ‰€ä»¥æˆ‘ä»¬æä¾›äº†ä¸€ä¸ªç¤ºä¾‹Pythonè„šæœ¬ã€‚ å…¶åŸç†ä¸å•å¼ æ¨ç†ä¸€è‡´ï¼Œä½†éœ€è¦åœ¨æ•´ä¸ªæ•°æ®é›†ä¸Šé¢è¿è¡Œã€‚ ä½¿ç”¨è¯¥è„šæœ¬åï¼Œä¾¿å¯é€šè¿‡è¯»å–æ•°æ®é›†ï¼Œå¯¹æ¨¡å‹çš„è¾“å‡ºç»“æœè¿›è¡Œè¯„åˆ¤ï¼Œå¹¶è¾“å‡ºè¯„æµ‹ç»“æœã€‚ è¿è¡Œè¯¥è„šæœ¬è€—è´¹æ—¶é—´è¾ƒé•¿ï¼Œä½†å¯ä»¥é€šè¿‡è®¾ç½® <code>PARALLEL_PROCESS_NUM</code> ç¯å¢ƒå˜é‡æ¥è®¾ç½®è¿è¡Œè¯„æµ‹çš„çº¿ç¨‹æ•°é‡ã€‚*</p>
<p><em>åœ¨æ‰§è¡Œç»“æŸåå¾—åˆ°çš„è¾“å‡ºå¦‚ä¸‹æ‰€ç¤ºï¼š</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">===REPORT-START&#123;MAPPER-EVAL&#125;===</span><br><span class="line">0.7011</span><br><span class="line">===REPORT-END&#123;MAPPER-EVAL&#125;===</span><br></pre></td></tr></table></figure></div>

<p><em>å¯ä»¥çœ‹åˆ°è½¬æ¢åçš„å®šç‚¹æ¨¡å‹ç²¾åº¦ä¸º <code>0.7011</code>ã€‚</em></p>
<p><em>æ³¨æ„ï¼š</em></p>
<ul>
<li><em>åœ¨ä¸åŒçš„ç³»ç»Ÿä¸‹ï¼Œç”±äºä¾èµ–åº“ç‰ˆæœ¬ä¸åŒï¼Œè½¬æ¢å¾—åˆ°çš„æ¨¡å‹ç²¾åº¦å¯èƒ½ä¼šç•¥æœ‰å·®åˆ«ã€‚</em></li>
<li><em>åŒæ—¶ç”±äºç‰ˆæœ¬æ›´è¿­ï¼Œå¾—åˆ°çš„å®šç‚¹æ¨¡å‹ç²¾åº¦å¯èƒ½ä¹Ÿä¼šç•¥æœ‰å·®åˆ«ã€‚</em></li>
<li><em>å¦‚æœç”¨æˆ·åœ¨ä½¿ç”¨æ¨¡å‹è½¬æ¢å·¥å…·åå¾—åˆ°çš„å®šç‚¹æ¨¡å‹æœ‰ç²¾åº¦æŸå¤±çš„è¯ï¼Œ è¯·ä¸åœ°å¹³çº¿æŠ€æœ¯å›¢é˜Ÿè”ç³»å¹¶è·å–æ–‡æ¡£ã€Šæµ®ç‚¹è½¬å®šç‚¹ç²¾åº¦æŸå¤±å®šä½Checklistã€‹æ¥è¿›è¡Œé—®é¢˜æŸ¥ç©¶ã€‚</em></li>
</ul>
<p><em><strong>æ¨¡å‹æ€§èƒ½éªŒè¯</strong></em></p>
<p><em>æ¨¡å‹åœ¨å¼€å‘æ¿ä¸Šçš„è¿è¡Œå¸§ç‡ä¹Ÿæ˜¯ä¸€ä¸ªå¾ˆé‡è¦çš„æ€§èƒ½æŒ‡æ ‡ï¼Œä¸ºå…å»å¼€å‘è€…æ¶è®¾å¼€å‘æ¿ç¯å¢ƒçš„éº»çƒ¦ï¼Œ æˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨ <code>hb_perf</code> å­å‘½ä»¤å¯¹è½¬æ¢å‡ºæ¥çš„æ¨¡å‹è¿›è¡Œæ€§èƒ½åˆ†æã€‚</em></p>
<p><em>åœ¨MobileNetv1ç¤ºä¾‹ä¸­ï¼Œè¿è¡Œå‘½ä»¤ <code>hb_perf mobilenetv1_224x224_nv12.bin</code> åï¼Œ å³å¯åœ¨ hb_perf_result&#x2F;mobilenetv1_224x224_nv12&#x2F; ç›®å½•ä¸‹æ‰¾åˆ°æ¨¡å‹åˆ†ææ–‡ä»¶ mobilenetv1_224x224_nv12.html ã€‚</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[horizon@gpu-dev model_output]$ hb_perf mobilenetv1_224x224_nv12.bin</span><br><span class="line">2022-05-19 14:42:42,303 INFO Start hb_perf....</span><br><span class="line">2022-05-19 14:42:42,304 INFO hb_perf version 1.7.7</span><br><span class="line">2022-05-19 14:42:42,348 INFO ********* mobilenetv1_224x224_nv12 perf **********</span><br><span class="line">2022-05-19 14:42:42,457 INFO draw graph png finished.</span><br><span class="line">2022-05-19 14:42:42,476 INFO get bpu model succeeded.</span><br><span class="line">2022-05-19 14:42:42,787 INFO get perf info succeeded.</span><br><span class="line">2022-05-19 14:42:42,787 WARNING bpu model don&#x27;t have per-layer perf info.</span><br><span class="line">2022-05-19 14:42:42,787 WARNING if you need per-layer perf info please enable[compiler_parameters.debug:True] when use makertbin.</span><br><span class="line">2022-05-19 14:42:42,794 INFO generating html...</span><br><span class="line">2022-05-19 14:42:42,795 INFO html generation finished.</span><br><span class="line">2022-05-19 14:42:42,795 INFO file stored at : /home/users/horizon/codeWKS/tc_sys/j5_toolchain/samples/03_classification/01_mobilenet/mapper/model_output/hb_perf_result/mobilenetv1_224x224_nv12/mobilenetv1_224x224_nv12.html</span><br></pre></td></tr></table></figure></div>

<p><em>ä» mobilenetv1_224x224_nv12.html æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ¨¡å‹æ•´ä½“çš„å„é¡¹æ€§èƒ½æ•°æ®ã€‚ å½“æ¨¡å‹åˆ†ä¸ºå¤šæ®µæ—¶ï¼Œè¿˜ä¼šå¯¹æ¯ä¸€æ®µåœ¨BPUä¸Šè¿è¡Œçš„éƒ¨åˆ†å•ç‹¬æœ‰æ€§èƒ½åˆ†ææŠ¥å‘Šã€‚</em></p>
<p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230510110605591.png"
                      class="" title="image-20230510110605591"
                ></em></p>
<p><em>ä¸Šå›¾ä¸­å„é¡¹æ€§èƒ½åˆ†åˆ«ä¸º:</em></p>
<ul>
<li><em><code>Model Name</code>ï¼š æ¨¡å‹åç§°ã€‚</em></li>
<li><em><code>BPU Model Latency(ms)</code>ï¼šæ¨¡å‹æ•´ä½“è€—æ—¶(å•ä½ä¸ºms)ã€‚</em></li>
<li><em><code>Total DDR (loaded+stored) bytes per frame(MB per frame)</code>ï¼šæ¨¡å‹æ•´ä½“BPUéƒ¨åˆ†æ•°æ®åŠ è½½å’Œå­˜å‚¨æ‰€å ç”¨çš„DDRæ€»é‡ï¼ˆå•ä½ä¸ºMB&#x2F;frameï¼‰ã€‚</em></li>
<li><em><code>Loaded Bytes per Frame</code>ï¼šæ¨¡å‹è¿è¡Œæ¯å¸§è¯»å–æ•°æ®é‡ã€‚</em></li>
<li><em><code>Stored Bytes per Frame</code>ï¼šæ¨¡å‹è¿è¡Œæ¯å¸§å­˜å‚¨æ•°æ®é‡ã€‚</em></li>
</ul>
<p><em><strong>æ³¨æ„ï¼šä¸Šè¿° <code>BPU Model Latency(ms)</code> æ˜¯æŒ‡æ¨¡å‹ä¸­åœ¨BPUä¸Šæ‰§è¡Œéƒ¨åˆ†çš„è€—æ—¶ï¼Œå¦‚æœæ¨¡å‹ä¸­æœ‰CPUä¸Šæ‰§è¡Œçš„éƒ¨åˆ†ï¼Œåˆ™è¯¥éƒ¨åˆ†è€—æ—¶æœªè¢«è®¡ç®—åœ¨å†…ã€‚</strong></em></p>
<p><em><strong>æ ¡å‡†æ–¹æ³•</strong></em></p>
<p><em>ç›®å‰æˆ‘ä»¬æ”¯æŒäº†ä»¥ä¸‹çš„æ ¡å‡†æ–¹æ³•ï¼š</em></p>
<p><em>1.default</em></p>
<p><em><code>default</code> æ˜¯ä¸€ä¸ªè‡ªåŠ¨æœç´¢çš„ç­–ç•¥ï¼Œä¼šå°è¯•ä»ç³»åˆ—æ ¡å‡†é‡åŒ–å‚æ•°ä¸­è·å¾—ä¸€ä¸ªç›¸å¯¹æ•ˆæœè¾ƒå¥½çš„ç»„åˆã€‚</em></p>
<p><em>2.mix</em></p>
<p><em><code>mix</code> æ˜¯ä¸€ä¸ªé›†æˆå¤šç§æ ¡å‡†æ–¹æ³•çš„æœç´¢ç­–ç•¥ï¼Œèƒ½å¤Ÿè‡ªåŠ¨ç¡®å®šé‡åŒ–æ•æ„ŸèŠ‚ç‚¹ï¼Œå¹¶åœ¨èŠ‚ç‚¹ç²’åº¦ä¸Šä»ä¸åŒçš„æ ¡å‡†æ–¹æ³•ä¸­æŒ‘é€‰å‡ºæœ€ä½³æ–¹æ³•ï¼Œ æœ€ç»ˆæ„å»ºä¸€ä¸ªèåˆäº†å¤šç§æ ¡å‡†æ–¹æ³•ä¼˜åŠ¿çš„ç»„åˆæ ¡å‡†æ–¹å¼ã€‚</em></p>
<p><em>3.KL</em></p>
<p><em>KLæ ¡å‡†æ–¹æ³•æ˜¯å€Ÿé‰´äº† <a class="link"   target="_blank" rel="noopener" href="http://on-demand.gputechconf.com/gtc/2017/presentation/s7310-8-bit-inference-with-tensorrt.pdf" >TensorRTæå‡ºçš„è§£å†³æ–¹æ¡ˆ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ï¼Œ ä½¿ç”¨KLç†µå€¼æ¥éå†æ¯ä¸ªé‡åŒ–å±‚çš„æ•°æ®åˆ†å¸ƒï¼Œé€šè¿‡å¯»æ‰¾æœ€ä½çš„KLç†µå€¼ï¼Œæ¥ç¡®å®šé˜ˆå€¼ã€‚ è¿™ç§æ–¹æ³•ä¼šå¯¼è‡´è¾ƒå¤šçš„æ•°æ®é¥±å’Œå’Œæ›´å°çš„æ•°æ®é‡åŒ–ç²’åº¦ï¼Œ<strong>åœ¨ä¸€äº›æ•°æ®åˆ†å¸ƒæ¯”è¾ƒé›†ä¸­çš„æ¨¡å‹ä¸­æ‹¥æœ‰ç€æ¯”maxæ ¡å‡†æ–¹æ³•æ›´å¥½çš„æ•ˆæœã€‚</strong></em></p>
<p><em>4.max</em></p>
<p><em>maxæ ¡å‡†æ–¹æ³•æ˜¯åœ¨æ ¡å‡†è¿‡ç¨‹ä¸­ï¼Œè‡ªåŠ¨é€‰æ‹©é‡åŒ–å±‚ä¸­çš„æœ€å¤§å€¼ä½œä¸ºé˜ˆå€¼ã€‚ è¿™ç§æ–¹æ³•ä¼šå¯¼è‡´æ•°æ®é‡åŒ–ç²’åº¦è¾ƒå¤§ï¼Œä½†ä¹Ÿä¼šå¸¦æ¥æ¯”KLæ–¹æ³•æ›´å°‘çš„é¥±å’Œç‚¹æ•°é‡ï¼Œ<strong>é€‚ç”¨äºé‚£äº›æ•°æ®åˆ†å¸ƒæ¯”è¾ƒç¦»æ•£çš„ç¥ç»ç½‘ç»œæ¨¡å‹ã€‚</strong></em></p>
<p><em>5.load</em></p>
<p><em>ä½¿ç”¨ <code>QAT</code> å¯¼å‡ºçš„æ¨¡å‹æ—¶ï¼Œéœ€ä½¿ç”¨æ­¤å‚æ•°ã€‚</em></p>
<p><em>6.skip</em></p>
<p><em>è‹¥æ‚¨åªæƒ³å°è¯•å¯¹æ¨¡å‹æ€§èƒ½è¿›è¡ŒéªŒè¯ï¼Œä½†å¯¹ç²¾åº¦æ²¡æœ‰è¦æ±‚ï¼Œåˆ™å¯ä»¥å°è¯• <code>skip</code> æ–¹å¼è¿›è¡Œæ ¡å‡†ã€‚ è¯¥æ–¹å¼ä¼šä½¿ç”¨éšæœºæ•°è¿›è¡Œæ ¡å‡†ï¼Œä¸éœ€è¦æ‚¨å‡†å¤‡æ ¡å‡†æ•°æ®ï¼Œæ¯”è¾ƒé€‚åˆåˆæ¬¡å°è¯•å¯¹æ¨¡å‹ç»“æ„è¿›è¡ŒéªŒè¯ã€‚</em></p>
<p><em><strong>æ³¨æ„ï¼šéœ€è¦æ‚¨æ³¨æ„çš„æ˜¯ï¼Œä½¿ç”¨skipæ–¹å¼æ—¶ï¼Œå› è¯¥æ–¹å¼ä½¿ç”¨éšæœºæ•°æ ¡å‡†ï¼Œæ•…å¾—åˆ°çš„æ¨¡å‹ä¸å¯ç”¨äºç²¾åº¦éªŒè¯ã€‚</strong></em></p>
<blockquote>
<p><em>hb _mapperå·¥å…·</em></p>
</blockquote>
<p><em><code>hb_mapper</code> å·¥å…·æ˜¯ä¸€ä¸ªå°†æµ®ç‚¹æ¨¡å‹æ˜ å°„ä¸ºé‡åŒ–æ¨¡å‹ï¼Œå¹¶é™„å¸¦éªŒè¯åŠŸèƒ½çš„å·¥å…·ã€‚ <code>hb_mapper</code> åŒ…æ‹¬ä¸‰ä¸ªå­å‘½ä»¤ <code>checker</code>ã€ <code>makertbin</code> å’Œ <code>infer</code>ã€‚ å®ƒä»¬åˆ†åˆ«æä¾›äº†çš„æ¨¡å‹æ£€æŸ¥ã€æ¨¡å‹è½¬æ¢ï¼Œä»¥åŠå„é˜¶æ®µå·ç§¯å±‚å‘é‡è¾“å‡ºçš„åŠŸèƒ½ã€‚ æ¥ä¸‹æ¥çš„å†…å®¹é€ä¸€ä»‹ç»ä¸Šè¿°å­å‘½ä»¤ã€‚</em></p>
<p><em><strong>æ¨¡å‹æ£€æŸ¥å‘½ä»¤ï¼ˆhb_mapper checkerï¼‰</strong></em></p>
<p><em>åœ¨å®é™…å·¥ç¨‹ä¸­ï¼Œç”±äºå¹¶éæ‰€æœ‰æµ®ç‚¹æ¨¡å‹å‡èƒ½å¤Ÿè½¬ä¸ºé‡åŒ–æ¨¡å‹ï¼Œå› æ­¤åœ¨è½¬æ¢ä¹‹å‰éœ€è¦è¿›è¡Œä¸€æ¬¡æ£€æŸ¥ï¼Œ è¿™ä¸ªcheckè¿‡ç¨‹ï¼Œä¼šèµ°ä¸€éæ¨¡å‹è½¬æ¢çš„è¿‡ç¨‹ï¼Œä½†æ˜¯å¯¹äºæ¯”è¾ƒè€—æ—¶çš„æ­¥éª¤ï¼Œè¿›è¡Œäº†ç®€åŒ–å¤„ç†ã€‚ è¯¥å‘½ä»¤åœ¨å®Œæˆæ¨¡å‹çš„æ£€æŸ¥åï¼Œä¼šè¾“å‡ºæ£€æŸ¥ç»“æœå’ŒOPåœ¨è®¾å¤‡ä¸Šçš„éƒ¨ç½²æƒ…å†µã€‚</em></p>
<ul>
<li><p><em>hb_mapper checkerçš„ä½¿ç”¨æ–¹æ³•ï¼š</em></p>
<p><em><code>hb_mapper checker --model-type $&#123;model_type&#125; \                  --march $&#123;march&#125; \                  --proto $&#123;proto&#125; \                  --model $&#123;caffe_model/onnx_model&#125; \                  --input-shape $&#123;input_node&#125; $&#123;input_shape&#125; \                  --output $&#123;output&#125; </code></em></p>
</li>
<li><p><em>hb_mapper checkerçš„å‘½ä»¤è¡Œå‚æ•°ï¼š</em></p>
<p><em>â€“model-typeè½¬æ¢çš„æ¨¡å‹ç±»å‹ï¼Œç›®å‰æ”¯æŒ <code>caffe</code> æˆ–è€… <code>onnx</code>ã€‚</em></p>
<p><em>â€“marchBPUçš„å¾®æ¶æ„ã€‚è‹¥ä½¿ç”¨x&#x2F;j3ç³»åˆ—èŠ¯ç‰‡åˆ™è®¾ç½®ä¸º <code>bernoulli2</code>ï¼Œè‹¥ä½¿ç”¨j5èŠ¯ç‰‡åˆ™è®¾ç½®ä¸º <code>bayes</code>ã€‚</em></p>
<p><em>â€“proto    Caffeæ¨¡å‹çš„prototxtæ–‡ä»¶ã€‚</em></p>
<p><em>â€“model     Caffeæˆ–ONNXæµ®ç‚¹æ¨¡å‹æ–‡ä»¶ã€‚</em></p>
<p><em>â€“input-shapeå¯é€‰å‚æ•°ï¼Œè¾“å…¥æ¨¡å‹çš„è¾“å…¥èŠ‚ç‚¹ä»¥åŠè¯¥èŠ‚ç‚¹çš„è¾“å…¥çš„shapeï¼Œå…¶shapeä»¥ <code>x</code> åˆ†éš”ï¼Œe.g. <code>data 1x3x224x224</code>ã€‚</em></p>
<p><em>â€“outputè¯¥å‚æ•°å·²ç»åºŸå¼ƒï¼Œlogä¿¡æ¯å­˜å‚¨äº <code>hb_mapper_checker_&#123;date_time&#125;.log</code> ä¸­ã€‚</em></p>
<p><em>â€“helpæ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯å¹¶é€€å‡ºã€‚</em></p>
</li>
</ul>
<p><em><strong>æ¨¡å‹ç¼–è¯‘å‘½ä»¤ï¼ˆhb_mapper makertbinï¼‰</strong></em></p>
<p><em>è¯¥å‘½ä»¤æ ¹æ®é…ç½®æ–‡ä»¶å’Œæ¨¡å‹çš„ç§ç±»ï¼Œä¼šç”ŸæˆONNXé‡åŒ–æ¨¡å‹ä»¥åŠä»¿çœŸä¸Šæ¿æƒ…å†µçš„runtimeæ¨¡å‹ã€‚ é…ç½®æ–‡ä»¶çš„å…·ä½“è®¾ç½®å°†ä¼šåœ¨ <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/ptq/ptq_tool/hb_mapper.html#hb-mapper-config" >é…ç½®æ–‡ä»¶è¯¦ç»†ä»‹ç» <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> éƒ¨åˆ†å…·ä½“è®²è§£ã€‚</em></p>
<ul>
<li><p><em>hb_mapper makertbinçš„ä½¿ç”¨æ–¹å¼ï¼š</em></p>
<p><em><code>hb_mapper makertbin --config $&#123;config_file&#125;  \                 </code></em></p>
<p> <em><code>  --model-type  $&#123;model_type&#125;</code></em></p>
</li>
<li><p><em>hb_mapper makertbinçš„å‘½ä»¤è¡Œå‚æ•°ï¼š</em></p>
<p><em>-c, â€“configæ¨¡å‹ç¼–è¯‘çš„é…ç½®æ–‡ä»¶ï¼Œä¸ºyamlæ ¼å¼ã€‚-</em></p>
<p><em>-model-type<code>caffe</code> æˆ–è€… <code>onnx</code>ã€‚</em></p>
<p><em>â€“helpæ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯å¹¶é€€å‡ºã€‚</em></p>
</li>
</ul>
<p><em>ç¼–è¯‘äº§ç”Ÿçš„logæ–‡ä»¶ä¼šå‚¨å­˜åœ¨å‘½ä»¤æ‰§è¡Œè·¯å¾„ä¸‹é¢ï¼Œåç§°ä¸º <code>hb_mapper_makertbin_&#123;date_time&#125;.log</code>ã€‚</em></p>
<p><em><strong>æ¨¡å‹æ¨ç†å‘½ä»¤ï¼ˆhb_mapper inferï¼‰</strong></em></p>
<p><em><strong>æ³¨æ„ï¼š</strong></em></p>
<ul>
<li><em><strong>hb_mapper infer å— onnxruntime é™åˆ¶ï¼Œä¸æ”¯æŒåŠ¨æ€çš„shape inferï¼Œå› æ­¤è¦æ±‚è¾“å…¥çš„æ¨¡å‹shapeä¿¡æ¯æ˜ç¡®ã€‚</strong></em></li>
<li><em>è¯¥å·¥å…·ä¸æ”¯æŒ infer å«æœ‰ shapeä¿¡æ¯ä¸º ? çš„æ¨¡å‹ã€‚</em></li>
</ul>
<p><em>è¯¥å‘½ä»¤åˆ©ç”¨æµ®ç‚¹å’Œé‡åŒ–æ¨¡å‹è¿›è¡Œæ¨ç†ï¼Œå¹¶ä¿å­˜æ¨ç†ç»“æœåˆ° <code>--output-dir</code> æŒ‡å®šçš„ç›®å½•é‡Œé¢ã€‚</em></p>
<p><em>ä¸ºäº†éªŒè¯åˆ†ææ¨¡å‹ç¼–è¯‘æ˜¯å¦æ­£ç¡®ï¼Œå¯å°†é…ç½®æ–‡ä»¶ä¸­ <code>layer_out_dump</code> è®¾ç½®ä¸º <code>True</code>ï¼Œå®ƒå°†ä¼šè¾“å‡ºconvå’Œè¾“å‡ºèŠ‚ç‚¹çš„æ¨ç†ç»“æœï¼Œ ä¹‹åå¯ä»¥å€ŸåŠ©å‘é‡æ¯”è¾ƒå·¥å…·æ¥åˆ†ææ¨¡å‹ç¼–è¯‘çš„æ­£ç¡®ä¸å¦ã€‚</em></p>
<p><em>hb_mapper inferçš„ä½¿ç”¨æ–¹å¼ï¼š</em></p>
<p><em><code>hb_mapper infer --config $&#123;config_file&#125; \              </code></em></p>
<p> <em><code> --model-file $&#123;quantized_model_file&#125;  \     </code></em>  </p>
<p> <em><code>         --model-type $&#123;caffe/onnx&#125; \           </code></em>          </p>
<p> <em><code>   --image-file $&#123;input_node&#125; $&#123;image_file&#125; \     </code></em>    </p>
<p> <em><code>         --input-layout $&#123;input_layout&#125; \       </code></em>          </p>
<p> <em><code>--output-dir $&#123;quantized_output_dir&#125;</code></em></p>
<p><em>åœ¨ä½¿ç”¨ <code>hb_mapper infer</code> å‘½ä»¤æ—¶ï¼Œè¯·è¾“å…¥ä¸ <code>hb_mapper makertbin</code> å‘½ä»¤ç›¸åŒçš„é…ç½®æ–‡ä»¶ï¼Œä»¥ä¿è¯è¾“å…¥æ•°æ®å¤„ç†çš„éƒ¨åˆ†çš„è®¾ç½®æ˜¯ç›¸åŒçš„ã€‚ ç®€å•åœ°è¯´ï¼Œæ‚¨åœ¨ <code>hb_mapper makertbin</code> æ—¶ä½¿ç”¨çš„æ ¡å‡†æ•°æ®æ˜¯ä»€ä¹ˆæ ·çš„å›¾ç‰‡æˆ–æ•°æ®ï¼Œé‚£ä¹ˆåœ¨ <code>hb_mapper infer</code> æ—¶ä¹Ÿéœ€è¦ä½¿ç”¨ç›¸åŒæ ¼å¼çš„å›¾ç‰‡æˆ–æ•°æ®ã€‚</em></p>
<p><em><strong>æ³¨æ„ï¼š</strong></em></p>
<p><em>æ‚¨ä½¿ç”¨ <code>hb_mapper infer</code> å‘½ä»¤æ—¶è¾“å…¥æ•°æ®çš„é€‰æ‹©ä¸é…ç½®æ–‡ä»¶ä¸­ä»¥ä¸‹è¾“å…¥æ•°æ®é…ç½®éƒ¨åˆ†æœ‰å…³ï¼š</em></p>
<ul>
<li><em><code>preprocess_on: True</code>ï¼Œåˆ™å·¥å…·å¯ä»¥æ¥æ”¶JPEGå›¾ç‰‡ï¼Œè‡ªåŠ¨è¿›è¡Œresizeç­‰é¢„å¤„ç†ï¼Œå¹¶è½¬åŒ–æˆ <code>input_type_rt</code> çš„æ ¼å¼ã€‚</em></li>
<li><em><code>preprocess_on: False</code>ï¼Œåˆ™åªèƒ½æ¥æ”¶å·²ç»å¤„ç†å¥½ï¼Œå‚¨å­˜ä¸ºäºŒè¿›åˆ¶æ ¼å¼çš„å›¾ç‰‡æ–‡ä»¶ï¼Œå› æ­¤é¢„å¤„ç†éœ€è¦ç”¨æˆ·è‡ªå·±å®Œæˆï¼Œ å¹¶æŠŠå›¾ç‰‡è½¬åŒ–æˆç›¸åº”çš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚(è¯·å‚è€ƒè„šæœ¬02_preprocess.sh)ã€‚</em></li>
</ul>
<p><em>hb_mapper inferçš„å‘½ä»¤è¡Œå‚æ•°ï¼š</em></p>
<p><em>-c, â€“configæ¨¡å‹ç¼–è¯‘æ—¶çš„é…ç½®æ–‡ä»¶ã€‚</em></p>
<p><em>â€“model-fileè¿›è¡Œæ¨ç†çš„æ¨¡å‹æ–‡ä»¶ï¼Œå¯ä»¥æ˜¯æµ®ç‚¹å’Œé‡åŒ–ONNXæ¨¡å‹ã€‚</em></p>
<p><em>â€“model-typeæŒ‡å®šæ¨ç†çš„åŸå§‹æµ®ç‚¹æ¨¡å‹ç±»å‹ï¼Œå¯æŒ‡å®šä¸º <code>caffe</code> æˆ– <code>onnx</code>ã€‚</em></p>
<p><em>â€“image-fileè¾“å…¥èŠ‚ç‚¹åç§°å’Œå…¶å¯¹åº”çš„ç”¨äºæ¨ç†çš„å›¾åƒæ–‡ä»¶ã€‚â€“input-layoutæ¨¡å‹è¾“å…¥çš„layoutï¼ˆæ­¤ä¸ºå¯é€‰å‚æ•°ï¼‰ã€‚</em></p>
<p><em>â€“output-diræ¨ç†ç»“æœçš„ä¿å­˜è·¯å¾„ï¼Œå¦‚æœæ˜¯é‡åŒ–æ¨¡å‹ï¼Œæ¨ç†ç»“æœä¸ºåé‡åŒ–çš„æµ®ç‚¹æ•°æ®ã€‚</em></p>
<p><em>â€“helpæ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯å¹¶é€€å‡ºã€‚</em></p>
<p><em>è¾“å‡ºå†…å®¹åœ¨ output_dir ç›®å½•é‡Œï¼Œè¾“å‡ºæ–‡ä»¶å‘½åè§„åˆ™ï¼š <code>$&#123;layername&#125;_float.bin</code>ã€‚</em></p>
<p><em><strong>å…³é”®é…ç½®å‚æ•° calibration_parameters.preprocess_on ä»‹ç»</strong></em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">calibration_parameters:</span><br><span class="line">    # æ¨¡å‹é‡åŒ–çš„å‚è€ƒå›¾åƒçš„å­˜æ”¾ç›®å½•ï¼Œå›¾ç‰‡æ ¼å¼æ”¯æŒJPEGã€BMPç­‰æ ¼å¼ï¼Œè¾“å…¥çš„å›¾ç‰‡</span><br><span class="line">    # åº”è¯¥æ˜¯ä½¿ç”¨çš„å…¸å‹åœºæ™¯ï¼Œä¸€èˆ¬æ˜¯ä»æµ‹è¯•é›†ä¸­é€‰æ‹©20~100å¼ å›¾ç‰‡ï¼Œå¦å¤–è¾“å…¥</span><br><span class="line">    # çš„å›¾ç‰‡è¦è¦†ç›–å…¸å‹åœºæ™¯ï¼Œä¸è¦æ˜¯ååƒ»åœºæ™¯ï¼Œå¦‚è¿‡æ›å…‰ã€é¥±å’Œã€æ¨¡ç³Šã€</span><br><span class="line">    # çº¯é»‘ã€çº¯ç™½ç­‰å›¾ç‰‡</span><br><span class="line">    # è‹¥æœ‰å¤šä¸ªè¾“å…¥ï¼Œåˆ™åº”ä½¿ç”¨&#x27;;&#x27;è¿›è¡Œåˆ†éš”</span><br><span class="line">    cal_data_dir: &#x27;./calibration_data_bgr_f32&#x27;</span><br><span class="line">    # å½“è¾“å…¥çš„å›¾ç‰‡æ–‡ä»¶å°ºå¯¸å’Œæ¨¡å‹è®­ç»ƒçš„å°ºå¯¸ä¸ä¸€è‡´ï¼Œå¹¶ä¸”preprocess_onä¸ºTrueæ—¶ï¼Œåˆ™å°†é‡‡ç”¨é»˜è®¤é¢„å¤„ç†æ–¹æ³•(skimage resize)ï¼Œ</span><br><span class="line">    # å°†è¾“å…¥å›¾ç‰‡ç¼©æ”¾æˆ–è€…è£å‡åˆ°æŒ‡å®šå°ºå¯¸ï¼Œå¦åˆ™ï¼Œéœ€è¦ç”¨æˆ·æå‰æŠŠå›¾ç‰‡å¤„ç†ä¸ºè®­ç»ƒæ—¶çš„å°ºå¯¸</span><br><span class="line">    # preprocess_on: False</span><br></pre></td></tr></table></figure></div>

<p><em><strong>å¦‚æœç”¨æˆ·æŒ‡å®šé…ç½®å‚æ•°</strong> <code>preprocess_on=True</code>ï¼š</em></p>
<p><em>å·¥å…·å¯é€šè¿‡è¯¥è®¾ç½® <code>preprocess_on</code> ä¸º <code>True</code> æ¥è‡ªåŠ¨å®Œæˆçš„æ ¡å‡†å›¾ç‰‡çš„å‰å¤„ç†ã€‚ è¯¥æ¨¡å¼ä¸‹ç”¨æˆ·éœ€åœ¨ <code>cal_data_dir</code> ä¸­æŒ‡å®šæ ¡å‡†JPEGå›¾ç‰‡çš„å­˜æ”¾è·¯å¾„ã€‚ åˆ™åœ¨æ¨¡å‹æ ¡å‡†æ—¶ï¼Œå·¥å…·å†…éƒ¨ä¼šé€šè¿‡skimageæ–¹å¼è¯»å…¥çš„JPEGå›¾ç‰‡ï¼Œé€šè¿‡skimage resizeçš„æ–¹å¼ç¼©æ”¾å›¾ç‰‡åˆ°é…ç½®æ–‡ä»¶æŒ‡å®šçš„ <code>input_shape</code>ï¼Œ å¹¶æŠŠå›¾åƒæ ¼å¼è°ƒæ•´ä¸º <code>input_type_rt</code> æŒ‡å®šçš„æ ¼å¼ã€‚</em></p>
<p><em>ä¸¾ä¸€ä¸ªä¾‹å­ï¼Œå‡å¦‚è¾“å…¥çš„JPEGå›¾åƒçš„å°ºå¯¸ä¸º608x608ï¼Œåˆ™é€šè¿‡é»˜è®¤çš„é¢„å¤„ç†åï¼Œå›¾åƒè¢«ç¼©æ”¾ä¸º224x224ï¼Œ å›¾åƒçš„å†…å­˜æ ¼å¼è°ƒæ•´ä¸ºbgr(NCHW)çš„æ ¼å¼ï¼Œåƒç´ å€¼è°ƒæ•´ä¸º0-255èŒƒå›´ã€‚</em></p>
<p><em>é»˜è®¤çš„é¢„å¤„ç†ï¼Œè¯·å‚è€ƒå¦‚ä¸‹ä»£ç ï¼š</em></p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">data_transformer</span>(<span class="params">norm_type, input_dim, input_type_train</span>):</span><br><span class="line">    image_width = input_dim[<span class="number">2</span>]</span><br><span class="line">    image_height = input_dim[<span class="number">1</span>]</span><br><span class="line">    transformers = [</span><br><span class="line">        ResizeTransformer((image_height, image_width)),</span><br><span class="line">        HWC2CHWTransformer(),  <span class="comment"># to CXHXW</span></span><br><span class="line">        RGB2BGRTransformer(),</span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">    transformers.append(ScaleTransformer(<span class="number">255</span>))</span><br></pre></td></tr></table></figure></div>

<p><em><strong>å¦‚æœç”¨æˆ·æŒ‡å®šé…ç½®å‚æ•°</strong> <code>preprocess_on=False</code>ï¼š</em></p>
<p><em>éœ€è¦ç”¨æˆ·è‡ªå·±æ¥å¤„ç†å›¾ç‰‡ï¼Œå°†å›¾ç‰‡å¤„ç†ä¸º <code>input_type_train</code> æŒ‡å®šçš„æ ¼å¼ï¼Œå¹¶ä¸”å°†æ•°æ®ä»¥äºŒè¿›åˆ¶å½¢å¼ä¿å­˜ä¸ºæ–‡ä»¶. å·¥å…·å†…éƒ¨ä¼šè‡ªåŠ¨å¢åŠ ä» <code>input_type_train</code> åˆ° <code>input_type_rt</code> çš„æ ¼å¼è½¬æ¢ã€‚</em></p>
<p><em><strong>æ³¨æ„ï¼šæ–‡ä»¶æ ¼å¼ä¸ºï¼š <a class="link"   target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Row-_and_column-major_order" >Row-major order <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> çš„uint8&#x2F;float32æ•°æ®å­˜å‚¨ã€‚</strong></em></p>
<blockquote>
<p><em>å½“æ•°æ®ä»¥è¡Œä¼˜å…ˆçš„æ–¹å¼å­˜å‚¨æ—¶ï¼Œå¯¹äºä¸€ä¸ªäºŒç»´æ•°ç»„ï¼Œå†…å­˜ä¸­çš„è¿ç»­å­˜å‚¨é¡ºåºæ˜¯å…ˆå­˜å‚¨ç¬¬ä¸€è¡Œçš„æ‰€æœ‰å…ƒç´ ï¼Œæ¥ç€å­˜å‚¨ç¬¬äºŒè¡Œçš„æ‰€æœ‰å…ƒç´ ï¼Œä»¥æ­¤ç±»æ¨ã€‚</em></p>
<p><em>åœ¨æ–‡ä»¶æ ¼å¼ä¸­ï¼Œâ€uint8â€è¡¨ç¤ºæ— ç¬¦å·8ä½æ•´æ•°æ•°æ®ç±»å‹ï¼Œè€Œâ€float32â€è¡¨ç¤º32ä½æµ®ç‚¹æ•°æ•°æ®ç±»å‹ã€‚è¿™æ˜¯å¸¸è§çš„è¡¨ç¤ºå›¾åƒåƒç´ æˆ–æµ®ç‚¹æ•°æ•°æ®çš„æ•°æ®ç±»å‹ã€‚</em></p>
</blockquote>
<p><em><strong>é…ç½®æ–‡ä»¶è¯¦ç»†ä»‹ç»</strong></em></p>
<ul>
<li><em><strong>å‚è€ƒé…ç½®æ–‡ä»¶ä»¥åŠè¯´æ˜</strong></em></li>
</ul>
<p><em>é…ç½®æ–‡ä»¶é‡‡ç”¨yamlæ ¼å¼è¿›è¡Œé…ç½®ï¼Œè¯¦ç»†ä¿¡æ¯è¯·å‚è€ƒå„ä¸ªå‚æ•°çš„æ³¨é‡Šï¼š</em></p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ¨¡å‹è½¬åŒ–ç›¸å…³çš„å‚æ•°</span></span><br><span class="line">model_parameters:</span><br><span class="line">    <span class="comment"># Caffeæµ®ç‚¹ç½‘ç»œæ•°æ®æ¨¡å‹æ–‡ä»¶</span></span><br><span class="line">    caffe_model: <span class="string">&#x27;../../../01_common/model_zoo/mapper/classification/mobilenet/mobilenet.caffemodel&#x27;</span></span><br><span class="line">    <span class="comment"># Caffeç½‘ç»œæè¿°æ–‡ä»¶</span></span><br><span class="line">    prototxt: <span class="string">&#x27;../../../01_common/model_zoo/mapper/classification/mobilenet/mobilenet_deploy.prototxt&#x27;</span></span><br><span class="line">    <span class="comment"># é€‚ç”¨BPUæ¶æ„</span></span><br><span class="line">    march: <span class="string">&quot;bayes&quot;</span></span><br><span class="line">    <span class="comment"># æŒ‡å®šæ¨¡å‹è½¬æ¢è¿‡ç¨‹ä¸­æ˜¯å¦è¾“å‡ºå„å±‚çš„ä¸­é—´ç»“æœï¼Œå¦‚æœä¸ºTrueï¼Œåˆ™è¾“å‡ºæ‰€æœ‰å±‚çš„ä¸­é—´è¾“å‡ºç»“æœï¼Œ</span></span><br><span class="line">    layer_out_dump: <span class="literal">False</span></span><br><span class="line">    <span class="comment"># æ—¥å¿—æ–‡ä»¶çš„è¾“å‡ºæ§åˆ¶å‚æ•°ï¼Œ</span></span><br><span class="line">    <span class="comment"># debugè¾“å‡ºæ¨¡å‹è½¬æ¢çš„è¯¦ç»†ä¿¡æ¯</span></span><br><span class="line">    <span class="comment"># infoåªè¾“å‡ºå…³é”®ä¿¡æ¯</span></span><br><span class="line">    <span class="comment"># warnè¾“å‡ºè­¦å‘Šå’Œé”™è¯¯çº§åˆ«ä»¥ä¸Šçš„ä¿¡æ¯</span></span><br><span class="line">    working_dir: <span class="string">&#x27;model_output&#x27;</span></span><br><span class="line">    <span class="comment"># æ¨¡å‹è½¬æ¢è¾“å‡ºçš„ç”¨äºä¸Šæ¿æ‰§è¡Œçš„æ¨¡å‹æ–‡ä»¶çš„åç§°å‰ç¼€</span></span><br><span class="line">    output_model_file_prefix: <span class="string">&#x27;mobilenetv1_224x224_nv12&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¨¡å‹è¾“å…¥ç›¸å…³å‚æ•°, è‹¥è¾“å…¥å¤šä¸ªèŠ‚ç‚¹, åˆ™åº”ä½¿ç”¨&#x27;;&#x27;è¿›è¡Œåˆ†éš”, ä½¿ç”¨é»˜è®¤ç¼ºçœè®¾ç½®åˆ™å†™None</span></span><br><span class="line">input_parameters:</span><br><span class="line">    <span class="comment"># (å¯ä¸å¡«) æ¨¡å‹è¾“å…¥çš„èŠ‚ç‚¹åç§°, æ­¤åç§°åº”ä¸æ¨¡å‹æ–‡ä»¶ä¸­çš„åç§°ä¸€è‡´, å¦åˆ™ä¼šæŠ¥é”™, ä¸å¡«åˆ™ä¼šä½¿ç”¨æ¨¡å‹æ–‡ä»¶ä¸­çš„èŠ‚ç‚¹åç§°</span></span><br><span class="line">    input_name: <span class="string">&quot;data&quot;</span></span><br><span class="line">    <span class="comment"># ç½‘ç»œå®é™…æ‰§è¡Œæ—¶ï¼Œè¾“å…¥ç»™ç½‘ç»œçš„æ•°æ®æ ¼å¼ï¼ŒåŒ…æ‹¬ nv12/rgb/bgr/yuv444/gray/featuremap,</span></span><br><span class="line">    <span class="comment"># å¦‚æœè¾“å…¥çš„æ•°æ®ä¸ºyuv444, æ¨¡å‹è®­ç»ƒç”¨çš„æ˜¯bgr(NCHW)ï¼Œåˆ™hb_mapperå°†è‡ªåŠ¨æ’å…¥YUVåˆ°BGR(NCHW)è½¬åŒ–æ“ä½œ</span></span><br><span class="line">    input_type_rt: <span class="string">&#x27;nv12&#x27;</span></span><br><span class="line">    <span class="comment"># è½¬æ¢åæ··åˆå¼‚æ„æ¨¡å‹éœ€è¦é€‚é…çš„è¾“å…¥æ•°æ®æ’å¸ƒï¼Œå¯è®¾ç½®ä¸ºï¼šNHWC/NCHW</span></span><br><span class="line">    <span class="comment"># è‹¥input_type_rté…ç½®ä¸ºnv12ï¼Œåˆ™æ­¤å¤„å‚æ•°ä¸éœ€è¦é…ç½®</span></span><br><span class="line">    <span class="comment">#input_layout_rt: &#x27;&#x27;</span></span><br><span class="line">    <span class="comment"># ç½‘ç»œè®­ç»ƒæ—¶è¾“å…¥çš„æ•°æ®æ ¼å¼ï¼Œå¯é€‰çš„å€¼ä¸ºrgb/bgr/gray/featuremap/yuv444</span></span><br><span class="line">    input_type_train: <span class="string">&#x27;bgr&#x27;</span></span><br><span class="line">    <span class="comment"># ç½‘ç»œè®­ç»ƒæ—¶è¾“å…¥çš„æ•°æ®æ’å¸ƒ, å¯é€‰å€¼ä¸º NHWC/NCHW</span></span><br><span class="line">    input_layout_train: <span class="string">&#x27;NCHW&#x27;</span></span><br><span class="line">    <span class="comment"># æ¨¡å‹ç½‘ç»œçš„è¾“å…¥å¤§å°, ä»¥&#x27;x&#x27;åˆ†éš”, ä¸å¡«åˆ™ä¼šä½¿ç”¨æ¨¡å‹æ–‡ä»¶ä¸­çš„ç½‘ç»œè¾“å…¥å¤§å°ï¼Œå¦åˆ™ä¼šè¦†ç›–æ¨¡å‹æ–‡ä»¶ä¸­è¾“å…¥å¤§å°</span></span><br><span class="line">    <span class="comment"># input_shape: &#x27;&#x27;</span></span><br><span class="line">    <span class="comment"># ç½‘ç»œè¾“å…¥çš„é¢„å¤„ç†æ–¹æ³•ï¼Œä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§ï¼š</span></span><br><span class="line">    <span class="comment"># no_preprocess ä¸åšä»»ä½•æ“ä½œ</span></span><br><span class="line">    <span class="comment"># data_mean å‡å»é€šé“å‡å€¼mean_value</span></span><br><span class="line">    <span class="comment"># data_scale å¯¹å›¾åƒåƒç´ ä¹˜ä»¥data_scaleç³»æ•°</span></span><br><span class="line">    <span class="comment"># data_mean_and_scale å‡å»é€šé“å‡å€¼åå†ä¹˜ä»¥scaleç³»æ•°</span></span><br><span class="line">    norm_type: <span class="string">&#x27;data_mean_and_scale&#x27;</span></span><br><span class="line">    <span class="comment"># å›¾åƒå‡å»çš„å‡å€¼, å¦‚æœæ˜¯é€šé“å‡å€¼ï¼Œvalueä¹‹é—´å¿…é¡»ç”¨ç©ºæ ¼åˆ†éš”</span></span><br><span class="line">    mean_value: <span class="number">103.94</span> <span class="number">116.78</span> <span class="number">123.68</span></span><br><span class="line">    <span class="comment"># å›¾åƒé¢„å¤„ç†ç¼©æ”¾æ¯”ä¾‹ï¼Œå¦‚æœæ˜¯é€šé“ç¼©æ”¾æ¯”ä¾‹ï¼Œvalueä¹‹é—´å¿…é¡»ç”¨ç©ºæ ¼åˆ†éš”</span></span><br><span class="line">    scale_value: <span class="number">0.017</span></span><br><span class="line"></span><br><span class="line">calibration_parameters:</span><br><span class="line">    <span class="comment"># æ¨¡å‹é‡åŒ–çš„å‚è€ƒå›¾åƒçš„å­˜æ”¾ç›®å½•ï¼Œå›¾ç‰‡æ ¼å¼æ”¯æŒJPEGã€BMPç­‰æ ¼å¼ï¼Œè¾“å…¥çš„å›¾ç‰‡</span></span><br><span class="line">    <span class="comment"># åº”è¯¥æ˜¯ä½¿ç”¨çš„å…¸å‹åœºæ™¯ï¼Œä¸€èˆ¬æ˜¯ä»æµ‹è¯•é›†ä¸­é€‰æ‹©20~100å¼ å›¾ç‰‡ï¼Œå¦å¤–è¾“å…¥</span></span><br><span class="line">    <span class="comment"># çš„å›¾ç‰‡è¦è¦†ç›–å…¸å‹åœºæ™¯ï¼Œä¸è¦æ˜¯ååƒ»åœºæ™¯ï¼Œå¦‚è¿‡æ›å…‰ã€é¥±å’Œã€æ¨¡ç³Šã€çº¯é»‘ã€çº¯ç™½ç­‰å›¾ç‰‡</span></span><br><span class="line">    <span class="comment"># è‹¥æœ‰å¤šä¸ªè¾“å…¥èŠ‚ç‚¹, åˆ™åº”ä½¿ç”¨&#x27;;&#x27;è¿›è¡Œåˆ†éš”</span></span><br><span class="line">    cal_data_dir: <span class="string">&#x27;./calibration_data_bgr_f32&#x27;</span></span><br><span class="line">    <span class="comment"># æ ¡å‡†æ•°æ®äºŒè¿›åˆ¶æ–‡ä»¶çš„æ•°æ®å­˜å‚¨ç±»å‹ï¼Œå¯é€‰å€¼ä¸ºï¼šfloat32, uint8. è‹¥æœ‰å¤šä¸ªè¾“å…¥èŠ‚ç‚¹, åˆ™åº”ä½¿ç”¨&#x27;;&#x27;è¿›è¡Œåˆ†éš”</span></span><br><span class="line">    cal_data_type: <span class="string">&#x27;float32&#x27;</span></span><br><span class="line">    <span class="comment"># å¦‚æœè¾“å…¥çš„å›¾ç‰‡æ–‡ä»¶å°ºå¯¸å’Œæ¨¡å‹è®­ç»ƒçš„å°ºå¯¸ä¸ä¸€è‡´æ—¶ï¼Œå¹¶ä¸”preprocess_onä¸ºtrueï¼Œ</span></span><br><span class="line">    <span class="comment"># åˆ™å°†é‡‡ç”¨é»˜è®¤é¢„å¤„ç†æ–¹æ³•(skimage resize)ï¼Œ</span></span><br><span class="line">    <span class="comment"># å°†è¾“å…¥å›¾ç‰‡ç¼©æ”¾æˆ–è€…è£å‡åˆ°æŒ‡å®šå°ºå¯¸ï¼Œå¦åˆ™ï¼Œéœ€è¦ç”¨æˆ·æå‰æŠŠå›¾ç‰‡å¤„ç†ä¸ºè®­ç»ƒæ—¶çš„å°ºå¯¸</span></span><br><span class="line">    <span class="comment"># preprocess_on: False</span></span><br><span class="line">    <span class="comment"># æ¨¡å‹é‡åŒ–çš„ç®—æ³•ç±»å‹ï¼Œæ”¯æŒdefaultã€mixã€klã€maxã€loadï¼Œé€šå¸¸é‡‡ç”¨defaultå³å¯æ»¡è¶³è¦æ±‚,</span></span><br><span class="line">    <span class="comment"># default æ˜¯ä¸€ä¸ªè‡ªåŠ¨æœç´¢çš„ç­–ç•¥ï¼Œä¼šå°è¯•ä»ç³»åˆ—æ ¡å‡†é‡åŒ–å‚æ•°ä¸­è·å¾—ä¸€ä¸ªç›¸å¯¹æ•ˆæœè¾ƒå¥½çš„ç»„åˆã€‚</span></span><br><span class="line">    <span class="comment"># å»ºè®®æ‚¨å…ˆå°è¯• defaultï¼Œå¦‚æœæœ€ç»ˆçš„ç²¾åº¦ç»“æœä¸æ»¡è¶³é¢„æœŸå¯è¿›ä¸€æ­¥å°è¯•mix,</span></span><br><span class="line">    <span class="comment"># mixæ˜¯ä¸€ä¸ªé›†æˆå¤šç§æ ¡å‡†æ–¹æ³•çš„æœç´¢ç­–ç•¥ï¼Œèƒ½å¤Ÿè‡ªåŠ¨ç¡®å®šé‡åŒ–æ•æ„ŸèŠ‚ç‚¹ï¼Œå¹¶åœ¨èŠ‚ç‚¹ç²’åº¦ä¸Šä»ä¸åŒçš„æ ¡å‡†æ–¹æ³•ä¸­æŒ‘é€‰å‡ºæœ€ä½³æ–¹æ³•ã€‚</span></span><br><span class="line">    <span class="comment"># å¦‚æœdefaultå’Œmixçš„ç²¾åº¦ç»“æœå‡ä¸æ»¡è¶³é¢„æœŸå†å°è¯•ç”¨klæˆ–maxå¹¶è¯¦ç»†è°ƒæ•´é‡åŒ–å‚æ•°è¿›è¡Œç²¾åº¦è°ƒä¼˜ï¼Œ</span></span><br><span class="line">    <span class="comment"># klå’Œmaxæ˜¯æ¨¡å‹é‡åŒ–çš„ç®—æ³•ç±»å‹ï¼Œé€šå¸¸é‡‡ç”¨KLå³å¯æ»¡è¶³è¦æ±‚ã€‚</span></span><br><span class="line">    <span class="comment"># å½“ä½¿ç”¨QATå¯¼å‡ºæ¨¡å‹æ—¶ï¼Œæ­¤å‚æ•°åˆ™åº”è®¾ç½®ä¸ºloadã€‚</span></span><br><span class="line">    calibration_type: <span class="string">&#x27;default&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¼–è¯‘å™¨ç›¸å…³å‚æ•°</span></span><br><span class="line">compiler_parameters:</span><br><span class="line">    <span class="comment"># ç¼–è¯‘ç­–ç•¥ï¼Œæ”¯æŒbandwidthå’Œlatencyä¸¤ç§ä¼˜åŒ–æ¨¡å¼;</span></span><br><span class="line">    <span class="comment"># bandwidthä»¥ä¼˜åŒ–ddrçš„è®¿é—®å¸¦å®½ä¸ºç›®æ ‡ï¼›</span></span><br><span class="line">    <span class="comment"># latencyä»¥ä¼˜åŒ–æ¨ç†æ—¶é—´ä¸ºç›®æ ‡</span></span><br><span class="line">    compile_mode: <span class="string">&#x27;latency&#x27;</span></span><br><span class="line">    <span class="comment"># è®¾ç½®debugä¸ºTrueå°†æ‰“å¼€ç¼–è¯‘å™¨çš„debugæ¨¡å¼ï¼Œèƒ½å¤Ÿè¾“å‡ºæ€§èƒ½ä»¿çœŸçš„ç›¸å…³ä¿¡æ¯ï¼Œå¦‚å¸§ç‡ã€DDRå¸¦å®½å ç”¨ç­‰</span></span><br><span class="line">    debug: <span class="literal">False</span></span><br><span class="line">    <span class="comment"># ç¼–è¯‘æ¨¡å‹æŒ‡å®šæ ¸æ•°ï¼Œä¸æŒ‡å®šé»˜è®¤ç¼–è¯‘å•æ ¸æ¨¡å‹, è‹¥ç¼–è¯‘åŒæ ¸æ¨¡å‹ï¼Œå°†ä¸‹è¾¹æ³¨é‡Šæ‰“å¼€å³å¯</span></span><br><span class="line">    <span class="comment"># core_num: 2</span></span><br><span class="line">    <span class="comment"># ä¼˜åŒ–ç­‰çº§å¯é€‰èŒƒå›´ä¸ºO0~O3</span></span><br><span class="line">    <span class="comment"># O0ä¸åšä»»ä½•ä¼˜åŒ–, ç¼–è¯‘é€Ÿåº¦æœ€å¿«ï¼Œä¼˜åŒ–ç¨‹åº¦æœ€ä½,</span></span><br><span class="line">    <span class="comment"># O1-O3éšç€ä¼˜åŒ–ç­‰çº§æé«˜ï¼Œé¢„æœŸç¼–è¯‘åçš„æ¨¡å‹çš„æ‰§è¡Œé€Ÿåº¦ä¼šæ›´å¿«ï¼Œä½†æ˜¯æ‰€éœ€ç¼–è¯‘æ—¶é—´ä¹Ÿä¼šå˜é•¿ã€‚</span></span><br><span class="line">    <span class="comment"># æ¨èç”¨O2åšæœ€å¿«éªŒè¯</span></span><br><span class="line">    optimize_level: <span class="string">&#x27;O3&#x27;</span></span><br></pre></td></tr></table></figure></div>



<ul>
<li><em><strong>å…³äº input_type_rt&#x2F; input_type_train</strong></em></li>
</ul>
<p><em>åœ°å¹³çº¿çš„èŠ¯ç‰‡æ¶æ„ï¼Œåœ¨è®¾è®¡æ—¶ä¸ºäº†æå‡æ€§èƒ½ï¼Œåšäº†ä¸¤ç‚¹å‡è®¾ï¼š</em></p>
<ol>
<li><em>å‡è®¾è¾“å…¥çš„æ•°æ®éƒ½æ˜¯int8çš„é‡åŒ–æ•°æ®ã€‚</em></li>
<li><em>æ‘„åƒå¤´è·å–åˆ°çš„æ•°æ®æ˜¯nv12ã€‚</em></li>
</ol>
<p><em>å› æ­¤ï¼Œå¦‚æœç”¨æˆ·åœ¨æ¨¡å‹è®­ç»ƒæ—¶ä½¿ç”¨rgb(NCHW)è¾“å…¥æ ¼å¼ï¼Œä½†æ˜¯æƒ³ä½¿è¿™ä¸ªæ¨¡å‹èƒ½å¤Ÿé«˜æ•ˆå¤„ç†nv12æ•°æ®ï¼Œåªéœ€è¦åœ¨æ¨¡å‹è½¬æ¢æ—¶åšå¦‚ä¸‹é…ç½®ï¼š</em></p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">input_parameters:</span><br><span class="line">    input_type_rt: <span class="string">&#x27;nv12&#x27;</span></span><br><span class="line">    input_type_train: <span class="string">&#x27;rgb&#x27;</span></span><br><span class="line">    input_layout_train: <span class="string">&#x27;NCHW&#x27;</span></span><br></pre></td></tr></table></figure></div>

<p><em><strong>æ³¨æ„ï¼šè‹¥ç”¨æˆ·è®­ç»ƒæ¨¡å‹æ—¶ä½¿ç”¨grayæ ¼å¼ï¼Œè€Œå®é™…ä½¿ç”¨ä¸­è¾“å…¥çš„æ•°æ®æ ¼å¼ä¸ºnv12æ ¼å¼ï¼Œ åˆ™ç”¨æˆ·å¯ä»¥å°†æ¨¡å‹è½¬æ¢æ—¶çš„ <code>input_type_rt</code> åŠ <code>input_type_train</code> å‡é…ç½®ä¸º <code>gray</code>ï¼Œ åœ¨åµŒå…¥å¼åº”ç”¨å¼€å‘æ—¶ä»…ä½¿ç”¨nv12çš„yé€šé“åœ°å€ä½œä¸ºè¾“å…¥å³å¯ã€‚</strong></em></p>
<p><em>é™¤äº†å°†è¾“å…¥æ•°æ®è½¬æ¢ä¸ºnv12ï¼Œæˆ‘ä»¬è¿˜æ”¯æŒç”¨æˆ·åœ¨è®­ç»ƒå’Œruntime inferæ—¶ä½¿ç”¨ä¸åŒçš„rgb-orderã€‚ å…·ä½“çš„ <code>input_type_rt</code> &#x2F; <code>input_type_train</code> çš„æ”¯æŒç±»å‹ï¼Œå¯ä»¥å‚è€ƒ(Yä¸ºå·²æ”¯æŒç±»å‹ï¼ŒNä¸ºæš‚ä¸æ”¯æŒç±»å‹)ï¼š</em></p>
<table>
<thead>
<tr>
<th><em><code>input_type_train</code> \ <code>input_type_rt</code></em></th>
<th><em>nv12</em></th>
<th><em>yuv444</em></th>
<th><em>rgb</em></th>
<th><em>bgr</em></th>
<th><em>gray</em></th>
<th><em>featuremap</em></th>
</tr>
</thead>
<tbody><tr>
<td><em>yuv444</em></td>
<td><em>Y</em></td>
<td><em>Y</em></td>
<td><em>N</em></td>
<td><em>N</em></td>
<td><em>N</em></td>
<td><em>N</em></td>
</tr>
<tr>
<td><em>rgb</em></td>
<td><em>Y</em></td>
<td><em>Y</em></td>
<td><em>Y</em></td>
<td><em>Y</em></td>
<td><em>N</em></td>
<td><em>N</em></td>
</tr>
<tr>
<td><em>bgr</em></td>
<td><em>Y</em></td>
<td><em>Y</em></td>
<td><em>Y</em></td>
<td><em>Y</em></td>
<td><em>N</em></td>
<td><em>N</em></td>
</tr>
<tr>
<td><em>gray</em></td>
<td><em>N</em></td>
<td><em>N</em></td>
<td><em>N</em></td>
<td><em>N</em></td>
<td><em>Y</em></td>
<td><em>N</em></td>
</tr>
<tr>
<td><em>featuremap</em></td>
<td><em>N</em></td>
<td><em>N</em></td>
<td><em>N</em></td>
<td><em>N</em></td>
<td><em>N</em></td>
<td><em>Y</em></td>
</tr>
</tbody></table>
<p><em>æ³¨æ„ï¼šä¸ºäº†é…åˆèŠ¯ç‰‡å¯¹äºè¾“å…¥æ•°æ®ç±»å‹çš„è¦æ±‚ï¼ˆint8ï¼‰ï¼Œå‡å°æ¨ç†å¼€é”€ï¼Œ å¯¹äº <code>input_type_rt</code> ç±»å‹ä¸º rgb(NHWC&#x2F;NCHW)&#x2F;bgr(NHWC&#x2F;NCHW) çš„é…ç½®ï¼Œ è½¬æ¢å·¥å…·è½¬æ¢å‡ºçš„æ¨¡å‹ï¼Œå…¶è¾“å…¥æ•°æ®ç±»å‹å‡ä¸º <code>int8</code>ã€‚ <strong>ä¹Ÿå°±æ˜¯è¯´ï¼Œå¯¹äºå¸¸è§„çš„å›¾åƒæ•°æ®ï¼Œéœ€è¦-128ä½¿ç”¨ï¼ˆè¯¥æ“ä½œåœ¨APIä¸­å·²è‡ªåŠ¨è¿›è¡Œï¼Œç”¨æˆ·æ— éœ€å†è¿›è¡Œè¯¥æ“ä½œï¼‰ã€‚</strong></em></p>
<blockquote>
<p><em>hb_perfå·¥å…·</em></p>
</blockquote>
<p><em><code>hb_perf</code> æ˜¯ç”¨äºåˆ†æåœ°å¹³çº¿é‡åŒ–æ··åˆæ¨¡å‹æ€§èƒ½çš„åˆ†æå·¥å…·ã€‚</em></p>
<p><em><strong>ä½¿ç”¨æ–¹æ³•</strong></em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hb_perf [OPTIONS] BIN_FILE</span><br></pre></td></tr></table></figure></div>

<ul>
<li><em><strong>å‘½ä»¤è¡Œå‚æ•°</strong></em></li>
</ul>
<p><em>â€“version</em><br><em>æ˜¾ç¤ºç‰ˆæœ¬å¹¶é€€å‡ºã€‚</em></p>
<p><em>-m</em><br><em>åæ¥æ¨¡å‹åç§°ã€‚å½“æŒ‡å®šBIN_FILEä¸ºpackæ¨¡å‹æ—¶ï¼Œä»…è¾“å‡ºæŒ‡å®šæ¨¡å‹çš„æ¨¡å‹ç¼–è¯‘ä¿¡æ¯ã€‚</em></p>
<p><em>â€“help</em><br><em>æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯ã€‚</em></p>
<ul>
<li><em>è¾“å‡ºå†…å®¹è¯´æ˜</em></li>
</ul>
<p><em>æ¨¡å‹çš„ä¿¡æ¯ä¼šè¾“å‡ºåœ¨å½“å‰ç›®å½•çš„ <code>hb_perf_result</code> æ–‡ä»¶å¤¹ä¸­ã€‚ å…¶ä¸­ä¼šæœ‰ä»¥è¯¥æ¨¡å‹ä¸ºåçš„æ–‡ä»¶å¤¹ï¼Œè¯¥æ¨¡å‹ä¿¡æ¯å°†ä¼šå±•ç¤ºåœ¨ä»¥å…¶æ¨¡å‹åç§°å‘½åçš„ <code>html</code> æ–‡ä»¶ä¸­ã€‚ç›®å½•ç»“æ„å¦‚ä¸‹ç¤ºä¾‹æ‰€ç¤º:</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">hb_perf_result/</span><br><span class="line">â””â”€â”€ mobilenetv1</span><br><span class="line">    â”œâ”€â”€ mobilenetv1</span><br><span class="line">    â”œâ”€â”€ mobilenetv1.html</span><br><span class="line">    â”œâ”€â”€ mobilenetv1.png</span><br><span class="line">    â”œâ”€â”€ MOBILENET_subgraph_0.html</span><br><span class="line">    â”œâ”€â”€ MOBILENET_subgraph_0.json</span><br><span class="line">    â””â”€â”€ temp.hbm</span><br></pre></td></tr></table></figure></div>

<p><em>è‹¥è¯¥æ¨¡å‹åœ¨ç¼–è¯‘æ—¶æœªè®¾ç½®ä¸ºdebugæ¨¡å¼(<code>compiler_parameters.debug:True</code>) åˆ™ <code>hb_perf</code> å·¥å…·ä¼šäº§ç”Ÿå¦‚ä¸‹æç¤ºï¼Œ è¯¥æç¤ºä»…è¡¨æ˜å­å›¾ä¿¡æ¯ä¸­ä¸åŒ…æ‹¬é€å±‚ä¿¡æ¯ï¼Œå¯¹æ¨¡å‹æ•´ä½“ä¿¡æ¯çš„ç”Ÿæˆæ²¡æœ‰å½±å“ã€‚</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">2021-01-12 10:41:40,000 WARNING bpu model don&#x27;t have per-layer perf info.</span><br><span class="line">2021-01-12 10:41:40,000 WARNING if you need per-layer perf info please enable[compiler_parameters.debug:True] when use makertbin.</span><br></pre></td></tr></table></figure></div>



<blockquote>
<p><em>vec_diffå·¥å…·</em></p>
</blockquote>
<p><em><code>vec_diff</code> å·¥å…·æ—¨åœ¨å¸®åŠ©ç”¨æˆ·å®šä½ç²¾åº¦å¼‚å¸¸é—®é¢˜ã€‚å½“å‡ºç°ç²¾åº¦å¼‚å¸¸æ—¶ï¼Œå¯èƒ½æœ‰å‡ ç§åŸå› ï¼š</em></p>
<ol>
<li><em>æ ¡å‡†æˆ–è€…é‡åŒ–å¯¼è‡´æŸä¸€layerçš„è¾“å‡ºå­˜åœ¨è¯¯å·®ï¼Œç»è¿‡å¯èƒ½çš„è¯¯å·®æ”¾å¤§ï¼Œå¯¼è‡´æœ€ç»ˆç»“æœå·®å¼‚è¾ƒå¤§ã€‚</em></li>
<li><em>æ¨¡å‹è½¬æ¢å·¥å…·çš„æŸä¸€æ­¥å­˜åœ¨æœªçŸ¥é—®é¢˜ï¼Œæµ®ç‚¹æ¨¡å‹åˆ°å®šç‚¹æ¨¡å‹è½¬æ¢è¿‡ç¨‹ä¸­ï¼Œç»è¿‡äº†å‡ æ¬¡ä¼˜åŒ–å’Œå˜æ¢ï¼Œè¿™äº›å˜æ¢å¯èƒ½ä¼šå­˜åœ¨é—®é¢˜ï¼Œå¯¼è‡´å¼‚å¸¸ã€‚</em></li>
<li><em>è½¯ä»¶bugï¼šåœ¨åº”è¯¥ä¿è¯æ•°å€¼ä¸€è‡´çš„åœ°æ–¹ï¼Œå› ä¸ºè½¯ä»¶bugï¼Œå¯¼è‡´è¯¯å·®ã€‚</em></li>
</ol>
<p><em>ä¸ºäº†å®šä½è¿™äº›é—®é¢˜ï¼Œæˆ‘ä»¬å¼€å‘äº†å‘é‡æ¯”è¾ƒå·¥å…·ã€‚ä½¿ç”¨å‘é‡æ¯”è¾ƒå·¥å…·ï¼Œç”¨æˆ·å¯ä»¥æ¯”è¾ƒä¸åŒé˜¶æ®µæ¨¡å‹çš„å·ç§¯å±‚è¾“å‡ºå·®å¼‚ã€‚</em></p>
<p><em><strong>ä½¿ç”¨æ–¹å¼</strong></em></p>
<p><em><code>vec_diff</code> å·¥å…·ï¼Œå¯ä»¥æ¯”è¾ƒä¸åŒé˜¶æ®µæ¨¡å‹çš„è¾“å‡ºfeatureçš„å·®å¼‚ï¼Œæ‰€ä»¥ï¼Œç¬¬ä¸€æ­¥ï¼Œç”¨æˆ·éœ€è¦å¾—åˆ°æ¨¡å‹çš„ <code>infer</code> è¾“å‡ºç»“æœã€‚</em></p>
<p><em>å¯¹äºæ¨¡å‹è½¬æ¢å·¥å…·ï¼ˆ<code>hb_mapper</code>ï¼‰è¾“å‡ºçš„æ¨¡å‹ï¼Œç”¨æˆ·å¯ä»¥ä½¿ç”¨ <code>infer</code> å‘½ä»¤å¾—åˆ°æ¨¡å‹çš„è¾“å‡ºå‘é‡æ–‡ä»¶ã€‚ å…·ä½“ä½¿ç”¨ï¼Œè¯·å‚è€ƒ <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/ptq/ptq_tool/hb_mapper.html#hb-mapper-infer" >æ¨¡å‹æ¨ç†å‘½ä»¤ï¼ˆhb_mapper inferï¼‰ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ã€‚</em></p>
<p><em>å¯¹äº</em>.binæ¨¡å‹ï¼Œç”¨æˆ·å¯ä»¥ä¸Šæ¿è¿è¡Œï¼Œå¾—åˆ°ä¸­é—´å‘é‡è¾“å‡ºã€‚æ­¤è¿‡ç¨‹è¯·å‚è€ƒruntimeå·¥å…· æ–‡æ¡£ï¼š <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/runtime/source/tool_introduction/source/hrt_bin_dump.html" >ã€Šhrt_bin_dumpå·¥å…·ä»‹ç»ã€‹ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ã€‚*</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vec_diff [OPTIONS] left_file/folder right_file/folder</span><br></pre></td></tr></table></figure></div>



<p><em><strong>å‘½ä»¤è¡Œå‚æ•°</strong></em></p>
<p><em>vec_diffçš„å‘½ä»¤è¡Œå‚æ•°ï¼š</em></p>
<p><em>â€“versionæ˜¾ç¤ºç‰ˆæœ¬å¹¶é€€å‡ºã€‚</em></p>
<p><em>left_file&#x2F;folderæ–‡ä»¶åï¼Œæˆ–è€…æ–‡ä»¶å¤¹åã€‚</em></p>
<p><em>right_file&#x2F;folderæ–‡ä»¶åï¼Œæˆ–è€…æ–‡ä»¶å¤¹åã€‚</em></p>
<p><em>-o, â€“output-file FILENAMEè¾“å‡ºç»“æœæ–‡ä»¶çš„æ–‡ä»¶åã€‚</em></p>
<p><em>â€“helpæ‰“å°å¸®åŠ©ä¿¡æ¯ã€‚</em></p>
<p><em><strong>è¾“å‡ºç»“æœè¯´æ˜</strong></em></p>
<p><em>ç”± <code>vec_diff -o</code> æŒ‡å®šçš„CSVæ–‡ä»¶ï¼Œåˆ—è¡¨ï¼ˆè¡¨é¡¹ä¸ºï¼šå·¦ä¾§æ–‡ä»¶åï¼Œå³ä¾§æ–‡ä»¶åï¼Œä½™å¼¦ç›¸ä¼¼åº¦ã€ç›¸å¯¹æ¬§æ‹‰è·ã€æœ€å¤§ç»å¯¹è¯¯å·®ã€æ–¹å·®ï¼‰ï¼Œå‚è€ƒå¦‚ä¸‹ï¼š</em></p>
<table>
<thead>
<tr>
<th align="left"><em>Left Files</em></th>
<th align="left"><em>Right Files</em></th>
<th align="left"><em>Cosine Similarity</em></th>
<th align="left"><em>Relative Euclidean Distance</em></th>
<th align="left"><em>Max Absolute Error</em></th>
<th align="left"><em>Mean Square Error</em></th>
</tr>
</thead>
<tbody><tr>
<td align="left"><em>Layerxxx-quanti-input.txt</em></td>
<td align="left"><em>Layerxxx-float-input.txt</em></td>
<td align="left"><em>xxx</em></td>
<td align="left"><em>xxx</em></td>
<td align="left"><em>xxx</em></td>
<td align="left"><em>xxx</em></td>
</tr>
<tr>
<td align="left"><em>Layerxxx-quanti-param.txt</em></td>
<td align="left"><em>Layerxxx-float-param.txt</em></td>
<td align="left"><em>xxx</em></td>
<td align="left"><em>xxx</em></td>
<td align="left"><em>xxx</em></td>
<td align="left"><em>xxx</em></td>
</tr>
</tbody></table>
<blockquote>
<p><em>hb_model_info å·¥å…·</em></p>
</blockquote>
<p><em><code>hb_model_info</code> æ˜¯ç”¨äºè§£ææ··åˆæ¨¡å‹(</em>.bin)ç¼–è¯‘æ—¶çš„ä¾èµ–åŠå‚æ•°ä¿¡æ¯çš„å·¥å…·ã€‚*</p>
<p><em><strong>ä½¿ç”¨æ–¹æ³•</strong></em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hb_model_info $&#123;model_file&#125;</span><br></pre></td></tr></table></figure></div>



<p><em><strong>å‘½ä»¤è¡Œå‚æ•°</strong></em></p>
<p><em>hb_model_infoçš„å‘½ä»¤è¡Œå‚æ•°ï¼š</em></p>
<p><em>â€“versionæ˜¾ç¤ºç‰ˆæœ¬å¹¶é€€å‡ºã€‚</em></p>
<p><em>-måæ¥æ¨¡å‹åç§°ã€‚å½“æŒ‡å®šBIN_FILEä¸ºpackæ¨¡å‹æ—¶ï¼Œä»…è¾“å‡ºæŒ‡å®šæ¨¡å‹çš„æ¨¡å‹ç¼–è¯‘ä¿¡æ¯ã€‚</em></p>
<p><em>â€“helpæ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯ã€‚</em></p>
<p><em><strong>è¾“å‡ºå†…å®¹è¯´æ˜</strong></em></p>
<p><em>è¾“å‡ºéƒ¨åˆ†å°†ä¼šæ˜¯æ¨¡å‹ç¼–è¯‘æ—¶çš„ä¸€äº›è¾“å…¥ä¿¡æ¯ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š<strong>ä»¥ä¸‹ä»£ç å—ä¸­çš„ç‰ˆæœ¬å·ä¿¡æ¯å°†éšå‘å¸ƒåŒ…ç‰ˆæœ¬å˜åŒ–ï¼Œæ­¤å¤„ä»…ä¸ºç¤ºä¾‹ã€‚</strong></em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">Start hb_model_info....</span><br><span class="line">hb_model_info version 1.3.35</span><br><span class="line">******** efficient_det_512x512_nv12 info *********</span><br><span class="line">############# model deps info #############</span><br><span class="line">hb_mapper version   : 1.3.35</span><br><span class="line">hbdk version        : 3.23.3</span><br><span class="line">hbdk runtime version: 3.13.7</span><br><span class="line">horizon_nn version  : 0.10.10</span><br><span class="line">############# model_parameters info #############</span><br><span class="line">onnx_model          : /release/01_common/model_zoo/mapper/detection/efficient_det/efficientdet_nhwc.onnx</span><br><span class="line">BPU march           : bayes</span><br><span class="line">layer_out_dump      : False</span><br><span class="line">working dir         : /release/04_detection/05_efficient_det/mapper/model_output</span><br><span class="line">output_model_file_prefix: efficient_det_512x512_nv12</span><br><span class="line">############# input_parameters info #############</span><br><span class="line">------------------------------------------</span><br><span class="line">---------input info : data ---------</span><br><span class="line">input_name          : data</span><br><span class="line">input_type_rt       : nv12</span><br><span class="line">input_space&amp;range   : regular</span><br><span class="line">input_layout_rt     : None</span><br><span class="line">input_type_train    : rgb</span><br><span class="line">input_layout_train  : NCHW</span><br><span class="line">norm_type           : data_mean_and_scale</span><br><span class="line">input_shape         : 1x3x512x512</span><br><span class="line">mean_value          : 123.68,116.779,103.939,</span><br><span class="line">scale_value         : 0.017,</span><br><span class="line">cal_data_dir        : /release/04_detection/05_efficient_det/mapper/calibration_data_rgb_f32</span><br><span class="line">---------input info : data end -------</span><br><span class="line">------------------------------------------</span><br><span class="line">############# calibration_parameters info #############</span><br><span class="line">preprocess_on       : False</span><br><span class="line">calibration_type    : max</span><br><span class="line">############# compiler_parameters info #############</span><br><span class="line">hbdk_pass_through_params: --fast --O3</span><br><span class="line">input-source        : &#123;&#x27;data&#x27;: &#x27;pyramid&#x27;, &#x27;_default_value&#x27;: &#x27;ddr&#x27;&#125;</span><br><span class="line">--------- input/output types -------------------</span><br><span class="line">model input types   : [&lt;InputDataType.NV12: 7&gt;]</span><br><span class="line">model output types  : [&lt;InputDataType.F32: 5&gt;, &lt;InputDataType.F32: 5&gt;, &lt;InputDataType.F32: 5&gt;, &lt;InputDataTye.F32: 5&gt;, &lt;InputDataType.F32: 5&gt;, &lt;InputDataType.F32: 5&gt;, &lt;InputDataType.F32: 5&gt;, &lt;InputDataType.F32: 5&gt;, &lt;InputDataType.F32: 5&gt;, &lt;InpuDataType.F32: 5&gt;]</span><br></pre></td></tr></table></figure></div>



<p><em>å½“æ¨¡å‹ä¸­å­˜åœ¨è¢«åˆ é™¤èŠ‚ç‚¹æ—¶ï¼Œæ¨¡å‹ä¿¡æ¯è¾“å‡ºæœ«å°¾ä¼šæ‰“å°è¢«åˆ é™¤èŠ‚ç‚¹çš„åç§°ï¼ŒåŒæ—¶ä¼šç”Ÿæˆ <code>deleted_nodes_info.txt</code> æ–‡ä»¶ï¼Œæ–‡ä»¶ä¸­æ¯ä¸€è¡Œè®°å½•äº†å¯¹åº”è¢«åˆ é™¤èŠ‚ç‚¹çš„åˆå§‹ä¿¡æ¯ã€‚æ‰“å°è¢«åˆ é™¤èŠ‚ç‚¹çš„åç§°å¦‚ä¸‹æ‰€ç¤ºï¼š</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">--------- deleted nodes -------------------</span><br><span class="line">deleted nodes: spconvretinanethead0_conv91_fwd_chw_HzDequantize</span><br><span class="line">deleted nodes: spconvretinanethead0_conv95_fwd_chw_HzDequantize</span><br><span class="line">deleted nodes: spconvretinanethead0_conv99_fwd_chw_HzDequantize</span><br><span class="line">deleted nodes: spconvretinanethead0_conv103_fwd_chw_HzDequantize</span><br><span class="line">deleted nodes: spconvretinanethead0_conv107_fwd_chw_HzDequantize</span><br><span class="line">deleted nodes: spconvretinanethead0_conv93_fwd_chw_HzDequantize</span><br><span class="line">deleted nodes: spconvretinanethead0_conv97_fwd_chw_HzDequantize</span><br><span class="line">deleted nodes: spconvretinanethead0_conv101_fwd_chw_HzDequantize</span><br><span class="line">deleted nodes: spconvretinanethead0_conv105_fwd_chw_HzDequantize</span><br><span class="line">deleted nodes: spconvretinanethead0_conv109_fwd_chw_HzDequantize</span><br></pre></td></tr></table></figure></div>



<blockquote>
<p><em>hb_pack å·¥å…·</em></p>
</blockquote>
<p><em><code>hb_pack</code> æ˜¯ç”¨äºå°†å¤šä¸ªæ··åˆæ¨¡å‹(</em>.bin)æ–‡ä»¶æ‰“åŒ…ä¸ºä¸€ä¸ªæ¨¡å‹æ–‡ä»¶çš„å·¥å…·ã€‚*</p>
<p><em><strong>ä½¿ç”¨æ–¹æ³•</strong></em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hb_pack [OPTIONS] BIN_FILE1 BIN_FILE2 BIN_FILE3 -o comb.bin</span><br></pre></td></tr></table></figure></div>



<p> <em><strong>å‘½ä»¤è¡Œå‚æ•°</strong></em></p>
<p><em>hb_packçš„å‘½ä»¤è¡Œå‚æ•°ï¼š</em></p>
<ul>
<li><p><em>â€“version</em></p>
<p><em>æ˜¾ç¤ºç‰ˆæœ¬å¹¶é€€å‡ºã€‚</em></p>
</li>
<li><p><em>-o, â€“output_name</em></p>
<p><em>packæ¨¡å‹çš„è¾“å‡ºåç§°</em></p>
</li>
<li><p><em>â€“help</em></p>
<p><em>æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯ã€‚</em></p>
</li>
</ul>
<p><em><strong>è¾“å‡ºå†…å®¹è¯´æ˜</strong></em></p>
<p><em>æ‰“åŒ…çš„æ¨¡å‹ä¼šè¾“å‡ºåœ¨å½“å‰ç›®å½•æ–‡ä»¶å¤¹ä¸­ï¼Œè¯¥æ¨¡å‹ä¼šè¢«å‘½åä¸º <code>output_name</code> æŒ‡å®šåç§°ã€‚ è¯¥æ‰“åŒ…æ¨¡å‹ä¸­æ‰€æœ‰å­æ¨¡å‹çš„ç¼–è¯‘ä¿¡æ¯åŠæ€§èƒ½ä¿¡æ¯å‡å¯é€šè¿‡ <code>hb_model_info</code> åŠ <code>hb_perf</code> è·å–å¾—åˆ°ã€‚</em></p>
<p><em><strong>æ³¨æ„ï¼š<code>hb_pack</code> ä¸æ”¯æŒå¯¹å·²ç»æ‰“åŒ…çš„æ¨¡å‹å†æ¬¡è¿›è¡Œæ‰“åŒ…ï¼Œå¦åˆ™å·¥ä½œå°å°†ä¼šäº§ç”Ÿä»¥ä¸‹æç¤ºï¼š</strong></em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ERROR exception in command: pack</span><br><span class="line">ERROR model: xxx.bin is a packed model, it can not be packed again!</span><br></pre></td></tr></table></figure></div>



<blockquote>
<p><em>hb_verifier å·¥å…·</em></p>
</blockquote>
<p><em><code>hb_verifier</code> å·¥å…·æ˜¯ç”¨äºå¯¹æŒ‡å®šçš„å®šç‚¹æ¨¡å‹å’Œruntimeæ¨¡å‹è¿›è¡Œç»“æœéªŒè¯çš„å·¥å…·ã€‚</em></p>
<p><em>è‹¥æ‚¨ä½¿ç”¨å·¥å…·å‰æŒ‡å®šäº†å›¾ç‰‡ï¼Œåˆ™ <code>hb_verifier</code> å·¥å…·ä¼šä½¿ç”¨æŒ‡å®šå›¾ç‰‡è¿›è¡Œå®šç‚¹æ¨¡å‹æ¨ç†ã€runtimeæ¨¡å‹æ¿ç«¯å’ŒX86ç«¯æ¨¡æ‹Ÿå™¨ä¸Šçš„æ¨ç†ï¼Œå¹¶å¯¹ç»“æœè¿›è¡Œä¸¤ä¸¤æ¯”è¾ƒï¼Œ ç»™å‡ºæ˜¯å¦é€šè¿‡çš„ç»“è®ºï¼ˆæ­¤è¿‡ç¨‹æ”¯æŒè‡ªé€‰ï¼Œæ‚¨å¯ä»¥æ ¹æ®éœ€è¦é€‰æ‹©è¿›è¡Œå¯¹æ¯”çš„å†…å®¹ï¼‰ã€‚</em></p>
<p><em>è‹¥æ‚¨åœ¨ä½¿ç”¨å·¥å…·å‰æœªæŒ‡å®šå›¾ç‰‡ï¼Œåˆ™ <code>hb_verifier</code> å·¥å…·ä¼šé»˜è®¤ä½¿ç”¨éšæœºç”Ÿæˆçš„tensoræ•°æ®è¿›è¡Œæ¨ç†ã€‚</em></p>
<p><em><strong>æ³¨æ„ï¼š</strong></em></p>
<ul>
<li><em>åœ¨è¿›è¡Œruntimeæ¨¡å‹åœ¨æ¿ç«¯çš„æ¨ç†æ—¶ï¼Œéœ€è¦ç¡®è®¤ç»™å®šipå¯ä»¥pingé€šä¸”æ¿ç«¯å·²ç»å®‰è£… <code>hrt_tools</code> ï¼Œè‹¥æ— åˆ™å¯ä»¥ä½¿ç”¨OEåŒ…ä¸­ <code>ddk/package/board</code> ä¸‹çš„ <code>install.sh</code> è„šæœ¬è¿›è¡Œå®‰è£…ã€‚</em></li>
<li><em>åœ¨è¿›è¡Œruntimeæ¨¡å‹åœ¨x86ç«¯çš„æ¨ç†æ—¶ï¼Œéœ€è¦ç¡®ä¿hostç«¯å·²ç»å®‰è£… <code>hrt_tools</code>ï¼Œè‹¥æ— åˆ™å¯ä»¥ä½¿ç”¨OEåŒ…ä¸­ <code>ddk/package/host/host_package/</code> ä¸‹çš„ <code>install_host_package.sh</code> è„šæœ¬è¿›è¡Œå®‰è£…ã€‚</em></li>
</ul>
<p><em>åœ¨ä½¿ç”¨æœ¬å·¥å…·å‰ï¼Œä»¥ä¸‹å†…å®¹éœ€è¦è¯·æ‚¨æ³¨æ„ï¼š</em></p>
<p><em>hb_verifierå·¥å…·ä¸æ”¯æŒé™¤DequantizeèŠ‚ç‚¹å¤–ï¼Œæœ‰å…¶ä»–èŠ‚ç‚¹å˜åŒ–çš„binæ¨¡å‹ä¸quanti.onnxè¿›è¡Œå¯¹æ¯”ã€‚</em></p>
<p><em>å¦‚æœåœ¨ä½¿ç”¨æœ¬å·¥å…·å‰ï¼Œæ‚¨ä½¿ç”¨hb_model_modifierå·¥å…·åˆ é™¤äº†binæ¨¡å‹çš„è¾“å‡ºå‰çš„æœ€åä¸€ä¸ªèŠ‚ç‚¹ä¸”è¯¥èŠ‚ç‚¹ä¸ºéDequantizeèŠ‚ç‚¹ï¼Œæˆ–è€…yamlæ–‡ä»¶ä¸­é…ç½®äº† <code>remove_node_type</code> å‚æ•°ï¼Œ ä»è€Œåˆ é™¤äº†binæ¨¡å‹çš„è¾“å‡ºå‰çš„æœ€åä¸€ä¸ªèŠ‚ç‚¹ä¸”è¯¥èŠ‚ç‚¹ä¸ºéDequantizeèŠ‚ç‚¹ï¼Œé‚£ä¹ˆhb_verifierå·¥å…·å°†ä¸å†æ”¯æŒquanti.onnxå’Œåˆ é™¤èŠ‚ç‚¹åçš„binæ¨¡å‹åšå¯¹æ¯”ã€‚</em></p>
<p><em>å¦‚æ‚¨æƒ³è§£å†³ä¸Šè¿°é—®é¢˜ï¼Œ<strong>éœ€è¦é¿å…å‡ºç°ä¸Šè¿°åˆ é™¤binæ¨¡å‹çš„è¾“å‡ºå‰çš„æœ€åä¸€ä¸ªèŠ‚ç‚¹ä¸”è¯¥èŠ‚ç‚¹ä¸ºéDequantizeèŠ‚ç‚¹çš„æƒ…å†µã€‚</strong></em></p>
<p><em><strong>ä½¿ç”¨æ–¹å¼</strong></em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">hb_verifier -m   $&#123;quanti_model&#125;,$&#123;bin_model&#125; \</span><br><span class="line">            -b   $&#123;board_ip&#125; \</span><br><span class="line">            -s   True / False \</span><br><span class="line">            -i   $&#123;input_img&#125; \</span><br><span class="line">            -c   $&#123;digits&#125;  \</span><br><span class="line">            -r   True / False</span><br></pre></td></tr></table></figure></div>



<p><em><strong>å‘½ä»¤è¡Œå‚æ•°</strong></em></p>
<p><em>hb_verifierçš„å‘½ä»¤è¡Œå‚æ•°ï¼š</em></p>
<ul>
<li><p><em>â€“model, -m</em></p>
<p><em>å®šç‚¹æ¨¡å‹åç§°å’Œbinæ¨¡å‹åç§°ï¼Œå¤šæ¨¡å‹ä¹‹é—´ç”¨â€,â€è¿›è¡ŒåŒºåˆ†ã€‚</em></p>
</li>
<li><p><em>â€“board-ip, -b</em></p>
<p><em>ä¸Šæ¿æµ‹è¯•ä½¿ç”¨çš„arm board ipåœ°å€ã€‚</em></p>
</li>
<li><p><em>â€“run-sim, -s</em></p>
<p><em>è®¾ç½®æ˜¯å¦ä½¿ç”¨X86ç¯å¢ƒçš„libdnnåšbinæ¨¡å‹æ¨ç†ï¼Œé»˜è®¤ä¸ºFalseã€‚å½“è¯¥å‚æ•°è®¾ç½®ä¸º <code>True</code> æ—¶ï¼Œå·¥å…·å°†ä¼šä½¿ç”¨x86ç¯å¢ƒçš„libdnnåšbinæ¨¡å‹æ¨ç†ã€‚å½“è¯¥å‚æ•°è®¾ç½®ä¸º <code>False</code> æ—¶ï¼Œå·¥å…·ä¸ä¼šä½¿ç”¨x86ç¯å¢ƒçš„libdnnåšbinæ¨¡å‹æ¨ç†ã€‚</em></p>
</li>
<li><p><em>â€“input-img, -i</em></p>
<p><em>æŒ‡å®šæ¨ç†æµ‹è¯•æ—¶ä½¿ç”¨çš„å›¾ç‰‡ã€‚è‹¥ä¸æŒ‡å®šåˆ™ä¼šä½¿ç”¨éšæœºç”Ÿæˆçš„tensoræ•°æ®ã€‚è‹¥æŒ‡å®šå›¾ç‰‡ä¸ºäºŒè¿›åˆ¶å½¢å¼çš„å›¾ç‰‡æ–‡ä»¶ï¼Œå…¶æ–‡ä»¶å½¢å¼éœ€è¦ä¸ºåç¼€åä¸º <code>.bin</code> å½¢å¼ã€‚å¤šè¾“å…¥æ¨¡å‹æ·»åŠ å›¾ç‰‡çš„æ–¹å¼æœ‰ä»¥ä¸‹ä¸¤ç§ä¼ å‚æ–¹å¼ï¼Œå¤šå¼ å›¾ç‰‡ä¹‹é—´ç”¨â€,â€åˆ†å‰²ï¼šinput_name1:image1,input_name2:image2, â€¦image1,image2â€¦</em></p>
</li>
<li><p><em>â€“compare_digits, -c</em></p>
<p><em>è®¾ç½®æ¯”è¾ƒæ¨ç†ç»“æœçš„æ•°å€¼ç²¾ç¡®åº¦ï¼ˆå³æ¯”è¾ƒæ•°å€¼å°æ•°ç‚¹åçš„ä½æ•°ï¼‰ï¼Œè‹¥ä¸è¿›è¡ŒæŒ‡å®šåˆ™å·¥å…·ä¼šé»˜è®¤æ¯”è¾ƒè‡³å°æ•°ç‚¹åäº”ä½ã€‚</em></p>
</li>
<li><p><em>â€“dump-all-nodes-results, -r</em></p>
<p><em>è®¾ç½®æ˜¯å¦ä¿å­˜æ¨¡å‹ä¸­å„ä¸ªç®—å­çš„è¾“å‡ºç»“æœï¼Œå¹¶å¯¹ç®—å­è¾“å‡ºåç§°ç›¸åŒçš„ç»“æœè¿›è¡Œå¯¹æ¯”ï¼Œé»˜è®¤ä¸ºFalseã€‚å½“è¯¥å‚æ•°è®¾ç½®ä¸º <code>True</code> æ—¶ï¼Œå·¥å…·å°†ä¼šè·å–æ¨¡å‹ä¸­æ‰€æœ‰èŠ‚ç‚¹çš„è¾“å‡ºï¼Œå¹¶æ ¹æ®èŠ‚ç‚¹è¾“å‡ºçš„åå­—åšåŒ¹é…ï¼Œä»è€Œè¿›è¡Œå¯¹æ¯”ã€‚å½“è¯¥å‚æ•°è®¾ç½®ä¸º <code>False</code> æ—¶ï¼Œå·¥å…·å°†ä¼šåªè·å–æ¨¡å‹æœ€ç»ˆè¾“å‡ºçš„ç»“æœï¼Œå¹¶è¿›è¡Œå¯¹æ¯”ã€‚</em></p>
</li>
</ul>
<p><em>æ³¨æ„ï¼šç›®å‰åŸºäºæ€§èƒ½è€ƒè™‘ï¼Œæš‚ä¸æ”¯æŒæ‚¨åœ¨X86ç¯å¢ƒä¸‹ä½¿ç”¨dumpåŠŸèƒ½ã€‚</em></p>
<p><em><strong>å‚è€ƒä½¿ç”¨åœºæ™¯æ ·ä¾‹</strong></em></p>
<p><em>1.quanti.onnxæ¨¡å‹æ¨ç†ã€binæ¨¡å‹åœ¨æ¿ç«¯æ¨ç†ï¼Œbinæ¨¡å‹åœ¨X86ç¯å¢ƒä¸‹è¿›è¡Œæ¨ç†ï¼Œå¹¶å¯¹ä¸‰æ–¹æ¨ç†ç»“æœåšå¯¹æ¯”ï¼š</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hb_verifier -m quanti.onnx,model.bin -b *.*.*.* -s True (-i é€‰å¡«)</span><br></pre></td></tr></table></figure></div>

<p><em>2.quanti.onnxæ¨¡å‹æ¨ç†ã€binæ¨¡å‹åœ¨æ¿ç«¯æ¨ç†ï¼Œå¹¶å¯¹ä¸¤æ–¹æ¨ç†ç»“æœåšå¯¹æ¯”ï¼š</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hb_verifier -m quanti.onnx,model.bin -b *.*.*.* (-i é€‰å¡«)</span><br></pre></td></tr></table></figure></div>

<p><em>3.quanti.onnxæ¨¡å‹æ¨ç†ã€binæ¨¡å‹åœ¨æ¿ç«¯æ¨ç†ï¼Œè¿‡ç¨‹ä¸­ä¼šä¿å­˜ä¸¤æ–¹æ¨¡å‹ä¸­å„ä¸ªç®—å­çš„è¾“å‡ºï¼Œå¹¶å¯¹ç®—å­è¾“å‡ºåç§°ç›¸åŒçš„ç»“æœè¿›è¡Œå¯¹æ¯”ï¼š</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hb_verifier -m quanti.onnx,model.bin -b *.*.*.* -r True (-i é€‰å¡«)</span><br></pre></td></tr></table></figure></div>

<p><em>4.quanti.onnxæ¨¡å‹æ¨ç†ã€binæ¨¡å‹åœ¨X86ç¯å¢ƒä¸‹è¿›è¡Œæ¨ç†ï¼Œå¹¶å¯¹ä¸¤æ–¹æ¨ç†ç»“æœåšå¯¹æ¯”ï¼š</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hb_verifier -m quanti.onnx,model.bin -s True (-i é€‰å¡«)</span><br></pre></td></tr></table></figure></div>

<p><em>5.binæ¨¡å‹åœ¨æ¿ç«¯ã€X86ç¯å¢ƒä¸‹è¿›è¡Œæ¨ç†ï¼Œå¹¶å¯¹ä¸¤æ–¹æ¨ç†ç»“æœåšå¯¹æ¯”ï¼š</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hb_verifier -m model.bin -b *.*.*.* -s True (-i é€‰å¡«)</span><br></pre></td></tr></table></figure></div>



<p><em><strong>è¾“å‡ºå†…å®¹è¯´æ˜</strong></em></p>
<p><em>ç»“æœå¯¹æ¯”æœ€ç»ˆä¼šåœ¨ç»ˆç«¯å±•ç¤ºï¼Œå·¥å…·ä¼šå¯¹æ¯”å¤šä¸ªæ¨¡å‹åœ¨ä¸åŒåœºæ™¯ä¸‹çš„è¿è¡Œç»“æœï¼Œè‹¥æ— é—®é¢˜åº”æ˜¾ç¤ºå¦‚ä¸‹:</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Comparison results of original output is model_infer_output_0</span><br><span class="line">raw output 0 and raw output 0 result Strict check PASSED</span><br><span class="line">Quanti.onnx and Arm result Strict check PASSED</span><br></pre></td></tr></table></figure></div>

<p><em>åœ¨å®šç‚¹æ¨¡å‹å’Œruntimeæ¨¡å‹ç²¾åº¦ä¸ä¸€è‡´æ—¶ä¼šè¾“å‡ºä¸ä¸€è‡´ç»“æœçš„å…·ä½“ä¿¡æ¯ï¼Œå¦‚ä¸‹æ–¹logæ‰€ç¤ºï¼š</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">INFO ================== Sim infer log end ==========================</span><br><span class="line">INFO ***************************************************************</span><br><span class="line">INFO compare source: Quanti.onnx VS Arm</span><br><span class="line">INFO compare model name: clr_320x800_bgr_quantized_model VS clr_320x800_bgr</span><br><span class="line">Compare progress: 100%|###################################| 1/1 [00:00&lt;00:00, 17.53it/s]</span><br><span class="line">INFO =============== Original output comparison results =================</span><br><span class="line">INFO Comparison results of original output is model_infer_output_0</span><br><span class="line">INFO mismatch result num: 13824</span><br><span class="line">INFO total result num: 14976</span><br><span class="line">INFO mismatch rate: 0.923</span><br><span class="line">INFO relative mismatch ratio: 1.0</span><br><span class="line">WARNING raw output 0 and raw output 0 result Strict check FAILED</span><br><span class="line">WARNING Quanti.onnx and Arm result Strict check FAILED</span><br><span class="line">INFO ***************************************************************</span><br><span class="line">INFO ***************************************************************</span><br><span class="line">INFO compare source: Quanti.onnx VS Sim</span><br><span class="line">INFO compare model name: clr_320x800_bgr_quantized_model VS clr_320x800_bgr</span><br><span class="line">Compare progress: 100%|###################################| 1/1 [00:00&lt;00:00, 18.51it/s]</span><br><span class="line">INFO =============== Original output comparison results =================</span><br><span class="line">INFO Comparison results of original output is model_infer_output_0</span><br><span class="line">INFO mismatch result num: 13824</span><br><span class="line">INFO total result num: 14976</span><br><span class="line">INFO mismatch rate: 0.923</span><br><span class="line">INFO relative mismatch ratio: 1.0</span><br><span class="line">WARNING raw output 0 and raw output 0 result Strict check FAILED</span><br><span class="line">WARNING Quanti.onnx and Sim result Strict check FAILED</span><br><span class="line">INFO ***************************************************************</span><br><span class="line">INFO ***************************************************************</span><br><span class="line">INFO compare source: Arm VS Sim</span><br><span class="line">INFO compare model name: clr_320x800_bgr VS clr_320x800_bgr</span><br><span class="line">Compare progress: 100%|###################################| 1/1 [00:00&lt;00:00, 48.73it/s]</span><br><span class="line">INFO =============== Original output comparison results =================</span><br><span class="line">INFO Comparison results of original output is model_infer_output_0</span><br><span class="line">INFO raw output 0 and raw output 0 result Strict check PASSED</span><br><span class="line">INFO Arm and Sim result Strict check PASSED</span><br><span class="line">INFO ***************************************************************</span><br></pre></td></tr></table></figure></div>

<p><em>å…¶ä¸­ï¼š</em></p>
<ul>
<li><em><code>mismatch result num</code> ä¸ºä¸¤ç§æ¨¡å‹ç²¾åº¦ä¸ä¸€è‡´ç»“æœçš„ä¸ªæ•°ï¼ŒåŒ…æ‹¬ä¸‰ç§ä¸ä¸€è‡´æƒ…å†µï¼š</em><ul>
<li><em><code>mismatch.line_miss num</code> ä¸ºè¾“å‡ºç»“æœæ•°é‡ä¸ä¸€è‡´çš„ä¸ªæ•°ï¼›</em></li>
<li><em><code>mismatch.line_diff num</code> ä¸ºè¾“å‡ºç»“æœå·®è·è¿‡å¤§çš„ä¸ªæ•°ï¼›</em></li>
<li><em><code>mismatch.line_nan num</code> ä¸ºè¾“å‡ºä¸ºnançš„ä¸ªæ•°ã€‚</em></li>
</ul>
</li>
<li><em><code>total result num</code> ä¸ºè¾“å‡ºæ•°æ®çš„æ€»ä¸ªæ•°ã€‚</em></li>
<li><em><code>mismatch rate</code> ä¸ºä¸ä¸€è‡´æ•°æ®ä¸ªæ•°å è¾“å‡ºæ•°æ®æ€»ä¸ªæ•°çš„æ¯”ä¾‹ã€‚</em></li>
<li><em><code>relative mismatch ratio</code> ä¸ºç›¸å¯¹è¯¯å·®æ¯”ä¾‹ï¼Œå–è¯¯å·®æ¯”ä¾‹æœ€å¤§çš„å€¼è¿›è¡Œå±•ç¤ºã€‚</em></li>
</ul>
<blockquote>
<p><em>hb_model_modifier</em></p>
</blockquote>
<p><em><code>hb_model_modifier</code> å·¥å…·ç”¨äºå¯¹æŒ‡å®šçš„runtimeæ¨¡å‹ä¸­è¾“å…¥ç«¯çš„Transposeã€Quantizeã€Castã€ReshapeèŠ‚ç‚¹å’Œè¾“å‡ºç«¯çš„Transposeã€Dequantizeã€Castã€Reshapeã€SoftmaxèŠ‚ç‚¹è¿›è¡Œåˆ é™¤æ“ä½œï¼Œ å¹¶å°†åˆ é™¤èŠ‚ç‚¹çš„ä¿¡æ¯å­˜æ”¾åœ¨BINæ¨¡å‹ä¸­ï¼Œå¯ä»¥é€šè¿‡ <code>hb_model_info</code> è¿›è¡ŒæŸ¥çœ‹ã€‚</em></p>
<p><em><strong>æ³¨æ„ï¼š</strong></em></p>
<ol>
<li><em>hb_model_modifierå·¥å…·åªèƒ½åˆ é™¤ç´§æŒ¨ç€æ¨¡å‹è¾“å…¥æˆ–è¾“å‡ºçš„èŠ‚ç‚¹ã€‚å¦‚æœå¾…åˆ é™¤èŠ‚ç‚¹åé¢å¦‚æœæ¥çš„æ˜¯å…¶ä»–èŠ‚ç‚¹ï¼Œåˆ™ä¸èƒ½è¿›è¡Œåˆ é™¤æ“ä½œã€‚</em></li>
<li><em>æ¨¡å‹èŠ‚ç‚¹åç§°éœ€è¦æ³¨æ„ä¸è¦åŒ…æ‹¬ â€œ;â€ â€œ,â€ ç­‰ç‰¹æ®Šç¬¦å·ï¼Œå¦åˆ™å¯èƒ½ä¼šå½±å“å·¥å…·çš„ä½¿ç”¨ã€‚</em></li>
<li><em>å·¥å…·ä¸æ”¯æŒå¯¹æ‰“åŒ…çš„æ¨¡å‹è¿›è¡Œå¤„ç†ï¼Œå¦åˆ™å°†æç¤ºï¼š <code>ERROR pack model is not supported</code>ã€‚</em></li>
<li><em>å¾…åˆ é™¤èŠ‚ç‚¹ä¼šæŒ‰é¡ºåºä¾æ¬¡åˆ é™¤ï¼Œå¹¶ä¸”ä¼šåŠ¨æ€æ›´æ–°æ¨¡å‹ç»“æ„; åŒæ—¶åœ¨èŠ‚ç‚¹åˆ é™¤å‰è¿˜ä¼šåˆ¤æ–­è¯¥èŠ‚ç‚¹æ˜¯å¦ä½äºæ¨¡å‹çš„è¾“å…¥è¾“å‡ºå¤„ï¼Œå› æ­¤èŠ‚ç‚¹çš„åˆ é™¤é¡ºåºå¾ˆé‡è¦ã€‚</em></li>
</ol>
<p><em>ç”±äºåˆ é™¤ç‰¹å®šèŠ‚ç‚¹åä¼šå¯¹æ¨¡å‹çš„è¾“å…¥æƒ…å†µæœ‰å½±å“ï¼Œ<strong>å› æ­¤å·¥å…·åªå¯¹æ¨¡å‹è¾“å…¥ååªæœ‰ä¸€æ¡é€šè·¯çš„æƒ…å†µé€‚ç”¨</strong>ï¼Œè‹¥å¦‚ä¸‹å›¾ä¸­æ‰€ç¤ºï¼ŒåŒä¸€è¾“å…¥å¯¹åº”äº†å¤šä¸ªèŠ‚ç‚¹çš„æƒ…å†µå°šä¸æ”¯æŒã€‚</em></p>
<p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230511144012726.png"
                      class="" title="image-20230511144012726"
                ></em></p>
<p><em><strong>ä½¿ç”¨æ–¹å¼</strong></em></p>
<ol>
<li><em>æŸ¥çœ‹å¯åˆ é™¤çš„èŠ‚ç‚¹ï¼š</em></li>
</ol>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hb_model_modifier model.bin</span><br></pre></td></tr></table></figure></div>

<ol start="2">
<li><em>åˆ é™¤å•ä¸ªæŒ‡å®šèŠ‚ç‚¹ï¼ˆä»¥node1ä¸ºä¾‹ï¼‰ï¼š</em></li>
</ol>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hb_model_modifier model.bin -r node1</span><br></pre></td></tr></table></figure></div>

<ol start="3">
<li><em>åˆ é™¤å¤šä¸ªæŒ‡å®šèŠ‚ç‚¹ï¼ˆä»¥node1ã€node2ã€node3ä¸ºä¾‹ï¼‰ï¼š</em></li>
</ol>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hb_model_modifier model.bin -r node1 -r node2 -r node3</span><br></pre></td></tr></table></figure></div>

<ol start="4">
<li><em>åˆ é™¤æŸç±»èŠ‚ç‚¹ï¼ˆä»¥Dequantizeä¸ºä¾‹ï¼‰ï¼š</em></li>
</ol>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hb_model_modifier model.bin --all Dequantize</span><br></pre></td></tr></table></figure></div>

<ol start="5">
<li><em>åˆ é™¤å¤šç§ç±»å‹èŠ‚ç‚¹ï¼ˆä»¥Reshapeã€Castã€Dequantizeä¸ºä¾‹ï¼‰ï¼š</em></li>
</ol>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hb_model_modifier model.bin -a Reshape -a Cast -a Dequantize</span><br></pre></td></tr></table></figure></div>

<ol start="6">
<li><em>ç»„åˆä½¿ç”¨ï¼š</em></li>
</ol>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hb_model_modifier model.bin -a Reshape -a Cast -a Dequantize -r node1 -r node2 -r node3</span><br></pre></td></tr></table></figure></div>



<p><em><strong>å‘½ä»¤è¡Œå‚æ•°</strong></em></p>
<p><em>hb_model_modifierçš„å‘½ä»¤è¡Œå‚æ•°ï¼š</em></p>
<p><em>model_file   runtime æ¨¡å‹æ–‡ä»¶åç§°ã€‚</em></p>
<p><em>-råæ¥æŒ‡å®šåˆ é™¤èŠ‚ç‚¹çš„åç§°ã€‚è‹¥æœ‰å¤šä¸ªèŠ‚ç‚¹éœ€è¦åˆ é™¤ï¼Œéœ€è¦æŒ‡å®šå¤šæ¬¡ã€‚</em></p>
<p><em>-oåæ¥ä¿®æ”¹åçš„æ¨¡å‹è¾“å‡ºåç§°(ä»…åœ¨æœ‰ <code>-r</code> å‚æ•°æ—¶ç”Ÿæ•ˆ)ã€‚</em></p>
<p><em>-a, â€“allåæ¥èŠ‚ç‚¹ç±»å‹ã€‚æ”¯æŒä¸€é”®åˆ é™¤æ‰€æœ‰å¯¹åº”ç±»å‹çš„åŠŸèƒ½ã€‚è‹¥æœ‰å¤šä¸ªç±»å‹èŠ‚ç‚¹éœ€è¦åˆ é™¤ï¼Œéœ€è¦æŒ‡å®šå¤šæ¬¡ã€‚</em></p>
<p><em><strong>è¾“å‡ºå†…å®¹è¯´æ˜</strong></em></p>
<p><em>è‹¥å·¥å…·åä¸æ¥ä»»ä½•å‚æ•°ï¼Œåˆ™å·¥å…·ä¼šæ‰“å°å‡ºå¯ä¾›å€™é€‰çš„å¯åˆ é™¤èŠ‚ç‚¹ï¼ˆå³æ¨¡å‹ä¸­çš„ä½äºè¾“å…¥è¾“å‡ºä½ç½®çš„æ‰€æœ‰Transposeã€Quantizeã€Dequantizeã€Castã€Reshapeã€SoftmaxèŠ‚ç‚¹ï¼‰ã€‚</em></p>
<p><em>å…¶ä¸­QuantizeèŠ‚ç‚¹ç”¨äºå°†æ¨¡å‹floatç±»å‹çš„è¾“å…¥æ•°æ®é‡åŒ–è‡³int8ç±»å‹ï¼Œå…¶è®¡ç®—å…¬å¼å¦‚ä¸‹ï¼š</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">`qx = clamp(round(x / scale) + zero_point, -128, 127)`</span><br></pre></td></tr></table></figure></div>

<ul>
<li><em><code>round(x)</code> å®ç°æµ®ç‚¹æ•°çš„å››èˆäº”å…¥ã€‚</em></li>
<li><em><code>clamp(x)</code> å‡½æ•°å®ç°å°†æ•°æ®é’³ä½åœ¨-128~127ä¹‹é—´çš„æ•´æ•°æ•°å€¼ã€‚</em></li>
<li><em><code>scale</code> ä¸ºé‡åŒ–æ¯”ä¾‹å› å­ã€‚</em></li>
<li><em><code>zero_point</code> ä¸ºéå¯¹ç§°é‡åŒ–é›¶ç‚¹åç§»å€¼ï¼Œå¯¹ç§°é‡åŒ–æ—¶ zero_point &#x3D; 0 ã€‚</em></li>
</ul>
<p><em>C++çš„å‚è€ƒå®ç°å¦‚ä¸‹ï¼š</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">static inline int8_t quantize(float32_t value, float32_t const scale, float32_t const zero_point, float32_t const min, float32_t const max)</span><br><span class="line">&#123;</span><br><span class="line">  value = std::round(value / scale + zero_point);</span><br><span class="line">  value = std::min(std::max(value, min), max);</span><br><span class="line">  return static_cast&lt;int8_t&gt;(value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p><em>DequantizeèŠ‚ç‚¹åˆ™ç”¨äºå°†æ¨¡å‹ int8 æˆ– int32 ç±»å‹çš„è¾“å‡ºæ•°æ®åé‡åŒ–å› float æˆ– double ç±»å‹ï¼Œå…¶è®¡ç®—å…¬å¼å¦‚ä¸‹ï¼š</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">`deqx = (x - zero_point) * scale`</span><br></pre></td></tr></table></figure></div>

<p><em>C++çš„å‚è€ƒå®ç°å¦‚ä¸‹ï¼š</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">static_cast&lt;float&gt;(value) * scale</span><br></pre></td></tr></table></figure></div>

<p><em><strong>æ³¨æ„ï¼š</strong></em></p>
<p><em>ç›®å‰å·¥å…·æ”¯æŒåˆ é™¤ï¼š</em></p>
<ol>
<li><em>è¾“å…¥éƒ¨ä½çš„èŠ‚ç‚¹ä¸ºQuantizeã€Transposeã€Castã€ReshapeèŠ‚ç‚¹ï¼›</em></li>
<li><em>è¾“å‡ºéƒ¨ä½çš„èŠ‚ç‚¹ä¸ºTransposeã€Dequantizeã€Castã€Reshapeã€SoftmaxèŠ‚ç‚¹ã€‚</em></li>
</ol>
<p><em>å·¥å…·æ‰“å°ä¿¡æ¯å¦‚ä¸‹ï¼š</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hb_model_modifier resnet50_64x56x56_featuremap.bin</span><br><span class="line">2022-04-21 18:22:30,207 INFO Nodes that can be deleted: [&#x27;data_res2a_branch1_HzQuantize_TransposeInput0&#x27;, &#x27;fc1000_reshape_0&#x27;]</span><br></pre></td></tr></table></figure></div>

<p><em>åœ¨æŒ‡å®š <code>-r</code> é€‰é¡¹åï¼Œå·¥å…·ä¼šæ‰“å°æ¨¡å‹ä¸­è¯¥èŠ‚ç‚¹çš„ç±»å‹ï¼Œå‚¨å­˜åœ¨binæ–‡ä»¶ä¸­çš„èŠ‚ç‚¹ä¿¡æ¯ä»¥åŠå‘ŠçŸ¥æŒ‡å®šèŠ‚ç‚¹å·²è¢«åˆ é™¤ï¼š</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">hb_model_modifier resnet50_64x56x56_featuremap.bin -r data_res2a_branch1_HzQuantize_TransposeInput0</span><br><span class="line">Node &#x27;data_res2a_branch1_HzQuantize_TransposeInput0&#x27; found, its OP type is &#x27;Transpose&#x27;</span><br><span class="line">Node &#x27;data_res2a_branch1_HzQuantize_TransposeInput0&#x27; is removed</span><br><span class="line">modified model saved as resnet50_64x56x56_featuremap_modified.bin</span><br></pre></td></tr></table></figure></div>

<p><em>ä¹‹åå¯ä»¥é€šè¿‡ <code>hb_model_info</code> å·¥å…·æŸ¥çœ‹è¢«åˆ é™¤èŠ‚ç‚¹ä¿¡æ¯ï¼Œè¾“å‡ºä¿¡æ¯æœ«å°¾ä¼šæ‰“å°è¢«åˆ é™¤èŠ‚ç‚¹çš„åç§°ï¼ŒåŒæ—¶ä¼šç”Ÿæˆ <code>deleted_nodes_info.txt</code> æ–‡ä»¶ï¼Œ æ–‡ä»¶ä¸­æ¯ä¸€è¡Œè®°å½•äº†å¯¹åº”è¢«åˆ é™¤èŠ‚ç‚¹çš„åˆå§‹ä¿¡æ¯(æ­¤å¤„ä»…ä¼šè®°å½• Quantizeã€Dequantizeå’ŒTransposeç±»å‹çš„èŠ‚ç‚¹ä¿¡æ¯)ã€‚</em></p>
<p><em>æ‰“å°è¢«åˆ é™¤èŠ‚ç‚¹çš„åç§°æ­¥éª¤å¦‚ä¸‹æ‰€ç¤ºï¼š</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">hb_model_info resnet50_64x56x56_featuremap_modified.bin</span><br><span class="line">Start hb_model_info....</span><br><span class="line">hb_model_info version 1.7.0</span><br><span class="line">********* resnet50_64x56x56_featuremap info *********</span><br><span class="line">...</span><br><span class="line">--------- deleted nodes -------------------</span><br><span class="line">deleted nodes: data_res2a_branch1_HzQuantize_TransposeInput0</span><br></pre></td></tr></table></figure></div>



<blockquote>
<p><em>hb_custom_opå·¥å…·</em></p>
</blockquote>
<p><em>å·¥å…·æ‰“å°ä¿¡æ¯å¦‚ä¸‹ï¼š</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hb_model_modifier resnet50_64x56x56_featuremap.bin</span><br><span class="line">2022-04-21 18:22:30,207 INFO Nodes that can be deleted: [&#x27;data_res2a_branch1_HzQuantize_TransposeInput0&#x27;, &#x27;fc1000_reshape_0&#x27;]</span><br></pre></td></tr></table></figure></div>

<p><em>åœ¨æŒ‡å®š <code>-r</code> é€‰é¡¹åï¼Œå·¥å…·ä¼šæ‰“å°æ¨¡å‹ä¸­è¯¥èŠ‚ç‚¹çš„ç±»å‹ï¼Œå‚¨å­˜åœ¨binæ–‡ä»¶ä¸­çš„èŠ‚ç‚¹ä¿¡æ¯ä»¥åŠå‘ŠçŸ¥æŒ‡å®šèŠ‚ç‚¹å·²è¢«åˆ é™¤ï¼š</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">hb_model_modifier resnet50_64x56x56_featuremap.bin -r data_res2a_branch1_HzQuantize_TransposeInput0</span><br><span class="line">Node &#x27;data_res2a_branch1_HzQuantize_TransposeInput0&#x27; found, its OP type is &#x27;Transpose&#x27;</span><br><span class="line">Node &#x27;data_res2a_branch1_HzQuantize_TransposeInput0&#x27; is removed</span><br><span class="line">modified model saved as resnet50_64x56x56_featuremap_modified.bin</span><br></pre></td></tr></table></figure></div>

<p><em>ä¹‹åå¯ä»¥é€šè¿‡ <code>hb_model_info</code> å·¥å…·æŸ¥çœ‹è¢«åˆ é™¤èŠ‚ç‚¹ä¿¡æ¯ï¼Œè¾“å‡ºä¿¡æ¯æœ«å°¾ä¼šæ‰“å°è¢«åˆ é™¤èŠ‚ç‚¹çš„åç§°ï¼ŒåŒæ—¶ä¼šç”Ÿæˆ <code>deleted_nodes_info.txt</code> æ–‡ä»¶ï¼Œ æ–‡ä»¶ä¸­æ¯ä¸€è¡Œè®°å½•äº†å¯¹åº”è¢«åˆ é™¤èŠ‚ç‚¹çš„åˆå§‹ä¿¡æ¯(æ­¤å¤„ä»…ä¼šè®°å½• Quantizeã€Dequantizeå’ŒTransposeç±»å‹çš„èŠ‚ç‚¹ä¿¡æ¯)ã€‚</em></p>
<p><em>æ‰“å°è¢«åˆ é™¤èŠ‚ç‚¹çš„åç§°æ­¥éª¤å¦‚ä¸‹æ‰€ç¤ºï¼š</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">hb_model_info resnet50_64x56x56_featuremap_modified.bin</span><br><span class="line">Start hb_model_info....</span><br><span class="line">hb_model_info version 1.7.0</span><br><span class="line">********* resnet50_64x56x56_featuremap info *********</span><br><span class="line">...</span><br><span class="line">--------- deleted nodes -------------------</span><br><span class="line">deleted nodes: data_res2a_branch1_HzQuantize_TransposeInput0</span><br></pre></td></tr></table></figure></div>



<p><em><strong>ä½¿ç”¨æ–¹æ³•</strong></em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hb_custom_op COMMAND</span><br></pre></td></tr></table></figure></div>



<p><em><strong>å‘½ä»¤è¡Œå‚æ•°</strong></em></p>
<p><em>hb_custom_opçš„å‘½ä»¤è¡Œå‚æ•°ï¼š</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hb_custom_op create</span><br></pre></td></tr></table></figure></div>

<p><em>è¯¥å‘½ä»¤ä¼šç”Ÿæˆç›¸åº”çš„pythonè‡ªå®šä¹‰OPçš„æ¨¡æ¿æ–‡ä»¶ã€‚</em></p>
<p><em><strong>è¾“å‡ºå†…å®¹è¯´æ˜</strong></em></p>
<p><em><code>hb_custom_op create</code> å‘½ä»¤å°†ä¼šç”Ÿæˆå«æœ‰è‡ªå®šä¹‰OPæ¨¡æ¿çš„pythonæ–‡ä»¶ã€‚</em></p>
<blockquote>
<p><em>hb_eval_preprocess å·¥å…·</em></p>
</blockquote>
<p><em>ç”¨äºå¯¹æ¨¡å‹ç²¾åº¦è¿›è¡Œè¯„ä¼°æ—¶ï¼Œåœ¨x86ç¯å¢ƒä¸‹å¯¹å›¾ç‰‡æ•°æ®è¿›è¡Œé¢„å¤„ç†ã€‚ æ‰€è°“é¢„å¤„ç†æ˜¯æŒ‡å›¾ç‰‡æ•°æ®åœ¨é€å…¥æ¨¡å‹ä¹‹å‰çš„ç‰¹å®šå¤„ç†æ“ä½œã€‚ æ¯”å¦‚ï¼šå›¾ç‰‡resizeã€cropå’Œpaddingç­‰ã€‚</em></p>
<p><em><strong>ä½¿ç”¨æ–¹æ³•</strong></em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hb_eval_preprocess [OPTIONS]</span><br></pre></td></tr></table></figure></div>

<p><em><strong>å‘½ä»¤è¡Œå‚æ•°</strong></em></p>
<p><em>hb_eval_preprocessçš„å‘½ä»¤è¡Œå‚æ•°ï¼š</em></p>
<ul>
<li><p><em>â€“version</em></p>
<p><em>æ˜¾ç¤ºç‰ˆæœ¬å¹¶é€€å‡ºã€‚</em></p>
</li>
<li><p><em>-m, â€“model_name</em></p>
<p><em>è®¾ç½®æ¨¡å‹åç§°ï¼Œæ”¯æŒçš„æ¨¡å‹èŒƒå›´å¯é€šè¿‡ <code>hb_eval_preprocess --help</code> æŸ¥çœ‹ã€‚</em></p>
</li>
<li><p><em>-i, â€“image_dir</em></p>
<p><em>è¾“å…¥å›¾ç‰‡è·¯å¾„ã€‚</em></p>
</li>
<li><p><em>-o, â€“output_dir</em></p>
<p><em>è¾“å‡ºè·¯å¾„ã€‚</em></p>
</li>
<li><p><em>-v, â€“val_txt</em></p>
<p><em>è®¾ç½®è¯„æµ‹æ‰€éœ€å›¾ç‰‡çš„æ–‡ä»¶åç§°ï¼Œé¢„å¤„ç†ç”Ÿæˆçš„å›¾ç‰‡å°†ä¸æ­¤æ–‡ä»¶ä¸­çš„å›¾ç‰‡åç§°å¯¹åº”ã€‚</em></p>
</li>
<li><p><em>-h, â€“help</em></p>
<p><em>æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯ã€‚</em></p>
</li>
</ul>
<p><em><strong>è¾“å‡ºå†…å®¹è¯´æ˜</strong></em></p>
<p><em><code>hb_eval_preprocess</code> å‘½ä»¤å°†ä¼šåœ¨ <code>--output_dir</code> æŒ‡å®šçš„è·¯å¾„ä¸‹ç”Ÿæˆå›¾ç‰‡äºŒè¿›åˆ¶æ–‡ä»¶ã€‚</em></p>
<p><em>æ›´å¤šå…³äº <code>hb_eval_preprocess</code> å·¥å…·åœ¨ä¸Šæ¿æ¨¡å‹ç²¾åº¦è¯„ä¼°ä¸­çš„åº”ç”¨ç¤ºä¾‹è¯·å‚è§ <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/runtime/source/ai_benchmark/source/ai-benchmark.html#data-preprocess" >æ•°æ®é¢„å¤„ç† <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ä¸€èŠ‚å†…å®¹ã€‚</em></p>
<blockquote>
<p><em>ç²¾åº¦debugå·¥å…·</em></p>
</blockquote>
<p><em>æ¨¡å‹è½¬æ¢å·¥å…·é“¾ä¼šåŸºäºæ‚¨æä¾›çš„æ ¡å‡†æ ·æœ¬å¯¹æ¨¡å‹è¿›è¡Œæ ¡å‡†é‡åŒ–å¹¶ä¿éšœæ¨¡å‹é«˜æ•ˆçš„éƒ¨ç½²åœ¨åœ°å¹³çº¿èŠ¯ç‰‡ä¸Šã€‚ è€Œåœ¨æ¨¡å‹è½¬æ¢çš„è¿‡ç¨‹ä¸­ï¼Œéš¾å…ä¼šå› ä¸ºæµ®ç‚¹åˆ°å®šç‚¹çš„é‡åŒ–è¿‡ç¨‹è€Œå¼•å…¥ç²¾åº¦æŸå¤±ï¼Œé€šå¸¸æƒ…å†µä¸‹é€ æˆç²¾åº¦æŸå¤±çš„ä¸»è¦åŸå› å¯èƒ½æœ‰ä»¥ä¸‹å‡ ç‚¹ï¼š</em></p>
<p><em>1.æ¨¡å‹ä¸­çš„ä¸€éƒ¨åˆ†èŠ‚ç‚¹å¯¹é‡åŒ–æ¯”è¾ƒæ•æ„Ÿä¼šå¼•å…¥è¾ƒå¤§è¯¯å·®ï¼Œå³æ•æ„ŸèŠ‚ç‚¹é‡åŒ–é—®é¢˜ã€‚</em></p>
<p><em>2.æ¨¡å‹ä¸­å„ä¸ªèŠ‚ç‚¹çš„è¯¯å·®ç´¯ç§¯å¯¼è‡´æ¨¡å‹æ•´ä½“å‡ºç°è¾ƒå¤§çš„æ ¡å‡†è¯¯å·®ï¼Œä¸»è¦åŒ…å«ï¼šæƒé‡é‡åŒ–å¯¼è‡´çš„è¯¯å·®ç´¯ç§¯ã€æ¿€æ´»é‡åŒ–å¯¼è‡´çš„è¯¯å·®ç´¯ç§¯ä»¥åŠå…¨é‡é‡åŒ–å¯¼è‡´çš„è¯¯å·®ç´¯ç§¯ã€‚</em></p>
<p><em>é’ˆå¯¹è¯¥æƒ…å†µï¼Œåœ°å¹³çº¿æä¾›äº†ç²¾åº¦debugå·¥å…·ç”¨ä»¥ååŠ©æ‚¨è‡ªä¸»å®šä½æ¨¡å‹é‡åŒ–è¿‡ç¨‹ä¸­äº§ç”Ÿçš„ç²¾åº¦é—®é¢˜ã€‚ è¯¥å·¥å…·èƒ½å¤ŸååŠ©æ‚¨å¯¹æ ¡å‡†æ¨¡å‹è¿›è¡ŒèŠ‚ç‚¹ç²’åº¦çš„é‡åŒ–è¯¯å·®åˆ†æï¼Œæœ€ç»ˆå¸®åŠ©æ‚¨å¿«é€Ÿå®šä½å‡ºç°ç²¾åº¦å¼‚å¸¸çš„èŠ‚ç‚¹ã€‚</em></p>
<p><em>ç²¾åº¦debugå·¥å…·æä¾›å¤šç§åˆ†æåŠŸèƒ½ä¾›æ‚¨ä½¿ç”¨ï¼Œä¾‹å¦‚ï¼š</em></p>
<ul>
<li><em>è·å–èŠ‚ç‚¹é‡åŒ–æ•æ„Ÿåº¦ã€‚</em></li>
<li><em>è·å–æ¨¡å‹ç´¯ç§¯è¯¯å·®æ›²çº¿ã€‚</em></li>
<li><em>è·å–æŒ‡å®šèŠ‚ç‚¹çš„æ•°æ®åˆ†å¸ƒã€‚</em></li>
<li><em>è·å–æŒ‡å®šèŠ‚ç‚¹è¾“å…¥æ•°æ®é€šé“é—´æ•°æ®åˆ†å¸ƒç®±çº¿å›¾ç­‰ã€‚</em></li>
</ul>
<p><em><strong>å¿«é€Ÿä¸Šæ‰‹</strong></em></p>
<p><em>ä½¿ç”¨ç²¾åº¦debugå·¥å…·ä¸»è¦æœ‰ä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š</em></p>
<p><em>1.åœ¨yamlä¸­é…ç½®å‚æ•° <code>debug_mode=&quot;dump_calibration_data&quot;</code> ï¼Œä¿å­˜æ ¡å‡†æ¨¡å‹ä¸æ ¡å‡†æ•°æ®ã€‚</em></p>
<p><em>2.å¯¼å…¥debugæ¨¡å—ï¼ŒåŠ è½½æ ¡å‡†æ¨¡å‹å’Œæ•°æ®ã€‚</em></p>
<p><em>3.é€šè¿‡ç²¾åº¦debugå·¥å…·æä¾›çš„APIï¼Œå¯¹ç²¾åº¦æŸå¤±æ˜æ˜¾çš„æ¨¡å‹è¿›è¡Œåˆ†æã€‚</em></p>
<p><em>æ•´ä½“æµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</em></p>
<p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230511151319223.png"
                      class="" title="image-20230511151319223"
                ></em></p>
<ul>
<li><em><strong>æ ¡å‡†æ¨¡å‹ä¸æ•°æ®çš„ä¿å­˜</strong></em></li>
</ul>
<p><em>é¦–å…ˆéœ€è¦åœ¨yamlæ–‡ä»¶ä¸­é…ç½® <code>debug_mode=&quot;dump_calibration_data&quot;</code> ï¼Œä»¥å¼€å¯ç²¾åº¦debugåŠŸèƒ½ï¼Œ ä¿å­˜æ ¡å‡†æ¨¡å‹(calibrated_model.onnx)å’Œå¯¹åº”çš„æ ¡å‡†æ•°æ®(calibration_data)ã€‚å…¶ä¸­ï¼š</em></p>
<ul>
<li><em>æ ¡å‡†æ•°æ®(calibration_data)ï¼šåœ¨æ ¡å‡†é˜¶æ®µï¼Œæ¨¡å‹é€šè¿‡å¯¹è¿™äº›æ•°æ®è¿›è¡Œå‰å‘æ¨ç†æ¥è·å–æ¯ä¸ªè¢«é‡åŒ–èŠ‚ç‚¹çš„é‡åŒ–å‚æ•°ï¼ŒåŒ…æ‹¬ï¼šç¼©æ”¾å› å­(scale)å’Œé˜ˆå€¼(threshold)ã€‚</em></li>
<li><em>æ ¡å‡†æ¨¡å‹(calibrated_model.onnx)ï¼šå°†åœ¨æ ¡å‡†é˜¶æ®µè®¡ç®—å¾—åˆ°çš„æ¯ä¸ªè¢«é‡åŒ–èŠ‚ç‚¹çš„é‡åŒ–å‚æ•°ä¿å­˜åœ¨æ ¡å‡†èŠ‚ç‚¹ä¸­ï¼Œä»è€Œå¾—åˆ°æ ¡å‡†æ¨¡å‹ã€‚</em></li>
</ul>
<p><em><strong>æ­¤å¤„ä¿å­˜çš„æ ¡å‡†æ•°æ®ä¸02_preprocess.shç”Ÿæˆçš„æ ¡å‡†æ•°æ®çš„åŒºåˆ«ï¼Ÿ</strong></em></p>
<p><em><code>02_preprocess.sh</code> å¾—åˆ°çš„æ ¡å‡†æ•°æ®æ˜¯bgré¢œè‰²ç©ºé—´çš„æ•°æ®ï¼Œ<strong>åœ¨å·¥å…·é“¾å†…éƒ¨ä¼šå°†æ•°æ®ä»bgrè½¬æ¢åˆ°yuv444&#x2F;grayç­‰æ¨¡å‹å®é™…è¾“å…¥çš„æ ¼å¼ï¼ˆè½¬æ¢ï¼‰</strong>ã€‚ è€Œæ­¤å¤„ä¿å­˜çš„æ ¡å‡†æ•°æ®åˆ™æ˜¯ç»è¿‡é¢œè‰²ç©ºé—´è½¬æ¢ä»¥åŠé¢„å¤„ç†ä¹‹åä¿å­˜çš„.npyæ ¼å¼çš„æ•°æ®ï¼Œ<strong>è¯¥æ•°æ®å¯ä»¥é€šè¿‡np.load()ç›´æ¥é€å…¥æ¨¡å‹è¿›è¡Œæ¨ç†ã€‚</strong></em></p>
<p><em><strong>æ ¡å‡†æ¨¡å‹(calibrated_model.onnx)è§£è¯»</strong></em></p>
<p><em>æ ¡å‡†æ¨¡å‹æ˜¯æ¨¡å‹è½¬æ¢å·¥å…·é“¾å°†æµ®ç‚¹æ¨¡å‹ç»è¿‡ç»“æ„ä¼˜åŒ–åï¼Œé€šè¿‡æ ¡å‡†æ•°æ®è®¡ç®—å¾—åˆ°çš„æ¯ä¸ªèŠ‚ç‚¹å¯¹åº”çš„é‡åŒ–å‚æ•°å¹¶å°†å…¶ä¿å­˜åœ¨æ ¡å‡†èŠ‚ç‚¹ä¸­å¾—åˆ°çš„ä¸­é—´äº§ç‰©ã€‚ æ ¡å‡†æ¨¡å‹çš„ä¸»è¦ç‰¹ç‚¹æ˜¯æ¨¡å‹ä¸­åŒ…å«æ ¡å‡†èŠ‚ç‚¹ï¼Œæ ¡å‡†èŠ‚ç‚¹çš„èŠ‚ç‚¹ç±»å‹ä¸ºHzCalibrationã€‚ è¿™äº›æ ¡å‡†èŠ‚ç‚¹ä¸»è¦åˆ†ä¸ºä¸¤ç±»ï¼š <strong>æ¿€æ´»(activation)æ ¡å‡†èŠ‚ç‚¹</strong> å’Œ <strong>æƒé‡(weight)æ ¡å‡†èŠ‚ç‚¹</strong> ã€‚</em></p>
<p><em><strong>æ¿€æ´»æ ¡å‡†èŠ‚ç‚¹</strong> çš„è¾“å…¥æ˜¯å½“å‰èŠ‚ç‚¹çš„ä¸Šä¸€ä¸ªèŠ‚ç‚¹çš„è¾“å‡ºï¼Œå¹¶åŸºäºå½“å‰æ¿€æ´»æ ¡å‡†èŠ‚ç‚¹ä¸­ä¿å­˜çš„é‡åŒ–å‚æ•°(scaleså’Œthresholds)å¯¹è¾“å…¥æ•°æ®è¿›è¡Œé‡åŒ–åŠåé‡åŒ–åè¾“å‡ºã€‚</em></p>
<p><em><strong>æƒé‡æ ¡å‡†èŠ‚ç‚¹</strong> çš„è¾“å…¥ä¸ºæ¨¡å‹çš„åŸå§‹æµ®ç‚¹æƒé‡ï¼ŒåŸºäºå½“å‰æƒé‡æ ¡å‡†èŠ‚ç‚¹ä¸­ä¿å­˜çš„é‡åŒ–å‚æ•°(scaleså’Œthresholds)å¯¹è¾“å…¥çš„åŸå§‹æµ®ç‚¹æƒé‡è¿›è¡Œé‡åŒ–åŠåé‡åŒ–åè¾“å‡ºã€‚</em></p>
<p><em>é™¤å´ä¸Šè¿°çš„æ ¡å‡†èŠ‚ç‚¹ï¼Œæ ¡å‡†æ¨¡å‹ä¸­çš„å…¶ä»–èŠ‚ç‚¹ï¼Œç²¾åº¦debugå·¥å…·å°†å…¶ç§°ä¸º <strong>æ™®é€šèŠ‚ç‚¹(node)</strong> ã€‚ <strong>æ™®é€šèŠ‚ç‚¹</strong> çš„ç±»å‹åŒ…æ‹¬ï¼šConvã€Mulã€Addç­‰ã€‚</em></p>
<p><em><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230511152328296.png"
                      class="" title="image-20230511152328296"
                ></em></p>
<p><em>calibration_dataçš„æ–‡ä»¶å¤¹ç»“æ„å¦‚ä¸‹ï¼š</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">|--calibration_data ï¼šæ ¡å‡†æ•°æ®</span><br><span class="line">|----input.1 ï¼šæ–‡ä»¶å¤¹åä¸ºæ¨¡å‹çš„è¾“å…¥èŠ‚ç‚¹å¹¶ä¿å­˜å¯¹åº”çš„è¾“å…¥æ•°æ®</span><br><span class="line">|--------0.npy</span><br><span class="line">|--------1.npy</span><br><span class="line">|-------- ...</span><br><span class="line">|----input.2 ï¼šå¯¹äºå¤šè¾“å…¥æ¨¡å‹å°†ä¿å­˜å¤šä¸ªæ–‡ä»¶å¤¹</span><br><span class="line">|--------0.npy</span><br><span class="line">|--------1.npy</span><br><span class="line">|-------- ...</span><br></pre></td></tr></table></figure></div>



<ul>
<li><em><strong>ç²¾åº¦debugæ¨¡å—å¯¼å…¥ä¸APIä½¿ç”¨</strong></em></li>
</ul>
<p><em>æ¥ä¸‹æ¥éœ€è¦åœ¨ä»£ç ä¸­å¯¼å…¥debugæ¨¡å—ï¼Œå¹¶é€šè¿‡ <code>get_sensitivity_of_nodes</code> æ¥å£è·å–èŠ‚ç‚¹é‡åŒ–æ•æ„Ÿåº¦ï¼ˆé»˜è®¤ä½¿ç”¨æ¨¡å‹è¾“å‡ºçš„ä½™å¼¦ç›¸ä¼¼åº¦ï¼‰ã€‚ <code>get_sensitivity_of_nodes</code> çš„è¯¦ç»†å‚æ•°è¯´æ˜å¯è§ <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/ptq/ptq_tool/accuracy_debug.html#get-sensitivity-of-nodes" >get_sensitivity_of_nodes <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ç« èŠ‚ã€‚</em></p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¯¼å…¥debugæ¨¡å—</span></span><br><span class="line"><span class="keyword">import</span> horizon_nn.debug <span class="keyword">as</span> dbg</span><br><span class="line"><span class="comment"># å¯¼å…¥logæ—¥å¿—æ¨¡å—</span></span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"></span><br><span class="line"><span class="comment"># è‹¥verbose=Trueæ—¶ï¼Œéœ€è¦å…ˆè®¾ç½®log levelä¸ºINFO</span></span><br><span class="line">logging.getLogger().setLevel(logging.INFO)</span><br><span class="line"><span class="comment"># è·å–èŠ‚ç‚¹é‡åŒ–æ•æ„Ÿåº¦</span></span><br><span class="line">node_message = dbg.get_sensitivity_of_nodes(</span><br><span class="line">        model_or_file=<span class="string">&#x27;./calibrated_model.onnx&#x27;</span>,</span><br><span class="line">        metrics=[<span class="string">&#x27;cosine-similarity&#x27;</span>, <span class="string">&#x27;mse&#x27;</span>],</span><br><span class="line">        calibrated_data=<span class="string">&#x27;./calibration_data/&#x27;</span>,</span><br><span class="line">        output_node=<span class="literal">None</span>,</span><br><span class="line">        node_type=<span class="string">&#x27;node&#x27;</span>,</span><br><span class="line">        data_num=<span class="literal">None</span>,</span><br><span class="line">        verbose=<span class="literal">True</span>,</span><br><span class="line">        interested_nodes=<span class="literal">None</span>)</span><br></pre></td></tr></table></figure></div>



<ul>
<li><em><strong>åˆ†æç»“æœå±•ç¤º</strong></em></li>
</ul>
<p><em>ä¸‹æ–¹ä¸º <code>verbose=True</code> æ—¶çš„æ‰“å°ç»“æœï¼š</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">==========================node==========================</span><br><span class="line">Node        cosine-similarity   mse</span><br><span class="line">--------------------------------------------------------</span><br><span class="line">Conv_3      0.999009567957658   0.027825591154396534</span><br><span class="line">MaxPool_2   0.9993462241612948  0.017706592209064044</span><br><span class="line">Conv_6      0.9998359175828787  0.004541242333988731</span><br><span class="line">MaxPool_5   0.9998616805443397  0.0038416787014844325</span><br><span class="line">Conv_0      0.9999297948984     0.0019312848587735342</span><br><span class="line">Gemm_19     0.9999609772975628  0.0010773885699633795</span><br><span class="line">Conv_8      0.9999629625907311  0.0010301886404004807</span><br><span class="line">Gemm_15     0.9999847687207736  0.00041888411550854263</span><br><span class="line">MaxPool_12  0.9999853235024673  0.0004039733791544747</span><br><span class="line">Conv_10     0.999985763659844   0.0004040437432614943</span><br><span class="line">Gemm_17     0.9999913985912616  0.0002379088904350423</span><br></pre></td></tr></table></figure></div>

<p><em>é™¤æ­¤ä¹‹å¤–ï¼Œè¯¥APIä¼šä»¥å­—å…¸(Dict)çš„å½¢å¼å°†èŠ‚ç‚¹é‡åŒ–æ•æ„Ÿåº¦ä¿¡æ¯è¿”å›ç»™æ‚¨ä»¥ä¾›åç»­ä½¿ç”¨åˆ†æã€‚</em></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Out:</span><br><span class="line">&#123;&#x27;Conv_3&#x27;: &#123;&#x27;cosine-similarity&#x27;: &#x27;0.999009567957658&#x27;, &#x27;mse&#x27;: &#x27;0.027825591154396534&#x27;&#125;,</span><br><span class="line"> &#x27;MaxPool_2&#x27;: &#123;&#x27;cosine-similarity&#x27;: &#x27;0.9993462241612948&#x27;, &#x27;mse&#x27;: &#x27;0.017706592209064044&#x27;&#125;,</span><br><span class="line"> &#x27;Conv_6&#x27;: &#123;&#x27;cosine-similarity&#x27;: &#x27;0.9998359175828787&#x27;, &#x27;mse&#x27;: &#x27;0.004541242333988731&#x27;&#125;,</span><br><span class="line"> &#x27;MaxPool_5&#x27;: &#123;&#x27;cosine-similarity&#x27;: &#x27;0.9998616805443397&#x27;, &#x27;mse&#x27;: &#x27;0.0038416787014844325&#x27;&#125;,</span><br><span class="line"> &#x27;Conv_0&#x27;: &#123;&#x27;cosine-similarity&#x27;: &#x27;0.9999297948984&#x27;, &#x27;mse&#x27;: &#x27;0.0019312848587735342&#x27;&#125;,</span><br><span class="line"> &#x27;Gemm_19&#x27;: &#123;&#x27;cosine-similarity&#x27;: &#x27;0.9999609772975628&#x27;, &#x27;mse&#x27;: &#x27;0.0010773885699633795&#x27;&#125;,</span><br><span class="line"> &#x27;Conv_8&#x27;: &#123;&#x27;cosine-similarity&#x27;: &#x27;0.9999629625907311&#x27;, &#x27;mse&#x27;: &#x27;0.0010301886404004807&#x27;&#125;,</span><br><span class="line"> &#x27;Gemm_15&#x27;: &#123;&#x27;cosine-similarity&#x27;: &#x27;0.9999847687207736&#x27;, &#x27;mse&#x27;: &#x27;0.00041888411550854263&#x27;&#125;,</span><br><span class="line"> &#x27;MaxPool_12&#x27;: &#123;&#x27;cosine-similarity&#x27;: &#x27;0.9999853235024673&#x27;, &#x27;mse&#x27;: &#x27;0.0004039733791544747&#x27;&#125;,</span><br><span class="line"> &#x27;Conv_10&#x27;: &#123;&#x27;cosine-similarity&#x27;: &#x27;0.999985763659844&#x27;, &#x27;mse&#x27;: &#x27;0.0004040437432614943&#x27;&#125;,</span><br><span class="line"> &#x27;Gemm_17&#x27;: &#123;&#x27;cosine-similarity&#x27;: &#x27;0.9999913985912616&#x27;, &#x27;mse&#x27;: &#x27;0.0002379088904350423&#x27;&#125;&#125;</span><br></pre></td></tr></table></figure></div>

<p><em>æ›´å¤šåŠŸèƒ½è¯¦è§ <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/ptq/ptq_tool/accuracy_debug.html#debug-api" >APIè¯´æ˜æ–‡æ¡£ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ç« èŠ‚ã€‚</em></p>
<p><strong>APIè¯´æ˜æ–‡æ¡£</strong></p>
<ul>
<li><strong>get_sensitivity_of_nodes</strong>ï¼šè·å–èŠ‚ç‚¹é‡åŒ–æ•æ„Ÿåº¦</li>
</ul>
<p><strong>APIå‚æ•°ç»„</strong>ï¼š</p>
<table>
<thead>
<tr>
<th align="left">ç¼– å·</th>
<th align="left">å‚æ•°åç§°</th>
<th align="left">å‚æ•°é…ç½®è¯´æ˜</th>
<th align="left">å¯é€‰&#x2F;å¿…é€‰</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left"><code>model_or_file</code></td>
<td align="left"><strong>å‚æ•°ä½œç”¨</strong>ï¼šæŒ‡å®šæ ¡å‡†æ¨¡å‹ã€‚<strong>å–å€¼èŒƒå›´</strong>ï¼šæ— ã€‚<strong>é»˜è®¤é…ç½®</strong>ï¼šæ— ã€‚<strong>å‚æ•°è¯´æ˜</strong>ï¼šå¿…é€‰ï¼ŒæŒ‡å®šéœ€è¦åˆ†æçš„æ ¡å‡†æ¨¡å‹ã€‚</td>
<td align="left">å¿…é€‰</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left"><code>metrics</code></td>
<td align="left"><strong>å‚æ•°ä½œç”¨</strong>ï¼šèŠ‚ç‚¹é‡åŒ–æ•æ„Ÿåº¦çš„åº¦é‡æ–¹å¼ã€‚<strong>å–å€¼èŒƒå›´</strong>ï¼š<code>&#39;cosine-similarity&#39;</code> , <code>&#39;mse&#39;</code> , <code>&#39;mre&#39;</code> , <code>&#39;sqnr&#39;</code> , <code>&#39;chebyshev&#39;</code> ã€‚<strong>é»˜è®¤é…ç½®</strong>ï¼š<code>&#39;cosine-similarity&#39;</code>ã€‚<strong>å‚æ•°è¯´æ˜</strong>ï¼šæŒ‡å®šèŠ‚ç‚¹é‡åŒ–æ•æ„Ÿåº¦çš„è®¡ç®—æ–¹å¼ï¼Œè¯¥å‚æ•°å¯ä»¥ä¸ºåˆ—è¡¨(List)ï¼Œ å³ä»¥å¤šç§æ–¹å¼è®¡ç®—é‡åŒ–æ•æ„Ÿåº¦ï¼Œ ä½†æ˜¯è¾“å‡ºç»“æœä»…ä»¥åˆ—è¡¨ä¸­ç¬¬ä¸€ä½çš„è®¡ç®—æ–¹å¼è¿›è¡Œæ’åºï¼Œ æ’åè¶Šé å‰è¯´æ˜é‡åŒ–è¯¥èŠ‚ç‚¹å¼•å…¥çš„è¯¯å·®è¶Šå¤§ã€‚</td>
<td align="left">å¯é€‰</td>
</tr>
<tr>
<td align="left">3</td>
<td align="left"><code>calibrated_data</code></td>
<td align="left"><strong>å‚æ•°ä½œç”¨</strong>ï¼šæŒ‡å®šæ ¡å‡†æ•°æ®ã€‚<strong>å–å€¼èŒƒå›´</strong>ï¼šæ— ã€‚<strong>é»˜è®¤é…ç½®</strong>ï¼šæ— ã€‚<strong>å‚æ•°è¯´æ˜</strong>ï¼šå¿…é€‰ï¼ŒæŒ‡å®šåˆ†ææ‰€éœ€è¦çš„æ ¡å‡†æ•°æ®ã€‚</td>
<td align="left">å¿…é€‰</td>
</tr>
<tr>
<td align="left">4</td>
<td align="left"><code>output_node</code></td>
<td align="left"><strong>å‚æ•°ä½œç”¨</strong>ï¼šæŒ‡å®šè¾“å‡ºèŠ‚ç‚¹ã€‚<strong>å–å€¼èŒƒå›´</strong>ï¼šæ ¡å‡†æ¨¡å‹ä¸­çš„å…·æœ‰å¯¹åº”æ ¡å‡†èŠ‚ç‚¹çš„æ™®é€šèŠ‚ç‚¹ã€‚<strong>é»˜è®¤é…ç½®</strong>ï¼šNoneã€‚<strong>å‚æ•°è¯´æ˜ï¼šæ­¤å‚æ•°æ”¯æŒæ‚¨æŒ‡å®šä¸­é—´èŠ‚ç‚¹ä½œä¸ºè¾“å‡ºå¹¶è®¡ç®—èŠ‚ç‚¹é‡åŒ–æ•æ„Ÿåº¦ã€‚</strong> <strong>è‹¥ä¿æŒé»˜è®¤å‚æ•°Noneï¼Œåˆ™ç²¾åº¦debugå·¥å…·ä¼šè·å–æ¨¡å‹çš„æœ€ç»ˆè¾“å‡º</strong> <strong>å¹¶åœ¨æ­¤åŸºç¡€ä¸Šè®¡ç®—èŠ‚ç‚¹çš„é‡åŒ–æ•æ„Ÿåº¦ã€‚</strong></td>
<td align="left">å¯é€‰</td>
</tr>
<tr>
<td align="left">5</td>
<td align="left"><code>node_type</code></td>
<td align="left"><strong>å‚æ•°ä½œç”¨</strong>ï¼šèŠ‚ç‚¹ç±»å‹ã€‚<strong>å–å€¼èŒƒå›´</strong>ï¼š<code>&#39;node&#39;</code> , <code>&#39;weight&#39;</code> , <code>&#39;activation&#39;</code>ã€‚<strong>é»˜è®¤é…ç½®</strong>ï¼š<code>&#39;node&#39;</code>ã€‚<strong>å‚æ•°è¯´æ˜</strong>ï¼šéœ€è¦è®¡ç®—é‡åŒ–æ•æ„Ÿåº¦çš„èŠ‚ç‚¹ç±»å‹ï¼ŒåŒ…æ‹¬ï¼šnodeï¼ˆæ™®é€šèŠ‚ç‚¹ï¼‰ã€ weightï¼ˆæƒé‡æ ¡å‡†èŠ‚ç‚¹ï¼‰ã€activationï¼ˆæ¿€æ´»æ ¡å‡†èŠ‚ç‚¹ï¼‰ã€‚</td>
<td align="left">å¯é€‰</td>
</tr>
<tr>
<td align="left">6</td>
<td align="left"><code>data_num</code></td>
<td align="left"><strong>å‚æ•°ä½œç”¨</strong>ï¼šè®¡ç®—é‡åŒ–æ•æ„Ÿåº¦éœ€è¦çš„æ•°æ®æ•°é‡ã€‚<strong>å–å€¼èŒƒå›´</strong>ï¼šå¤§äº0ï¼Œå°äºç­‰äºcalibration_dataä¸­æ•°æ®çš„æ€»æ•°ã€‚<strong>é»˜è®¤é…ç½®</strong>ï¼šNone<strong>å‚æ•°è¯´æ˜</strong>ï¼šè®¾ç½®è®¡ç®—èŠ‚ç‚¹é‡åŒ–æ•æ„Ÿåº¦æ—¶æ‰€éœ€è¦çš„æ•°æ®æ•°é‡ã€‚ é»˜è®¤ä¸ºNoneï¼Œæ­¤æ—¶é»˜è®¤ä½¿ç”¨calibration_dataä¸­çš„æ‰€æœ‰æ•°æ®è¿›è¡Œè®¡ç®—ã€‚ æœ€å°è®¾ç½®ä¸º1ï¼Œæœ€å¤§ä¸º calibration_dataä¸­çš„æ•°æ®æ•°é‡ã€‚</td>
<td align="left">å¯é€‰</td>
</tr>
<tr>
<td align="left">7</td>
<td align="left"><code>verbose</code></td>
<td align="left"><strong>å‚æ•°ä½œç”¨</strong>ï¼šé€‰æ‹©æ˜¯å¦å°†ä¿¡æ¯æ‰“å°åœ¨ç»ˆç«¯ä¸Šã€‚<strong>å–å€¼èŒƒå›´</strong>ï¼š<code>True</code> ã€ <code>False</code>ã€‚<strong>é»˜è®¤é…ç½®</strong>ï¼š<code>False</code>ã€‚<strong>å‚æ•°è¯´æ˜</strong>ï¼šè‹¥ä¸ºTrueï¼Œåˆ™å°†é‡åŒ–æ•æ„Ÿåº¦ä¿¡æ¯æ‰“å°åœ¨ç»ˆç«¯ä¸Šã€‚ è‹¥metricsåŒ…å«å¤šç§åº¦é‡æ–¹å¼ï¼Œåˆ™æŒ‰ç…§ç¬¬ä¸€ä½è¿›è¡Œæ’åºã€‚</td>
<td align="left">å¯é€‰</td>
</tr>
<tr>
<td align="left">8</td>
<td align="left"><code>interested_nodes</code></td>
<td align="left"><strong>å‚æ•°ä½œç”¨</strong>ï¼šè®¾ç½®æ„Ÿå…´è¶£èŠ‚ç‚¹ã€‚<strong>å–å€¼èŒƒå›´</strong>ï¼šæ ¡å‡†æ¨¡å‹ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹ã€‚<strong>é»˜è®¤é…ç½®</strong>ï¼šNoneã€‚<strong>å‚æ•°è¯´æ˜</strong>ï¼šè‹¥æŒ‡å®šåˆ™åªè·å–è¯¥èŠ‚ç‚¹çš„é‡åŒ–æ•æ„Ÿåº¦ï¼Œå…¶ä½™èŠ‚ç‚¹ä¸è·å–ã€‚ åŒæ—¶ï¼Œè‹¥è¯¥å‚æ•°è¢«æŒ‡å®šï¼Œå°†å¿½è§†node_typeæŒ‡å®šçš„èŠ‚ç‚¹ç±»å‹ï¼Œ ä¹Ÿå°±æ˜¯è¯´è¯¥å‚æ•°çš„ä¼˜å…ˆçº§è¦é«˜äºnode_typeã€‚ è‹¥ä¿æŒé»˜è®¤å‚æ•°Noneï¼Œåˆ™è®¡ç®—æ¨¡å‹ä¸­æ‰€æœ‰å¯è¢«é‡åŒ–èŠ‚ç‚¹çš„é‡åŒ–æ•æ„Ÿåº¦ã€‚</td>
<td align="left">å¯é€‰</td>
</tr>
</tbody></table>
<p><strong>APIåˆ†æç»“æœå±•ç¤º</strong>ï¼š</p>
<p><strong>æè¿°</strong>ï¼šé¦–å…ˆæ‚¨é€šè¿‡node_typeè®¾ç½®éœ€è¦è®¡ç®—æ•æ„Ÿåº¦çš„èŠ‚ç‚¹ç±»å‹ï¼Œç„¶åå·¥å…·è·å–æ ¡å‡†æ¨¡å‹ä¸­æ‰€æœ‰ç¬¦åˆnode_typeçš„èŠ‚ç‚¹ï¼Œå¹¶è·å–è¿™äº›èŠ‚ç‚¹çš„é‡åŒ–æ•æ„Ÿåº¦ã€‚ å½“verboseè®¾ç½®ä¸ºTrueæ—¶ï¼Œå·¥å…·ä¼šå°†èŠ‚ç‚¹é‡åŒ–æ•æ„Ÿåº¦è¿›è¡Œæ’åºåæ‰“å°åœ¨ç»ˆç«¯ï¼Œæ’åºè¶Šé å‰ï¼Œè¯´æ˜è¯¥èŠ‚ç‚¹é‡åŒ–å¼•å…¥çš„é‡åŒ–è¯¯å·®è¶Šå¤§ã€‚</p>
<p>verbose&#x3D;Trueæ—¶ï¼Œæ‰“å°ç»“æœå¦‚ä¸‹ï¼š</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">==========================node==========================</span><br><span class="line">Node        cosine-similarity   mse</span><br><span class="line">--------------------------------------------------------</span><br><span class="line">Conv_3      0.999009567957658   0.027825591154396534</span><br><span class="line">MaxPool_2   0.9993462241612948  0.017706592209064044</span><br><span class="line">Conv_6      0.9998359175828787  0.004541242333988731</span><br><span class="line">MaxPool_5   0.9998616805443397  0.0038416787014844325</span><br><span class="line">Conv_0      0.9999297948984     0.0019312848587735342</span><br><span class="line">Gemm_19     0.9999609772975628  0.0010773885699633795</span><br><span class="line">Conv_8      0.9999629625907311  0.0010301886404004807</span><br><span class="line">Gemm_15     0.9999847687207736  0.00041888411550854263</span><br><span class="line">MaxPool_12  0.9999853235024673  0.0004039733791544747</span><br><span class="line">Conv_10     0.999985763659844   0.0004040437432614943</span><br><span class="line">Gemm_17     0.9999913985912616  0.0002379088904350423</span><br></pre></td></tr></table></figure></div>

<p>å‡½æ•°è¿”å›å€¼ï¼š</p>
<p>å‡½æ•°è¿”å›å€¼ä¸ºä»¥å­—å…¸æ ¼å¼ï¼ˆKeyä¸ºèŠ‚ç‚¹åç§°ï¼ŒValueä¸ºèŠ‚ç‚¹çš„é‡åŒ–æ•æ„Ÿåº¦ä¿¡æ¯ï¼‰ä¿å­˜çš„é‡åŒ–æ•æ„Ÿåº¦ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Out:</span><br><span class="line">&#123;&#x27;Conv_3&#x27;: &#123;&#x27;cosine-similarity&#x27;: &#x27;0.999009567957658&#x27;, &#x27;mse&#x27;: &#x27;0.027825591154396534&#x27;&#125;,</span><br><span class="line"> &#x27;MaxPool_2&#x27;: &#123;&#x27;cosine-similarity&#x27;: &#x27;0.9993462241612948&#x27;, &#x27;mse&#x27;: &#x27;0.017706592209064044&#x27;&#125;,</span><br><span class="line"> &#x27;Conv_6&#x27;: &#123;&#x27;cosine-similarity&#x27;: &#x27;0.9998359175828787&#x27;, &#x27;mse&#x27;: &#x27;0.004541242333988731&#x27;&#125;,</span><br><span class="line"> &#x27;MaxPool_5&#x27;: &#123;&#x27;cosine-similarity&#x27;: &#x27;0.9998616805443397&#x27;, &#x27;mse&#x27;: &#x27;0.0038416787014844325&#x27;&#125;,</span><br><span class="line"> &#x27;Conv_0&#x27;: &#123;&#x27;cosine-similarity&#x27;: &#x27;0.9999297948984&#x27;, &#x27;mse&#x27;: &#x27;0.0019312848587735342&#x27;&#125;,</span><br><span class="line"> &#x27;Gemm_19&#x27;: &#123;&#x27;cosine-similarity&#x27;: &#x27;0.9999609772975628&#x27;, &#x27;mse&#x27;: &#x27;0.0010773885699633795&#x27;&#125;,</span><br><span class="line"> &#x27;Conv_8&#x27;: &#123;&#x27;cosine-similarity&#x27;: &#x27;0.9999629625907311&#x27;, &#x27;mse&#x27;: &#x27;0.0010301886404004807&#x27;&#125;,</span><br><span class="line"> &#x27;Gemm_15&#x27;: &#123;&#x27;cosine-similarity&#x27;: &#x27;0.9999847687207736&#x27;, &#x27;mse&#x27;: &#x27;0.00041888411550854263&#x27;&#125;,</span><br><span class="line"> &#x27;MaxPool_12&#x27;: &#123;&#x27;cosine-similarity&#x27;: &#x27;0.9999853235024673&#x27;, &#x27;mse&#x27;: &#x27;0.0004039733791544747&#x27;&#125;,</span><br><span class="line"> &#x27;Conv_10&#x27;: &#123;&#x27;cosine-similarity&#x27;: &#x27;0.999985763659844&#x27;, &#x27;mse&#x27;: &#x27;0.0004040437432614943&#x27;&#125;,</span><br><span class="line"> &#x27;Gemm_17&#x27;: &#123;&#x27;cosine-similarity&#x27;: &#x27;0.9999913985912616&#x27;, &#x27;mse&#x27;: &#x27;0.0002379088904350423&#x27;&#125;&#125; ...&#125;</span><br></pre></td></tr></table></figure></div>



<ul>
<li><strong>plot_acc_error</strong>ï¼šåªé‡åŒ–æµ®ç‚¹æ¨¡å‹ä¸­çš„æŸä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¹¶ä¾æ¬¡è®¡ç®—è¯¥æ¨¡å‹ä¸æµ®ç‚¹æ¨¡å‹ä¸­èŠ‚ç‚¹è¾“å‡ºçš„è¯¯å·®ï¼Œè·å¾—ç´¯ç§¯è¯¯å·®æ›²çº¿ã€‚</li>
</ul>
<p><strong>APIå‚æ•°ç»„</strong>ï¼š</p>
<table>
<thead>
<tr>
<th align="left">ç¼– å·</th>
<th align="left">å‚æ•°åç§°</th>
<th align="left">å‚æ•°é…ç½®è¯´æ˜</th>
<th align="left">å¯é€‰&#x2F;å¿…é€‰</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left"><code>save_dir</code></td>
<td align="left"><strong>å‚æ•°ä½œç”¨</strong>ï¼šä¿å­˜è·¯å¾„ã€‚<strong>å–å€¼èŒƒå›´</strong>ï¼šæ— ã€‚<strong>é»˜è®¤é…ç½®</strong>ï¼šæ— ã€‚<strong>å‚æ•°è¯´æ˜</strong>ï¼šå¿…é€‰ï¼ŒæŒ‡å®šåˆ†æç»“æœçš„ä¿å­˜è·¯å¾„ã€‚</td>
<td align="left">å¿…é€‰</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left"><code>calibrated_data</code></td>
<td align="left"><strong>å‚æ•°ä½œç”¨</strong>ï¼šæŒ‡å®šæ ¡å‡†æ•°æ®ã€‚<strong>å–å€¼èŒƒå›´</strong>ï¼šæ— ã€‚<strong>é»˜è®¤é…ç½®</strong>ï¼šæ— ã€‚<strong>å‚æ•°è¯´æ˜</strong>ï¼šå¿…é€‰ï¼ŒæŒ‡å®šéœ€è¦åˆ†æçš„æ ¡å‡†æ•°æ®ã€‚</td>
<td align="left">å¿…é€‰</td>
</tr>
<tr>
<td align="left">3</td>
<td align="left"><code>model_or_file</code></td>
<td align="left"><strong>å‚æ•°ä½œç”¨</strong>ï¼šæŒ‡å®šæ ¡å‡†æ¨¡å‹ã€‚<strong>å–å€¼èŒƒå›´</strong>ï¼šæ— ã€‚<strong>é»˜è®¤é…ç½®</strong>ï¼šæ— ã€‚<strong>å‚æ•°è¯´æ˜</strong>ï¼šå¿…é€‰ï¼ŒæŒ‡å®šéœ€è¦åˆ†æçš„æ ¡å‡†æ¨¡å‹ã€‚</td>
<td align="left">å¿…é€‰</td>
</tr>
<tr>
<td align="left">4</td>
<td align="left"><code>quantize_node</code></td>
<td align="left"><strong>å‚æ•°ä½œç”¨</strong>ï¼šåªé‡åŒ–æ¨¡å‹ä¸­æŒ‡å®šçš„èŠ‚ç‚¹ï¼ŒæŸ¥çœ‹è¯¯å·®ç´¯ç§¯æ›²çº¿ã€‚<strong>å–å€¼èŒƒå›´</strong>ï¼šæ ¡å‡†æ¨¡å‹ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹ã€‚<strong>é»˜è®¤é…ç½®</strong>ï¼šNoneã€‚<strong>å‚æ•°è¯´æ˜</strong>ï¼šå¯é€‰å‚æ•°ã€‚æŒ‡å®šæ¨¡å‹ä¸­éœ€è¦é‡åŒ–çš„èŠ‚ç‚¹ï¼ŒåŒæ—¶ä¿è¯å…¶ä½™èŠ‚ç‚¹å‡ä¸é‡åŒ–ã€‚ é€šè¿‡åˆ¤æ–­è¯¥å‚æ•°æ˜¯å¦ä¸ºåµŒå¥—åˆ—è¡¨è¿›è€Œå†³å®šæ˜¯å•èŠ‚ç‚¹é‡åŒ–è¿˜æ˜¯éƒ¨åˆ†é‡åŒ–ã€‚ä¾‹å¦‚ï¼šquantize_node&#x3D;[â€˜Conv_2â€™, â€˜Conv_9â€™]ï¼šåˆ†åˆ«åªé‡åŒ–Conv_2å’ŒConv_9ï¼ŒåŒæ—¶ä¿è¯å…¶ä½™èŠ‚ç‚¹ä¸é‡åŒ–ã€‚quantize_node&#x3D;[[â€˜Conv_2â€™], [â€˜Conv_9â€™, â€˜Conv_2â€™]]ï¼šåªé‡åŒ–Conv_2ä»¥åŠåŒæ—¶é‡åŒ–Conv_2å’ŒConv_9ï¼Œåˆ†åˆ«æµ‹è¯•æ¨¡å‹ç´¯ç§¯è¯¯å·®ã€‚quantize_node åŒ…å«ä¸¤ä¸ªç‰¹æ®Šå‚æ•°ï¼šâ€™weightâ€™ å’Œ â€˜activationâ€™ã€‚å½“ï¼šquantize_node &#x3D; [â€˜weightâ€™]ï¼šåªé‡åŒ–æƒé‡ï¼Œä¸é‡åŒ–æ¿€æ´»ã€‚quantize_node &#x3D; [â€˜activationâ€™]ï¼šåªé‡åŒ–æ¿€æ´»ï¼Œä¸é‡åŒ–æƒé‡ã€‚quantize_node &#x3D; [â€˜weightâ€™, â€˜activationâ€™]ï¼šæƒé‡å’Œæ¿€æ´»åˆ†åˆ«é‡åŒ–ã€‚</td>
<td align="left">å¯é€‰</td>
</tr>
<tr>
<td align="left">5</td>
<td align="left"><code>non_quantize_node</code></td>
<td align="left"><strong>å‚æ•°ä½œç”¨</strong>ï¼šæŒ‡å®šç´¯ç§¯è¯¯å·®çš„ç±»å‹ã€‚<strong>å–å€¼èŒƒå›´</strong>ï¼šæ ¡å‡†æ¨¡å‹ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹ã€‚<strong>é»˜è®¤é…ç½®</strong>ï¼šNoneã€‚<strong>å‚æ•°è¯´æ˜</strong>ï¼šå¯é€‰å‚æ•°ã€‚æŒ‡å®šæ¨¡å‹ä¸­ä¸é‡åŒ–çš„èŠ‚ç‚¹ï¼ŒåŒæ—¶ä¿è¯å…¶ä½™èŠ‚ç‚¹å…¨éƒ½é‡åŒ–ã€‚ é€šè¿‡åˆ¤æ–­è¯¥å‚æ•°æ˜¯å¦ä¸ºåµŒå¥—åˆ—è¡¨è¿›è€Œå†³å®šæ˜¯å•èŠ‚ç‚¹ä¸é‡åŒ–è¿˜æ˜¯éƒ¨åˆ†é‡åŒ–ã€‚ä¾‹å¦‚ï¼šnon_quantize_node&#x3D;[â€˜Conv_2â€™, â€˜Conv_9â€™]ï¼šåˆ†åˆ«è§£é™¤Conv_2å’ŒConv_9èŠ‚ç‚¹çš„é‡åŒ–ï¼ŒåŒæ—¶ä¿è¯å…¶ä½™èŠ‚ç‚¹å…¨éƒ¨é‡åŒ–ã€‚non_quantize_node&#x3D;[[â€˜Conv_2â€™], [â€˜Conv_9â€™, â€˜Conv_2â€™]]ï¼šåªè§£é™¤Conv_2é‡åŒ–ä»¥åŠåŒæ—¶è§£é™¤Conv_2å’ŒConv_9é‡åŒ–ï¼Œåˆ†åˆ«æµ‹è¯•æ¨¡å‹ç´¯ç§¯è¯¯å·®ã€‚</td>
<td align="left">å¯é€‰</td>
</tr>
<tr>
<td align="left">6</td>
<td align="left"><code>metric</code></td>
<td align="left"><strong>å‚æ•°ä½œç”¨</strong>ï¼šè¯¯å·®åº¦é‡æ–¹å¼ã€‚<strong>å–å€¼èŒƒå›´</strong>ï¼š<code>&#39;cosine-similarity&#39;</code> , <code>&#39;mse&#39;</code> , <code>&#39;mre&#39;</code> , <code>&#39;sqnr&#39;</code> , <code>&#39;chebyshev&#39;</code><strong>é»˜è®¤é…ç½®</strong>ï¼š<code>&#39;cosine-similarity&#39;</code>ã€‚<strong>å‚æ•°è¯´æ˜</strong>ï¼šè®¾ç½®è®¡ç®—æ¨¡å‹è¯¯å·®çš„è®¡ç®—æ–¹å¼ã€‚</td>
<td align="left">å¯é€‰</td>
</tr>
<tr>
<td align="left">7</td>
<td align="left"><code>average_mode</code></td>
<td align="left"><strong>å‚æ•°ä½œç”¨</strong>ï¼šæŒ‡å®šç´¯ç§¯è¯¯å·®æ›²çº¿çš„è¾“å‡ºæ¨¡å¼ã€‚<strong>å–å€¼èŒƒå›´</strong>ï¼š<code>True</code> ã€ <code>False</code>ã€‚<strong>é»˜è®¤é…ç½®</strong>ï¼š<code>False</code>ã€‚<strong>å‚æ•°è¯´æ˜</strong>ï¼šé»˜è®¤ä¸ºFalseã€‚è‹¥ä¸ºTrueï¼Œé‚£ä¹ˆè·å–ç´¯ç§¯è¯¯å·®çš„å¹³å‡å€¼ä½œä¸ºç»“æœã€‚</td>
<td align="left">å¯é€‰</td>
</tr>
</tbody></table>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># å¯¼å…¥debugæ¨¡å—</span><br><span class="line">import horizon_nn.debug as dbg</span><br><span class="line"></span><br><span class="line">dbg.plot_acc_error(save_dir: str,</span><br><span class="line">                   calibrated_data: str or CalibrationDataSet,</span><br><span class="line">                   model_or_file: ModelProto or str,</span><br><span class="line">                   quantize_node: List or str,</span><br><span class="line">                   non_quantize_node: List or str,</span><br><span class="line">                   metric: str = &#x27;cosine-similarity&#x27;,</span><br><span class="line">                   average_mode: bool = False):</span><br></pre></td></tr></table></figure></div>


<p><strong>APIåˆ†æç»“æœå±•ç¤º</strong></p>
<p><strong>1.æŒ‡å®šèŠ‚ç‚¹é‡åŒ–ç´¯ç§¯è¯¯å·®æµ‹è¯•</strong></p>
<ul>
<li>æŒ‡å®šå•èŠ‚ç‚¹é‡åŒ–</li>
</ul>
<p><strong>é…ç½®æ–¹å¼</strong>ï¼šquantize_node&#x3D;[â€˜Conv_2â€™, â€˜Conv_90â€™]ï¼Œquantize_nodeä¸ºå•åˆ—è¡¨ã€‚</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># å¯¼å…¥debugæ¨¡å—</span><br><span class="line">import horizon_nn.debug as dbg</span><br><span class="line"></span><br><span class="line">dbg.plot_acc_error(save_dir=&#x27;./&#x27;,</span><br><span class="line">                   calibrated_data=&#x27;./calibration_data/&#x27;,</span><br><span class="line">                   model_or_file=&#x27;./calibrated_model.onnx&#x27;,</span><br><span class="line">                   quantize_node=[&#x27;Conv_2&#x27;, &#x27;Conv_90&#x27;],</span><br><span class="line">                   metric=&#x27;cosine-similarity&#x27;,</span><br><span class="line">                   average_mode=False)</span><br></pre></td></tr></table></figure></div>

<p><strong>æè¿°</strong>ï¼šå½“quantize_nodeä¸ºå•åˆ—è¡¨æ—¶ï¼Œé’ˆå¯¹æ‚¨è®¾ç½®çš„quantize_nodeï¼Œ åˆ†åˆ«å•ç‹¬é‡åŒ–quantize_nodeä¸­çš„èŠ‚ç‚¹å¹¶ä¿æŒæ¨¡å‹ä¸­å…¶ä»–èŠ‚ç‚¹ä¸é‡åŒ–ï¼Œå¾—åˆ°å¯¹åº”çš„æ¨¡å‹åï¼Œ å¯¹è¯¥æ¨¡å‹ä¸­æ¯ä¸ªèŠ‚ç‚¹çš„è¾“å‡ºè®¡ç®—å…¶ä¸æµ®ç‚¹æ¨¡å‹ä¸­å¯¹åº”èŠ‚ç‚¹è¾“å‡ºçš„ä¹‹é—´çš„è¯¯å·®ï¼Œå¹¶å¾—åˆ°å¯¹åº”çš„ç´¯ç§¯è¯¯å·®æ›²çº¿ã€‚</p>
<p>average_mode &#x3D; Falseæ—¶ï¼š</p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230511163529466.png"
                      class="" title="image-20230511163529466"
                >

<p>average_mode &#x3D; Trueæ—¶ï¼š</p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230511163541846.png"
                      class="" title="image-20230511163541846"
                >

<p><strong>average_mode</strong></p>
<p>average_modeé»˜è®¤ä¸ºFalseã€‚å¯¹äºä¸€äº›æ¨¡å‹ï¼Œæ­¤æ—¶æ— æ³•é€šè¿‡ç´¯ç§¯è¯¯å·®æ›²çº¿åˆ¤æ–­å“ªç§é‡åŒ–ç­–ç•¥æ›´åŠ æœ‰æ•ˆï¼Œ å› æ­¤éœ€è¦å°†average_modeè®¾ç½®ä¸ºTrueï¼Œæ­¤æ—¶ä¼šå¯¹å‰nä¸ªèŠ‚ç‚¹çš„ç´¯ç§¯è¯¯å·®æ±‚å‡å€¼ä½œä¸ºç¬¬nä¸ªèŠ‚ç‚¹çš„ç´¯ç§¯è¯¯å·®ã€‚</p>
<p>å…·ä½“è®¡ç®—æ–¹å¼å¦‚ä¸‹ï¼Œä¾‹å¦‚ï¼š</p>
<p>average_mode&#x3D;Falseæ—¶ï¼Œaccumulate_error&#x3D;[1.0, 0.9, 0.9, 0.8]ã€‚</p>
<p>è€Œå°†average_mode&#x3D;Trueåï¼Œaccumulate_error&#x3D;[1.0, 0.95, 0.933, 0.9]ã€‚</p>
<ul>
<li>æŒ‡å®šå¤šä¸ªèŠ‚ç‚¹é‡åŒ–</li>
</ul>
<p><strong>é…ç½®æ–¹å¼</strong>ï¼šquantize_node&#x3D;[[â€˜Conv_2â€™], [â€˜Conv_2â€™, â€˜Conv_90â€™]]ï¼Œquantize_nodeä¸ºåµŒå¥—åˆ—è¡¨</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># å¯¼å…¥debugæ¨¡å—</span><br><span class="line">import horizon_nn.debug as dbg</span><br><span class="line"></span><br><span class="line">dbg.plot_acc_error(save_dir=&#x27;./&#x27;,</span><br><span class="line">                   calibrated_data=&#x27;./calibration_data/&#x27;,</span><br><span class="line">                   model_or_file=&#x27;./calibrated_model.onnx&#x27;,</span><br><span class="line">                   quantize_node=[[&#x27;Conv_2&#x27;], [&#x27;Conv_2&#x27;, &#x27;Conv_90&#x27;]],</span><br><span class="line">                   metric=&#x27;cosine-similarity&#x27;,</span><br><span class="line">                   average_mode=False)</span><br></pre></td></tr></table></figure></div>

<p><strong>æè¿°</strong>ï¼šå½“quantize_nodeä¸ºåµŒå¥—åˆ—è¡¨æ—¶ï¼Œé’ˆå¯¹æ‚¨è®¾ç½®çš„quantize_nodeï¼Œåˆ†åˆ«é‡åŒ–quantize_nodeä¸­çš„ æ¯ä¸ªå•åˆ—è¡¨æŒ‡å®šçš„èŠ‚ç‚¹å¹¶ä¿æŒæ¨¡å‹ä¸­å…¶ä»–èŠ‚ç‚¹ä¸é‡åŒ–ï¼Œå¾—åˆ°å¯¹åº”çš„æ¨¡å‹åï¼Œå¯¹è¯¥æ¨¡å‹ä¸­æ¯ä¸ªèŠ‚ç‚¹çš„è¾“å‡ºè®¡ç®— å…¶ä¸æµ®ç‚¹æ¨¡å‹ä¸­å¯¹åº”èŠ‚ç‚¹è¾“å‡ºçš„ä¹‹é—´çš„è¯¯å·®ï¼Œå¹¶å¾—åˆ°å¯¹åº”çš„ç´¯ç§¯è¯¯å·®æ›²çº¿ã€‚</p>
<ul>
<li>partial_qmodel_0ï¼šåªé‡åŒ–Conv_2èŠ‚ç‚¹ï¼Œå…¶ä½™èŠ‚ç‚¹ä¸é‡åŒ–ï¼›</li>
<li>partial_qmodel_1ï¼šåªé‡åŒ–Conv_2å’ŒConv_90èŠ‚ç‚¹ï¼Œå…¶ä½™èŠ‚ç‚¹ä¸é‡åŒ–ã€‚</li>
</ul>
<p>average_mode&#x3D;Falseæ—¶ï¼š</p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230511163640082.png"
                      class="" title="image-20230511163640082"
                >

<p>average_mode&#x3D;Trueæ—¶ï¼š</p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230511163652416.png"
                      class="" title="image-20230511163652416"
                >



<p><strong>2.è§£é™¤æ¨¡å‹éƒ¨åˆ†èŠ‚ç‚¹é‡åŒ–åç´¯ç§¯è¯¯å·®æµ‹è¯•</strong></p>
<ul>
<li>æŒ‡å®šå•èŠ‚ç‚¹ä¸é‡åŒ–</li>
</ul>
<p><strong>é…ç½®æ–¹å¼</strong>ï¼šnon_quantize_node&#x3D;[â€˜Conv_2â€™, â€˜Conv_90â€™]ï¼Œnon_quantize_nodeä¸ºå•åˆ—è¡¨ã€‚</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># å¯¼å…¥debugæ¨¡å—</span><br><span class="line">import horizon_nn.debug as dbg</span><br><span class="line"></span><br><span class="line">dbg.plot_acc_error(save_dir=&#x27;./&#x27;,</span><br><span class="line">                   calibrated_data=&#x27;./calibration_data/&#x27;,</span><br><span class="line">                   model_or_file=&#x27;./calibrated_model.onnx&#x27;,</span><br><span class="line">                   non_quantize_node=[&#x27;Conv_2&#x27;, &#x27;Conv_90&#x27;],</span><br><span class="line">                   metric=&#x27;cosine-similarity&#x27;,</span><br><span class="line">                   average_mode=True)</span><br></pre></td></tr></table></figure></div>

<p><strong>æè¿°</strong>ï¼šå½“non_quantize_nodeä¸ºå•åˆ—è¡¨æ—¶ï¼Œé’ˆå¯¹æ‚¨è®¾ç½®çš„non_quantize_nodeï¼Œ åˆ†åˆ«è§£é™¤non_quantize_nodeä¸­å„ä¸ªèŠ‚ç‚¹çš„é‡åŒ–åŒæ—¶ä¿æŒå…¶ä»–èŠ‚ç‚¹å…¨éƒ¨é‡åŒ–ï¼Œå¾—åˆ°å¯¹åº”çš„æ¨¡å‹åï¼Œ å¯¹è¯¥æ¨¡å‹ä¸­æ¯ä¸ªèŠ‚ç‚¹çš„è¾“å‡ºè®¡ç®—å…¶ä¸æµ®ç‚¹æ¨¡å‹ä¸­å¯¹åº”èŠ‚ç‚¹è¾“å‡ºçš„ä¹‹é—´çš„è¯¯å·®ï¼Œå¹¶å¾—åˆ°å¯¹åº”çš„ç´¯ç§¯è¯¯å·®æ›²çº¿ã€‚</p>
<p>average_mode &#x3D; Falseæ—¶ï¼š</p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230511163706141.png"
                      class="" title="image-20230511163706141"
                >

<p>average_mode &#x3D; Trueæ—¶ï¼š</p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230511163716860.png"
                      class="" title="image-20230511163716860"
                >



<ul>
<li>æŒ‡å®šå¤šä¸ªèŠ‚ç‚¹ä¸é‡åŒ–</li>
</ul>
<p><strong>é…ç½®æ–¹å¼</strong>ï¼šnon_quantize_node&#x3D;[[â€˜Conv_2â€™], [â€˜Conv_2â€™, â€˜Conv_90â€™]]ï¼Œnon_quantize_nodeä¸ºåµŒå¥—åˆ—è¡¨ã€‚</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># å¯¼å…¥debugæ¨¡å—</span><br><span class="line">import horizon_nn.debug as dbg</span><br><span class="line"></span><br><span class="line">dbg.plot_acc_error(save_dir=&#x27;./&#x27;,</span><br><span class="line">                   calibrated_data=&#x27;./calibration_data/&#x27;,</span><br><span class="line">                   model_or_file=&#x27;./calibrated_model.onnx&#x27;,</span><br><span class="line">                   non_quantize_node=[[&#x27;Conv_2&#x27;], [&#x27;Conv_2&#x27;, &#x27;Conv_90&#x27;]],</span><br><span class="line">                   metric=&#x27;cosine-similarity&#x27;,</span><br><span class="line">                   average_mode=False)</span><br></pre></td></tr></table></figure></div>

<p><strong>æè¿°</strong>ï¼šå½“non_quantize_nodeä¸ºåµŒå¥—åˆ—è¡¨æ—¶ï¼Œé’ˆå¯¹æ‚¨è®¾ç½®çš„non_quantize_nodeï¼Œ åˆ†åˆ«ä¸é‡åŒ–non_quantize_nodeä¸­çš„æ¯ä¸ªå•åˆ—è¡¨æŒ‡å®šçš„èŠ‚ç‚¹å¹¶ä¿æŒæ¨¡å‹ä¸­å…¶ä»–èŠ‚ç‚¹å‡é‡åŒ–ï¼Œ å¾—åˆ°å¯¹åº”çš„æ¨¡å‹åï¼Œå¯¹è¯¥æ¨¡å‹ä¸­æ¯ä¸ªèŠ‚ç‚¹çš„è¾“å‡ºè®¡ç®—å…¶ä¸æµ®ç‚¹æ¨¡å‹ä¸­å¯¹åº”èŠ‚ç‚¹è¾“å‡ºçš„ä¹‹é—´çš„è¯¯å·®ï¼Œ å¹¶å¾—åˆ°å¯¹åº”çš„ç´¯ç§¯è¯¯å·®æ›²çº¿ã€‚</p>
<ul>
<li>partial_qmodel_0ï¼šä¸é‡åŒ–Conv_2èŠ‚ç‚¹ï¼Œå…¶ä½™èŠ‚ç‚¹é‡åŒ–ï¼›</li>
<li>partial_qmodel_1ï¼šä¸é‡åŒ–Conv_2å’ŒConv_90èŠ‚ç‚¹ï¼Œå…¶ä½™èŠ‚ç‚¹é‡åŒ–ã€‚</li>
</ul>
<p>average_mode &#x3D; Falseæ—¶ï¼š</p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230511163732112.png"
                      class="" title="image-20230511163732112"
                >

<p>average_mode &#x3D; Trueæ—¶ï¼š</p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230511163745405.png"
                      class="" title="image-20230511163745405"
                >

<p><strong>æµ‹è¯•æŠ€å·§</strong>ï¼š</p>
<p>æµ‹è¯•éƒ¨åˆ†é‡åŒ–ç²¾åº¦æ—¶ï¼Œæ‚¨å¯èƒ½ä¼šæŒ‰ç…§é‡åŒ–æ•æ„Ÿåº¦æ’åºè¿›è¡Œå¤šç»„é‡åŒ–ç­–ç•¥çš„ç²¾åº¦å¯¹æ¯”ï¼Œæ­¤æ—¶å¯ä»¥å‚è€ƒä»¥ä¸‹ç”¨æ³•ï¼š</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"># å¯¼å…¥debugæ¨¡å—</span><br><span class="line">import horizon_nn.debug as dbg</span><br><span class="line"></span><br><span class="line"># é¦–å…ˆä½¿ç”¨é‡åŒ–æ•æ„Ÿåº¦æ’åºå‡½æ•°è·å–æ¨¡å‹ä¸­èŠ‚ç‚¹çš„é‡åŒ–æ•æ„Ÿåº¦æ’åº</span><br><span class="line">node_message = dbg.get_sensitivity_of_nodes(</span><br><span class="line">        model_or_file=&#x27;./calibrated_model.onnx&#x27;,</span><br><span class="line">        metrics=&#x27;cosine-similarity&#x27;,</span><br><span class="line">        calibrated_data=&#x27;./calibration_data/&#x27;,</span><br><span class="line">        output_node=None,</span><br><span class="line">        node_type=&#x27;node&#x27;,</span><br><span class="line">        verbose=False,</span><br><span class="line">        interested_nodes=None)</span><br><span class="line"></span><br><span class="line"># node_messageä¸ºå­—å…¸ç±»å‹ï¼Œå…¶keyå€¼ä¸ºèŠ‚ç‚¹åç§°</span><br><span class="line">nodes = list(node_message.keys())</span><br><span class="line"></span><br><span class="line"># é€šè¿‡nodesæ¥æŒ‡å®šä¸é‡åŒ–èŠ‚ç‚¹ï¼Œå¯ä»¥æ–¹ä¾¿ä½¿ç”¨</span><br><span class="line">dbg.plot_acc_error(save_dir=&#x27;./&#x27;,</span><br><span class="line">                   calibrated_data=&#x27;./calibration_data/&#x27;,</span><br><span class="line">                   model_or_file=&#x27;./calibrated_model.onnx&#x27;,</span><br><span class="line">                   non_quantize_node=[nodes[:1], nodes[:2]],</span><br><span class="line">                   metric=&#x27;cosine-similarity&#x27;,</span><br><span class="line">                   average_mode=True)</span><br></pre></td></tr></table></figure></div>

<p><strong>3.æ¿€æ´»æƒé‡åˆ†åˆ«é‡åŒ–</strong></p>
<p><strong>é…ç½®æ–¹å¼</strong>ï¼šquantize_node&#x3D;[â€˜weightâ€™,â€™activationâ€™]ã€‚</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">import horizon_nn.debug as dbg</span><br><span class="line"></span><br><span class="line">dbg.plot_acc_error_copy(</span><br><span class="line">         save_dir=&#x27;./&#x27;,</span><br><span class="line">         calibrated_data=&#x27;./calibration_data/&#x27;,</span><br><span class="line">         model_or_file=&#x27;./calibrated_model.onnx&#x27;,</span><br><span class="line">         quantize_node=[&#x27;weight&#x27;, &#x27;activation&#x27;],</span><br><span class="line">         metric=&#x27;cosine-similarity&#x27;,</span><br><span class="line">         average_mode=False)</span><br></pre></td></tr></table></figure></div>

<p><strong>æè¿°</strong>ï¼šquantize_nodeä¹Ÿå¯ç›´æ¥æŒ‡å®šâ€™weightâ€™æˆ–è€…â€™activationâ€™ã€‚å½“ï¼š</p>
<ul>
<li>quantize_node &#x3D; [â€˜weightâ€™]ï¼šåªé‡åŒ–æƒé‡ï¼Œä¸é‡åŒ–æ¿€æ´»ã€‚</li>
<li>quantize_node &#x3D; [â€˜activationâ€™]ï¼šåªé‡åŒ–æ¿€æ´»ï¼Œä¸é‡åŒ–æƒé‡ã€‚</li>
<li>quantize_node &#x3D; [â€˜weightâ€™, â€˜activationâ€™]ï¼šæƒé‡å’Œæ¿€æ´»åˆ†åˆ«é‡åŒ–ã€‚</li>
</ul>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230511163951063.png"
                      class="" title="image-20230511163951063"
                >



<p><strong>plot_distribution</strong></p>
<p><strong>åŠŸèƒ½</strong>ï¼šé€‰å–èŠ‚ç‚¹ï¼Œåˆ†åˆ«è·å–è¯¥èŠ‚ç‚¹åœ¨æµ®ç‚¹æ¨¡å‹å’Œæ ¡å‡†æ¨¡å‹ä¸­çš„è¾“å‡ºï¼Œå¾—åˆ°è¾“å‡ºæ•°æ®åˆ†å¸ƒã€‚å¦å¤–ï¼Œå°†ä¸¤ä¸ªè¾“å‡ºç»“æœåšå·®ï¼Œè·å–ä¸¤ä¸ªè¾“å‡ºä¹‹é—´çš„è¯¯å·®åˆ†å¸ƒã€‚</p>
<p><strong>APIå‚æ•°ç»„</strong>ï¼š</p>
<table>
<thead>
<tr>
<th align="left">ç¼– å·</th>
<th align="left">å‚æ•°åç§°</th>
<th align="left">å‚æ•°é…ç½®è¯´æ˜</th>
<th align="left">å¯é€‰&#x2F;å¿…é€‰</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left"><code>save_dir</code></td>
<td align="left"><strong>å‚æ•°ä½œç”¨</strong>ï¼šä¿å­˜è·¯å¾„ã€‚<strong>å–å€¼èŒƒå›´</strong>ï¼šæ— ã€‚<strong>é»˜è®¤é…ç½®</strong>ï¼šæ— ã€‚<strong>å‚æ•°è¯´æ˜</strong>ï¼šå¿…é€‰ï¼ŒæŒ‡å®šåˆ†æç»“æœçš„ä¿å­˜è·¯å¾„ã€‚</td>
<td align="left">å¿…é€‰</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left"><code>model_or_file</code></td>
<td align="left"><strong>å‚æ•°ä½œç”¨</strong>ï¼šæŒ‡å®šæ ¡å‡†æ¨¡å‹ã€‚<strong>å–å€¼èŒƒå›´</strong>ï¼šæ— ã€‚<strong>é»˜è®¤é…ç½®</strong>ï¼šæ— ã€‚<strong>å‚æ•°è¯´æ˜</strong>ï¼šå¿…é€‰ï¼ŒæŒ‡å®šéœ€è¦åˆ†æçš„æ ¡å‡†æ¨¡å‹ã€‚</td>
<td align="left">å¿…é€‰</td>
</tr>
<tr>
<td align="left">3</td>
<td align="left"><code>calibrated_data</code></td>
<td align="left"><strong>å‚æ•°ä½œç”¨</strong>ï¼šæŒ‡å®šæ ¡å‡†æ•°æ®ã€‚<strong>å–å€¼èŒƒå›´</strong>ï¼šæ— ã€‚<strong>é»˜è®¤é…ç½®</strong>ï¼šæ— ã€‚<strong>å‚æ•°è¯´æ˜</strong>ï¼šå¿…é€‰ï¼ŒæŒ‡å®šåˆ†ææ‰€éœ€è¦çš„æ ¡å‡†æ•°æ®ã€‚</td>
<td align="left">å¿…é€‰</td>
</tr>
<tr>
<td align="left">4</td>
<td align="left"><code>nodes_list</code></td>
<td align="left"><strong>å‚æ•°ä½œç”¨</strong>ï¼šæŒ‡å®šéœ€è¦åˆ†æçš„èŠ‚ç‚¹ã€‚<strong>å–å€¼èŒƒå›´</strong>ï¼šæ ¡å‡†æ¨¡å‹ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹ã€‚<strong>é»˜è®¤é…ç½®</strong>ï¼šæ— ã€‚<strong>å‚æ•°è¯´æ˜</strong>ï¼šå¿…é€‰ï¼ŒæŒ‡å®šéœ€è¦åˆ†æçš„èŠ‚ç‚¹ã€‚è‹¥nodes_listä¸­çš„èŠ‚ç‚¹ç±»å‹ä¸ºï¼šæƒé‡æ ¡å‡†èŠ‚ç‚¹ï¼šç»˜åˆ¶åŸå§‹æƒé‡å’Œç»è¿‡æ ¡å‡†ä¹‹åçš„æƒé‡çš„æ•°æ®åˆ†å¸ƒã€‚æ¿€æ´»æ ¡å‡†èŠ‚ç‚¹ï¼šç»˜åˆ¶æ¿€æ´»æ ¡å‡†èŠ‚ç‚¹çš„è¾“å…¥æ•°æ®åˆ†å¸ƒã€‚æ™®é€šèŠ‚ç‚¹ï¼šç»˜åˆ¶è¯¥èŠ‚ç‚¹åœ¨é‡åŒ–å‰åçš„è¾“å‡ºæ•°æ®åˆ†å¸ƒï¼ŒåŒæ—¶ç»˜åˆ¶äºŒè€…ä¹‹é—´çš„è¯¯å·®åˆ†å¸ƒã€‚æ³¨ï¼šnodes_listä¸º list ç±»å‹ï¼Œå¯æŒ‡å®šä¸€ç³»åˆ—èŠ‚ç‚¹ï¼Œå¹¶ä¸”ä¸Šè¿°ä¸‰ç§ç±»å‹èŠ‚ç‚¹ å¯åŒæ—¶æŒ‡å®šã€‚</td>
<td align="left">å¿…é€‰</td>
</tr>
</tbody></table>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># å¯¼å…¥debugæ¨¡å—</span><br><span class="line">import horizon_nn.debug as dbg</span><br><span class="line"></span><br><span class="line">dbg.plot_distribution(save_dir: str,</span><br><span class="line">                      model_or_file: ModelProto or str,</span><br><span class="line">                      calibrated_data: str or CalibrationDataSet,</span><br><span class="line">                      nodes_list: List[str] or str)</span><br></pre></td></tr></table></figure></div>

<p><strong>APIåˆ†æç»“æœå±•ç¤º</strong>ï¼š</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># å¯¼å…¥debugæ¨¡å—</span><br><span class="line">import horizon_nn.debug as dbg</span><br><span class="line"></span><br><span class="line">dbg.plot_distribution(save_dir=&#x27;./&#x27;,</span><br><span class="line">                      model_or_file=&#x27;./calibrated_model.onnx&#x27;,</span><br><span class="line">                      calibrated_data=&#x27;./calibration_data&#x27;,</span><br><span class="line">                      nodes_list=[&#x27;317_HzCalibration&#x27;, # æ¿€æ´»èŠ‚ç‚¹</span><br><span class="line">                                  &#x27;471_HzCalibration&#x27;, # æƒé‡èŠ‚ç‚¹</span><br><span class="line">                                  &#x27;Conv_2&#x27;]) # æ™®é€šèŠ‚ç‚¹</span><br></pre></td></tr></table></figure></div>

<p>node_outputï¼š</p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230511165306052.png"
                      class="" title="image-20230511165306052"
                >

<p>weightï¼š</p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230511165319688.png"
                      class="" title="image-20230511165319688"
                >

<p>activationï¼š</p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230511165339651.png"
                      class="" title="image-20230511165339651"
                >

<p><strong>ä¸Šæ–¹ä¸‰å¹…å›¾ä¸­ï¼Œè“è‰²ä¸‰è§’è¡¨ç¤ºï¼šæ•°æ®ç»å¯¹å€¼çš„æœ€å¤§å€¼ã€‚çº¢è‰²è™šçº¿è¡¨ç¤ºï¼šæœ€å°çš„æ ¡å‡†é˜ˆå€¼ã€‚</strong></p>
<ul>
<li><strong>get_channelwise_data_distribution</strong></li>
</ul>
<p><strong>åŠŸèƒ½</strong>ï¼šç»˜åˆ¶æŒ‡å®šæ ¡å‡†èŠ‚ç‚¹è¾“å…¥æ•°æ®é€šé“é—´æ•°æ®åˆ†å¸ƒçš„ç®±çº¿å›¾ã€‚</p>
<blockquote>
<p>ç®±çº¿å›¾ï¼ˆBox Plotï¼‰æ˜¯ä¸€ç§<strong>ç”¨äºå±•ç¤ºæ•°æ®åˆ†å¸ƒæƒ…å†µçš„å›¾è¡¨</strong>ï¼Œä¹Ÿç§°ä¸ºç›’é¡»å›¾ã€ç®±å½¢å›¾ç­‰ã€‚ç®±çº¿å›¾æœ€åˆç”±ç¾å›½ç»Ÿè®¡å­¦å®¶çº¦ç¿°Â·å›¾åŸºå‘æ˜ï¼Œç”¨äºå±•ç¤ºè‡ªç„¶ç§‘å­¦å’Œç¤¾ä¼šç§‘å­¦ç ”ç©¶ä¸­çš„æ•°æ®åˆ†å¸ƒæƒ…å†µã€‚<br>ä¸€ä¸ªæ ‡å‡†çš„ç®±çº¿å›¾é€šå¸¸ç”±äº”ä¸ªå€¼ç»„æˆï¼Œåˆ†åˆ«æ˜¯ï¼šæœ€å°å€¼ï¼ˆMinimumï¼‰ã€ä¸‹å››åˆ†ä½æ•°ï¼ˆQ1ï¼‰ã€ä¸­ä½æ•°ï¼ˆMedianï¼‰ã€ä¸Šå››åˆ†ä½æ•°ï¼ˆQ3ï¼‰å’Œæœ€å¤§å€¼ï¼ˆMaximumï¼‰ã€‚ç®±çº¿å›¾é€šå¸¸ä»¥çŸ©å½¢çš„å½¢å¼å‘ˆç°ï¼ŒçŸ©å½¢çš„ä¸Šä¸‹è¾¹ç¼˜åˆ†åˆ«è¡¨ç¤ºä¸Šå››åˆ†ä½æ•°å’Œä¸‹å››åˆ†ä½æ•°ï¼Œå…¶é«˜åº¦è¡¨ç¤ºè¯¥åŒºé—´çš„è·ç¦»ï¼Œä¸­ä½æ•°åˆ™ç”¨ä¸€æ¡å‚ç›´çš„çº¿è¡¨ç¤ºã€‚æ•°æ®å¯è§†åŒ–æ—¶ï¼Œç®±çº¿å›¾ç»å¸¸æ­é…ç€â€œèƒ¡é¡»â€å’Œå¼‚å¸¸å€¼æ¥å‘ˆç°æ•°æ®çš„åˆ†å¸ƒæƒ…å†µã€‚èƒ¡é¡»çš„é•¿åº¦èŒƒå›´é€šå¸¸æ˜¯1.5å€çš„å››åˆ†ä½è·ï¼Œå°åœ†ç‚¹è¡¨ç¤ºæ•°æ®ä¸­çš„å¼‚å¸¸å€¼ï¼ˆoutliersï¼‰ã€‚<br>ç®±çº¿å›¾éå¸¸é€‚åˆäºç”¨äºæ¯”è¾ƒå¤šç»„æ•°æ®æˆ–åŒä¸€ç»„æ•°æ®åœ¨ä¸åŒæ¡ä»¶ä¸‹çš„åˆ†å¸ƒæƒ…å†µï¼Œå¯ä»¥æ­ç¤ºæ•°æ®åˆ†å¸ƒçš„ä¸­å¿ƒã€å·®å¼‚å’Œç¦»ç¾¤å€¼çš„æƒ…å†µï¼Œä»è€Œå¸®åŠ©åˆ†æäººå‘˜ä½œå‡ºæ›´åŠ å‡†ç¡®çš„åˆ¤æ–­ã€‚å¸¸ç”¨çš„ç®±çº¿å›¾è½¯ä»¶åŒ…æ‹¬Matplotlibå’ŒSeabornç­‰ã€‚</p>
</blockquote>
<p><strong>APIå‚æ•°ç»„</strong>ï¼š</p>
<table>
<thead>
<tr>
<th align="left">ç¼– å·</th>
<th align="left">å‚æ•°åç§°</th>
<th align="left">å‚æ•°é…ç½®è¯´æ˜</th>
<th align="left">å¯é€‰&#x2F;å¿…é€‰</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left"><code>save_dir</code></td>
<td align="left"><strong>å‚æ•°ä½œç”¨</strong>ï¼šä¿å­˜è·¯å¾„ã€‚<strong>å–å€¼èŒƒå›´</strong>ï¼šæ— ã€‚<strong>é»˜è®¤é…ç½®</strong>ï¼šæ— ã€‚<strong>å‚æ•°è¯´æ˜</strong>ï¼šå¿…é€‰ï¼ŒæŒ‡å®šåˆ†æç»“æœçš„ä¿å­˜è·¯å¾„ã€‚</td>
<td align="left">å¿…é€‰</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left"><code>model_or_file</code></td>
<td align="left"><strong>å‚æ•°ä½œç”¨</strong>ï¼šæŒ‡å®šæ ¡å‡†æ¨¡å‹ã€‚<strong>å–å€¼èŒƒå›´</strong>ï¼šæ— ã€‚<strong>é»˜è®¤é…ç½®</strong>ï¼šæ— ã€‚<strong>å‚æ•°è¯´æ˜</strong>ï¼šå¿…é€‰ï¼ŒæŒ‡å®šéœ€è¦åˆ†æçš„æ ¡å‡†æ¨¡å‹ã€‚</td>
<td align="left">å¿…é€‰</td>
</tr>
<tr>
<td align="left">3</td>
<td align="left"><code>calibrated_data</code></td>
<td align="left"><strong>å‚æ•°ä½œç”¨</strong>ï¼šæŒ‡å®šæ ¡å‡†æ•°æ®ã€‚<strong>å–å€¼èŒƒå›´</strong>ï¼šæ— ã€‚<strong>é»˜è®¤é…ç½®</strong>ï¼šæ— ã€‚<strong>å‚æ•°è¯´æ˜</strong>ï¼šå¿…é€‰ï¼ŒæŒ‡å®šåˆ†ææ‰€éœ€è¦çš„æ ¡å‡†æ•°æ®ã€‚</td>
<td align="left">å¿…é€‰</td>
</tr>
<tr>
<td align="left">4</td>
<td align="left"><code>nodes_list</code></td>
<td align="left"><strong>å‚æ•°ä½œç”¨</strong>ï¼šæŒ‡å®šæ ¡å‡†èŠ‚ç‚¹ã€‚<strong>å–å€¼èŒƒå›´</strong>ï¼šæ ¡å‡†æ¨¡å‹ä¸­çš„æ‰€æœ‰æƒé‡æ ¡å‡†èŠ‚ç‚¹å’Œæ¿€æ´»æ ¡å‡†èŠ‚ç‚¹ã€‚<strong>é»˜è®¤é…ç½®</strong>ï¼šæ— ã€‚<strong>å‚æ•°è¯´æ˜</strong>ï¼šå¿…é€‰ï¼ŒæŒ‡å®šæ ¡å‡†èŠ‚ç‚¹ã€‚</td>
<td align="left">å¿…é€‰</td>
</tr>
<tr>
<td align="left">5</td>
<td align="left"><code>axis</code></td>
<td align="left"><strong>å‚æ•°ä½œç”¨</strong>ï¼šæŒ‡å®šchannelæ‰€åœ¨çš„ç»´åº¦ã€‚<strong>å–å€¼èŒƒå›´</strong>ï¼šå°äºèŠ‚ç‚¹è¾“å…¥æ•°æ®çš„ç»´åº¦ã€‚<strong>é»˜è®¤é…ç½®</strong>ï¼šNoneã€‚<strong>å‚æ•°è¯´æ˜</strong>ï¼šchannelä¿¡æ¯æ‰€åœ¨shapeä¸­çš„ä½ç½®ã€‚ <strong>å‚æ•°é»˜è®¤ä¸ºNoneï¼Œæ­¤æ—¶å¯¹äºæ¿€æ´»æ ¡å‡†èŠ‚ç‚¹ï¼Œ é»˜è®¤è®¤ä¸ºèŠ‚ç‚¹è¾“å…¥æ•°æ®çš„ç¬¬äºŒä¸ªç»´åº¦è¡¨ç¤ºchannelä¿¡æ¯ï¼Œå³axis&#x3D;1ï¼› å¯¹äºæƒé‡æ ¡å‡†èŠ‚ç‚¹ï¼Œä¼šè¯»å–è¯¥èŠ‚ç‚¹å±æ€§ä¸­çš„axiså‚æ•°ä½œä¸ºchannelä¿¡æ¯ã€‚</strong></td>
<td align="left">å¯é€‰</td>
</tr>
</tbody></table>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># å¯¼å…¥debugæ¨¡å—</span><br><span class="line">import horizon_nn.debug as dbg</span><br><span class="line"></span><br><span class="line">dbg.get_channelwise_data_distribution(save_dir: str,</span><br><span class="line">                                      model_or_file: ModelProto or str,</span><br><span class="line">                                      calibrated_data: str or CalibrationDataSet,</span><br><span class="line">                                      nodes_list: List[str],</span><br><span class="line">                                      axis: int = None)</span><br></pre></td></tr></table></figure></div>

<p><strong>APIåˆ†æç»“æœå±•ç¤º</strong>ï¼š</p>
<p><strong>æè¿°</strong>ï¼šé’ˆå¯¹ç”¨æˆ·è®¾ç½®çš„æ ¡å‡†èŠ‚ç‚¹åˆ—è¡¨node_listï¼Œä»å‚æ•°axisä¸­è·å–channelæ‰€åœ¨çš„ç»´åº¦ï¼Œè·å–èŠ‚ç‚¹è¾“å…¥æ•°æ®é€šé“é—´çš„æ•°æ®åˆ†å¸ƒã€‚ å…¶ä¸­axisé»˜è®¤ä¸ºNoneï¼Œæ­¤æ—¶è‹¥èŠ‚ç‚¹ä¸ºæƒé‡æ ¡å‡†èŠ‚ç‚¹ï¼Œåˆ™channelæ‰€åœ¨çš„ç»´åº¦é»˜è®¤ä¸º0ï¼›è‹¥èŠ‚ç‚¹ä¸ºæ¿€æ´»æ ¡å‡†èŠ‚ç‚¹ï¼Œåˆ™channelæ‰€åœ¨çš„ç»´åº¦é»˜è®¤ä¸º1ã€‚</p>
<p>æƒé‡æ ¡å‡†èŠ‚ç‚¹ï¼š</p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230511170356933.png"
                      class="" title="image-20230511170356933"
                >

<p>æ¿€æ´»æ ¡å‡†èŠ‚ç‚¹ï¼š</p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230511170406799.png"
                      class="" title="image-20230511170406799"
                >

<p>è¾“å‡ºç»“æœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230511170417646.png"
                      class="" title="image-20230511170417646"
                >

<p>å›¾ä¸­ï¼š</p>
<ul>
<li>æ¨ªåæ ‡è¡¨ç¤ºèŠ‚ç‚¹è¾“å…¥æ•°æ®çš„é€šé“æ•°ï¼Œå›¾ä¾‹ä¸­è¾“å…¥æ•°æ®æœ‰96ä¸ªé€šé“ã€‚</li>
<li>çºµåæ ‡è¡¨ç¤ºæ¯ä¸ªchannelçš„æ•°æ®åˆ†å¸ƒèŒƒå›´ï¼Œå…¶ä¸­çº¢è‰²å®çº¿è¡¨ç¤ºè¯¥channelæ•°æ®çš„ä¸­ä½æ•°ï¼Œè“è‰²è™šçº¿è¡¨ç¤ºå‡å€¼ã€‚</li>
</ul>
<h5 id="PTQæ¨¡å‹è½¬æ¢ç¤ºä¾‹æ‰‹å†Œ"><a href="#PTQæ¨¡å‹è½¬æ¢ç¤ºä¾‹æ‰‹å†Œ" class="headerlink" title="PTQæ¨¡å‹è½¬æ¢ç¤ºä¾‹æ‰‹å†Œ"></a>PTQæ¨¡å‹è½¬æ¢ç¤ºä¾‹æ‰‹å†Œ</h5><p><code>å°æŠ€å·§</code></p>
<ol>
<li>æˆ‘ä»¬æ¨èæ‚¨åœ¨ä½¿ç”¨æœ¬æ‰‹å†Œä¹‹å‰ï¼Œå…ˆé˜…è¯» <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/preface/toolchain_overview.html" >å·¥å…·é“¾æ¦‚è§ˆ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ç« èŠ‚ å’Œ <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/ptq/ptq_usage/ptq_usage.html" >PTQåŸç†åŠæ­¥éª¤ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> éƒ¨åˆ†ï¼Œ ä»¥ä¾¿å¯¹PTQè®­ç»ƒåé‡åŒ–æ–¹æ¡ˆï¼ˆä»¥ä¸‹ç®€ç§°ä¸º <strong>PTQæ–¹æ¡ˆ</strong>ï¼‰æœ‰ä¸€ä¸ªæ¯”è¾ƒå……åˆ†åœ°äº†è§£ã€‚</li>
<li>å¦‚æœæ‚¨åœ¨è¿›è¡Œè‡ªå®šä¹‰æ¨¡å‹è½¬æ¢æ—¶éœ€è¦äº†è§£PTQæµ®ç‚¹å®šç‚¹æ¨¡å‹è½¬æ¢æ–¹æ¡ˆå·¥å…·çš„ä½¿ç”¨ï¼Œ è¯·é˜…è¯» <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/ptq/ptq_tool/ptq_tool.html" >PTQå·¥å…·æ–‡æ¡£ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>ã€‚</li>
<li>åœ¨ä½¿ç”¨æ‰‹å†Œå®ŒæˆPTQç¤ºä¾‹åŒ…çš„æ¨¡å‹è½¬æ¢å·¥ä½œä¹‹åï¼Œè¯·ç»§ç»­é˜…è¯» <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/runtime/source/ai_benchmark/source/index.html" >AI_Benchmarkæ‰‹å†Œ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> å’Œ <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/runtime/source/bpu_sdk_api/source/index.html" >BPU SDK APIæ‰‹å†Œ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ç« èŠ‚è¿›è¡ŒåµŒå…¥å¼å¼€å‘å·¥ä½œï¼Œå°†æ¨¡å‹éƒ¨ç½²ä¸Šæ¿ã€‚</li>
</ol>
<p>PTQç¤ºä¾‹åŒ…å¸®åŠ©å¼€å‘è€…å¿«é€Ÿä½“éªŒå¹¶ä¸Šæ‰‹PTQè®­ç»ƒåé‡åŒ–æ–¹æ¡ˆã€‚ å¼€å‘è€…ä½¿ç”¨PTQç¤ºä¾‹åŒ…ä¸ä»…èƒ½å¤Ÿä½“éªŒå°†32ä½æµ®ç‚¹ï¼ˆFLOAT32ï¼‰ç²¾åº¦çš„ç¤ºä¾‹æ¨¡å‹è½¬æ¢ä¸ºå¯ä»¥åœ¨åœ°å¹³çº¿J5å¹³å°ä¸Šè¿è¡Œçš„8ä½å®šç‚¹æ•´æ•°(INT8)ç²¾åº¦çš„binæ¨¡å‹ï¼Œ è¿˜èƒ½å¤Ÿäº†è§£å¦‚ä½•ä½¿ç”¨PTQæ–¹æ¡ˆæä¾›çš„å·¥å…·ï¼Œå¹¶ä¸”åŸºäºç¤ºä¾‹è„šæœ¬è®¾è®¡è‡ªå®šä¹‰æ¨¡å‹è½¬æ¢ä¸šåŠ¡é€»è¾‘è„šæœ¬ã€‚</p>
<p>æœ¬æ‰‹å†Œæ—¨åœ¨æŒ‡å¯¼å¼€å‘è€…ä½¿ç”¨åœ°å¹³çº¿J5èŠ¯ç‰‡ç®—æ³•å·¥å…·é“¾çš„ <strong>PTQæ¨¡å‹è½¬æ¢ç¤ºä¾‹åŒ…</strong> ï¼ˆä»¥ä¸‹ç®€ç§°ä¸º <strong>PTQç¤ºä¾‹åŒ…</strong>ï¼‰ã€‚ æ‚¨å¯ä»¥åœ¨åœ°å¹³çº¿J5å¤©å·¥å¼€ç‰©å‘å¸ƒç‰©ï¼ˆå³ï¼šhorizon_j5_open_explorerï¼‰ä¸­è·å–PTQç¤ºä¾‹åŒ…ï¼š <code>ddk/samples/ai_toolchain/horizon_model_convert_sample</code>ã€‚</p>
<blockquote>
<p>å‘å¸ƒåŒ…ä»‹ç»</p>
</blockquote>
<p><strong>æ¨¡å‹é‡åŒ–ç¤ºä¾‹åŒ… <code>horizon_model_convert_sample</code></strong></p>
<p>æ³¨æ„ï¼šOEåŒ…é»˜è®¤ä¸æºå¸¦ç¤ºä¾‹å¯¹åº”çš„æ ¡å‡†æ•°æ®é›†å’ŒåŸå§‹æ¨¡å‹ï¼Œæ‚¨éœ€è¦åœ¨å¯¹åº”çš„ç¤ºä¾‹æ–‡ä»¶å¤¹å†…æ‰§è¡Œ <code>00_init.sh</code> è·å–å½“å‰ç¤ºä¾‹æ‰€éœ€çš„æ¨¡å‹å’Œæ ¡å‡†æ•°æ®é›†ã€‚</p>
<p>å…¨éƒ¨ç¤ºä¾‹çš„åŸå§‹æ¨¡å‹å’Œæ•°æ®é›†è·å–å®Œæˆåçš„æ¨¡å‹è½¬æ¢ç¤ºä¾‹åŒ…çš„ç›®å½•ç»“æ„å¦‚ä¸‹æ‰€ç¤º:</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">â”œâ”€â”€ 01_common                              # æ­¤è·¯å¾„åŒ…å«PTQç¤ºä¾‹åŒ…é€šç”¨è„šæœ¬å’Œæ•°æ®</span><br><span class="line">|   â”œâ”€â”€ calibration_data</span><br><span class="line">|   â”œâ”€â”€ data -&gt; /data/horizon_j5/data/     # ç”¨äºæ”¾ç½®å…¬å…±æ•°æ®é›†çš„è½¯é“¾æ¥</span><br><span class="line">|   â”œâ”€â”€ model_zoo -&gt; ../../../model_zoo    # ç”¨äºæ”¾ç½®æ¨¡å‹å‘å¸ƒç‰©çš„è½¯é“¾æ¥</span><br><span class="line">|   â”œâ”€â”€ python</span><br><span class="line">|   â”œâ”€â”€ README.md</span><br><span class="line">|   â”œâ”€â”€ test_data</span><br><span class="line">|   â””â”€â”€ tools</span><br><span class="line">â”œâ”€â”€ 02_preq_examples</span><br><span class="line">|   â”œâ”€â”€ 01_fcos_efficientnetb0</span><br><span class="line">|   â”œâ”€â”€ 02_fcos_efficientnetb2</span><br><span class="line">|   â”œâ”€â”€ 03_fcos_efficientnetb3</span><br><span class="line">|   â”œâ”€â”€ det_evaluate.py</span><br><span class="line">|   â”œâ”€â”€ det_inference.py</span><br><span class="line">|   â”œâ”€â”€ seg_evaluate.py</span><br><span class="line">|   â””â”€â”€ seg_inference.py</span><br><span class="line">â”œâ”€â”€ 03_classification                      # ç®—æ³•æ¨¡å‹ç¤ºä¾‹</span><br><span class="line">|   â”œâ”€â”€ 01_mobilenet</span><br><span class="line">|   â”œâ”€â”€ 02_googlenet</span><br><span class="line">|   â”œâ”€â”€ 03_resnet18</span><br><span class="line">|   â”œâ”€â”€ 05_efficientnet_lite0_onnx</span><br><span class="line">|   â”œâ”€â”€ 06_efficientnet_lite1_onnx</span><br><span class="line">|   â”œâ”€â”€ 07_efficientnet_lite2_onnx</span><br><span class="line">|   â”œâ”€â”€ 08_efficientnet_lite3_onnx</span><br><span class="line">|   â”œâ”€â”€ 09_efficientnet_lite4_onnx</span><br><span class="line">|   â”œâ”€â”€ 10_vargconvnet</span><br><span class="line">|   â”œâ”€â”€ 11_efficientnasnet_m</span><br><span class="line">|   â”œâ”€â”€ 12_efficientnasnet_s</span><br><span class="line">|   â”œâ”€â”€ cls_evaluate.py</span><br><span class="line">|   â””â”€â”€ cls_inference.py</span><br><span class="line">â”œâ”€â”€ 04_detection</span><br><span class="line">|   â”œâ”€â”€ 01_yolov2_darknet19</span><br><span class="line">|   â”œâ”€â”€ 02_yolov3_darknet53</span><br><span class="line">|   â”œâ”€â”€ 03_yolov5x</span><br><span class="line">|   â”œâ”€â”€ 04_ssd_mobilenetv1</span><br><span class="line">|   â”œâ”€â”€ 05_efficientdetd0</span><br><span class="line">|   â”œâ”€â”€ 06_centernet_resnet101</span><br><span class="line">|   â”œâ”€â”€ 07_fcos_efficientnetb0</span><br><span class="line">|   â”œâ”€â”€ 08_yolov4</span><br><span class="line">|   â”œâ”€â”€ 09_yolov3_vargdarknet</span><br><span class="line">|   â”œâ”€â”€ 10_fcos_resnet50</span><br><span class="line">|   â”œâ”€â”€ 11_fcos_resnext101</span><br><span class="line">|   â”œâ”€â”€ det_evaluate.py</span><br><span class="line">|   â””â”€â”€ det_inference.py</span><br><span class="line">â”œâ”€â”€ 05_miscellaneous</span><br><span class="line">|   â”œâ”€â”€ 01_lenet_gray</span><br><span class="line">|   â”œâ”€â”€ 02_resnet50_feature</span><br><span class="line">|   â”œâ”€â”€ 03_vector_diff</span><br><span class="line">|   â”œâ”€â”€ 04_multi_input_example</span><br><span class="line">|   â”œâ”€â”€ 07_model_verifier</span><br><span class="line">|   â”œâ”€â”€ 08_model_info</span><br><span class="line">|   â”œâ”€â”€ 09_mobilenet_bgr</span><br><span class="line">|   â”œâ”€â”€ 11_mobilenet_yuv444</span><br><span class="line">|   â””â”€â”€ mis_inference.py</span><br><span class="line">â”œâ”€â”€ 06_custom_op</span><br><span class="line">|   â””â”€â”€ mapper</span><br><span class="line">â”œâ”€â”€ 07_segmentation</span><br><span class="line">|   â”œâ”€â”€ 01_unet_mobilenet</span><br><span class="line">|   â”œâ”€â”€ 02_deeplabv3plus_efficientnetb0</span><br><span class="line">|   â”œâ”€â”€ 03_fastscnn_efficientnetb0</span><br><span class="line">|   â”œâ”€â”€ 04_deeplabv3plus_dilation1248</span><br><span class="line">|   â”œâ”€â”€ 05_deeplabv3plus_efficientnetm1</span><br><span class="line">|   â”œâ”€â”€ 06_deeplabv3plus_efficientnetm2</span><br><span class="line">|   â”œâ”€â”€ seg_evaluate.py</span><br><span class="line">|   â””â”€â”€ seg_inference.py</span><br><span class="line">â”œâ”€â”€ data_preprocess.py</span><br><span class="line">â””â”€â”€ version.txt</span><br></pre></td></tr></table></figure></div>

<p>ç¤ºä¾‹åŒ…ä¸­åŒ…å«çš„ä¸»è¦å†…å®¹ï¼š</p>
<p><a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/ptq/ptq_sample/algorithm_sample.html" >å¸¸è§ç®—æ³•æ¨¡å‹ç¤ºä¾‹ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p>å¸¸è§ç®—æ³•æ¨¡å‹ç¤ºä¾‹æ˜¯æŒ‡ <code>02_preq_examples/</code> ã€ <code>03_classification/</code> ã€ <code>04_detection/</code> å’Œ <code>07_segmentation/</code> æ–‡ä»¶å¤¹ä¸­çš„ç¤ºä¾‹ã€‚</p>
<p>è¿™äº›ç¤ºä¾‹çš„ä¸»è¦ç›®æ ‡æ˜¯æŒ‡å¯¼ç”¨æˆ·ï¼š</p>
<ul>
<li>å¿«é€Ÿä½“éªŒæ¨¡å‹è½¬æ¢çš„æµç¨‹ã€‚</li>
<li>å¿«é€Ÿè¯„æµ‹æ¨¡å‹è½¬æ¢çš„ç²¾åº¦ã€‚</li>
<li>ä½“éªŒè½¬æ¢çš„æ•ˆæœã€‚</li>
</ul>
<p><a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/ptq/ptq_sample/misc_sample.html" >å…¶ä»–ç®—æ³•æ¨¡å‹ç¤ºä¾‹ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p>å…¶ä»–ç®—æ³•æ¨¡å‹ç¤ºä¾‹æ˜¯æŒ‡ <code>05_miscellaneous/</code> å’Œ <code>06_custom_op/</code> æ–‡ä»¶å¤¹ä¸­çš„ç¤ºä¾‹ã€‚</p>
<ul>
<li><code>05_miscellaneous</code> ï¼Œæ‚é¡¹ç¤ºä¾‹ï¼ŒæŒ‡å¯¼ç”¨æˆ·ä½¿ç”¨åœ°å¹³çº¿èŠ¯ç‰‡å·¥å…·é“¾æä¾›çš„ä¸€äº›å…¶ä»–å†…å®¹ã€‚ æ¯”å¦‚ï¼šå¦‚ä½•ä½¿ç”¨åœ°å¹³çº¿æ¨¡å‹è½¬æ¢å·¥å…·ï¼Œä½¿rgbæ•°æ®è®­ç»ƒçš„æ¨¡å‹èƒ½åœ¨runtimeè¿è¡Œæ—¶æ¥å—yuvæ•°æ®ã€‚ <code>03_vector_diff</code> æŒ‡å¯¼ç”¨æˆ·å¦‚ä½•ä½¿ç”¨ <code>vec_diff</code> å·¥å…·æ¥å®šä½é—®é¢˜çš„ä¸€ä¸ªç¤ºä¾‹ã€‚</li>
<li><code>06_custom_op/</code> ä¸ºç”¨æˆ·è‡ªå®šä¹‰OPç¤ºä¾‹ï¼Œå¸®åŠ©ç”¨æˆ·äº†è§£å¦‚ä½•åœ¨æ¨¡å‹å«æœ‰å·¥å…·é“¾ä¸æ”¯æŒçš„ç®—å­çš„æƒ…å†µä¸‹æ·»åŠ è‡ªå®šä¹‰ç®—å­çš„åŠŸèƒ½ã€‚</li>
</ul>
<p><strong>æ¨¡å‹å‘å¸ƒç‰© <code>model_zoo</code></strong></p>
<p><code>model_zoo</code> åŒ…å«ä¸¤ä¸ªè·¯å¾„ï¼š <code>mapper</code> å’Œ <code>runtime</code>ã€‚ å…¶ä¸­ <code>mapper</code> è·¯å¾„ä¸‹åŒ…å«äº†PTQå’ŒQATæ–¹æ¡ˆè¿›è¡Œæ¨¡å‹è½¬æ¢æ—¶è¦ä½¿ç”¨çš„æ¨¡å‹ï¼ˆONNXæˆ–Caffeæ ¼å¼çš„æµ®ç‚¹æ¨¡å‹ï¼‰ï¼Œ å…¶ä¸­fcos_efficientnetb0ã€fcos_efficientnetb2å’Œfcos_efficientnetb3ä¸ºQATæ¨¡å‹ï¼Œå…¶ä½™ä¸ºPTQæ¨¡å‹ï¼› <code>runtime</code> è·¯å¾„ä¸‹åŒ…å«äº†åµŒå…¥å¼è¿è¡Œæ—¶å¼€å‘è¦ä½¿ç”¨çš„binæ¨¡å‹ã€‚</p>
<p>ä»¥ä¸‹ä»…å±•ç¤ºPTQå’ŒQATç¤ºä¾‹è¦ä½¿ç”¨çš„æ¨¡å‹å‘å¸ƒç‰©ï¼š</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line">â”œâ”€â”€ classification</span><br><span class="line">â”‚   â”œâ”€â”€ efficientnasnet</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ efficientnasnet-m.onnx</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ efficientnasnet.onnx</span><br><span class="line">â”‚   â”‚   â””â”€â”€ efficientnasnet-s.onnx</span><br><span class="line">â”‚   â”œâ”€â”€ efficientnet_lite_onnx</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ efficientnet_lite0_fp32.onnx</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ efficientnet_lite1_fp32.onnx</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ efficientnet_lite2_fp32.onnx</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ efficientnet_lite3_fp32.onnx</span><br><span class="line">â”‚   â”‚   â””â”€â”€ efficientnet_lite4_fp32.onnx</span><br><span class="line">â”‚   â”œâ”€â”€ googlenet</span><br><span class="line">â”‚   â”‚   â””â”€â”€ googlenet.onnx</span><br><span class="line">â”‚   â”œâ”€â”€ mobilenet</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ mobilenet.caffemodel</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ mobilenet_deploy.prototxt</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ mobilenet_v2.caffemodel</span><br><span class="line">â”‚   â”‚   â””â”€â”€ mobilenet_v2_deploy.prototxt</span><br><span class="line">â”‚   â”œâ”€â”€ mobilenet_onnx</span><br><span class="line">â”‚   â”‚   â””â”€â”€ mobilenetv2.onnx</span><br><span class="line">â”‚   â”œâ”€â”€ resnet18</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ resnet18.caffemodel</span><br><span class="line">â”‚   â”‚   â””â”€â”€ resnet18_deploy.prototxt</span><br><span class="line">â”‚   â”œâ”€â”€ resnet50</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ resnet_50.caffemodel</span><br><span class="line">â”‚   â”‚   â””â”€â”€ resnet_50_deploy.prototxt</span><br><span class="line">â”‚   â”œâ”€â”€ se_resnet_gray_onnx</span><br><span class="line">â”‚   â”‚   â””â”€â”€ se_resnet_gray.onnx</span><br><span class="line">â”‚   â””â”€â”€ vargnet</span><br><span class="line">â”‚       â””â”€â”€ vargconvnet.onnx</span><br><span class="line">â”œâ”€â”€ custom_op</span><br><span class="line">â”‚   â””â”€â”€ custom_op.onnx</span><br><span class="line">â”œâ”€â”€ detection</span><br><span class="line">â”‚   â”œâ”€â”€ centernet</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ centernet_resnet101_coco.onnx</span><br><span class="line">â”‚   â”‚   â””â”€â”€ centernet_resnet50.onnx</span><br><span class="line">â”‚   â”œâ”€â”€ efficientdetd0</span><br><span class="line">â”‚   â”‚   â””â”€â”€ efficientdet_nhwc.onnx</span><br><span class="line">â”‚   â”œâ”€â”€ fcos_efficientnetb0</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ fcos_effb0.onnx</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ fcos_efficientnetb0.onnx</span><br><span class="line">â”‚   â”‚   â””â”€â”€ fcos.onnx</span><br><span class="line">â”‚   â”œâ”€â”€ fcos_efficientnetb3</span><br><span class="line">â”‚   â”‚   â””â”€â”€ fcos_effb3.onnx</span><br><span class="line">â”‚   â”œâ”€â”€ fcos_resnet50</span><br><span class="line">â”‚   â”‚   â””â”€â”€ fcos_resnet50.onnx</span><br><span class="line">â”‚   â”œâ”€â”€ fcos_resnext101</span><br><span class="line">â”‚   â”‚   â””â”€â”€ fcos_resnext101.onnx</span><br><span class="line">â”‚   â”œâ”€â”€ ssd_mobilenetv1</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ mobilenet_iter_73000.caffemodel</span><br><span class="line">â”‚   â”‚   â””â”€â”€ MobileNetSSD_deploy.prototxt</span><br><span class="line">â”‚   â”œâ”€â”€ yolov2_darknet19</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ README.md</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ yolov2.caffemodel</span><br><span class="line">â”‚   â”‚   â””â”€â”€ yolov2_transposed.prototxt</span><br><span class="line">â”‚   â”œâ”€â”€ yolov3_darknet53</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ README.md</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ yolov3.caffemodel</span><br><span class="line">â”‚   â”‚   â””â”€â”€ yolov3_transposed.prototxt</span><br><span class="line">â”‚   â”œâ”€â”€ yolov3_vargdarknet</span><br><span class="line">â”‚   â”‚   â””â”€â”€ yolov3_vargdarknet53.onnx</span><br><span class="line">â”‚   â”œâ”€â”€ yolov4</span><br><span class="line">â”‚   â”‚   â””â”€â”€ yolov4_efficientnetb0.onnx</span><br><span class="line">â”‚   â””â”€â”€ yolov5_onnx_optimized</span><br><span class="line">â”‚       â”œâ”€â”€ YOLOv5l.onnx</span><br><span class="line">â”‚       â”œâ”€â”€ YOLOv5m.onnx</span><br><span class="line">â”‚       â”œâ”€â”€ YOLOv5s.onnx</span><br><span class="line">â”‚       â””â”€â”€ YOLOv5x.onnx</span><br><span class="line">â”œâ”€â”€ other</span><br><span class="line">â”‚   â”œâ”€â”€ fcos_efficientnetb0</span><br><span class="line">â”‚   â”‚   â””â”€â”€ fcos_efficientnetb0_qat.onnx</span><br><span class="line">â”‚   â”œâ”€â”€ lenet</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ lenet_iter_100000.caffemodel</span><br><span class="line">â”‚   â”‚   â””â”€â”€ lenet_train_test.prototxt</span><br><span class="line">â”‚   â”œâ”€â”€ mobilenetv2_three_inputs</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ mobilenetv2_three_inputs.caffemodel</span><br><span class="line">â”‚   â”‚   â””â”€â”€ mobilenetv2_three_inputs.prototxt</span><br><span class="line">â”‚   â”œâ”€â”€ multi_type</span><br><span class="line">â”‚   â”‚   â””â”€â”€ original_float_model.onnx</span><br><span class="line">â”‚   â”œâ”€â”€ resizer_model</span><br><span class="line">â”‚   â”‚   â””â”€â”€ resizer_model.onnx</span><br><span class="line">â”‚   â””â”€â”€ resnet50_feature</span><br><span class="line">â”‚       â”œâ”€â”€ resnet50_feature.caffemodel</span><br><span class="line">â”‚       â”œâ”€â”€ resnet50_feature_deploy.prototxt</span><br><span class="line">â”‚       â”œâ”€â”€ resnet50_pre.caffemodel</span><br><span class="line">â”‚       â””â”€â”€ resnet50_pre.prototxt</span><br><span class="line">â”œâ”€â”€ preq_examples</span><br><span class="line">â”‚   â””â”€â”€ fcos_efficientnet</span><br><span class="line">â”‚       â”œâ”€â”€ fcos_eff_b0.onnx</span><br><span class="line">â”‚       â”œâ”€â”€ fcos_eff_b2.onnx</span><br><span class="line">â”‚       â””â”€â”€ fcos_eff_b3.onnx</span><br><span class="line">â””â”€â”€ segmentation</span><br><span class="line">    â”œâ”€â”€ deeplabv3plus_efficientnetb0</span><br><span class="line">    â”‚   â”œâ”€â”€ deeplabv3_cityscapes_dila1248_permute.onnx</span><br><span class="line">    â”‚   â””â”€â”€ deeplabv3plus_efficientnetb0.onnx</span><br><span class="line">    â”œâ”€â”€ deeplabv3plus_efficientnetm</span><br><span class="line">    â”‚   â”œâ”€â”€ deeplabv3plus_efficientnetm1.onnx</span><br><span class="line">    â”‚   â””â”€â”€ deeplabv3plus_efficientnetm2.onnx</span><br><span class="line">    â”œâ”€â”€ fastscnn_efficientnetb0</span><br><span class="line">    â”‚   â””â”€â”€ fastscnn_efficientnetb0.onnx</span><br><span class="line">    â”œâ”€â”€ mobilenet_unet</span><br><span class="line">    â”‚   â””â”€â”€ tf_unet_trained.onnx</span><br><span class="line">    â””â”€â”€ unet_mobilenet</span><br><span class="line">        â””â”€â”€ tf_unet_trained.onnx</span><br></pre></td></tr></table></figure></div>

<p><strong>æ³¨æ„ï¼šæ­¤ç›®å½•æ ‘æ˜¯å®Œæ•´ç»“æ„å±•ç¤ºï¼Œå®é™…ä¸ŠOEåŒ…å¹¶æ²¡æœ‰ç›´æ¥æºå¸¦æ‰€æœ‰çš„æ¨¡å‹ã€‚æ­¤ç›®å½•æ ‘æ˜¯å®Œæ•´ç»“æ„å±•ç¤ºï¼Œå®é™…ä¸ŠOEåŒ…å¹¶æ²¡æœ‰ç›´æ¥æºå¸¦æ‰€æœ‰çš„æ¨¡å‹ã€‚</strong></p>
<blockquote>
<p>å¸¸è§çš„ç®—æ³•æ¨¡å‹ç¤ºä¾‹</p>
</blockquote>
<p><strong>ä½ç½®è·¯å¾„</strong></p>
<p>å¸¸è§ç®—æ³•æ¨¡å‹ç¤ºä¾‹ä½äº <code>horizon_model_convert_sample</code> è·¯å¾„çš„ï¼š <code>02_preq_examples/</code>ã€ <code>03_classification/</code>ã€ <code>04_detection/</code> å’Œ <code>07_segmentation/</code> æ–‡ä»¶å¤¹ä¸­ã€‚</p>
<p><strong>å¦‚ä½•å‡†å¤‡æ•°æ®é›†</strong></p>
<p>æ•°æ®é›†çš„ä¸‹è½½åœ°å€å¯å‚è€ƒä¸‹è¡¨ï¼š</p>
<table>
<thead>
<tr>
<th align="left"><strong>æ•°æ®é›†</strong></th>
<th align="left"><strong>ä¸‹è½½åœ°å€</strong></th>
</tr>
</thead>
<tbody><tr>
<td align="left">ImageNet</td>
<td align="left"><a class="link"   target="_blank" rel="noopener" href="https://www.image-net.org/download.php" >https://www.image-net.org/download.php <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></td>
</tr>
<tr>
<td align="left">COCO</td>
<td align="left"><a class="link"   target="_blank" rel="noopener" href="https://cocodataset.org/" >https://cocodataset.org/ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></td>
</tr>
<tr>
<td align="left">VOC</td>
<td align="left"><a class="link"   target="_blank" rel="noopener" href="http://host.robots.ox.ac.uk/pascal/VOC/" >http://host.robots.ox.ac.uk/pascal/VOC/ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ï¼ˆéœ€è¦ä¸‹è½½2007å’Œ2012ä¸¤ä¸ªç‰ˆæœ¬ï¼‰</td>
</tr>
<tr>
<td align="left">Cityscapes</td>
<td align="left"><a class="link"   target="_blank" rel="noopener" href="https://github.com/mcordts/cityscapesScripts" >https://github.com/mcordts/cityscapesScripts <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></td>
</tr>
<tr>
<td align="left">CIFAR-10</td>
<td align="left"><a class="link"   target="_blank" rel="noopener" href="http://www.cs.toronto.edu/~kriz/cifar.html" >http://www.cs.toronto.edu/~kriz/cifar.html <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></td>
</tr>
</tbody></table>
<ul>
<li><strong>æ•°æ®é›†å‚è€ƒç»“æ„</strong></li>
</ul>
<p><code>ImageNet</code></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">imagenet/</span><br><span class="line">â”œâ”€â”€ calibration_data</span><br><span class="line">â”‚   â”œâ”€â”€ ILSVRC2012_val_00000001.JPEG</span><br><span class="line">â”‚   â”œâ”€â”€ ...</span><br><span class="line">â”‚   â””â”€â”€ ILSVRC2012_val_00000100.JPEG</span><br><span class="line">â”œâ”€â”€ ILSVRC2017_val.txt</span><br><span class="line">â”œâ”€â”€ val</span><br><span class="line">â”‚   â”œâ”€â”€ ILSVRC2012_val_00000001.JPEG</span><br><span class="line">â”‚   â”œâ”€â”€ ...</span><br><span class="line">â”‚   â””â”€â”€ ILSVRC2012_val_00050000.JPEG</span><br><span class="line">â””â”€â”€ val.txt</span><br></pre></td></tr></table></figure></div>

<p><code>COCO </code></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">coco/</span><br><span class="line">â”œâ”€â”€ calibration_data</span><br><span class="line">â”‚   â”œâ”€â”€ COCO_val2014_000000181007.jpg</span><br><span class="line">â”‚   â”œâ”€â”€ ...</span><br><span class="line">â”‚   â””â”€â”€ COCO_val2014_000000181739.jpg</span><br><span class="line">â””â”€â”€ coco_val2017</span><br><span class="line">    â”œâ”€â”€ annotations</span><br><span class="line">    â”‚   â”œâ”€â”€ instances_train2017.json</span><br><span class="line">    â”‚   â””â”€â”€ instances_val2017.json</span><br><span class="line">    â””â”€â”€ images</span><br><span class="line">        â”œâ”€â”€ 000000000139.jpg</span><br><span class="line">        â”œâ”€â”€ 000000000285.jpg</span><br><span class="line">        â”œâ”€â”€ ...</span><br><span class="line">        â”œâ”€â”€ 000000581615.jpg</span><br><span class="line">        â””â”€â”€ 000000581781.jpg</span><br></pre></td></tr></table></figure></div>

<p><code>VOC</code></p>
<p>æ³¨æ„ï¼šVOC2012ç›®å½•ä¸‹ç›®å‰å­˜å‚¨äº†VOC2017å’ŒVOC2012ä¸¤ä»½æ•°æ®é›†ï¼Œè¯·æ‚¨æŒ‰ç…§å¦‚ä¸‹ç›®å½•ç»“æ„å¯¹è¯„æµ‹æ•°æ®é›†è¿›è¡Œå¤„ç†ã€‚</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">VOCdevkit/</span><br><span class="line">â””â”€â”€ VOC2012</span><br><span class="line">    â”œâ”€â”€ Annotations</span><br><span class="line">    â”‚   â”œâ”€â”€ 2007_000027.xml</span><br><span class="line">    â”‚   â”œâ”€â”€ ...</span><br><span class="line">    â”‚   â””â”€â”€ 2012_004331.xml</span><br><span class="line">    â”œâ”€â”€ ImageSets</span><br><span class="line">    â”‚   â”œâ”€â”€ Action</span><br><span class="line">    â”‚   â”‚   â”œâ”€â”€ jumping_train.txt</span><br><span class="line">    â”‚   â”‚   â”œâ”€â”€ jumping_trainval.txt</span><br><span class="line">    â”‚   â”‚   â”œâ”€â”€ jumping_val.txt</span><br><span class="line">    â”‚   â”‚   â”œâ”€â”€ ...</span><br><span class="line">    â”‚   â”‚   â”œâ”€â”€ val.txt</span><br><span class="line">    â”‚   â”‚   â”œâ”€â”€ walking_train.txt</span><br><span class="line">    â”‚   â”‚   â”œâ”€â”€ walking_trainval.txt</span><br><span class="line">    â”‚   â”‚   â””â”€â”€ walking_val.txt</span><br><span class="line">    â”‚   â”œâ”€â”€ Layout</span><br><span class="line">    â”‚   â”‚   â”œâ”€â”€ train.txt</span><br><span class="line">    â”‚   â”‚   â”œâ”€â”€ trainval.txt</span><br><span class="line">    â”‚   â”‚   â””â”€â”€ val.txt</span><br><span class="line">    â”‚   â”œâ”€â”€ Main</span><br><span class="line">    â”‚   â”‚   â”œâ”€â”€ aeroplane_train.txt</span><br><span class="line">    â”‚   â”‚   â”œâ”€â”€ aeroplane_trainval.txt</span><br><span class="line">    â”‚   â”‚   â”œâ”€â”€ aeroplane_val.txt</span><br><span class="line">    â”‚   â”‚   â”œâ”€â”€ ...</span><br><span class="line">    â”‚   â”‚   â”œâ”€â”€ train.txt</span><br><span class="line">    â”‚   â”‚   â”œâ”€â”€ train_val.txt</span><br><span class="line">    â”‚   â”‚   â”œâ”€â”€ trainval.txt</span><br><span class="line">    â”‚   â”‚   â”œâ”€â”€ tvmonitor_train.txt</span><br><span class="line">    â”‚   â”‚   â”œâ”€â”€ tvmonitor_trainval.txt</span><br><span class="line">    â”‚   â”‚   â”œâ”€â”€ tvmonitor_val.txt</span><br><span class="line">    â”‚   â”‚   â””â”€â”€ val.txt</span><br><span class="line">    â”‚   â””â”€â”€ Segmentation</span><br><span class="line">    â”‚       â”œâ”€â”€ train.txt</span><br><span class="line">    â”‚       â”œâ”€â”€ trainval.txt</span><br><span class="line">    â”‚       â””â”€â”€ val.txt</span><br><span class="line">    â”œâ”€â”€ JPEGImages</span><br><span class="line">    â”‚   â”œâ”€â”€ 2007_000027.jpg</span><br><span class="line">    â”‚   â”œâ”€â”€ ...</span><br><span class="line">    â”‚   â””â”€â”€ 2012_004331.jpg</span><br><span class="line">    â”œâ”€â”€ SegmentationClass</span><br><span class="line">    â”‚   â”œâ”€â”€ 2007_000032.png</span><br><span class="line">    â”‚   â”œâ”€â”€ ...</span><br><span class="line">    â”‚   â””â”€â”€ 2011_003271.png</span><br><span class="line">    â”œâ”€â”€ SegmentationObject</span><br><span class="line">    â”‚   â”œâ”€â”€ 2007_000032.png</span><br><span class="line">    â”‚   â”œâ”€â”€ ...</span><br><span class="line">    â”‚   â””â”€â”€ 2011_003271.png</span><br><span class="line">    â””â”€â”€ train.txt</span><br></pre></td></tr></table></figure></div>

<p><code>Cityscapes</code></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">cityscapes/</span><br><span class="line">â”œâ”€â”€ cityscapes_calibration_data</span><br><span class="line">â”‚   â”œâ”€â”€ aachen_000000_000019_leftImg8bit.png</span><br><span class="line">â”‚   â”œâ”€â”€ ...</span><br><span class="line">â”‚   â””â”€â”€ aachen_000099_000019_leftImg8bit.png</span><br><span class="line">â”œâ”€â”€ gtFine</span><br><span class="line">â”‚   â”œâ”€â”€ test</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ berlin</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ ...</span><br><span class="line">â”‚   â”‚   â””â”€â”€ munich</span><br><span class="line">â”‚   â”œâ”€â”€ train</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ aachen</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ ...</span><br><span class="line">â”‚   â”‚   â””â”€â”€ zurich</span><br><span class="line">â”‚   â””â”€â”€ val</span><br><span class="line">â”‚       â”œâ”€â”€ frankfurt</span><br><span class="line">â”‚       â”œâ”€â”€ lindau</span><br><span class="line">â”‚       â””â”€â”€ munster</span><br><span class="line">â”œâ”€â”€ leftImg8bit</span><br><span class="line">â”‚   â”œâ”€â”€ test</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ berlin</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ ...</span><br><span class="line">â”‚   â”‚   â””â”€â”€ munich</span><br><span class="line">â”‚   â”œâ”€â”€ train</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ aachen</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ ...</span><br><span class="line">â”‚   â”‚   â””â”€â”€ zurich</span><br><span class="line">â”‚   â””â”€â”€ val</span><br><span class="line">â”‚       â”œâ”€â”€ frankfurt</span><br><span class="line">â”‚       â”œâ”€â”€ lindau</span><br><span class="line">â”‚       â””â”€â”€ munster</span><br><span class="line">â”œâ”€â”€ license.txt</span><br><span class="line">â””â”€â”€ README</span><br></pre></td></tr></table></figure></div>

<p><code>CIFAR=10</code></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">cifar-10/</span><br><span class="line">â”œâ”€â”€ batches.meta</span><br><span class="line">â”œâ”€â”€ cifar10_val.txt</span><br><span class="line">â”œâ”€â”€ data_batch_1</span><br><span class="line">â”œâ”€â”€ data_batch_2</span><br><span class="line">â”œâ”€â”€ data_batch_3</span><br><span class="line">â”œâ”€â”€ data_batch_4</span><br><span class="line">â”œâ”€â”€ data_batch_5</span><br><span class="line">â”œâ”€â”€ readme.html</span><br><span class="line">â””â”€â”€ test_batch</span><br></pre></td></tr></table></figure></div>



<p><strong>å¦‚ä½•å‡†å¤‡æ¨¡å‹</strong></p>
<p>åœ¨ä½¿ç”¨æ¨¡å‹è½¬æ¢ç¤ºä¾‹åŒ…æ—¶ï¼Œè¯·æ‚¨å…ˆå‡†å¤‡å¥½å¯¹åº”çš„æµ®ç‚¹æ¨¡å‹ã€‚</p>
<p>OEåŒ…é»˜è®¤ä¸æºå¸¦ç¤ºä¾‹å¯¹åº”çš„æ ¡å‡†æ•°æ®é›†å’ŒåŸå§‹æ¨¡å‹ï¼Œæ‚¨éœ€è¦åœ¨å¯¹åº”çš„ç¤ºä¾‹æ–‡ä»¶å¤¹å†…æ‰§è¡Œ <code>00_init.sh</code> è·å–å½“å‰ç¤ºä¾‹æ‰€éœ€çš„æ¨¡å‹å’Œæ ¡å‡†æ•°æ®é›†ã€‚</p>
<p>è¯·æ‚‰çŸ¥ï¼Œä¸‹æ–¹æä¾›çš„æ¨¡å‹ç²¾åº¦æ•°æ®ä¸ºPython3.8ç¯å¢ƒä¸‹ï¼Œåœ°å¹³çº¿ä¸ºæ‚¨æä¾›çš„å‚è€ƒæ•°æ®ã€‚å¦‚æ‚¨çš„Pythonç‰ˆæœ¬ä¸ºPython3.6ï¼Œé‚£ä¹ˆæ•°æ®å¯èƒ½ä¼šæœ‰å¾®å°å·®è·ã€‚</p>
<p><code>fcos_efficientnetb0</code></p>
<p>æ³¨æ„ï¼š</p>
<ul>
<li>è¯¥æ¨¡å‹ä¸ºé‡‡ç”¨QATæ–¹å¼è®­ç»ƒå‡ºæ¥çš„æ¨¡å‹ã€‚</li>
<li>ä¸ºä¿è¯æ¿ç«¯æ€§èƒ½è¾¾åˆ°æœ€ä¼˜ï¼Œåœ¨ç¼–è¯‘binæ¨¡å‹çš„yamlæ–‡ä»¶ä¸­æˆ‘ä»¬å¯¹ <code>remove_node_type</code> å‚æ•°è¿›è¡Œäº†é…ç½®ï¼Œå°†binæ¨¡å‹ä¸­çš„DequantizeèŠ‚ç‚¹åšäº†åˆ é™¤çš„æ“ä½œã€‚</li>
</ul>
<blockquote>
<ol>
<li>åœ¨ç¼–è¯‘binæ¨¡å‹æ—¶ï¼Œéœ€è¦å°†æ¨¡å‹ä¼˜åŒ–ä¸ºç‰¹å®šç¡¬ä»¶çš„æŒ‡ä»¤é›†ï¼Œä»¥æé«˜æ¨¡å‹çš„æ‰§è¡Œæ•ˆç‡å’Œæ€§èƒ½ã€‚åœ¨ç‰¹å®šçš„ç¡¬ä»¶å¹³å°ä¸Šï¼Œæœ‰äº›èŠ‚ç‚¹ç±»å‹å¯èƒ½æ— æ³•è¢«æ‰§è¡Œï¼Œæˆ–è€…æ‰§è¡Œæ•ˆç‡å¾ˆä½ï¼Œä¼šå¯¼è‡´æ¨¡å‹çš„æ€§èƒ½ä¸‹é™ã€‚å› æ­¤ï¼Œåœ¨ç¼–è¯‘binæ¨¡å‹çš„yamlæ–‡ä»¶ä¸­ï¼Œå¯ä»¥æŒ‡å®šéœ€è¦åˆ é™¤çš„èŠ‚ç‚¹ç±»å‹ï¼Œä»¥ä¿è¯æ¨¡å‹çš„æ€§èƒ½è¾¾åˆ°æœ€ä¼˜ã€‚</li>
<li>åœ¨æœ¬ä¾‹ä¸­ï¼Œç”±äºæ‰§è¡ŒDequantizeæ“ä½œä¼šé™ä½æ¨¡å‹çš„æ‰§è¡Œæ•ˆç‡ï¼Œå› æ­¤åœ¨ç¼–è¯‘binæ¨¡å‹çš„è¿‡ç¨‹ä¸­ï¼Œé…ç½®äº†â€remove_node_typeâ€å‚æ•°ï¼Œå°†binæ¨¡å‹ä¸­çš„DequantizeèŠ‚ç‚¹åˆ é™¤ï¼Œä»è€Œæé«˜æ¿ç«¯çš„æ€§èƒ½ã€‚</li>
</ol>
</blockquote>
<p>1.æ¨¡å‹æ¥æºï¼š<a class="link"   target="_blank" rel="noopener" href="https://github.com/HorizonRobotics-Platform/ModelZoo/tree/master/PreQQAT" >https://github.com/HorizonRobotics-Platform/ModelZoo/tree/master/PreQQAT <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p>2.md5sumç </p>
<table>
<thead>
<tr>
<th align="left">md5sum</th>
<th align="left">File</th>
</tr>
</thead>
<tbody><tr>
<td align="left">be2fe17530bc366b038f5309199bf712</td>
<td align="left">fcos_eff_b0.onnx</td>
</tr>
</tbody></table>
<p>3.æ¨¡å‹ç²¾åº¦ï¼š</p>
<p><a href="0.276(FLOAT)/0.273(INT8)">IoU&#x3D;0.50:0.95</a>ï¼š0.348(FLOAT)&#x2F;0.348(INT8)</p>
<p><code>fcos_efficientnetb2</code></p>
<p>æ³¨æ„ï¼šä¸ºä¿è¯æ¿ç«¯æ€§èƒ½è¾¾åˆ°æœ€ä¼˜ï¼Œåœ¨ç¼–è¯‘binæ¨¡å‹çš„yamlæ–‡ä»¶ä¸­æˆ‘ä»¬å¯¹ <code>remove_node_type</code> å‚æ•°è¿›è¡Œäº†é…ç½®ï¼Œå°†binæ¨¡å‹ä¸­çš„DequantizeèŠ‚ç‚¹åšäº†åˆ é™¤çš„æ“ä½œã€‚</p>
<p>1.æ¨¡å‹æ¥æºï¼š<a class="link"   target="_blank" rel="noopener" href="https://github.com/HorizonRobotics-Platform/ModelZoo/tree/master/PreQQAT" >https://github.com/HorizonRobotics-Platform/ModelZoo/tree/master/PreQQAT <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p>2.md5sumç ï¼š</p>
<table>
<thead>
<tr>
<th align="left">md5sum</th>
<th align="left">File</th>
</tr>
</thead>
<tbody><tr>
<td align="left">58ffc007a2ab9a053a559945fb27fac8</td>
<td align="left">fcos_eff_b2.onnx</td>
</tr>
</tbody></table>
<p>3.æ¨¡å‹ç²¾åº¦ï¼š</p>
<p><a href="0.276(FLOAT)/0.273(INT8)">IoU&#x3D;0.50:0.95</a>ï¼š0.447(FLOAT)&#x2F;0.447(INT8)</p>
<p><code> fcos_efficientnetb3</code></p>
<p>ä¸ºä¿è¯æ¿ç«¯æ€§èƒ½è¾¾åˆ°æœ€ä¼˜ï¼Œåœ¨ç¼–è¯‘binæ¨¡å‹çš„yamlæ–‡ä»¶ä¸­æˆ‘ä»¬å¯¹ <code>remove_node_type</code> å‚æ•°è¿›è¡Œäº†é…ç½®ï¼Œå°†binæ¨¡å‹ä¸­çš„DequantizeèŠ‚ç‚¹åšäº†åˆ é™¤çš„æ“ä½œã€‚</p>
<p>1.æ¨¡å‹æ¥æºï¼š<a class="link"   target="_blank" rel="noopener" href="https://github.com/HorizonRobotics-Platform/ModelZoo/tree/master/PreQQAT" >https://github.com/HorizonRobotics-Platform/ModelZoo/tree/master/PreQQAT <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p>2.md5sumç ï¼š</p>
<table>
<thead>
<tr>
<th align="left">md5sum</th>
<th align="left">File</th>
</tr>
</thead>
<tbody><tr>
<td align="left">da37796ea8f2a4a54684a2520fdd6148</td>
<td align="left">fcos_eff_b3.onnx</td>
</tr>
</tbody></table>
<p>3.æ¨¡å‹ç²¾åº¦ï¼š</p>
<p><a href="0.276(FLOAT)/0.273(INT8)">IoU&#x3D;0.50:0.95</a>ï¼š0.472(FLOAT)&#x2F;0.473(INT8)</p>
<p><code>MobileNetv1/v2</code></p>
<p>1.æ¨¡å‹æ¥æºï¼š<a class="link"   target="_blank" rel="noopener" href="https://github.com/shicai/MobileNet-Caffe" >https://github.com/shicai/MobileNet-Caffe <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p>2.md5sumç ï¼š</p>
<table>
<thead>
<tr>
<th align="left">md5sum</th>
<th align="left">File</th>
</tr>
</thead>
<tbody><tr>
<td align="left">3fd6889ec48bda46451d67274144e2a8</td>
<td align="left">mobilenet.caffemodel</td>
</tr>
<tr>
<td align="left">8922f90f629d428fecf866e798ac7c08</td>
<td align="left">mobilenet_deploy.prototxt</td>
</tr>
<tr>
<td align="left">54aab8425ea068d472e8e4015f22360c</td>
<td align="left">mobilenet_v2.caffemodel</td>
</tr>
<tr>
<td align="left">13101ee86ab6d217d5fd6ed46f7a4faa</td>
<td align="left">mobilenet_v2_deploy.prototxt</td>
</tr>
</tbody></table>
<p>3.æ¨¡å‹ç²¾åº¦ï¼š</p>
<ul>
<li>MobileNetv1ï¼š0.7061(FLOAT)&#x2F;0.7026(INT8)</li>
<li>MobileNetv2ï¼š0.7165(FLOAT)&#x2F;0.7119(INT8)</li>
</ul>
<p><code>GoogleNet</code></p>
<p>1.æ¨¡å‹æ¥æºï¼š<a class="link"   target="_blank" rel="noopener" href="https://github.com/HorizonRobotics-Platform/ModelZoo/tree/master/GoogleNet" >https://github.com/HorizonRobotics-Platform/ModelZoo/tree/master/GoogleNet <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p>2.md5sumç ï¼š</p>
<table>
<thead>
<tr>
<th align="left">md5sum</th>
<th align="left">File</th>
</tr>
</thead>
<tbody><tr>
<td align="left">f107ae6806ea1016afbc718210b7a617</td>
<td align="left">googlenet.onnx</td>
</tr>
</tbody></table>
<p>3.æ¨¡å‹ç²¾åº¦ï¼š0.7001(FLOAT)&#x2F;0.6985(INT8)</p>
<p><code>ResNet18</code></p>
<p>1.æ¨¡å‹æ¥æºï¼š<a class="link"   target="_blank" rel="noopener" href="https://github.com/HolmesShuan/ResNet-18-Caffemodel-on-ImageNet" >https://github.com/HolmesShuan/ResNet-18-Caffemodel-on-ImageNet <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p>2.md5sumç ï¼š</p>
<table>
<thead>
<tr>
<th align="left">md5sum</th>
<th align="left">File</th>
</tr>
</thead>
<tbody><tr>
<td align="left">0904d601fc930d4f0c62a2a95b3c3b93</td>
<td align="left">resnet18.caffemodel</td>
</tr>
<tr>
<td align="left">ee8ac82cd693a0fe55af42cca3fc52e5</td>
<td align="left">resnet18_deploy.prototxt</td>
</tr>
</tbody></table>
<p>3.æ¨¡å‹ç²¾åº¦ï¼š0.6837(FLOAT)&#x2F;0.6831(INT8)</p>
<p><code>EfficientNet_Lite0/1/2/3/4</code></p>
<p>æ³¨æ„ï¼š</p>
<blockquote>
<p>ä¸ºäº†å¿«é€Ÿè¿è¡Œç¤ºä¾‹ï¼Œé¿å…ä½¿ç”¨ç¬¬ä¸‰æ–¹å·¥å…·å¸¦æ¥çš„é£é™©ï¼Œå¼ºçƒˆæ¨èæ‚¨ç›´æ¥ä½¿ç”¨åœ°å¹³çº¿æ¨¡å‹å‘å¸ƒç‰© <strong>model_zoo&#x2F;mapper&#x2F;</strong> è·¯å¾„ä¸‹å‡†å¤‡å¥½çš„ONNXæµ®ç‚¹æ¨¡å‹ã€‚ å¦‚æœæ‚¨æœ‰å…´è¶£å¤ç°tflite2onnxçš„æ¨¡å‹è½¬æ¢è¿‡ç¨‹ï¼Œä¹Ÿå¯ä»¥å°è¯•ä½¿ç”¨ä»¥ä¸‹ä¸‰æ–¹å·¥å…·ã€‚ä½†åœ°å¹³çº¿æ— æ³•ä¿è¯ç¬¬ä¸‰æ–¹å·¥å…·çš„è´¨é‡å’Œè½¬æ¢æˆåŠŸç‡ã€‚</p>
</blockquote>
<p>æ³¨æ„</p>
<p>ä¸ºäº†å¿«é€Ÿè¿è¡Œç¤ºä¾‹ï¼Œé¿å…ä½¿ç”¨ç¬¬ä¸‰æ–¹å·¥å…·å¸¦æ¥çš„é£é™©ï¼Œå¼ºçƒˆæ¨èæ‚¨ç›´æ¥ä½¿ç”¨åœ°å¹³çº¿æ¨¡å‹å‘å¸ƒç‰© <strong>model_zoo&#x2F;mapper&#x2F;</strong> è·¯å¾„ä¸‹å‡†å¤‡å¥½çš„ONNXæµ®ç‚¹æ¨¡å‹ã€‚ å¦‚æœæ‚¨æœ‰å…´è¶£å¤ç°tflite2onnxçš„æ¨¡å‹è½¬æ¢è¿‡ç¨‹ï¼Œä¹Ÿå¯ä»¥å°è¯•ä½¿ç”¨ä»¥ä¸‹ä¸‰æ–¹å·¥å…·ã€‚ä½†åœ°å¹³çº¿æ— æ³•ä¿è¯ç¬¬ä¸‰æ–¹å·¥å…·çš„è´¨é‡å’Œè½¬æ¢æˆåŠŸç‡ã€‚</p>
<p>1.æ¨¡å‹æ¥æºï¼šå¯ä» <a class="link"   target="_blank" rel="noopener" href="https://github.com/tensorflow/tpu/tree/master/models/official/efficientnet/lite" >https://github.com/tensorflow/tpu/tree/master/models/official/efficientnet/lite <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> è·å–taråŒ…ã€‚</p>
<p>2.åœ°å¹³çº¿æ¨¡å‹å‘å¸ƒç‰©ä¸­è½¬æ¢åçš„ONNXæ¨¡å‹md5sumç ï¼š</p>
<table>
<thead>
<tr>
<th align="left">md5sum</th>
<th align="left">File</th>
</tr>
</thead>
<tbody><tr>
<td align="left">001a329bd367fbec22b415c7a33d7bdb</td>
<td align="left">efficientnet_lite0_fp32.onnx</td>
</tr>
<tr>
<td align="left">1205e95aea66650c71292bde236d55a9</td>
<td align="left">efficientnet_lite1_fp32.onnx</td>
</tr>
<tr>
<td align="left">474741c15494b79a89fe51d89e0c43c7</td>
<td align="left">efficientnet_lite2_fp32.onnx</td>
</tr>
<tr>
<td align="left">550455b41848d333f8359279c89a6bae</td>
<td align="left">efficientnet_lite3_fp32.onnx</td>
</tr>
<tr>
<td align="left">bde7fe57eadb4a30ef76f68da622dcd5</td>
<td align="left">efficientnet_lite4_fp32.onnx</td>
</tr>
</tbody></table>
<p>3.ä¸‹è½½åå¯ä»taråŒ…ä¸­å¾—åˆ° <code>.tflite</code> æ–‡ä»¶ï¼Œç„¶åå¯é€šè¿‡tflite2onnxå·¥å…· (<a class="link"   target="_blank" rel="noopener" href="https://pypi.org/project/tflite2onnx/" >https://pypi.org/project/tflite2onnx/ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>) å°†tfliteè½¬æ¢ä¸ºONNXæ¨¡å‹ã€‚</p>
<p>ä¸åŒç‰ˆæœ¬çš„tflite2onnxè½¬æ¢å‡ºæ¥çš„layoutä¼šä¸ä¸€æ ·ï¼Œè‹¥è½¬æ¢å‡ºæ¥çš„ONNXæ¨¡å‹çš„è¾“å…¥layoutæ˜¯NCHWæ’å¸ƒï¼Œåˆ™buildæ—¶ <code>input_type_train</code> ä¸­ï¼š</p>
<ul>
<li>EfficientNet_Lite0åº”è¯¥é€‰æ‹© <code>NCHW</code>ï¼›</li>
<li>EfficientNet_Lite1åº”è¯¥é€‰æ‹© <code>NCHW</code>ï¼›</li>
<li>EfficientNet_Lite2åº”è¯¥é€‰æ‹© <code>NCHW</code>ï¼›</li>
<li>EfficientNet_Lite3åº”è¯¥é€‰æ‹© <code>NCHW</code>ï¼›</li>
<li>EfficientNet_Lite4åº”è¯¥é€‰æ‹© <code>NCHW</code>ã€‚</li>
</ul>
<p>4.æ¨¡å‹ç²¾åº¦ï¼š</p>
<ul>
<li>EfficientNet_Lite0ï¼š0.7490(FLOAT)&#x2F;0.7469(INT8)</li>
<li>EfficientNet_Lite1ï¼š0.7648(FLOAT)&#x2F;0.7624(INT8)</li>
<li>EfficientNet_Lite2ï¼š0.7738(FLOAT)&#x2F;0.7715(INT8)</li>
<li>EfficientNet_Lite3ï¼š0.7922(FLOAT)&#x2F;0.7902(INT8)</li>
<li>EfficientNet_Lite4ï¼š0.8069(FLOAT)&#x2F;0.8058(INT8)</li>
</ul>
<blockquote>
<p><code>tflite2onnx</code>æ˜¯ä¸€ä¸ªç”¨äºå°†TensorFlow Liteæ¨¡å‹ï¼ˆTFLiteæ¨¡å‹ï¼‰è½¬æ¢ä¸ºONNXï¼ˆOpen Neural Network Exchangeï¼‰æ ¼å¼çš„å·¥å…·ã€‚TensorFlow Liteæ˜¯ä¸€ç§é’ˆå¯¹ç§»åŠ¨è®¾å¤‡å’ŒåµŒå…¥å¼è®¾å¤‡çš„è½»é‡çº§æ·±åº¦å­¦ä¹ æ¨ç†æ¡†æ¶ï¼Œè€ŒONNXæ˜¯ä¸€ç§è·¨å¹³å°çš„å¼€æ”¾å¼æ·±åº¦å­¦ä¹ æ¨¡å‹è¡¨ç¤ºæ ¼å¼ã€‚</p>
<p>ç”±äºTensorFlow Liteå’ŒONNXæ˜¯ä¸åŒçš„æ¨¡å‹è¡¨ç¤ºæ ¼å¼ï¼Œå› æ­¤åœ¨æŸäº›æƒ…å†µä¸‹éœ€è¦å°†TFLiteæ¨¡å‹è½¬æ¢ä¸ºONNXæ ¼å¼ï¼Œä»¥ä¾¿åœ¨å…¶ä»–æ¡†æ¶æˆ–å¹³å°ä¸Šè¿›è¡Œè¿›ä¸€æ­¥çš„å¤„ç†å’Œæ¨ç†ã€‚</p>
<p><code>tflite2onnx</code>å·¥å…·æä¾›äº†å°†TFLiteæ¨¡å‹è½¬æ¢ä¸ºONNXæ¨¡å‹çš„åŠŸèƒ½ï¼Œå®ƒå¯ä»¥è§£æTFLiteæ¨¡å‹çš„ç»“æ„å’Œæƒé‡ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸ºä¸ONNXè§„èŒƒå…¼å®¹çš„æ¨¡å‹ã€‚è¿™æ ·ï¼Œæ‚¨å°±å¯ä»¥ä½¿ç”¨ONNXæ¨¡å‹åœ¨æ”¯æŒONNXçš„æ¡†æ¶ä¸­è¿›è¡Œæ¨ç†ï¼Œä¾‹å¦‚PyTorchã€TensorFlowã€ONNX Runtimeç­‰ã€‚</p>
<p>è¯·æ³¨æ„ï¼Œ<code>tflite2onnx</code>æ˜¯ä¸€ä¸ªç¬¬ä¸‰æ–¹å·¥å…·ï¼Œå®ƒä¸æ˜¯å®˜æ–¹çš„TensorFlowæˆ–ONNXé¡¹ç›®çš„ä¸€éƒ¨åˆ†ã€‚å› æ­¤ï¼Œåœ¨ä½¿ç”¨è¯¥å·¥å…·æ—¶ï¼Œè¯·ç¡®ä¿æ‚¨å·²æŸ¥çœ‹å’Œç†è§£äº†ç›¸å…³çš„æ–‡æ¡£å’Œä½¿ç”¨è¯´æ˜ã€‚</p>
</blockquote>
<p><code>vargconvnet</code></p>
<p>1.æ¨¡å‹æ¥æºï¼š<a class="link"   target="_blank" rel="noopener" href="https://github.com/HorizonRobotics-Platform/ModelZoo/tree/master/VargConvNet" >https://github.com/HorizonRobotics-Platform/ModelZoo/tree/master/VargConvNet <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p>2.md5sumç ï¼š</p>
<table>
<thead>
<tr>
<th align="left">md5sum</th>
<th align="left">File</th>
</tr>
</thead>
<tbody><tr>
<td align="left">e21b8db17916f9046253bbe0bb8de3ef</td>
<td align="left">vargconvnet.onnx</td>
</tr>
</tbody></table>
<p>3.æ¨¡å‹ç²¾åº¦ï¼š0.7790(FLOAT)&#x2F;0.7785(INT8)</p>
<p><code>efficientnasnet_m</code></p>
<p>1.æ¨¡å‹æ¥æºï¼š<a class="link"   target="_blank" rel="noopener" href="https://github.com/HorizonRobotics-Platform/ModelZoo/tree/master/EfficientnasNet" >https://github.com/HorizonRobotics-Platform/ModelZoo/tree/master/EfficientnasNet <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p>2.md5sumç ï¼š</p>
<table>
<thead>
<tr>
<th align="left">md5sum</th>
<th align="left">File</th>
</tr>
</thead>
<tbody><tr>
<td align="left">fc36c052c6f034c0b64a6197b91b0c62</td>
<td align="left">efficientnasnet-m.onnx</td>
</tr>
</tbody></table>
<p>3.æ¨¡å‹ç²¾åº¦ï¼š0.7973(FLOAT)&#x2F;0.7916(INT8)</p>
<p><code>efficientnasnet_s</code></p>
<p>1.æ¨¡å‹æ¥æºï¼š<a class="link"   target="_blank" rel="noopener" href="https://github.com/HorizonRobotics-Platform/ModelZoo/tree/master/EfficientnasNet" >https://github.com/HorizonRobotics-Platform/ModelZoo/tree/master/EfficientnasNet <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p>2.md5sumç ï¼š</p>
<table>
<thead>
<tr>
<th align="left">md5sum</th>
<th align="left">File</th>
</tr>
</thead>
<tbody><tr>
<td align="left">e2744bd748f4265f4488676835a6ca24</td>
<td align="left">efficientnasnet-s.onnx</td>
</tr>
</tbody></table>
<p>3.æ¨¡å‹ç²¾åº¦ï¼š0.7578(FLOAT)&#x2F;0.7518(INT8)</p>
<p><code>YOLOv2_Darknet19</code></p>
<ul>
<li>ä¸ºäº†å¿«é€Ÿè¿è¡Œç¤ºä¾‹ï¼Œé¿å…ä½¿ç”¨ç¬¬ä¸‰æ–¹å·¥å…·å¸¦æ¥çš„é£é™©ï¼Œå¼ºçƒˆæ¨èæ‚¨ç›´æ¥ä½¿ç”¨åœ°å¹³çº¿æ¨¡å‹å‘å¸ƒç‰© <strong>model_zoo&#x2F;mapper&#x2F;</strong> è·¯å¾„ä¸‹å‡†å¤‡å¥½çš„Caffeæµ®ç‚¹æ¨¡å‹ã€‚ å¦‚æœæ‚¨æœ‰å…´è¶£å¤ç°darknet2caffeçš„æ¨¡å‹è½¬æ¢è¿‡ç¨‹ï¼Œä¹Ÿå¯ä»¥å°è¯•ä½¿ç”¨ä»¥ä¸‹ä¸‰æ–¹å·¥å…·ã€‚ä½†åœ°å¹³çº¿æ— æ³•ä¿è¯ä¸‰æ–¹å·¥å…·çš„è´¨é‡å’Œè½¬æ¢æˆåŠŸç‡ã€‚</li>
<li>ä¸ºä¿è¯æ¿ç«¯æ€§èƒ½è¾¾åˆ°æœ€ä¼˜ï¼Œåœ¨ç¼–è¯‘binæ¨¡å‹çš„yamlæ–‡ä»¶ä¸­æˆ‘ä»¬å¯¹ remove_node_type å‚æ•°è¿›è¡Œäº†é…ç½®ï¼Œå°†binæ¨¡å‹ä¸­çš„DequantizeèŠ‚ç‚¹åšäº†åˆ é™¤çš„æ“ä½œã€‚</li>
</ul>
<p>1.YOLOv2_Darknet19æ¨¡å‹éœ€è¦é¦–å…ˆä»YOLOå®˜ç½‘(<a class="link"   target="_blank" rel="noopener" href="https://pjreddie.com/darknet/yolo/)%EF%BC%8C%E4%B8%8B%E8%BD%BDYOLOv2" >https://pjreddie.com/darknet/yolo/)ï¼Œä¸‹è½½YOLOv2 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> 608x608çš„.cfgå’Œ.weightæ–‡ä»¶ å¹¶ä½¿ç”¨darknet2caffe (<a class="link"   target="_blank" rel="noopener" href="https://github.com/xingyanan/darknet2caffe" >https://github.com/xingyanan/darknet2caffe <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>) è½¬æ¢å·¥å…·å°†å…¶è½¬æ¢ä¸ºcaffe modelã€‚</p>
<p><strong>æ³¨æ„ï¼š</strong></p>
<p>1.è¯¥è½¬æ¢å·¥å…·ï¼ˆdarknet2caffeï¼‰æ˜¯ä¸€ä¸ªç®€åŒ–ç‰ˆæœ¬ï¼Œä½¿ç”¨æ—¶ï¼Œéœ€è¦ä¿®æ”¹è¯¥å·¥å…·ç”Ÿæˆçš„.prototxtæ–‡ä»¶ï¼Œå°†å…¶ä¸­çš„ <code>&#39;Reshape&#39;</code> å±‚ä¿®æ”¹æˆ <code>&#39;Passthrough&#39;</code> å±‚ï¼Œ Passthrough å±‚å…·ä½“ä¿®æ”¹åçš„å‚æ•°è¯·è§æä¾›çš„yolov2.prototxtä¾‹å­ï¼Œå¹¶åœ¨è¾“å‡ºèŠ‚ç‚¹å¢åŠ ä¸€ä¸ªNCHW2NHWCçš„Permuteæ“ä½œã€‚</p>
<blockquote>
<p>è¯¥æ®µè¯æåˆ°çš„æ˜¯å°†darknetç½‘ç»œè½¬æ¢ä¸ºcaffeç½‘ç»œçš„é—®é¢˜ã€‚è½¬æ¢å·¥å…·æ˜¯ä¸€ä¸ªç®€åŒ–ç‰ˆï¼Œå®ƒå¯ä»¥å°†darknetç½‘ç»œè½¬æ¢ä¸ºcaffeç½‘ç»œï¼Œå¹¶ç”Ÿæˆ.prototxtæ–‡ä»¶ã€‚ä½†æ˜¯ï¼Œåœ¨åº”ç”¨ç”Ÿæˆçš„.prototxtæ–‡ä»¶ä¹‹å‰ï¼Œéœ€è¦æŒ‰ç…§ä»¥ä¸‹æ–¹æ³•å¯¹è¯¥æ–‡ä»¶è¿›è¡Œä¿®æ”¹ï¼š</p>
<ol>
<li>å°† â€˜Reshapeâ€™ å±‚ä¿®æ”¹æˆ â€˜Passthroughâ€™ å±‚ã€‚è¿™æ˜¯å› ä¸ºdarknetç½‘ç»œä¸­çš„ â€˜Reshapeâ€™ å±‚åœ¨caffeä¸­æ²¡æœ‰ç›´æ¥å¯¹åº”çš„å±‚ï¼Œéœ€è¦ä¿®æ”¹æˆ â€˜Passthroughâ€™ å±‚ï¼Œä»¥ä¿æŒç½‘ç»œç»“æ„ä¸€è‡´ã€‚æ‰€è°“çš„ â€˜Passthroughâ€™ å±‚å®é™…ä¸Šå°±æ˜¯å°†è¾“å…¥æ•°æ®ç›´æ¥ä¼ é€’åˆ°è¾“å‡ºæ•°æ®çš„å±‚ã€‚</li>
<li>å¯¹ â€˜Passthroughâ€™ å±‚è¿›è¡Œå…·ä½“çš„å‚æ•°ä¿®æ”¹ã€‚æ ¹æ®ç»™å‡ºçš„ä¾‹å­ï¼Œåœ¨ â€˜Passthroughâ€™ å±‚ä¸­æ·»åŠ ä¸€äº›å‚æ•°ï¼Œä»¥é€‚é…yolov2.prototxtä¸­çš„ç½‘ç»œç»“æ„ã€‚</li>
<li>åœ¨è¾“å‡ºèŠ‚ç‚¹å¢åŠ ä¸€ä¸ªNCHW2NHWCçš„Permuteæ“ä½œï¼Œä»¥å°†æ•°æ®ä»NCHWå½¢å¼çš„æ ¼å¼ï¼ˆåˆ—ä¼˜å…ˆï¼‰è½¬æ¢ä¸ºNHWCå½¢å¼çš„æ ¼å¼ï¼ˆè¡Œä¼˜å…ˆï¼‰ã€‚</li>
</ol>
</blockquote>
<p>2.md5sumç ï¼š</p>
<table>
<thead>
<tr>
<th align="left">md5sum</th>
<th align="left">File</th>
</tr>
</thead>
<tbody><tr>
<td align="left">7aa7a6764401cebf58e73e72fcbd2a45</td>
<td align="left">yolov2.caffemodel</td>
</tr>
<tr>
<td align="left">72e9a51c1e284e4b66e69f72ca9214c8</td>
<td align="left">yolov2_transposed.prototxt</td>
</tr>
</tbody></table>
<p>3.æ¨¡å‹ç²¾åº¦ï¼š</p>
<p><code>YOLOv3_Darknet53</code></p>
<p>æ³¨æ„ï¼šä¸ºä¿è¯æ¿ç«¯æ€§èƒ½è¾¾åˆ°æœ€ä¼˜ï¼Œåœ¨ç¼–è¯‘binæ¨¡å‹çš„yamlæ–‡ä»¶ä¸­æˆ‘ä»¬å¯¹ remove_node_type å‚æ•°è¿›è¡Œäº†é…ç½®ï¼Œå°†binæ¨¡å‹ä¸­çš„DequantizeèŠ‚ç‚¹åšäº†åˆ é™¤çš„æ“ä½œã€‚</p>
<p>1.YOLOv3_Darknet53æ¨¡å‹è·å–ï¼š</p>
<p>URLï¼š <a class="link"   target="_blank" rel="noopener" href="https://github.com/ChenYingpeng/caffe-yolov3/" >https://github.com/ChenYingpeng/caffe-yolov3/ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ï¼Œcaffemodelå¯ä»¥åœ¨è¯¥githubçš„README.mdæä¾›çš„ç™¾åº¦äº‘ä¸‹è½½è·¯å¾„ä¸­ä¸‹è½½ï¼Œå¹¶åœ¨è¾“å‡ºèŠ‚ç‚¹å¢åŠ ä¸€ä¸ªNCHW2NHWCçš„Permuteæ“ä½œã€‚</p>
<p>2.md5sumç ï¼š</p>
<table>
<thead>
<tr>
<th align="left">md5sum</th>
<th align="left">File</th>
</tr>
</thead>
<tbody><tr>
<td align="left">935af6e1530af5c0017b3674adce95e9</td>
<td align="left">yolov3_transposed.prototxt</td>
</tr>
<tr>
<td align="left">9a0f09c850656913ec27a6da06d9f9cc</td>
<td align="left">yolov3.caffemodel</td>
</tr>
</tbody></table>
<p>3.æ¨¡å‹ç²¾åº¦ï¼š</p>
<p><a href="0.276(FLOAT)/0.273(INT8)">IoU&#x3D;0.50:0.95</a>ï¼š0.333(FLOAT)&#x2F;0.335(INT8)</p>
<p><code>YOLOv5x</code></p>
<p>1.YOLOv5xæ¨¡å‹ï¼šå¯ä»¥ä»URLï¼š <a class="link"   target="_blank" rel="noopener" href="https://github.com/ultralytics/yolov5/releases/tag/v2.0" >https://github.com/ultralytics/yolov5/releases/tag/v2.0 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ä¸­ä¸‹è½½ç›¸åº”çš„ptæ–‡ä»¶ã€‚</p>
<p><strong>æ³¨æ„ï¼šåœ¨cloneä»£ç æ—¶ï¼Œè¯·ç¡®è®¤æ‚¨ä½¿ç”¨çš„Tagsæ˜¯ v2.0ï¼Œå¦åˆ™å°†å¯¼è‡´è½¬æ¢å¤±è´¥ã€‚</strong></p>
<p>2.md5sumç ï¼š</p>
<table>
<thead>
<tr>
<th align="left">md5sum</th>
<th align="left">File</th>
</tr>
</thead>
<tbody><tr>
<td align="left">2e296b5e31bf1e1b6b8ea4bf36153ea5</td>
<td align="left">yolov5l.pt</td>
</tr>
<tr>
<td align="left">16150e35f707a2f07e7528b89c032308</td>
<td align="left">yolov5m.pt</td>
</tr>
<tr>
<td align="left">42c681cf466c549ff5ecfe86bcc491a0</td>
<td align="left">yolov5s.pt</td>
</tr>
<tr>
<td align="left">069a6baa2a741dec8a2d44a9083b6d6e</td>
<td align="left">yolov5x.pt</td>
</tr>
</tbody></table>
<ul>
<li>ä¸ºäº†æ›´å¥½åœ°é€‚é…åå¤„ç†ä»£ç ï¼Œæˆ‘ä»¬åœ¨ONNXæ¨¡å‹å¯¼å‡ºå‰å¯¹Githubä»£ç åšäº†å¦‚ä¸‹ä¿®æ”¹ï¼ˆä»£ç å‚è§ï¼š<a class="link"   target="_blank" rel="noopener" href="https://github.com/ultralytics/yolov5/blob/v2.0/models/yolo.py%EF%BC%89%EF%BC%9A" >https://github.com/ultralytics/yolov5/blob/v2.0/models/yolo.pyï¼‰ï¼š <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></li>
</ul>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):</span><br><span class="line">    <span class="comment"># x = x.copy()  # for profiling</span></span><br><span class="line">    z = []  <span class="comment"># inference output</span></span><br><span class="line">    self.training |= self.export</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(self.nl):</span><br><span class="line">        x[i] = self.m[i](x[i])  <span class="comment"># conv</span></span><br><span class="line">        bs, _, ny, nx = x[i].shape  <span class="comment"># x(bs,255,20,20) to x(bs,3,20,20,85)</span></span><br><span class="line">        <span class="comment">#  x[i] = x[i].view(bs, self.na, self.no, ny, nx).permute(0, 1, 3, 4, 2).contiguous()</span></span><br><span class="line">        x[i] = x[i].permute(<span class="number">0</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>).contiguous()</span><br></pre></td></tr></table></figure></div>

<p><strong>æ³¨æ„ï¼šå»é™¤äº†æ¯ä¸ªè¾“å‡ºåˆ†æ”¯å°¾éƒ¨ä»4ç»´åˆ°5ç»´çš„reshapeï¼ˆå³ä¸å°†channelä»255æ‹†åˆ†æˆ3x85ï¼‰ï¼Œç„¶åå°†layoutä»NHWCè½¬æ¢æˆNCHWå†è¾“å‡ºã€‚</strong></p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230512090436547.png"
                      class="" title="image-20230512090436547"
                >

<ul>
<li>ä¸‹è½½å®Œæˆåé€šè¿‡è„šæœ¬ <a class="link"   target="_blank" rel="noopener" href="https://github.com/ultralytics/yolov5/blob/v2.0/models/export.py" >https://github.com/ultralytics/yolov5/blob/v2.0/models/export.py <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> è¿›è¡Œptæ–‡ä»¶åˆ°ONNXæ–‡ä»¶çš„è½¬æ¢ã€‚</li>
</ul>
<blockquote>
<p>åœ¨ä½¿ç”¨export.pyè„šæœ¬æ—¶ï¼Œè¯·æ³¨æ„ï¼š</p>
<ol>
<li>ç”±äºåœ°å¹³çº¿èŠ¯ç‰‡ç®—æ³•å·¥å…·é“¾æ”¯æŒçš„ONNX opsetç‰ˆæœ¬ä¸º 10 å’Œ 11ï¼Œè¯·å°† <code>torch.onnx.export</code> çš„ <code>opset_version</code> å‚æ•°æ ¹æ®æ‚¨è¦ä½¿ç”¨çš„ç‰ˆæœ¬è¿›è¡Œä¿®æ”¹ã€‚</li>
<li>å°† <code>torch.onnx.export</code> éƒ¨åˆ†çš„é»˜è®¤è¾“å…¥åç§°å‚æ•°ç”± <code>&#39;images&#39;</code> æ”¹ä¸º <code>&#39;data&#39;</code>ï¼Œä¸æ¨¡å‹è½¬æ¢ç¤ºä¾‹åŒ…çš„YOLOv5xç¤ºä¾‹è„šæœ¬ä¿æŒä¸€è‡´ã€‚</li>
<li>å°† <code>parser.add_argument</code> éƒ¨åˆ†ä¸­é»˜è®¤çš„æ•°æ®è¾“å…¥å°ºå¯¸640x640æ”¹ä¸ºæ¨¡å‹è½¬æ¢ç¤ºä¾‹åŒ…YOLOv5xç¤ºä¾‹ä¸­çš„672x672ã€‚</li>
</ol>
</blockquote>
<p>3.æ¨¡å‹ç²¾åº¦ï¼š</p>
<p><a href="0.276(FLOAT)/0.273(INT8)">IoU&#x3D;0.50:0.95</a>ï¼š0.480(FLOAT)&#x2F;0.466(INT8)</p>
<p><code>SSD_MobileNetv1</code></p>
<p>1.SSD_MobileNetv1æ¨¡å‹ï¼šå¯ä»¥ä»URLï¼š <a class="link"   target="_blank" rel="noopener" href="https://github.com/chuanqi305/MobileNet-SSD" >https://github.com/chuanqi305/MobileNet-SSD <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> è·å¾—Caffeæ¨¡å‹ã€‚</p>
<p>2.md5sumç ï¼š</p>
<table>
<thead>
<tr>
<th align="left">md5sum</th>
<th align="left">File</th>
</tr>
</thead>
<tbody><tr>
<td align="left">bbcb3b6a0afe1ec89e1288096b5b8c66</td>
<td align="left">mobilenet_iter_73000.caffemodel</td>
</tr>
<tr>
<td align="left">3c230e4415195a50c6248be80c49882d</td>
<td align="left">MobileNetSSD_deploy.prototxt</td>
</tr>
</tbody></table>
<p>3.æ¨¡å‹ç²¾åº¦(mAP)ï¼š0.7342(FLOAT)&#x2F;0.7277(INT8)</p>
<p><code>Efficientdetd0</code></p>
<p>1.æ¨¡å‹æ¥æºï¼š<a class="link"   target="_blank" rel="noopener" href="https://github.com/HorizonRobotics-Platform/ModelZoo/tree/master/EfficientDet" >https://github.com/HorizonRobotics-Platform/ModelZoo/tree/master/EfficientDet <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p>2.md5sumç ï¼š</p>
<table>
<thead>
<tr>
<th align="left">md5sum</th>
<th align="left">File</th>
</tr>
</thead>
<tbody><tr>
<td align="left">ec4129c4b300cd04f1e8f71e0fe54ca5</td>
<td align="left">efficientdet_nhwc.onnx</td>
</tr>
</tbody></table>
<p>3.æ¨¡å‹ç²¾åº¦ï¼š</p>
<p><a href="0.276(FLOAT)/0.273(INT8)">IoU&#x3D;0.50:0.95</a>ï¼š0.324(FLOAT)&#x2F;0.315(INT8)</p>
<p><code>CenterNet_Resnet101</code></p>
<p>1.æ¨¡å‹æ¥æºï¼š<a class="link"   target="_blank" rel="noopener" href="https://github.com/HorizonRobotics-Platform/ModelZoo/tree/master/Centernet" >https://github.com/HorizonRobotics-Platform/ModelZoo/tree/master/Centernet <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p>2.md5sumç ï¼š</p>
<table>
<thead>
<tr>
<th align="left">md5sum</th>
<th align="left">File</th>
</tr>
</thead>
<tbody><tr>
<td align="left">ba58170ee7ad0338dce3d46719329850</td>
<td align="left">centernet_resnet101_coco.onnx</td>
</tr>
</tbody></table>
<p>3.æ¨¡å‹ç²¾åº¦ï¼š</p>
<p><a href="0.276(FLOAT)/0.273(INT8)">IoU&#x3D;0.50:0.95</a>ï¼š0.342(FLOAT)&#x2F;0.331(INT8)</p>
<p><code>fcos_efficientnetb0</code></p>
<p>è¯¥æ¨¡å‹ä¸ºé‡‡ç”¨PTQæ–¹å¼è®­ç»ƒå‡ºæ¥çš„æ¨¡å‹ã€‚</p>
<p>1.æ¨¡å‹æ¥æºï¼š<a class="link"   target="_blank" rel="noopener" href="https://github.com/HorizonRobotics-Platform/ModelZoo/tree/master/Fcos_Efficientnetb0" >https://github.com/HorizonRobotics-Platform/ModelZoo/tree/master/Fcos_Efficientnetb0 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p>2.md5sumç ï¼š</p>
<table>
<thead>
<tr>
<th align="left">md5sum</th>
<th align="left">File</th>
</tr>
</thead>
<tbody><tr>
<td align="left">9f9a1fe8508e2bd068e70146eb559b4f</td>
<td align="left">fcos_efficientnetb0.onnx</td>
</tr>
</tbody></table>
<p>3.æ¨¡å‹ç²¾åº¦ï¼š</p>
<p><a href="0.276(FLOAT)/0.273(INT8)">IoU&#x3D;0.50:0.95</a>ï¼š0.358(FLOAT)&#x2F;0.351(INT8)</p>
<p><code>Yolov4</code></p>
<p>1.æ¨¡å‹æ¥æºï¼š<a class="link"   target="_blank" rel="noopener" href="https://github.com/HorizonRobotics-Platform/ModelZoo/tree/master/YoloV4" >https://github.com/HorizonRobotics-Platform/ModelZoo/tree/master/YoloV4 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p>2.md5sumç ï¼š</p>
<table>
<thead>
<tr>
<th align="left">md5sum</th>
<th align="left">File</th>
</tr>
</thead>
<tbody><tr>
<td align="left">aaa3c3e5e4c4c1d4830b6501b1720e4d</td>
<td align="left">yolov4.onnx</td>
</tr>
</tbody></table>
<p>3.æ¨¡å‹ç²¾åº¦ï¼š</p>
<p><a href="0.276(FLOAT)/0.273(INT8)">IoU&#x3D;0.50:0.95</a>ï¼š0.351(FLOAT)&#x2F;0.334(INT8)</p>
<p><code>YOLOv3_VargDarknet</code></p>
<p>.YOLOv3_VargDarknetæ¨¡å‹è·å–ï¼š</p>
<p>URLï¼š <a class="link"   target="_blank" rel="noopener" href="https://github.com/HorizonRobotics-Platform/ModelZoo/tree/master/Yolov3_VargDarknet" >https://github.com/HorizonRobotics-Platform/ModelZoo/tree/master/Yolov3_VargDarknet <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ï¼Œå¯ä»¥åœ¨è¯¥githubçš„README.mdæä¾›çš„ç™¾åº¦äº‘ä¸‹è½½è·¯å¾„ä¸­ä¸‹è½½ã€‚</p>
<p>2.md5sumç ï¼š</p>
<table>
<thead>
<tr>
<th align="left">md5sum</th>
<th align="left">File</th>
</tr>
</thead>
<tbody><tr>
<td align="left">fd4e46bc7c9798b51778d3aa09c5053a</td>
<td align="left">yolov3_vargdarknet53.onnx</td>
</tr>
</tbody></table>
<p>3.æ¨¡å‹ç²¾åº¦ï¼š</p>
<p><a href="0.276(FLOAT)/0.273(INT8)">IoU&#x3D;0.50:0.95</a>ï¼š0.335(FLOAT)&#x2F;0.327(INT8)</p>
<p><code>fcos_resnet50</code></p>
<p>1.æ¨¡å‹æ¥æºï¼š<a class="link"   target="_blank" rel="noopener" href="https://github.com/HorizonRobotics-Platform/ModelZoo/tree/master/Fcos_Resnet50" >https://github.com/HorizonRobotics-Platform/ModelZoo/tree/master/Fcos_Resnet50 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p>2.md5sumç ï¼š</p>
<table>
<thead>
<tr>
<th align="left">md5sum</th>
<th align="left">File</th>
</tr>
</thead>
<tbody><tr>
<td align="left">0218942777615fac2f54cefdac4fbfa7</td>
<td align="left">fcos_resnet50.onnx</td>
</tr>
</tbody></table>
<p>3.æ¨¡å‹ç²¾åº¦ï¼š</p>
<p><a href="0.276(FLOAT)/0.273(INT8)">IoU&#x3D;0.50:0.95</a>ï¼š0.426(FLOAT)&#x2F;0.424(INT8)</p>
<p><code>fcos_resnext101</code></p>
<p>1.æ¨¡å‹æ¥æºï¼š<a class="link"   target="_blank" rel="noopener" href="https://github.com/HorizonRobotics-Platform/ModelZoo/tree/master/Fcos_Resnext101" >https://github.com/HorizonRobotics-Platform/ModelZoo/tree/master/Fcos_Resnext101 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p>2.md5sumç ï¼š</p>
<table>
<thead>
<tr>
<th align="left">md5sum</th>
<th align="left">File</th>
</tr>
</thead>
<tbody><tr>
<td align="left">4b80efd22448021721ac5a860909c59f</td>
<td align="left">fcos_resnext101.onnx</td>
</tr>
</tbody></table>
<p>3.æ¨¡å‹ç²¾åº¦ï¼š</p>
<p><a href="0.276(FLOAT)/0.273(INT8)">IoU&#x3D;0.50:0.95</a>ï¼š0.453(FLOAT)&#x2F;0.450(INT8)</p>
<p><code>unet_mobilenet</code></p>
<p>1.æ¨¡å‹æ¥æºï¼š<a class="link"   target="_blank" rel="noopener" href="https://github.com/HorizonRobotics-Platform/ModelZoo/tree/master/MobilenetUnet" >https://github.com/HorizonRobotics-Platform/ModelZoo/tree/master/MobilenetUnet <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p>2.md5sumç ï¼š</p>
<table>
<thead>
<tr>
<th align="left">md5sum</th>
<th align="left">File</th>
</tr>
</thead>
<tbody><tr>
<td align="left">21c6c645ebca92befbebc8c39d385c1e</td>
<td align="left">tf_unet_trained.onnx</td>
</tr>
</tbody></table>
<p>3.æ¨¡å‹ç²¾åº¦ï¼š</p>
<p><a href="0.276(FLOAT)/0.273(INT8)">IoU&#x3D;0.50:0.95</a>ï¼š0.6411(FLOAT)&#x2F;0.6361(INT8)</p>
<p><code>deeplabV3plus_efficientnetb0</code></p>
<p>1.æ¨¡å‹æ¥æºï¼š<a class="link"   target="_blank" rel="noopener" href="https://github.com/HorizonRobotics-Platform/ModelZoo/tree/master/DeeplabV3Plus" >https://github.com/HorizonRobotics-Platform/ModelZoo/tree/master/DeeplabV3Plus <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p>2.md5sumç ï¼š</p>
<table>
<thead>
<tr>
<th align="left">md5sum</th>
<th align="left">File</th>
</tr>
</thead>
<tbody><tr>
<td align="left">c7a05f52619fafdc38178f2e7e41d748</td>
<td align="left">deeplabv3plus_efficientnetb0.onnx</td>
</tr>
</tbody></table>
<p>3.æ¨¡å‹ç²¾åº¦ï¼š</p>
<p><a href="0.276(FLOAT)/0.273(INT8)">IoU&#x3D;0.50:0.95</a>ï¼š0.7630(FLOAT)&#x2F;0.7568(INT8)</p>
<p><code>fastscnn_efficientnetb0</code></p>
<p>æ³¨æ„ï¼šä¸ºä¿è¯æ¿ç«¯æ€§èƒ½è¾¾åˆ°æœ€ä¼˜ï¼Œåœ¨ç¼–è¯‘binæ¨¡å‹çš„yamlæ–‡ä»¶ä¸­æˆ‘ä»¬å¯¹ remove_node_type å‚æ•°è¿›è¡Œäº†é…ç½®ï¼Œå°†binæ¨¡å‹ä¸­çš„Reshapeå’ŒCastèŠ‚ç‚¹åšäº†åˆ é™¤çš„æ“ä½œã€‚</p>
<p>1.æ¨¡å‹æ¥æºï¼š<a class="link"   target="_blank" rel="noopener" href="https://github.com/HorizonRobotics-Platform/ModelZoo/tree/master/FastSCNN" >https://github.com/HorizonRobotics-Platform/ModelZoo/tree/master/FastSCNN <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p>2.md5sumç ï¼š</p>
<table>
<thead>
<tr>
<th align="left">md5sum</th>
<th align="left">File</th>
</tr>
</thead>
<tbody><tr>
<td align="left">c1ace8f08a9c7b9c91509fa68327d0c8</td>
<td align="left">fastscnn_efficientnetb0.onnx</td>
</tr>
</tbody></table>
<p>3.æ¨¡å‹ç²¾åº¦ï¼š</p>
<p><a href="0.276(FLOAT)/0.273(INT8)">IoU&#x3D;0.50:0.95</a>ï¼š0.6997(FLOAT)&#x2F;0.6928(INT8)</p>
<p><code>deeplabv3plus_dilation1248</code></p>
<p>æ³¨æ„ï¼šä¸ºä¿è¯æ¿ç«¯æ€§èƒ½è¾¾åˆ°æœ€ä¼˜ï¼Œåœ¨ç¼–è¯‘binæ¨¡å‹çš„yamlæ–‡ä»¶ä¸­æˆ‘ä»¬å¯¹ remove_node_type å‚æ•°è¿›è¡Œäº†é…ç½®ï¼Œå°†binæ¨¡å‹ä¸­çš„TransposeèŠ‚ç‚¹åšäº†åˆ é™¤çš„æ“ä½œã€‚</p>
<p>1.æ¨¡å‹æ¥æºï¼š<a class="link"   target="_blank" rel="noopener" href="https://github.com/HorizonRobotics-Platform/ModelZoo/tree/master/DeeplabV3Plus" >https://github.com/HorizonRobotics-Platform/ModelZoo/tree/master/DeeplabV3Plus <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p>2.md5sumç ï¼š</p>
<table>
<thead>
<tr>
<th align="left">md5sum</th>
<th align="left">File</th>
</tr>
</thead>
<tbody><tr>
<td align="left">ad002e572cbb49e1e99d893aac69f3e3</td>
<td align="left">deeplabv3_cityscapes_dila1248_permute.onnx</td>
</tr>
</tbody></table>
<p>3.æ¨¡å‹ç²¾åº¦ï¼š</p>
<p><a href="0.276(FLOAT)/0.273(INT8)">IoU&#x3D;0.50:0.95</a>ï¼š0.7462(FLOAT)&#x2F;0.7452(INT8)</p>
<p><code>deeplabv3plus_efficientnetm1</code></p>
<p>æ³¨æ„ï¼šä¸ºä¿è¯æ¿ç«¯æ€§èƒ½è¾¾åˆ°æœ€ä¼˜ï¼Œåœ¨ç¼–è¯‘binæ¨¡å‹çš„yamlæ–‡ä»¶ä¸­æˆ‘ä»¬å¯¹ remove_node_type å‚æ•°è¿›è¡Œäº†é…ç½®ï¼Œå°†binæ¨¡å‹ä¸­çš„Reshapeã€Castå’ŒTransposeèŠ‚ç‚¹åšäº†åˆ é™¤çš„æ“ä½œã€‚</p>
<p>1.æ¨¡å‹æ¥æºï¼š<a class="link"   target="_blank" rel="noopener" href="https://github.com/HorizonRobotics-Platform/ModelZoo/tree/master/DeeplabV3Plus" >https://github.com/HorizonRobotics-Platform/ModelZoo/tree/master/DeeplabV3Plus <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p>2.md5sumç ï¼š</p>
<table>
<thead>
<tr>
<th align="left">md5sum</th>
<th align="left">File</th>
</tr>
</thead>
<tbody><tr>
<td align="left">644656b17452b32cf9dd3c1964c30436</td>
<td align="left">deeplabv3plus_efficientnetm1.onnx</td>
</tr>
</tbody></table>
<p>3.æ¨¡å‹ç²¾åº¦ï¼š</p>
<p><a href="0.276(FLOAT)/0.273(INT8)">IoU&#x3D;0.50:0.95</a>ï¼š0.7794(FLOAT)&#x2F;0.7740(INT8)</p>
<p><code>deeplabv3plus_efficientnetm2</code></p>
<p>ä¸ºä¿è¯æ¿ç«¯æ€§èƒ½è¾¾åˆ°æœ€ä¼˜ï¼Œåœ¨ç¼–è¯‘binæ¨¡å‹çš„yamlæ–‡ä»¶ä¸­æˆ‘ä»¬å¯¹ remove_node_type å‚æ•°è¿›è¡Œäº†é…ç½®ï¼Œå°†binæ¨¡å‹ä¸­çš„Reshapeã€Castå’ŒTransposeèŠ‚ç‚¹åšäº†åˆ é™¤çš„æ“ä½œã€‚</p>
<p>1.æ¨¡å‹æ¥æºï¼š<a class="link"   target="_blank" rel="noopener" href="https://github.com/HorizonRobotics-Platform/ModelZoo/tree/master/DeeplabV3Plus" >https://github.com/HorizonRobotics-Platform/ModelZoo/tree/master/DeeplabV3Plus <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p>2.md5sumç ï¼š</p>
<table>
<thead>
<tr>
<th align="left">md5sum</th>
<th align="left">File</th>
</tr>
</thead>
<tbody><tr>
<td align="left">c11a2673c4b3cf6e5d7bf1a051925d38</td>
<td align="left">deeplabv3plus_efficientnetm2.onnx</td>
</tr>
</tbody></table>
<p>3.æ¨¡å‹ç²¾åº¦ï¼š</p>
<p><a href="0.276(FLOAT)/0.273(INT8)">IoU&#x3D;0.50:0.95</a>ï¼š0.7882(FLOAT)&#x2F;0.7856(INT8)</p>
<p><strong>ç®—æ³•æ¨¡å‹ç¤ºä¾‹çš„ä½¿ç”¨æ¼”ç¤º</strong></p>
<p>æœ¬å°èŠ‚ä»¥YOLOv2_Darknet19æ¨¡å‹ä¸ºä¾‹ï¼Œä½¿ç”¨ç®—æ³•æ¨¡å‹ç¤ºä¾‹åŒ…ä¸­ <code>04_detection/01_yolov2_darknet19/mapper/</code> è·¯å¾„ä¸‹è„šæœ¬ åˆ†æ­¥éª¤æ¼”ç¤ºæµ®ç‚¹æ¨¡å‹åˆ°å®šç‚¹æ¨¡å‹è½¬æ¢è¿‡ç¨‹ä¸­çš„æ¨¡å‹æ£€æŸ¥ã€æ ¡å‡†æ•°æ®é›†å‡†å¤‡ã€runtimeæ¨¡å‹æ„å»ºåŠæ¨¡å‹ç²¾åº¦æµ‹è¯•å‡ ä¸ªå…³é”®æ­¥éª¤ã€‚</p>
<p><code>è¿›å…¥Dockerå®¹å™¨</code></p>
<p>é¦–å…ˆï¼Œæ ¹æ® <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/env_install/env_deploy.html#model-docker-env" >Dockerå®¹å™¨éƒ¨ç½² <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ä¸€èŠ‚å†…å®¹å®ŒæˆDockerç¯å¢ƒçš„å®‰è£…å’Œé…ç½®å¹¶è¿›å…¥dockerå®¹å™¨ã€‚</p>
<p><strong>éªŒè¯æ¨¡å‹æ˜¯å¦èƒ½å¤Ÿæ‰§è¡Œ</strong></p>
<ol>
<li>å¦‚ä¸‹æ‰€ç¤ºï¼Œè¿è¡Œè„šæœ¬ï¼š</li>
</ol>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 1. è¿›å…¥ç¤ºä¾‹è„šæœ¬æ”¾ç½®çš„æ–‡ä»¶å¤¹</span><br><span class="line">cd ddk/samples/ai_toolchain/horizon_model_convert_sample/04_detection/01_yolov2_darknet19/mapper</span><br><span class="line"># 2. æ‰§è¡Œæ¨¡å‹æ£€æŸ¥</span><br><span class="line">sh 01_check.sh</span><br></pre></td></tr></table></figure></div>

<ol>
<li>æ¨¡å‹æ£€æŸ¥è¾“å‡ºï¼š</li>
</ol>
<p>ä¸Šè¿°è„šæœ¬ä½¿ç”¨ <code>hb_mapper checker</code> å·¥å…·éªŒè¯æ¨¡å‹æ˜¯å¦è¢«åœ°å¹³çº¿èŠ¯ç‰‡æ”¯æŒã€‚åŒæ—¶ä¹Ÿä¼šè¾“å‡ºä¸€ä¸ªOPåˆ—è¡¨ï¼Œè¡¨ç¤ºæ¯ä¸ªOPä¼šCPUè¿˜æ˜¯BPUä¸Šæ‰§è¡Œã€‚ å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">===================================================</span><br><span class="line">Node         ON   Subgraph  Type</span><br><span class="line">---------------------------------------------------</span><br><span class="line">layer1_conv      BPU  id(0)     HzSQuantizedConv</span><br><span class="line">layer1_act       BPU  id(0)     HzLeakyRelu</span><br><span class="line">layer2_maxpool   BPU  id(0)     HzQuantizedMaxPool</span><br><span class="line">layer3_conv      BPU  id(0)     HzSQuantizedConv</span><br><span class="line">layer3_act       BPU  id(0)     HzLeakyRelu</span><br><span class="line">layer4_maxpool   BPU  id(0)     HzQuantizedMaxPool</span><br><span class="line">layer5_conv      BPU  id(0)     HzSQuantizedConv</span><br><span class="line">layer5_act       BPU  id(0)     HzLeakyRelu</span><br><span class="line">layer6_conv      BPU  id(0)     HzSQuantizedConv</span><br><span class="line">layer6_act       BPU  id(0)     HzLeakyRelu</span><br><span class="line">layer7_conv      BPU  id(0)     HzSQuantizedConv</span><br><span class="line">layer7_act       BPU  id(0)     HzLeakyRelu</span><br><span class="line">layer8_maxpool   BPU  id(0)     HzQuantizedMaxPool</span><br><span class="line">layer9_conv      BPU  id(0)     HzSQuantizedConv</span><br><span class="line">layer9_act       BPU  id(0)     HzLeakyRelu</span><br><span class="line">layer10_conv     BPU  id(0)     HzSQuantizedConv</span><br><span class="line">layer10_act      BPU  id(0)     HzLeakyRelu</span><br><span class="line">layer11_conv     BPU  id(0)     HzSQuantizedConv</span><br><span class="line">layer11_act      BPU  id(0)     HzLeakyRelu</span><br><span class="line">layer12_maxpool  BPU  id(0)     HzQuantizedMaxPool</span><br><span class="line">layer13_conv     BPU  id(0)     HzSQuantizedConv</span><br><span class="line">layer13_act      BPU  id(0)     HzLeakyRelu</span><br><span class="line">layer14_conv     BPU  id(0)     HzSQuantizedConv</span><br><span class="line">layer14_act      BPU  id(0)     HzLeakyRelu</span><br><span class="line">layer15_conv     BPU  id(0)     HzSQuantizedConv</span><br><span class="line">layer15_act      BPU  id(0)     HzLeakyRelu</span><br><span class="line">layer16_conv     BPU  id(0)     HzSQuantizedConv</span><br><span class="line">layer16_act      BPU  id(0)     HzLeakyRelu</span><br><span class="line">layer17_conv     BPU  id(0)     HzSQuantizedConv</span><br><span class="line">layer17_act      BPU  id(0)     HzLeakyRelu</span><br><span class="line">layer18_maxpool  BPU  id(0)     HzQuantizedMaxPool</span><br><span class="line">layer19_conv     BPU  id(0)     HzSQuantizedConv</span><br><span class="line">layer19_act      BPU  id(0)     HzLeakyRelu</span><br><span class="line">layer20_conv     BPU  id(0)     HzSQuantizedConv</span><br><span class="line">layer20_act      BPU  id(0)     HzLeakyRelu</span><br><span class="line">layer21_conv     BPU  id(0)     HzSQuantizedConv</span><br><span class="line">layer21_act      BPU  id(0)     HzLeakyRelu</span><br><span class="line">layer22_conv     BPU  id(0)     HzSQuantizedConv</span><br><span class="line">layer22_act      BPU  id(0)     HzLeakyRelu</span><br><span class="line">layer23_conv     BPU  id(0)     HzSQuantizedConv</span><br><span class="line">layer23_act      BPU  id(0)     HzLeakyRelu</span><br><span class="line">layer24_conv     BPU  id(0)     HzSQuantizedConv</span><br><span class="line">layer24_act      BPU  id(0)     HzLeakyRelu</span><br><span class="line">layer25_conv     BPU  id(0)     HzSQuantizedConv</span><br><span class="line">layer25_act      BPU  id(0)     HzLeakyRelu</span><br><span class="line">layer27_conv     BPU  id(0)     HzSQuantizedConv</span><br><span class="line">layer27_act      BPU  id(0)     HzLeakyRelu</span><br><span class="line">layer28_reorg    BPU  id(0)     HzSpaceToDepth</span><br><span class="line">layer29_concat   BPU  id(0)     Concat</span><br><span class="line">layer30_conv     BPU  id(0)     HzSQuantizedConv</span><br><span class="line">layer30_act      BPU  id(0)     HzLeakyRelu</span><br><span class="line">layer31_conv     BPU  id(0)     HzSQuantizedConv</span><br><span class="line">----------------------End--------------------------</span><br></pre></td></tr></table></figure></div>



<p><strong>å‡†å¤‡æ ¡å‡†ç”¨çš„æ•°æ®é›†</strong></p>
<p>åœ¨åŒä¸€è·¯å¾„ä¸‹ç»§ç»­æ‰§è¡Œ <code>02_preprocess.sh</code> è„šæœ¬ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># å°† 01_common/data/coco/calibration_dataä¸­çš„å›¾ç‰‡</span><br><span class="line"># è½¬æ¢åˆ°: ./calibration_data_rgb_f32</span><br><span class="line">sh 02_preprocess.sh</span><br></pre></td></tr></table></figure></div>

<p>æ³¨æ„ï¼š</p>
<ul>
<li>æˆ‘ä»¬ä»COCOæ•°æ®é›†æŠ½å–äº†50å¼ å›¾ä½œä¸ºæ ¡å‡†æ•°æ®é›†ï¼Œåœ¨æ ¡å‡†å‰ï¼Œæˆ‘ä»¬å¯¹æ•°æ®è¿›è¡Œäº†é¢„å¤„ç†ï¼š <strong>pad-resize&#x2F;è½¬ä¸ºrgb</strong>ã€‚</li>
<li><code>hb_mapper</code> å·¥å…·ä¼šä»è½¬æ¢å¾—åˆ°äºŒè¿›åˆ¶æ•°æ®ä¸­è¯»å–æ•°æ®ï¼Œé¢„å¤„ç†è¿‡çš„äºŒè¿›åˆ¶æ•°æ®æ–‡ä»¶æ ¼å¼ä¸ºï¼šc-orderçš„çŸ©é˜µå­˜å‚¨ã€‚æ¯ä¸ªçŸ©é˜µå€¼çš„æ•°æ®ç±»å‹ä¸ºint8ã€‚</li>
</ul>
<p><strong>buildå¼‚æ„æ¨¡å‹</strong></p>
<p>åœ¨åŒä¸€è·¯å¾„ä¸‹ç»§ç»­æ‰§è¡Œ <code>03_build.sh</code> è„šæœ¬ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sh 03_build.sh</span><br></pre></td></tr></table></figure></div>

<p>ä¸Šè¿°è„šæœ¬ä½¿ç”¨ <code>hb_mapper</code> å·¥å…·è½¬æ¢æ¨¡å‹ï¼Œæœ€éœ€è¦å…³æ³¨çš„æ˜¯è½¬æ¢çš„é…ç½®æ–‡ä»¶ï¼Œ è¯·å‚è€ƒ <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/ptq/ptq_usage/quantize_compile.html#makertbin" >ä½¿ç”¨ hb_mapper makertbin å·¥å…·è½¬æ¢æ¨¡å‹ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ä¸€èŠ‚çš„å†…å®¹ã€‚</p>
<p>ä¸Šè¿°è„šæœ¬çš„è¾“å‡ºå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; ls model_output | cat</span><br><span class="line">full_yolov2_subgraph_0.html</span><br><span class="line">full_yolov2_subgraph_0.json</span><br><span class="line">yolov2_darknet19_608x608_nv12.bin</span><br><span class="line">yolov2_darknet19_608x608_nv12_optimized_float_model.onnx</span><br><span class="line">yolov2_darknet19_608x608_nv12_original_float_model.onnx</span><br><span class="line">yolov2_darknet19_608x608_nv12_quantized_model.onnx</span><br></pre></td></tr></table></figure></div>

<p>æ‚¨æš‚æ—¶åªéœ€è¦å…³å¿ƒ <strong>yolov2_darknet19_608x608_nv12.bin</strong> æ–‡ä»¶ï¼Œå…¶ä»–æ–‡ä»¶ä¼šåœ¨å·¥å…·çš„ä»‹ç»ä¸­è¿›è¡Œè¯´æ˜ã€‚</p>
<p><strong>å•å¼ å›¾ç‰‡æ¨ç†</strong></p>
<p>æ‰§è¡Œ <code>04_inference.sh</code> è„šæœ¬è¿›è¡Œå•å¼ å›¾ç‰‡çš„æ¨ç†è¿‡ç¨‹ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sh 04_inference.sh</span><br></pre></td></tr></table></figure></div>

<ul>
<li>å› ä¸ºå›¾ç‰‡æ¨ç†è¿‡ç¨‹æ—¶ï¼Œéœ€è¦å¯¹å›¾ç‰‡è¿›è¡Œ <strong>å‰å¤„ç†</strong>ï¼Œå¯¹æ¨¡å‹æ•°æ®è¿›è¡Œ <strong>åå¤„ç†</strong>ï¼Œæ‰€ä»¥æˆ‘ä»¬æä¾›äº†ä¸€ä¸ªç¤ºä¾‹Pythonè„šæœ¬ã€‚å…·ä½“è¯·å‚è€ƒ <code>sh 04_inference.sh</code> ã€‚</li>
<li>æ­¤è„šæœ¬åªæ˜¯å¯¹å•å¼ å›¾ç‰‡è¿›è¡Œæ¨ç†ï¼ŒéªŒè¯å•å¼ å›¾ç‰‡çš„æ¨ç†ç»“æœæ˜¯å¦ç¬¦åˆé¢„æœŸï¼Œå¦‚æœæƒ³åšç²¾åº¦æµ‹è¯„ï¼Œå¯ä»¥å‚è€ƒ <code>05_evaluate.sh</code> è„šæœ¬ã€‚</li>
</ul>
<p><strong>ç²¾åº¦æµ‹è¯•</strong></p>
<p>ç»§ç»­æ‰§è¡Œ <code>05_evaluate.sh</code> è„šæœ¬è¿›è¡Œç²¾åº¦è¯„æµ‹ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export PARALLEL_PROCESS_NUM=$&#123;parallel_process_num&#125;</span><br><span class="line">sh 05_evaluate.sh</span><br></pre></td></tr></table></figure></div>

<ul>
<li>å› ä¸ºç²¾åº¦è¯„æµ‹æ—¶ï¼Œéœ€è¦å¯¹å›¾ç‰‡è¿›è¡Œ <strong>å‰å¤„ç†</strong>ï¼Œå¯¹æ¨¡å‹æ•°æ®è¿›è¡Œ <strong>åå¤„ç†</strong>ï¼Œæ‰€ä»¥æˆ‘ä»¬æä¾›äº†ä¸€ä¸ªç¤ºä¾‹Pythonè„šæœ¬ã€‚å…·ä½“è¯·å‚è€ƒ <code>sh 05_evaluate.sh</code>ã€‚</li>
<li>ä¸ºäº†åŠ å¿«è¯„æµ‹é€Ÿåº¦ï¼Œå¯ä»¥é€šè¿‡ <code>-p</code> é€‰é¡¹é€‚å½“è°ƒæ•´å¹¶å‘è¿›ç¨‹æ•°ï¼Œä½†éœ€è¦æ³¨æ„å†…å­˜çš„å ç”¨æƒ…å†µã€‚å½“ <code>-p</code> é€‰é¡¹å€¼ä¸å¡«æˆ–è€…è®¾ç½®ä¸º <code>0</code> æ—¶ï¼ŒCPUç¯å¢ƒä¸­çš„å®šç‚¹æ¨¡å‹å°†æŒ‰ç…§10ä¸ªè¿›ç¨‹æ•°å¤„ç†ï¼Œå…¶ä»–åœºæ™¯å‡æŒ‰1ä¸ªè¿›ç¨‹æ•°å¤„ç†ã€‚</li>
</ul>
<p><strong>å¸¸è§é—®é¢˜</strong></p>
<p><code>å¦‚ä½•å¯¹é½å¼€æºæ¡†æ¶è®­ç»ƒå¾—åˆ°çš„ONNXåŸå§‹æµ®ç‚¹æ¨¡å‹ä¸ä½¿ç”¨ </code>hb_mapper makertbin<code> å·¥å…·å¾—åˆ°çš„***_original_float_model.onnxçš„ç»“æœ</code></p>
<p><strong>åŸå§‹æµ®ç‚¹æ¨¡å‹ä¸è½¬æ¢å¾—åˆ°ONNXæµ®ç‚¹æ¨¡å‹çš„å·®å¼‚ç”±å·¥å…·é“¾äº§å“ä¿éšœï¼Œè¿™ç§éªŒè¯ä¸æ˜¯å¿…é¡»çš„æ ‡å‡†æµç¨‹ã€‚</strong></p>
<p><strong>1.æ˜ç¡®ä¸¤è€…çš„æ¦‚å¿µ</strong></p>
<p>é¦–å…ˆæ˜ç¡®ä¸¤ä¸ªæ¨¡å‹çš„æ¦‚å¿µã€‚</p>
<p>å‰è€…æ˜¯æŒ‡å¼€å‘è€…ä½¿ç”¨å¼€æºæ¡†æ¶ï¼ˆå¦‚ï¼šTensorFlowã€PyTorchã€MXNetç­‰ï¼‰è®­ç»ƒå‡ºæµ®ç‚¹æ¨¡å‹åï¼Œè½¬æˆONNXæ ¼å¼çš„åŸå§‹æµ®ç‚¹æ¨¡å‹ã€‚</p>
<p>è€Œåè€…æ˜¯æŒ‡ä½¿ç”¨èŠ¯ç‰‡å·¥å…·é“¾æµ®ç‚¹å®šç‚¹æ¨¡å‹è½¬æ¢æ–¹æ¡ˆçš„ <code>hb_mapper makertbin</code> å·¥å…·ï¼Œ æˆ–è¿è¡Œåœ°å¹³çº¿æ¨¡å‹è½¬æ¢ç¤ºä¾‹åŒ…ï¼ˆå³ï¼šhorizon_model_convert_sampleå‘å¸ƒç‰©ï¼‰ä¸­03_classification&#x2F;${modelname}&#x2F;mapper&#x2F;03_build.shå°†å‰è€… è½¬æ¢æˆ***_original_float_model.onnxä¸­é—´æ ¼å¼æ¨¡å‹ï¼Œå…¶ä¸­çš„***ä»£è¡¨çš„æ˜¯å…·ä½“æ¨¡å‹åç§°ï¼ˆå¦‚ï¼šMobileNetv1æˆ–GoogleNetç­‰ï¼‰ã€‚</p>
<p><strong>2.æ˜ç¡®ä¸¤è€…çš„å·®å¼‚</strong></p>
<p>***_original_float_model.onnxæ¨¡å‹è®¡ç®—ç²¾åº¦ä¸è½¬æ¢è¾“å…¥çš„åŸå§‹æµ®ç‚¹æ¨¡å‹æ˜¯ä¸€æ¨¡ä¸€æ ·çš„ï¼Œ <code>æœ‰ä¸ªé‡è¦çš„å˜åŒ–å°±æ˜¯ä¸ºäº†é€‚é…åœ°å¹³çº¿å¹³å°æ·»åŠ äº†ä¸€äº›æ•°æ®é¢„å¤„ç†è®¡ç®—</code>ã€‚ ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæ‚¨ä¸éœ€è¦ä½¿ç”¨è¿™ä¸ªæ¨¡å‹ï¼Œåœ¨è½¬æ¢ç»“æœå‡ºç°å¼‚å¸¸æ—¶ï¼Œå¦‚æœèƒ½æŠŠè¿™ä¸ªæ¨¡å‹æä¾›ç»™åœ°å¹³çº¿çš„æŠ€æœ¯æ”¯æŒï¼Œå°†æœ‰åŠ©äºå¸®åŠ©æ‚¨å¿«é€Ÿè§£å†³é—®é¢˜ã€‚</p>
<p><strong>3.ç¼–å†™è„šæœ¬å¯¹é½ä¸¤è€…ç»“æœ</strong></p>
<p>ä¸‹é¢ä»¥åœ°å¹³çº¿æ¨¡å‹è½¬æ¢ç¤ºä¾‹åŒ…ï¼ˆå³ï¼šhorizon_model_convert_sampleå‘å¸ƒç‰©ï¼‰ä¸­çš„googlenetæ¨¡å‹ä¸ºä¾‹è¿›è¡Œè¯´æ˜ã€‚</p>
<p>å¼€å‘è€…éœ€è¦è‡ªè¡Œç¼–å†™è„šæœ¬å¯¹é½ä¸¤è€…çš„ç»“æœã€‚</p>
<p>åœ¨ç¼–å†™è„šæœ¬æ—¶ï¼Œéœ€è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ã€‚</p>
<p><strong>æ³¨æ„ï¼šå¼€å‘è€…è‡ªç¼–å†™è„šæœ¬ä¸­çš„å›¾ç‰‡æ•°æ®å¤„ç†é€»è¾‘åº”å½“ä¸å·¥å…·é“¾ç¤ºä¾‹åŒ…å„æ¨¡å‹çš„mapper&#x2F;preprocess.pyå›¾ç‰‡æ•°æ®é¢„å¤„ç†è„šæœ¬ä¸­çš„é€»è¾‘ä¸€è‡´ï¼Œ ä»¥é¿å…ç”±å›¾ç‰‡æ•°æ®é¢„å¤„ç†æ–¹æ³•ä¸ä¸€è‡´é€ æˆçš„ç»“æœå·®å¼‚ã€‚ å¦‚é‡æ¨¡å‹ç¤ºä¾‹åŒ…ç‰ˆæœ¬ä¸åŒé€ æˆçš„ä»£ç é€»è¾‘å·®å¼‚ï¼Œè¯·å‚è§æ‚¨è·å–åˆ°çš„ç¤ºä¾‹åŒ…ç‰ˆæœ¬çš„å›¾ç‰‡æ•°æ®é¢„å¤„ç†è„šæœ¬ï¼Œæˆ–å’¨è¯¢åœ°å¹³çº¿æŠ€æœ¯å›¢é˜Ÿã€‚ å„é¢„å¤„ç†transformeræ–¹æ³•å‚è§ä»¥ä¸‹ä»£ç å—ï¼š</strong></p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">sys.path.append(<span class="string">&quot;../../../01_common/python/data/&quot;</span>)</span><br><span class="line"><span class="keyword">from</span> transformer <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> dataloader <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># å›¾ç‰‡æ ¡æ­£transformer</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">calibration_transformers</span>():</span><br><span class="line">  <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">  stepï¼š</span></span><br><span class="line"><span class="string">      1ã€short size resize to 256</span></span><br><span class="line"><span class="string">      2ã€crop size 224 * 224 from center</span></span><br><span class="line"><span class="string">      3ã€NHWC to NCHW</span></span><br><span class="line"><span class="string">      4ã€bgr to rgb</span></span><br><span class="line"><span class="string">  &quot;&quot;&quot;</span></span><br><span class="line">  transformers = [</span><br><span class="line">      ShortSideResizeTransformer(short_size=<span class="number">256</span>),</span><br><span class="line">      CenterCropTransformer(crop_size=<span class="number">224</span>),</span><br><span class="line">      HWC2CHWTransformer(),</span><br><span class="line">      BGR2RGBTransformer()</span><br><span class="line">  ]</span><br><span class="line">  <span class="keyword">return</span> transformers</span><br><span class="line"></span><br><span class="line"><span class="comment"># å›¾ç‰‡æ¨ç†transformer</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">infer_transformers</span>(<span class="params">input_layout=<span class="string">&quot;NHWC&quot;</span></span>):</span><br><span class="line">  <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">  stepï¼š</span></span><br><span class="line"><span class="string">      1ã€PIL resize to 256</span></span><br><span class="line"><span class="string">      2ã€crop size 224*224 from PIL center</span></span><br><span class="line"><span class="string">      3ã€bgr to nv12</span></span><br><span class="line"><span class="string">      4ã€nv12 to yuv444</span></span><br><span class="line"><span class="string">  :param input_layout: input layout</span></span><br><span class="line"><span class="string">  &quot;&quot;&quot;</span></span><br><span class="line">    transformers = [</span><br><span class="line">        PILResizeTransformer(size=<span class="number">256</span>),</span><br><span class="line">        PILCenterCropTransformer(size=<span class="number">224</span>),</span><br><span class="line">        BGR2NV12Transformer(data_format=<span class="string">&quot;HWC&quot;</span>),</span><br><span class="line">        NV12ToYUV444Transformer((<span class="number">224</span>, <span class="number">224</span>)),</span><br><span class="line">                                yuv444_output_layout=input_layout[<span class="number">1</span>:]),</span><br><span class="line">    ]</span><br><span class="line">    <span class="keyword">return</span> transformers</span><br></pre></td></tr></table></figure></div>

<p>å¼€å‘è€…å¯ä»¥å‚ç…§ä»¥ä¸‹ä»£ç å—å¯¹é½å›¾ç‰‡æ•°æ®é¢„å¤„ç†é€»è¾‘ï¼š</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">ShortSideResizeTransformer</span>(<span class="params">data, short_size</span>):</span><br><span class="line">    image = data</span><br><span class="line">    height, width, _ = image.shape</span><br><span class="line">    <span class="keyword">if</span> height &lt; width:</span><br><span class="line">        off = width / height</span><br><span class="line">        image = cv2.resize(image,</span><br><span class="line">                            (<span class="built_in">int</span>(short_size * off), short_size))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        off = height / width</span><br><span class="line">        image = cv2.resize(image,</span><br><span class="line">                            (short_size, <span class="built_in">int</span>(short_size * off)))</span><br><span class="line">    data = image</span><br><span class="line">    data = data.astype(np.float32)		<span class="comment">#å°† â€œdataâ€ çš„æ•°æ®ç±»å‹è½¬åŒ–ä¸º float32ã€‚</span></span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">CenterCropTransformer</span>(<span class="params">data, crop_size</span>):		<span class="comment">#ä¸­å¿ƒè£å‰ª</span></span><br><span class="line">    image = data</span><br><span class="line">    resize_height, resize_width, _ = image.shape</span><br><span class="line">    resize_up = resize_height // <span class="number">2</span> - crop_size // <span class="number">2</span></span><br><span class="line">    resize_left = resize_width // <span class="number">2</span> - crop_size // <span class="number">2</span></span><br><span class="line">    data = image[resize_up:resize_up +</span><br><span class="line">                    crop_size, resize_left:resize_left +</span><br><span class="line">                    crop_size, :]		<span class="comment">#è¿™è¡Œä»£ç å…¶å®æ˜¯åˆ©ç”¨ NumPy æ•°ç»„åˆ‡ç‰‡çš„æ–¹å¼ï¼Œä»æ•°ç»„ â€œimageâ€ ä¸­å–å‡ºä¸€ä¸ª crop å¤§å°çš„çŸ©å½¢åŒºåŸŸï¼Œå¹¶å°†å…¶èµ‹å€¼ç»™å˜é‡ â€œdataâ€ã€‚	ç¬¬ä¸€ç»´ä¸º â€œresize_up:resize_up + crop_sizeâ€ï¼Œè¡¨ç¤ºåœ¨ height ä¸Šå–å‡ºä¸€ä¸ªä» â€œresize_upâ€ å¼€å§‹ã€é•¿åº¦ä¸º â€œcrop_sizeâ€ çš„åŒºåŸŸã€‚</span></span><br><span class="line"><span class="comment">#ç¬¬äºŒç»´ä¸º â€œresize_left:resize_left + crop_sizeâ€ï¼Œè¡¨ç¤ºåœ¨ width ä¸Šå–å‡ºä¸€ä¸ªä» â€œresize_leftâ€ å¼€å§‹ã€é•¿åº¦ä¸º â€œcrop_sizeâ€ çš„åŒºåŸŸã€‚</span></span><br><span class="line"><span class="comment">#ç¬¬ä¸‰ç»´ä¸º â€œ:â€ï¼Œè¡¨ç¤ºåœ¨ channel ä¸Šå–å‡ºæ‰€æœ‰çš„å…ƒç´ ã€‚</span></span><br><span class="line">    data = data.astype(np.float32)</span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">preprocess</span>(<span class="params">data</span>):</span><br><span class="line">    data = ShortSideResizeTransformer(data, short_size=<span class="number">256</span>)  <span class="comment"># ShortSideResize</span></span><br><span class="line">    data = CenterCropTransformer(data, crop_size=<span class="number">224</span>)  <span class="comment"># CenterCrop</span></span><br><span class="line">    data = np.transpose(data, (<span class="number">2</span>, <span class="number">0</span>, <span class="number">1</span>))   <span class="comment"># HWC2CHW</span></span><br><span class="line">    data = data * <span class="number">255</span>  <span class="comment"># (0, 1) --&gt; (0, 255)</span></span><br></pre></td></tr></table></figure></div>

<p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œgooglenet_224x224_nv12_original_float_model.onnxæ¨¡å‹æ¯”åŸå§‹æµ®ç‚¹onnxæ¨¡å‹å¤šäº†HzPreprocessç®—å­ç”¨æ¥å®ç° googlenet_config.yamlæ–‡ä»¶ä¸­çš„ <code>data_mean_and_scale</code>ã€‚</p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230512102422982.png"
                      class="" title="image-20230512102422982"
                >

<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Normalize</span></span><br><span class="line">data = data.astype(np.float32)</span><br><span class="line">mean = np.array([<span class="number">127.5</span>, <span class="number">127.5</span>, <span class="number">127.5</span>])</span><br><span class="line">scale = np.array([<span class="number">0.0078431</span>, <span class="number">0.0078431</span>, <span class="number">0.0078431</span>])</span><br><span class="line">norm_data = np.zeros(data.shape).astype(np.float32)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(data.shape[<span class="number">0</span>]):</span><br><span class="line">    norm_data[i,:,:] = (data[i,:,:] - mean[i]) * scale[i]</span><br><span class="line">norm_data = norm_data.reshape(<span class="number">1</span>, <span class="number">3</span>, <span class="number">224</span>, <span class="number">224</span>).astype(np.float32)</span><br></pre></td></tr></table></figure></div>

<p>æ³¨æ„ï¼š<strong>ç”±äºç¤ºä¾‹åŒ…ä¸­å„æ¨¡å‹ <code>mapper/04_inference.sh</code> è„šæœ¬é»˜è®¤æ‰§è¡Œçš„æ˜¯å®šç‚¹æ¨¡å‹æ¨ç†</strong>ï¼Œå› æ­¤åœ¨éªŒè¯æµ®ç‚¹æ¨¡å‹ç»“æœæ—¶ï¼Œ éœ€è¦å°†å®šç‚¹æ¨¡å‹æ¨ç†æ”¹ä¸ºæµ®ç‚¹æ¨¡å‹æ¨ç†ã€‚æ‰§è¡Œå‘½ä»¤ <code>sh 04_inference.sh origin</code> å³å¯æ‰§è¡Œæµ®ç‚¹æ¨¡å‹æ¨ç†ã€‚ ä»£ç é€»è¾‘å¯èƒ½ç”±äºå‘å¸ƒç‰©ç‰ˆæœ¬ä¸åŒç•¥æœ‰å·®å¼‚ï¼Œå¯å‚è§ <code>03_classification/02_googlenet/mapper/04_inference.sh</code> è„šæœ¬ä¸­çš„æ³¨é‡Šå†…å®¹ã€‚</p>
<p>å®ç°ä¸Šè¿°æ­¥éª¤åå³å¯å¯¹é½åŸå§‹æµ®ç‚¹æ¨¡å‹ä¸googlenet_224x224_nv12_original_float_model.onnxæ¨¡å‹çš„ç»“æœäº†ã€‚<strong>å¯¹é½çš„æ˜¯è¾“å‡ºç»“æœ</strong></p>
<p><strong>å¤ç°çš„ç²¾åº¦ä¸ºä»€ä¹ˆä¸æ–‡æ¡£ä¸­æä¾›çš„æŒ‡æ ‡æœ‰ç»†å¾®å·®å¼‚</strong></p>
<p>å‡ºç°æ­¤ç§ç°è±¡çš„åŸå› å¯èƒ½æœ‰ä»¥ä¸‹ä¸¤ç‚¹ï¼š</p>
<ol>
<li>åœ¨ä¸åŒçš„æœåŠ¡å™¨ç¯å¢ƒä¸‹ï¼Œè®¡ç®—æ–¹å¼ä¸Šå¯èƒ½ä¼šæœ‰ç»†å°çš„åŒºåˆ«ã€‚å°±ä¼šå¯¼è‡´ä¸åŒçš„æœåŠ¡å™¨ç¯å¢ƒä¸­ï¼Œç¼–è¯‘å‡ºæ¥çš„å®šç‚¹onnxæ¨¡å‹çš„ç²¾åº¦ï¼Œä¸æ–‡æ¡£çš„è®°å½•å€¼æœ‰ç»†å¾®æ•°æ®æ³¢åŠ¨ã€‚</li>
<li>ç”¨æˆ·ä¾§ä½¿ç”¨çš„ç¬¬ä¸‰æ–¹åº“å¦‚ opencvã€numpyç­‰åº“çš„ç‰ˆæœ¬ä¸åŒï¼Œå¯¼è‡´å›¾ç‰‡ç»è¿‡å‰å¤„ç†åçš„å¾—åˆ°çš„ç»“æœä¸åŒï¼Œè¿™ç§æƒ…å†µä¹Ÿä¼šå¯¼è‡´ç²¾åº¦å¤ç°æ—¶ä¸æ–‡æ¡£ä¸­çš„è®°å½•å€¼æœ‰ç»†å¾®æ•°æ®æ³¢åŠ¨ã€‚</li>
</ol>
<p>å‡ºç°è¿™ç§æƒ…å†µï¼Œæ‚¨å¯ä»¥ä¸ç”¨è¿‡äºæ‹…å¿ƒï¼Œæ–‡æ¡£ä¸­æä¾›çš„è®°å½•æŒ‡æ ‡ä»…ä½œä¸ºå‚è€ƒï¼Œæ‚¨åœ¨å¤ç°æ—¶çš„ç²¾åº¦ä¸æ–‡æ¡£ä¸­çš„è®°å½•å€¼æœ‰ç»†å¾®å·®å¼‚æ˜¯æ­£å¸¸ç°è±¡ï¼Œå¯ä»¥æ­£å¸¸è·‘é€šç²¾åº¦å³å¯ã€‚</p>
<p><strong>å®šç‚¹æ¨¡å‹ç²¾åº¦ä¸ºä½•ä¸ai_benchmarkç¤ºä¾‹ä¸­çš„binæ–‡ä»¶ä¸Šæ¿ç²¾åº¦æ— æ³•å¯¹é½</strong></p>
<p>åœ¨æ ‡å‡†äº¤ä»˜ä¸­ï¼Œæˆ‘ä»¬åœ¨æ·»åŠ ç¤ºä¾‹çš„æ—¶å€™ï¼Œå®šç‚¹æ¨¡å‹ç²¾åº¦å’Œai_benchmarkç¤ºä¾‹ä¸­çš„binæ–‡ä»¶ä¸Šæ¿ç²¾åº¦æ˜¯å·²ç»åšäº†å¯¹é½å¤„ç†çš„ã€‚</p>
<p>å¦‚æœæ‚¨å‘ç°å®šç‚¹æ¨¡å‹ç²¾åº¦ä¸ai_benchmarkç¤ºä¾‹ä¸­çš„binæ–‡ä»¶ä¸Šæ¿ç²¾åº¦æ— æ³•å¯¹é½çš„æƒ…å†µï¼Œå»ºè®®æ‚¨ä¼˜å…ˆæ£€æŸ¥æ¨¡å‹è¾“å…¥æ˜¯å¦ä¸€è‡´ã€‚ ç”±äºæ‰§è¡Œå®šç‚¹æ¨¡å‹è¯„ä¼°è„šæœ¬æ—¶ï¼Œä½¿ç”¨åˆ°çš„æ˜¯å›¾ç‰‡ç±»å‹çš„æ•°æ®é›†ï¼›<strong>è€Œä¸Šæ¿ä½¿ç”¨åˆ°çš„ bin æ¨¡å‹ï¼Œéœ€è¦ä½¿ç”¨hb_eval_preprocesså·¥å…·è½¬æ¢åçš„äºŒè¿›åˆ¶æ•°æ®é›†</strong>ã€‚ åŸºäºæ­¤ç‚¹ï¼Œå¦‚æœæ‚¨åœ¨ä¸Šæ¿æ—¶ä½¿ç”¨çš„æ•°æ®é›†å¹¶éé€šè¿‡ä¸Šè¿°æ–¹å¼ç”Ÿæˆçš„, æˆ‘ä»¬å»ºè®®æ‚¨<strong>å…ˆåœ¨è¿è¡Œå®šç‚¹æ¨¡å‹çš„ç²¾åº¦çš„ç›¸åŒæœåŠ¡å™¨ä¸Šï¼Œ ä½¿ç”¨æˆ‘ä»¬çš„æ•°æ®é¢„å¤„ç†å·¥å…·ï¼ˆå³hb_eval_preprocesså·¥å…·ï¼‰é‡æ–°ç”Ÿæˆä¸Šæ¿éœ€è¦çš„æ•°æ®é›†ï¼Œé‡è·‘ä¸Šæ¿ç²¾åº¦ï¼Œä»¥ä¿è¯æ¨¡å‹è¾“å…¥ä¸€è‡´ã€‚</strong>ï¼ˆ<code>æœºå™¨ä¸åŒï¼Œæ•°æ®é›†è·å–åçš„ç²¾åº¦å¯èƒ½ä¸åŒï¼Œå¯¼è‡´äº†ç²¾åº¦ä¸åŒ</code>ï¼‰</p>
<p>æ³¨æ„ï¼šåœ¨ä½¿ç”¨hb_eval_preprocesså·¥å…·ç”Ÿæˆæ•°æ®é›†å’Œè¿è¡Œå®šç‚¹æ¨¡å‹ç²¾åº¦æ—¶ï¼Œä¸¤è€…ä½¿ç”¨çš„ç¯å¢ƒéœ€è¦ä¿è¯ä¸€è‡´ã€‚</p>
<blockquote>
<p>å…¶ä»–ç®—æ³•æ¨¡å‹ç¤ºä¾‹</p>
</blockquote>
<p>å…¶ä»–ç®—æ³•æ¨¡å‹ç¤ºä¾‹æ˜¯æŒ‡ <code>05_miscellaneous/</code> å’Œ <code>06_custom_op/</code> æ–‡ä»¶å¤¹ä¸­çš„ç¤ºä¾‹ã€‚</p>
<p>å…¶ä¸­ï¼š</p>
<ul>
<li><code>05_miscellaneous/</code> æ˜¯æ‚é¡¹ç¤ºä¾‹ï¼Œç”¨äºæŒ‡å¯¼ä½¿ç”¨j5å·¥å…·é“¾æä¾›çš„ä¸€äº›å…¶ä»–å†…å®¹ï¼Œ æ¯”å¦‚ï¼šå¦‚ä½•ä½¿ç”¨åœ°å¹³çº¿æ¨¡å‹è½¬æ¢å·¥å…·ä½¿RGBæ•°æ®è®­ç»ƒçš„æ¨¡å‹èƒ½åœ¨Runtimeè¿è¡Œæ—¶æ¥å—YUVæ•°æ®ã€‚</li>
<li><code>06_custom_op/</code> ä¸ºç”¨æˆ·è‡ªå®šä¹‰OPç¤ºä¾‹ï¼Œå¸®åŠ©ç”¨æˆ·äº†è§£å¦‚ä½•åœ¨æ¨¡å‹å«æœ‰å·¥å…·é“¾ä¸æ”¯æŒçš„ç®—å­çš„æƒ…å†µä¸‹æ·»åŠ è‡ªå®šä¹‰ç®—å­çš„åŠŸèƒ½ã€‚</li>
</ul>
<p><strong>å¦‚ä½•ä½¿ç”¨</strong></p>
<p>å¦‚ä¸Šæ‰€ç¤ºï¼Œåœ¨å„å­æ–‡ä»¶å¤¹ä¸‹ï¼Œæ¯ä¸ªä½¿ç”¨ç¤ºä¾‹éƒ½æŒ‰ç…§é¡ºåºå°è£…æˆäº†shellè„šæœ¬ï¼ŒæŒ‰ç…§shellè„šæœ¬é¡ºåºæ‰§è¡Œï¼Œ å³å¯äº†è§£ç›¸åº”çš„å·¥å…·çš„ä½¿ç”¨ã€APIçš„åŠŸèƒ½ä»¥åŠç”¨æ³•ç­‰ã€‚</p>
<p><strong>æ‚é¡¹ç¤ºä¾‹</strong></p>
<p><code>lenet_gray</code></p>
<ul>
<li>ç›®å½•ç»“æ„</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">01_lenet_gray/</span><br><span class="line">.</span><br><span class="line">â””â”€â”€ mapper</span><br><span class="line">    â”œâ”€â”€ 01_check.sh                 //å¯¹æ¨¡å‹è¿›è¡Œé¢„éªŒè¯</span><br><span class="line">    â”œâ”€â”€ 02_get_mnist.sh             //è·å–æ ¡å‡†æ•°æ®</span><br><span class="line">    â”œâ”€â”€ 03_build.sh                 //è½¬æ¢debugæ¨¡å‹</span><br><span class="line">    â”œâ”€â”€ 04_inference.sh             //ä½¿ç”¨onnx runtimeè¿›è¡Œæ¨ç†</span><br><span class="line">    â”œâ”€â”€ README.cn.md</span><br><span class="line">    â”œâ”€â”€ inference.py</span><br><span class="line">    â”œâ”€â”€ lenet_gray_config.yaml</span><br><span class="line">    â””â”€â”€ process_mnist.py</span><br></pre></td></tr></table></figure></div>

<ul>
<li>ç¤ºä¾‹å†…å®¹</li>
</ul>
<p>è¯¥ç¤ºä¾‹ä¸ºç°åº¦å›¾æ¨¡å‹çš„æ¨¡å‹è½¬æ¢ã€æ¨¡æ‹Ÿå™¨è¿è¡ŒåŠä¸Šæ¿è¿è¡Œç¤ºä¾‹ã€‚</p>
<p><code>resnet50_feature</code></p>
<ul>
<li>ç›®å½•ç»“æ„</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">02_resnet50_feature</span><br><span class="line">.</span><br><span class="line">â””â”€â”€ mapper</span><br><span class="line">    â”œâ”€â”€ 01_check.sh                 //å¯¹æ¨¡å‹è¿›è¡Œé¢„éªŒè¯</span><br><span class="line">    â”œâ”€â”€ 02_build.sh                 //è½¬æ¢debugæ¨¡å‹</span><br><span class="line">    â”œâ”€â”€ 03_inference.sh             //ä½¿ç”¨onnx runtimeè¿›è¡Œæ¨ç†</span><br><span class="line">    â”œâ”€â”€ README.cn.md</span><br><span class="line">    â”œâ”€â”€ inference.py</span><br><span class="line">    â””â”€â”€ resnet50_feature_config.yaml</span><br></pre></td></tr></table></figure></div>

<ul>
<li>ç¤ºä¾‹å†…å®¹</li>
</ul>
<p>è¯¥ç¤ºä¾‹ä¸ºresnet50_featureçš„æ¨¡å‹è½¬æ¢, æ¨¡æ‹Ÿå™¨è¿è¡ŒåŠä¸Šæ¿è¿è¡Œç¤ºä¾‹ã€‚</p>
<p><code>vector-diff</code></p>
<p><strong>ç›®å½•ç»“æ„</strong></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">03_vector_diff</span><br><span class="line">.</span><br><span class="line">â””â”€â”€ mobilenet_mapper</span><br><span class="line">    â”œâ”€â”€ 01_inference_rt.sh</span><br><span class="line">    â”œâ”€â”€ 02_vec_diff.sh                  // ä½¿ç”¨vec_diffå·¥å…·è¿›è¡Œè¾“å‡ºæ•°æ®åˆ†æ</span><br><span class="line">    â”œâ”€â”€ ILSVRC2012_val_00000001.bin</span><br><span class="line">    â””â”€â”€ readme.txt</span><br></pre></td></tr></table></figure></div>

<p><strong>è¾“å‡ºå†…å®¹</strong></p>
<p>ç”± <code>vec_diff -o</code> æŒ‡å®šçš„CSVæ–‡ä»¶ï¼Œåˆ—è¡¨ï¼ˆè¡¨é¡¹ä¸ºï¼šå·¦ä¾§æ–‡ä»¶åï¼Œå³ä¾§æ–‡ä»¶åï¼Œä½™å¼¦ç›¸ä¼¼åº¦ã€ç›¸å¯¹æ¬§æ‹‰è·ã€æœ€å¤§ç»å¯¹è¯¯å·®ã€æ–¹å·®ï¼‰ï¼Œå‚è€ƒå¦‚ä¸‹ï¼š</p>
<table>
<thead>
<tr>
<th align="left">Left Files</th>
<th align="left">Right Files</th>
<th align="left">Cosine Similarity</th>
<th align="left">Relative Euclidean Distance</th>
<th align="left">Max Absolute Error</th>
<th align="left">Mean Square Error</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Layerxxx-quanti-input.txt</td>
<td align="left">Layerxxx-float-input.txt</td>
<td align="left">xxx</td>
<td align="left">xxx</td>
<td align="left">xxx</td>
<td align="left">xxx</td>
</tr>
<tr>
<td align="left">Layerxxx-quanti-param.txt</td>
<td align="left">Layerxxx-float-param.txt</td>
<td align="left">xxx</td>
<td align="left">xxx</td>
<td align="left">xxx</td>
<td align="left">xxx</td>
</tr>
</tbody></table>
<p><code>multi_input_example</code></p>
<ul>
<li>ç›®å½•ç»“æ„</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">04_multi_input_example</span><br><span class="line">.</span><br><span class="line">â””â”€â”€ mapper</span><br><span class="line">    â”œâ”€â”€ 01_check.sh                 //å¯¹æ¨¡å‹è¿›è¡Œé¢„éªŒè¯</span><br><span class="line">    â”œâ”€â”€ 02_preprocess.sh            // å¯¹æ•°æ®è¿›è¡Œé¢„å¤„ç†</span><br><span class="line">    â”œâ”€â”€ 03_build.sh                 // è½¬æ¢debugæ¨¡å‹</span><br><span class="line">    â”œâ”€â”€ 04_inference.sh             // å•å¼ å›¾ç‰‡è¿›è¡Œæ¨ç†</span><br><span class="line">    â”œâ”€â”€ data_preprocess.py</span><br><span class="line">    â”œâ”€â”€ data_transformer.py</span><br><span class="line">    â”œâ”€â”€ inference.py</span><br><span class="line">    â”œâ”€â”€ Readme.cn.md</span><br><span class="line">    â””â”€â”€ mobilenetv2_multi_config.yaml</span><br></pre></td></tr></table></figure></div>

<ul>
<li>ç¤ºä¾‹å†…å®¹</li>
</ul>
<p>è¯¥ç¤ºä¾‹ä¸ºå¤šè¾“å…¥æ¨¡å‹çš„æ¨¡å‹è½¬æ¢ã€æ¨¡æ‹Ÿå™¨è¿è¡ŒåŠä¸Šæ¿è¿è¡Œç¤ºä¾‹ã€‚</p>
<p><code>model_verifier</code></p>
<ul>
<li>ç›®å½•ç»“æ„</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">07_model_verifier</span><br><span class="line">.</span><br><span class="line">â”œâ”€â”€ 01_preprocess.sh                // å¯¹æ•°æ®è¿›è¡Œé¢„å¤„ç†</span><br><span class="line">â”œâ”€â”€ 02_build.sh                     // è½¬æ¢debugæ¨¡å‹</span><br><span class="line">â”œâ”€â”€ 03_model_verify.sh              // æ‰§è¡Œæ¨¡å‹éªŒè¯</span><br><span class="line">â”œâ”€â”€ calibration_data_feature</span><br><span class="line">â”œâ”€â”€ data_preprocess.py</span><br><span class="line">â”œâ”€â”€ data_transformer.py</span><br><span class="line">â”œâ”€â”€ Readme.cn.md</span><br><span class="line">â”œâ”€â”€ mobilenet_config_bgr.yaml</span><br><span class="line">â”œâ”€â”€ mobilenet_config_yuv444.yaml</span><br><span class="line">â””â”€â”€ resnet50_featuremap_config.yaml</span><br></pre></td></tr></table></figure></div>

<ul>
<li>ç¤ºä¾‹å†…å®¹</li>
</ul>
<p>è¯¥ç¤ºä¾‹ä¸ºæ¨¡å‹éªŒè¯å·¥å…·çš„éªŒè¯ç¤ºä¾‹ã€‚</p>
<p><code>model_info</code></p>
<ul>
<li>ç›®å½•ç»“æ„</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">08_model_info</span><br><span class="line">.</span><br><span class="line">â”œâ”€â”€ 01_preprocess.sh                // å¯¹æ•°æ®è¿›è¡Œé¢„å¤„ç†</span><br><span class="line">â”œâ”€â”€ 02_build.sh                     // è½¬æ¢debugæ¨¡å‹</span><br><span class="line">â”œâ”€â”€ 03_model_info_check.sh          // æ‰§è¡Œæ¨¡å‹ä¿¡æ¯æ£€æµ‹å¹¶æ‰“å°</span><br><span class="line">â”œâ”€â”€ Readme.cn.md</span><br><span class="line">â”œâ”€â”€ mobilenet_config.yaml</span><br><span class="line">â””â”€â”€ preprocess.py</span><br></pre></td></tr></table></figure></div>

<ul>
<li>ç¤ºä¾‹å†…å®¹</li>
</ul>
<p>è¯¥ç¤ºä¾‹ä¸ºæ¨¡å‹ä¿¡æ¯è¾“å‡ºå·¥å…·çš„éªŒè¯ç¤ºä¾‹ã€‚</p>
<p><code>mobilenet_bgr</code></p>
<ul>
<li>ç›®å½•ç»“æ„</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">09_mobilenet_bgr</span><br><span class="line">.</span><br><span class="line">â””â”€â”€ mapper</span><br><span class="line">    â”œâ”€â”€ 01_check.sh               // å¯¹æ•°æ®æ¨¡å‹åšæ ¡éªŒ</span><br><span class="line">    â”œâ”€â”€ 02_preprocess.sh          // å¯¹æ•°æ®è¿›è¡Œé¢„å¤„ç†</span><br><span class="line">    â”œâ”€â”€ 03_build.sh               // æ¨¡å‹è½¬æ¢</span><br><span class="line">    â”œâ”€â”€ 04_inference.sh           // å•å¼ å›¾ç‰‡è¿›è¡Œæ¨ç†</span><br><span class="line">    â”œâ”€â”€ README.cn.md</span><br><span class="line">    â”œâ”€â”€ mobilenet_config.yaml</span><br><span class="line">    â”œâ”€â”€ postprocess.py</span><br><span class="line">    â””â”€â”€ preprocess.py</span><br></pre></td></tr></table></figure></div>

<ul>
<li>ç¤ºä¾‹å†…å®¹</li>
</ul>
<p>è¯¥ç¤ºä¾‹ä¸ºæ¨¡å‹ä¿¡æ¯è¾“å‡ºå·¥å…·çš„éªŒè¯ç¤ºä¾‹ã€‚</p>
<p><code>mobilenet_yuv444</code></p>
<ul>
<li>ç›®å½•ç»“æ„</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">11_mobilenet_yuv444</span><br><span class="line">.</span><br><span class="line">â””â”€â”€ mapper</span><br><span class="line">    â”œâ”€â”€ 01_check.sh               // å¯¹æ•°æ®æ¨¡å‹åšæ ¡éªŒ</span><br><span class="line">    â”œâ”€â”€ 02_preprocess.sh          // å¯¹æ•°æ®è¿›è¡Œé¢„å¤„ç†</span><br><span class="line">    â”œâ”€â”€ 03_build.sh               // æ¨¡å‹è½¬æ¢</span><br><span class="line">    â”œâ”€â”€ 04_inference.sh           // å•å¼ å›¾ç‰‡è¿›è¡Œæ¨ç†</span><br><span class="line">    â”œâ”€â”€ README.cn.md</span><br><span class="line">    â”œâ”€â”€ mobilenet_config.yaml</span><br><span class="line">    â”œâ”€â”€ postprocess.py</span><br><span class="line">    â””â”€â”€ preprocess.py</span><br></pre></td></tr></table></figure></div>

<ul>
<li>ç¤ºä¾‹å†…å®¹</li>
</ul>
<p>è¯¥ç¤ºä¾‹ä¸ºæ¨¡å‹ä¿¡æ¯è¾“å‡ºå·¥å…·çš„éªŒè¯ç¤ºä¾‹ã€‚</p>
<p><strong>ç”¨æˆ·è‡ªå®šä¹‰OPç¤ºä¾‹</strong></p>
<p><code>ç›®å½•ç»“æ„</code></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">06_custom_op</span><br><span class="line">.</span><br><span class="line">â””â”€â”€ mapper</span><br><span class="line">    â”œâ”€â”€ 02_preprocess.sh</span><br><span class="line">    â”œâ”€â”€ 03_build.sh</span><br><span class="line">    â”œâ”€â”€ 04_inference.sh</span><br><span class="line">    â”œâ”€â”€ 05_evaluate.sh</span><br><span class="line">    â”œâ”€â”€ cls_evaluate.py</span><br><span class="line">    â”œâ”€â”€ cls_inference.py</span><br><span class="line">    â”œâ”€â”€ googlenet_cop_config.yaml</span><br><span class="line">    â”œâ”€â”€ onnx_modify.py</span><br><span class="line">    â”œâ”€â”€ postprocess.py</span><br><span class="line">    â”œâ”€â”€ preprocess.py</span><br><span class="line">    â”œâ”€â”€ README.cn.md</span><br><span class="line">    â”œâ”€â”€ sample_custom.py</span><br><span class="line">    â””â”€â”€ torch_export.py</span><br></pre></td></tr></table></figure></div>

<p><code>ç¤ºä¾‹ä»‹ç»</code></p>
<p>å¼€å‘è€…ä½¿ç”¨åœ°å¹³çº¿å·¥å…·é“¾å°†å„å¼€æºæ¡†æ¶è®­ç»ƒå¾—åˆ°çš„æµ®ç‚¹æ¨¡å‹è½¬æ¢ä¸ºå®šç‚¹æ¨¡å‹æ—¶ï¼Œ å¦‚æœæµ®ç‚¹æ¨¡å‹ä¸­åŒ…å«äº†å·¥å…·é“¾ä¸æ”¯æŒçš„ç®—å­ï¼ˆä»¥ä¸‹ç®€ç§°ä¸ºOPï¼‰ï¼Œåˆ™ä¼šè½¬æ¢å¤±è´¥ã€‚ åœ¨æ­¤æƒ…å†µä¸‹ï¼Œå¼€å‘è€…å¯ä»¥ä½¿ç”¨å·¥å…·é“¾çš„è‡ªå®šä¹‰OPåŠŸèƒ½è‡ªè¡Œæ·»åŠ ä¸æ”¯æŒçš„OPï¼Œå®Œæˆæ¨¡å‹è½¬æ¢ã€‚</p>
<p>mapperæ–‡ä»¶å¤¹ä¸­åŒ…å«äº†æ‰§è¡Œæœ¬ç¤ºä¾‹æ‰€éœ€è¦çš„è„šæœ¬å’Œé…ç½®æ–‡ä»¶ã€‚</p>
<h5 id="é™„å½•"><a href="#é™„å½•" class="headerlink" title="é™„å½•"></a>é™„å½•</h5><p>æœ¬èŠ‚åŒ…æ‹¬ <strong>norm_typeé…ç½®è¯´æ˜</strong> ã€ <strong>transformerè¯´æ˜</strong> åŠ <strong>å¸¸è§æ•…éšœå¤„ç†</strong> è¯´æ˜ï¼Œ ä¸ºæ‚¨ä»‹ç»norm_typeç›¸å…³å‚æ•°ã€ç›¸å…³è®¡ç®—å…¬å¼çš„è¯´æ˜ä¸è§£æï¼Œå›¾ç‰‡ç¼©æ”¾è£å‰ªæ—¶ä½¿ç”¨çš„å„ä¸ªtransformerçš„æ¦‚å¿µã€å‚æ•°è¯´æ˜åŠç¤ºä¾‹ï¼Œå¸¸è§å¼‚å¸¸æ•…éšœç°è±¡é€šç”¨è§£å†³å»ºè®®ã€‚</p>
<blockquote>
<p>norm_typeé…ç½®è¯´æ˜</p>
</blockquote>
<p><strong>å‚æ•°è¯´æ˜è§£æ</strong></p>
<p><code>norm_type å‚æ•°è®²è§£</code></p>
<ul>
<li>å‚æ•°ä½œç”¨ï¼šæ­¤å‚æ•°ä¸ºåœ¨æ¨¡å‹ä¸­æ·»åŠ çš„è¾“å…¥æ•°æ®é¢„å¤„ç†æ–¹æ³•ã€‚</li>
<li>å‚æ•°å–å€¼èŒƒå›´åŠè¯´æ˜ï¼š<ul>
<li><code>no_preprocess</code> è¡¨ç¤ºä¸æ·»åŠ ä»»ä½•æ•°æ®é¢„å¤„ç†ã€‚</li>
<li><code>data_mean</code> è¡¨ç¤ºæä¾›å‡å‡å€¼é¢„å¤„ç†ã€‚</li>
<li><code>data_scale</code> è¡¨ç¤ºæä¾›ä¹˜scaleç³»æ•°é¢„å¤„ç†ã€‚</li>
<li><code>data_mean_and_scale</code> è¡¨ç¤ºæä¾›å…ˆå‡å‡å€¼å†ä¹˜scaleç³»æ•°å‰å¤„ç†ã€‚</li>
</ul>
</li>
</ul>
<p><strong>æ³¨æ„:å½“è¾“å…¥èŠ‚ç‚¹å¤šäºä¸€ä¸ªæ—¶ï¼Œè®¾ç½®çš„èŠ‚ç‚¹é¡ºåºéœ€è¦ä¸ <code>input_name</code> ä¸­çš„é¡ºåºä¸¥æ ¼ä¿æŒä¸€è‡´ã€‚</strong></p>
<p><code>mean_valueå‚æ•°è®²è§£</code></p>
<ul>
<li>å‚æ•°ä½œç”¨ï¼šæ­¤å‚æ•°è¡¨ç¤ºæŒ‡å®šé¢„å¤„ç†æ–¹æ³•çš„å›¾åƒå‡å»çš„å‡å€¼ã€‚</li>
<li>ä½¿ç”¨è¯´æ˜ï¼šå½“ <code>norm_type</code> å–å€¼ä¸º <code>data_mean_and_scale</code> æˆ– <code>data_mean</code> æ—¶éœ€è¦é…ç½®è¯¥å‚æ•°ã€‚</li>
<li>å‚æ•°è¯´æ˜ï¼š<ul>
<li>å½“åªæœ‰ä¸€ä¸ªè¾“å…¥èŠ‚ç‚¹æ—¶ï¼Œä»…éœ€è¦é…ç½®ä¸€ä¸ªæ•°å€¼ï¼Œè¡¨ç¤ºæ‰€æœ‰é€šé“éƒ½å‡å»è¿™ä¸ªå‡å€¼ã€‚</li>
<li>å½“æœ‰å¤šä¸ªèŠ‚ç‚¹æ—¶ï¼Œæä¾›ä¸é€šé“æ•°é‡ä¸€è‡´çš„æ•°å€¼ï¼ˆè¿™äº›æ•°å€¼ä»¥ç©ºæ ¼åˆ†éš”å¼€ï¼‰ï¼Œè¡¨ç¤ºæ¯ä¸ªé€šé“éƒ½ä¼šå‡å»ä¸åŒçš„å‡å€¼ã€‚</li>
</ul>
</li>
</ul>
<p>æ³¨æ„ï¼š</p>
<blockquote>
<ol>
<li>é…ç½®çš„è¾“å…¥èŠ‚ç‚¹æ•°é‡å¿…é¡»ä¸ <code>norm_type</code> é…ç½®çš„èŠ‚ç‚¹æ•°é‡ä¸€è‡´ã€‚</li>
<li>å¦‚æœå­˜åœ¨æŸä¸ªèŠ‚ç‚¹ä¸éœ€è¦ <code>mean</code> å¤„ç†ï¼Œåˆ™ä¸ºè¯¥èŠ‚ç‚¹é…ç½® <code>&#39;None&#39;</code>ã€‚</li>
</ol>
</blockquote>
<p><code>scale_valueå‚æ•°è®²è§£</code></p>
<ul>
<li>å‚æ•°ä½œç”¨ï¼šæ­¤å‚æ•°è¡¨ç¤ºæŒ‡å®šé¢„å¤„ç†æ–¹æ³•çš„æ•°å€¼scaleç³»æ•°ã€‚</li>
<li>ä½¿ç”¨è¯´æ˜ï¼šå½“ <code>norm_type</code> å–å€¼ä¸º <code>data_mean_and_scale</code> æˆ– <code>data_scale</code> æ—¶éœ€è¦é…ç½®è¯¥å‚æ•°ã€‚</li>
<li>å‚æ•°è¯´æ˜ï¼š<ul>
<li>å½“åªæœ‰ä¸€ä¸ªè¾“å…¥èŠ‚ç‚¹æ—¶ï¼Œä»…éœ€è¦é…ç½®ä¸€ä¸ªæ•°å€¼ï¼Œè¡¨ç¤ºæ‰€æœ‰é€šé“éƒ½ä¹˜ä»¥è¿™ä¸ªç³»æ•°ã€‚</li>
<li>å½“æœ‰å¤šä¸ªèŠ‚ç‚¹æ—¶ï¼Œæä¾›ä¸é€šé“æ•°é‡ä¸€è‡´çš„æ•°å€¼ï¼ˆè¿™äº›æ•°å€¼ä»¥ç©ºæ ¼åˆ†éš”å¼€ï¼‰ï¼Œè¡¨ç¤ºæ¯ä¸ªé€šé“éƒ½ä¼šä¹˜ä»¥ä¸åŒçš„ç³»æ•°ã€‚</li>
</ul>
</li>
</ul>
<p>æ³¨æ„ï¼š</p>
<blockquote>
<ol>
<li>é…ç½®çš„è¾“å…¥èŠ‚ç‚¹æ•°é‡å¿…é¡»ä¸ <code>norm_type</code> é…ç½®çš„èŠ‚ç‚¹æ•°é‡ä¸€è‡´ã€‚</li>
<li>å¦‚æœå­˜åœ¨æŸä¸ªèŠ‚ç‚¹ä¸éœ€è¦ <code>scale</code> å¤„ç†ï¼Œåˆ™ä¸ºè¯¥èŠ‚ç‚¹é…ç½® <code>&#39;None&#39;</code>ã€‚</li>
</ol>
</blockquote>
<p><strong>è®¡ç®—å…¬å¼åŠç¤ºä¾‹è¯´æ˜</strong></p>
<p><code>æ¨¡å‹è®­ç»ƒæ—¶çš„æ•°æ®æ ‡å‡†åŒ–å¤„ç†è®¡ç®—å…¬å¼</code></p>
<p>yamlæ–‡ä»¶ä¸­çš„meanå’Œscaleå‚æ•°ä¸è®­ç»ƒæ—¶çš„meanã€stdéœ€è¦è¿›è¡Œæ¢ç®—ã€‚</p>
<p>é¢„å¤„ç†èŠ‚ç‚¹ä¸­æ•°æ®æ ‡å‡†åŒ–æ“ä½œçš„è®¡ç®—æ–¹å¼ï¼ˆå³HzPreprocessèŠ‚ç‚¹ä¸­çš„è®¡ç®—å…¬å¼ï¼‰ä¸ºï¼šï¿½ï¿½ï¿½ï¿½_ï¿½ï¿½ï¿½ï¿½&#x3D;(ï¿½ï¿½ï¿½ï¿½âˆ’ï¿½ï¿½ï¿½ï¿½)âˆ—ï¿½ï¿½ï¿½ï¿½ï¿½ ã€‚</p>
<p>ä»¥yolov3ä¸ºä¾‹ï¼Œå…¶è®­ç»ƒæ—¶çš„é¢„å¤„ç†ä»£ç ä¸ºï¼š</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">def base_transform(image, size, mean, std):</span><br><span class="line">    x = cv2.resize(image, (size, size).astype(np.float32))</span><br><span class="line">    x /= 255</span><br><span class="line">    x -= mean</span><br><span class="line">    x /= std</span><br><span class="line">    return x</span><br><span class="line"></span><br><span class="line">class BaseTransform:</span><br><span class="line">    def __init__(self, size, mean=(0.406, 0.456, 0.485), std=(0.225, 0.224, 0.229)):</span><br><span class="line">        self.size = size</span><br><span class="line">        self.mean = np.array(mean, dtype=np.float32)</span><br><span class="line">        self.std = np.array(std, dtype=np.float32)</span><br></pre></td></tr></table></figure></div>

<p>åˆ™è®¡ç®—å…¬å¼ä¸ºï¼š<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230512140850527.png"
                      class="" title="image-20230512140850527"
                ></p>
<p>æ”¹å†™ä¸ºHzPreprocessèŠ‚ç‚¹çš„è®¡ç®—æ–¹å¼ï¼š<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230512140907489.png"
                      class="" title="image-20230512140907489"
                ></p>
<p>åˆ™ï¼š<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230512140915597.png"
                      class="" title="image-20230512140915597"
                ></p>
<p><strong>æ¨¡å‹æ¨ç†æ—¶çš„è®¡ç®—å…¬å¼</strong></p>
<p>é€šè¿‡å¯¹yamlé…ç½®æ–‡ä»¶ä¸­çš„é…ç½®å‚æ•°ï¼Œå†³å®šæ˜¯å¦åŠ å…¥HzPreprocessèŠ‚ç‚¹ã€‚ å½“é…ç½®mean&#x2F;scaleæ—¶ï¼Œåšæ¨¡å‹è½¬æ¢æ—¶ï¼Œä¼šåœ¨è¾“å…¥ç«¯æ–°å¢ä¸€ä¸ªHzPreprocessèŠ‚ç‚¹ï¼ŒHzPreprocessèŠ‚ç‚¹å¯ä»¥ç†è§£ä¸ºå¯¹è¾“å…¥æ•°æ®åšäº†ä¸€ä¸ªconvæ“ä½œã€‚</p>
<p>HzPreprocesså†…çš„è®¡ç®—å…¬å¼ä¸ºï¼š * scale&#96; ã€‚</p>
<p>æ³¨æ„ï¼š</p>
<ol>
<li>åœ¨yamlä¸­æ·»åŠ mean&#x2F;scaleåï¼Œå°±ä¸éœ€è¦åœ¨å‰å¤„ç†å†…æ·»åŠ MeanTransformerå’ŒScaleTransformeräº†ã€‚</li>
<li><strong>åœ¨yamlä¸­æ·»åŠ mean&#x2F;scaleï¼Œä¼šå°†å‚æ•°æ”¾å…¥åˆ°HzPreprocessèŠ‚ç‚¹å†…ï¼ŒHzPreprocessèŠ‚ç‚¹ä¸ºBPU èŠ‚ç‚¹ã€‚</strong></li>
</ol>
<blockquote>
<p>å›¾ç‰‡å¤„ç†transformerè¯´æ˜</p>
</blockquote>
<p>æœ¬ç« èŠ‚å°†å¯¹åœ¨è¿›è¡Œå›¾ç‰‡ç¼©æ”¾è£å‰ªæ—¶ä½¿ç”¨çš„å„ä¸ªtransformerçš„æ¦‚å¿µåŠå‚æ•°è¿›è¡Œè¯´æ˜ï¼Œå¹¶ä¸ºæä¾›å‚è€ƒä½¿ç”¨ç¤ºä¾‹ï¼Œæ–¹ä¾¿è¿›è¡Œtranformeræ“ä½œã€‚</p>
<p><strong>æ³¨æ„ï¼šå›¾ç‰‡æ•°æ®ä¸ºä¸‰ç»´æ•°æ®ï¼Œä½†åœ°å¹³çº¿æä¾›çš„transformeréƒ½æ˜¯ä»¥å››ç»´æ•°æ®çš„æ–¹å¼æ¥è¿›è¡Œè·å–å’Œå¤„ç†çš„ï¼Œtransformeråªä¼šå¯¹è¾“å…¥æ•°æ®ä¸­çš„ç¬¬0å¼ å›¾ç‰‡åšè¯¥æ“ä½œã€‚</strong></p>
<p><code>AddTransformer</code></p>
<p><strong>è¯´æ˜</strong>ï¼š</p>
<p>å¯¹è¾“å…¥å›¾ç‰‡ä¸­çš„æ‰€æœ‰åƒç´ å€¼åšå¢åŠ valueçš„æ“ä½œã€‚è¯¥transformerä¼šåœ¨è¾“å‡ºæ—¶, å°†æ•°æ®æ ¼å¼è½¬ä¸ºfloat32ã€‚</p>
<p><strong>å‚æ•°</strong>ï¼š</p>
<ul>
<li>value: å¯¹æ¯ä¸ªåƒç´ åšå¢åŠ çš„æ•°å€¼, æ³¨æ„valueçš„å–å€¼å¯ä»¥ä¸ºè´Ÿæ•°, å¦‚ -128ã€‚</li>
</ul>
<p><strong>ä½¿ç”¨ä¸¾ä¾‹</strong>ï¼š</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¯¹å›¾åƒæ•°æ®åšå‡å»128çš„æ“ä½œ</span></span><br><span class="line">``AddTransformer(-<span class="number">128</span>)``</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯¹å›¾åƒæ•°æ®åšå¢åŠ 127çš„æ“ä½œ</span></span><br><span class="line">``AddTransformer(<span class="number">127</span>)``</span><br></pre></td></tr></table></figure></div>



<p><code>MeanTransformer</code></p>
<p><strong>è¯´æ˜</strong>ï¼š</p>
<p>å¯¹è¾“å…¥å›¾ç‰‡ä¸­çš„æ‰€æœ‰åƒç´ å€¼åšå‡å» mean_value çš„æ“ä½œã€‚</p>
<p><strong>å‚æ•°</strong>ï¼š</p>
<ul>
<li>means: å¯¹æ¯ä¸ªåƒç´ åšå¢åŠ çš„æ•°å€¼, æ³¨æ„valueçš„å–å€¼å¯ä»¥ä¸ºè´Ÿæ•°, å¦‚ -128ã€‚</li>
<li>data_format: è¾“å…¥çš„layoutç±»å‹ï¼Œå–å€¼èŒƒå›´ä¸º[â€œCHWâ€,â€HWCâ€], é»˜è®¤ â€œCHWâ€ã€‚</li>
</ul>
<p><strong>ä½¿ç”¨ä¸¾ä¾‹</strong>ï¼š</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ¯ä¸ªåƒç´ å‡å»128.0 è¾“å…¥çš„ç±»å‹ä¸ºCHW</span></span><br><span class="line">MeanTransformer(np.array([<span class="number">128.0</span>, <span class="number">128.0</span>, <span class="number">128.0</span>]))</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¯ä¸ªåƒç´ å‡å»ä¸åŒçš„æ•°å€¼ï¼Œ103.94, 116.78, 123.68ï¼Œè¾“å…¥çš„ç±»å‹ä¸º HWC</span></span><br><span class="line">MeanTransformer(np.array([<span class="number">103.94</span>, <span class="number">116.78</span>, <span class="number">123.68</span>]), data_format=<span class="string">&quot;HWC&quot;</span>)</span><br></pre></td></tr></table></figure></div>



<p><code>ScaleTransformer</code></p>
<p><strong>è¯´æ˜</strong>ï¼š</p>
<p>å¯¹è¾“å…¥å›¾ç‰‡ä¸­çš„æ‰€æœ‰åƒç´ å€¼åšä¹˜ä»¥data_scaleç³»æ•°çš„æ“ä½œã€‚</p>
<p><strong>å‚æ•°</strong>ï¼š</p>
<ul>
<li>scale_value: éœ€è¦ä¹˜ä»¥çš„ç³»æ•°ï¼Œå¦‚0.0078125 æˆ–è€…1&#x2F;128ã€‚</li>
</ul>
<p><strong>ä½¿ç”¨ä¸¾ä¾‹</strong>ï¼š</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å°†å–å€¼èŒƒå›´-128~127ï¼Œæ‰€æœ‰çš„åƒç´ çš„è°ƒæ•´åˆ°-1~1ä¹‹é—´</span></span><br><span class="line">ScaleTransformer(<span class="number">0.0078125</span>)</span><br><span class="line"><span class="comment"># æˆ–è€…</span></span><br><span class="line">ScaleTransformer(<span class="number">1</span>/<span class="number">128</span>)</span><br></pre></td></tr></table></figure></div>



<p><code>NormalizeTransformer</code></p>
<p>ç”¨äºå¯¹è¾“å…¥å›¾ç‰‡è¿›è¡Œå½’ä¸€åŒ–çš„æ“ä½œã€‚è¯¥transformerä¼šåœ¨è¾“å‡ºæ—¶, å°†æ•°æ®æ ¼å¼è½¬ä¸ºfloat32ã€‚</p>
<p><strong>å‚æ•°</strong>ï¼š</p>
<ul>
<li>stdï¼šè¾“å…¥çš„ç¬¬ä¸€å¼ å›¾ç‰‡ï¼Œéœ€è¦é™¤ä»¥çš„æ•°å€¼ã€‚</li>
</ul>
<p><strong>ä½¿ç”¨ä¸¾ä¾‹</strong>ï¼š</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å°†å–å€¼èŒƒå›´[-128, 127] æ‰€æœ‰çš„åƒç´ çš„è°ƒæ•´åˆ°-1~1ä¹‹é—´</span></span><br><span class="line">NormalizeTransformer(<span class="number">128</span>)</span><br></pre></td></tr></table></figure></div>



<p><strong>TransposeTransformer</strong></p>
<p><strong>è¯´æ˜</strong>ï¼š</p>
<p>ç”¨äºåšlayoutè½¬æ¢çš„æ“ä½œã€‚</p>
<p><strong>å‚æ•°</strong>ï¼š</p>
<ul>
<li>order: å¯¹è¾“å…¥å›¾ç‰‡åšlayoutè½¬æ¢åçš„é¡ºåºï¼ˆé¡ºåºä¸åŸæœ‰çš„layouté¡ºåºæœ‰å…³ï¼‰ã€‚å¦‚ï¼š<strong>HWCçš„é¡ºåºä¸º0,1,2</strong>ï¼Œéœ€è¦è½¬ä¸ºCHWæ—¶ï¼Œorderä¸º(2,0,1)ã€‚</li>
</ul>
<p><strong>ä½¿ç”¨ä¸¾ä¾‹</strong>ï¼š</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># HWCè½¬åˆ°CHW</span></span><br><span class="line">TransposeTransformer((<span class="number">2</span>, <span class="number">0</span>, <span class="number">1</span>))</span><br><span class="line"><span class="comment"># CHWè½¬åˆ°HWC</span></span><br><span class="line">TransposeTransformer((<span class="number">1</span>, <span class="number">2</span>, <span class="number">0</span>))</span><br></pre></td></tr></table></figure></div>



<p><code>HWC2CHWTransformer</code></p>
<p><strong>è¯´æ˜</strong>ï¼š</p>
<p>ç”¨äºå°†NHWCè½¬æ¢ä¸ºNCHWçš„æ“ä½œã€‚</p>
<p><strong>å‚æ•°</strong>ï¼šä¸æ¶‰åŠã€‚</p>
<p><strong>ä½¿ç”¨ä¸¾ä¾‹</strong>ï¼š</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># NHWCè½¬åˆ°NCHW</span><br><span class="line">HWC2CHWTransformer()</span><br></pre></td></tr></table></figure></div>



<p><code> CHW2HWCTransformer</code></p>
<p><strong>è¯´æ˜</strong>ï¼š</p>
<p>ç”¨äºå°†NCHWè½¬æ¢ä¸ºNHWCçš„æ“ä½œã€‚</p>
<p><strong>å‚æ•°</strong>ï¼šä¸æ¶‰åŠã€‚</p>
<p><strong>ä½¿ç”¨ä¸¾ä¾‹</strong>ï¼š</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># NCHWè½¬åˆ° NHWC</span><br><span class="line">CHW2HWCTransformer()</span><br></pre></td></tr></table></figure></div>



<p><code>CenterCropTransformer</code></p>
<p><strong>æ˜</strong>ï¼š</p>
<p>ä»¥ç›´æ¥æˆªæ–­å–å€¼çš„æ–¹å¼ä»å›¾ç‰‡ä¸­å¿ƒè£å‰ªå‡ºä¸€ä¸ªæ­£æ–¹å½¢çš„å›¾ç‰‡çš„æ“ä½œã€‚è¯¥transformerä¼šåœ¨è¾“å‡ºæ—¶, å°†æ•°æ®æ ¼å¼è½¬ä¸ºfloat32ã€‚å½“data_typeçš„å€¼ä¸ºuint8æ—¶ï¼Œè¾“å‡ºä¸ºuint8ã€‚</p>
<p><strong>å‚æ•°</strong>ï¼š</p>
<ul>
<li>crop_size: ä¸­å¿ƒè£å‰ªçš„æ­£æ–¹å½¢çš„è¾¹é•¿sizeã€‚</li>
<li>data_type: è¾“å‡ºç»“æœçš„ç±»å‹ï¼Œå–å€¼èŒƒå›´ä¸º[â€œfloatâ€, â€œuint8â€]ã€‚</li>
</ul>
<p><strong>ä½¿ç”¨ä¸¾ä¾‹</strong>ï¼š</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä»¥224*224çš„æ–¹å¼ï¼Œåšä¸­å¿ƒè£å‰ªï¼Œé»˜è®¤è¾“å‡ºç±»å‹ä¸ºfloat32</span></span><br><span class="line">CenterCropTransformer(crop_size=<span class="number">224</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä»¥224*224çš„æ–¹å¼ï¼Œåšä¸­å¿ƒè£å‰ªï¼Œè¾“å‡ºç±»å‹ä¸ºuint8</span></span><br><span class="line">CenterCropTransformer(crop_size=<span class="number">224</span>, data_type=<span class="string">&quot;uint8&quot;</span>)</span><br></pre></td></tr></table></figure></div>



<p><code>PILCenterCropTransformer</code></p>
<p><strong>è¯´æ˜</strong>ï¼š</p>
<p>ä½¿ç”¨PILçš„æ–¹å¼ä»å›¾ç‰‡ä¸­å¿ƒè£å‰ªå‡ºä¸€ä¸ªæ­£æ–¹å½¢çš„å›¾ç‰‡çš„æ“ä½œã€‚è¯¥transformerä¼šåœ¨è¾“å‡ºæ—¶, å°†æ•°æ®æ ¼å¼è½¬ä¸ºfloat32ã€‚</p>
<p><strong>å‚æ•°</strong>ï¼š</p>
<ul>
<li>size: ä¸­å¿ƒè£å‰ªçš„æ­£æ–¹å½¢çš„è¾¹é•¿sizeã€‚</li>
</ul>
<p><strong>ä½¿ç”¨ä¸¾ä¾‹</strong>ï¼š</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä»¥224*224çš„æ–¹å¼ï¼Œä½¿ç”¨PILçš„æ–¹å¼åšä¸­å¿ƒè£å‰ª</span></span><br><span class="line">PILCenterCropTransformer(size=<span class="number">224</span>)</span><br></pre></td></tr></table></figure></div>



<p><code>LongSideCropTransformer</code></p>
<p><strong>è¯´æ˜</strong>ï¼š</p>
<p>ç”¨äºåšé•¿è¾¹è£å‰ªçš„æ“ä½œã€‚è¯¥ transformer ä¼šåœ¨è¾“å‡ºæ—¶, å°†æ•°æ®æ ¼å¼è½¬ä¸ºfloat32ã€‚</p>
<p>å½“å®½åº¦æ¯”é«˜åº¦çš„æ•°å€¼å¤§æ—¶ï¼Œä¼šè£å‰ªå‡ºä¸€ä¸ªä¸­å¿ƒä»¥é«˜åº¦å¤§å°ä¸ºå‡†çš„æ­£æ–¹å½¢ï¼Œå¦‚å®½100ï¼Œé«˜70ï¼Œè£å‰ªä¹‹åå¤§å°ä¸º70*70ã€‚</p>
<p>å½“é«˜åº¦æ¯”å®½åº¦çš„æ•°å€¼å¤§æ—¶ï¼Œä¼šè£å‰ªå‡ºä¸€ä¸ªä¸­å¿ƒä»¥å®½åº¦å¤§å°ä¸å˜ï¼Œé«˜åº¦ä¸ºå·®å€¼çš„ä¸€åŠ+å®½åº¦ çš„é•¿æ–¹å½¢ï¼Œå¦‚å®½70ï¼Œé«˜100ï¼Œè£å‰ªä¹‹åå¤§å°ä¸º 70<em>ï¼ˆ100-70ï¼‰&#x2F;2+70 ï¼Œå³70</em> 85å¤§å°çš„é•¿æ–¹å½¢ã€‚</p>
<p><strong>å‚æ•°</strong>ï¼šä¸æ¶‰åŠã€‚</p>
<p><strong>ä½¿ç”¨ä¸¾ä¾‹</strong>ï¼š</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LongSideCropTransformer()</span><br></pre></td></tr></table></figure></div>



<p><code>PadResizeTransformer</code></p>
<p><strong>è¯´æ˜</strong>ï¼š</p>
<p>ä½¿ç”¨å¡«å……çš„æ–¹å¼åšå›¾åƒæ”¾å¤§çš„æ“ä½œã€‚è¯¥ transformer ä¼šåœ¨è¾“å‡ºæ—¶, å°†æ•°æ®æ ¼å¼è½¬ä¸ºfloat32ã€‚</p>
<p><strong>å‚æ•°</strong>ï¼š</p>
<ul>
<li>target_sizeï¼šç›®æ ‡å¤§å°ï¼Œå€¼ä¸ºå…ƒç»„ï¼Œå¦‚(240,240)ã€‚</li>
<li>pad_valueï¼šå¡«å……åˆ°æ•°ç»„ä¸­çš„å€¼ï¼Œé»˜è®¤å€¼ä¸º127ã€‚</li>
<li>pad_positionï¼šå¡«å……çš„ä½ç½®ï¼Œå–å€¼èŒƒå›´ä¸º[â€œboundaryâ€ï¼Œ â€œbottom_rightâ€]ï¼Œé»˜è®¤å€¼ä¸º â€œboundaryâ€ã€‚</li>
</ul>
<p><strong>ä½¿ç”¨ä¸¾ä¾‹</strong>ï¼š</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è£å‰ªä¸€ä¸ªå¤§å°ä¸º512*512ï¼Œå¡«å……åˆ°å³ä¸‹è§’ï¼Œå¡«å……å€¼ä¸º0</span></span><br><span class="line">PadResizeTransformer((<span class="number">512</span>, <span class="number">512</span>), pad_position=<span class="string">&#x27;bottom_right&#x27;</span>, pad_value=<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è£å‰ªä¸€ä¸ªå¤§å°ä¸º608*608ï¼Œå¡«å……åˆ°è¾¹æ¡†ï¼Œå¡«å……å€¼ä¸º 127</span></span><br><span class="line">PadResizeTransformer(target_size=(<span class="number">608</span>, <span class="number">608</span>))</span><br></pre></td></tr></table></figure></div>



<p><code>ResizeTransformer</code></p>
<p><strong>è¯´æ˜</strong>ï¼š</p>
<p>ç”¨äºè°ƒæ•´å›¾åƒå¤§å°çš„æ“ä½œã€‚</p>
<p><strong>å‚æ•°</strong>ï¼š</p>
<ul>
<li><p>target_sizeï¼šç›®æ ‡å¤§å°ï¼Œå€¼ä¸ºå…ƒç»„ï¼Œå¦‚(240,240)ã€‚(240,240)ï¼šå‰ä¸€ä¸ª240ä»£è¡¨é«˜åº¦ä¸º240ï¼Œåä¸€ä¸ª240ä»£è¡¨å®½åº¦ä¸º240ã€‚</p>
</li>
<li><p>modeï¼šå›¾ç‰‡å¤„ç†æ¨¡å¼ï¼Œå–å€¼èŒƒå›´ä¸º(â€œskimageâ€ï¼Œâ€opencvâ€)ï¼Œé»˜è®¤å€¼ä¸º â€œskimageâ€ã€‚</p>
</li>
<li><p>methodï¼šæ’å€¼çš„æ–¹æ³•ï¼Œæ­¤å‚æ•°ä»…åœ¨modeä¸ºskimageæ—¶ç”Ÿæ•ˆã€‚å–å€¼èŒƒå›´ä¸º0-5ï¼Œé»˜è®¤å€¼ä¸º1ï¼Œå…¶ä¸­ï¼š</p>
<ul>
<li>0ä»£è¡¨Nearest-neighborï¼›</li>
<li>1ä»£è¡¨Bi-linear(default)ï¼›</li>
<li>2ä»£è¡¨Bi-quadratic;</li>
<li>3ä»£è¡¨Bi-cubic;</li>
<li>4ä»£è¡¨Bi-quartic;</li>
<li>5ä»£è¡¨Bi-quinticã€‚</li>
</ul>
</li>
<li><p>data_typeï¼šè¾“å‡ºçš„ç±»å‹ï¼Œå–å€¼èŒƒå›´ä¸º(uint8ï¼Œfloat)ï¼Œé»˜è®¤ä¸ºfloatç±»å‹ã€‚å½“è¢«è®¾ç½®ä¸ºuint8æ—¶ï¼Œè¾“å‡ºç±»å‹ä¸ºuint8 ï¼Œå…¶ä»–æƒ…å†µä¸ºfloat32ã€‚</p>
</li>
<li><p>interpolationï¼šæ’å€¼çš„æ–¹æ³•ï¼Œæ­¤å‚æ•°ä»…åœ¨modeä¸ºopencvæ—¶ç”Ÿæ•ˆã€‚é»˜è®¤ä¸ºç©ºï¼Œå–å€¼èŒƒå›´ä¸º(opencvçš„æ’å€¼æ–¹å¼)ï¼Œ <strong>ç›®å‰interpolationä»…æ”¯æŒä¸ºç©ºæˆ–opencvä¸­çš„INTER_CUBICä¸¤ç§æ’å€¼æ–¹æ³•ï¼Œå½“interpolationä¸ºç©ºæ—¶ï¼Œé»˜è®¤ä½¿ç”¨INTER_LINEARæ–¹å¼ã€‚</strong></p>
<p>ä»¥ä¸‹ä¸ºopencvä¸­æ”¯æŒçš„æ’å€¼æ–¹å¼åŠè¯´æ˜ï¼ˆç›®å‰æœªæ”¯æŒçš„æ’å€¼æ–¹å¼å°†åœ¨åç»­è¿­ä»£ä¸­é€æ­¥æ”¯æŒï¼‰ï¼š</p>
<ul>
<li>INTER_NEARESTï¼Œæœ€è¿‘é‚»æ’å€¼ï¼›</li>
<li>INTER_LINEARï¼ŒåŒçº¿æ€§æ’å€¼ï¼Œå½“interpolationä¸ºç©ºæ—¶ï¼Œé»˜è®¤ä½¿ç”¨è¿™ç§æ–¹æ³•ã€‚</li>
<li>INTER_CUBICï¼ŒåŒä¸‰æ¬¡æ’å€¼4x4åƒç´ é‚»åŸŸå†…çš„åŒç«‹æ–¹æ’å€¼ã€‚</li>
<li>INTER_AREAï¼Œä½¿ç”¨åƒç´ é¢ç§¯å…³ç³»é‡é‡‡æ ·ã€‚å®ƒå¯èƒ½æ˜¯å›¾åƒæŠ½å–çš„é¦–é€‰æ–¹æ³•ï¼Œå› ä¸ºå®ƒå¯ä»¥æä¾›æ— è«å°”æ¡çº¹çš„ç»“æœã€‚ä½†æ˜¯å½“å›¾åƒè¢«ç¼©æ”¾æ—¶ï¼Œå®ƒç±»ä¼¼äºINTER_NEARESTæ–¹æ³•ã€‚</li>
<li>INTER_LANCZOS4ï¼Œ8x8é‚»åŸŸçš„Lanczosæ’å€¼ã€‚</li>
<li>INTER_LINEAR_EXACTï¼Œä½ç²¾ç¡®åŒçº¿æ€§æ’å€¼ã€‚</li>
<li>INTER_NEAREST_EXACTï¼Œä½ç²¾ç¡®æœ€è¿‘é‚»æ’å€¼ã€‚è¿™å°†äº§ç”Ÿä¸PILã€scikit-imageæˆ–Matlabä¸­çš„æœ€è¿‘é‚»æ–¹æ³•ç›¸åŒçš„ç»“æœã€‚</li>
<li>INTER_MAXï¼Œæ’å€¼ä»£ç çš„æ©ç ã€‚</li>
<li>WARP_FILL_OUTLIERSï¼Œæ ‡å¿—ï¼Œå¡«å……æ‰€æœ‰ç›®æ ‡å›¾åƒåƒç´ ã€‚å¦‚æœå…¶ä¸­ä¸€äº›å¯¹åº”äºæºå›¾åƒä¸­çš„å¼‚å¸¸å€¼ï¼Œåˆ™å°†å®ƒä»¬è®¾ç½®ä¸ºé›¶ã€‚</li>
<li>WARP_INVERSE_MAPï¼Œæ ‡å¿—ï¼Œé€†å˜æ¢ã€‚</li>
</ul>
</li>
</ul>
<p><strong>ä½¿ç”¨ä¸¾ä¾‹</strong>ï¼š</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å°†è¾“å…¥å›¾ç‰‡å¤§å°è°ƒæ•´ä¸º224*224ï¼Œé‡‡ç”¨ opencv çš„æ–¹å¼å¤„ç†å›¾ç‰‡ï¼Œæ’å€¼çš„æ–¹å¼ä¸ºåŒçº¿æ€§ï¼Œè¾“å‡ºä¸ºfloat32</span></span><br><span class="line">ResizeTransformer(target_size=(<span class="number">224</span>, <span class="number">224</span>), mode=<span class="string">&#x27;opencv&#x27;</span>, method=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†è¾“å…¥å›¾ç‰‡å¤§å°è°ƒæ•´ä¸º256*256ï¼Œé‡‡ç”¨skimageçš„æ–¹å¼å¤„ç†å›¾ç‰‡ï¼Œæ’å€¼çš„æ–¹å¼ä¸ºåŒçº¿æ€§ï¼Œè¾“å‡ºä¸ºfloat32</span></span><br><span class="line">ResizeTransformer(target_size=(<span class="number">256</span>, <span class="number">256</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†è¾“å…¥å›¾ç‰‡å¤§å°è°ƒæ•´ä¸º256*256ï¼Œé‡‡ç”¨skimageçš„æ–¹å¼å¤„ç†å›¾ç‰‡ï¼Œæ’å€¼çš„æ–¹å¼ä¸ºåŒçº¿æ€§ï¼Œè¾“å‡ºä¸ºuint8</span></span><br><span class="line">ResizeTransformer(target_size=(<span class="number">256</span>, <span class="number">256</span>), data_type=<span class="string">&quot;uint8&quot;</span>)</span><br></pre></td></tr></table></figure></div>



<p><code>PILResizeTransformer</code></p>
<p><strong>è¯´æ˜</strong>ï¼š</p>
<p>ä½¿ç”¨PILåº“åšè°ƒæ•´å›¾åƒå¤§å°çš„æ“ä½œã€‚</p>
<p><strong>å‚æ•°</strong>ï¼š</p>
<ul>
<li>sizeï¼šç›®æ ‡å¤§å°ï¼Œå€¼ä¸ºå…ƒç»„ï¼Œå¦‚(240,240)ã€‚</li>
<li>interpolationï¼šæŒ‡å®šæ’å€¼çš„æ–¹å¼ï¼Œå–å€¼èŒƒå›´ï¼š(Image.NEARESTï¼ŒImage.BILINEARï¼ŒImage.BICUBICï¼ŒImage.LANCZOS)ï¼Œ é»˜è®¤å€¼ä¸ºImage.BILINEARã€‚<ul>
<li>Image.NEARESTï¼šæœ€è¿‘é‚»é‡‡æ ·ï¼›</li>
<li>Image.BILINEARï¼šçº¿æ€§æ’å€¼ï¼›</li>
<li>Image.BICUBICï¼šä¸‰æ¬¡æ ·æ¡æ’å€¼ï¼›</li>
<li>Image.LANCZOSï¼šé«˜è´¨é‡ä¸‹é‡‡æ ·æ»¤æ³¢å™¨ã€‚</li>
</ul>
</li>
</ul>
<p><strong>ä½¿ç”¨ä¸¾ä¾‹</strong>ï¼š</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å°†è¾“å…¥å›¾ç‰‡å¤§å°è°ƒæ•´ä¸º256*256 æ’å€¼çš„æ–¹å¼ä¸ºçº¿æ€§æ’å€¼</span></span><br><span class="line">PILResizeTransformer(size=<span class="number">256</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†è¾“å…¥å›¾ç‰‡å¤§å°è°ƒæ•´ä¸º256*256 æ’å€¼çš„æ–¹å¼ä¸ºé«˜è´¨é‡ä¸‹é‡‡æ ·æ»¤æ³¢å™¨</span></span><br><span class="line">PILResizeTransformer(size=<span class="number">256</span>, interpolation=Image.LANCZOS)</span><br></pre></td></tr></table></figure></div>



<p><code>ShortLongResizeTransformer</code></p>
<p><strong>è¯´æ˜</strong>ï¼š</p>
<p>æŒ‰ç…§åŸæ¯”ä¾‹å¯¹è¾“å…¥å›¾ç‰‡è¿›è¡Œç¼©æ”¾çš„æ“ä½œï¼Œæ–°å›¾ç‰‡çš„å¤§å°ä¸è®¾ç½®çš„å‚æ•°æœ‰å…³ã€‚æ“ä½œæ–¹å¼å¦‚ä¸‹ï¼š</p>
<ol>
<li>å…ˆä»¥short_sizeçš„å¤§å°é™¤ä»¥åŸå›¾ç‰‡çš„å®½å’Œé«˜é‡Œæœ€å°å€¼ï¼Œä»¥è¿™ä¸ªå€¼ä¸ºç¼©æ”¾æ¯”ä¾‹ç³»æ•°ã€‚</li>
<li>å½“ç¼©æ”¾æ¯”ä¾‹ç³»æ•°ä¹˜ä»¥åŸå›¾ç‰‡çš„å®½å’Œé«˜ä¸­çš„æœ€å¤§å€¼ï¼Œå¾—åˆ°çš„ç»“æœå¤§äºlong_sizeçš„æ•°å€¼æ—¶ï¼Œç¼©æ”¾æ¯”ä¾‹ç³»æ•°å°†å˜æ›´ä¸ºlong_sizeé™¤ä»¥åŸå›¾ç‰‡çš„å®½å’Œé«˜ä¸­çš„æœ€å¤§å€¼ã€‚</li>
<li>ä½¿ç”¨opencvä¸­çš„resizeæ–¹æ³•ï¼Œæ ¹æ®ä¸Šæ–¹å¾—åˆ°çš„ç¼©æ”¾æ¯”ä¾‹ç³»æ•°é‡æ–°è£å‰ªå›¾ç‰‡ã€‚</li>
</ol>
<p><strong>å‚æ•°</strong>ï¼š</p>
<ul>
<li>short_sizeï¼šé¢„æœŸè£å‰ªåçš„çŸ­è¾¹çš„é•¿åº¦ã€‚</li>
<li>long_sizeï¼šé¢„æœŸè£å‰ªåçš„é•¿è¾¹çš„é•¿åº¦ã€‚</li>
<li>include_imï¼šé»˜è®¤å€¼ä¸ºTrueï¼Œè®¾ç½®ä¸ºTrueæ—¶, ä¼šåœ¨è¿”å›æ—¶é™¤äº†è¿”å›å¤„ç†åçš„å›¾ç‰‡, è¿˜ä¼šè¿”å›åŸå›¾ç‰‡ã€‚</li>
</ul>
<p><strong>ä½¿ç”¨ä¸¾ä¾‹</strong>ï¼š</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># çŸ­è¾¹é•¿åº¦ä¸º20ï¼Œé•¿è¾¹é•¿åº¦ä¸º100ï¼Œè¿”å›å¤„ç†åçš„å›¾ç‰‡åŠåŸå›¾ç‰‡</span><br><span class="line">ShortLongResizeTransformer(short_size=20, long_size=100)</span><br></pre></td></tr></table></figure></div>



<p><code>PadTransformer</code></p>
<p><strong>è¯´æ˜</strong>ï¼š</p>
<p>é€šè¿‡ç”¨ç›®æ ‡å¤§å°çš„sizeå€¼é™¤ä»¥è¾“å…¥å›¾ç‰‡å®½æˆ–è€…é«˜é‡Œçš„æœ€å¤§å€¼ä¸ºç³»æ•°ï¼Œç„¶åä½¿ç”¨è¿™ä¸ªç³»æ•°ä¹˜ä»¥åŸæœ‰çš„å®½é«˜ï¼Œresizeå›¾ç‰‡ã€‚ ç„¶åæ ¹æ®æ–°å›¾ç‰‡çš„å¤§å°ï¼Œé™¤ä»¥size_divisoråå‘ä¸Šå–æ•´åï¼Œå†ä¹˜ä»¥size_divisorï¼Œä¸ºæ–°çš„å®½é«˜ï¼Œç”Ÿæˆæ–°çš„å›¾ç‰‡çš„æ“ä½œã€‚</p>
<p><strong>å‚æ•°</strong>ï¼š</p>
<ul>
<li>size_divisorï¼šå¤§å°é™¤æ•° ï¼Œé»˜è®¤å€¼ä¸º128ã€‚</li>
<li>target_sizeï¼šç›®æ ‡å¤§å°ï¼Œé»˜è®¤å€¼ä¸º512ã€‚</li>
</ul>
<p><strong>ä½¿ç”¨ä¸¾ä¾‹</strong>ï¼š</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># padå¤§å°ä¸º1024*1024</span><br><span class="line">PadTransformer(size_divisor=1024, target_size=1024)</span><br></pre></td></tr></table></figure></div>



<p><code>ShortSideResizeTransformer</code></p>
<p><strong>è¯´æ˜</strong>ï¼š</p>
<p>æ ¹æ®æœŸæœ›çš„çŸ­è¾¹çš„é•¿åº¦ï¼Œä½¿ç”¨ç°åœ¨çš„é•¿çŸ­è¾¹çš„æ¯”ä¾‹ï¼Œä¸­å¿ƒè£å‰ªå‡ºæ–°çš„å›¾ç‰‡å¤§å°çš„æ“ä½œã€‚</p>
<p><strong>å‚æ•°</strong>ï¼š</p>
<ul>
<li><p>short_sizeï¼šé¢„æœŸçš„çŸ­è¾¹çš„é•¿åº¦ã€‚</p>
</li>
<li><p>data_typeï¼šè¾“å‡ºç»“æœçš„ç±»å‹ï¼Œå–å€¼èŒƒå›´ä¸º(â€œfloatâ€,â€uint8â€)ï¼Œé»˜è®¤å–å€¼â€float32â€, ä»¥ float32 ç±»å‹è¾“å‡ºï¼Œè®¾ç½®ä¸ºuint8æ—¶ï¼Œè¾“å‡ºç±»å‹å°†ä¸ºuint8ã€‚</p>
</li>
<li><p>interpolationï¼šæŒ‡å®šæ’å€¼çš„æ–¹å¼ï¼Œå–å€¼èŒƒå›´ä¸º opencv ä¸­é‡‡ç”¨çš„æ’å€¼æ–¹å¼ï¼Œé»˜è®¤ä¸ºç©ºã€‚</p>
<p>ç›®å‰interpolationä»…æ”¯æŒä¸ºç©ºæˆ–opencvä¸­çš„INTER_CUBICä¸¤ç§æ’å€¼æ–¹æ³•ï¼Œå½“interpolationä¸ºç©ºæ—¶ï¼Œé»˜è®¤ä½¿ç”¨INTER_LINEARæ–¹å¼ã€‚</p>
<p>ä»¥ä¸‹ä¸ºopencvä¸­æ”¯æŒçš„æ’å€¼æ–¹å¼åŠè¯´æ˜ï¼ˆç›®å‰æœªæ”¯æŒçš„æ’å€¼æ–¹å¼å°†åœ¨åç»­è¿­ä»£ä¸­é€æ­¥æ”¯æŒï¼‰ï¼š</p>
<ul>
<li>INTER_NEARESTï¼Œæœ€è¿‘é‚»æ’å€¼ï¼›</li>
<li>INTER_LINEARï¼ŒåŒçº¿æ€§æ’å€¼ï¼Œå½“interpolationä¸ºç©ºæ—¶ï¼Œé»˜è®¤ä½¿ç”¨è¿™ç§æ–¹æ³•ã€‚</li>
<li>INTER_CUBICï¼ŒåŒä¸‰æ¬¡æ’å€¼4x4åƒç´ é‚»åŸŸå†…çš„åŒç«‹æ–¹æ’å€¼ã€‚</li>
<li>INTER_AREAï¼Œä½¿ç”¨åƒç´ é¢ç§¯å…³ç³»é‡é‡‡æ ·ã€‚å®ƒå¯èƒ½æ˜¯å›¾åƒæŠ½å–çš„é¦–é€‰æ–¹æ³•ï¼Œå› ä¸ºå®ƒå¯ä»¥æä¾›æ— è«å°”æ¡çº¹çš„ç»“æœã€‚ä½†æ˜¯å½“å›¾åƒè¢«ç¼©æ”¾æ—¶ï¼Œå®ƒç±»ä¼¼äºINTER_NEARESTæ–¹æ³•ã€‚</li>
<li>INTER_LANCZOS4ï¼Œ8x8é‚»åŸŸçš„Lanczosæ’å€¼ã€‚</li>
<li>INTER_LINEAR_EXACTï¼Œä½ç²¾ç¡®åŒçº¿æ€§æ’å€¼ã€‚</li>
<li>INTER_NEAREST_EXACTï¼Œä½ç²¾ç¡®æœ€è¿‘é‚»æ’å€¼ã€‚è¿™å°†äº§ç”Ÿä¸PILã€scikit-imageæˆ–Matlabä¸­çš„æœ€è¿‘é‚»æ–¹æ³•ç›¸åŒçš„ç»“æœã€‚</li>
<li>INTER_MAXï¼Œæ’å€¼ä»£ç çš„æ©ç ã€‚</li>
<li>WARP_FILL_OUTLIERSï¼Œæ ‡å¿—ï¼Œå¡«å……æ‰€æœ‰ç›®æ ‡å›¾åƒåƒç´ ã€‚å¦‚æœå…¶ä¸­ä¸€äº›å¯¹åº”äºæºå›¾åƒä¸­çš„å¼‚å¸¸å€¼ï¼Œåˆ™å°†å®ƒä»¬è®¾ç½®ä¸ºé›¶ã€‚</li>
<li>WARP_INVERSE_MAPï¼Œæ ‡å¿—ï¼Œé€†å˜æ¢ã€‚</li>
</ul>
</li>
</ul>
<p><strong>ä½¿ç”¨ä¸¾ä¾‹</strong>ï¼š</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å°†çŸ­è¾¹å¤§å°è°ƒæ•´ä¸º256ï¼Œæ’å€¼æ–¹å¼ä¸ºåŒçº¿æ€§æ’å€¼</span></span><br><span class="line">ShortSideResizeTransformer(short_size=<span class="number">256</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†çŸ­è¾¹å¤§å°è°ƒæ•´ä¸º256ï¼Œæ’å€¼æ–¹å¼ä¸º 8x8åƒç´ é‚»åŸŸå†…çš„Lanczosæ’å€¼</span></span><br><span class="line">ShortSideResizeTransformer(short_size=<span class="number">256</span>, interpolation=Image.LANCZOS4)</span><br></pre></td></tr></table></figure></div>



<p><code>PaddedCenterCropTransformer</code></p>
<p><strong>è¯´æ˜</strong>ï¼š</p>
<p>ä½¿ç”¨å¡«å……çš„æ–¹å¼å¯¹å›¾ç‰‡ä¸­å¿ƒè¿›è¡Œè£å‰ªçš„æ“ä½œã€‚</p>
<p>æ³¨æ„</p>
<blockquote>
<p>ä»…é€‚ç”¨äºEfficientNet-liteç›¸å…³å®ä¾‹æ¨¡å‹ã€‚</p>
<p>è®¡ç®—æ–¹å¼ä¸ºï¼š</p>
<ol>
<li>è®¡ç®—ç³»æ•°ï¼Œint((float( image_size ) &#x2F; ( image_size + crop_pad ))ã€‚</li>
<li>è®¡ç®—ä¸­å¿ƒsizeçš„å¤§å°ï¼Œ ç³»æ•° * np.minimum( åŸå§‹å›¾ç‰‡çš„é«˜åº¦, åŸå§‹å›¾ç‰‡çš„å®½åº¦ ))ã€‚</li>
<li>æ ¹æ®è®¡ç®—å‡ºæ¥çš„sizeå¤§å°ï¼Œåšä¸­å¿ƒè£å‰ªã€‚</li>
</ol>
</blockquote>
<p><strong>å‚æ•°</strong>ï¼š</p>
<ul>
<li>image_sizeï¼šå›¾ç‰‡çš„å¤§å°ï¼Œé»˜è®¤å€¼ä¸º224ã€‚</li>
<li>crop_padï¼šä¸­å¿ƒå¡«å……çš„å¤§å°ï¼Œé»˜è®¤å€¼ä¸º32ã€‚</li>
</ul>
<p><code>BGR2RGBTransformer</code></p>
<p><strong>è¯´æ˜</strong>ï¼š</p>
<p>å°†è¾“å…¥æ ¼å¼ç”±BGRè½¬æˆRGBçš„æ“ä½œã€‚</p>
<p><strong>å‚æ•°</strong>ï¼š</p>
<ul>
<li>data_formatï¼šæ•°æ®æ ¼å¼ï¼Œå–å€¼èŒƒå›´ä¸º(CHW,HWC)ï¼Œé»˜è®¤å€¼ä¸ºCHWã€‚</li>
</ul>
<p><strong>ä½¿ç”¨ä¸¾ä¾‹</strong>ï¼š</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># layoutä¸ºNCHWæ—¶ï¼ŒåšBGRè½¬ä¸ºRGB</span></span><br><span class="line">BGR2RGBTransformer()</span><br><span class="line"></span><br><span class="line"><span class="comment"># layoutä¸ºNHWCæ—¶ï¼ŒåšBGRè½¬ä¸ºRGB</span></span><br><span class="line">BGR2RGBTransformer(data_format=<span class="string">&quot;HWC&quot;</span>)</span><br></pre></td></tr></table></figure></div>



<p><code>RGB2BGRTransformer</code></p>
<p><strong>è¯´æ˜</strong>ï¼š</p>
<p>å°†è¾“å…¥æ ¼å¼ç”±RGBè½¬æˆBGRçš„æ“ä½œã€‚</p>
<p><strong>å‚æ•°</strong>ï¼š</p>
<ul>
<li>data_formatï¼šæ•°æ®æ ¼å¼ï¼Œå–å€¼èŒƒå›´ä¸º(CHW,HWC)ï¼Œé»˜è®¤å€¼ä¸ºCHWã€‚</li>
</ul>
<p><strong>ä½¿ç”¨ä¸¾ä¾‹</strong>ï¼š</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># layoutä¸ºNCHWæ—¶ï¼ŒåšRGBè½¬æˆBGR</span></span><br><span class="line">RGB2BGRTransformer()</span><br><span class="line"></span><br><span class="line"><span class="comment"># layoutä¸ºNHWCæ—¶ï¼ŒåšRGBè½¬æˆBGR</span></span><br><span class="line">RGB2BGRTransformer(data_format=<span class="string">&quot;HWC&quot;</span>)</span><br></pre></td></tr></table></figure></div>



<p><code>RGB2GRAYTransformer</code></p>
<p><strong>è¯´æ˜</strong>ï¼š</p>
<p>å°†è¾“å…¥æ ¼å¼ç”±RGBè½¬æˆGRAYçš„æ“ä½œã€‚</p>
<p><strong>å‚æ•°</strong>ï¼š</p>
<ul>
<li>data_formatï¼šè¾“å…¥çš„layoutç±»å‹ï¼Œå–å€¼èŒƒå›´(â€œCHWâ€,â€HWCâ€)ï¼Œé»˜è®¤ä¸ºâ€CHWâ€ã€‚</li>
</ul>
<p><strong>ä½¿ç”¨ä¸¾ä¾‹</strong>ï¼š</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># layoutä¸ºNCHWæ—¶ï¼ŒåšRGBè½¬æˆGRAY</span></span><br><span class="line">RGB2GRAYTransformer(data_format=<span class="string">&#x27;CHW&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># layoutä¸ºNHWCæ—¶ï¼ŒåšRGBè½¬æˆGRAY</span></span><br><span class="line">RGB2GRAYTransformer(data_format=<span class="string">&#x27;HWC&#x27;</span>)</span><br></pre></td></tr></table></figure></div>



<p><code>BGR2GRAYTransformer</code></p>
<p><strong>è¯´æ˜</strong>ï¼š</p>
<p>å°†è¾“å…¥æ ¼å¼ç”± BGR è½¬æˆ GRAY çš„æ“ä½œã€‚</p>
<p><strong>å‚æ•°</strong>ï¼š</p>
<ul>
<li>data_formatï¼šè¾“å…¥çš„layoutç±»å‹ï¼Œå–å€¼èŒƒå›´ [â€œCHWâ€,â€HWCâ€]ï¼Œé»˜è®¤å€¼ä¸ºâ€CHWâ€ã€‚</li>
</ul>
<p><strong>ä½¿ç”¨ä¸¾ä¾‹</strong>ï¼š</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># layoutä¸ºNCHWæ—¶ï¼ŒåšBGRè½¬æˆGRAY</span></span><br><span class="line">BGR2GRAYTransformer(data_format=<span class="string">&#x27;CHW&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># layoutä¸ºNHWCæ—¶ï¼ŒåšBGRè½¬æˆGRAY</span></span><br><span class="line">BGR2GRAYTransformer(data_format=<span class="string">&#x27;HWC&#x27;</span>)</span><br></pre></td></tr></table></figure></div>



<p><code>RGB2GRAY_128Transformer</code></p>
<p><strong>è¯´æ˜</strong>ï¼š</p>
<p>è¾“å…¥æ ¼å¼ç”±RGBè½¬æˆGRAY_128çš„æ“ä½œã€‚GRAY_128å–å€¼èŒƒå›´ä¸º(-128,127)ã€‚</p>
<p><strong>å‚æ•°</strong>ï¼š</p>
<ul>
<li>data_formatï¼šè¾“å…¥çš„layoutç±»å‹ï¼Œå–å€¼èŒƒå›´ä¸º[â€œCHWâ€,â€HWCâ€]ï¼Œé»˜è®¤å€¼ä¸ºâ€CHWâ€ï¼Œæ­¤é¡¹ä¸ºå¿…å¡«é¡¹ã€‚</li>
</ul>
<p><strong>ä½¿ç”¨ä¸¾ä¾‹</strong>ï¼š</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># layoutä¸ºNCHWæ—¶ï¼ŒåšRGBè½¬æˆGRAY_128</span></span><br><span class="line">RGB2GRAY_128Transformer(data_format=<span class="string">&#x27;CHW&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># layoutä¸ºNHWCæ—¶ï¼ŒåšRGBè½¬æˆGRAY_128</span></span><br><span class="line">RGB2GRAY_128Transformer(data_format=<span class="string">&#x27;HWC&#x27;</span>)</span><br></pre></td></tr></table></figure></div>



<p><code>RGB2YUV444Transformer</code></p>
<p><strong>è¯´æ˜</strong>ï¼š</p>
<p>å°†è¾“å…¥æ ¼å¼ç”±RGBè½¬æˆYUV444çš„æ“ä½œã€‚</p>
<p><strong>å‚æ•°</strong>ï¼š</p>
<ul>
<li>data_formatï¼šè¾“å…¥çš„layoutç±»å‹ï¼Œå–å€¼èŒƒå›´ä¸º[â€œCHWâ€, â€œHWCâ€]ï¼Œé»˜è®¤å€¼ä¸ºâ€CHWâ€ï¼Œæ­¤é¡¹ä¸ºå¿…å¡«é¡¹ã€‚</li>
</ul>
<p><strong>ä½¿ç”¨ä¸¾ä¾‹</strong>ï¼š</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># layout ä¸º NCHW æ—¶ï¼Œåš RGB è½¬æˆ YUV444</span></span><br><span class="line">RGB2YUV444Transformer(data_format=<span class="string">&#x27;CHW&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># layout ä¸º NHWC æ—¶ï¼Œåš RGB è½¬æˆ YUV444</span></span><br><span class="line">RGB2YUV444Transformer(data_format=<span class="string">&#x27;HWC&#x27;</span>)</span><br></pre></td></tr></table></figure></div>



<p><code>BGR2YUV444Transformer</code></p>
<p><strong>è¯´æ˜</strong>ï¼š</p>
<p>å°†è¾“å…¥æ ¼å¼ç”±BGRè½¬æˆYUV444çš„æ“ä½œã€‚</p>
<p><strong>å‚æ•°</strong>ï¼š</p>
<ul>
<li>data_formatï¼šè¾“å…¥çš„layoutç±»å‹ï¼Œå–å€¼èŒƒå›´ä¸º[â€œCHWâ€,â€HWCâ€]ï¼Œé»˜è®¤å€¼ä¸º â€œCHWâ€ï¼Œæ­¤é¡¹ä¸ºå¿…å¡«é¡¹ã€‚</li>
</ul>
<p><strong>ä½¿ç”¨ä¸¾ä¾‹</strong>ï¼š</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># layoutä¸ºNCHWæ—¶ï¼ŒåšBGRè½¬æˆYUV444</span></span><br><span class="line">BGR2YUV444Transformer(data_format=<span class="string">&#x27;CHW&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># layoutä¸ºNHWCæ—¶ï¼ŒåšBGRè½¬æˆYUV444</span></span><br><span class="line">BGR2YUV444Transformer(data_format=<span class="string">&#x27;HWC&#x27;</span>)</span><br></pre></td></tr></table></figure></div>



<p><code>BGR2YUV444_128Transformer</code></p>
<p><strong>è¯´æ˜</strong>ï¼š</p>
<p>å°†è¾“å…¥æ ¼å¼ç”±BGRè½¬æˆYUV444_128çš„æ“ä½œã€‚YUV444_128å–å€¼èŒƒå›´ä¸º(-128,127)ã€‚</p>
<p><strong>å‚æ•°</strong>ï¼š</p>
<ul>
<li>data_formatï¼šè¾“å…¥çš„layoutç±»å‹ï¼Œå–å€¼èŒƒå›´ä¸º[â€œCHWâ€,â€HWCâ€]ï¼Œé»˜è®¤å€¼ä¸º â€œCHWâ€ï¼Œæ­¤é¡¹ä¸ºå¿…å¡«é¡¹ã€‚</li>
</ul>
<p><strong>ä½¿ç”¨ä¸¾ä¾‹</strong>ï¼š</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># layoutä¸ºNCHWæ—¶ï¼ŒåšBGRè½¬æˆYUV444_128</span></span><br><span class="line">BGR2YUV444_128Transformer(data_format=<span class="string">&#x27;CHW&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># layoutä¸ºNHWCæ—¶ï¼ŒåšBGRè½¬æˆYUV444_128</span></span><br><span class="line">BGR2YUV444_128Transformer(data_format=<span class="string">&#x27;HWC&#x27;</span>)</span><br></pre></td></tr></table></figure></div>



<p><code>RGB2YUV444_128Transformer</code></p>
<p><strong>è¯´æ˜</strong>ï¼š</p>
<p>å°†è¾“å…¥æ ¼å¼ç”±RGBè½¬æˆYUV444_128çš„æ“ä½œã€‚YUV444_128å–å€¼èŒƒå›´ä¸º(-128,127)ã€‚</p>
<p><strong>å‚æ•°</strong>ï¼š</p>
<ul>
<li>data_formatï¼šè¾“å…¥çš„layoutç±»å‹ï¼Œå–å€¼èŒƒå›´ä¸º[â€œCHWâ€,â€HWCâ€]ï¼Œé»˜è®¤å€¼ä¸ºâ€CHWâ€ï¼Œæ­¤é¡¹ä¸ºå¿…å¡«é¡¹ã€‚</li>
</ul>
<p><strong>ä½¿ç”¨ä¸¾ä¾‹</strong>ï¼š</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># layoutä¸ºNCHW æ—¶ï¼ŒåšRGBè½¬æˆYUV444_128</span></span><br><span class="line">RGB2YUV444_128Transformer(data_format=<span class="string">&#x27;CHW&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># layoutä¸ºNHWCæ—¶ï¼ŒåšRGBè½¬æˆ YUV444_128</span></span><br><span class="line">RGB2YUV444_128Transformer(data_format=<span class="string">&#x27;HWC&#x27;</span>)</span><br></pre></td></tr></table></figure></div>



<p><code>BGR2YUVBT601VIDEOTransformer</code></p>
<p><strong>è¯´æ˜</strong>ï¼š</p>
<p>å°†è¾“å…¥æ ¼å¼ç”±BGRè½¬æˆYUV_BT601_Video_Rangeçš„æ“ä½œã€‚</p>
<p>YUV_BT601_Video_Rangeï¼ŒæŸäº›æ‘„åƒå¤´è¾“å…¥æ•°æ®éƒ½æ˜¯YUV BT601(Video Range)æ ¼å¼çš„ï¼Œå–å€¼èŒƒå›´ä¸º16~235ï¼Œè¯¥transformerå°±æ˜¯é€‚é…è¿™ç§æ ¼å¼çš„æ•°æ®äº§ç”Ÿçš„ã€‚</p>
<p><strong>å‚æ•°</strong>ï¼š</p>
<ul>
<li>data_formatï¼šè¾“å…¥çš„layoutç±»å‹ï¼Œå–å€¼èŒƒå›´ä¸º[â€œCHWâ€,â€HWCâ€]ï¼Œé»˜è®¤å€¼ä¸ºâ€CHWâ€ï¼Œæ­¤é¡¹ä¸ºå¿…å¡«é¡¹ã€‚</li>
</ul>
<p><strong>ä½¿ç”¨ä¸¾ä¾‹</strong>ï¼š</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># layoutä¸º NCHWæ—¶ï¼ŒåšBGRè½¬æˆYUV_BT601_Video_Range</span></span><br><span class="line">BGR2YUVBT601VIDEOTransformer(data_format=<span class="string">&#x27;CHW&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># layoutä¸ºNHWCæ—¶ï¼ŒåšBGRè½¬æˆYUV_BT601_Video_Range</span></span><br><span class="line">BGR2YUVBT601VIDEOTransformer(data_format=<span class="string">&#x27;HWC&#x27;</span>)</span><br></pre></td></tr></table></figure></div>



<p><code>RGB2YUVBT601VIDEOTransformer</code></p>
<p><strong>è¯´æ˜</strong>ï¼š</p>
<p>å°†è¾“å…¥æ ¼å¼ç”±RGBè½¬æˆYUV_BT601_Video_Rangeçš„æ“ä½œã€‚</p>
<p>YUV_BT601_Video_Rangeï¼ŒæŸäº›æ‘„åƒå¤´è¾“å…¥æ•°æ®éƒ½æ˜¯YUV BT601(Video Range)æ ¼å¼çš„ï¼Œå–å€¼èŒƒå›´ä¸º16~235ï¼Œè¯¥transformerå°±æ˜¯é€‚é…è¿™ç§æ ¼å¼çš„æ•°æ®äº§ç”Ÿçš„ã€‚</p>
<p><strong>å‚æ•°</strong>ï¼š</p>
<ul>
<li>data_formatï¼šè¾“å…¥çš„layoutç±»å‹ï¼Œå–å€¼èŒƒå›´ä¸º[â€œCHWâ€,â€HWCâ€]ï¼Œé»˜è®¤å€¼ä¸ºâ€CHWâ€ï¼Œæ­¤é¡¹ä¸ºå¿…å¡«é¡¹ã€‚</li>
</ul>
<p><strong>ä½¿ç”¨ä¸¾ä¾‹</strong>ï¼š</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># layoutä¸ºNCHWæ—¶ï¼ŒåšRGBè½¬æˆYUV_BT601_Video_Range</span></span><br><span class="line">RGB2YUVBT601VIDEOTransformer(data_format=<span class="string">&#x27;CHW&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># layoutä¸ºNHWCæ—¶ï¼ŒåšRGBè½¬æˆYUV_BT601_Video_Range</span></span><br><span class="line">RGB2YUVBT601VIDEOTransformer(data_format=<span class="string">&#x27;HWC&#x27;</span>)</span><br></pre></td></tr></table></figure></div>



<p><code>YUVTransformer</code></p>
<p><strong>è¯´æ˜</strong>ï¼š</p>
<p>å°†è¾“å…¥æ ¼å¼è½¬æˆYUV444çš„æ“ä½œã€‚</p>
<p><strong>å‚æ•°</strong>ï¼š</p>
<ul>
<li>color_sequenceï¼šé¢œè‰²åºåˆ—ï¼Œæ­¤é¡¹ä¸ºå¿…å¡«é¡¹ã€‚</li>
</ul>
<p><strong>ä½¿ç”¨ä¸¾ä¾‹</strong>ï¼š</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å°†BGRè¯»å…¥çš„å›¾ç‰‡è½¬ä¸ºYUV444</span></span><br><span class="line">YUVTransformer(color_sequence=<span class="string">&quot;BGR&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å°†RGBè¯»å…¥çš„å›¾ç‰‡è½¬ä¸ºYUV444</span></span><br><span class="line">YUVTransformer(color_sequence=<span class="string">&quot;RGB&quot;</span>)</span><br></pre></td></tr></table></figure></div>



<p><code>ReduceChannelTransformer</code></p>
<p><strong>è¯´æ˜</strong>ï¼š</p>
<p>å°†Cé€šé“ç¼©å‡ä¸ºå•é€šé“çš„æ“ä½œã€‚è¯¥transformerä¸»è¦æ˜¯é’ˆå¯¹äºCé€šé“ï¼Œå¦‚shapeä¸º1<em>3</em>224<em>224 æ”¹ä¸º1</em>1<em>224</em>224ã€‚ ä½¿ç”¨æ—¶layoutä¸€å®šè¦å’Œdata_formatå€¼å¯¹é½ï¼Œé¿å…é€ æˆåˆ é”™é€šé“ã€‚</p>
<p><strong>å‚æ•°</strong>ï¼š</p>
<ul>
<li>data_formatï¼šè¾“å…¥çš„layoutç±»å‹ï¼Œå–å€¼èŒƒå›´ä¸º[â€œCHWâ€, â€œHWCâ€]ï¼Œé»˜è®¤å€¼ä¸ºâ€CHWâ€ã€‚</li>
</ul>
<p><strong>ä½¿ç”¨ä¸¾ä¾‹</strong>ï¼š</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ é™¤layoutä¸ºNCHWçš„Cé€šé“</span></span><br><span class="line">ReduceChannelTransformer()</span><br><span class="line"><span class="comment"># æˆ–è€…</span></span><br><span class="line">ReduceChannelTransformer(data_format=<span class="string">&quot;CHW&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ é™¤layoutä¸ºNHWCçš„Cé€šé“</span></span><br><span class="line">ReduceChannelTransformer(data_format=<span class="string">&quot;HWC&quot;</span>)</span><br></pre></td></tr></table></figure></div>



<p><code>BGR2NV12Transformer</code></p>
<p><strong>è¯´æ˜</strong>ï¼š</p>
<p>å°†è¾“å…¥æ ¼å¼ç”±BGRè½¬æˆNV12çš„æ“ä½œã€‚</p>
<p><strong>å‚æ•°</strong>ï¼š</p>
<ul>
<li>data_formatï¼šè¾“å…¥çš„layoutç±»å‹ï¼Œå–å€¼èŒƒå›´ä¸º[â€œCHWâ€,â€HWCâ€]ï¼Œé»˜è®¤å€¼ä¸ºâ€CHWâ€ã€‚</li>
<li>cvt_modeï¼šcvtæ¨¡å¼ï¼Œå–å€¼èŒƒå›´ä¸º(rgb_calcï¼Œopencv)ï¼Œé»˜è®¤å€¼ä¸ºrgb_calcã€‚<ul>
<li>rgb_calcï¼Œé‡‡ç”¨mergeUVçš„æ–¹å¼å¤„ç†å›¾ç‰‡ï¼›</li>
<li>opencvï¼Œé‡‡ç”¨opencvçš„æ–¹å¼å¤„ç†å›¾ç‰‡ã€‚</li>
</ul>
</li>
</ul>
<p><strong>ä½¿ç”¨ä¸¾ä¾‹</strong>ï¼š</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># layoutä¸ºNCHWæ—¶ï¼Œç”±BGRè½¬ä¸ºNV12ï¼Œé‡‡ç”¨rgb_calcæ¨¡å¼å¤„ç†å›¾ç‰‡</span></span><br><span class="line">BGR2NV12Transformer()</span><br><span class="line"><span class="comment"># æˆ–è€…</span></span><br><span class="line">BGR2NV12Transformer(data_format=<span class="string">&quot;CHW&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># layoutä¸ºNHWCæ—¶ï¼Œç”±BGRè½¬ä¸ºNV12ï¼Œé‡‡ç”¨opencvæ¨¡å¼å¤„ç†å›¾ç‰‡</span></span><br><span class="line">BGR2NV12Transformer(data_format=<span class="string">&quot;HWC&quot;</span>, cvt_mode=<span class="string">&quot;opencv&quot;</span>)</span><br></pre></td></tr></table></figure></div>



<p><code>RGB2NV12Transformer</code></p>
<p><strong>è¯´æ˜</strong>ï¼š</p>
<p>å°†è¾“å…¥æ ¼å¼ç”±RGBè½¬æˆNV12çš„æ“ä½œã€‚</p>
<p><strong>å‚æ•°</strong>ï¼š</p>
<ul>
<li>data_formatï¼šè¾“å…¥çš„ layout ç±»å‹ï¼Œå–å€¼èŒƒå›´ [â€œCHWâ€, â€œHWCâ€], é»˜è®¤å€¼ä¸ºâ€CHWâ€ã€‚</li>
<li>cvt_modeï¼šcvtæ¨¡å¼ï¼Œå–å€¼èŒƒå›´ä¸º(rgb_calc,opencv)ï¼Œé»˜è®¤å€¼ä¸ºrgb_calcã€‚<ul>
<li>rgb_calcï¼Œé‡‡ç”¨mergeUVçš„æ–¹å¼å¤„ç†å›¾ç‰‡ï¼›</li>
<li>opencvï¼Œé‡‡ç”¨opencvçš„æ–¹å¼å¤„ç†å›¾ç‰‡ã€‚</li>
</ul>
</li>
</ul>
<p><strong>ä½¿ç”¨ä¸¾ä¾‹</strong>ï¼š</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># layoutä¸ºNCHWæ—¶ï¼Œæœ‰RGBè½¬ä¸ºNV12ï¼Œé‡‡ç”¨rgb_calcæ¨¡å¼å¤„ç†å›¾ç‰‡</span></span><br><span class="line">RGB2NV12Transformer()</span><br><span class="line"><span class="comment"># æˆ–è€…</span></span><br><span class="line">RGB2NV12Transformer(data_format=<span class="string">&quot;CHW&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># layoutä¸ºNHWCæ—¶ï¼Œæœ‰RGBè½¬ä¸ºNV12ï¼Œé‡‡ç”¨opencvæ¨¡å¼å¤„ç†å›¾ç‰‡</span></span><br><span class="line">RGB2NV12Transformer(data_format=<span class="string">&quot;HWC&quot;</span>, cvt_mode=<span class="string">&quot;opencv&quot;</span>)</span><br></pre></td></tr></table></figure></div>



<p><code>NV12ToYUV444Transformer</code></p>
<p><strong>è¯´æ˜</strong>ï¼š</p>
<p>å°†è¾“å…¥æ ¼å¼ç”±NV12è½¬æˆYUV444çš„æ“ä½œã€‚</p>
<p><strong>å‚æ•°</strong>ï¼š</p>
<ul>
<li>target_sizeï¼šç›®æ ‡å¤§å°ï¼Œå€¼ä¸ºå…ƒç»„ï¼Œå¦‚(240,240)ã€‚</li>
<li>yuv444_output_layoutï¼šyuv444è¾“å‡ºçš„layoutï¼Œå–å€¼èŒƒå›´ä¸º(HWC,CHW)ï¼Œé»˜è®¤å€¼ä¸ºâ€HWCâ€ã€‚</li>
</ul>
<p><strong>ä½¿ç”¨ä¸¾ä¾‹</strong>ï¼š</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># layoutä¸ºNCHW ï¼Œå¤§å°ä¸º768*768, nv12è½¬yuv444</span></span><br><span class="line">NV12ToYUV444Transformer(target_size=(<span class="number">768</span>, <span class="number">768</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># layoutä¸ºNHWC ï¼Œå¤§å°ä¸º224*224, nv12è½¬yuv444</span></span><br><span class="line">NV12ToYUV444Transformer((<span class="number">224</span>, <span class="number">224</span>), yuv444_output_layout=<span class="string">&quot;HWC&quot;</span>)</span><br></pre></td></tr></table></figure></div>



<p><code>WarpAffineTransformer</code></p>
<p><strong>è¯´æ˜</strong>ï¼š</p>
<p><strong>ç”¨äºåšå›¾åƒä»¿å°„å˜æ¢çš„æ“ä½œã€‚</strong></p>
<blockquote>
<p>å›¾åƒæ”¾å°„å˜æ¢ï¼ˆAffine Transformï¼‰æ˜¯å›¾åƒå¤„ç†ä¸­ä¸€ç§å¸¸è§çš„å˜æ¢æ–¹å¼ï¼Œå…·ä½“æ¥è¯´ï¼Œå®ƒæ˜¯é€šè¿‡å¯¹å›¾åƒä¸Šçš„<strong>æ¯ä¸€ä¸ªåƒç´ ç‚¹</strong>è¿›è¡Œçº¿æ€§å˜æ¢ï¼Œæ¥æ”¹å˜å›¾åƒçš„ä½ç½®ã€å¤§å°ã€æ—‹è½¬å’Œå‰ªåˆ‡ç­‰å‡ ä½•å½¢çŠ¶çš„ä¸€ç§å˜æ¢ã€‚</p>
<p>å¸¸è§çš„å›¾åƒæ”¾å°„å˜æ¢åŒ…æ‹¬å¹³ç§»ã€æ—‹è½¬ã€ç¼©æ”¾ã€ç¿»è½¬ã€é•œåƒå’Œå‰ªåˆ‡ç­‰ã€‚</p>
<p>å…¶ä¸­ï¼Œå¹³ç§»æ˜¯æŒ‡å°†æ•´ä¸ªå›¾åƒåœ¨æ°´å¹³æ–¹å‘å’Œç«–ç›´æ–¹å‘ä¸Šè¿›è¡Œç§»åŠ¨ï¼›æ—‹è½¬æ˜¯æŒ‡å°†å›¾åƒæŒ‰ç…§ä¸€ä¸ªæŒ‡å®šçš„è§’åº¦è¿›è¡Œæ—‹è½¬ï¼›ç¼©æ”¾æ˜¯æŒ‡å°†å›¾åƒçš„å¤§å°è¿›è¡Œç¼©æ”¾ï¼›ç¿»è½¬æ˜¯æŒ‡å°†å›¾åƒåœ¨æ°´å¹³æˆ–ç«–ç›´æ–¹å‘ä¸Šè¿›è¡Œç¿»è½¬ï¼›é•œåƒæ˜¯æŒ‡å°†å›¾åƒè¿›è¡Œå¯¹ç§°é•œåƒï¼›å‰ªåˆ‡æ˜¯æŒ‡å°†å›¾åƒåœ¨æ°´å¹³æˆ–ç«–ç›´æ–¹å‘ä¸Šè¿›è¡Œè£å‰ªã€‚</p>
</blockquote>
<p><strong>å‚æ•°</strong>ï¼š</p>
<ul>
<li>input_shapeï¼šè¾“å…¥çš„shapeå€¼ã€‚</li>
<li>scaleï¼šä¹˜ä»¥çš„ç³»æ•°ã€‚</li>
</ul>
<p><strong>ä½¿ç”¨ä¸¾ä¾‹</strong>ï¼š</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¤§å°ä¸º512*512ï¼Œé•¿è¾¹é•¿åº¦ä¸º1.0</span></span><br><span class="line">WarpAffineTransformer((<span class="number">512</span>, <span class="number">512</span>), <span class="number">1.0</span>)</span><br></pre></td></tr></table></figure></div>



<p><code>F32ToS8Transformer</code></p>
<p><strong>è¯´æ˜</strong>ï¼š</p>
<p>ç”¨äºåšè¾“å…¥æ ¼å¼ä»float32è½¬æ¢ä¸ºint8çš„æ“ä½œã€‚</p>
<p><strong>å‚æ•°</strong>ï¼šä¸æ¶‰åŠã€‚</p>
<p><strong>ä½¿ç”¨ä¸¾ä¾‹</strong>ï¼š</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¾“å…¥æ ¼å¼ä» float32è½¬ä¸º int8</span></span><br><span class="line">F32ToS8Transformer()</span><br></pre></td></tr></table></figure></div>



<p><code>F32ToU8Transformer</code></p>
<p><strong>è¯´æ˜</strong>ï¼š</p>
<p>ç”¨äºåšè¾“å…¥æ ¼å¼ä»float32è½¬æ¢ä¸ºuint8çš„æ“ä½œã€‚</p>
<p><strong>å‚æ•°</strong>ï¼šä¸æ¶‰åŠã€‚</p>
<p><strong>ä½¿ç”¨ä¸¾ä¾‹</strong>ï¼š</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¾“å…¥æ ¼å¼ä» float32 è½¬ä¸º uint8</span></span><br><span class="line">F32ToU8Transformer()</span><br></pre></td></tr></table></figure></div>



<h4 id="é‡åŒ–æ„ŸçŸ¥è®­ç»ƒï¼ˆQATï¼‰"><a href="#é‡åŒ–æ„ŸçŸ¥è®­ç»ƒï¼ˆQATï¼‰" class="headerlink" title="é‡åŒ–æ„ŸçŸ¥è®­ç»ƒï¼ˆQATï¼‰"></a>é‡åŒ–æ„ŸçŸ¥è®­ç»ƒï¼ˆQATï¼‰</h4><p><strong>é‡åŒ–æ˜¯æŒ‡ä»¥ä½äºæµ®ç‚¹ç²¾åº¦çš„æ¯”ç‰¹å®½åº¦æ‰§è¡Œè®¡ç®—å’Œå­˜å‚¨å¼ é‡çš„æŠ€æœ¯ã€‚é‡åŒ–æ¨¡å‹ä½¿ç”¨æ•´æ•°è€Œä¸æ˜¯æµ®ç‚¹å€¼å¯¹å¼ é‡æ‰§è¡Œéƒ¨åˆ†æˆ–å…¨éƒ¨æ“ä½œã€‚</strong>ä¸å…¸å‹çš„ FP32 æ¨¡å‹ç›¸æ¯”ï¼Œ<code>horizon_plugin_pytorch</code> æ”¯æŒ INT8 é‡åŒ–ï¼Œä»è€Œä½¿æ¨¡å‹å¤§å°å‡å°‘ 4 å€ï¼Œå†…å­˜å¸¦å®½éœ€æ±‚å‡å°‘ 4 å€ã€‚å¯¹ INT8 è®¡ç®—çš„ç¡¬ä»¶æ”¯æŒé€šå¸¸æ¯” FP32 è®¡ç®—å¿« 2 åˆ° 4 å€ã€‚<strong>é‡åŒ–ä¸»è¦æ˜¯ä¸€ç§åŠ é€Ÿæ¨ç†çš„æŠ€æœ¯ï¼Œé‡åŒ–è¿ç®—åªæ”¯æŒå‰å‘è®¡ç®—ã€‚</strong></p>
<p><code>horizon_plugin_pytorch</code> æä¾›äº†é€‚é… BPU çš„é‡åŒ–æ“ä½œï¼Œæ”¯æŒé‡åŒ–æ„ŸçŸ¥è®­ç»ƒï¼Œè¯¥è®­ç»ƒä½¿ç”¨ä¼ªé‡åŒ–æ¨¡å—å¯¹å‰å‘è®¡ç®—å’Œåå‘ä¼ æ’­ä¸­çš„é‡åŒ–è¯¯å·®è¿›è¡Œå»ºæ¨¡ã€‚<strong>è¯·æ³¨æ„ï¼Œé‡åŒ–è®­ç»ƒçš„æ•´ä¸ªè®¡ç®—è¿‡ç¨‹æ˜¯ä½¿ç”¨æµ®ç‚¹è¿ç®—æ‰§è¡Œçš„</strong>ã€‚åœ¨é‡åŒ–æ„ŸçŸ¥è®­ç»ƒç»“æŸæ—¶ï¼Œ<code>horizon_plugin_pytorch</code> æä¾›è½¬æ¢å‡½æ•°ï¼Œå°†è®­ç»ƒåçš„æ¨¡å‹è½¬æ¢ä¸ºå®šç‚¹æ¨¡å‹ï¼Œåœ¨ BPU ä¸Šä½¿ç”¨æ›´ç´§å‡‘çš„æ¨¡å‹è¡¨ç¤ºå’Œé«˜æ€§èƒ½çŸ¢é‡åŒ–æ“ä½œã€‚</p>
<blockquote>
<ol>
<li>å‰å‘è¿ç®—æ˜¯æ·±åº¦å­¦ä¹ æ¨¡å‹æœ€å¸¸ç”¨çš„è¿ç®—é˜¶æ®µï¼Œä¹Ÿæ˜¯æ€§èƒ½ç“¶é¢ˆæ‰€åœ¨ã€‚é€šè¿‡é‡åŒ–å‰å‘è¿ç®—ï¼Œå¯ä»¥æ˜¾è‘—é™ä½è®¡ç®—èµ„æºçš„éœ€æ±‚ï¼Œæé«˜æ¨ç†é€Ÿåº¦ã€‚<strong>é‡åŒ–åªæ”¯æŒå‰å‘è¿ç®—æ˜¯å› ä¸ºé‡åŒ–ä¸»è¦åº”ç”¨äºæ¨ç†é˜¶æ®µï¼Œé€šè¿‡å°†æ¨¡å‹è½¬æ¢ä¸ºå®šç‚¹æ•°æ¨¡å‹æ¥æé«˜è®¡ç®—æ•ˆç‡</strong></li>
<li>åå‘è¿ç®—ï¼ˆåå‘ä¼ æ’­ï¼‰æ˜¯ç”¨äºè®­ç»ƒæ¨¡å‹çš„é˜¶æ®µï¼Œéœ€è¦ä½¿ç”¨æµ®ç‚¹æ•°ç²¾åº¦è¿›è¡Œæ¢¯åº¦è®¡ç®—å’Œå‚æ•°æ›´æ–°ã€‚ç”±äºé‡åŒ–ä¼šé™ä½æ¨¡å‹çš„ç²¾åº¦ï¼Œå› æ­¤åœ¨åå‘è¿ç®—ä¸­ä½¿ç”¨é‡åŒ–åçš„æ¨¡å‹å¯èƒ½ä¼šå¯¼è‡´æ¢¯åº¦è®¡ç®—å’Œå‚æ•°æ›´æ–°çš„é”™è¯¯ã€‚</li>
<li>é‡åŒ–ä¸»è¦ç”¨äºä¼˜åŒ–æ¨ç†é˜¶æ®µçš„è®¡ç®—æ•ˆç‡ï¼Œè€Œåœ¨è®­ç»ƒé˜¶æ®µï¼Œé€šå¸¸ä½¿ç”¨æµ®ç‚¹æ•°æ¨¡å‹è¿›è¡Œæ¢¯åº¦è®¡ç®—å’Œå‚æ•°æ›´æ–°ï¼Œä»¥ä¿è¯è®­ç»ƒçš„å‡†ç¡®æ€§å’Œæ”¶æ•›æ€§ã€‚</li>
</ol>
</blockquote>
<p>ä¸ºè¡Œæ–‡ç®€æ´ï¼Œæ–‡æ¡£ä¸­ä»£ç é»˜è®¤è¿›è¡Œäº†å¦‚ä¸‹åˆ«åæ›¿æ¢ï¼š</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> horizon_plugin_pytorch <span class="keyword">as</span> horizon</span><br></pre></td></tr></table></figure></div>

<blockquote>
<p>ä¼ªé‡åŒ–ï¼š<code>fake_quant_x = clip(round(x / scale), -128, 127) * scale</code>ã€‚ä½œç”¨æ˜¯å¯¹è¾“å…¥å¼ é‡ x è¿›è¡Œé‡åŒ–æ“ä½œï¼Œå°†å…¶è½¬æ¢ä¸ºä¸€ä¸ªå®šç‚¹æ•°è¡¨ç¤ºã€‚</p>
<p>Tracedæ¨¡å‹ï¼š<strong>ç”±äº <code>PyTorch </code>æ˜¯åŠ¨æ€å›¾ï¼Œè€Œç¼–è¯‘å’Œéƒ¨ç½²åªæ”¯æŒé™æ€å›¾ï¼Œå› æ­¤ï¼Œéœ€è¦å¯¹è®­ç»ƒå¥½çš„æ¨¡å‹è¿›è¡Œ trace å¾—åˆ°é™æ€å›¾ï¼Œè¯¥é™æ€å›¾å¯¹åº”çš„æ¨¡å‹ç§°ä¸º traced æ¨¡å‹ã€‚</strong></p>
<ul>
<li><p>åŠ¨æ€å›¾æ˜¯æŒ‡åœ¨æ¯æ¬¡è®¡ç®—æ—¶éƒ½æ„å»ºè®¡ç®—å›¾çš„æ–¹å¼ã€‚åœ¨åŠ¨æ€å›¾ä¸­ï¼Œè®¡ç®—å›¾æ˜¯æ ¹æ®å®é™…æ‰§è¡Œæµç¨‹åŠ¨æ€ç”Ÿæˆçš„ï¼Œæ¯æ¬¡å‰å‘ä¼ æ’­éƒ½ä¼šé‡æ–°æ„å»ºè®¡ç®—å›¾ã€‚è¿™æ„å‘³ç€å¯ä»¥ä½¿ç”¨å¸¸è§„çš„ç¼–ç¨‹æ§åˆ¶æµè¯­å¥ï¼ˆå¦‚æ¡ä»¶è¯­å¥å’Œå¾ªç¯ï¼‰ï¼Œå¹¶ä¸”å¯ä»¥åœ¨è¿è¡Œæ—¶æ”¹å˜è®¡ç®—å›¾çš„ç»“æ„ã€‚</p>
</li>
<li><p>ä¸ä¹‹å¯¹åº”çš„æ˜¯é™æ€å›¾ï¼Œé™æ€å›¾åœ¨æ‰§è¡Œå‰éœ€è¦å…ˆå®šä¹‰è®¡ç®—å›¾çš„ç»“æ„ï¼Œç„¶åå†æ‰§è¡Œè®¡ç®—ã€‚å…¸å‹çš„é™æ€å›¾æ¡†æ¶æ˜¯TensorFlowã€‚åœ¨é™æ€å›¾ä¸­ï¼Œè®¡ç®—å›¾æ˜¯é¢„å…ˆå®šä¹‰å¥½çš„ï¼Œå¹¶ä¸”åœ¨æ‰§è¡Œå‰ä¸å¯æ›´æ”¹ã€‚</p>
</li>
<li><p>åŠ¨æ€å›¾å’Œé™æ€å›¾çš„ä¸»è¦åŒºåˆ«åœ¨äºè®¡ç®—å›¾çš„æ„å»ºæ—¶æœºå’Œçµæ´»æ€§ã€‚åŠ¨æ€å›¾æ›´åŠ çµæ´»ï¼Œå¯ä»¥æ ¹æ®éœ€è¦åŠ¨æ€åœ°æ„å»ºè®¡ç®—å›¾ï¼Œæ”¯æŒåŠ¨æ€çš„æ§åˆ¶æµï¼Œé€‚åˆäºåŠ¨æ€ã€å¤æ‚çš„æ¨¡å‹ã€‚è€Œé™æ€å›¾æ›´æ³¨é‡è®¡ç®—å›¾çš„é¢„å®šä¹‰å’Œç¼–è¯‘è¿‡ç¨‹ï¼Œå…·æœ‰æ›´é«˜çš„æ‰§è¡Œæ•ˆç‡ï¼Œé€‚åˆäºé™æ€ã€å›ºå®šçš„æ¨¡å‹ã€‚</p>
</li>
</ul>
<p><code>TorchScript</code>æ¨¡å‹ï¼š<code>TorchScript</code>æ˜¯<code>PyTorch</code>çš„ä¸€ç§æ¨¡å‹è¡¨ç¤ºæ ¼å¼å’Œæ‰§è¡Œç¯å¢ƒã€‚<strong>å®ƒå¯ä»¥å°†<code>PyTorch</code>æ¨¡å‹è½¬æ¢ä¸ºä¸€ç§é™æ€å›¾è¡¨ç¤ºå½¢å¼ï¼Œä»¥æä¾›æ›´é«˜çš„æ‰§è¡Œæ€§èƒ½å’Œéƒ¨ç½²çµæ´»æ€§ã€‚</strong></p>
</blockquote>
<h5 id="å¿«é€Ÿå…¥é—¨-1"><a href="#å¿«é€Ÿå…¥é—¨-1" class="headerlink" title="å¿«é€Ÿå…¥é—¨"></a>å¿«é€Ÿå…¥é—¨</h5><blockquote>
<p>åŸºæœ¬æµç¨‹</p>
</blockquote>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230704120423250.png"
                      class="" title="image-20230704120423250"
                >













<h2 id="åµŒå…¥å¼åº”ç”¨å¼€å‘ï¼ˆruntimeï¼‰æ‰‹å†Œ"><a href="#åµŒå…¥å¼åº”ç”¨å¼€å‘ï¼ˆruntimeï¼‰æ‰‹å†Œ" class="headerlink" title="åµŒå…¥å¼åº”ç”¨å¼€å‘ï¼ˆruntimeï¼‰æ‰‹å†Œ"></a>åµŒå…¥å¼åº”ç”¨å¼€å‘ï¼ˆruntimeï¼‰æ‰‹å†Œ</h2><p>æœ¬ç« å†…å®¹åŒ…æ‹¬ <strong>åµŒå…¥å¼åº”ç”¨å¼€å‘æŒ‡å¯¼æ‰‹å†Œ</strong> ã€ <strong>runtime BPU SDK APIæ‰‹å†Œ</strong> ã€ <strong>runtime åŸºç¡€ç¤ºä¾‹åŒ…ä½¿ç”¨è¯´æ˜</strong> ã€ <strong>runtime ai_benchmarkä½¿ç”¨è¯´æ˜</strong> ã€ <strong>å·¥å…·ä»‹ç»</strong> ã€‚ ä¸ºæ‚¨è¯¦ç»†ä»‹ç»åœ¨åœ°å¹³çº¿å¹³å°è¿›è¡Œåº”ç”¨å¼€å‘çš„æ­¥éª¤ï¼Œå¹¶æä¾›APIã€æ•°æ®ã€ç»“æ„ä½“ã€æ’å¸ƒã€å¯¹é½è§„åˆ™ã€åº”ç”¨å¼€å‘ç¤ºä¾‹ã€å·¥å…·ä»‹ç»ç­‰å†…å®¹ï¼Œ ä¾›æ‚¨è¿›è¡Œå‚è€ƒã€‚</p>
<h3 id="åµŒå…¥å¼åº”ç”¨å¼€å‘æŒ‡å¯¼"><a href="#åµŒå…¥å¼åº”ç”¨å¼€å‘æŒ‡å¯¼" class="headerlink" title="åµŒå…¥å¼åº”ç”¨å¼€å‘æŒ‡å¯¼"></a>åµŒå…¥å¼åº”ç”¨å¼€å‘æŒ‡å¯¼</h3><h4 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h4><p>æœ¬ç« èŠ‚ä»‹ç»å¦‚ä½•åœ¨åœ°å¹³çº¿å¹³å°è¿›è¡Œåº”ç”¨å¼€å‘ï¼Œå°†ç»è¿‡è½¬æ¢åçš„æ¨¡å‹éƒ¨ç½²åˆ°J5å¼€å‘æ¿ä¸Šè¿è¡Œèµ·æ¥ï¼Œéœ€è¦æ‚¨æ³¨æ„çš„ç›¸å…³æ³¨æ„äº‹é¡¹åœ¨æ­¤ç« èŠ‚ä¹Ÿä¼šä»‹ç»ã€‚</p>
<p>æœ€ç®€æ˜“çš„å¼€å‘è¿‡ç¨‹åŒ…æ‹¬å·¥ç¨‹åˆ›å»ºã€å·¥ç¨‹å®ç°ã€å·¥ç¨‹ç¼–è¯‘ä¸è¿è¡Œä¸‰ä¸ªé˜¶æ®µã€‚ è€ƒè™‘åˆ°å®é™…ä¸šåŠ¡åœºæ™¯å¼€å‘çš„è¾ƒå¤æ‚éœ€æ±‚ï¼Œå¯¹äºå¸¸ç”¨çš„å¤šæ¨¡å‹æ§åˆ¶æ¦‚å¿µå’Œåº”ç”¨è°ƒä¼˜å»ºè®®ä¹Ÿéƒ½æä¾›äº†ä¸€äº›è¯´æ˜ã€‚</p>
<h4 id="å·¥ç¨‹åˆ›å»º"><a href="#å·¥ç¨‹åˆ›å»º" class="headerlink" title="å·¥ç¨‹åˆ›å»º"></a>å·¥ç¨‹åˆ›å»º</h4><h5 id="CMakeå·¥å…·"><a href="#CMakeå·¥å…·" class="headerlink" title="CMakeå·¥å…·"></a>CMakeå·¥å…·</h5><p>Makeæ˜¯ä¸€ç§æ„å»ºå·¥å…·ï¼Œ<strong>å®ƒç”¨äºè‡ªåŠ¨åŒ–æ„å»ºå’Œç®¡ç†è½¯ä»¶é¡¹ç›®çš„ç¼–è¯‘è¿‡ç¨‹</strong>ã€‚Makeå·¥å…·é€šè¿‡è¯»å–Makefileæ–‡ä»¶ä¸­çš„è§„åˆ™å’Œä¾èµ–å…³ç³»æ¥ç¡®å®šå“ªäº›æºæ–‡ä»¶éœ€è¦é‡æ–°ç¼–è¯‘ï¼Œç„¶åè°ƒç”¨é€‚å½“çš„ç¼–è¯‘å™¨å’Œé“¾æ¥å™¨æ¥ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶ã€åº“æ–‡ä»¶æˆ–å…¶ä»–ç”Ÿæˆç‰©ã€‚</p>
<p> <a class="link"   target="_blank" rel="noopener" href="https://www.hahack.com/wiki/tools-makefile.html" >GNU Make <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ï¼ŒQT çš„ <a class="link"   target="_blank" rel="noopener" href="http://qt-project.org/doc/qt-4.8/qmake-manual.html" >qmake <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ï¼Œå¾®è½¯çš„ <a class="link"   target="_blank" rel="noopener" href="http://msdn.microsoft.com/en-us/library/ms930369.aspx" >MS nmake <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>ï¼ŒBSD Makeï¼ˆ<a class="link"   target="_blank" rel="noopener" href="http://www.freebsd.org/doc/en/books/pmake/" >pmake <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>ï¼‰ï¼Œ<a class="link"   target="_blank" rel="noopener" href="http://makepp.sourceforge.net/" >Makepp <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>ï¼Œç­‰ç­‰ã€‚è¿™äº› Make å·¥å…·éµå¾ªç€ä¸åŒçš„è§„èŒƒå’Œæ ‡å‡†ï¼Œæ‰€æ‰§è¡Œçš„ Makefile æ ¼å¼ä¹Ÿåƒå·®ä¸‡åˆ«ã€‚è¿™æ ·å°±å¸¦æ¥äº†ä¸€ä¸ªä¸¥å³»çš„é—®é¢˜ï¼šå¦‚æœè½¯ä»¶æƒ³è·¨å¹³å°ï¼Œå¿…é¡»è¦ä¿è¯èƒ½å¤Ÿåœ¨ä¸åŒå¹³å°ç¼–è¯‘ã€‚è€Œå¦‚æœä½¿ç”¨ä¸Šé¢çš„ Make å·¥å…·ï¼Œå°±å¾—ä¸ºæ¯ä¸€ç§æ ‡å‡†å†™ä¸€æ¬¡ Makefile ï¼Œè¿™å°†æ˜¯ä¸€ä»¶è®©äººæŠ“ç‹‚çš„å·¥ä½œã€‚</p>
<p>CMake å°±æ˜¯é’ˆå¯¹ä¸Šé¢é—®é¢˜æ‰€è®¾è®¡çš„å·¥å…·ï¼š<strong>å®ƒé¦–å…ˆå…è®¸å¼€å‘è€…ç¼–å†™ä¸€ç§å¹³å°æ— å…³çš„ CMakeList.txt æ–‡ä»¶æ¥å®šåˆ¶æ•´ä¸ªç¼–è¯‘æµç¨‹ï¼Œç„¶åå†æ ¹æ®ç›®æ ‡ç”¨æˆ·çš„å¹³å°è¿›ä¸€æ­¥ç”Ÿæˆæ‰€éœ€çš„æœ¬åœ°åŒ– Makefile å’Œå·¥ç¨‹æ–‡ä»¶</strong>ï¼Œå¦‚ Unix çš„ Makefile æˆ– Windows çš„ Visual Studio å·¥ç¨‹ã€‚ä»è€Œåšåˆ°â€œWrite once, run everywhereâ€ã€‚æ˜¾ç„¶ï¼ŒCMake æ˜¯ä¸€ä¸ªæ¯”ä¸Šè¿°å‡ ç§ make æ›´é«˜çº§çš„ç¼–è¯‘é…ç½®å·¥å…·ã€‚ä¸€äº›ä½¿ç”¨ CMake ä½œä¸ºé¡¹ç›®æ¶æ„ç³»ç»Ÿçš„çŸ¥åå¼€æºé¡¹ç›®æœ‰ <a class="link"   target="_blank" rel="noopener" href="http://www.vtk.org/" >VTK <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>ã€<a class="link"   target="_blank" rel="noopener" href="http://www.itk.org/" >ITK <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>ã€<a class="link"   target="_blank" rel="noopener" href="http://kde.org/" >KDE <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>ã€<a class="link"   target="_blank" rel="noopener" href="http://www.opencv.org.cn/opencvdoc/2.3.2/html/modules/core/doc/intro.html" >OpenCV <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>ã€<a class="link"   target="_blank" rel="noopener" href="http://www.openscenegraph.org/" >OSG <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ç­‰ [<a class="link"   target="_blank" rel="noopener" href="https://www.hahack.com/codes/cmake/#fn1" >1] <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>ã€‚</p>
<p>åœ¨ linux å¹³å°ä¸‹ä½¿ç”¨ CMake ç”Ÿæˆ Makefile å¹¶ç¼–è¯‘çš„æµç¨‹å¦‚ä¸‹ï¼š</p>
<ol>
<li>ç¼–å†™ CMake é…ç½®æ–‡ä»¶ CMakeLists.txt ã€‚</li>
<li>æ‰§è¡Œå‘½ä»¤ <code>cmake PATH</code> æˆ–è€… <code>ccmake PATH</code> ç”Ÿæˆ Makefileï¼ˆ<code>ccmake</code> å’Œ <code>cmake</code> çš„åŒºåˆ«åœ¨äºå‰è€…æä¾›äº†ä¸€ä¸ªäº¤äº’å¼çš„ç•Œé¢ï¼‰ã€‚å…¶ä¸­ï¼Œ <code>PATH</code> æ˜¯ CMakeLists.txt æ‰€åœ¨çš„ç›®å½•ã€‚</li>
<li>ä½¿ç”¨ <code>make</code> å‘½ä»¤è¿›è¡Œç¼–è¯‘ã€‚</li>
</ol>
<p>æœ¬æ–‡å°†ä»å®ä¾‹å…¥æ‰‹ï¼Œä¸€æ­¥æ­¥è®²è§£ CMake çš„å¸¸è§ç”¨æ³•ï¼Œæ–‡ä¸­æ‰€æœ‰çš„å®ä¾‹ä»£ç å¯ä»¥åœ¨<a class="link"   target="_blank" rel="noopener" href="https://github.com/wzpan/cmake-demo" >è¿™é‡Œ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>æ‰¾åˆ°ã€‚å¦‚æœä½ è¯»å®Œä»è§‰å¾—æ„çŠ¹æœªå°½ï¼Œå¯ä»¥ç»§ç»­å­¦ä¹ æˆ‘åœ¨æ–‡ç« æœ«å°¾æä¾›çš„å…¶ä»–èµ„æºã€‚</p>
<h6 id="å…¥é—¨æ¡ˆä¾‹ï¼šå•ä¸ªæºæ–‡ä»¶"><a href="#å…¥é—¨æ¡ˆä¾‹ï¼šå•ä¸ªæºæ–‡ä»¶" class="headerlink" title="å…¥é—¨æ¡ˆä¾‹ï¼šå•ä¸ªæºæ–‡ä»¶"></a>å…¥é—¨æ¡ˆä¾‹ï¼šå•ä¸ªæºæ–‡ä»¶</h6><p>å¯¹äºç®€å•çš„é¡¹ç›®ï¼Œåªéœ€è¦å†™å‡ è¡Œä»£ç å°±å¯ä»¥äº†ã€‚ä¾‹å¦‚ï¼Œå‡è®¾ç°åœ¨æˆ‘ä»¬çš„é¡¹ç›®ä¸­åªæœ‰ä¸€ä¸ªæºæ–‡ä»¶ <a class="link"   target="_blank" rel="noopener" href="http://main.cc/" >main.cc <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ï¼Œè¯¥ç¨‹åºçš„ç”¨é€”æ˜¯è®¡ç®—ä¸€ä¸ªæ•°çš„æŒ‡æ•°å¹‚ã€‚</p>
<div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * power - Calculate the power of number.</span></span><br><span class="line"><span class="comment"> * @param base: Base value.</span></span><br><span class="line"><span class="comment"> * @param exponent: Exponent value.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @return base raised to the power exponent.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="type">double</span> <span class="title">power</span><span class="params">(<span class="type">double</span> base, <span class="type">int</span> exponent)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> result = base;</span><br><span class="line">    <span class="type">int</span> i;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (exponent == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span>(i = <span class="number">1</span>; i &lt; exponent; ++i)&#123;</span><br><span class="line">        result = result * base;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (argc &lt; <span class="number">3</span>)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Usage: %s base exponent \n&quot;</span>, argv[<span class="number">0</span>]);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">double</span> base = <span class="built_in">atof</span>(argv[<span class="number">1</span>]);</span><br><span class="line">    <span class="type">int</span> exponent = <span class="built_in">atoi</span>(argv[<span class="number">2</span>]);</span><br><span class="line">    <span class="type">double</span> result = <span class="built_in">power</span>(base, exponent);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%g ^ %d is %g\n&quot;</span>, base, exponent, result);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<blockquote>
<p>ç¼–å†™ CMakeLists.txt</p>
</blockquote>
<p>é¦–å…ˆç¼–å†™ CMakeLists.txt æ–‡ä»¶ï¼Œå¹¶ä¿å­˜åœ¨ä¸ <a class="link"   target="_blank" rel="noopener" href="http://main.cc/" >main.cc <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> æºæ–‡ä»¶åŒä¸ªç›®å½•ä¸‹ï¼š</p>
<p>CMakeLists.txt çš„è¯­æ³•æ¯”è¾ƒç®€å•ï¼Œç”±å‘½ä»¤ã€æ³¨é‡Šå’Œç©ºæ ¼ç»„æˆï¼Œå…¶ä¸­å‘½ä»¤æ˜¯ä¸åŒºåˆ†å¤§å°å†™çš„ã€‚ç¬¦å· <code>#</code> åé¢çš„å†…å®¹è¢«è®¤ä¸ºæ˜¯æ³¨é‡Šã€‚å‘½ä»¤ç”±å‘½ä»¤åç§°ã€å°æ‹¬å·å’Œå‚æ•°ç»„æˆï¼Œå‚æ•°ä¹‹é—´ä½¿ç”¨ç©ºæ ¼è¿›è¡Œé—´éš”ã€‚</p>
<p>å¯¹äºä¸Šé¢çš„ CMakeLists.txt æ–‡ä»¶ï¼Œä¾æ¬¡å‡ºç°äº†å‡ ä¸ªå‘½ä»¤ï¼š</p>
<ol>
<li><code>cmake_minimum_required</code>ï¼šæŒ‡å®šè¿è¡Œæ­¤é…ç½®æ–‡ä»¶æ‰€éœ€çš„ CMake çš„æœ€ä½ç‰ˆæœ¬ï¼›</li>
<li><code>project</code>ï¼šå‚æ•°å€¼æ˜¯ <code>Demo1</code>ï¼Œè¯¥å‘½ä»¤è¡¨ç¤ºé¡¹ç›®çš„åç§°æ˜¯ <code>Demo1</code> ã€‚</li>
<li><code>add_executable</code>ï¼š <strong>å°†åä¸º <a class="link"   target="_blank" rel="noopener" href="http://main.cc/" >main.cc <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> çš„æºæ–‡ä»¶ç¼–è¯‘æˆä¸€ä¸ªåç§°ä¸º Demo çš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚</strong></li>
</ol>
<blockquote>
<p>ç¼–è¯‘é¡¹ç›®</p>
</blockquote>
<p>ä¹‹åï¼Œåœ¨å½“å‰ç›®å½•æ‰§è¡Œ <code>cmake .</code> ï¼Œå¾—åˆ° Makefile åå†ä½¿ç”¨ <code>make</code> å‘½ä»¤ç¼–è¯‘å¾—åˆ° Demo1 å¯æ‰§è¡Œæ–‡ä»¶ã€‚</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[ehome@xman Demo1]$ cmake .</span><br><span class="line">-- The C compiler identification is GNU 4.8.2</span><br><span class="line">-- The CXX compiler identification is GNU 4.8.2</span><br><span class="line">-- Check for working C compiler: /usr/sbin/cc</span><br><span class="line">-- Check for working C compiler: /usr/sbin/cc -- works</span><br><span class="line">-- Detecting C compiler ABI info</span><br><span class="line">-- Detecting C compiler ABI info - done</span><br><span class="line">-- Check for working CXX compiler: /usr/sbin/c++</span><br><span class="line">-- Check for working CXX compiler: /usr/sbin/c++ -- works</span><br><span class="line">-- Detecting CXX compiler ABI info</span><br><span class="line">-- Detecting CXX compiler ABI info - done</span><br><span class="line">-- Configuring done</span><br><span class="line">-- Generating done</span><br><span class="line">-- Build files have been written to: /home/ehome/Documents/programming/C/power/Demo1</span><br><span class="line">[ehome@xman Demo1]$ make</span><br><span class="line">Scanning dependencies of target Demo</span><br><span class="line">[100%] Building C object CMakeFiles/Demo.dir/main.cc.o</span><br><span class="line">Linking C executable Demo</span><br><span class="line">[100%] Built target Demo</span><br><span class="line">[ehome@xman Demo1]$ ./Demo 5 4</span><br><span class="line">5 ^ 4 is 625</span><br><span class="line">[ehome@xman Demo1]$ ./Demo 7 3</span><br><span class="line">7 ^ 3 is 343</span><br><span class="line">[ehome@xman Demo1]$ ./Demo 2 10</span><br><span class="line">2 ^ 10 is 1024</span><br></pre></td></tr></table></figure></div>

<h6 id="å¤šä¸ªæºæ–‡ä»¶"><a href="#å¤šä¸ªæºæ–‡ä»¶" class="headerlink" title="å¤šä¸ªæºæ–‡ä»¶"></a>å¤šä¸ªæºæ–‡ä»¶</h6><blockquote>
<p>åŒä¸€ç›®å½•ï¼Œå¤šä¸ªæºæ–‡ä»¶</p>
</blockquote>
<p>ä¸Šé¢çš„ä¾‹å­åªæœ‰å•ä¸ªæºæ–‡ä»¶ã€‚ç°åœ¨å‡å¦‚æŠŠ <code>power</code> å‡½æ•°å•ç‹¬å†™è¿›ä¸€ä¸ªåä¸º <code>MathFunctions.c</code> çš„æºæ–‡ä»¶é‡Œï¼Œä½¿å¾—è¿™ä¸ªå·¥ç¨‹å˜æˆå¦‚ä¸‹çš„å½¢å¼ï¼š</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">./Demo2</span><br><span class="line">    |</span><br><span class="line">    +--- main.cc</span><br><span class="line">    |</span><br><span class="line">    +--- MathFunctions.cc</span><br><span class="line">    |</span><br><span class="line">    +--- MathFunctions.h</span><br></pre></td></tr></table></figure></div>

<p>è¿™ä¸ªæ—¶å€™ï¼ŒCMakeLists.txt å¯ä»¥æ”¹æˆå¦‚ä¸‹çš„å½¢å¼ï¼š</p>
<div class="highlight-container" data-rel="Cmake"><figure class="iseeu highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># CMake æœ€ä½ç‰ˆæœ¬å·è¦æ±‚</span></span><br><span class="line"><span class="keyword">cmake_minimum_required</span> (VERSION <span class="number">2.8</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># é¡¹ç›®ä¿¡æ¯</span></span><br><span class="line"><span class="keyword">project</span> (Demo2)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŒ‡å®šç”Ÿæˆç›®æ ‡</span></span><br><span class="line"><span class="keyword">add_executable</span>(Demo main.cc MathFunctions.cc)</span><br></pre></td></tr></table></figure></div>

<p>å”¯ä¸€çš„æ”¹åŠ¨åªæ˜¯åœ¨ <code>add_executable</code> å‘½ä»¤ä¸­å¢åŠ äº†ä¸€ä¸ª <code>MathFunctions.cc</code> æºæ–‡ä»¶ã€‚è¿™æ ·å†™å½“ç„¶æ²¡ä»€ä¹ˆé—®é¢˜ï¼Œä½†æ˜¯å¦‚æœæºæ–‡ä»¶å¾ˆå¤šï¼ŒæŠŠæ‰€æœ‰æºæ–‡ä»¶çš„åå­—éƒ½åŠ è¿›å»å°†æ˜¯ä¸€ä»¶çƒ¦äººçš„å·¥ä½œã€‚æ›´çœäº‹çš„æ–¹æ³•æ˜¯ä½¿ç”¨ <code>aux_source_directory</code> å‘½ä»¤ï¼Œè¯¥å‘½ä»¤ä¼šæŸ¥æ‰¾æŒ‡å®šç›®å½•ä¸‹çš„æ‰€æœ‰æºæ–‡ä»¶ï¼Œç„¶åå°†ç»“æœå­˜è¿›æŒ‡å®šå˜é‡åã€‚å…¶è¯­æ³•å¦‚ä¸‹ï¼š</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aux_source_directory(&lt;dir&gt; &lt;variable&gt;)</span><br></pre></td></tr></table></figure></div>

<p>å› æ­¤ï¼Œå¯ä»¥ä¿®æ”¹ CMakeLists.txt å¦‚ä¸‹ï¼š</p>
<div class="highlight-container" data-rel="Cmake"><figure class="iseeu highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># CMake æœ€ä½ç‰ˆæœ¬å·è¦æ±‚</span></span><br><span class="line"><span class="keyword">cmake_minimum_required</span> (VERSION <span class="number">2.8</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># é¡¹ç›®ä¿¡æ¯</span></span><br><span class="line"><span class="keyword">project</span> (Demo2)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥æ‰¾å½“å‰ç›®å½•ä¸‹çš„æ‰€æœ‰æºæ–‡ä»¶</span></span><br><span class="line"><span class="comment"># å¹¶å°†åç§°ä¿å­˜åˆ° DIR_SRCS å˜é‡</span></span><br><span class="line"><span class="keyword">aux_source_directory</span>(. DIR_SRCS)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŒ‡å®šç”Ÿæˆç›®æ ‡</span></span><br><span class="line"><span class="keyword">add_executable</span>(Demo <span class="variable">$&#123;DIR_SRCS&#125;</span>)</span><br></pre></td></tr></table></figure></div>

<p><strong>è¿™æ ·ï¼ŒCMake ä¼šå°†å½“å‰ç›®å½•æ‰€æœ‰æºæ–‡ä»¶çš„æ–‡ä»¶åèµ‹å€¼ç»™å˜é‡ <code>DIR_SRCS</code> ï¼Œå†æŒ‡ç¤ºå˜é‡ <code>DIR_SRCS</code> ä¸­çš„æºæ–‡ä»¶éœ€è¦ç¼–è¯‘æˆä¸€ä¸ªåç§°ä¸º Demo çš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚</strong></p>
<blockquote>
<p>å¤šä¸ªç›®å½•ï¼Œå¤šä¸ªæºæ–‡ä»¶</p>
</blockquote>
<p>ç°åœ¨è¿›ä¸€æ­¥å°† MathFunctions.h å’Œ <a class="link"   target="_blank" rel="noopener" href="http://mathfunctions.cc/" >MathFunctions.cc <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> æ–‡ä»¶ç§»åŠ¨åˆ° math ç›®å½•ä¸‹ã€‚</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">./Demo3</span><br><span class="line">    |</span><br><span class="line">    +--- main.cc</span><br><span class="line">    |</span><br><span class="line">    +--- math/</span><br><span class="line">          |</span><br><span class="line">          +--- MathFunctions.cc</span><br><span class="line">          |</span><br><span class="line">          +--- MathFunctions.h</span><br></pre></td></tr></table></figure></div>

<p>å¯¹äºè¿™ç§æƒ…å†µï¼Œéœ€è¦åˆ†åˆ«åœ¨é¡¹ç›®æ ¹ç›®å½• Demo3 å’Œ math ç›®å½•é‡Œå„ç¼–å†™ä¸€ä¸ª CMakeLists.txt æ–‡ä»¶ã€‚ä¸ºäº†æ–¹ä¾¿ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆå°† math ç›®å½•é‡Œçš„æ–‡ä»¶ç¼–è¯‘æˆ<strong>é™æ€åº“</strong>å†ç”± main å‡½æ•°è°ƒç”¨ã€‚</p>
<blockquote>
<p><strong>é™æ€é“¾æ¥åº“ï¼ˆStatic Linking Libraryï¼‰æ˜¯ä¸€ç§åœ¨ç¼–è¯‘æ—¶å°†åº“æ–‡ä»¶çš„ä»£ç å’Œç¨‹åºä»£ç åˆå¹¶æˆä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶çš„æ–¹å¼</strong>ã€‚åœ¨é™æ€é“¾æ¥è¿‡ç¨‹ä¸­ï¼Œç¼–è¯‘å™¨ä¼šå°†ç¨‹åºæ‰€ä¾èµ–çš„é™æ€é“¾æ¥åº“çš„ç›®æ ‡ä»£ç ç›´æ¥åµŒå…¥åˆ°æœ€ç»ˆç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶ä¸­ï¼Œå½¢æˆä¸€ä¸ªç‹¬ç«‹çš„ã€åŒ…å«æ‰€æœ‰å¿…è¦ä»£ç çš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚</p>
<p>ä½¿ç”¨é™æ€é“¾æ¥åº“çš„ä¸»è¦ä¼˜ç‚¹åŒ…æ‹¬ï¼š</p>
<ol>
<li>ç‹¬ç«‹æ€§ï¼šé™æ€é“¾æ¥åº“ä½¿å¾—å¯æ‰§è¡Œæ–‡ä»¶å…·æœ‰å®Œå…¨çš„ç‹¬ç«‹æ€§ï¼Œ<strong>ä¸ä¾èµ–äºç³»ç»Ÿä¸­æ˜¯å¦å­˜åœ¨ç‰¹å®šçš„åº“æ–‡ä»¶</strong>ã€‚è¿™æ ·å¯ä»¥ç¡®ä¿ç¨‹åºåœ¨å…¶ä»–ç³»ç»Ÿä¸­è¿è¡Œæ—¶ä¸ä¼šå› ä¸ºç¼ºå°‘åº“æ–‡ä»¶è€Œå‡ºé”™ã€‚</li>
<li>æ€§èƒ½ï¼šé™æ€é“¾æ¥åº“åœ¨ç¼–è¯‘æ—¶è¢«åµŒå…¥åˆ°å¯æ‰§è¡Œæ–‡ä»¶ä¸­ï¼Œä¸éœ€è¦åœ¨è¿è¡Œæ—¶è¿›è¡Œåº“æ–‡ä»¶çš„åŠ è½½å’Œé“¾æ¥ï¼Œå› æ­¤å¯ä»¥å‡å°‘ç¨‹åºçš„å¯åŠ¨æ—¶é—´ï¼Œå¹¶ä¸”åœ¨è¿è¡Œè¿‡ç¨‹ä¸­ä¹Ÿå¯ä»¥æé«˜ä¸€å®šçš„æ‰§è¡Œæ•ˆç‡ã€‚</li>
<li>ç‰ˆæœ¬æ§åˆ¶ï¼šé™æ€é“¾æ¥åº“å¯ä»¥ç¡®ä¿ç¨‹åºä½¿ç”¨çš„æ˜¯æŒ‡å®šç‰ˆæœ¬çš„åº“æ–‡ä»¶ï¼Œé¿å…äº†åœ¨ä¸åŒç‰ˆæœ¬çš„åº“æ–‡ä»¶ä¹‹é—´å‡ºç°å…¼å®¹æ€§é—®é¢˜ã€‚</li>
<li>åˆ†å‘ç®€å•ï¼šä½¿ç”¨é™æ€é“¾æ¥åº“çš„ç¨‹åºå¯ä»¥æ›´æ–¹ä¾¿åœ°è¿›è¡Œåˆ†å‘ï¼Œå› ä¸ºåªéœ€è¦å°†ä¸€ä¸ªç‹¬ç«‹çš„å¯æ‰§è¡Œæ–‡ä»¶äº¤ä»˜ç»™ç”¨æˆ·ï¼Œè€Œä¸éœ€è¦é¢å¤–æä¾›åº“æ–‡ä»¶ã€‚</li>
</ol>
</blockquote>
<p>æ ¹ç›®å½•ä¸­çš„ CMakeLists.txt ï¼š</p>
<div class="highlight-container" data-rel="Cmake"><figure class="iseeu highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># CMake æœ€ä½ç‰ˆæœ¬å·è¦æ±‚</span></span><br><span class="line"><span class="keyword">cmake_minimum_required</span> (VERSION <span class="number">2.8</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># é¡¹ç›®ä¿¡æ¯</span></span><br><span class="line"><span class="keyword">project</span> (Demo3)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥æ‰¾å½“å‰ç›®å½•ä¸‹çš„æ‰€æœ‰æºæ–‡ä»¶</span></span><br><span class="line"><span class="comment"># å¹¶å°†åç§°ä¿å­˜åˆ° DIR_SRCS å˜é‡</span></span><br><span class="line"><span class="keyword">aux_source_directory</span>(. DIR_SRCS)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ·»åŠ  math å­ç›®å½•</span></span><br><span class="line"><span class="keyword">add_subdirectory</span>(<span class="keyword">math</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŒ‡å®šç”Ÿæˆç›®æ ‡ </span></span><br><span class="line"><span class="keyword">add_executable</span>(Demo main.cc)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ·»åŠ é“¾æ¥åº“</span></span><br><span class="line"><span class="keyword">target_link_libraries</span>(Demo MathFunctions)</span><br></pre></td></tr></table></figure></div>

<p>è¯¥æ–‡ä»¶æ·»åŠ äº†ä¸‹é¢çš„å†…å®¹: ç¬¬3è¡Œï¼Œä½¿ç”¨å‘½ä»¤ <code>add_subdirectory</code> æŒ‡æ˜æœ¬é¡¹ç›®åŒ…å«ä¸€ä¸ªå­ç›®å½• mathï¼Œè¿™æ · math ç›®å½•ä¸‹çš„ CMakeLists.txt æ–‡ä»¶å’Œæºä»£ç ä¹Ÿä¼šè¢«å¤„ç† ã€‚ç¬¬6è¡Œï¼Œä½¿ç”¨å‘½ä»¤ <code>target_link_libraries</code> æŒ‡æ˜å¯æ‰§è¡Œæ–‡ä»¶ main éœ€è¦è¿æ¥ä¸€ä¸ªåä¸º MathFunctions çš„é“¾æ¥åº“ ã€‚</p>
<p>å­ç›®å½•ä¸­çš„ CMakeLists.txtï¼š</p>
<div class="highlight-container" data-rel="Cmake"><figure class="iseeu highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥æ‰¾å½“å‰ç›®å½•ä¸‹çš„æ‰€æœ‰æºæ–‡ä»¶</span></span><br><span class="line"><span class="comment"># å¹¶å°†åç§°ä¿å­˜åˆ° DIR_LIB_SRCS å˜é‡</span></span><br><span class="line"><span class="keyword">aux_source_directory</span>(. DIR_LIB_SRCS)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç”Ÿæˆé“¾æ¥åº“</span></span><br><span class="line"><span class="keyword">add_library</span> (MathFunctions <span class="variable">$&#123;DIR_LIB_SRCS&#125;</span>)</span><br></pre></td></tr></table></figure></div>

<p>åœ¨è¯¥æ–‡ä»¶ä¸­ä½¿ç”¨å‘½ä»¤ <code>add_library</code> å°† src ç›®å½•ä¸­çš„æºæ–‡ä»¶ç¼–è¯‘ä¸ºé™æ€é“¾æ¥åº“ã€‚</p>
<h6 id="è‡ªå®šä¹‰ç¼–è¯‘é€‰é¡¹"><a href="#è‡ªå®šä¹‰ç¼–è¯‘é€‰é¡¹" class="headerlink" title="è‡ªå®šä¹‰ç¼–è¯‘é€‰é¡¹"></a>è‡ªå®šä¹‰ç¼–è¯‘é€‰é¡¹</h6><p>CMake å…è®¸ä¸ºé¡¹ç›®å¢åŠ ç¼–è¯‘é€‰é¡¹ï¼Œä»è€Œå¯ä»¥æ ¹æ®ç”¨æˆ·çš„ç¯å¢ƒå’Œéœ€æ±‚é€‰æ‹©æœ€åˆé€‚çš„ç¼–è¯‘æ–¹æ¡ˆã€‚</p>
<p>ä¾‹å¦‚ï¼Œå¯ä»¥å°† MathFunctions åº“è®¾ä¸ºä¸€ä¸ªå¯é€‰çš„åº“ï¼Œå¦‚æœè¯¥é€‰é¡¹ä¸º <code>ON</code> ï¼Œå°±ä½¿ç”¨è¯¥åº“å®šä¹‰çš„æ•°å­¦å‡½æ•°æ¥è¿›è¡Œè¿ç®—ã€‚å¦åˆ™å°±è°ƒç”¨æ ‡å‡†åº“ä¸­çš„æ•°å­¦å‡½æ•°åº“ã€‚</p>
<blockquote>
<p>ä¿®æ”¹ CMakeLists æ–‡ä»¶</p>
</blockquote>
<p>æˆ‘ä»¬è¦åšçš„ç¬¬ä¸€æ­¥æ˜¯åœ¨é¡¶å±‚çš„ CMakeLists.txt æ–‡ä»¶ä¸­æ·»åŠ è¯¥é€‰é¡¹ï¼š</p>
<div class="highlight-container" data-rel="Cmake"><figure class="iseeu highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># CMake æœ€ä½ç‰ˆæœ¬å·è¦æ±‚</span></span><br><span class="line"><span class="keyword">cmake_minimum_required</span> (VERSION <span class="number">2.8</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># é¡¹ç›®ä¿¡æ¯</span></span><br><span class="line"><span class="keyword">project</span> (Demo4)</span><br><span class="line"></span><br><span class="line"><span class="keyword">set</span>(CMAKE_INCLUDE_CURRENT_DIR <span class="keyword">ON</span>)				<span class="comment"># è®¾ç½® CMake åŒ…å«å½“å‰ç›®å½•ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ˜¯å¦ä½¿ç”¨è‡ªå·±çš„ MathFunctions åº“</span></span><br><span class="line"><span class="keyword">option</span> (USE_MYMATH</span><br><span class="line">	   <span class="string">&quot;Use provided math implementation&quot;</span> <span class="keyword">ON</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># åŠ å…¥ä¸€ä¸ªé…ç½®å¤´æ–‡ä»¶ï¼Œç”¨äºå¤„ç† CMake å¯¹æºç çš„è®¾ç½®</span></span><br><span class="line"><span class="keyword">configure_file</span> (</span><br><span class="line">  <span class="string">&quot;$&#123;PROJECT_SOURCE_DIR&#125;/config.h.in&quot;</span></span><br><span class="line">  <span class="string">&quot;$&#123;PROJECT_BINARY_DIR&#125;/config.h&quot;</span></span><br><span class="line">  )</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ˜¯å¦åŠ å…¥ MathFunctions åº“</span></span><br><span class="line"><span class="keyword">if</span> (USE_MYMATH)</span><br><span class="line">  <span class="keyword">include_directories</span> (<span class="string">&quot;$&#123;PROJECT_SOURCE_DIR&#125;/math&quot;</span>)</span><br><span class="line">  <span class="keyword">add_subdirectory</span> (<span class="keyword">math</span>)</span><br><span class="line">  <span class="keyword">set</span> (EXTRA_LIBS <span class="variable">$&#123;EXTRA_LIBS&#125;</span> MathFunctions)		<span class="comment">#å°† MathFunctions æ·»åŠ åˆ° EXTRA_LIBS å˜é‡ä¸­ã€‚</span></span><br><span class="line"><span class="keyword">endif</span> (USE_MYMATH)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥æ‰¾å½“å‰ç›®å½•ä¸‹çš„æ‰€æœ‰æºæ–‡ä»¶</span></span><br><span class="line"><span class="comment"># å¹¶å°†åç§°ä¿å­˜åˆ° DIR_SRCS å˜é‡</span></span><br><span class="line"><span class="keyword">aux_source_directory</span>(. DIR_SRCS)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŒ‡å®šç”Ÿæˆç›®æ ‡</span></span><br><span class="line"><span class="keyword">add_executable</span> (Demo <span class="variable">$&#123;DIR_SRCS&#125;</span>)</span><br><span class="line"><span class="keyword">target_link_libraries</span> (Demo  <span class="variable">$&#123;EXTRA_LIBS&#125;</span>)</span><br></pre></td></tr></table></figure></div>

<p>å…¶ä¸­ï¼š</p>
<ol>
<li>ç¬¬7è¡Œçš„ <code>configure_file</code> å‘½ä»¤ç”¨äºåŠ å…¥ä¸€ä¸ªé…ç½®å¤´æ–‡ä»¶ <strong>config.h ï¼Œè¿™ä¸ªæ–‡ä»¶ç”± CMake ä» <a class="link"   target="_blank" rel="noopener" href="http://config.h.in/" >config.h.in <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ç”Ÿ</strong>æˆï¼Œé€šè¿‡è¿™æ ·çš„æœºåˆ¶ï¼Œå°†å¯ä»¥é€šè¿‡é¢„å®šä¹‰ä¸€äº›å‚æ•°å’Œå˜é‡æ¥æ§åˆ¶ä»£ç çš„ç”Ÿæˆã€‚</li>
<li>ç¬¬13è¡Œçš„ <code>option</code> å‘½ä»¤æ·»åŠ äº†ä¸€ä¸ª <code>USE_MYMATH</code> é€‰é¡¹ï¼Œå¹¶ä¸”é»˜è®¤å€¼ä¸º <code>ON</code> ã€‚</li>
<li>ç¬¬17è¡Œæ ¹æ® <code>USE_MYMATH</code> å˜é‡çš„å€¼æ¥å†³å®šæ˜¯å¦ä½¿ç”¨æˆ‘ä»¬è‡ªå·±ç¼–å†™çš„ MathFunctions åº“ã€‚</li>
</ol>
<blockquote>
<p>ä¿®æ”¹ <a class="link"   target="_blank" rel="noopener" href="http://main.cc/" >main.cc <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> æ–‡ä»¶</p>
</blockquote>
<p>ä¹‹åä¿®æ”¹ <a class="link"   target="_blank" rel="noopener" href="http://main.cc/" >main.cc <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> æ–‡ä»¶ï¼Œè®©å…¶æ ¹æ® <code>USE_MYMATH</code> çš„é¢„å®šä¹‰å€¼æ¥å†³å®šæ˜¯å¦è°ƒç”¨æ ‡å‡†åº“è¿˜æ˜¯ MathFunctions åº“ï¼š</p>
<div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;config.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> USE_MYMATH</span></span><br><span class="line">  <span class="meta">#<span class="keyword">include</span> <span class="string">&quot;math/MathFunctions.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line">  <span class="meta">#<span class="keyword">include</span> <span class="string">&lt;math.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (argc &lt; <span class="number">3</span>)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Usage: %s base exponent \n&quot;</span>, argv[<span class="number">0</span>]);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">double</span> base = <span class="built_in">atof</span>(argv[<span class="number">1</span>]);</span><br><span class="line">    <span class="type">int</span> exponent = <span class="built_in">atoi</span>(argv[<span class="number">2</span>]);</span><br><span class="line">    </span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> USE_MYMATH</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Now we use our own Math library. \n&quot;</span>);</span><br><span class="line">    <span class="type">double</span> result = <span class="built_in">power</span>(base, exponent);</span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Now we use the standard library. \n&quot;</span>);</span><br><span class="line">    <span class="type">double</span> result = <span class="built_in">pow</span>(base, exponent);</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%g ^ %d is %g\n&quot;</span>, base, exponent, result);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<blockquote>
<p>ç¼–å†™ <a class="link"   target="_blank" rel="noopener" href="http://config.h.in/" >config.h.in <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> æ–‡ä»¶</p>
</blockquote>
<p>ä¸Šé¢çš„ç¨‹åºå€¼å¾—æ³¨æ„çš„æ˜¯ç¬¬3è¡Œï¼Œè¿™é‡Œå¼•ç”¨äº†ä¸€ä¸ª config.h æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶é¢„å®šä¹‰äº† <code>USE_MYMATH</code> çš„å€¼ã€‚ä½†æˆ‘ä»¬å¹¶ä¸ç›´æ¥ç¼–å†™è¿™ä¸ªæ–‡ä»¶ï¼Œä¸ºäº†æ–¹ä¾¿ä» CMakeLists.txt ä¸­å¯¼å…¥é…ç½®ï¼Œæˆ‘ä»¬ç¼–å†™ä¸€ä¸ª <a class="link"   target="_blank" rel="noopener" href="http://config.h.in/" >config.h.in <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#cmakedefine USE_MYMATH</span><br></pre></td></tr></table></figure></div>

<p>è¿™æ · CMake ä¼šè‡ªåŠ¨æ ¹æ® CMakeLists é…ç½®æ–‡ä»¶ä¸­çš„è®¾ç½®è‡ªåŠ¨ç”Ÿæˆ config.h æ–‡ä»¶ã€‚</p>
<h6 id="ç¼–è¯‘é¡¹ç›®"><a href="#ç¼–è¯‘é¡¹ç›®" class="headerlink" title="ç¼–è¯‘é¡¹ç›®"></a>ç¼–è¯‘é¡¹ç›®</h6><p>ç°åœ¨ç¼–è¯‘ä¸€ä¸‹è¿™ä¸ªé¡¹ç›®ï¼Œä¸ºäº†ä¾¿äºäº¤äº’å¼çš„é€‰æ‹©è¯¥å˜é‡çš„å€¼ï¼Œå¯ä»¥ä½¿ç”¨ <code>ccmake</code> å‘½ä»¤ï¼ˆä¹Ÿå¯ä»¥ä½¿ç”¨ <code>cmake -i</code> å‘½ä»¤ï¼Œè¯¥å‘½ä»¤ä¼šæä¾›ä¸€ä¸ªä¼šè¯å¼çš„äº¤äº’å¼é…ç½®ç•Œé¢ï¼‰ï¼š</p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230518135248836.png"
                      class="" title="image-20230518135248836"
                >



<p>ä»ä¸­å¯ä»¥æ‰¾åˆ°åˆšåˆšå®šä¹‰çš„ <code>USE_MYMATH</code> é€‰é¡¹ï¼ŒæŒ‰é”®ç›˜çš„æ–¹å‘é”®å¯ä»¥åœ¨ä¸åŒçš„é€‰é¡¹çª—å£é—´è·³è½¬ï¼ŒæŒ‰ä¸‹ <code>enter</code> é”®å¯ä»¥ä¿®æ”¹è¯¥é€‰é¡¹ã€‚ä¿®æ”¹å®Œæˆåå¯ä»¥æŒ‰ä¸‹ <code>c</code> é€‰é¡¹å®Œæˆé…ç½®ï¼Œä¹‹åå†æŒ‰ <code>g</code> é”®ç¡®è®¤ç”Ÿæˆ Makefile ã€‚ccmake çš„å…¶ä»–æ“ä½œå¯ä»¥å‚è€ƒçª—å£ä¸‹æ–¹ç»™å‡ºçš„æŒ‡ä»¤æç¤ºã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥è¯•è¯•åˆ†åˆ«å°† <code>USE_MYMATH</code> è®¾ä¸º <code>ON</code> å’Œ <code>OFF</code> å¾—åˆ°çš„ç»“æœï¼š</p>
<blockquote>
<p>USE_MYMATH ä¸º ON</p>
</blockquote>
<p>è¿è¡Œç»“æœï¼š</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[ehome@xman Demo4]$ ./Demo</span><br><span class="line">Now we use our own MathFunctions library. </span><br><span class="line"> 7 ^ 3 = 343.000000</span><br><span class="line"> 10 ^ 5 = 100000.000000</span><br><span class="line"> 2 ^ 10 = 1024.000000</span><br></pre></td></tr></table></figure></div>

<p>æ­¤æ—¶ config.h çš„å†…å®¹ä¸ºï¼š</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#define USE_MYMATH</span><br></pre></td></tr></table></figure></div>

<blockquote>
<p>USE_MYMATH ä¸º OFF</p>
</blockquote>
<p>è¿è¡Œç»“æœï¼š</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[ehome@xman Demo4]$ ./Demo</span><br><span class="line">Now we use the standard library. </span><br><span class="line"> 7 ^ 3 = 343.000000</span><br><span class="line"> 10 ^ 5 = 100000.000000</span><br><span class="line"> 2 ^ 10 = 1024.000000</span><br></pre></td></tr></table></figure></div>

<p>æ­¤æ—¶ config.h çš„å†…å®¹ä¸ºï¼š</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/* #undef USE_MYMATH */</span><br></pre></td></tr></table></figure></div>

<h6 id="å®‰è£…å’Œæµ‹è¯•"><a href="#å®‰è£…å’Œæµ‹è¯•" class="headerlink" title="å®‰è£…å’Œæµ‹è¯•"></a>å®‰è£…å’Œæµ‹è¯•</h6><p><strong>CMake ä¹Ÿå¯ä»¥æŒ‡å®šå®‰è£…è§„åˆ™ï¼Œä»¥åŠæ·»åŠ æµ‹è¯•</strong>ã€‚è¿™ä¸¤ä¸ªåŠŸèƒ½åˆ†åˆ«å¯ä»¥é€šè¿‡åœ¨äº§ç”Ÿ Makefile åä½¿ç”¨ <code>make install</code> å’Œ <code>make test</code> æ¥æ‰§è¡Œã€‚åœ¨ä»¥å‰çš„ GNU Makefile é‡Œï¼Œä½ å¯èƒ½éœ€è¦ä¸ºæ­¤ç¼–å†™ <code>install</code> å’Œ <code>test</code> ä¸¤ä¸ªä¼ªç›®æ ‡å’Œç›¸åº”çš„è§„åˆ™ï¼Œä½†åœ¨ CMake é‡Œï¼Œè¿™æ ·çš„å·¥ä½œåŒæ ·åªéœ€è¦ç®€å•çš„è°ƒç”¨å‡ æ¡å‘½ä»¤ã€‚</p>
<blockquote>
<p><strong>å®‰è£…è§„åˆ™å‘Šè¯‰CMakeåº”è¯¥å°†å“ªäº›æ–‡ä»¶å¤åˆ¶åˆ°å®‰è£…ç›®å½•ï¼Œå¹¶ä¸”å¯ä»¥æŒ‡å®šæ–‡ä»¶çš„æƒé™ã€å®‰è£…è·¯å¾„å’Œå…¶ä»–å±æ€§ã€‚</strong></p>
<p>å®‰è£…è§„åˆ™é€šå¸¸ç”¨äºå°†ç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶ã€åº“æ–‡ä»¶ã€å¤´æ–‡ä»¶ã€é…ç½®æ–‡ä»¶å’Œå…¶ä»–å¿…è¦çš„èµ„æºå®‰è£…åˆ°ç³»ç»Ÿä¸­çš„é€‚å½“ä½ç½®ï¼Œä»¥ä¾›å…¶ä»–ç¨‹åºæˆ–ç”¨æˆ·ä½¿ç”¨ã€‚é€šè¿‡æŒ‡å®šå®‰è£…è§„åˆ™ï¼Œå¼€å‘äººå‘˜å¯ä»¥åœ¨æ„å»ºè¿‡ç¨‹ä¸­è‡ªå®šä¹‰å®‰è£…çš„æ–‡ä»¶å’Œç›®å½•ç»“æ„ï¼Œä»¥æ»¡è¶³ç‰¹å®šé¡¹ç›®æˆ–ç³»ç»Ÿçš„éœ€æ±‚ã€‚</p>
</blockquote>
<blockquote>
<p>å®šåˆ¶å®‰è£…è§„åˆ™</p>
</blockquote>
<p>é¦–å…ˆå…ˆåœ¨ math&#x2F;CMakeLists.txt æ–‡ä»¶é‡Œæ·»åŠ ä¸‹é¢ä¸¤è¡Œï¼š</p>
<div class="highlight-container" data-rel="Cmake"><figure class="iseeu highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŒ‡å®š MathFunctions åº“çš„å®‰è£…è·¯å¾„</span></span><br><span class="line"><span class="keyword">install</span> (TARGETS MathFunctions DESTINATION bin)</span><br><span class="line"><span class="keyword">install</span> (FILES MathFunctions.h DESTINATION <span class="keyword">include</span>)</span><br></pre></td></tr></table></figure></div>

<p>æŒ‡æ˜ MathFunctions åº“çš„å®‰è£…è·¯å¾„ã€‚ä¹‹ååŒæ ·ä¿®æ”¹æ ¹ç›®å½•çš„ CMakeLists æ–‡ä»¶ï¼Œåœ¨æœ«å°¾æ·»åŠ ä¸‹é¢å‡ è¡Œï¼š</p>
<div class="highlight-container" data-rel="Cmake"><figure class="iseeu highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŒ‡å®šå®‰è£…è·¯å¾„</span></span><br><span class="line"><span class="keyword">install</span> (TARGETS Demo DESTINATION bin)</span><br><span class="line"><span class="keyword">install</span> (FILES <span class="string">&quot;$&#123;PROJECT_BINARY_DIR&#125;/config.h&quot;</span></span><br><span class="line">         DESTINATION <span class="keyword">include</span>)</span><br></pre></td></tr></table></figure></div>

<p>é€šè¿‡ä¸Šé¢çš„å®šåˆ¶ï¼Œç”Ÿæˆçš„ Demo æ–‡ä»¶å’Œ MathFunctions å‡½æ•°åº“ libMathFunctions.o æ–‡ä»¶å°†ä¼šè¢«å¤åˆ¶åˆ° <code>/usr/local/bin</code> ä¸­ï¼Œè€Œ MathFunctions.h å’Œç”Ÿæˆçš„ config.h æ–‡ä»¶åˆ™ä¼šè¢«å¤åˆ¶åˆ° <code>/usr/local/include</code> ä¸­ã€‚æˆ‘ä»¬å¯ä»¥éªŒè¯ä¸€ä¸‹ï¼ˆé¡ºå¸¦ä¸€æçš„æ˜¯ï¼Œè¿™é‡Œçš„ <code>/usr/local/</code> æ˜¯é»˜è®¤å®‰è£…åˆ°çš„æ ¹ç›®å½•ï¼Œå¯ä»¥é€šè¿‡ä¿®æ”¹ <code>CMAKE_INSTALL_PREFIX</code> å˜é‡çš„å€¼æ¥æŒ‡å®šè¿™äº›æ–‡ä»¶åº”è¯¥æ‹·è´åˆ°å“ªä¸ªæ ¹ç›®å½•ï¼‰ï¼š</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[ehome@xman Demo5]$ sudo make install</span><br><span class="line">[ 50%] Built target MathFunctions</span><br><span class="line">[100%] Built target Demo</span><br><span class="line">Install the project...</span><br><span class="line">-- Install configuration: &quot;&quot;</span><br><span class="line">-- Installing: /usr/local/bin/Demo</span><br><span class="line">-- Installing: /usr/local/include/config.h</span><br><span class="line">-- Installing: /usr/local/bin/libMathFunctions.a</span><br><span class="line">-- Up-to-date: /usr/local/include/MathFunctions.h</span><br><span class="line">[ehome@xman Demo5]$ ls /usr/local/bin</span><br><span class="line">Demo  libMathFunctions.a</span><br><span class="line">[ehome@xman Demo5]$ ls /usr/local/include</span><br><span class="line">config.h  MathFunctions.h</span><br></pre></td></tr></table></figure></div>

<blockquote>
<p>åœ¨CMakeä¸­ï¼Œ<code>$&#123;PROJECT_BINARY_DIR&#125;</code>æ˜¯ä¸€ä¸ªå˜é‡ï¼Œç”¨äºè¡¨ç¤ºé¡¹ç›®æ„å»ºè¿‡ç¨‹ä¸­ç”Ÿæˆçš„ç›®æ ‡æ–‡ä»¶çš„è¾“å‡ºç›®å½•ï¼ˆå³æ„å»ºç›®å½•ï¼‰çš„è·¯å¾„ã€‚</p>
</blockquote>
<blockquote>
<p>ä¸ºå·¥ç¨‹æ·»åŠ æµ‹è¯•</p>
</blockquote>
<p>æ·»åŠ æµ‹è¯•åŒæ ·å¾ˆç®€å•ã€‚CMake æä¾›äº†ä¸€ä¸ªç§°ä¸º CTest çš„æµ‹è¯•å·¥å…·ã€‚æˆ‘ä»¬è¦åšçš„åªæ˜¯åœ¨é¡¹ç›®æ ¹ç›®å½•çš„ CMakeLists æ–‡ä»¶ä¸­è°ƒç”¨ä¸€ç³»åˆ—çš„ <code>add_test</code> å‘½ä»¤ã€‚</p>
<div class="highlight-container" data-rel="Cmake"><figure class="iseeu highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¯ç”¨æµ‹è¯•</span></span><br><span class="line"><span class="keyword">enable_testing</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment"># æµ‹è¯•ç¨‹åºæ˜¯å¦æˆåŠŸè¿è¡Œ</span></span><br><span class="line"><span class="keyword">add_test</span> (test_run Demo <span class="number">5</span> <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æµ‹è¯•å¸®åŠ©ä¿¡æ¯æ˜¯å¦å¯ä»¥æ­£å¸¸æç¤º</span></span><br><span class="line"><span class="keyword">add_test</span> (test_usage Demo)</span><br><span class="line"><span class="keyword">set_tests_properties</span> (test_usage		<span class="comment">#ç”¨äºè®¾ç½®æµ‹è¯•ç”¨ä¾‹çš„å±æ€§ã€‚å®ƒå…è®¸æ‚¨ä¿®æ”¹ä¸æµ‹è¯•ç›¸å…³çš„å±æ€§ï¼Œä¾‹å¦‚æµ‹è¯•ç”¨ä¾‹çš„åç§°ã€è¶…æ—¶æ—¶é—´ã€å·¥ä½œç›®å½•ã€ä¾èµ–å…³ç³»ç­‰ã€‚</span></span><br><span class="line">  PROPERTIES PASS_REGULAR_EXPRESSION <span class="string">&quot;Usage: .* base exponent&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æµ‹è¯• 5 çš„å¹³æ–¹</span></span><br><span class="line"><span class="keyword">add_test</span> (test_5_2 Demo <span class="number">5</span> <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">set_tests_properties</span> (test_5_2</span><br><span class="line"> PROPERTIES PASS_REGULAR_EXPRESSION <span class="string">&quot;is 25&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æµ‹è¯• 10 çš„ 5 æ¬¡æ–¹</span></span><br><span class="line"><span class="keyword">add_test</span> (test_10_5 Demo <span class="number">10</span> <span class="number">5</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">set_tests_properties</span> (test_10_5</span><br><span class="line"> PROPERTIES PASS_REGULAR_EXPRESSION <span class="string">&quot;is 100000&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æµ‹è¯• 2 çš„ 10 æ¬¡æ–¹</span></span><br><span class="line"><span class="keyword">add_test</span> (test_2_10 Demo <span class="number">2</span> <span class="number">10</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">set_tests_properties</span> (test_2_10</span><br><span class="line"> PROPERTIES PASS_REGULAR_EXPRESSION <span class="string">&quot;is 1024&quot;</span>)</span><br></pre></td></tr></table></figure></div>

<p>ä¸Šé¢çš„ä»£ç åŒ…å«äº†å››ä¸ªæµ‹è¯•ã€‚ç¬¬ä¸€ä¸ªæµ‹è¯• <code>test_run</code> ç”¨æ¥æµ‹è¯•ç¨‹åºæ˜¯å¦æˆåŠŸè¿è¡Œå¹¶è¿”å› 0 å€¼ã€‚å‰©ä¸‹çš„ä¸‰ä¸ªæµ‹è¯•åˆ†åˆ«ç”¨æ¥æµ‹è¯• 5 çš„ å¹³æ–¹ã€10 çš„ 5 æ¬¡æ–¹ã€2 çš„ 10 æ¬¡æ–¹æ˜¯å¦éƒ½èƒ½å¾—åˆ°æ­£ç¡®çš„ç»“æœã€‚<strong>å…¶ä¸­ <code>PASS_REGULAR_EXPRESSION</code> ç”¨æ¥æµ‹è¯•è¾“å‡ºæ˜¯å¦åŒ…å«åé¢è·Ÿç€çš„å­—ç¬¦ä¸²ã€‚</strong></p>
<blockquote>
<p>è®¾ç½®äº†åä¸º<code>test_usage</code>çš„æµ‹è¯•ç”¨ä¾‹çš„å±æ€§ã€‚å±æ€§<code>PASS_REGULAR_EXPRESSION</code>æŒ‡å®šäº†ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼Œç”¨äºåŒ¹é…æµ‹è¯•çš„è¾“å‡ºç»“æœã€‚è¿™é‡Œï¼Œå®ƒç”¨äºæ£€æŸ¥æµ‹è¯•æ˜¯å¦æŒ‰é¢„æœŸæ˜¾ç¤ºäº†å¸®åŠ©ä¿¡æ¯çš„æç¤ºã€‚</p>
<p>åŒæ ·åœ°ï¼Œå…¶ä»–æµ‹è¯•ç”¨ä¾‹ä¹Ÿä½¿ç”¨<code>set_tests_properties</code>æ¥è®¾ç½®æœŸæœ›çš„è¾“å‡ºç»“æœï¼Œä»¥ç¡®ä¿æµ‹è¯•çš„æ­£ç¡®æ€§ã€‚è¿™æ ·ï¼Œåœ¨æ‰§è¡Œ<code>ctest</code>å‘½ä»¤è¿è¡Œæµ‹è¯•æ—¶ï¼ŒCTestå°†æ ¹æ®è®¾ç½®çš„å±æ€§æ¥åˆ¤æ–­æµ‹è¯•æ˜¯å¦é€šè¿‡ã€‚</p>
</blockquote>
<p>è®©æˆ‘ä»¬çœ‹çœ‹æµ‹è¯•çš„ç»“æœï¼š</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[ehome@xman Demo5]$ make test</span><br><span class="line">Running tests...</span><br><span class="line">Test project /home/ehome/Documents/programming/C/power/Demo5</span><br><span class="line">    Start 1: test_run</span><br><span class="line">1/4 Test #1: test_run .........................   Passed    0.00 sec</span><br><span class="line">    Start 2: test_5_2</span><br><span class="line">2/4 Test #2: test_5_2 .........................   Passed    0.00 sec</span><br><span class="line">    Start 3: test_10_5</span><br><span class="line">3/4 Test #3: test_10_5 ........................   Passed    0.00 sec</span><br><span class="line">    Start 4: test_2_10</span><br><span class="line">4/4 Test #4: test_2_10 ........................   Passed    0.00 sec</span><br><span class="line"></span><br><span class="line">100% tests passed, 0 tests failed out of 4</span><br><span class="line"></span><br><span class="line">Total Test time (real) =   0.01 sec</span><br></pre></td></tr></table></figure></div>

<p>å¦‚æœè¦æµ‹è¯•æ›´å¤šçš„è¾“å…¥æ•°æ®ï¼Œåƒä¸Šé¢é‚£æ ·ä¸€ä¸ªä¸ªå†™æµ‹è¯•ç”¨ä¾‹æœªå…å¤ªç¹çã€‚è¿™æ—¶å¯ä»¥é€šè¿‡ç¼–å†™å®æ¥å®ç°ï¼š</p>
<div class="highlight-container" data-rel="Cmake"><figure class="iseeu highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®šä¹‰ä¸€ä¸ªå®ï¼Œç”¨æ¥ç®€åŒ–æµ‹è¯•å·¥ä½œ</span></span><br><span class="line"><span class="keyword">macro</span> (do_test arg1 arg2 result)	<span class="comment">#åˆ›å»ºä¸€ä¸ªdo_testçš„å®</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">add_test</span> (test_<span class="variable">$&#123;arg1&#125;</span>_<span class="variable">$&#123;arg2&#125;</span> Demo <span class="variable">$&#123;arg1&#125;</span> <span class="variable">$&#123;arg2&#125;</span>)	<span class="comment">#add_teståˆ›å»ºä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼Œtest_$&#123;arg1&#125;_$&#123;arg2&#125;æ˜¯åç§°ï¼ŒDemo $&#123;arg1&#125; $&#123;arg2&#125;æ˜¯å¯æ‰§è¡Œæ–‡ä»¶åŠå‚æ•°</span></span><br><span class="line">  </span><br><span class="line">  <span class="keyword">set_tests_properties</span> (test_<span class="variable">$&#123;arg1&#125;</span>_<span class="variable">$&#123;arg2&#125;</span></span><br><span class="line">    PROPERTIES PASS_REGULAR_EXPRESSION <span class="variable">$&#123;result&#125;</span>)	<span class="comment">#è®¾ç½®æµ‹è¯•ç”¨ä¾‹çš„å±æ€§ï¼ŒæŒ‡æ˜é¢„æœŸè¾“å‡ºç»“æœ</span></span><br><span class="line"><span class="keyword">endmacro</span> (do_test)</span><br><span class="line"> </span><br><span class="line"><span class="comment"># ä½¿ç”¨è¯¥å®è¿›è¡Œä¸€ç³»åˆ—çš„æ•°æ®æµ‹è¯•</span></span><br><span class="line">do_test (<span class="number">5</span> <span class="number">2</span> <span class="string">&quot;is 25&quot;</span>)</span><br><span class="line">do_test (<span class="number">10</span> <span class="number">5</span> <span class="string">&quot;is 100000&quot;</span>)</span><br><span class="line">do_test (<span class="number">2</span> <span class="number">10</span> <span class="string">&quot;is 1024&quot;</span>)</span><br></pre></td></tr></table></figure></div>

<p>å…³äº CTest çš„æ›´è¯¦ç»†çš„ç”¨æ³•å¯ä»¥é€šè¿‡ <code>man 1 ctest</code> å‚è€ƒ CTest çš„æ–‡æ¡£ã€‚</p>
<blockquote>
<p>æ”¯æŒgdb</p>
</blockquote>
<p>è®© CMake æ”¯æŒ gdb çš„è®¾ç½®ä¹Ÿå¾ˆå®¹æ˜“ï¼Œåœ¨<code>CMakeLists.txt</code>æ–‡ä»¶åªéœ€è¦æŒ‡å®š <code>Debug</code> æ¨¡å¼ä¸‹å¼€å¯ <code>-g</code> é€‰é¡¹ï¼š</p>
<div class="highlight-container" data-rel="Cmake"><figure class="iseeu highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span>(CMAKE_BUILD_TYPE <span class="string">&quot;Debug&quot;</span>)</span><br><span class="line"><span class="keyword">set</span>(CMAKE_CXX_FLAGS_DEBUG <span class="string">&quot;$ENV&#123;CXXFLAGS&#125; -O0 -Wall -g -ggdb&quot;</span>)</span><br><span class="line"><span class="keyword">set</span>(CMAKE_CXX_FLAGS_RELEASE <span class="string">&quot;$ENV&#123;CXXFLAGS&#125; -O3 -Wall&quot;</span>)</span><br></pre></td></tr></table></figure></div>

<p>ä¹‹åå¯ä»¥ç›´æ¥å¯¹ç”Ÿæˆçš„ç¨‹åºä½¿ç”¨ gdb æ¥è°ƒè¯•ã€‚<code>gdb Demo</code></p>
<h6 id="æ·»åŠ ç¯å¢ƒæ£€æŸ¥"><a href="#æ·»åŠ ç¯å¢ƒæ£€æŸ¥" class="headerlink" title="æ·»åŠ ç¯å¢ƒæ£€æŸ¥"></a>æ·»åŠ ç¯å¢ƒæ£€æŸ¥</h6><p>æœ‰æ—¶å€™å¯èƒ½è¦å¯¹ç³»ç»Ÿç¯å¢ƒåšç‚¹æ£€æŸ¥ï¼Œä¾‹å¦‚è¦ä½¿ç”¨ä¸€ä¸ªå¹³å°ç›¸å…³çš„ç‰¹æ€§çš„æ—¶å€™ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬æ£€æŸ¥ç³»ç»Ÿæ˜¯å¦è‡ªå¸¦ pow å‡½æ•°ã€‚å¦‚æœå¸¦æœ‰ pow å‡½æ•°ï¼Œå°±ä½¿ç”¨å®ƒï¼›å¦åˆ™ä½¿ç”¨æˆ‘ä»¬å®šä¹‰çš„ power å‡½æ•°ã€‚</p>
<blockquote>
<p>æ·»åŠ  CheckFunctionExists å®</p>
</blockquote>
<p>é¦–å…ˆåœ¨é¡¶å±‚ CMakeLists æ–‡ä»¶ä¸­æ·»åŠ  CheckFunctionExists.cmake å®ï¼Œå¹¶è°ƒç”¨ <code>check_function_exists</code> å‘½ä»¤æµ‹è¯•é“¾æ¥å™¨æ˜¯å¦èƒ½å¤Ÿåœ¨é“¾æ¥é˜¶æ®µæ‰¾åˆ° <code>pow</code> å‡½æ•°ã€‚</p>
<div class="highlight-container" data-rel="Cmake"><figure class="iseeu highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ£€æŸ¥ç³»ç»Ÿæ˜¯å¦æ”¯æŒ pow å‡½æ•°</span></span><br><span class="line"><span class="keyword">include</span> (<span class="variable">$&#123;CMAKE_ROOT&#125;</span>/Modules/CheckFunctionExists.cmake)		<span class="comment">#å°†CheckFunctionExists.cmakeåŒ…å«æ£€æŸ¥æŒ‡å®šçš„å‡½æ•°æ˜¯å¦å­˜åœ¨ã€‚</span></span><br><span class="line">check_function_exists (pow HAVE_POW)	<span class="comment">#ç”¨äºæ£€æŸ¥å‡½æ•°powæ˜¯å¦å­˜åœ¨ã€‚è¯¥å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è¦æ£€æŸ¥çš„å‡½æ•°åï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå˜é‡åï¼Œç”¨äºå­˜å‚¨æ£€æŸ¥ç»“æœã€‚</span></span><br></pre></td></tr></table></figure></div>

<p><strong>å°†ä¸Šé¢è¿™æ®µä»£ç æ”¾åœ¨ <code>configure_file</code> å‘½ä»¤å‰ã€‚</strong></p>
<blockquote>
<p>é¢„å®šä¹‰ç›¸å…³å®å˜é‡</p>
</blockquote>
<p>æ¥ä¸‹æ¥ä¿®æ”¹ <a class="link"   target="_blank" rel="noopener" href="http://config.h.in/" >config.h.in <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> æ–‡ä»¶ï¼Œé¢„å®šä¹‰ç›¸å…³çš„å®å˜é‡ã€‚</p>
<div class="highlight-container" data-rel="Cmake"><figure class="iseeu highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// does the platform provide pow <span class="keyword">function</span>?</span><br><span class="line"><span class="comment">#cmakedefine HAVE_POW</span></span><br></pre></td></tr></table></figure></div>

<blockquote>
<p>åœ¨ä»£ç ä¸­ä½¿ç”¨å®å’Œå‡½æ•°</p>
</blockquote>
<p>æœ€åä¸€æ­¥æ˜¯ä¿®æ”¹ <a class="link"   target="_blank" rel="noopener" href="http://main.cc/" >main.cc <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ï¼Œåœ¨ä»£ç ä¸­ä½¿ç”¨å®å’Œå‡½æ•°ï¼š</p>
<div class="highlight-container" data-rel="Cmake"><figure class="iseeu highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ifdef HAVE_POW</span></span><br><span class="line">    printf(<span class="string">&quot;Now we use the standard library. \n&quot;</span>);</span><br><span class="line">    double result = pow(base, exponent);</span><br><span class="line"><span class="comment">#else</span></span><br><span class="line">    printf(<span class="string">&quot;Now we use our own Math library. \n&quot;</span>);</span><br><span class="line">    double result = power(base, exponent);</span><br><span class="line"><span class="comment">#endif</span></span><br></pre></td></tr></table></figure></div>

<h6 id="æ·»åŠ ç‰ˆæœ¬å·"><a href="#æ·»åŠ ç‰ˆæœ¬å·" class="headerlink" title="æ·»åŠ ç‰ˆæœ¬å·"></a>æ·»åŠ ç‰ˆæœ¬å·</h6><p>ç»™é¡¹ç›®æ·»åŠ å’Œç»´æŠ¤ç‰ˆæœ¬å·æ˜¯ä¸€ä¸ªå¥½ä¹ æƒ¯ï¼Œè¿™æ ·æœ‰åˆ©äºç”¨æˆ·äº†è§£æ¯ä¸ªç‰ˆæœ¬çš„ç»´æŠ¤æƒ…å†µï¼Œå¹¶åŠæ—¶äº†è§£å½“å‰æ‰€ç”¨çš„ç‰ˆæœ¬æ˜¯å¦è¿‡æ—¶ï¼Œæˆ–æ˜¯å¦å¯èƒ½å‡ºç°ä¸å…¼å®¹çš„æƒ…å†µã€‚</p>
<p><strong>é¦–å…ˆä¿®æ”¹é¡¶å±‚ CMakeLists æ–‡ä»¶ï¼Œåœ¨ <code>project</code> å‘½ä»¤ä¹‹ååŠ å…¥å¦‚ä¸‹ä¸¤è¡Œï¼š</strong></p>
<div class="highlight-container" data-rel="Cmake"><figure class="iseeu highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> (Demo_VERSION_MAJOR <span class="number">1</span>)</span><br><span class="line"><span class="keyword">set</span> (Demo_VERSION_MINOR <span class="number">0</span>)</span><br></pre></td></tr></table></figure></div>

<p>åˆ†åˆ«æŒ‡å®šå½“å‰çš„é¡¹ç›®çš„ä¸»ç‰ˆæœ¬å·å’Œå‰¯ç‰ˆæœ¬å·ã€‚</p>
<p>ä¹‹åï¼Œä¸ºäº†åœ¨ä»£ç ä¸­è·å–ç‰ˆæœ¬ä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥ä¿®æ”¹ <a class="link"   target="_blank" rel="noopener" href="http://config.h.in/" >config.h.in <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> æ–‡ä»¶ï¼Œæ·»åŠ ä¸¤ä¸ªé¢„å®šä¹‰å˜é‡ï¼š</p>
<div class="highlight-container" data-rel="Cmake"><figure class="iseeu highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// the configured options <span class="keyword">and</span> settings for Tutorial</span><br><span class="line"><span class="comment">#define Demo_VERSION_MAJOR @Demo_VERSION_MAJOR@</span></span><br><span class="line"><span class="comment">#define Demo_VERSION_MINOR @Demo_VERSION_MINOR@</span></span><br></pre></td></tr></table></figure></div>

<p>è¿™æ ·å°±å¯ä»¥ç›´æ¥åœ¨ä»£ç ä¸­æ‰“å°ç‰ˆæœ¬ä¿¡æ¯äº†ï¼š</p>
<div class="highlight-container" data-rel="Cmake"><figure class="iseeu highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#include &lt;stdio.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;stdlib.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;math.h&gt;</span></span><br><span class="line"><span class="comment">#include &quot;config.h&quot;</span></span><br><span class="line"><span class="comment">#include &quot;math/MathFunctions.h&quot;</span></span><br><span class="line"></span><br><span class="line">int main(int argc, char *argv[])</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (argc &lt; <span class="number">3</span>)&#123;</span><br><span class="line">        // print version info</span><br><span class="line">        printf(<span class="string">&quot;%s Version %d.%d\n&quot;</span>,</span><br><span class="line">            argv[<span class="number">0</span>],</span><br><span class="line">            Demo_VERSION_MAJOR,</span><br><span class="line">            Demo_VERSION_MINOR);</span><br><span class="line">        printf(<span class="string">&quot;Usage: %s base exponent \n&quot;</span>, argv[<span class="number">0</span>]);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    double base = atof(argv[<span class="number">1</span>]);</span><br><span class="line">    int exponent = atoi(argv[<span class="number">2</span>]);</span><br><span class="line">    </span><br><span class="line"><span class="comment">#if defined (HAVE_POW)</span></span><br><span class="line">    printf(<span class="string">&quot;Now we use the standard library. \n&quot;</span>);</span><br><span class="line">    double result = pow(base, exponent);</span><br><span class="line"><span class="comment">#else</span></span><br><span class="line">    printf(<span class="string">&quot;Now we use our own Math library. \n&quot;</span>);</span><br><span class="line">    double result = power(base, exponent);</span><br><span class="line"><span class="comment">#endif</span></span><br><span class="line">    </span><br><span class="line">    printf(<span class="string">&quot;%g ^ %d is %g\n&quot;</span>, base, exponent, result);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h6 id="ç”Ÿæˆå®‰è£…åŒ…"><a href="#ç”Ÿæˆå®‰è£…åŒ…" class="headerlink" title="ç”Ÿæˆå®‰è£…åŒ…"></a>ç”Ÿæˆå®‰è£…åŒ…</h6><p>æœ¬èŠ‚å°†å­¦ä¹ å¦‚ä½•é…ç½®ç”Ÿæˆå„ç§å¹³å°ä¸Šçš„å®‰è£…åŒ…ï¼ŒåŒ…æ‹¬äºŒè¿›åˆ¶å®‰è£…åŒ…å’Œæºç å®‰è£…åŒ…ã€‚ä¸ºäº†å®Œæˆè¿™ä¸ªä»»åŠ¡ï¼Œæˆ‘ä»¬éœ€è¦ç”¨åˆ° CPack ï¼Œå®ƒåŒæ ·ä¹Ÿæ˜¯ç”± CMake æä¾›çš„ä¸€ä¸ªå·¥å…·ï¼Œä¸“é—¨ç”¨äºæ‰“åŒ…ã€‚</p>
<p>é¦–å…ˆåœ¨é¡¶å±‚çš„ CMakeLists.txt æ–‡ä»¶å°¾éƒ¨æ·»åŠ ä¸‹é¢å‡ è¡Œï¼š</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># æ„å»ºä¸€ä¸ª CPack å®‰è£…åŒ…</span><br><span class="line">include (InstallRequiredSystemLibraries)</span><br><span class="line">set (CPACK_RESOURCE_FILE_LICENSE</span><br><span class="line">  &quot;$&#123;CMAKE_CURRENT_SOURCE_DIR&#125;/License.txt&quot;)</span><br><span class="line">set (CPACK_PACKAGE_VERSION_MAJOR &quot;$&#123;Demo_VERSION_MAJOR&#125;&quot;)</span><br><span class="line">set (CPACK_PACKAGE_VERSION_MINOR &quot;$&#123;Demo_VERSION_MINOR&#125;&quot;)</span><br><span class="line">include (CPack)</span><br></pre></td></tr></table></figure></div>

<p>ä¸Šé¢çš„ä»£ç åšäº†ä»¥ä¸‹å‡ ä¸ªå·¥ä½œï¼š</p>
<ol>
<li>å¯¼å…¥ InstallRequiredSystemLibraries æ¨¡å—ï¼Œä»¥ä¾¿ä¹‹åå¯¼å…¥ CPack æ¨¡å—ï¼›</li>
<li>è®¾ç½®ä¸€äº› CPack ç›¸å…³å˜é‡ï¼ŒåŒ…æ‹¬ç‰ˆæƒä¿¡æ¯å’Œç‰ˆæœ¬ä¿¡æ¯ï¼Œå…¶ä¸­ç‰ˆæœ¬ä¿¡æ¯ç”¨äº†ä¸Šä¸€èŠ‚å®šä¹‰çš„ç‰ˆæœ¬å·ï¼›</li>
<li>å¯¼å…¥ CPack æ¨¡å—ã€‚</li>
</ol>
<p><strong>æ¥ä¸‹æ¥çš„å·¥ä½œæ˜¯åƒå¾€å¸¸ä¸€æ ·æ„å»ºå·¥ç¨‹ï¼Œå¹¶æ‰§è¡Œ <code>cpack</code> å‘½ä»¤ã€‚ï¼ˆæ³¨æ„ç¼–è¯‘å‰éœ€è¦å¯¼å…¥License.txtæ–‡ä»¶ï¼‰</strong></p>
<ul>
<li>ç”ŸæˆäºŒè¿›åˆ¶å®‰è£…åŒ…ï¼š</li>
</ul>
<div class="highlight-container" data-rel="Cmake"><figure class="iseeu highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cpack -C CPackConfig.cmake</span><br></pre></td></tr></table></figure></div>

<blockquote>
<p><code>cpack</code> æ˜¯ CMake ä¸­çš„ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨äºç”Ÿæˆè½¯ä»¶åŒ…ï¼ˆpackageï¼‰æ–‡ä»¶ï¼Œå¦‚å®‰è£…ç¨‹åºã€å‹ç¼©æ–‡ä»¶ç­‰ï¼Œä»¥ä¾¿è¿›è¡Œè½¯ä»¶çš„åˆ†å‘å’Œå®‰è£…ã€‚<code>-C</code> é€‰é¡¹ç”¨äºæŒ‡å®š CPack çš„é…ç½®æ–‡ä»¶ï¼Œ<strong>å…¶ä¸­ <code>CPackConfig.cmake</code> æ˜¯ä¸€ä¸ªç”¨æˆ·å®šä¹‰çš„ CPack é…ç½®æ–‡ä»¶çš„åç§°</strong></p>
</blockquote>
<ul>
<li>ç”Ÿæˆæºç å®‰è£…åŒ…</li>
</ul>
<div class="highlight-container" data-rel="Cmake"><figure class="iseeu highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cpack -C CPackSourceConfig.cmake</span><br></pre></td></tr></table></figure></div>

<p>æˆ‘ä»¬å¯ä»¥è¯•ä¸€ä¸‹ã€‚åœ¨ç”Ÿæˆé¡¹ç›®åï¼Œæ‰§è¡Œ <code>cpack -C CPackConfig.cmake</code> å‘½ä»¤ï¼š</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[ehome@xman Demo8]$ cpack -C CPackSourceConfig.cmake</span><br><span class="line">CPack: Create package using STGZ</span><br><span class="line">CPack: Install projects</span><br><span class="line">CPack: - Run preinstall target for: Demo8</span><br><span class="line">CPack: - Install project: Demo8</span><br><span class="line">CPack: Create package</span><br><span class="line">CPack: - package: /home/ehome/Documents/programming/C/power/Demo8/Demo8-1.0.1-Linux.sh generated.</span><br><span class="line">CPack: Create package using TGZ</span><br><span class="line">CPack: Install projects</span><br><span class="line">CPack: - Run preinstall target for: Demo8</span><br><span class="line">CPack: - Install project: Demo8</span><br><span class="line">CPack: Create package</span><br><span class="line">CPack: - package: /home/ehome/Documents/programming/C/power/Demo8/Demo8-1.0.1-Linux.tar.gz generated.</span><br><span class="line">CPack: Create package using TZ</span><br><span class="line">CPack: Install projects</span><br><span class="line">CPack: - Run preinstall target for: Demo8</span><br><span class="line">CPack: - Install project: Demo8</span><br><span class="line">CPack: Create package</span><br><span class="line">CPack: - package: /home/ehome/Documents/programming/C/power/Demo8/Demo8-1.0.1-Linux.tar.Z generated.</span><br></pre></td></tr></table></figure></div>

<p>æ­¤æ—¶ä¼šåœ¨è¯¥ç›®å½•ä¸‹åˆ›å»º 3 ä¸ªä¸åŒæ ¼å¼çš„äºŒè¿›åˆ¶åŒ…æ–‡ä»¶ï¼š</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[ehome@xman Demo8]$ ls Demo8-*</span><br><span class="line">Demo8-1.0.1-Linux.sh  Demo8-1.0.1-Linux.tar.gz  Demo8-1.0.1-Linux.tar.Z</span><br></pre></td></tr></table></figure></div>

<p>è¿™ 3 ä¸ªäºŒè¿›åˆ¶åŒ…æ–‡ä»¶æ‰€åŒ…å«çš„å†…å®¹æ˜¯å®Œå…¨ç›¸åŒçš„ã€‚æˆ‘ä»¬å¯ä»¥æ‰§è¡Œå…¶ä¸­ä¸€ä¸ªã€‚æ­¤æ—¶ä¼šå‡ºç°ä¸€ä¸ªç”± CPack è‡ªåŠ¨ç”Ÿæˆçš„äº¤äº’å¼å®‰è£…ç•Œé¢ï¼š</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">[ehome@xman Demo8]$ sh Demo8-1.0.1-Linux.sh </span><br><span class="line">Demo8 Installer Version: 1.0.1, Copyright (c) Humanity</span><br><span class="line">This is a self-extracting archive.</span><br><span class="line">The archive will be extracted to: /home/ehome/Documents/programming/C/power/Demo8</span><br><span class="line"></span><br><span class="line">If you want to stop extracting, please press &lt;ctrl-C&gt;.</span><br><span class="line">The MIT License (MIT)</span><br><span class="line"></span><br><span class="line">Copyright (c) 2013 Joseph Pan(http://hahack.com)</span><br><span class="line"></span><br><span class="line">Permission is hereby granted, free of charge, to any person obtaining a copy of</span><br><span class="line">this software and associated documentation files (the &quot;Software&quot;), to deal in</span><br><span class="line">the Software without restriction, including without limitation the rights to</span><br><span class="line">use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of</span><br><span class="line">the Software, and to permit persons to whom the Software is furnished to do so,</span><br><span class="line">subject to the following conditions:</span><br><span class="line"></span><br><span class="line">The above copyright notice and this permission notice shall be included in all</span><br><span class="line">copies or substantial portions of the Software.</span><br><span class="line"></span><br><span class="line">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span><br><span class="line">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS</span><br><span class="line">FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR</span><br><span class="line">COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER</span><br><span class="line">IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN</span><br><span class="line">CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Do you accept the license? [yN]: </span><br><span class="line">y</span><br><span class="line">By default the Demo8 will be installed in:</span><br><span class="line">  &quot;/home/ehome/Documents/programming/C/power/Demo8/Demo8-1.0.1-Linux&quot;</span><br><span class="line">Do you want to include the subdirectory Demo8-1.0.1-Linux?</span><br><span class="line">Saying no will install in: &quot;/home/ehome/Documents/programming/C/power/Demo8&quot; [Yn]: </span><br><span class="line">y</span><br><span class="line"></span><br><span class="line">Using target directory: /home/ehome/Documents/programming/C/power/Demo8/Demo8-1.0.1-Linux</span><br><span class="line">Extracting, please wait...</span><br><span class="line"></span><br><span class="line">Unpacking finished successfully</span><br></pre></td></tr></table></figure></div>

<p>å®Œæˆåæç¤ºå®‰è£…åˆ°äº† Demo8-1.0.1-Linux å­ç›®å½•ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥è¿›å»æ‰§è¡Œè¯¥ç¨‹åºï¼š</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[ehome@xman Demo8]$ ./Demo8-1.0.1-Linux/bin/Demo 5 2</span><br><span class="line">Now we use our own Math library. </span><br><span class="line">5 ^ 2 is 25</span><br></pre></td></tr></table></figure></div>

<p>å…³äº CPack çš„æ›´è¯¦ç»†çš„ç”¨æ³•å¯ä»¥é€šè¿‡ <code>man 1 cpack</code> å‚è€ƒ CPack çš„æ–‡æ¡£ã€‚</p>
<h6 id="å°†å…¶ä»–å¹³å°çš„é¡¹ç›®è¿ç§»åˆ°CMake"><a href="#å°†å…¶ä»–å¹³å°çš„é¡¹ç›®è¿ç§»åˆ°CMake" class="headerlink" title="å°†å…¶ä»–å¹³å°çš„é¡¹ç›®è¿ç§»åˆ°CMake"></a>å°†å…¶ä»–å¹³å°çš„é¡¹ç›®è¿ç§»åˆ°CMake</h6><blockquote>
<p>é€šè¿‡CMakeå¯ä»¥ç¼–å†™ä¸€ä¸ªé€šç”¨çš„CMakeLists.txtæ–‡ä»¶ï¼Œç„¶ååœ¨ä¸åŒçš„æ“ä½œç³»ç»Ÿä¸Šç”Ÿæˆç›¸åº”çš„æ„å»ºæ–‡ä»¶ã€‚ä¾‹å¦‚ï¼Œåœ¨Windowsä¸Šå¯ä»¥ç”ŸæˆVisual Studioè§£å†³æ–¹æ¡ˆæˆ–ä½¿ç”¨MinGWç”ŸæˆMakefileï¼Œåœ¨Linuxä¸Šå¯ä»¥ç”ŸæˆMakefileï¼Œåœ¨macOSä¸Šå¯ä»¥ç”ŸæˆXcodeé¡¹ç›®ç­‰ã€‚è¿™æ ·å¼€å‘è€…å¯ä»¥ä½¿ç”¨ç›¸åŒçš„CMakeé…ç½®æ–‡ä»¶åœ¨ä¸åŒçš„å¹³å°ä¸Šæ„å»ºé¡¹ç›®ã€‚</p>
</blockquote>
<p>CMake å¯ä»¥å¾ˆè½»æ¾åœ°æ„å»ºå‡ºåœ¨é€‚åˆå„ä¸ªå¹³å°æ‰§è¡Œçš„å·¥ç¨‹ç¯å¢ƒã€‚è€Œå¦‚æœå½“å‰çš„å·¥ç¨‹ç¯å¢ƒä¸æ˜¯ CMake ï¼Œè€Œæ˜¯åŸºäºæŸä¸ªç‰¹å®šçš„å¹³å°ï¼Œæ˜¯å¦å¯ä»¥è¿ç§»åˆ° CMake å‘¢ï¼Ÿç­”æ¡ˆæ˜¯å¯èƒ½çš„ã€‚ä¸‹é¢é’ˆå¯¹å‡ ä¸ªå¸¸ç”¨çš„å¹³å°ï¼Œåˆ—å‡ºäº†å®ƒä»¬å¯¹åº”çš„è¿ç§»æ–¹æ¡ˆã€‚</p>
<blockquote>
<p>autotools</p>
</blockquote>
<ul>
<li><a class="link"   target="_blank" rel="noopener" href="https://projects.kde.org/projects/kde/kdesdk/kde-dev-scripts/repository/revisions/master/changes/cmake-utils/scripts/am2cmake" >am2cmake <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> å¯ä»¥å°† autotools ç³»çš„é¡¹ç›®è½¬æ¢åˆ° CMakeï¼Œè¿™ä¸ªå·¥å…·çš„ä¸€ä¸ªæˆåŠŸæ¡ˆä¾‹æ˜¯ KDE ã€‚</li>
<li><a class="link"   target="_blank" rel="noopener" href="http://emanuelgreisen.dk/stuff/kdevelop_am2cmake.php.tgz" >Alternative Automake2CMake <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> å¯ä»¥è½¬æ¢ä½¿ç”¨ automake çš„ KDevelop å·¥ç¨‹é¡¹ç›®ã€‚</li>
<li><a class="link"   target="_blank" rel="noopener" href="http://www.cmake.org/Wiki/GccXmlAutoConfHints" >Converting autoconf tests <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></li>
</ul>
<blockquote>
<p>qmake</p>
</blockquote>
<ul>
<li><a class="link"   target="_blank" rel="noopener" href="http://www.cmake.org/Wiki/CMake:ConvertFromQmake" >qmake converter <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> å¯ä»¥è½¬æ¢ä½¿ç”¨ QT çš„ qmake çš„å·¥ç¨‹ã€‚</li>
</ul>
<blockquote>
<p>Visual Studio</p>
</blockquote>
<ul>
<li><a class="link"   target="_blank" rel="noopener" href="http://vcproj2cmake.sf.net/" >vcproj2cmake.rb <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> å¯ä»¥æ ¹æ® Visual Studio çš„å·¥ç¨‹æ–‡ä»¶ï¼ˆåç¼€åæ˜¯ <code>.vcproj</code> æˆ– <code>.vcxproj</code>ï¼‰ç”Ÿæˆ CMakeLists.txt æ–‡ä»¶ã€‚</li>
<li><a class="link"   target="_blank" rel="noopener" href="http://nberserk.blogspot.com/2010/11/converting-vc-projectsvcproj-to.html" >vcproj2cmake.ps1 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> vcproj2cmake çš„ PowerShell ç‰ˆæœ¬ã€‚</li>
<li><a class="link"   target="_blank" rel="noopener" href="http://sourceforge.net/projects/folders4cmake/" >folders4cmake <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> æ ¹æ® Visual Studio é¡¹ç›®æ–‡ä»¶ç”Ÿæˆç›¸åº”çš„ â€œsource_groupâ€ ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯å¯ä»¥å¾ˆæ–¹ä¾¿çš„åœ¨ CMake è„šæœ¬ä¸­ä½¿ç”¨ã€‚æ”¯æŒ Visual Studio 9&#x2F;10 å·¥ç¨‹æ–‡ä»¶ã€‚</li>
</ul>
<blockquote>
<p>CMakeLists.txt è‡ªåŠ¨æ¨å¯¼</p>
</blockquote>
<ul>
<li><a class="link"   target="_blank" rel="noopener" href="http://websvn.kde.org/trunk/KDE/kdesdk/cmake/scripts/" >gencmake <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> æ ¹æ®ç°æœ‰æ–‡ä»¶æ¨å¯¼ CMakeLists.txt æ–‡ä»¶ã€‚</li>
<li><a class="link"   target="_blank" rel="noopener" href="http://www.vanvelzensoftware.com/postnuke/index.php?name=Downloads&req=viewdownload&cid=7" >CMakeListGenerator <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> åº”ç”¨ä¸€å¥—æ–‡ä»¶å’Œç›®å½•åˆ†æåˆ›å»ºå‡ºå®Œæ•´çš„ CMakeLists.txt æ–‡ä»¶ã€‚ä»…æ”¯æŒ Win32 å¹³å°ã€‚</li>
</ul>
<h5 id="å·¥ç¨‹åˆ›å»º-1"><a href="#å·¥ç¨‹åˆ›å»º-1" class="headerlink" title="å·¥ç¨‹åˆ›å»º"></a>å·¥ç¨‹åˆ›å»º</h5><p>åœ°å¹³çº¿å¼€å‘åº“æä¾›äº†armçš„ä¾èµ–ç¯å¢ƒå’Œæ¿ç«¯åº”ç”¨ç¨‹åºã€‚æˆ‘ä»¬æä¾›çš„å·¥ç¨‹ä¾èµ–ä¿¡æ¯å¦‚ä¸‹ï¼š</p>
<ul>
<li>åœ°å¹³çº¿è¯„æµ‹åº“libdnn.soï¼Œè·¯å¾„ï¼š <code>~/.horizon/ddk/j5_aarch64/dnn/lib/</code>ã€‚</li>
<li>åœ°å¹³çº¿ç¼–è¯‘å™¨ä¾èµ– <code>libhbrt_bayes_aarch64.so</code>ï¼Œè·¯å¾„ï¼š <code>~/.horizon/ddk/j5_aarch64/dnn/lib/</code>ã€‚</li>
<li>åœ°å¹³çº¿J5èŠ¯ç‰‡ç³»ç»Ÿä¾èµ–ï¼Œè·¯å¾„ï¼š <code>~/.horizon/ddk/j5_aarch64/appsdk/appuser/</code>ã€‚</li>
<li>Cç¼–è¯‘å™¨ aarch64-linux-gnu-gccã€‚</li>
<li>C++ç¼–è¯‘å™¨ aarch64-linux-gnu-g++ã€‚</li>
</ul>
<p>åˆ›å»ºä¸€ä¸ªå·¥ç¨‹ï¼Œç”¨æˆ·éœ€è¦ç¼–å†™ <code>CMakeLists.txt</code> æ–‡ä»¶ã€‚ è„šæœ¬ä¸­å®šä¹‰äº†ç¼–è¯‘å·¥å…·è·¯å¾„ï¼Œ <code>CMakeLists.txt</code> æ–‡ä»¶ä¸­å®šä¹‰äº†ä¸€äº›ç¼–è¯‘é€‰é¡¹ï¼Œä»¥åŠä¾èµ–åº“ã€å¤´æ–‡ä»¶çš„è·¯å¾„ã€‚å‚è€ƒå¦‚ä¸‹ï¼š</p>
<div class="highlight-container" data-rel="Cmake"><figure class="iseeu highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cmake_minimum_required</span>(VERSION <span class="number">2.8</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">project</span>(your_project_name)</span><br><span class="line"></span><br><span class="line"><span class="keyword">set</span>(CMAKE_CXX_FLAGS <span class="string">&quot;$&#123;CMAKE_CXX_FLAGS&#125; -std=c++11&quot;</span>)	<span class="comment">#è®¾ç½®C++ç¼–è¯‘å™¨çš„ç¼–è¯‘é€‰é¡¹ï¼Œè¿™é‡Œå°†æ ‡å‡†è®¾ç½®ä¸ºC++11ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#CMAKE_CXX_FLAGS_DEBUGå’ŒCMAKE_C_FLAGS_DEBUGç”¨äºè®¾ç½®Debugæ¨¡å¼ä¸‹çš„ç¼–è¯‘é€‰é¡¹ï¼ŒCMAKE_CXX_FLAGS_RELEASEå’ŒCMAKE_C_FLAGS_RELEASEç”¨äºè®¾ç½®Releaseæ¨¡å¼ä¸‹çš„ç¼–è¯‘é€‰é¡¹ã€‚</span></span><br><span class="line"><span class="keyword">set</span>(CMAKE_CXX_FLAGS_DEBUG <span class="string">&quot; -Wall -Werror -g -O0 &quot;</span>)</span><br><span class="line"><span class="keyword">set</span>(CMAKE_C_FLAGS_DEBUG <span class="string">&quot; -Wall -Werror -g -O0 &quot;</span>)</span><br><span class="line"><span class="keyword">set</span>(CMAKE_CXX_FLAGS_RELEASE <span class="string">&quot; -Wall -Werror -O3 &quot;</span>)</span><br><span class="line"><span class="keyword">set</span>(CMAKE_C_FLAGS_RELEASE <span class="string">&quot; -Wall -Werror -O3 &quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">NOT</span> CMAKE_BUILD_TYPE)		<span class="comment">#ç”¨äºè®¾ç½®é»˜è®¤çš„æ„å»ºç±»å‹ä¸ºReleaseï¼Œå¦‚æœæœªæŒ‡å®šæ„å»ºç±»å‹ã€‚</span></span><br><span class="line">    <span class="keyword">set</span>(CMAKE_BUILD_TYPE Release)</span><br><span class="line"><span class="keyword">endif</span> ()</span><br><span class="line"></span><br><span class="line"><span class="keyword">message</span>(STATUS <span class="string">&quot;Build type: $&#123;CMAKE_BUILD_TYPE&#125;&quot;</span>)	<span class="comment">#è¾“å‡ºå½“å‰æ„å»ºç±»å‹ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># define dnn lib path</span></span><br><span class="line"><span class="keyword">set</span>(DNN_PATH <span class="string">&quot;~/.horizon/ddk/j5_aarch64/dnn/&quot;</span>)</span><br><span class="line"><span class="keyword">set</span>(APPSDK_PATH <span class="string">&quot;~/.horizon/ddk/j5_aarch64/appsdk/appuser/&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">set</span>(DNN_LIB_PATH <span class="variable">$&#123;DNN_PATH&#125;</span>/lib)</span><br><span class="line"><span class="keyword">set</span>(BPU_libs dnn cnn_intf hbrt_bayes_aarch64)	<span class="comment">#å®šä¹‰ BPU_libs ä¸ºéœ€è¦é“¾æ¥çš„åº“çš„åç§°ã€‚dnn cnn_intf hbrt_bayes_aarch64åˆ†åˆ«éƒ½æ˜¯åº“çš„åç§°ï¼Œé€šè¿‡BUU_libsé“¾æ¥åˆ°å¯æ‰§è¡Œæ–‡ä»¶</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">include_directories</span>(<span class="variable">$&#123;DNN_PATH&#125;</span>/<span class="keyword">include</span></span><br><span class="line">                    <span class="variable">$&#123;APPSDK_PATH&#125;</span>/<span class="keyword">include</span>)</span><br><span class="line"><span class="keyword">link_directories</span>(<span class="variable">$&#123;DNN_LIB_PATH&#125;</span></span><br><span class="line">                <span class="variable">$&#123;APPSDK_PATH&#125;</span>/lib)</span><br><span class="line"></span><br><span class="line"><span class="keyword">add_executable</span>(user_app main.cc)</span><br><span class="line"><span class="keyword">target_link_libraries</span>(user_app</span><br><span class="line">                      <span class="variable">$&#123;BPU_libs&#125;</span></span><br><span class="line">                      pthread</span><br><span class="line">                      rt</span><br><span class="line">                      dl)</span><br></pre></td></tr></table></figure></div>

<p><strong>æ³¨æ„åœ¨ä»¥ä¸Šç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬æ²¡æœ‰æŒ‡å®šç¼–è¯‘å™¨ä½ç½®ï¼Œä¼šåœ¨é…åˆå·¥ç¨‹ç¼–è¯‘é˜¶æ®µè¡¥å……ç¼–è¯‘å™¨æŒ‡å®š</strong></p>
<h4 id="å·¥ç¨‹å®ç°"><a href="#å·¥ç¨‹å®ç°" class="headerlink" title="å·¥ç¨‹å®ç°"></a>å·¥ç¨‹å®ç°</h4><p>å·¥ç¨‹å®ç°éƒ¨åˆ†ï¼Œæˆ‘ä»¬ä¸»è¦ä¸ºæ‚¨ä»‹ç»å¦‚ä½•å°†å‰æ–‡æµ®ç‚¹è½¬æ¢å¾—åˆ°çš„binæ¨¡å‹åœ¨åœ°å¹³çº¿å¹³å°è¿è¡Œèµ·æ¥ã€‚ æœ€ç®€å•çš„æ­¥éª¤åº”è¯¥åŒ…æ‹¬æ¨¡å‹åŠ è½½ã€å‡†å¤‡è¾“å…¥æ•°æ®ã€å‡†å¤‡è¾“å‡ºå†…å­˜ã€æ¨ç†å’Œç»“æœè§£æï¼Œä»¥ä¸‹æ˜¯ä¸€ä»½ç®€å•çš„åŠ è½½éƒ¨ç½²æ¨¡å‹å‚è€ƒä»£ç ï¼š</p>
<div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;dnn/hb_dnn.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;dnn/hb_sys.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">float</span> <span class="title">quanti_shift</span><span class="params">(<span class="type">int32_t</span> data, <span class="type">uint32_t</span> shift)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(data) / <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;(<span class="number">1</span> &lt;&lt; shift);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">float</span> <span class="title">quanti_scale</span><span class="params">(<span class="type">int32_t</span> data, <span class="type">float</span> scale)</span> </span>&#123; <span class="keyword">return</span> data * scale; &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> **argv)</span> </span>&#123;</span><br><span class="line">  <span class="comment">// ç¬¬ä¸€æ­¥åŠ è½½æ¨¡å‹</span></span><br><span class="line">  hbPackedDNNHandle_t packed_dnn_handle;</span><br><span class="line">  <span class="type">const</span> <span class="type">char</span>* model_file_name= <span class="string">&quot;./mobilenetv1/mobilenetv1_224x224_nv12.bin&quot;</span>;</span><br><span class="line">  <span class="built_in">hbDNNInitializeFromFiles</span>(&amp;packed_dnn_handle, &amp;model_file_name, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ç¬¬äºŒæ­¥è·å–æ¨¡å‹åç§°</span></span><br><span class="line">  <span class="type">const</span> <span class="type">char</span> **model_name_list;</span><br><span class="line">  <span class="type">int</span> model_count = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">hbDNNGetModelNameList</span>(&amp;model_name_list, &amp;model_count, packed_dnn_handle);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ç¬¬ä¸‰æ­¥è·å–dnn_handle</span></span><br><span class="line">  hbDNNHandle_t dnn_handle;</span><br><span class="line">  <span class="built_in">hbDNNGetModelHandle</span>(&amp;dnn_handle, packed_dnn_handle, model_name_list[<span class="number">0</span>]);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ç¬¬å››æ­¥å‡†å¤‡è¾“å…¥æ•°æ®</span></span><br><span class="line">  hbDNNTensor input;</span><br><span class="line">  hbDNNTensorProperties input_properties;</span><br><span class="line">  <span class="built_in">hbDNNGetInputTensorProperties</span>(&amp;input_properties, dnn_handle, <span class="number">0</span>);</span><br><span class="line">  input.properties = input_properties;</span><br><span class="line">  <span class="keyword">auto</span> &amp;mem = input.sysMem[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">  <span class="type">int</span> yuv_length = <span class="number">224</span> * <span class="number">224</span> * <span class="number">3</span> / <span class="number">2</span>;</span><br><span class="line">  <span class="built_in">hbSysAllocCachedMem</span>(&amp;mem, yuv_length);</span><br><span class="line">  <span class="comment">//memcpy(mem.virAddr, yuv_data, yuv_length);</span></span><br><span class="line">  <span class="comment">//hbSysFlushMem(&amp;mem, HB_SYS_MEM_CACHE_CLEAN);</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// ç¬¬äº”æ­¥å‡†å¤‡æ¨¡å‹è¾“å‡ºæ•°æ®çš„ç©ºé—´</span></span><br><span class="line">  <span class="type">int</span> output_count;</span><br><span class="line">  <span class="built_in">hbDNNGetOutputCount</span>(&amp;output_count, dnn_handle);</span><br><span class="line">  hbDNNTensor *output = <span class="keyword">new</span> hbDNNTensor[output_count];</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; output_count; i++) &#123;</span><br><span class="line">    hbDNNTensorProperties &amp;output_properties = output[i].properties;</span><br><span class="line">    <span class="built_in">hbDNNGetOutputTensorProperties</span>(&amp;output_properties, dnn_handle, i);</span><br><span class="line">    <span class="type">int</span> out_aligned_size = output_properties.alignedByteSize;</span><br><span class="line">    hbSysMem &amp;mem = output[i].sysMem[<span class="number">0</span>];</span><br><span class="line">    <span class="built_in">hbSysAllocCachedMem</span>(&amp;mem, out_aligned_size);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ç¬¬å…­æ­¥æ¨ç†æ¨¡å‹</span></span><br><span class="line">  hbDNNTaskHandle_t task_handle = <span class="literal">nullptr</span>;</span><br><span class="line">  hbDNNInferCtrlParam infer_ctrl_param;</span><br><span class="line">  <span class="built_in">HB_DNN_INITIALIZE_INFER_CTRL_PARAM</span>(&amp;infer_ctrl_param);</span><br><span class="line">  <span class="built_in">hbDNNInfer</span>(&amp;task_handle,</span><br><span class="line">              &amp;output,</span><br><span class="line">              &amp;input,</span><br><span class="line">              dnn_handle,</span><br><span class="line">              &amp;infer_ctrl_param);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ç¬¬ä¸ƒæ­¥ç­‰å¾…ä»»åŠ¡ç»“æŸ</span></span><br><span class="line">  <span class="built_in">hbDNNWaitTaskDone</span>(task_handle, <span class="number">0</span>);</span><br><span class="line">  <span class="comment">//ç¬¬å…«æ­¥è§£ææ¨¡å‹è¾“å‡ºï¼Œä¾‹å­å°±è·å–mobilenetv1çš„top1åˆ†ç±»</span></span><br><span class="line">  <span class="type">float</span> max_prob = <span class="number">-1.0</span>;</span><br><span class="line">  <span class="type">int</span> max_prob_type_id = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">hbSysFlushMem</span>(&amp;(output-&gt;sysMem[<span class="number">0</span>]), HB_SYS_MEM_CACHE_INVALIDATE);</span><br><span class="line">  <span class="type">float</span> *data = <span class="built_in">reinterpret_cast</span>&lt; <span class="type">float</span> *&gt;(output-&gt;sysMem[<span class="number">0</span>].virAddr);</span><br><span class="line">  <span class="type">int</span> *shape = output-&gt;properties.validShape.dimensionSize;</span><br><span class="line">  <span class="type">int</span> * aligned_shape = output-&gt;properties.alignedShape.dimensionSize;</span><br><span class="line">  <span class="keyword">auto</span> properties = output-&gt;properties;</span><br><span class="line">  <span class="type">int</span> offset = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">if</span> (properties.tensorLayout == HB_DNN_LAYOUT_NCHW) &#123;</span><br><span class="line">    offset = aligned_shape[<span class="number">2</span>] * aligned_shape[<span class="number">3</span>];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">auto</span> i = <span class="number">0</span>; i &lt; shape[<span class="number">1</span>] * shape[<span class="number">2</span>] * shape[<span class="number">3</span>]; i++) &#123;</span><br><span class="line">    <span class="type">float</span> score;</span><br><span class="line">    <span class="keyword">if</span> (properties.quantiType == SHIFT) &#123;</span><br><span class="line">      score = <span class="built_in">quanti_shift</span>(data[i * offset], properties.shift.shiftData[i]);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (properties.quantiType == SCALE) &#123;</span><br><span class="line">      score = <span class="built_in">quanti_scale</span>(data[i * offset], properties.scale.scaleData[i]);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (properties.quantiType == NONE)&#123;</span><br><span class="line">      score = data[i * offset];</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      std::cout &lt;&lt; <span class="string">&quot;quanti type error!&quot;</span>;</span><br><span class="line">      <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(score &lt; max_prob)</span><br><span class="line">      <span class="keyword">continue</span>;</span><br><span class="line">    max_prob = score;</span><br><span class="line">    max_prob_type_id = i;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  std::cout &lt;&lt; <span class="string">&quot;max id: &quot;</span> &lt;&lt; max_prob_type_id &lt;&lt; std::endl;</span><br><span class="line">  <span class="comment">// é‡Šæ”¾ä»»åŠ¡</span></span><br><span class="line">  <span class="built_in">hbDNNReleaseTask</span>(task_handle);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// é‡Šæ”¾å†…å­˜</span></span><br><span class="line">  <span class="built_in">hbSysFreeMem</span>(&amp;(input.sysMem[<span class="number">0</span>]));</span><br><span class="line">  <span class="built_in">hbSysFreeMem</span>(&amp;(output-&gt;sysMem[<span class="number">0</span>]));</span><br><span class="line"></span><br><span class="line">  <span class="comment">// é‡Šæ”¾æ¨¡å‹</span></span><br><span class="line">  <span class="built_in">hbDNNRelease</span>(packed_dnn_handle);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>ç¤ºä¾‹ä»£ç ä¸­ï¼Œä¸ºäº†ç¼©å‡ç¯‡å¹…ï¼Œå¯¹äºéƒ¨åˆ†æ•°æ®å°±ç›´æ¥ä½¿ç”¨äº†å·²çŸ¥çš„å¸¸æ•°ã€‚ åœ¨å®é™…ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œæ‚¨åº”è¯¥é€šè¿‡ <code>hbDNNGetInputTensorProperties/hbDNNGetOutputTensorProperties</code> ç­‰æ¥å£è·å–å°ºå¯¸å’Œæ•°æ®ç±»å‹ç­‰ä¿¡æ¯ã€‚</p>
<p>éœ€è¦æ‚¨æ³¨æ„çš„æ˜¯ï¼Œåœ¨è¾“å…¥æ•°æ®å‡†å¤‡é˜¶æ®µï¼Œæˆ‘ä»¬æ³¨é‡Šæ‰äº†ä¸€æ®µ <code>memcpy</code> ä»£ç ã€‚ è¿™é‡Œåº”å½“æ˜¯æ ¹æ®æ¨¡å‹çš„è¾“å…¥æ ¼å¼è¦æ±‚å‡†å¤‡è¾“å…¥æ ·æœ¬ï¼Œå¹¶å°†å…¶æ‹·è´åˆ° <code>input.sysMem[0]</code> ä¸­ã€‚</p>
<p>æ›´åŠ å…¨é¢çš„å·¥ç¨‹å®ç°æŒ‡å¯¼è¯·é˜…è¯» <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/runtime/source/bpu_sdk_api/source/index.html" >BPU SDK APIæ‰‹å†Œ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ã€‚</p>
<h4 id="å·¥ç¨‹ç¼–è¯‘ä¸è¿è¡Œ"><a href="#å·¥ç¨‹ç¼–è¯‘ä¸è¿è¡Œ" class="headerlink" title="å·¥ç¨‹ç¼–è¯‘ä¸è¿è¡Œ"></a>å·¥ç¨‹ç¼–è¯‘ä¸è¿è¡Œ</h4><p>ç»“åˆ <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/runtime/source/runtime_dev.html#create-your-project" >å·¥ç¨‹åˆ›å»º <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ä¸€èŠ‚ä¸­çš„cmakeå·¥ç¨‹é…ç½®ï¼Œå‚è€ƒå¦‚ä¸‹ç¼–è¯‘è„šæœ¬ï¼š</p>
<div class="highlight-container" data-rel="Cmake"><figure class="iseeu highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¸ºarmå®šä¹‰gccè·¯å¾„</span></span><br><span class="line">LINARO_GCC_ROOT=/opt/gcc-ubuntu-<span class="number">9.3</span>.<span class="number">0</span>-<span class="number">2020.03</span>-x86_64-aarch64-linux-gnu/</span><br><span class="line">DIR=$(cd <span class="string">&quot;$(dirname &quot;</span>$<span class="number">0</span><span class="string">&quot;)&quot;</span>;pwd)		<span class="comment">#ä½¿ç”¨cdå‘½ä»¤å°†æŒ‡é’ˆç§»åˆ°å½“å‰ç›®å½•çš„ç»å¯¹è·¯å¾„ï¼Œä¿å­˜åœ¨å˜é‡$DIRä¸­ã€‚</span></span><br><span class="line"><span class="keyword">export</span> CC=<span class="variable">$&#123;LINARO_GCC_ROOT&#125;</span>/bin/aarch64-linux-gnu-gcc</span><br><span class="line"><span class="keyword">export</span> CXX=<span class="variable">$&#123;LINARO_GCC_ROOT&#125;</span>/bin/aarch64-linux-gnu-g++</span><br><span class="line"></span><br><span class="line">rm -rf build_arm</span><br><span class="line">mkdir build_arm</span><br><span class="line">cd build_arm</span><br><span class="line"></span><br><span class="line">cmake <span class="variable">$&#123;DIR&#125;</span></span><br><span class="line"></span><br><span class="line">make -j8		<span class="comment">#ä»¥ä½¿ç”¨8ä¸ªå¹¶è¡Œä»»åŠ¡è¿›è¡Œæ„å»ºã€‚</span></span><br></pre></td></tr></table></figure></div>

<p>æ ¹æ® <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/env_install/env_deploy.html" >ç¯å¢ƒéƒ¨ç½² <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> éƒ¨åˆ†çš„æŒ‡å¼•ï¼Œæ‚¨çš„å¼€å‘æœºä¸­åº”è¯¥å·²ç»å®‰è£…æœ‰ç›¸åº”ç¼–è¯‘å™¨ï¼Œå°†ä¸Šè¿°è„šæœ¬ä¸­çš„ç¼–è¯‘å™¨é…ç½®æŒ‡å®šä¸ºæ‚¨çš„å®‰è£…é¡¹ç›®å³å¯ã€‚</p>
<p>armç¨‹åºæ‹·è´åˆ°åœ°å¹³çº¿å¼€å‘æ¿ä¸Šå¯è¿è¡Œï¼Œæ³¨æ„ç¨‹åºä¾èµ–çš„æ–‡ä»¶ä¹Ÿéœ€è¦ä¸€åŒæ‹·è´åˆ°å¼€å‘æ¿ï¼Œå¹¶åœ¨å¯åŠ¨è„šæœ¬ä¸­é…ç½®ä¾èµ–ã€‚ ä¾‹å¦‚æˆ‘ä»¬çš„ç¤ºä¾‹ç¨‹åºä¾èµ–åº“æœ‰ï¼š <code>libhbrt_bayes_aarch64.soã€libdnn.so</code> ï¼Œ è¿™ä¸¤ä¸ªä¾èµ–åº“åœ¨æœ¬åœ°çš„ä½ç½®ä¸ºï¼š <code>~/.horizon/ddk/j5_aarch64/dnn/lib/</code> ï¼Œéœ€è¦å°†ä¹‹ä¸Šä¼ åˆ°æ¿å­çš„è¿è¡Œç¯å¢ƒä¸­ã€‚ <strong>æˆ‘ä»¬å»ºè®®æ‚¨åœ¨æ¿ç«¯çš„ <code>/userdata</code> è·¯å¾„ä¸‹æ–°å»º <code>lib</code> è·¯å¾„å¹¶å°†åº“ä¼ é€è‡³è¯¥ç›®å½•ä¸‹ï¼Œåˆ™åœ¨æ¿ç«¯è¿è¡Œç¨‹åºå‰ï¼Œéœ€æŒ‡å®šçš„ä¾èµ–åº“è·¯å¾„ä¿¡æ¯å¦‚ä¸‹ï¼š</strong></p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/userdata/lib</span><br></pre></td></tr></table></figure></div>

<h4 id="å¤šæ¨¡å‹æ§åˆ¶ç­–ç•¥"><a href="#å¤šæ¨¡å‹æ§åˆ¶ç­–ç•¥" class="headerlink" title="å¤šæ¨¡å‹æ§åˆ¶ç­–ç•¥"></a>å¤šæ¨¡å‹æ§åˆ¶ç­–ç•¥</h4><p>å¤šæ¨¡å‹åœºæ™¯ä¸­ï¼Œæ¯ä¸ªæ¨¡å‹éƒ½éœ€è¦ä½¿ç”¨æœ‰é™çš„è®¡ç®—èµ„æºå®Œæˆæ¨ç†ï¼Œä¸å¯é¿å…åœ°ä¼šå‡ºç°è®¡ç®—èµ„æºçš„äº‰å¤ºæƒ…å†µã€‚ ä¸ºäº†ä¾¿äºæ‚¨æ§åˆ¶å¤šæ¨¡å‹çš„æ‰§è¡Œï¼Œåœ°å¹³çº¿æä¾›äº†æ¨¡å‹ä¼˜å…ˆçº§çš„æ§åˆ¶ç­–ç•¥ä¾›æ‚¨ä½¿ç”¨ã€‚</p>
<p><strong>æ³¨æ„ï¼šæ­¤åŠŸèƒ½ä»…æ”¯æŒåœ¨å¼€å‘æ¿ç«¯å®ç°ï¼Œx86æ¨¡æ‹Ÿå™¨ä¸æ”¯æŒæ­¤åŠŸèƒ½ã€‚</strong></p>
<p>J5èŠ¯ç‰‡BPUè®¡ç®—å•å…ƒç¡¬ä»¶æœ¬èº«æ²¡æœ‰ä»»åŠ¡æŠ¢å åŠŸèƒ½ï¼Œå¯¹äºæ¯ä¸€ä¸ªæ¨ç†ä»»åŠ¡ï¼Œä¸€æ—¦å®ƒè¿›åˆ°BPUæ¨¡å‹è®¡ç®—ä¹‹åï¼Œåœ¨è¯¥ä»»åŠ¡æ‰§è¡Œå®Œæˆä¹‹å‰éƒ½ä¼šä¸€ç›´å ç”¨BPUï¼Œ å…¶ä»–ä»»åŠ¡åªèƒ½æ’é˜Ÿç­‰å¾…ã€‚æ­¤æ—¶å¾ˆå®¹æ˜“å‡ºç°BPUè®¡ç®—èµ„æºè¢«ä¸€ä¸ªå¤§æ¨¡å‹æ¨ç†ä»»åŠ¡æ‰€ç‹¬å ï¼Œè¿›è€Œå½±å“å…¶ä»–é«˜ä¼˜å…ˆçº§æ¨¡å‹çš„æ¨ç†ä»»åŠ¡æ‰§è¡Œã€‚ é’ˆå¯¹è¿™ç§é—®é¢˜ï¼Œ<strong>Runtime SDKåŸºäºæ¨¡å‹çš„ä¼˜å…ˆçº§é€šè¿‡è½¯ä»¶çš„æ–¹å¼å®ç°äº†BPUèµ„æºæŠ¢å çš„åŠŸèƒ½ã€‚</strong></p>
<p>å…¶ä¸­æœ‰ä»¥ä¸‹ç‚¹éœ€è¦è¢«å…³æ³¨ï¼š</p>
<ul>
<li>ç¼–è¯‘åçš„æ•°æ®æŒ‡ä»¤æ¨¡å‹åœ¨BPUä¸Šè¿›è¡Œæ¨ç†è®¡ç®—æ—¶ï¼Œå®ƒå°†è¡¨ç°ä¸º1ä¸ªæˆ–è€…å¤šä¸ªfunction-callçš„è°ƒç”¨ï¼Œå…¶ä¸­function-callæ˜¯BPUçš„æ‰§è¡Œç²’åº¦ï¼Œ å¤šä¸ªfunction-callè°ƒç”¨ä»»åŠ¡å°†åœ¨BPUçš„ç¡¬ä»¶é˜Ÿåˆ—ä¸ŠæŒ‰åºè¿›è¡Œè°ƒåº¦ï¼Œå½“ä¸€ä¸ªæ¨¡å‹æ‰€æœ‰çš„function-calléƒ½æ‰§è¡Œå®Œæˆï¼Œ é‚£ä¹ˆä¸€ä¸ªæ¨¡å‹æ¨ç†ä»»åŠ¡ä¹Ÿå°±æ‰§è¡Œå®Œæˆäº†ã€‚</li>
<li>åŸºäºä¸Šè¿°æè¿°ï¼ŒBPUæ¨¡å‹ä»»åŠ¡æŠ¢å ç²’åº¦è®¾è®¡ä¸ºfunction-callæ›´ä¸ºç®€å•ï¼Œå³BPUæ‰§è¡Œå®Œä¸€ä¸ªfunction-callä¹‹åï¼Œæš‚æ—¶æŒ‚èµ·å½“å‰æ¨¡å‹ï¼Œ ç„¶ååˆ‡å…¥æ‰§è¡Œå¦å¤–ä¸€ä¸ªæ¨¡å‹ï¼Œå½“æ–°æ¨¡å‹æ‰§è¡Œå®Œæˆä¹‹åï¼Œå†æ¢å¤åŸæ¥æ¨¡å‹çš„çŠ¶æ€ç»§ç»­è¿è¡Œã€‚ ä½†æ˜¯è¿™é‡Œå­˜åœ¨ä¸¤ä¸ªé—®é¢˜ï¼Œç¬¬ä¸€æ˜¯ç»è¿‡ç¼–è¯‘å™¨ç¼–è¯‘å‡ºæ¥çš„æ¨¡å‹function-calléƒ½æ˜¯mergeåœ¨ä¸€èµ·ï¼Œæ­¤æ—¶æ¨¡å‹åªæœ‰ä¸€ä¸ªå¤§çš„function-callï¼Œ å®ƒæ— æ³•è¢«è¢«æŠ¢å ï¼›ç¬¬äºŒæ˜¯æ¯ä¸ªfunction-callçš„æ‰§è¡Œæ—¶é—´æ¯”è¾ƒé•¿æˆ–è€…ä¸å›ºå®šï¼Œä¹Ÿä¼šé€ æˆæŠ¢å æ—¶æœºä¸å›ºå®šï¼Œå½±å“æŠ¢å æ•ˆæœã€‚</li>
</ul>
<p>ä¸ºäº†è§£å†³ä¸Šè¿°çš„ä¸¤ä¸ªé—®é¢˜ï¼Œåœ°å¹³çº¿åœ¨æ¨¡å‹ç¼–è¯‘å’Œç³»ç»Ÿè½¯ä»¶å±‚é¢éƒ½ç»™äºˆäº†æ”¯æŒï¼Œä¸‹é¢åˆ†åˆ«ä»‹ç»å…¶å®ç°åŸç†å’Œæ“ä½œæ–¹æ³•ï¼š</p>
<ul>
<li>é¦–å…ˆï¼Œå¦‚æœæ‚¨é€‰æ‹©ä½¿ç”¨QATæ–¹æ¡ˆå¤„ç†æ¨¡å‹ï¼Œåˆ™åœ¨ <strong>æ¨¡å‹ç¼–è¯‘</strong> é˜¶æ®µï¼Œ æ‚¨éœ€è¦åœ¨ç¼–è¯‘æ¥å£ä¸­çš„é¢å¤–å‚æ•°é…ç½®ä¸­æ·»åŠ  <code>max-time-per-fc</code> é€‰é¡¹ï¼Œç”¨äºè®¾ç½®æ¯ä¸ªfunction callçš„æ‰§è¡Œæ—¶é—´ï¼ˆä»¥å¾®ç§’ä¸ºå•ä½ï¼‰ï¼Œ å…¶é»˜è®¤å–å€¼ä¸º <code>0</code> ï¼ˆå³åšä¸é™åˆ¶ï¼‰ã€‚ ç”¨æˆ·å¯ä»¥è‡ªè¡Œè®¾ç½®è¿™ä¸ªé€‰é¡¹æ§åˆ¶ä¸Šæ¿è¿è¡Œé˜¶æ®µä¸ªåˆ«å¤§function-callçš„æ‰§è¡Œæ—¶é—´ã€‚ å‡è®¾æŸfunction-callæ‰§è¡Œæ—¶é—´ä¸º10msï¼Œå½“æ¨¡å‹ç¼–è¯‘æ—¶ å°† <code>max-time-per-fc</code> è®¾ç½®ä¸º <code>500</code>ï¼Œ åˆ™è¿™ä¸ªfunction-callå°†ä¼šè¢«æ‹†åˆ†æˆ20ä¸ªã€‚ è€Œå¦‚æœæ‚¨ä½¿ç”¨PTQæ–¹æ¡ˆå¤„ç†æ¨¡å‹ï¼Œåˆ™åœ¨ <strong>æ¨¡å‹è½¬æ¢</strong> é˜¶æ®µï¼Œ<strong>å¯ä»¥åœ¨æ¨¡å‹çš„YAMLé…ç½®æ–‡ä»¶ä¸­çš„ç¼–è¯‘å™¨ç›¸å…³å‚æ•°( <code>compiler_parameters</code> )ä¸­ï¼Œæ·»åŠ  <code>max_time_per_fc</code> å‚æ•°ã€‚</strong></li>
<li>å…¶æ¬¡ï¼Œç³»ç»Ÿè½¯ä»¶å±‚é¢è®¾è®¡äº† <code>BPLAT_CORELIMIT</code> ç¯å¢ƒå˜é‡ç”¨äºè®¾ç½®å¯æŠ¢å çš„ç²’åº¦ã€‚ å¦‚å°†æ­¤å‚æ•°è®¾ç½®ä¸º <code>2</code>ï¼Œåˆ™é«˜ä¼˜å…ˆçº§è¢«è°ƒåº¦æ‰§è¡Œçš„æ—¶é—´ä¸ºå‰é¢2ä¸ªä½ä¼˜å…ˆçº§function-callçš„å¤„ç†æ—¶é—´ã€‚ å¦‚æœä¸º <code>0</code>ï¼Œåˆ™ä¸æŠ¢å ã€‚å› æ­¤ï¼Œä¸ºäº†å°½æ—©æ‰§è¡Œé«˜ä¼˜å…ˆçº§çš„ä»»åŠ¡ï¼Œå¯åœ¨ <strong>ä¸Šæ¿</strong> æ—¶ï¼Œå…ˆè¿è¡Œ <code>export BPLAT_CORELIMIT=1</code> å°†æ­¤ç¯å¢ƒå˜é‡çš„å–å€¼è®¾ç½®ä¸º <code>1</code>ã€‚ <em><strong>è¿™æ ·å½“ç³»ç»Ÿåº•å±‚æ”¶åˆ°æ¨¡å‹çš„function-callæ—¶ï¼Œä¼šåˆ¤æ–­å…¶ä¼˜å…ˆçº§ï¼Œå¯¹äºä¼˜å…ˆçº§é«˜çš„function-callåˆ™æ”¾å…¥å•ç‹¬é˜Ÿåˆ—ï¼Œä»¥ä¾¿èƒ½å¤Ÿåœ¨ä¸€ä¸ªfunction-call æ‰§è¡Œå®Œæˆä¹‹åï¼ŒæŠ¢å åˆ°BPUèµ„æºã€‚</strong></em></li>
<li>æ¥ç€ï¼Œç”±äºæ¨¡å‹æŠ¢å æœºåˆ¶æ˜¯åœ¨libdnnä¸­å®ç°çš„ï¼Œç»§ç»­è®¾ç½® <code>dnn</code> çš„ <code>infer</code> æ¥å£æä¾›çš„ <code>hbDNNInferCtrlParam.priority</code> å‚æ•°ã€‚å¦‚ï¼šé…ç½® <code>infer</code> ä»»åŠ¡ä¸º <code>HB_DNN_PRIORITY_PREEMP(255)</code>ï¼Œåˆ™ä¸ºæŠ¢å ä»»åŠ¡ï¼Œå¯æ”¯æŒfunction-callçº§åˆ«æŠ¢å ã€‚</li>
</ul>
<h4 id="åº”ç”¨è°ƒä¼˜å»ºè®®"><a href="#åº”ç”¨è°ƒä¼˜å»ºè®®" class="headerlink" title="åº”ç”¨è°ƒä¼˜å»ºè®®"></a>åº”ç”¨è°ƒä¼˜å»ºè®®</h4><p>åœ°å¹³çº¿å»ºè®®çš„åº”ç”¨è°ƒä¼˜ç­–ç•¥åŒ…æ‹¬å·¥ç¨‹ä»»åŠ¡è°ƒåº¦å’Œç®—æ³•ä»»åŠ¡æ•´åˆä¸¤ä¸ªæ–¹é¢ã€‚</p>
<p><strong>å·¥ç¨‹ä»»åŠ¡è°ƒåº¦</strong> æ–¹é¢ï¼Œæˆ‘ä»¬æ¨èæ‚¨ä½¿ç”¨ä¸€äº›workflowè°ƒåº¦ç®¡ç†å·¥å…·ï¼Œå……åˆ†å‘æŒ¥ä¸åŒä»»åŠ¡é˜¶æ®µçš„å¹¶è¡Œèƒ½åŠ›ã€‚ ä¸€èˆ¬AIåº”ç”¨å¯ä»¥ç®€å•æ‹†åˆ†ä¸ºè¾“å…¥å‰å¤„ç†ã€æ¨¡å‹æ¨ç†ã€è¾“å‡ºåå¤„ç†ä¸‰ä¸ªé˜¶æ®µï¼Œåœ¨ç®€æ˜“æµç¨‹ä¸‹ï¼Œå…¶å¤„ç†æµç¨‹å¦‚ä¸‹å›¾ã€‚</p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230523141923963.png"
                      class="" title="image-20230523141923963"
                >

<p><strong>ç®—æ³•ä»»åŠ¡æ•´åˆ</strong> æ–¹é¢ï¼Œåœ°å¹³çº¿æ¨èæ‚¨ä½¿ç”¨<strong>å¤šä»»åŠ¡æ¨¡å‹</strong>ã€‚ è¿™æ ·ä¸€æ–¹é¢å¯ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šé¿å…å¤šæ¨¡å‹è°ƒåº¦ç®¡ç†çš„å›°éš¾ï¼› å¦ä¸€æ–¹é¢å¤šä»»åŠ¡æ¨¡å‹ä¹Ÿèƒ½å……åˆ†å…±äº«ä¸»å¹²ç½‘ç»œçš„è®¡ç®—é‡ï¼Œè¾ƒäºä½¿ç”¨å„ä¸ªç‹¬ç«‹çš„æ¨¡å‹ï¼Œå¯ä»¥åœ¨æ•´ä¸ªAIåº”ç”¨çº§åˆ«æ˜æ˜¾å‡å°‘è®¡ç®—é‡ï¼Œä»è€Œè¾¾åˆ°æ›´é«˜çš„æ•´ä½“æ€§èƒ½ã€‚ åœ¨åœ°å¹³çº¿å†…éƒ¨å’Œè®¸å¤šåˆä½œå®¢æˆ·çš„ä¸šåŠ¡å®è·µä¸­ï¼Œå¤šä»»åŠ¡ä¹Ÿæ˜¯å¸¸è§çš„åº”ç”¨çº§ä¼˜åŒ–ç­–ç•¥ã€‚</p>
<h4 id="å…¶ä»–åº”ç”¨å¼€å‘å·¥å…·"><a href="#å…¶ä»–åº”ç”¨å¼€å‘å·¥å…·" class="headerlink" title="å…¶ä»–åº”ç”¨å¼€å‘å·¥å…·"></a>å…¶ä»–åº”ç”¨å¼€å‘å·¥å…·</h4><ul>
<li><code>hrt_bin_dump</code> æ˜¯ptq debugæ¨¡å‹çš„layer dumpå·¥å…·ï¼Œå·¥å…·çš„è¾“å‡ºæ–‡ä»¶ä¸ºäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå·¥å…·ä½¿ç”¨æ–¹æ³•è¯·å‚è€ƒ <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/runtime/source/tool_introduction/source/hrt_bin_dump.html" >hrt_bin_dumpå·¥å…·ä»‹ç» <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ã€‚</li>
<li><code>hrt_model_exec</code> æ˜¯ä¸€ä¸ªæ¨¡å‹æ‰§è¡Œå·¥å…·ï¼Œå¯ç›´æ¥åœ¨å¼€å‘æ¿ä¸Šè¯„æµ‹æ¨¡å‹çš„æ¨ç†æ€§èƒ½ã€è·å–æ¨¡å‹ä¿¡æ¯ã€‚ä¸€æ–¹é¢å¯ä»¥è®©ç”¨æˆ·æ‹¿åˆ°æ¨¡å‹æ—¶å®é™…äº†è§£æ¨¡å‹çœŸå®æ€§èƒ½ï¼› å¦ä¸€æ–¹é¢ä¹Ÿå¯ä»¥å¸®åŠ©ç”¨æˆ·äº†è§£æ¨¡å‹å¯ä»¥åšåˆ°çš„é€Ÿåº¦æé™ï¼Œå¯¹äºåº”ç”¨è°ƒä¼˜çš„ç›®æ ‡æé™å…·æœ‰æŒ‡å¯¼æ„ä¹‰ã€‚ <code>hrt_model_exec</code> å·¥å…·åˆ†åˆ«æä¾›äº†æ¨¡å‹æ¨ç† <code>infer</code> ã€æ¨¡å‹æ€§èƒ½åˆ†æ <code>perf</code> å’ŒæŸ¥çœ‹æ¨¡å‹ä¿¡æ¯ <code>model_info</code> ä¸‰ç±»åŠŸèƒ½ï¼Œå·¥å…·ä½¿ç”¨æ–¹æ³•è¯·å‚è€ƒ <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/runtime/source/tool_introduction/source/hrt_model_exec.html" >hrt_model_execå·¥å…·ä»‹ç» <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ã€‚</li>
</ul>
<h4 id="å¸¸è§é—®é¢˜"><a href="#å¸¸è§é—®é¢˜" class="headerlink" title="å¸¸è§é—®é¢˜"></a>å¸¸è§é—®é¢˜</h4><p>åœ¨ <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/runtime/source/bpu_sdk_api/source/index.html" >BPU SDK APIæ‰‹å†Œ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ä¸­ï¼Œæˆ‘ä»¬æä¾›äº†BPUå†…å­˜å‡½æ•° <code>hbSysAllocCachedMem</code> å’Œ <code>hbSysAllocMem</code> æ¥åˆ†é…BPUè¯»å†™å†…å­˜ã€‚ å…¶ä¸­ <code>hbSysAllocCachedMem</code> è¡¨ç¤ºåˆ†é…å¯ä»¥è¢«cacheçš„å†…å­˜ï¼Œ å¹¶é…å¥—äº† <code>hbSysFlushMem</code> å‡½æ•°æ¥å¯¹Cacheè¿›è¡Œåˆ·æ–°ã€‚</p>
<p>Cacheæœºåˆ¶æ˜¯ç”±èŠ¯ç‰‡BPUçš„Bayeså†…å­˜æ¶æ„æ¥å†³å®šçš„ï¼Œè¯¦ç»†å‚è€ƒå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ CPUä¸ä¸»å­˜ä¹‹é—´å­˜åœ¨çš„Cacheä¼šç¼“å­˜æ•°æ®ï¼Œè€ŒBPUä¸ä¸»å­˜ä¹‹é—´åˆ™æ²¡æœ‰cacheã€‚ æ­¤æ—¶è‹¥é”™è¯¯ä½¿ç”¨Cacheå°†ä¼šç›´æ¥å½±å“æœ€ç»ˆæ•°æ®è¯»å†™çš„å‡†ç¡®æ€§å’Œæ•ˆç‡ã€‚</p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230523142304073.png"
                      class="" title="image-20230523142304073"
                >

<ul>
<li>å½“CPUå†™å®Œæ•°æ®åï¼Œéœ€è¦ä¸»åŠ¨å°†Cacheä¸­çš„æ•°æ®flushåˆ°memoryä¸­ï¼Œå¦åˆ™BPUä¼šè¯»å–åˆ°ä¹‹å‰çš„æ—§æ•°æ®ï¼›</li>
<li>è€Œå½“BPUå†™å®Œæ•°æ®åï¼Œä¹Ÿéœ€è¦ä¸»åŠ¨å°†Cacheä¸­çš„æ•°æ®invalidateæ‰ï¼Œå¦åˆ™CPUä¼šä¼˜å…ˆè¯»å–åˆ°ä¹‹å‰ç¼“å­˜åœ¨cacheä¸­çš„æ—§æ•°æ®ï¼›</li>
<li>åœ¨æ¨¡å‹è¿ç»­æ¨ç†è¿‡ç¨‹ä¸­ï¼Œè¾“å…¥è¾“å‡ºå»ºè®®ç”³è¯·å¸¦Cacheçš„å†…å­˜ï¼Œä»¥åŠ é€ŸCPUåå¤è¯»å†™çš„æ•ˆç‡ã€‚</li>
</ul>
<h4 id="ç†è§£BPUå†…å­˜ä¸­çš„ç‰©ç†åœ°å€å’Œè™šæ‹Ÿåœ°å€"><a href="#ç†è§£BPUå†…å­˜ä¸­çš„ç‰©ç†åœ°å€å’Œè™šæ‹Ÿåœ°å€" class="headerlink" title="ç†è§£BPUå†…å­˜ä¸­çš„ç‰©ç†åœ°å€å’Œè™šæ‹Ÿåœ°å€"></a>ç†è§£BPUå†…å­˜ä¸­çš„ç‰©ç†åœ°å€å’Œè™šæ‹Ÿåœ°å€</h4><p>åœ¨J5èŠ¯ç‰‡æ¶æ„ä¸­ï¼ŒBPUå’ŒCPUå†…å­˜å…±äº«ï¼Œé€šè¿‡ <code>hbSysAllocCachedMem</code> å’Œ <code>hbSysAllocMem</code> æ¥å£å¯ä»¥ç”³è¯·åˆ°ä¸€æ®µç‰©ç†ç©ºé—´è¿ç»­çš„å†…å­˜ï¼Œ å…¶å‡½æ•°è¿”å›å€¼è¢«åŒ…è£…åœ¨ <code>hbSysMem</code> æ•°æ®ç»“æ„ä½“ä¸­ï¼Œ <code>phyAddr</code> å’Œ <code>virAddr</code> ä¸¤ä¸ªå­—æ®µåˆ†åˆ«å¯¹åº”å…¶å†…å­˜ç©ºé—´çš„ç‰©ç†åœ°å€å’Œè™šæ‹Ÿåœ°å€ã€‚ ç”±äºè¿™æ®µå†…å­˜ç©ºé—´æ˜¯è¿ç»­çš„ï¼Œæ‰€ä»¥ç‰©ç†åœ°å€å’Œè™šæ‹Ÿåœ°å€éƒ½å¯ä»¥é€šè¿‡é¦–åœ°å€è¿›è¡Œè¡¨ç¤ºå’Œè¯»å†™ã€‚<strong>ä½†æ˜¯åœ¨å®é™…ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œå»ºè®®ä¼˜å…ˆä½¿ç”¨è™šæ‹Ÿåœ°å€ï¼Œéå¿…é¡»åœºæ™¯è¯·å‹¿ç›´æ¥ä½¿ç”¨ç‰©ç†åœ°å€ã€‚</strong></p>
<h3 id="BPU-SDK-APIæ‰‹å†Œ"><a href="#BPU-SDK-APIæ‰‹å†Œ" class="headerlink" title="BPU SDK APIæ‰‹å†Œ"></a>BPU SDK APIæ‰‹å†Œ</h3><h4 id="æ¦‚è¿°-1"><a href="#æ¦‚è¿°-1" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h4><p>æœ¬æ–‡æ¡£ä¸»è¦ä»‹ç»äº†åœ°å¹³çº¿å¤©å·¥å¼€ç‰©å·¥å…·é“¾Runtimeçš„APIã€æ•°æ®ã€ç»“æ„ä½“ã€æ’å¸ƒåŠå¯¹é½è§„åˆ™ç­‰ã€‚ é€šè¿‡é˜…è¯»æœ¬æ–‡æ¡£ï¼Œç”¨æˆ·å¯ä»¥åœ¨Horizonå¼€å‘æ¿ä¸Šåˆ©ç”¨APIå®Œæˆæ¨¡å‹çš„åŠ è½½ä¸é‡Šæ”¾ï¼Œæ¨¡å‹ä¿¡æ¯çš„è·å–ï¼Œä»¥åŠæ¨¡å‹çš„æ¨ç†ç­‰æ“ä½œã€‚</p>
<h4 id="æ•°æ®ç±»å‹å’Œæ•°æ®ç»“æ„"><a href="#æ•°æ®ç±»å‹å’Œæ•°æ®ç»“æ„" class="headerlink" title="æ•°æ®ç±»å‹å’Œæ•°æ®ç»“æ„"></a>æ•°æ®ç±»å‹å’Œæ•°æ®ç»“æ„</h4><h5 id="ç‰ˆæœ¬ä¿¡æ¯ç±»"><a href="#ç‰ˆæœ¬ä¿¡æ¯ç±»" class="headerlink" title="ç‰ˆæœ¬ä¿¡æ¯ç±»"></a>ç‰ˆæœ¬ä¿¡æ¯ç±»</h5><p><strong>æ³¨æ„ï¼šæœ¬å°èŠ‚ä¸­çš„ç‰ˆæœ¬ä¿¡æ¯ç±»å‹çš„ç‰ˆæœ¬å·éšç‰ˆæœ¬å˜åŒ–æœ‰æ‰€ä¸åŒï¼Œæ­¤å¤„çš„ç‰ˆæœ¬å·ä»…ä¾›å‚è€ƒï¼Œå®é™…ç‰ˆæœ¬è¯·ä»¥æ‚¨è·å–åˆ°çš„å‘å¸ƒç‰©ä¸ºå‡†ã€‚</strong></p>
<div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> HB_DNN_VERSION_MAJOR 1U     <span class="comment">//DNNä¸»ç‰ˆæœ¬å·ä¿¡æ¯ã€‚</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> HB_DNN_VERSION_MINOR 1U		<span class="comment">//DNNæ¬¡ç‰ˆæœ¬å·ä¿¡æ¯ã€‚</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> HB_DNN_VERSION_PATCH 0U		<span class="comment">//DNNè¡¥ä¸ç‰ˆæœ¬å·ä¿¡æ¯ã€‚</span></span></span><br></pre></td></tr></table></figure></div>

<h5 id="æ¨¡å‹ç±»"><a href="#æ¨¡å‹ç±»" class="headerlink" title="æ¨¡å‹ç±»"></a>æ¨¡å‹ç±»</h5><div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> HB_DNN_TENSOR_MAX_DIMENSIONS 8		<span class="comment">//å¼ é‡æœ€å¤§çš„ç»´åº¦è®¾ç½®ä¸º 8ã€‚</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> HB_DNN_INITIALIZE_INFER_CTRL_PARAM(param) \		<span class="comment">//åˆå§‹åŒ–æ§åˆ¶å‚æ•°ã€‚</span></span></span><br><span class="line">&#123;                                                 \</span><br><span class="line">    (param)-&gt;bpuCoreId = HB_BPU_CORE_ANY;         \</span><br><span class="line">    (param)-&gt;dspCoreId = HB_DSP_CORE_ANY;         \</span><br><span class="line">    (param)-&gt;priority = HB_DNN_PRIORITY_LOWEST;   \</span><br><span class="line">    (param)-&gt;more = <span class="literal">false</span>;                        \</span><br><span class="line">    (param)-&gt;customId = <span class="number">0</span>;                        \</span><br><span class="line">    (param)-&gt;reserved1 = <span class="number">0</span>;                       \</span><br><span class="line">    (param)-&gt;reserved2 = <span class="number">0</span>;                       \</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">void</span> *hbPackedDNNHandle_t;		<span class="comment">//DNNå¥æŸ„ï¼ŒæŒ‡å‘æ‰“åŒ…çš„å¤šä¸ªæ¨¡å‹ã€‚</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">void</span> *hbDNNHandle_t;			<span class="comment">//DNNå¥æŸ„ï¼ŒæŒ‡å‘å•ä¸€æ¨¡å‹ã€‚</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">void</span> *hbDNNTaskHandle_t;		<span class="comment">//ä»»åŠ¡å¥æŸ„ï¼ŒæŒ‡å‘ä¸€ä¸ªä»»åŠ¡ã€‚</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">enum</span> &#123;							<span class="comment">//å¼ é‡çš„æ’å¸ƒå½¢å¼ã€‚NHWC åˆ†åˆ«ä»£è¡¨Numberã€Heightã€Widthå’ŒChannelã€‚</span></span><br><span class="line">  HB_DNN_LAYOUT_NHWC = <span class="number">0</span>,				<span class="comment">//æ’å¸ƒå½¢å¼ä¸º NHWCã€‚</span></span><br><span class="line">  HB_DNN_LAYOUT_NCHW = <span class="number">2</span>,				<span class="comment">//æ’å¸ƒå½¢å¼ä¸º NCHWã€‚</span></span><br><span class="line">  HB_DNN_LAYOUT_NONE = <span class="number">255</span>,				<span class="comment">//æ²¡æœ‰å®šä¹‰æ’å¸ƒå½¢å¼ã€‚</span></span><br><span class="line">&#125; hbDNNTensorLayout;</span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">enum</span> &#123;							</span><br><span class="line">  HB_DNN_IMG_TYPE_Y,					<span class="comment">//	å¼ é‡ç±»å‹ä¸ºä»…æœ‰Yé€šé“çš„å›¾ç‰‡ã€‚</span></span><br><span class="line">  HB_DNN_IMG_TYPE_NV12,					<span class="comment">//å¼ é‡ç±»å‹ä¸ºä¸€å¼ NV12çš„å›¾ç‰‡ã€‚	</span></span><br><span class="line">  HB_DNN_IMG_TYPE_NV12_SEPARATE,		<span class="comment">//å¼ é‡ç±»å‹ä¸ºYé€šé“åŠUVé€šé“ä¸ºè¾“å…¥çš„å›¾ç‰‡ã€‚</span></span><br><span class="line">  HB_DNN_IMG_TYPE_YUV444,				<span class="comment">//å¼ é‡ç±»å‹ä¸ºYUV444ä¸ºè¾“å…¥çš„å›¾ç‰‡ã€‚</span></span><br><span class="line">  HB_DNN_IMG_TYPE_RGB,					<span class="comment">//	å¼ é‡ç±»å‹ä¸ºRGBä¸ºè¾“å…¥çš„å›¾ç‰‡</span></span><br><span class="line">  HB_DNN_IMG_TYPE_BGR,					<span class="comment">//å¼ é‡ç±»å‹ä¸ºBGRä¸ºè¾“å…¥çš„å›¾ç‰‡ã€‚</span></span><br><span class="line">  HB_DNN_TENSOR_TYPE_S4,</span><br><span class="line">  HB_DNN_TENSOR_TYPE_U4,</span><br><span class="line">  HB_DNN_TENSOR_TYPE_S8,</span><br><span class="line">  HB_DNN_TENSOR_TYPE_U8,</span><br><span class="line">  HB_DNN_TENSOR_TYPE_F16,</span><br><span class="line">  HB_DNN_TENSOR_TYPE_S16,</span><br><span class="line">  HB_DNN_TENSOR_TYPE_U16,</span><br><span class="line">  HB_DNN_TENSOR_TYPE_F32,</span><br><span class="line">  HB_DNN_TENSOR_TYPE_S32,</span><br><span class="line">  HB_DNN_TENSOR_TYPE_U32,</span><br><span class="line">  HB_DNN_TENSOR_TYPE_F64,</span><br><span class="line">  HB_DNN_TENSOR_TYPE_S64,</span><br><span class="line">  HB_DNN_TENSOR_TYPE_U64,</span><br><span class="line">  HB_DNN_TENSOR_TYPE_MAX				<span class="comment">//ä»£è¡¨æœ€å¤§çš„å¼ é‡ç±»å‹ç¼–å·ã€‚</span></span><br><span class="line">&#125; hbDNNDataType;						<span class="comment">//å¼ é‡çš„ç±»å‹ã€‚</span></span><br></pre></td></tr></table></figure></div>

<p><code>S</code> ä»£è¡¨æœ‰ç¬¦å·ï¼Œ <code>U</code> ä»£è¡¨æ— ç¬¦å·ï¼Œ <code>F</code> ä»£è¡¨æµ®ç‚¹å‹ï¼Œåé¢çš„æ•°å­—ä»£è¡¨bitæ•°ã€‚</p>
<p><code>HB_DNN_IMG_TYPE_NV12</code> ä¸ <code>HB_DNN_IMG_TYPE_NV12_SEPARATE</code> éƒ½ä»£è¡¨NV12çš„æ•°æ®ï¼Œåªæ˜¯åœ¨å­˜å‚¨ä¸Šæœ‰å·®å¼‚ã€‚</p>
<p>æ¨ç†NV12è¾“å…¥çš„æ¨¡å‹æ—¶ï¼Œç”¨æˆ·å¯æ ¹æ®å®é™…æƒ…å†µæ›´æ”¹å¼ é‡çš„ <code>tensorType</code> å±æ€§ä¸º <code>HB_DNN_IMG_TYPE_NV12</code> æˆ– <code>HB_DNN_IMG_TYPE_NV12_SEPARATE</code>ã€‚</p>
<div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> &#123;</span><br><span class="line">  <span class="type">int32_t</span> dimensionSize[HB_DNN_TENSOR_MAX_DIMENSIONS];			<span class="comment">//å¼ é‡æ¯ä¸ªç»´åº¦çš„å¤§å°ã€‚</span></span><br><span class="line">  <span class="type">int32_t</span> numDimensions;				<span class="comment">//å¼ é‡çš„ç»´åº¦ã€‚</span></span><br><span class="line">&#125; hbDNNTensorShape;</span><br><span class="line"><span class="comment">//ä¾‹å¦‚ä¸€å¼ 224x224çš„bgrå½©è‰²ç©ºé—´çš„å›¾ç‰‡ numDimensions=4ï¼Œè‹¥æ’å¸ƒå½¢å¼ä¸ºNHWCï¼Œ åˆ™ dimensionSize æ•°ç»„ä¸­æŒ‰é¡ºåºå­˜å‚¨å›¾ç‰‡ Number=1ã€ Height=224ã€ Width=224ã€ Channel=3ã€‚</span></span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> &#123;</span><br><span class="line">  <span class="type">int32_t</span> shiftLen;			<span class="comment">//ç§»ä½æ•°æ®çš„é•¿åº¦ã€‚</span></span><br><span class="line">  <span class="type">uint8_t</span> *shiftData;		<span class="comment">//ç§»ä½æ•°æ®çš„é¦–åœ°å€ã€‚</span></span><br><span class="line">&#125; hbDNNQuantiShift;  <span class="comment">//é‡åŒ–/åé‡åŒ–çš„ç§»ä½æ•°æ®ã€‚</span></span><br></pre></td></tr></table></figure></div>

<p><strong>å¯¹äºè¾“å…¥</strong> ï¼šè‹¥é‡‡é›†åˆ°æµ®ç‚¹æ•°æ® <code>data[i]</code>, å¯¹åº”çš„ç§»ä½æ•°æ®æ˜¯ <code>shift[i]</code>ï¼Œ åˆ™é€å…¥æ¨¡å‹çš„æ¨ç†æ•°æ®ä¸º: <img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230523145446009.png"
                      class="" title="image-20230523145446009"
                >å–æ•´ï¼›</p>
<p><strong>å¯¹äºè¾“å‡º</strong> ï¼šè‹¥æ¨ç†ç»“æœ <code>data[i]</code>, å¯¹åº”çš„ç§»ä½æ•°æ®æ˜¯ <code>shift[i]</code>ï¼Œ åˆ™æœ€ç»ˆçš„æ¨ç†ç»“æœä¸ºï¼š<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230523145458269.png"
                      class="" title="image-20230523145458269"
                >ã€‚</p>
<p>å…¶ä¸­ <code>shiftLen</code> ç”±æ•°æ® <code>data</code> æŒ‰ç…§ <code>per-axis</code> æˆ– <code>per-tensor</code> ï¼ˆåï¼‰é‡åŒ–æ–¹å¼å†³å®šã€‚ å½“æ•°æ® <code>data</code> æŒ‰ <code>per-tensor</code> ï¼ˆåï¼‰é‡åŒ–æ—¶ï¼Œ <code>shiftLen</code> ç­‰äº <code>1</code>ï¼Œæ­¤æ—¶ä¸éœ€è¦å…³æ³¨ <code>quantizeAxis</code> æ•°å€¼ï¼› å¦åˆ™ç­‰äºæ•°æ® <code>data</code> çš„ç¬¬ <code>quantizeAxis</code> ç»´åº¦å¤§å°ã€‚</p>
<div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> &#123;</span><br><span class="line">  <span class="type">int32_t</span> scaleLen;			<span class="comment">//ç¼©æ”¾æ•°æ®çš„é•¿åº¦ã€‚</span></span><br><span class="line">  <span class="type">float</span> *scaleData;			<span class="comment">//ç¼©æ”¾æ•°æ®çš„é¦–åœ°å€ã€‚</span></span><br><span class="line">  <span class="type">int32_t</span> zeroPointLen;		<span class="comment">//é›¶ç‚¹åç§»æ•°æ®çš„é•¿åº¦ã€‚</span></span><br><span class="line">  <span class="type">int8_t</span> *zeroPointData;	<span class="comment">//é›¶ç‚¹åç§»æ•°æ®çš„é¦–åœ°å€ã€‚</span></span><br><span class="line">&#125; hbDNNQuantiScale;		<span class="comment">//é‡åŒ–/åé‡åŒ–çš„ç¼©æ”¾æ•°æ®ã€‚</span></span><br></pre></td></tr></table></figure></div>

<p><strong>å¯¹äºè¾“å…¥</strong> ï¼šè‹¥é‡‡é›†åˆ°æµ®ç‚¹æ•°æ® <code>data[i]</code>, å¯¹åº”çš„ç¼©æ”¾æ•°æ®æ˜¯ <code>scale[i]</code>ï¼Œ é›¶ç‚¹åç§»æ•°æ®æ˜¯ <code>zeroPoint[i]</code>ï¼Œåˆ™é€å…¥æ¨¡å‹çš„æ¨ç†æ•°æ®ä¸º: <img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/J5/image-20230523145847126.png"
                      alt="image-20230523145847126"
                >, å…¶ä¸­ï¼š<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/J5/image-20230523145906154.png"
                      alt="image-20230523145906154"
                >, ä½¿ç”¨fesetround(FE_TONEAREST)èˆå…¥æ–¹æ³•, æˆªæ–­åˆ°ï¼š<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/J5/image-20230523145919210.png"
                      alt="image-20230523145919210"
                ></p>
<p><strong>å¯¹äºè¾“å‡º</strong> ï¼šè‹¥æ¨ç†ç»“æœ <code>data[i]</code>, å¯¹åº”çš„ç¼©æ”¾æ•°æ®æ˜¯ <code>scale[i]</code>ï¼Œ é›¶ç‚¹åç§»æ•°æ®æ˜¯ <code>zeroPoint[i]</code>ï¼Œåˆ™æœ€ç»ˆçš„æ¨ç†ç»“æœä¸ºï¼š <img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230523145932256.png"
                      class="" title="image-20230523145932256"
                >ã€‚</p>
<p>å…¶ä¸­ <code>scaleLen</code> ç”±æ•°æ® <code>data</code> æŒ‰ç…§ <code>per-axis</code> æˆ– <code>per-tensor</code> ï¼ˆåï¼‰é‡åŒ–æ–¹å¼å†³å®šã€‚ å½“æ•°æ® <code>data</code> æŒ‰ <code>per-tensor</code> ï¼ˆåï¼‰é‡åŒ–æ—¶ï¼Œ <code>scaleLen</code> ç­‰äº <code>1</code>ï¼Œæ­¤æ—¶ä¸éœ€è¦å…³æ³¨ <code>quantizeAxis</code> æ•°å€¼ï¼› å¦åˆ™ç­‰äºæ•°æ® <code>data</code> ç¬¬ <code>quantizeAxis</code> ç»´åº¦å¤§å°ã€‚ <code>zeroPointLen</code> ä¸ <code>scaleLen</code> ä¿æŒä¸€è‡´ã€‚</p>
<div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">enum</span> &#123;</span><br><span class="line">  NONE,					<span class="comment">//NONE ä»£è¡¨ä¸éœ€è¦å¯¹æ•°æ®åšä»»ä½•å¤„ç†ï¼›</span></span><br><span class="line">  SHIFT,				<span class="comment">//SHIFT ç±»å‹å¯¹åº”çš„é‡åŒ–/åé‡åŒ–å‚æ•°å­˜å‚¨åœ¨ hbDNNQuantiShift ç»“æ„ä½“ä¸­ï¼›</span></span><br><span class="line">  SCALE,				<span class="comment">//SCALE å¯¹åº”çš„é‡åŒ–/åé‡åŒ–å‚æ•°å­˜å‚¨åœ¨ hbDNNQuantiScale ç»“æ„ä½“ä¸­ã€‚</span></span><br><span class="line">&#125; hbDNNQuantiType;		<span class="comment">//å®šç‚¹æµ®ç‚¹è½¬æ¢çš„é‡åŒ–/åé‡åŒ–ç±»å‹ã€‚</span></span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> &#123;</span><br><span class="line">  hbDNNTensorShape validShape;			<span class="comment">//å¼ é‡æœ‰æ•ˆå†…å®¹çš„å½¢çŠ¶ã€‚</span></span><br><span class="line">  hbDNNTensorShape alignedShape;		<span class="comment">//å¼ é‡å¯¹é½å†…å®¹çš„å½¢çŠ¶ã€‚</span></span><br><span class="line">  <span class="type">int32_t</span> tensorLayout;					<span class="comment">//å¼ é‡çš„æ’å¸ƒå½¢å¼</span></span><br><span class="line">  <span class="type">int32_t</span> tensorType;					<span class="comment">//å¼ é‡çš„ç±»å‹</span></span><br><span class="line">  hbDNNQuantiShift shift;				<span class="comment">//é‡åŒ–åç§»é‡ã€‚</span></span><br><span class="line">  hbDNNQuantiScale scale;				<span class="comment">//é‡åŒ–ç¼©æ”¾é‡ã€‚</span></span><br><span class="line">  hbDNNQuantiType quantiType;			<span class="comment">//é‡åŒ–ç±»å‹ã€‚</span></span><br><span class="line">  <span class="type">int32_t</span> quantizeAxis;					<span class="comment">//é‡åŒ–é€šé“ï¼Œä»…æŒ‰per-axisé‡åŒ–æ—¶ç”Ÿæ•ˆã€‚</span></span><br><span class="line">  <span class="type">int32_t</span> alignedByteSize;				<span class="comment">//å¼ é‡å¯¹é½å†…å®¹çš„å†…å­˜å¤§å°ã€‚</span></span><br><span class="line">  <span class="type">int32_t</span> stride[HB_DNN_TENSOR_MAX_DIMENSIONS];		<span class="comment">//å¼ é‡ä¸­validShapeå„ç»´åº¦æ­¥é•¿ã€‚</span></span><br><span class="line">&#125; hbDNNTensorProperties;				<span class="comment">//å¼ é‡çš„ä¿¡æ¯ã€‚</span></span><br></pre></td></tr></table></figure></div>





<h4 id="APIæ¥å£"><a href="#APIæ¥å£" class="headerlink" title="APIæ¥å£"></a>APIæ¥å£</h4><blockquote>
<p><strong>DNNå¥æŸ„æŒ‡é’ˆæ˜¯æŒ‡ä¸€ä¸ªæŒ‡é’ˆå˜é‡ï¼Œå®ƒå¯ä»¥ç”¨äºè®¿é—®åœ¨ç¥ç»ç½‘ç»œæ¨ç†è¿‡ç¨‹ä¸­çš„å„ä¸ªé˜¶æ®µåˆ›å»ºçš„æ•°æ®ç»“æ„ã€‚</strong>è¿™äº›æ•°æ®ç»“æ„é€šå¸¸ç”±å¯åŠ¨å™¨ï¼ˆlauncherï¼‰å’Œè¿è¡Œæ—¶ï¼ˆruntimeï¼‰ç»„æˆï¼Œé€šè¿‡DNNå¥æŸ„æŒ‡é’ˆå¯ä»¥åœ¨å¯åŠ¨å™¨å’Œè¿è¡Œæ—¶ä¹‹é—´å…±äº«æ•°æ®ã€‚DNNå¥æŸ„æŒ‡é’ˆé€šå¸¸è¢«ç”¨äºï¼š</p>
<ol>
<li>ç¥ç»ç½‘ç»œæ¨¡å‹çš„åˆå§‹åŒ–ï¼šDNNå¥æŸ„æŒ‡é’ˆå¯ä»¥ç”¨äºåˆå§‹åŒ–ç¥ç»ç½‘ç»œçš„æ¨¡å‹ï¼ŒåŒ…æ‹¬ç½‘ç»œä¸­çš„å„ç§å±‚å’ŒèŠ‚ç‚¹ï¼Œä»¥åŠä¸å„ç§ç¡¬ä»¶çš„è¿æ¥ï¼›</li>
<li>ç¥ç»ç½‘ç»œæ¨¡å‹çš„é…ç½®ï¼šDNNå¥æŸ„æŒ‡é’ˆå¯ä»¥ç”¨äºé…ç½®ç¥ç»ç½‘ç»œï¼ŒåŒ…æ‹¬è®¾ç½®æ¨¡å‹çš„è¾“å…¥å’Œè¾“å‡ºå°ºå¯¸ã€æ•°æ®ç±»å‹åŠå¤„ç†æ–¹æ³•ï¼›</li>
<li>ç¥ç»ç½‘ç»œæ¨ç†çš„æ‰§è¡Œï¼šDNNå¥æŸ„æŒ‡é’ˆå¯ä»¥ç”¨äºåœ¨è¿è¡Œæ—¶ä¸­æ‰§è¡Œç¥ç»ç½‘ç»œæ¨ç†æ“ä½œï¼ŒåŒ…æ‹¬åŠ è½½æ¨¡å‹ã€è¿›è¡Œæ¨ç†è®¡ç®—å’Œè·å–è®¡ç®—ç»“æœã€‚</li>
</ol>
</blockquote>
<h6 id="ç‰ˆæœ¬ä¿¡æ¯"><a href="#ç‰ˆæœ¬ä¿¡æ¯" class="headerlink" title="ç‰ˆæœ¬ä¿¡æ¯"></a>ç‰ˆæœ¬ä¿¡æ¯</h6><blockquote>
<p>hbDNNGetVersion()</p>
</blockquote>
<div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">const</span> <span class="type">char</span> *<span class="title">hbDNNGetVersion</span><span class="params">()</span></span>;		<span class="comment">//è·å– `DNN` é¢„æµ‹åº“ç‰ˆæœ¬ä¿¡æ¯ã€‚</span></span><br></pre></td></tr></table></figure></div>



<h6 id="æ¨¡å‹åŠ è½½-x2F-é‡Šæ”¾"><a href="#æ¨¡å‹åŠ è½½-x2F-é‡Šæ”¾" class="headerlink" title="æ¨¡å‹åŠ è½½&#x2F;é‡Šæ”¾"></a>æ¨¡å‹åŠ è½½&#x2F;é‡Šæ”¾</h6><div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int32_t</span> <span class="title">hbDNNInitializeFromFiles</span><span class="params">(hbPackedDNNHandle_t *packedDNNHandle,		<span class="comment">//ä»æ–‡ä»¶å®Œæˆå¯¹ packedDNNHandle çš„åˆ›å»ºå’Œåˆå§‹åŒ–ã€‚è°ƒç”¨æ–¹å¯ä»¥è·¨å‡½æ•°ã€è·¨çº¿ç¨‹ä½¿ç”¨è¿”å›çš„ packedDNNHandleã€‚		[out] packedDNNHandle Horizon DNNå¥æŸ„ï¼ŒæŒ‡å‘å¤šä¸ªæ¨¡å‹ã€‚</span></span></span></span><br><span class="line"><span class="params"><span class="function">                                 <span class="type">const</span> <span class="type">char</span> **modelFileNames,		<span class="comment">//[in] modelFileNames æ¨¡å‹æ–‡ä»¶çš„è·¯å¾„ã€‚</span></span></span></span><br><span class="line"><span class="params"><span class="function">                                 <span class="type">int32_t</span> modelFileCount)</span></span>;			<span class="comment">//[in] modelFileCount æ¨¡å‹æ–‡ä»¶çš„ä¸ªæ•°ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int32_t</span> <span class="title">hbDNNInitializeFromDDR</span><span class="params">(hbPackedDNNHandle_t *packedDNNHandle,	<span class="comment">//ä»å†…å­˜å®Œæˆå¯¹ packedDNNHandle çš„åˆ›å»ºå’Œåˆå§‹åŒ–ã€‚è°ƒç”¨æ–¹å¯ä»¥è·¨å‡½æ•°ã€è·¨çº¿ç¨‹ä½¿ç”¨è¿”å›çš„ packedDNNHandleã€‚	[out] packedDNNHandle Horizon DNNå¥æŸ„ï¼ŒæŒ‡å‘å¤šä¸ªæ¨¡å‹ã€‚</span></span></span></span><br><span class="line"><span class="params"><span class="function">                               <span class="type">const</span> <span class="type">void</span> **modelData,			<span class="comment">//[in] modelData æ¨¡å‹æ–‡ä»¶çš„æŒ‡é’ˆã€‚</span></span></span></span><br><span class="line"><span class="params"><span class="function">                               <span class="type">int32_t</span> *modelDataLengths,		<span class="comment">//[in] modelDataLengths æ¨¡å‹æ•°æ®çš„é•¿åº¦ã€‚</span></span></span></span><br><span class="line"><span class="params"><span class="function">                               <span class="type">int32_t</span> modelDataCount)</span></span>;			<span class="comment">//[in] modelDataCount æ¨¡å‹æ•°æ®çš„ä¸ªæ•°ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int32_t</span> <span class="title">hbDNNRelease</span><span class="params">(hbPackedDNNHandle_t packedDNNHandle)</span></span>;		<span class="comment">//å°† packedDNNHandle æ‰€æŒ‡å‘çš„æ¨¡å‹é‡Šæ”¾ã€‚	[in] packedDNNHandle Horizon DNNå¥æŸ„ï¼ŒæŒ‡å‘å¤šä¸ªæ¨¡å‹ã€‚</span></span><br></pre></td></tr></table></figure></div>



<blockquote>
<p>æ¨¡å‹ä¿¡æ¯</p>
</blockquote>
<div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int32_t</span> <span class="title">hbDNNGetModelNameList</span><span class="params">(<span class="type">const</span> <span class="type">char</span> ***modelNameList,			<span class="comment">//è·å– packedDNNHandle æ‰€æŒ‡å‘æ¨¡å‹çš„åç§°åˆ—è¡¨å’Œä¸ªæ•°ã€‚		[out] modelNameList æ¨¡å‹åç§°åˆ—è¡¨ã€‚</span></span></span></span><br><span class="line"><span class="params"><span class="function">                              <span class="type">int32_t</span> *modelNameCount,				<span class="comment">//[out] modelNameCount æ¨¡å‹åç§°ä¸ªæ•°ã€‚</span></span></span></span><br><span class="line"><span class="params"><span class="function">                              hbPackedDNNHandle_t packedDNNHandle)</span></span>;		<span class="comment">//[in] packedDNNHandle Horizon DNNå¥æŸ„ï¼ŒæŒ‡å‘å¤šä¸ªæ¨¡å‹ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int32_t</span> <span class="title">hbDNNGetModelHandle</span><span class="params">(hbDNNHandle_t *dnnHandle,			<span class="comment">//ä» packedDNNHandle æ‰€æŒ‡å‘æ¨¡å‹åˆ—è¡¨ä¸­è·å–ä¸€ä¸ªæ¨¡å‹çš„å¥æŸ„ã€‚è°ƒç”¨æ–¹å¯ä»¥è·¨å‡½æ•°ã€è·¨çº¿ç¨‹ä½¿ç”¨è¿”å›çš„ dnnHandleã€‚	[out] dnnHandle DNNå¥æŸ„ï¼ŒæŒ‡å‘ä¸€ä¸ªæ¨¡å‹ã€‚</span></span></span></span><br><span class="line"><span class="params"><span class="function">                            hbPackedDNNHandle_t packedDNNHandle,		<span class="comment">//[in] packedDNNHandle DNNå¥æŸ„ï¼ŒæŒ‡å‘å¤šä¸ªæ¨¡å‹ã€‚</span></span></span></span><br><span class="line"><span class="params"><span class="function">                            <span class="type">const</span> <span class="type">char</span> *modelName)</span></span>;		<span class="comment">//[in] modelName æ¨¡å‹åç§°ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int32_t</span> <span class="title">hbDNNGetInputCount</span><span class="params">(<span class="type">int32_t</span> *inputCount,			<span class="comment">//è·å– dnnHandle æ‰€æŒ‡å‘æ¨¡å‹è¾“å…¥å¼ é‡çš„ä¸ªæ•°ã€‚ [out] inputCount æ¨¡å‹è¾“å…¥å¼ é‡çš„ä¸ªæ•°ã€‚</span></span></span></span><br><span class="line"><span class="params"><span class="function">                           hbDNNHandle_t dnnHandle)</span></span>;	<span class="comment">//[in] dnnHandle DNNå¥æŸ„ï¼ŒæŒ‡å‘ä¸€ä¸ªæ¨¡å‹ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int32_t</span> <span class="title">hbDNNGetInputName</span><span class="params">(<span class="type">const</span> <span class="type">char</span> **name,			<span class="comment">//è·å– dnnHandle æ‰€æŒ‡å‘æ¨¡å‹è¾“å…¥å¼ é‡çš„åç§°ã€‚ [out] name æ¨¡å‹è¾“å…¥å¼ é‡çš„åç§°ã€‚</span></span></span></span><br><span class="line"><span class="params"><span class="function">                          hbDNNHandle_t dnnHandle,		<span class="comment">//[in] dnnHandle DNNå¥æŸ„ï¼ŒæŒ‡å‘ä¸€ä¸ªæ¨¡å‹ã€‚</span></span></span></span><br><span class="line"><span class="params"><span class="function">                          <span class="type">int32_t</span> inputIndex)</span></span>;			<span class="comment">//[in] inputIndex æ¨¡å‹è¾“å…¥å¼ é‡çš„ç¼–å·ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int32_t</span> <span class="title">hbDNNGetInputTensorProperties</span><span class="params">(hbDNNTensorProperties *properties,		<span class="comment">//è·å– dnnHandle æ‰€æŒ‡å‘æ¨¡å‹ç‰¹å®šè¾“å…¥å¼ é‡çš„å±æ€§ã€‚ [out] properties è¾“å…¥å¼ é‡çš„ä¿¡æ¯ã€‚</span></span></span></span><br><span class="line"><span class="params"><span class="function">                                      hbDNNHandle_t dnnHandle,	<span class="comment">//[in] dnnHandle DNNå¥æŸ„ï¼ŒæŒ‡å‘ä¸€ä¸ªæ¨¡å‹ã€‚</span></span></span></span><br><span class="line"><span class="params"><span class="function">                                      <span class="type">int32_t</span> inputIndex)</span></span>;		<span class="comment">//[in] inputIndex æ¨¡å‹è¾“å…¥å¼ é‡çš„ç¼–å·ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int32_t</span> <span class="title">hbDNNGetOutputCount</span><span class="params">(<span class="type">int32_t</span> *outputCount,		<span class="comment">//è·å– dnnHandle æ‰€æŒ‡å‘æ¨¡å‹è¾“å‡ºå¼ é‡çš„ä¸ªæ•°ã€‚[out] outputCount æ¨¡å‹è¾“å‡ºå¼ é‡çš„ä¸ªæ•°ã€‚	</span></span></span></span><br><span class="line"><span class="params"><span class="function">                            hbDNNHandle_t dnnHandle)</span></span>;		<span class="comment">//[in] dnnHandle DNNå¥æŸ„ï¼ŒæŒ‡å‘ä¸€ä¸ªæ¨¡å‹ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int32_t</span> <span class="title">hbDNNGetOutputName</span><span class="params">(<span class="type">const</span> <span class="type">char</span> **name,		<span class="comment">//è·å– dnnHandle æ‰€æŒ‡å‘æ¨¡å‹è¾“å‡ºå¼ é‡çš„åç§°ã€‚ [out] name æ¨¡å‹è¾“å‡ºå¼ é‡çš„åç§°ã€‚</span></span></span></span><br><span class="line"><span class="params"><span class="function">                           hbDNNHandle_t dnnHandle,		<span class="comment">//[in] dnnHandle DNNå¥æŸ„ï¼ŒæŒ‡å‘ä¸€ä¸ªæ¨¡å‹ã€‚</span></span></span></span><br><span class="line"><span class="params"><span class="function">                           <span class="type">int32_t</span> outputIndex)</span></span>;		<span class="comment">//[in] outputIndex æ¨¡å‹è¾“å‡ºå¼ é‡çš„ç¼–å·ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int32_t</span> <span class="title">hbDNNGetOutputTensorProperties</span><span class="params">(hbDNNTensorProperties *properties,		<span class="comment">//è·å– dnnHandle æ‰€æŒ‡å‘æ¨¡å‹ç‰¹å®šè¾“å‡ºå¼ é‡çš„å±æ€§ã€‚[out] properties è¾“å‡ºå¼ é‡çš„ä¿¡æ¯ã€‚</span></span></span></span><br><span class="line"><span class="params"><span class="function">                                       hbDNNHandle_t dnnHandle,	<span class="comment">//[in] dnnHandle DNNå¥æŸ„ï¼ŒæŒ‡å‘ä¸€ä¸ªæ¨¡å‹ã€‚</span></span></span></span><br><span class="line"><span class="params"><span class="function">                                       <span class="type">int32_t</span> outputIndex)</span></span>;		<span class="comment">//[in] outputIndex æ¨¡å‹è¾“å‡ºå¼ é‡çš„ç¼–å·ã€‚</span></span><br></pre></td></tr></table></figure></div>



<h6 id="æ¨¡å‹æ¨ç†"><a href="#æ¨¡å‹æ¨ç†" class="headerlink" title="æ¨¡å‹æ¨ç†"></a>æ¨¡å‹æ¨ç†</h6><div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int32_t</span> <span class="title">hbDNNInfer</span><span class="params">(hbDNNTaskHandle_t *taskHandle,	<span class="comment">//æ ¹æ®è¾“å…¥å‚æ•°æ‰§è¡Œæ¨ç†ä»»åŠ¡ã€‚è°ƒç”¨æ–¹å¯ä»¥è·¨å‡½æ•°ã€è·¨çº¿ç¨‹ä½¿ç”¨è¿”å›çš„ taskHandleã€‚[out] taskHandle ä»»åŠ¡å¥æŸ„æŒ‡é’ˆã€‚</span></span></span></span><br><span class="line"><span class="params"><span class="function">                   hbDNNTensor **output,	<span class="comment">//[in/out] output æ¨ç†ä»»åŠ¡çš„è¾“å‡ºã€‚</span></span></span></span><br><span class="line"><span class="params"><span class="function">                   <span class="type">const</span> hbDNNTensor *input,	<span class="comment">//[in] input æ¨ç†ä»»åŠ¡çš„è¾“å…¥ã€‚</span></span></span></span><br><span class="line"><span class="params"><span class="function">                   hbDNNHandle_t dnnHandle,		<span class="comment">//[in] dnnHandle DNNå¥æŸ„æŒ‡é’ˆã€‚</span></span></span></span><br><span class="line"><span class="params"><span class="function">                   hbDNNInferCtrlParam *inferCtrlParam)</span></span>;		<span class="comment">//[in] inferCtrlParam æ§åˆ¶æ¨ç†ä»»åŠ¡çš„å‚æ•°ã€‚</span></span><br></pre></td></tr></table></figure></div>

<p>æ³¨æ„ï¼š</p>
<blockquote>
<p>ä½¿ç”¨è¯¥æ¥å£æäº¤ä»»åŠ¡æ—¶åº”æå‰å°† <code>taskHandle</code> ç½®ä¸º <code>nullptr</code>ï¼Œé™¤éæ˜¯ç»™æŒ‡å®š <code>taskHandle</code> è¿½åŠ ä»»åŠ¡ï¼ˆå³ä½¿ç”¨ <code>inferCtrlParam::more</code> åŠŸèƒ½ï¼‰ã€‚</p>
<p>æœ€å¤šæ”¯æŒåŒæ—¶å­˜åœ¨32ä¸ªæ¨¡å‹ä»»åŠ¡ã€‚</p>
<p>å¯¹äºbatchæ¨¡å‹ï¼Œå…è®¸åˆ†å¼€è®¾ç½®è¾“å…¥å¼ é‡çš„å†…å­˜åœ°å€ã€‚ä¾‹å¦‚ï¼šæ¨¡å‹çš„è¾“å…¥validShape&#x2F;alignedShapeä¸º[4, 3, 224, 224], å¯ä»¥ç”³è¯·å››ä¸ªhbDNNTensorï¼Œ æ¯ä¸ªhbDNNTensorçš„validShape&#x2F;alignedShapeéƒ½è®¾ç½®ä¸º[1, 3, 224, 224],å­˜æ”¾æ¯ä¸ªbatchçš„æ•°æ®ã€‚å½“æ¨¡å‹æœ‰å¤šä¸ªè¾“å…¥æ—¶ï¼Œ <code>input</code> çš„é¡ºåºåº”ä¸ºinput0[batch0], input0[batch1], â€¦, inputn[batch0], inputn[batch1], â€¦ã€‚</p>
</blockquote>
<div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æ ¹æ®è¾“å…¥å‚æ•°æ‰§è¡ŒROIæ¨ç†ä»»åŠ¡ã€‚è°ƒç”¨æ–¹å¯ä»¥è·¨å‡½æ•°ã€è·¨çº¿ç¨‹ä½¿ç”¨è¿”å›çš„ taskHandleã€‚</span></span><br><span class="line"><span class="function"><span class="type">int32_t</span> <span class="title">hbDNNRoiInfer</span><span class="params">(hbDNNTaskHandle_t *taskHandle,		<span class="comment">//[out] taskHandle ä»»åŠ¡å¥æŸ„æŒ‡é’ˆã€‚</span></span></span></span><br><span class="line"><span class="params"><span class="function">                      hbDNNTensor **output,					<span class="comment">//[in/out] output æ¨ç†ä»»åŠ¡çš„è¾“å‡ºã€‚</span></span></span></span><br><span class="line"><span class="params"><span class="function">                      <span class="type">const</span> hbDNNTensor *input,				<span class="comment">//[in] input æ¨ç†ä»»åŠ¡çš„è¾“å…¥ã€‚</span></span></span></span><br><span class="line"><span class="params"><span class="function">                      hbDNNRoi *rois,						<span class="comment">//[in] rois Roiæ¡†ä¿¡æ¯ã€‚</span></span></span></span><br><span class="line"><span class="params"><span class="function">                      <span class="type">int32_t</span> roiCount,						<span class="comment">//[in] roiCount Roiæ¡†æ•°é‡ã€‚</span></span></span></span><br><span class="line"><span class="params"><span class="function">                      hbDNNHandle_t dnnHandle,				<span class="comment">//[in] dnnHandle dnnå¥æŸ„æŒ‡é’ˆã€‚</span></span></span></span><br><span class="line"><span class="params"><span class="function">                      hbDNNInferCtrlParam *inferCtrlParam)</span></span>;		<span class="comment">//[in] inferCtrlParam æ§åˆ¶æ¨ç†ä»»åŠ¡çš„å‚æ•°ã€‚</span></span><br></pre></td></tr></table></figure></div>

<blockquote>
<p>è¯¥æ¥å£æ”¯æŒæ‰¹å¤„ç†æ“ä½œï¼Œå‡è®¾éœ€è¦æ¨ç†çš„æ•°æ®æ‰¹æ•°ä¸º <code>batch</code>ï¼Œæ¨¡å‹è¾“å…¥ä¸ªæ•°ä¸º <code>input_count</code>ï¼Œå…¶ä¸­resizerè¾“å…¥æºçš„æ•°é‡ä¸º <code>resizer_count</code>ã€‚</p>
<p>å‡†å¤‡è¾“å…¥å‚æ•° <code>input</code>ï¼šç¬¬iä¸ª <code>batch</code> å¯¹åº”çš„ <code>input</code> æ•°ç»„ä¸‹æ ‡èŒƒå›´æ˜¯<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230523154854692.png"
                      class="" title="image-20230523154854692"
                ></p>
<p>å‡†å¤‡è¾“å…¥å‚æ•° <code>rois</code>ï¼šæ¯ä¸ªresizerè¾“å…¥æºçš„è¾“å…¥éƒ½åº”åŒ¹é…ä¸€ä¸ªroiï¼Œç¬¬iä¸ª <code>batch</code> å¯¹åº”çš„ <code>rois</code> æ•°ç»„ä¸‹æ ‡èŒƒå›´æ˜¯ <img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/J5/image-20230523154924792.png"
                      alt="image-20230523154924792"
                ><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/J5/image-20230523154943236.png"
                      alt="image-20230523154943236"
                >; æ¯ä¸ªbatchçš„roié¡ºåºåº”å’Œè¾“å…¥çš„é¡ºåºä¿æŒä¸€è‡´ï¼›</p>
<p>å…³äº <code>batch</code> æ•°é‡é™åˆ¶ï¼šå…¶èŒƒå›´åº”è¯¥åœ¨[1, 255];</p>
<p>ä½¿ç”¨è¯¥æ¥å£æäº¤ä»»åŠ¡æ—¶åº”æå‰å°† <code>taskHandle</code> ç½®ä¸º <code>nullptr</code>ï¼Œé™¤éæ˜¯ç»™æŒ‡å®š <code>taskHandle</code> è¿½åŠ ä»»åŠ¡ï¼ˆå³ä½¿ç”¨ <code>inferCtrlParam::more</code> åŠŸèƒ½ï¼‰ã€‚</p>
<p>æœ€å¤šæ”¯æŒåŒæ—¶å­˜åœ¨32ä¸ªæ¨¡å‹ä»»åŠ¡ã€‚</p>
</blockquote>
<div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ç­‰å¾…ä»»åŠ¡å®Œæˆæˆ–è¶…æ—¶ã€‚</span></span><br><span class="line"><span class="function"><span class="type">int32_t</span> <span class="title">hbDNNWaitTaskDone</span><span class="params">(hbDNNTaskHandle_t taskHandle,		<span class="comment">//[in] taskHandle ä»»åŠ¡å¥æŸ„æŒ‡é’ˆã€‚</span></span></span></span><br><span class="line"><span class="params"><span class="function">                          <span class="type">int32_t</span> timeout)</span></span>;					<span class="comment">//[in] timeout è¶…æ—¶é…ç½®ï¼ˆå•ä½ï¼šæ¯«ç§’ï¼‰ã€‚timeout &gt; 0 è¡¨ç¤ºç­‰å¾…æ—¶é—´ï¼›timeout &lt;= 0 è¡¨ç¤ºä¸€ç›´ç­‰å¾…ï¼Œç›´åˆ°ä»»åŠ¡å®Œæˆã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//é‡Šæ”¾ä»»åŠ¡ï¼Œå¦‚æœä»»åŠ¡æœªæ‰§è¡Œåˆ™ä¼šç›´æ¥å–æ¶ˆå¹¶é‡Šæ”¾ä»»åŠ¡ï¼Œå¦‚æœå·²ç»æ‰§è¡Œåˆ™ä¼šåœ¨è¿è¡Œåˆ°æŸäº›èŠ‚ç‚¹åå–æ¶ˆå¹¶é‡Šæ”¾ä»»åŠ¡ã€‚</span></span><br><span class="line"><span class="function"><span class="type">int32_t</span> <span class="title">hbDNNReleaseTask</span><span class="params">(hbDNNTaskHandle_t taskHandle)</span></span>;		<span class="comment">//[in] taskHandle ä»»åŠ¡å¥æŸ„æŒ‡é’ˆã€‚</span></span><br></pre></td></tr></table></figure></div>



<h6 id="å†…å­˜æ“ä½œ"><a href="#å†…å­˜æ“ä½œ" class="headerlink" title="å†…å­˜æ“ä½œ"></a>å†…å­˜æ“ä½œ</h6><div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ç”³è¯·BPUå†…å­˜ã€‚</span></span><br><span class="line"><span class="function"><span class="type">int32_t</span> <span class="title">hbSysAllocMem</span><span class="params">(hbSysMem *mem, <span class="type">uint32_t</span> size)</span></span>;		<span class="comment">//[in] size ç”³è¯·å†…å­˜çš„å¤§å°ã€‚[out] mem å†…å­˜æŒ‡é’ˆã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//ç”³è¯·ç¼“å­˜çš„BPUå†…å­˜ã€‚</span></span><br><span class="line"><span class="function"><span class="type">int32_t</span> <span class="title">hbSysAllocCachedMem</span><span class="params">(hbSysMem *mem, <span class="type">uint32_t</span> size)</span></span>;		<span class="comment">//[in] size ç”³è¯·å†…å­˜çš„å¤§å°ã€‚[out] mem å†…å­˜æŒ‡é’ˆã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//å¯¹ç¼“å­˜çš„BPUå†…å­˜è¿›è¡Œåˆ·æ–°ã€‚</span></span><br><span class="line"><span class="function"><span class="type">int32_t</span> <span class="title">hbSysFlushMem</span><span class="params">(hbSysMem *mem, <span class="type">int32_t</span> flag)</span></span>;		<span class="comment">//[in] mem å†…å­˜æŒ‡é’ˆã€‚[in] flag åˆ·æ–°æ ‡å¿—ç¬¦ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//é‡Šæ”¾BPUå†…å­˜ã€‚</span></span><br><span class="line"><span class="function"><span class="type">int32_t</span> <span class="title">hbSysFreeMem</span><span class="params">(hbSysMem *mem)</span></span>;		<span class="comment">//[in] mem å†…å­˜æŒ‡é’ˆã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//å†™å…¥BPUå†…å­˜ã€‚</span></span><br><span class="line"><span class="function"><span class="type">int32_t</span> <span class="title">hbSysWriteMem</span><span class="params">(hbSysMem *dest, <span class="type">char</span> *src, <span class="type">uint32_t</span> size)</span></span>;		<span class="comment">//[out] dest å†…å­˜æŒ‡é’ˆã€‚[in] src æ•°æ®æŒ‡é’ˆã€‚[in] size æ•°æ®å¤§å°ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//è¯»å–BPUå†…å­˜ã€‚</span></span><br><span class="line"><span class="function"><span class="type">int32_t</span> <span class="title">hbSysReadMem</span><span class="params">(<span class="type">char</span> *dest, hbSysMem *src, <span class="type">uint32_t</span> size)</span></span>;		<span class="comment">//[out] dest æ•°æ®æŒ‡é’ˆã€‚[in] src å†…å­˜æŒ‡é’ˆã€‚[in] size æ•°æ®å¤§å°ã€‚</span></span><br></pre></td></tr></table></figure></div>



<h6 id="æ’ä»¶"><a href="#æ’ä»¶" class="headerlink" title="æ’ä»¶"></a>æ’ä»¶</h6><div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æ³¨å†ŒLayeråˆ›å»ºæ–¹æ³•ã€‚</span></span><br><span class="line"><span class="function"><span class="type">int32_t</span> <span class="title">hbDNNRegisterLayerCreator</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *layerType,		<span class="comment">//[in] layerType Layerç±»å‹ã€‚</span></span></span></span><br><span class="line"><span class="params"><span class="function">                                  hbDNNLayerCreator layerCreator)</span></span>;		<span class="comment">//[in] layerCreator Layeråˆ›å»ºæ–¹æ³•ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//æ³¨é”€Layerã€‚</span></span><br><span class="line"><span class="function"><span class="type">int32_t</span> <span class="title">hbDNNUnregisterLayerCreator</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *layerType)</span></span>;		<span class="comment">//[in] layerType Layerç±»å‹ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//æ³¨å†Œä¸€ä¸ªä»»åŠ¡å®Œæˆåéœ€è¦æ‰§è¡Œçš„å›è°ƒå‡½æ•°ã€‚</span></span><br><span class="line"><span class="function"><span class="type">int32_t</span> <span class="title">hbDNNSetTaskDoneCb</span><span class="params">(hbDNNTaskHandle_t taskHandle, hbDNNTaskDoneCb cb,		<span class="comment">//[in] taskHandle ä»»åŠ¡å¥æŸ„æŒ‡é’ˆã€‚[in] cb å›è°ƒå‡½æ•°æŒ‡é’ˆã€‚[in] userData ç”¨æˆ·è‡ªå®šä¹‰çš„æ•°æ®ã€‚</span></span></span></span><br><span class="line"><span class="params"><span class="function">                       <span class="type">void</span> *userdata)</span></span>;</span><br></pre></td></tr></table></figure></div>

<p><strong>è¯¥æ¥å£å¯ä»¥æ³¨å†Œä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œä»»åŠ¡æ‰§è¡Œå®Œæˆåä¼šè°ƒç”¨è¿™ä¸ªå›è°ƒå‡½æ•°å»æ‰§è¡Œç”¨æˆ·è‡ªå®šä¹‰çš„åŠŸèƒ½ã€‚</strong></p>
<h4 id="æ•°æ®æ’å¸ƒåŠå¯¹é½è§„åˆ™"><a href="#æ•°æ®æ’å¸ƒåŠå¯¹é½è§„åˆ™" class="headerlink" title="æ•°æ®æ’å¸ƒåŠå¯¹é½è§„åˆ™"></a>æ•°æ®æ’å¸ƒåŠå¯¹é½è§„åˆ™</h4><h5 id="æ•°æ®æ’å¸ƒ"><a href="#æ•°æ®æ’å¸ƒ" class="headerlink" title="æ•°æ®æ’å¸ƒ"></a>æ•°æ®æ’å¸ƒ</h5><p><strong>ç¡¬ä»¶å†…éƒ¨ä¸ºäº†æé«˜è®¡ç®—æ•ˆç‡ï¼Œå…¶æ•°æ®ä½¿ç”¨ç‰¹æ®Šçš„æ’å¸ƒæ–¹å¼ä»¥ä½¿å¾—å·ç§¯è¿ç®—ä¸­åŒä¸€æ‰¹æ¬¡ä¹˜åŠ ç”¨åˆ°çš„feature mapå’Œkernelåœ¨å†…å­˜ä¸­ç›¸é‚»æ’æ”¾ã€‚</strong> ä¸‹é¢ç®€è¦ä»‹ç»J5ä¸­æ•°æ®æ’å¸ƒï¼ˆlayoutï¼‰çš„æ¦‚å¿µã€‚</p>
<p>ç¥ç»ç½‘ç»œæ¨¡å‹ä¸­çš„å˜é‡å¯ä»¥ç”¨ä¸€ä¸ª4ç»´çš„å¼ é‡è¡¨ç¤ºï¼Œæ¯ä¸ªæ•°å­—æ˜¯è¿™ä¸ªå¼ é‡ä¸­çš„å…ƒç´ ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºè‡ªç„¶æ’å¸ƒã€‚ å°†ä¸åŒç»´åº¦çš„ä¸åŒå…ƒç´ æŒ‰ä¸€å®šè§„åˆ™ç´§å¯†æ’åˆ—åœ¨ä¸€èµ·ï¼Œå½¢æˆä¸€ä¸ªç‹¬ç«‹çš„å°å—ï¼ˆblockï¼‰ï¼Œç„¶åå°†è¿™äº›å°å—çœ‹æˆæ–°çš„å…ƒç´ ï¼Œç»„æˆæ–°çš„4ç»´å¼ é‡ï¼Œ æˆ‘ä»¬ç§°ä¹‹ä¸ºå¸¦æœ‰æ•°æ®æ’å¸ƒçš„å¼ é‡ã€‚</p>
<p>è¾“å…¥è¾“å‡ºæ•°æ®ä¼šç”¨åˆ°ä¸åŒçš„layoutæ•°æ®æ’å¸ƒï¼Œç”¨æˆ·å¯é€šè¿‡APIè·å–layoutæè¿°ä¿¡æ¯ï¼Œ<strong>ä¸åŒçš„layoutæ•°æ®ä¸å¯ä»¥ç›´æ¥æ¯”è¾ƒã€‚</strong></p>
<p><strong>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨è¿›è¡Œæ•°æ®æ’å¸ƒè½¬æ¢æ—¶ï¼Œå¦‚æœéœ€è¦paddingï¼Œåˆ™paddingçš„å€¼å»ºè®®è®¾ç½®ä¸ºé›¶ã€‚</strong></p>
<p>æ­¤å¤„ä»‹ç»ä¸¤ç§æ•°æ®æ’å¸ƒï¼š <code>NHWC_NATIVE</code> å’Œ <code>NCHW_NATIVE</code> ï¼Œä»¥ <code>NHWC_NATIVE</code> ä¸ºä¾‹ï¼Œå…¶æ•°æ®æ’å¸ƒå¦‚ä¸‹ï¼š</p>
<table>
<thead>
<tr>
<th>N0H0W0C0</th>
<th>N0H0W0C1</th>
<th>â€¦â€¦</th>
</tr>
</thead>
<tbody><tr>
<td>N0H0W1C0</td>
<td>N0H0W1C1</td>
<td>â€¦â€¦</td>
</tr>
<tr>
<td>â€¦â€¦</td>
<td>â€¦â€¦</td>
<td>â€¦â€¦</td>
</tr>
<tr>
<td>N0H1W0C0</td>
<td>N0H1W0C1</td>
<td>â€¦â€¦</td>
</tr>
<tr>
<td>â€¦â€¦</td>
<td>â€¦â€¦</td>
<td>â€¦â€¦</td>
</tr>
<tr>
<td>N1H0W0C0</td>
<td>N1H0W0C1</td>
<td>â€¦â€¦</td>
</tr>
<tr>
<td>â€¦â€¦</td>
<td>â€¦â€¦</td>
<td>â€¦â€¦</td>
</tr>
</tbody></table>
<p>ä¸€ä¸ªN<em>H</em>W*Cå¤§å°çš„å¼ é‡å¯ç”¨å¦‚ä¸‹4é‡å¾ªç¯è¡¨ç¤ºï¼š</p>
<div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="type">int32_t</span> n = <span class="number">0</span>; n &lt; N; n++) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int32_t</span> h = <span class="number">0</span>; h &lt; H; h++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int32_t</span> w = <span class="number">0</span>; w &lt; W; w++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int32_t</span> c = <span class="number">0</span>; c &lt; C; c++) &#123;</span><br><span class="line">                <span class="type">int32_t</span> native_offset = n*H*W*C + h*W*C + w*C + c;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>å…¶ä¸­ <code>NCHW_NATIVE</code> å’Œ <code>NHWC_NATIVE</code> ç›¸æ¯”ï¼Œåªæ˜¯æ’å¸ƒå¾ªç¯é¡ºåºä¸ä¸€æ ·ï¼Œæ­¤å¤„ä¸å†å•ç‹¬åˆ—å‡ºã€‚</p>
<p><strong>ä¸‹æ–‡ä¸­æåˆ°çš„nativeéƒ½ç‰¹æŒ‡è¯¥layoutï¼ˆNHWCï¼‰ã€‚</strong></p>
<h5 id="BPUå¯¹é½é™åˆ¶è§„åˆ™"><a href="#BPUå¯¹é½é™åˆ¶è§„åˆ™" class="headerlink" title="BPUå¯¹é½é™åˆ¶è§„åˆ™"></a>BPUå¯¹é½é™åˆ¶è§„åˆ™</h5><blockquote>
<p>æ¨¡å‹è¾“å…¥è¦æ±‚</p>
</blockquote>
<p>BPUä¸é™åˆ¶æ¨¡å‹è¾“å…¥å¤§å°æˆ–è€…å¥‡å¶ã€‚æ—¢åƒYOLOè¿™ç§416x416çš„è¾“å…¥å¯ä»¥æ”¯æŒï¼Œå¯¹äºåƒSqueezeNetè¿™ç§227x227çš„è¾“å…¥ä¹Ÿå¯ä»¥æ”¯æŒã€‚ <strong>å¯¹äºNV12è¾“å…¥æ¯”è¾ƒç‰¹åˆ«ï¼Œè¦æ±‚HWéƒ½æ˜¯å¶æ•°ï¼Œæ˜¯ä¸ºäº†æ»¡è¶³UVæ˜¯Yçš„ä¸€åŠçš„è¦æ±‚ã€‚</strong></p>
<blockquote>
<p>å¯¹é½å’Œæœ‰æ•ˆæ•°æ®</p>
</blockquote>
<p>BPUå¯¹æ•°æ®æœ‰å¯¹é½é™åˆ¶ã€‚å¯¹é½è¦æ±‚å’ŒçœŸå®çš„æ•°æ®æ’å¸ƒç”¨ <code>hbDNNTensorProperties</code> ä¸­çš„ <code>validShape</code> , <code>alignedShape</code> å’Œ <code>stride</code> è¡¨ç¤ºã€‚</p>
<ul>
<li><code>validShape</code> æ˜¯æœ‰æ•ˆçš„shapeï¼›</li>
<li><code>alignedShape</code> æ˜¯æ»¡è¶³å¯¹é½è¦æ±‚çš„shape, ç”±äºç¡¬ä»¶ç‰¹æ€§ï¼Œ <code>alignedShape</code> å‡ç”±å››ç»´æ•°æ®è¡¨ç¤ºï¼›</li>
<li><code>stride</code> è¡¨ç¤º <code>validShape</code> å„ç»´åº¦çš„æ­¥é•¿ï¼Œå…¶ä¸­ï¼ŒNV12è¾“å…¥çš„æ¨¡å‹æ¯”è¾ƒç‰¹æ®Šï¼Œå…¶ <code>stride</code> å‡ä¸º0ï¼Œå› ä¸ºNV12è¾“å…¥çš„æ¨¡å‹åªè¦æ±‚W 16å¯¹é½ã€‚</li>
</ul>
<p><strong>ç›®å‰å››ç»´æ¨¡å‹çš„å¼ é‡å¯ä»¥é€šè¿‡ <code>validShape</code> å’Œ <code>alignedShape</code> è·å–æ­£ç¡®çš„æ•°æ®æ’å¸ƒï¼Œå¤§äºå››ç»´æ¨¡å‹çš„å¼ é‡å¯ä»¥é€šè¿‡ <code>validShape</code> å’Œ <code>stride</code> è·å–æ­£ç¡®çš„æ•°æ®æ’å¸ƒã€‚</strong></p>
<p>åœ¨åç»­åœºæ™¯ä½¿ç”¨æ—¶ï¼Œè€ƒè™‘åˆ°å¯¹é½è¦æ±‚ï¼Œå»ºè®®æŒ‰ç…§ <code>alignedByteSize</code> å¤§å°æ¥ç”³è¯·å†…å­˜ç©ºé—´ã€‚</p>
<h5 id="NV12ä»‹ç»"><a href="#NV12ä»‹ç»" class="headerlink" title="NV12ä»‹ç»"></a>NV12ä»‹ç»</h5><blockquote>
<p>YUVæ ¼å¼</p>
</blockquote>
<p><strong>YUVæ ¼å¼ä¸»è¦ç”¨äºä¼˜åŒ–å½©è‰²è§†é¢‘ä¿¡å·çš„ä¼ è¾“ã€‚</strong></p>
<p>YUVåˆ†ä¸ºä¸‰ä¸ªåˆ†é‡ï¼šYè¡¨ç¤ºæ˜äº®åº¦ï¼Œä¹Ÿå°±æ˜¯ç°åº¦å€¼ï¼›è€ŒUå’ŒVè¡¨ç¤ºçš„åˆ™æ˜¯è‰²åº¦ï¼Œä½œç”¨æ˜¯æè¿°å½±åƒè‰²å½©åŠé¥±å’Œåº¦ï¼Œç”¨äºæŒ‡å®šåƒç´ çš„é¢œè‰²ã€‚</p>
<blockquote>
<p>NV12æ’å¸ƒ</p>
</blockquote>
<p>NV12å›¾åƒæ ¼å¼å±äºYUVé¢œè‰²ç©ºé—´ä¸­çš„YUV420SPæ ¼å¼ï¼Œ<strong>æ¯å››ä¸ªYåˆ†é‡å…±ç”¨ä¸€ç»„Uåˆ†é‡å’ŒVåˆ†é‡ï¼ŒYè¿ç»­æ’åºï¼ŒUä¸Väº¤å‰æ’åºã€‚</strong></p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/13/J5/image-20230523161450735.png"
                      class="" title="image-20230523161450735"
                >



<h4 id="é”™è¯¯ç "><a href="#é”™è¯¯ç " class="headerlink" title="é”™è¯¯ç "></a>é”™è¯¯ç </h4><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">HB_DNN_SUCCESS = 0                   // æ‰§è¡ŒæˆåŠŸ</span><br><span class="line">HB_DNN_INVALID_ARGUMENT              // éæ³•å‚æ•°</span><br><span class="line">HB_DNN_INVALID_MODEL                 // éæ³•æ¨¡å‹</span><br><span class="line">HB_DNN_MODEL_NUMBER_EXCEED_LIMIT     // æ¨¡å‹ä¸ªæ•°è¶…è¿‡é™åˆ¶</span><br><span class="line">HB_DNN_INVALID_PACKED_DNN_HANDLE     // éæ³•packed handle</span><br><span class="line">HB_DNN_INVALID_DNN_HANDLE            // éæ³•handle</span><br><span class="line">HB_DNN_CAN_NOT_OPEN_FILE             // æ–‡ä»¶ä¸å­˜åœ¨</span><br><span class="line">HB_DNN_OUT_OF_MEMORY                 // æ²¡æœ‰è¶³å¤Ÿçš„å†…å­˜</span><br><span class="line">HB_DNN_TIMEOUT                       // è¶…æ—¶</span><br><span class="line">HB_DNN_TASK_NUM_EXCEED_LIMIT         // ä»»åŠ¡æ•°é‡è¶…é™åˆ¶</span><br><span class="line">HB_DNN_TASK_BATCH_SIZE_EXCEED_LIMIT  // å¤šä»»åŠ¡å¤„ç†æ•°é‡è¶…é™åˆ¶</span><br><span class="line">HB_DNN_INVALID_TASK_HANDLE           // éæ³•task handle</span><br><span class="line">HB_DNN_RUN_TASK_FAILED               // ä»»åŠ¡æ‰§è¡Œå¤±è´¥</span><br><span class="line">HB_DNN_MODEL_IS_RUNNING              // ä»»åŠ¡æ‰§è¡Œä¸­</span><br><span class="line">HB_DNN_INCOMPATIBLE_MODEL            // ä¸å…¼å®¹çš„æ¨¡å‹</span><br><span class="line">HB_DNN_API_USE_ERROR                 // æ¥å£ä½¿ç”¨é”™è¯¯</span><br><span class="line"></span><br><span class="line">HB_SYS_SUCCESS                       // æ‰§è¡ŒæˆåŠŸ</span><br><span class="line">HB_SYS_INVALID_ARGUMENT              // éæ³•å‚æ•°</span><br><span class="line">HB_SYS_OUT_OF_MEMORY                 // æ²¡æœ‰è¶³å¤Ÿçš„å†…å­˜</span><br><span class="line">HB_SYS_REGISTER_MEM_FAILED           // æ³¨å†Œå†…å­˜å¤±è´¥</span><br></pre></td></tr></table></figure></div>



<h4 id="é…ç½®ä¿¡æ¯"><a href="#é…ç½®ä¿¡æ¯" class="headerlink" title="é…ç½®ä¿¡æ¯"></a>é…ç½®ä¿¡æ¯</h4><h5 id="å¸¸ç”¨ç¯å¢ƒå˜é‡"><a href="#å¸¸ç”¨ç¯å¢ƒå˜é‡" class="headerlink" title="å¸¸ç”¨ç¯å¢ƒå˜é‡"></a>å¸¸ç”¨ç¯å¢ƒå˜é‡</h5><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">HB_DNN_LOG_LEVEL                // è®¾ç½®æ—¥å¿—ç­‰çº§ã€‚</span><br><span class="line">HB_DNN_CONV_MAP_PATH            // æ¨¡å‹å·ç§¯å±‚é…ç½®æ–‡ä»¶è·¯å¾„ï¼›ç¼–è¯‘å‚æ•°layer_out_dumpä¸ºtrueæ—¶äº§ç”Ÿçš„jsonæ–‡ä»¶ã€‚</span><br><span class="line">HB_DNN_DUMP_PATH                // æ¨¡å‹å·ç§¯å±‚ç»“æœè¾“å‡ºè·¯å¾„ï¼Œä¸HB_DNN_CONV_MAP_PATHé…åˆä½¿ç”¨ã€‚</span><br><span class="line">HB_DNN_PLUGIN_PATH              // è‡ªå®šä¹‰CPUç®—å­åŠ¨æ€é“¾æ¥åº“æ‰€åœ¨ç›®å½•ã€‚</span><br><span class="line">HB_DNN_PROFILER_LOG_PATH        // æ¨¡å‹è¿è¡Œå„é˜¶æ®µè€—æ—¶ç»Ÿè®¡ä¿¡æ¯dumpè·¯å¾„ã€‚</span><br><span class="line">HB_DNN_SIM_PLATFORM             // x86æ¨¡æ‹Ÿå™¨æ¨¡æ‹Ÿå¹³å°è®¾ç½®ã€‚</span><br><span class="line">HB_DNN_SIM_BPU_MEM_SIZE         // x86æ¨¡æ‹Ÿå™¨è®¾ç½®BPUå†…å­˜å¤§å°ï¼Œå•ä½MBã€‚</span><br><span class="line">HB_DNN_ENABLE_DSP               // ä½¿èƒ½DSPæ¨¡å—ï¼Œä»…J5å¯ç”¨ã€‚</span><br></pre></td></tr></table></figure></div>



<h5 id="æ—¥å¿—ç­‰çº§è®¾ç½®è¯´æ˜"><a href="#æ—¥å¿—ç­‰çº§è®¾ç½®è¯´æ˜" class="headerlink" title="æ—¥å¿—ç­‰çº§è®¾ç½®è¯´æ˜"></a>æ—¥å¿—ç­‰çº§è®¾ç½®è¯´æ˜</h5><ol>
<li>æ—¥å¿—ç­‰çº§ã€‚ <code>dnn</code> ä¸­çš„æ—¥å¿—ä¸»è¦åˆ†ä¸º4ä¸ªç­‰çº§ï¼š<ul>
<li><code>HB_DNN_LOG_NONE = 0</code>ï¼Œä¸è¾“å‡ºæ—¥å¿—ï¼›</li>
<li><code>HB_DNN_LOG_WARNING = 3</code>ï¼Œè¯¥ç­‰çº§ä¸»è¦ç”¨æ¥è¾“å‡ºä»£ç ä¸­çš„å‘Šè­¦ä¿¡æ¯ï¼›</li>
<li><code>HB_DNN_LOG_ERROR = 4</code>ï¼Œè¯¥ç­‰çº§ä¸»è¦ç”¨æ¥è¾“å‡ºä»£ç ä¸­çš„æŠ¥é”™ä¿¡æ¯ï¼›</li>
<li><code>HB_DNN_LOG_FATAL = 5</code>ï¼Œè¯¥ç­‰çº§ä¸»è¦ç”¨æ¥è¾“å‡ºä»£ç ä¸­çš„å¯¼è‡´é€€å‡ºçš„é”™è¯¯ä¿¡æ¯ã€‚</li>
</ul>
</li>
<li>æ—¥å¿—ç­‰çº§è®¾ç½®è§„åˆ™ï¼š<ul>
<li>è‹¥å‘ç”Ÿçš„LOGç­‰çº§ &gt;&#x3D; è®¾ç½®çš„ç­‰çº§ï¼Œåˆ™è¯¥LOGå¯ä»¥è¢«æ‰“å°ï¼Œåä¹‹è¢«å±è”½ï¼›</li>
<li>è®¾ç½®çš„LOGç­‰çº§è¶Šå°ï¼Œæ‰“å°ä¿¡æ¯è¶Šå¤šï¼ˆç­‰çº§0é™¤å¤–ï¼Œ0ä¸è¾“å‡ºæ—¥å¿—ï¼‰ã€‚ ä¾‹å¦‚ï¼šè®¾ç½®LOGç­‰çº§ä¸º3ï¼Œå³ä¸º <code>WARNING</code> çº§åˆ«ï¼Œåˆ™3,4,5ç­‰çº§çš„LOGå‡å¯ä»¥è¢«æ‰“å°ï¼› é¢„æµ‹åº“é»˜è®¤LOGç­‰çº§ä¸º <code>HB_DNN_LOG_WARNING</code> ï¼Œåˆ™ä»¥ä¸‹LOGçº§åˆ«çš„ä¿¡æ¯å¯ä»¥è¢«æ‰“å°ï¼š <code>WARNING</code> ã€ <code>ERROR</code> ã€ <code>FATAL</code>ã€‚</li>
</ul>
</li>
</ol>
<h5 id="x86æ¨¡æ‹Ÿå™¨æ¨¡æ‹Ÿå¹³å°é…ç½®è¯´æ˜"><a href="#x86æ¨¡æ‹Ÿå™¨æ¨¡æ‹Ÿå¹³å°é…ç½®è¯´æ˜" class="headerlink" title="x86æ¨¡æ‹Ÿå™¨æ¨¡æ‹Ÿå¹³å°é…ç½®è¯´æ˜"></a>x86æ¨¡æ‹Ÿå™¨æ¨¡æ‹Ÿå¹³å°é…ç½®è¯´æ˜</h5><ol>
<li>x86æ¨¡æ‹Ÿå™¨é€šè¿‡è®¾ç½®ä¸åŒçš„é€‰é¡¹æ¨¡æ‹Ÿåœ°å¹³çº¿ä¸åŒçš„èŠ¯ç‰‡æ¶æ„ï¼Œå…¶ä¸­ï¼š<ul>
<li><code>export HB_DNN_SIM_PLATFORM=BERNOULLI</code> ï¼Œè¡¨ç¤ºæ¨¡æ‹Ÿåœ°å¹³çº¿ <code>xj2</code> å¹³å°ï¼›</li>
<li><code>export HB_DNN_SIM_PLATFORM=BERNOULLI2</code> ï¼Œè¡¨ç¤ºæ¨¡æ‹Ÿåœ°å¹³çº¿ <code>xj3</code> å¹³å°ï¼›</li>
<li><code>export HB_DNN_SIM_PLATFORM=BAYES</code> ï¼Œè¡¨ç¤ºæ¨¡æ‹Ÿåœ°å¹³çº¿ <code>j5</code> å¹³å°ã€‚</li>
</ul>
</li>
<li>å¦‚æœä¸è®¾ç½® <code>HB_DNN_SIM_PLATFORM</code> ç¯å¢ƒå˜é‡ï¼Œä¼šæ ¹æ®ç¬¬ä¸€æ¬¡åŠ è½½çš„æ¨¡å‹æ¶æ„æ¥è®¾ç½®æ¨¡æ‹Ÿå™¨å¹³å°ï¼Œä¾‹å¦‚ï¼šç¬¬ä¸€æ¬¡åŠ è½½çš„æ¨¡å‹æ˜¯ <code>BAYES</code> æ¶æ„ï¼Œåˆ™ç¨‹åºé»˜è®¤è®¾ç½®çš„å¹³å°ä¸º <code>j5</code>ã€‚</li>
</ol>
<h3 id="åŸºç¡€ç¤ºä¾‹åŒ…ä½¿ç”¨è¯´æ˜"><a href="#åŸºç¡€ç¤ºä¾‹åŒ…ä½¿ç”¨è¯´æ˜" class="headerlink" title="åŸºç¡€ç¤ºä¾‹åŒ…ä½¿ç”¨è¯´æ˜"></a>åŸºç¡€ç¤ºä¾‹åŒ…ä½¿ç”¨è¯´æ˜</h3><p>åŸºç¡€ç¤ºä¾‹åŒ…ä¸»è¦æä¾›äº†ä¸‰ä¸ªæ–¹é¢çš„ç¤ºä¾‹ï¼š</p>
<ol>
<li><code>dnn</code> APIæ•™å­¦ç¤ºä¾‹ã€‚</li>
<li>è‡ªå®šä¹‰ç®—å­ï¼ˆcustom OPï¼‰ç­‰ç‰¹æ®ŠåŠŸèƒ½ç¤ºä¾‹ã€‚</li>
<li>éNV12è¾“å…¥æ¨¡å‹çš„æ‚é¡¹ç¤ºä¾‹ã€‚</li>
</ol>
<p>å¼€å‘è€…å¯ä»¥ä½“éªŒå¹¶åŸºäºè¿™äº›ç¤ºä¾‹è¿›è¡Œåº”ç”¨å¼€å‘ï¼Œé™ä½å¼€å‘é—¨æ§›ã€‚</p>
<p>äº¤ä»˜ç‰©ä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å†…å®¹ï¼š</p>
<table>
<thead>
<tr>
<th align="left">åç§°</th>
<th align="left">å†…å®¹</th>
</tr>
</thead>
<tbody><tr>
<td align="left">horizon_runtime_sample</td>
<td align="left">åŒ…å«ç¤ºä¾‹æºä»£ç å’Œè¿è¡Œè„šæœ¬ã€‚</td>
</tr>
</tbody></table>
<h4 id="ç¤ºä¾‹åŒ…ä»£ç åŒ…"><a href="#ç¤ºä¾‹åŒ…ä»£ç åŒ…" class="headerlink" title="ç¤ºä¾‹åŒ…ä»£ç åŒ…"></a>ç¤ºä¾‹åŒ…ä»£ç åŒ…</h4><p>æ³¨æ„ï¼šä¸Šæ¿æ¨¡å‹éœ€è¦å…ˆåœ¨OEåŒ…çš„ <code>ddk/samples/ai_toolchain/model_zoo/runtime/horizon_runtime_sample</code> ç›®å½•ä¸‹æ‰§è¡Œ <code>resolve_runtime_sample.sh</code> è„šæœ¬è¿›è¡Œè·å–ã€‚</p>
<p>ç¤ºä¾‹åŒ…ç»“æ„å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">+---horizon_runtime_sample</span><br><span class="line">â”œâ”€â”€ code                        # ç¤ºä¾‹æºç </span><br><span class="line">â”‚   â”œâ”€â”€ 00_quick_start          # å¿«é€Ÿå…¥é—¨ç¤ºä¾‹ï¼Œç”¨mobilenetv1è¯»å–å•å¼ å›¾ç‰‡è¿›è¡Œæ¨ç†çš„ç¤ºä¾‹ä»£ç </span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ CMakeLists.txt</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ CMakeLists_x86.txt</span><br><span class="line">â”‚   â”‚   â””â”€â”€ src</span><br><span class="line">â”‚   â”œâ”€â”€ 01_api_tutorial         # BPU SDK APIä½¿ç”¨ç¤ºä¾‹ä»£ç </span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ CMakeLists.txt</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ mem</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ model</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ roi_infer</span><br><span class="line">â”‚   â”‚   â””â”€â”€ tensor</span><br><span class="line">â”‚   â”œâ”€â”€ 02_advanced_samples     # ç‰¹æ®ŠåŠŸèƒ½ç¤ºä¾‹</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ CMakeLists.txt</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ custom_identity</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ multi_input</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ multi_model_batch</span><br><span class="line">â”‚   â”‚   â””â”€â”€ nv12_batch</span><br><span class="line">â”‚   â”œâ”€â”€ 03_misc                 # æ‚é¡¹ç¤ºä¾‹</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ CMakeLists.txt</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ lenet_gray</span><br><span class="line">â”‚   â”‚   â””â”€â”€ resnet_feature</span><br><span class="line">â”‚   â”œâ”€â”€ build_j5.sh             # ç¼–è¯‘è„šæœ¬</span><br><span class="line">â”‚   â”œâ”€â”€ build_x86.sh            # x86ä»¿çœŸå¹³å°ç¼–è¯‘è„šæœ¬</span><br><span class="line">â”‚   â”œâ”€â”€ CMakeLists.txt</span><br><span class="line">â”‚   â”œâ”€â”€ CMakeLists_x86.txt</span><br><span class="line">â”‚   â””â”€â”€ deps_gcc9.3             # ç¼–è¯‘ä¾èµ–åº“</span><br><span class="line">â”‚       â”œâ”€â”€ aarch64</span><br><span class="line">â”‚       â””â”€â”€ x86</span><br><span class="line">â”œâ”€â”€ j5</span><br><span class="line">â”‚   â”œâ”€â”€ data                    # é¢„ç½®æ•°æ®æ–‡ä»¶</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ cls_images</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ det_images</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ misc_data</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ custom_identity_data</span><br><span class="line">â”‚   â”œâ”€â”€ model</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ README.md</span><br><span class="line">â”‚   â”‚   â””â”€â”€ runtime -&gt; ../../../model_zoo/runtime/horizon_runtime_sample   # è½¯é“¾æ¥æŒ‡å‘OEåŒ…ä¸­çš„æ¨¡å‹ï¼Œæ¿ç«¯è¿è¡Œç¯å¢ƒéœ€è¦è‡ªè¡ŒæŒ‡å®šæ¨¡å‹è·¯å¾„</span><br><span class="line">â”‚   â””â”€â”€ script                  # aarch64ç¤ºä¾‹è¿è¡Œè„šæœ¬</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ 00_quick_start</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ 01_api_tutorial</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ 02_advanced_samples</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ 03_misc</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ aarch64             # ç¼–è¯‘äº§ç”Ÿaarch64å¯æ‰§è¡Œç¨‹åºåŠä¾èµ–åº“</span><br><span class="line">â”‚   â”‚   â””â”€â”€ README.md</span><br><span class="line">â”‚   â””â”€â”€ script_x86              # x86ç¤ºä¾‹è¿è¡Œè„šæœ¬</span><br><span class="line">â”‚       â”œâ”€â”€ 00_quick_start</span><br><span class="line">â”‚       â”œâ”€â”€ x86                 # ç¼–è¯‘äº§ç”Ÿx86å¯æ‰§è¡Œç¨‹åºåŠä¾èµ–åº“</span><br><span class="line">â”‚       â””â”€â”€ README.md</span><br><span class="line">â””â”€â”€ README.md</span><br></pre></td></tr></table></figure></div>



<h4 id="ç¯å¢ƒæ­å»º-1"><a href="#ç¯å¢ƒæ­å»º-1" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h4><h5 id="å¼€å‘æ¿å‡†å¤‡"><a href="#å¼€å‘æ¿å‡†å¤‡" class="headerlink" title="å¼€å‘æ¿å‡†å¤‡"></a>å¼€å‘æ¿å‡†å¤‡</h5><p>1.æ‹¿åˆ°å¼€å‘æ¿åï¼ŒæŒ‰ç…§ <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/appendix/hardware/system_image.html" >ç³»ç»Ÿé•œåƒå‡çº§ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ä¸­çš„è¯´æ˜ï¼Œå‡çº§ç³»ç»Ÿé•œåƒåˆ°ç¤ºä¾‹åŒ…æ¨èçš„ç³»ç»Ÿé•œåƒç‰ˆæœ¬ã€‚</p>
<p>2.ç¡®ä¿æœ¬åœ°å¼€å‘æœºå’Œå¼€å‘æ¿å¯ä»¥è¿œç¨‹è¿æ¥ã€‚</p>
<h5 id="ç¼–è¯‘"><a href="#ç¼–è¯‘" class="headerlink" title="ç¼–è¯‘"></a>ç¼–è¯‘</h5><p>ç¼–è¯‘éœ€è¦çš„æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<p>1.å½“å‰ç¯å¢ƒå®‰è£…å¥½äº¤å‰ç¼–è¯‘å·¥å…·gcc-ubuntu-9.3.0-2020.03-x86_64-aarch64-linux-gnuã€‚</p>
<p>2.ç„¶åæ‰§è¡Œ <strong>horizon_runtime_sample&#x2F;code</strong> ç›®å½•ä¸‹çš„build_j5.shè„šæœ¬å³å¯ä¸€é”®ç¼–è¯‘çœŸæœºç¯å¢ƒä¸‹çš„å¯æ‰§è¡Œç¨‹åºï¼Œå¯æ‰§è¡Œç¨‹åºå’Œå¯¹åº”ä¾èµ–ä¼šè‡ªåŠ¨å¤åˆ¶åˆ° <strong>j5&#x2F;script</strong> ç›®å½•ä¸‹çš„ <strong>aarch64</strong> ç›®å½•ä¸‹ã€‚</p>
<p>x86ä»¿çœŸç¯å¢ƒä¸‹ä½¿ç”¨ <strong>horizon_runtime_sample&#x2F;code</strong> ç›®å½•ä¸‹çš„build_x86.shè„šæœ¬å³å¯ä¸€é”®ç¼–è¯‘x86ç¯å¢ƒä¸‹çš„å¯æ‰§è¡Œç¨‹åºï¼Œå¯æ‰§è¡Œ ç¨‹åºå’Œå¯¹åº”ä¾èµ–ä¼šè‡ªåŠ¨å¤åˆ¶åˆ° <strong>j5&#x2F;script_x86</strong> ç›®å½•ä¸‹çš„ <strong>x86</strong> ç›®å½•ä¸‹ã€‚</p>
<blockquote>
<p><strong>éœ€è¦æ³¨æ„build_j5.shè„šæœ¬é‡ŒæŒ‡å®šçš„äº¤å‰ç¼–è¯‘å·¥å…·é“¾çš„ä½ç½®æ˜¯ &#x2F;opt ç›®å½•ä¸‹ï¼Œç”¨æˆ·å¦‚æœå®‰è£…åœ¨å…¶ä»–ä½ç½®ï¼Œå¯ä»¥æ‰‹åŠ¨ä¿®æ”¹ä¸‹build_j5.shã€‚</strong></p>
</blockquote>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export CC=/opt/gcc-ubuntu-9.3.0-2020.03-x86_64-aarch64-linux-gnu/bin/aarch64-linux-gnu-gcc</span><br><span class="line">export CXX=/opt/gcc-ubuntu-9.3.0-2020.03-x86_64-aarch64-linux-gnu/bin/aarch64-linux-gnu-g++</span><br></pre></td></tr></table></figure></div>



<h4 id="ç¤ºä¾‹ä½¿ç”¨"><a href="#ç¤ºä¾‹ä½¿ç”¨" class="headerlink" title="ç¤ºä¾‹ä½¿ç”¨"></a>ç¤ºä¾‹ä½¿ç”¨</h4><h5 id="basic-samplesç¤ºä¾‹"><a href="#basic-samplesç¤ºä¾‹" class="headerlink" title="basic_samplesç¤ºä¾‹"></a>basic_samplesç¤ºä¾‹</h5><p>ç¤ºä¾‹è„šæœ¬ä¸»è¦åœ¨ <strong>j5&#x2F;script</strong> å’Œ <strong>j5&#x2F;script_x86</strong> ç›®å½•ä¸‹ï¼Œç¼–è¯‘ç¨‹åºåç›®å½•ç»“æ„å¦‚ä¸‹:</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">script:</span><br><span class="line">â”œâ”€â”€ 00_quick_start</span><br><span class="line">â”‚   â”œâ”€â”€ README.md</span><br><span class="line">â”‚   â””â”€â”€ run_mobilenetV1.sh</span><br><span class="line">â”œâ”€â”€ 01_api_tutorial</span><br><span class="line">â”‚   â”œâ”€â”€ model.sh</span><br><span class="line">â”‚   â”œâ”€â”€ README.md</span><br><span class="line">â”‚   â”œâ”€â”€ roi_infer.sh</span><br><span class="line">â”‚   â”œâ”€â”€ sys_mem.sh</span><br><span class="line">â”‚   â””â”€â”€ tensor.sh</span><br><span class="line">â”œâ”€â”€ 02_advanced_samples</span><br><span class="line">â”‚   â”œâ”€â”€ plugin</span><br><span class="line">â”‚   â”‚   â””â”€â”€ custom_arm_op_custom_identity.sh</span><br><span class="line">â”‚   â”œâ”€â”€ README.md</span><br><span class="line">â”‚   â”œâ”€â”€ run_multi_input.sh</span><br><span class="line">â”‚   â”œâ”€â”€ run_multi_model_batch.sh</span><br><span class="line">â”‚   â””â”€â”€ run_nv12_batch.sh</span><br><span class="line">â”œâ”€â”€ 03_misc</span><br><span class="line">â”‚   â”œâ”€â”€ README.md</span><br><span class="line">â”‚   â”œâ”€â”€ run_lenet.sh</span><br><span class="line">â”‚   â””â”€â”€ run_resnet50_feature.sh</span><br><span class="line">â”œâ”€â”€ aarch64                        # ç¼–è¯‘äº§ç”Ÿå¯æ‰§è¡Œç¨‹åºåŠä¾èµ–åº“</span><br><span class="line">â”‚   â”œâ”€â”€ bin</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ model_example</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ roi_infer</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ run_custom_op</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ run_lenet_gray</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ run_mobileNetV1_224x224</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ run_multi_input</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ run_multi_model_batch</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ run_nv12_batch</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ run_resnet_feature</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ sys_mem_example</span><br><span class="line">â”‚   â”‚   â””â”€â”€ tensor_example</span><br><span class="line">â”‚   â””â”€â”€ lib</span><br><span class="line">â”‚       â”œâ”€â”€ libdnn.so</span><br><span class="line">â”‚       â”œâ”€â”€ libhbrt_bayes_aarch64.so</span><br><span class="line">â”‚       â””â”€â”€ libopencv_world.so.3.4</span><br><span class="line">â””â”€â”€ README.md</span><br><span class="line"></span><br><span class="line">script_x86:</span><br><span class="line">â”œâ”€â”€ 00_quick_start</span><br><span class="line">â”‚   â”œâ”€â”€ README.md</span><br><span class="line">â”‚   â””â”€â”€ run_mobilenetV1.sh</span><br><span class="line">â”œâ”€â”€ x86                        # ç¼–è¯‘äº§ç”Ÿå¯æ‰§è¡Œç¨‹åºåŠä¾èµ–åº“</span><br><span class="line">â”‚   â”œâ”€â”€ bin</span><br><span class="line">â”‚   â”‚   â””â”€â”€ run_mobileNetV1_224x224</span><br><span class="line">â”‚   â””â”€â”€ lib</span><br><span class="line">â”‚       â”œâ”€â”€ libdnn.so</span><br><span class="line">â”‚       â”œâ”€â”€ libhbdk_sim_x86.so</span><br><span class="line">â”‚       â””â”€â”€ libopencv_world.so.3.4</span><br><span class="line">â””â”€â”€ README.md</span><br></pre></td></tr></table></figure></div>

<blockquote>
<ul>
<li><code>horizon_runtime_sample</code> ç¤ºä¾‹åŒ…çš„æ¨¡å‹å‘å¸ƒç‰©éœ€è¦åœ¨OEåŒ…çš„ <code>ddk/samples/ai_toolchain/model_zoo/runtime/horizon_runtime_sample</code> ç›®å½•ä¸‹æ‰§è¡Œ <code>resolve_runtime_sample.sh</code> è„šæœ¬è¿›è¡Œè·å–ã€‚</li>
<li><code>model</code> æ–‡ä»¶å¤¹åŒ…å«æ¨¡å‹æ‰€åœ¨çš„è·¯å¾„ï¼Œx86è¿è¡Œç¯å¢ƒä¸‹ <code>runtime</code> æ–‡ä»¶å¤¹ä¸ºè½¯é“¾æ¥ï¼Œé“¾æ¥è·¯å¾„æŒ‡å‘ <code>../../../model_zoo/runtime/horizon_runtime_sample</code> ï¼Œå¯ç›´æ¥åœ¨OEç¯å¢ƒä¸­è¿è¡Œï¼›<strong>æ¿ç«¯è¿è¡Œç¯å¢ƒä¸‹éœ€è¦å°†æ¨¡å‹å‘å¸ƒç‰©æ”¾è‡³ <code>model</code> æ–‡ä»¶å¤¹ä¸‹ã€‚</strong></li>
</ul>
</blockquote>
<blockquote>
<p>quick_start</p>
</blockquote>
<p><strong>00_quick_start</strong> ç›®å½•ä¸‹çš„å¿«é€Ÿå¼€å§‹ç¤ºä¾‹ï¼š</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">00_quick_start/</span><br><span class="line">â”œâ”€â”€ README.md</span><br><span class="line">â””â”€â”€ run_mobilenetV1.sh</span><br></pre></td></tr></table></figure></div>

<ul>
<li><p>run_mobilenetV1.shï¼šè¯¥è„šæœ¬å®ç°ä½¿ç”¨mobilenetv1è¯»å–å•å¼ å›¾ç‰‡è¿›è¡Œæ¨ç†çš„ç¤ºä¾‹åŠŸèƒ½ã€‚ ä½¿ç”¨çš„æ—¶å€™ï¼Œè¿›å…¥ <strong>00_quick_start</strong> ç›®å½•, ç„¶åç›´æ¥æ‰§è¡Œ <code>sh run_mobilenetV1.sh</code> å³å¯ï¼Œå¦‚ä¸‹ä»£ç å—æ‰€ç¤ºï¼š</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/sh</span><br><span class="line"></span><br><span class="line">root@j5dvb:/userdata/app/horizon/basic_samples/j5/script/00_quick_start# sh run_mobilenetV1.sh</span><br><span class="line">../aarch64/bin/run_mobileNetV1_224x224 --model_file=../../model/runtime/mobilenetv1/mobilenetv1_224x224_nv12.bin --image_file=../../data/cls_images/zebra_cls.jpg --top_k=5</span><br><span class="line">I0000 00:00:00.000000 10765 vlog_is_on.cc:197] RAW: Set VLOG level for &quot;*&quot; to 3</span><br><span class="line">[BPU_PLAT]BPU Platform Version(1.3.3)!</span><br><span class="line">[HBRT] set log level as 0. version = 3.15.18.0</span><br><span class="line">[DNN] Runtime version = 1.17.2_(3.15.18 HBRT)</span><br><span class="line">[A][DNN][packed_model.cpp:225][Model](2023-04-11,17:51:17.206.804) [HorizonRT] The model builder version = 1.15.0</span><br><span class="line">I0411 17:51:17.244180 10765 run_mobileNetV1_224x224.cc:135] DNN runtime version: 1.17.2_(3.15.18 HBRT)</span><br><span class="line">I0411 17:51:17.244376 10765 run_mobileNetV1_224x224.cc:252] input[0] name is data</span><br><span class="line">I0411 17:51:17.244508 10765 run_mobileNetV1_224x224.cc:268] output[0] name is prob</span><br><span class="line">I0411 17:51:17.260176 10765 run_mobileNetV1_224x224.cc:159] read image to tensor as nv12 success</span><br><span class="line">I0411 17:51:17.262075 10765 run_mobileNetV1_224x224.cc:194] TOP 0 result id: 340</span><br><span class="line">I0411 17:51:17.262118 10765 run_mobileNetV1_224x224.cc:194] TOP 1 result id: 292</span><br><span class="line">I0411 17:51:17.262148 10765 run_mobileNetV1_224x224.cc:194] TOP 2 result id: 282</span><br><span class="line">I0411 17:51:17.262177 10765 run_mobileNetV1_224x224.cc:194] TOP 3 result id: 83</span><br><span class="line">I0411 17:51:17.262205 10765 run_mobileNetV1_224x224.cc:194] TOP 4 result id: 290</span><br></pre></td></tr></table></figure></div></li>
</ul>
<blockquote>
<p>api_tutorial</p>
</blockquote>
<p>è¯¥ç¤ºä¾‹æ˜¯æŒ‡ <strong>01_api_tutorial</strong> ç›®å½•å†…çš„ç¤ºä¾‹ï¼Œæ—¨åœ¨å¼•å¯¼ç”¨æˆ·ä½¿ç”¨åµŒå…¥å¼APIã€‚å…¶ç›®å½•åŒ…å«ä»¥ä¸‹è„šæœ¬ï¼š</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">â”œâ”€â”€ model.sh</span><br><span class="line">â”œâ”€â”€ roi_infer.sh</span><br><span class="line">â”œâ”€â”€ sys_mem.sh</span><br><span class="line">â””â”€â”€ tensor.sh</span><br></pre></td></tr></table></figure></div>

<ul>
<li><p>model.shï¼š<strong>è¯¥è„šæœ¬ä¸»è¦å®ç°è¯»å–æ¨¡å‹ä¿¡æ¯çš„åŠŸèƒ½</strong>ã€‚ ä½¿ç”¨çš„æ—¶å€™ï¼Œç›´æ¥è¿›å…¥ <strong>01_api_tutorial</strong> ç›®å½•ï¼Œç„¶åç›´æ¥æ‰§è¡Œ <code>sh model.sh</code> å³å¯ï¼Œå¦‚ä¸‹ä»£ç å—æ‰€ç¤ºï¼š</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/sh</span><br><span class="line"></span><br><span class="line">root@j5dvb-hynix8G:/userdata/horizon/j5/script/01_api_tutorial# sh model.sh</span><br><span class="line">../aarch64/bin/model_example --model_file_list=../../model/runtime/mobilenetv1/mobilenetv1_224x224_nv12.bin</span><br><span class="line">I0000 00:00:00.000000 10810 vlog_is_on.cc:197] RAW: Set VLOG level for &quot;*&quot; to 3</span><br><span class="line">[BPU_PLAT]BPU Platform Version(1.3.3)!</span><br><span class="line">[HBRT] set log level as 0. version = 3.15.18.0</span><br><span class="line">[DNN] Runtime version = 1.17.2_(3.15.18 HBRT)</span><br><span class="line">[A][DNN][packed_model.cpp:225][Model](2023-04-11,17:53:28.970.396) [HorizonRT] The model builder version = 1.15.0</span><br><span class="line">I0411 17:53:29.007853 10810 model_example.cc:104] model count:1, model[0]: mobilenetv1_224x224_nv12</span><br><span class="line">I0411 17:53:29.007939 10810 model_example.cc:112] hbDNNGetModelHandle [mobilenetv1_224x224_nv12] success!</span><br><span class="line">I0411 17:53:29.008011 10810 model_example.cc:186] [mobilenetv1_224x224_nv12] Model Info:  input num: 1, input[0] validShape: ( 1, 3, 224, 224 ), alignedShape: ( 1, 3, 224, 224 ), tensorType: 1, output num: 1, output[0] validShape: ( 1, 1000, 1, 1 ), alignedShape: ( 1, 1000, 1, 1 ), tensorType: 13</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>roi_infer.shï¼šè¯¥è„šæœ¬ä¸»è¦å¼•å¯¼å¦‚ä½•ä½¿ç”¨ <code>hbDNNRoiInfer</code> è¿™ä¸ªAPIï¼Œç¤ºä¾‹ä»£ç å®ç°çš„åŠŸèƒ½æ˜¯<strong>å°†ä¸€å¼ å›¾ç‰‡è½¬ä¸ºnv12æ•°æ®ï¼Œç»™å®šroiæ¡†è¿›è¡Œinferã€‚</strong> ä½¿ç”¨çš„æ—¶å€™ï¼Œç›´æ¥è¿›å…¥ <strong>01_api_tutorial</strong> ç›®å½•ï¼Œç„¶åç›´æ¥æ‰§è¡Œ <code>sh roi_infer.sh</code> å³å¯ã€‚</p>
</li>
<li><p>sys_mem.shï¼šè¯¥è„šæœ¬ä¸»è¦<strong>å¼•å¯¼å¦‚ä½•ä½¿ç”¨ <code>hbSysAllocMem</code>ã€<code>hbSysFlushMem</code> å’Œ <code>hbSysFreeMem</code> è¿™å‡ ä¸ªAPI</strong>ã€‚ä½¿ç”¨çš„æ—¶å€™ï¼Œç›´æ¥è¿›å…¥ <strong>01_api_tutorial</strong> ç›®å½•ï¼Œæ‰§è¡Œ <code>sh sys_mem.sh</code> å³å¯ã€‚</p>
</li>
<li><p>tensor.sh<strong>ï¼šè¯¥è„šæœ¬ä¸»è¦å¼•å¯¼å¦‚ä½•å‡†å¤‡æ¨¡å‹è¾“å…¥å’Œè¾“å‡ºçš„tensorã€æ‰“å°Tensorçš„å±æ€§å’Œæ•°æ®æ’å¸ƒ</strong>ï¼Œä»¥åŠä½¿ç”¨quantizeAxiså‚æ•°è¿›è¡Œåé‡åŒ–ã€‚ ä½¿ç”¨çš„æ—¶å€™ï¼Œç›´æ¥è¿›å…¥ <strong>01_api_tutorial</strong> ç›®å½•ï¼Œæ‰§è¡Œ <code>sh tensor.sh</code> å³å¯ï¼Œå¦‚ä¸‹ä»£ç å—æ‰€ç¤ºï¼š</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">root@j5dvb-hynix8G:/userdata/horizon/j5/script/01_api_tutorial# sh tensor.sh</span><br><span class="line">*****************************test_prepare_free_fn*************************************************</span><br><span class="line">Tensor data type:0, Tensor layout: 2, shape:1x1x721x1836, aligned shape:1x1x721x1840</span><br><span class="line">Tensor data type:1, Tensor layout: 2, shape:1x3x773x329, aligned shape:1x3x773x336</span><br><span class="line">Tensor data type:2, Tensor layout: 2, shape:1x3x108x1297, aligned shape:1x3x108x1312</span><br><span class="line">Tensor data type:5, Tensor layout: 2, shape:1x3x858x477, aligned shape:1x3x858x477</span><br><span class="line">Tensor data type:5, Tensor layout: 0, shape:1x920x102x3, aligned shape:1x920x102x3</span><br><span class="line">Tensor data type:4, Tensor layout: 2, shape:1x3x723x1486, aligned shape:1x3x723x1486</span><br><span class="line">Tensor data type:4, Tensor layout: 0, shape:1x372x366x3, aligned shape:1x372x366x3</span><br><span class="line">Tensor data type:3, Tensor layout: 2, shape:1x3x886x291, aligned shape:1x3x886x291</span><br><span class="line">Tensor data type:3, Tensor layout: 0, shape:1x613x507x3, aligned shape:1x613x507x3</span><br><span class="line">*****************************test_prepare_free_fn************************************************</span><br><span class="line"></span><br><span class="line">*****************************test_info_fn********************************************************</span><br><span class="line">Tensor data type:14, shape:1x1x1x3x2, stride:24x24x24x8x4, ndim: 5, data:</span><br><span class="line">  [[[[[0, 1], [2, 3], [4, 5]]]]]</span><br><span class="line">Tensor data type:9, shape:3x3x1x2x1, stride:6x2x2x1x1, ndim: 5, data:</span><br><span class="line">  [[[[[0], [1]]], [[[2], [3]]], [[[4], [5]]]], [[[[6], [7]]], [[[8], [9]]],</span><br><span class="line">    [[[10], [11]]]], [[[[12], [13]]], [[[14], [15]]], [[[16], [17]]]]]</span><br><span class="line">*****************************test_info_fn********************************************************</span><br><span class="line"></span><br><span class="line">********************test_dequantize_fn***********************************************************</span><br><span class="line">Tensor data type:8, shape:1x1x2x4, ndim: 4, quantiType: 2, quantizeAxis: 1,</span><br><span class="line">  quantizeValue: (0.1,), data: [[[[0, 1, 2, 3], [4, 5, 6, 7]]]],</span><br><span class="line">  dequantize data: [[[[0, 0.1, 0.2, 0.3], [0.4, 0.5, 0.6, 0.7]]]]</span><br><span class="line">Tensor data type:8, shape:2x4x1x1, ndim: 4, quantiType: 2, quantizeAxis: 3,</span><br><span class="line">  quantizeValue: (0.1,),</span><br><span class="line">  data: [[[[0]], [[1]], [[2]], [[3]]], [[[4]], [[5]], [[6]], [[7]]]],</span><br><span class="line">  dequantize data: [[[[0]], [[0.1]], [[0.2]], [[0.3]]], [[[0.4]], [[0.5]], [[0.6]], [[0.7]]]]</span><br><span class="line">********************test_dequantize_fn***********************************************************</span><br></pre></td></tr></table></figure></div></li>
</ul>
<blockquote>
<p>advanced_samples</p>
</blockquote>
<p>è¯¥ç¤ºä¾‹æ˜¯æŒ‡ <strong>02_advanced_samples</strong> ç›®å½•å†…çš„ç¤ºä¾‹ï¼Œä»‹ç»äº†è‡ªå®šä¹‰ç®—å­ç‰¹æ®ŠåŠŸèƒ½çš„ä½¿ç”¨ã€‚å…¶ç›®å½•åŒ…å«ä»¥ä¸‹è„šæœ¬ï¼š</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">â”œâ”€â”€ plugin</span><br><span class="line">â”‚    â””â”€â”€ custom_arm_op_custom_identity.sh</span><br><span class="line">â”œâ”€â”€ README.md</span><br><span class="line">â”œâ”€â”€ run_multi_input.sh</span><br><span class="line">â”œâ”€â”€ run_multi_model_batch.sh</span><br><span class="line">â””â”€â”€ run_nv12_batch.sh</span><br></pre></td></tr></table></figure></div>

<ul>
<li><p>custom_arm_op_custom_identity.shï¼šè¯¥è„šæœ¬ä¸»è¦<strong>å®ç°è‡ªå®šä¹‰ç®—å­æ¨¡å‹æ¨ç†åŠŸèƒ½</strong>ï¼Œ ä½¿ç”¨çš„æ—¶å€™ï¼Œè¿›å…¥ <strong>02_advanced_samples</strong> ç›®å½•, ç„¶åç›´æ¥æ‰§è¡Œ <code>sh custom_arm_op_custom_identity.sh</code> å³å¯ï¼Œå¦‚ä¸‹ä»£ç å—æ‰€ç¤ºï¼š</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">root@j5dvb-hynix8G:/userdata/horizon/j5/script/02_advanced_samples# sh custom_arm_op_custom_identity.sh</span><br><span class="line">../../aarch64/bin/run_custom_op --model_file=../../../model/runtime/custom_op/custom_op_featuremap.bin --input_file=../../../data/custom_identity_data/input0.bin,../../../data/custom_identity_data/input1.bin</span><br><span class="line">I0000 00:00:00.000000 10841 vlog_is_on.cc:197] RAW: Set VLOG level for &quot;*&quot; to 3</span><br><span class="line">I0411 17:55:59.928918 10841 main.cpp:212] hbDNNRegisterLayerCreator success</span><br><span class="line">I0411 17:55:59.929064 10841 main.cpp:217] hbDNNRegisterLayerCreator success</span><br><span class="line">[BPU_PLAT]BPU Platform Version(1.3.3)!</span><br><span class="line">[HBRT] set log level as 0. version = 3.15.18.0</span><br><span class="line">[DNN] Runtime version = 1.17.2_(3.15.18 HBRT)</span><br><span class="line">[A][DNN][packed_model.cpp:225][Model](2023-04-11,17:56:00.667.991) [HorizonRT] The model builder version = 1.15.0</span><br><span class="line">I0411 17:56:00.676071 10841 main.cpp:232] hbDNNGetModelNameList success</span><br><span class="line">I0411 17:56:00.676204 10841 main.cpp:239] hbDNNGetModelHandle success</span><br><span class="line">I0411 17:56:00.676276 10841 main.cpp:245] hbDNNGetInputCount success</span><br><span class="line">file length: 602112</span><br><span class="line">file length: 602112</span><br><span class="line">I0411 17:56:00.687402 10841 main.cpp:268] hbDNNGetOutputCount success</span><br><span class="line">I0411 17:56:00.687788 10841 main.cpp:297] hbDNNInfer success</span><br><span class="line">I0411 17:56:00.695663 10841 main.cpp:302] task done</span><br><span class="line">I0411 17:56:03.145243 10841 main.cpp:306] write output tensor</span><br></pre></td></tr></table></figure></div>

<p>æ¨¡å‹çš„ç¬¬ä¸€ä¸ªè¾“å‡ºæ•°æ®ä¿å­˜è‡³ <code>output0.txt</code> æ–‡ä»¶ã€‚</p>
</li>
<li><p>run_multi_input.shï¼šè¯¥è„šæœ¬ä¸»è¦<strong>å®ç°å¤šè¾“å…¥æ¨¡å‹æ¨ç†åŠŸèƒ½</strong>ï¼Œ ä½¿ç”¨çš„æ—¶å€™ï¼Œè¿›å…¥ <strong>02_advanced_samples</strong> ç›®å½•, ç„¶åç›´æ¥æ‰§è¡Œ <code>sh run_multi_input.sh</code> å³å¯ï¼Œå¦‚ä¸‹ä»£ç å—æ‰€ç¤ºï¼š</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">root@j5dvb:/userdata/chaoliang/j5/script/02_advanced_samples# sh run_multi_input.sh</span><br><span class="line">../aarch64/bin/run_multi_input --model_file=../../model/runtime/mobilenetv2/mobilenetv2_multi_224x224_gray.bin --image_file=../../data/cls_images/zebra_cls.jpg --top_k=5</span><br><span class="line">I0000 00:00:00.000000 10893 vlog_is_on.cc:197] RAW: Set VLOG level for &quot;*&quot; to 3</span><br><span class="line">[BPU_PLAT]BPU Platform Version(1.3.3)!</span><br><span class="line">[HBRT] set log level as 0. version = 3.15.18.0</span><br><span class="line">[DNN] Runtime version = 1.17.2_(3.15.18 HBRT)</span><br><span class="line">[A][DNN][packed_model.cpp:225][Model](2023-04-11,17:57:03.277.375) [HorizonRT] The model builder version = 1.15.0</span><br><span class="line">I0411 17:57:03.327527 10893 multi_input.cc:148] read image to tensor as bgr success</span><br><span class="line">I0411 17:57:03.329546 10893 multi_input.cc:183] TOP 0 result id: 340</span><br><span class="line">I0411 17:57:03.329598 10893 multi_input.cc:183] TOP 1 result id: 292</span><br><span class="line">I0411 17:57:03.329628 10893 multi_input.cc:183] TOP 2 result id: 352</span><br><span class="line">I0411 17:57:03.329656 10893 multi_input.cc:183] TOP 3 result id: 351</span><br><span class="line">I0411 17:57:03.329684 10893 multi_input.cc:183] TOP 4 result id: 282</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>run_multi_model_batch.shï¼šè¯¥è„šæœ¬ä¸»è¦<strong>å®ç°å¤šä¸ªå°æ¨¡å‹æ‰¹é‡æ¨ç†åŠŸèƒ½</strong>ï¼Œ ä½¿ç”¨çš„æ—¶å€™ï¼Œè¿›å…¥ <strong>02_advanced_samples</strong> ç›®å½•, ç„¶åç›´æ¥æ‰§è¡Œ <code>sh run_multi_model_batch.sh</code> å³å¯ï¼Œå¦‚ä¸‹ä»£ç å—æ‰€ç¤ºï¼š</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">root@j5dvb-hynix8G:/userdata/chaoliang/j5/script/02_advanced_samples# sh run_multi_model_batch.sh</span><br><span class="line">../aarch64/bin/run_multi_model_batch --model_file=../../model/runtime/googlenet/googlenet_224x224_nv12.bin,../../model/runtime/mobilenetv2/mobilenetv2_224x224_nv12.bin --input_file=../../data/cls_images/zebra_cls.jpg,../../data/cls_images/zebra_cls.jpg</span><br><span class="line">I0000 00:00:00.000000 10916 vlog_is_on.cc:197] RAW: Set VLOG level for &quot;*&quot; to 3</span><br><span class="line">[BPU_PLAT]BPU Platform Version(1.3.3)!</span><br><span class="line">[HBRT] set log level as 0. version = 3.15.18.0</span><br><span class="line">[DNN] Runtime version = 1.17.2_(3.15.18 HBRT)</span><br><span class="line">[A][DNN][packed_model.cpp:225][Model](2023-04-11,17:57:43.547.52) [HorizonRT] The model builder version = 1.15.0</span><br><span class="line">[A][DNN][packed_model.cpp:225][Model](2023-04-11,17:57:51.811.477) [HorizonRT] The model builder version = 1.15.0</span><br><span class="line">I0411 17:57:51.844280 10916 main.cpp:117] hbDNNInitializeFromFiles success</span><br><span class="line">I0411 17:57:51.844388 10916 main.cpp:125] hbDNNGetModelNameList success</span><br><span class="line">I0411 17:57:51.844424 10916 main.cpp:139] hbDNNGetModelHandle success</span><br><span class="line">I0411 17:57:51.875140 10916 main.cpp:153] read image to nv12 success</span><br><span class="line">I0411 17:57:51.875686 10916 main.cpp:170] prepare input tensor success</span><br><span class="line">I0411 17:57:51.875875 10916 main.cpp:182] prepare output tensor success</span><br><span class="line">I0411 17:57:51.876082 10916 main.cpp:216] infer success</span><br><span class="line">I0411 17:57:51.878844 10916 main.cpp:221] task done</span><br><span class="line">I0411 17:57:51.878948 10916 main.cpp:226] googlenet class result id: 340</span><br><span class="line">I0411 17:57:51.879084 10916 main.cpp:230] mobilenetv2 class result id: 340</span><br><span class="line">I0411 17:57:51.879177 10916 main.cpp:234] release task success</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>run_nv12_batch.shï¼šè¯¥è„šæœ¬ä¸»è¦<strong>å®ç°batchæ¨¡å‹æ¨ç†åŠŸèƒ½</strong>ï¼ŒInfer1æ˜¯åˆ†å¼€è®¾ç½®è¾“å…¥å¼ é‡æ¯ä¸ªbatchçš„åœ°å€ï¼ŒInfer2æ˜¯åªè®¾ç½®ä¸€ä¸ªåœ°å€ï¼ŒåŒ…å«æ‰€æœ‰çš„batchï¼Œ ä½¿ç”¨çš„æ—¶å€™ï¼Œè¿›å…¥ <strong>02_advanced_samples</strong> ç›®å½•, ç„¶åç›´æ¥æ‰§è¡Œ <code>sh run_nv12_batch.sh</code> å³å¯ï¼Œå¦‚ä¸‹ä»£ç å—æ‰€ç¤ºï¼š</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">root@j5dvb:/userdata/chaoliang/j5/script/02_advanced_samples# sh run_nv12_batch.sh</span><br><span class="line">../aarch64/bin/run_nv12_batch --model_file=../../model/runtime/googlenet/googlenet_4x224x224_nv12.bin --image_file=../../data/cls_images/zebra_cls.jpg,../../data/cls_images/cat_cls.jpg,../../data/cls_images/zebra_cls.jpg,../../data/cls_images/cat_cls.jpg --top_k=5</span><br><span class="line">I0000 00:00:00.000000 21511 vlog_is_on.cc:197] RAW: Set VLOG level for &quot;*&quot; to 3</span><br><span class="line">[BPU_PLAT]BPU Platform Version(1.3.3)!</span><br><span class="line">[HBRT] set log level as 0. version = 3.15.18.0</span><br><span class="line">[DNN] Runtime version = 1.17.2_(3.15.18 HBRT)</span><br><span class="line">I0705 11:39:43.429180 21511 nv12_batch.cc:151] Infer1 start</span><br><span class="line">I0705 11:39:43.488143 21511 nv12_batch.cc:166] read image to tensor as nv12 success</span><br><span class="line">I0705 11:39:43.491156 21511 nv12_batch.cc:201] Batch[0]:</span><br><span class="line">I0705 11:39:43.491211 21511 nv12_batch.cc:203] TOP 0 result id: 340</span><br><span class="line">I0705 11:39:43.491240 21511 nv12_batch.cc:203] TOP 1 result id: 83</span><br><span class="line">I0705 11:39:43.491266 21511 nv12_batch.cc:203] TOP 2 result id: 41</span><br><span class="line">I0705 11:39:43.491298 21511 nv12_batch.cc:203] TOP 3 result id: 912</span><br><span class="line">I0705 11:39:43.491324 21511 nv12_batch.cc:203] TOP 4 result id: 292</span><br><span class="line">I0705 11:39:43.491348 21511 nv12_batch.cc:201] Batch[1]:</span><br><span class="line">I0705 11:39:43.491374 21511 nv12_batch.cc:203] TOP 0 result id: 282</span><br><span class="line">I0705 11:39:43.491398 21511 nv12_batch.cc:203] TOP 1 result id: 281</span><br><span class="line">I0705 11:39:43.491422 21511 nv12_batch.cc:203] TOP 2 result id: 285</span><br><span class="line">I0705 11:39:43.491447 21511 nv12_batch.cc:203] TOP 3 result id: 287</span><br><span class="line">I0705 11:39:43.491472 21511 nv12_batch.cc:203] TOP 4 result id: 283</span><br><span class="line">I0705 11:39:43.491497 21511 nv12_batch.cc:201] Batch[2]:</span><br><span class="line">I0705 11:39:43.491514 21511 nv12_batch.cc:203] TOP 0 result id: 340</span><br><span class="line">I0705 11:39:43.491539 21511 nv12_batch.cc:203] TOP 1 result id: 83</span><br><span class="line">I0705 11:39:43.491564 21511 nv12_batch.cc:203] TOP 2 result id: 41</span><br><span class="line">I0705 11:39:43.491587 21511 nv12_batch.cc:203] TOP 3 result id: 912</span><br><span class="line">I0705 11:39:43.491612 21511 nv12_batch.cc:203] TOP 4 result id: 292</span><br><span class="line">I0705 11:39:43.491637 21511 nv12_batch.cc:201] Batch[3]:</span><br><span class="line">I0705 11:39:43.491662 21511 nv12_batch.cc:203] TOP 0 result id: 282</span><br><span class="line">I0705 11:39:43.491685 21511 nv12_batch.cc:203] TOP 1 result id: 281</span><br><span class="line">I0705 11:39:43.491710 21511 nv12_batch.cc:203] TOP 2 result id: 285</span><br><span class="line">I0705 11:39:43.491734 21511 nv12_batch.cc:203] TOP 3 result id: 287</span><br><span class="line">I0705 11:39:43.491760 21511 nv12_batch.cc:203] TOP 4 result id: 283</span><br><span class="line">I0705 11:39:43.492235 21511 nv12_batch.cc:223] Infer1 end</span><br><span class="line">I0705 11:39:43.492276 21511 nv12_batch.cc:228] Infer2 start</span><br><span class="line">I0705 11:39:43.549713 21511 nv12_batch.cc:243] read image to tensor as nv12 success</span><br><span class="line">I0705 11:39:43.552248 21511 nv12_batch.cc:278] Batch[0]:</span><br><span class="line">I0705 11:39:43.552292 21511 nv12_batch.cc:280] TOP 0 result id: 340</span><br><span class="line">I0705 11:39:43.552320 21511 nv12_batch.cc:280] TOP 1 result id: 83</span><br><span class="line">I0705 11:39:43.552345 21511 nv12_batch.cc:280] TOP 2 result id: 41</span><br><span class="line">I0705 11:39:43.552371 21511 nv12_batch.cc:280] TOP 3 result id: 912</span><br><span class="line">I0705 11:39:43.552397 21511 nv12_batch.cc:280] TOP 4 result id: 292</span><br><span class="line">I0705 11:39:43.552421 21511 nv12_batch.cc:278] Batch[1]:</span><br><span class="line">I0705 11:39:43.552445 21511 nv12_batch.cc:280] TOP 0 result id: 282</span><br><span class="line">I0705 11:39:43.552469 21511 nv12_batch.cc:280] TOP 1 result id: 281</span><br><span class="line">I0705 11:39:43.552495 21511 nv12_batch.cc:280] TOP 2 result id: 285</span><br><span class="line">I0705 11:39:43.552520 21511 nv12_batch.cc:280] TOP 3 result id: 287</span><br><span class="line">I0705 11:39:43.552567 21511 nv12_batch.cc:280] TOP 4 result id: 283</span><br><span class="line">I0705 11:39:43.552592 21511 nv12_batch.cc:278] Batch[2]:</span><br><span class="line">I0705 11:39:43.552616 21511 nv12_batch.cc:280] TOP 0 result id: 340</span><br><span class="line">I0705 11:39:43.552641 21511 nv12_batch.cc:280] TOP 1 result id: 83</span><br><span class="line">I0705 11:39:43.552665 21511 nv12_batch.cc:280] TOP 2 result id: 41</span><br><span class="line">I0705 11:39:43.552690 21511 nv12_batch.cc:280] TOP 3 result id: 912</span><br><span class="line">I0705 11:39:43.552716 21511 nv12_batch.cc:280] TOP 4 result id: 292</span><br><span class="line">I0705 11:39:43.552739 21511 nv12_batch.cc:278] Batch[3]:</span><br><span class="line">I0705 11:39:43.552763 21511 nv12_batch.cc:280] TOP 0 result id: 282</span><br><span class="line">I0705 11:39:43.552788 21511 nv12_batch.cc:280] TOP 1 result id: 281</span><br><span class="line">I0705 11:39:43.552812 21511 nv12_batch.cc:280] TOP 2 result id: 285</span><br><span class="line">I0705 11:39:43.552837 21511 nv12_batch.cc:280] TOP 3 result id: 287</span><br><span class="line">I0705 11:39:43.552861 21511 nv12_batch.cc:280] TOP 4 result id: 283</span><br><span class="line">I0705 11:39:43.553154 21511 nv12_batch.cc:300] Infer2 end</span><br></pre></td></tr></table></figure></div></li>
</ul>
<blockquote>
<p>misc</p>
</blockquote>
<p>è¯¥ç¤ºä¾‹æ˜¯æŒ‡ <strong>03_misc</strong> ç›®å½•å†…çš„ç¤ºä¾‹ï¼Œä»‹ç»äº†énv12è¾“å…¥æ¨¡å‹çš„ä½¿ç”¨ã€‚å…¶ç›®å½•åŒ…å«ä»¥ä¸‹è„šæœ¬ï¼š</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">â”œâ”€â”€ run_lenet.sh</span><br><span class="line">â””â”€â”€ run_resnet50_feature.sh</span><br></pre></td></tr></table></figure></div>

<ul>
<li><p>run_lenet.shï¼š<strong>è¯¥è„šæœ¬ä¸»è¦å®ç°Yæ•°æ®è¾“å…¥çš„lenetæ¨¡å‹æ¨ç†åŠŸèƒ½</strong>ï¼Œ ä½¿ç”¨çš„æ—¶å€™ï¼Œè¿›å…¥ <strong>03_misc</strong> ç›®å½•, ç„¶åç›´æ¥æ‰§è¡Œ <code>sh run_lenet.sh</code> å³å¯ï¼Œå¦‚ä¸‹ä»£ç å—æ‰€ç¤ºï¼š</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">root@j5dvb-hynix8G:/userdata/horizon/j5/script/03_misc# sh run_lenet.sh</span><br><span class="line">../aarch64/bin/run_lenet_gray --model_file=../../model/runtime/lenet_gray/lenet_28x28_gray.bin --data_file=../../data/misc_data/7.bin --image_height=28 --image_width=28 --top_k=5</span><br><span class="line">I0000 00:00:00.000000 10979 vlog_is_on.cc:197] RAW: Set VLOG level for &quot;*&quot; to 3</span><br><span class="line">[BPU_PLAT]BPU Platform Version(1.3.3)!</span><br><span class="line">[HBRT] set log level as 0. version = 3.15.18.0</span><br><span class="line">[DNN] Runtime version = 1.17.2_(3.15.18 HBRT)</span><br><span class="line">[A][DNN][packed_model.cpp:225][Model](2023-04-11,18:02:12.605.436) [HorizonRT] The model builder version = 1.15.0</span><br><span class="line">I0411 18:02:12.613317 10979 run_lenet_gray.cc:128] hbDNNInitializeFromFiles success</span><br><span class="line">I0411 18:02:12.613404 10979 run_lenet_gray.cc:136] hbDNNGetModelNameList success</span><br><span class="line">I0411 18:02:12.613440 10979 run_lenet_gray.cc:143] hbDNNGetModelHandle success</span><br><span class="line">I0411 18:02:12.614181 10979 run_lenet_gray.cc:159] prepare y tensor success</span><br><span class="line">I0411 18:02:12.614310 10979 run_lenet_gray.cc:172] prepare tensor success</span><br><span class="line">I0411 18:02:12.614503 10979 run_lenet_gray.cc:182] infer success</span><br><span class="line">I0411 18:02:12.615538 10979 run_lenet_gray.cc:187] task done</span><br><span class="line">[W][DNN][hb_sys.cpp:108][Mem](2023-04-11,18:02:12.615.583) memory is noncachable, ignore flush operation</span><br><span class="line">I0411 18:02:12.615624 10979 run_lenet_gray.cc:192] task post process finished</span><br><span class="line">I0411 18:02:12.615667 10979 run_lenet_gray.cc:198] TOP 0 result id: 7</span><br><span class="line">I0411 18:02:12.615698 10979 run_lenet_gray.cc:198] TOP 1 result id: 9</span><br><span class="line">I0411 18:02:12.615727 10979 run_lenet_gray.cc:198] TOP 2 result id: 3</span><br><span class="line">I0411 18:02:12.615754 10979 run_lenet_gray.cc:198] TOP 3 result id: 4</span><br><span class="line">I0411 18:02:12.615782 10979 run_lenet_gray.cc:198] TOP 4 result id: 2</span><br></pre></td></tr></table></figure></div>
</li>
<li><p>run_resnet50_feature.shï¼š<strong>è¯¥è„šæœ¬ä¸»è¦å®ç°featureæ•°æ®è¾“å…¥çš„resnet50æ¨¡å‹æ¨ç†åŠŸèƒ½</strong>ã€‚ç¤ºä¾‹ä»£ç å¯¹featureæ•°æ®åšäº†quantizeå’Œpaddingä»¥æ»¡è¶³æ¨¡å‹çš„è¾“å…¥æ¡ä»¶ï¼Œç„¶åè¾“å…¥åˆ°æ¨¡å‹è¿›è¡Œinferã€‚ ä½¿ç”¨çš„æ—¶å€™ï¼Œè¿›å…¥ <strong>03_misc</strong> ç›®å½•, ç„¶åç›´æ¥æ‰§è¡Œ <code>sh run_resnet50_feature.sh</code> å³å¯ï¼Œå¦‚ä¸‹ä»£ç å—æ‰€ç¤ºï¼š</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">root@j5dvb-hynix8G:/userdata/horizon/j5/script/03_misc# sh run_resnet50_feature.sh</span><br><span class="line">../aarch64/bin/run_resnet_feature --model_file=./resnet50_64x56x56_featuremap_modified.bin --data_file=../../data/misc_data/np_0 --top_k=5</span><br><span class="line">I0000 00:00:00.000000 11024 vlog_is_on.cc:197] RAW: Set VLOG level for &quot;*&quot; to 3</span><br><span class="line">[BPU_PLAT]BPU Platform Version(1.3.3)!</span><br><span class="line">[HBRT] set log level as 0. version = 3.15.18.0</span><br><span class="line">[DNN] Runtime version = 1.17.2_(3.15.18 HBRT)</span><br><span class="line">[A][DNN][packed_model.cpp:225][Model](2023-04-11,18:03:30.317.594) [HorizonRT] The model builder version = 1.15.1</span><br><span class="line">I0411 18:03:30.523054 11024 run_resnet_feature.cc:160] hbDNNInitializeFromFiles success</span><br><span class="line">I0411 18:03:30.523152 11024 run_resnet_feature.cc:168] hbDNNGetModelNameList success</span><br><span class="line">I0411 18:03:30.523188 11024 run_resnet_feature.cc:175] hbDNNGetModelHandle success</span><br><span class="line">I0411 18:03:30.529860 11024 run_resnet_feature.cc:346] input data size: 802816; input valid size: 200704; input aligned size: 229376</span><br><span class="line">I0411 18:03:30.536860 11024 run_resnet_feature.cc:357] tensor padding featuremap success</span><br><span class="line">I0411 18:03:30.536912 11024 run_resnet_feature.cc:190] prepare feature tensor success</span><br><span class="line">I0411 18:03:30.537052 11024 run_resnet_feature.cc:200] prepare tensor success</span><br><span class="line">I0411 18:03:30.537197 11024 run_resnet_feature.cc:210] infer success</span><br><span class="line">I0411 18:03:30.541096 11024 run_resnet_feature.cc:215] task done</span><br><span class="line">[W][DNN][hb_sys.cpp:108][Mem](2023-04-11,18:03:30.541.149) memory is noncachable, ignore flush operation</span><br><span class="line">I0411 18:03:30.541409 11024 run_resnet_feature.cc:220] task post process finished</span><br><span class="line">I0411 18:03:30.541453 11024 run_resnet_feature.cc:226] TOP 0 result id: 74</span><br><span class="line">I0411 18:03:30.541483 11024 run_resnet_feature.cc:226] TOP 1 result id: 815</span><br><span class="line">I0411 18:03:30.541512 11024 run_resnet_feature.cc:226] TOP 2 result id: 73</span><br><span class="line">I0411 18:03:30.541538 11024 run_resnet_feature.cc:226] TOP 3 result id: 78</span><br><span class="line">I0411 18:03:30.541565 11024 run_resnet_feature.cc:226] TOP 4 result id: 72</span><br></pre></td></tr></table></figure></div></li>
</ul>
<h4 id="è¾…åŠ©å·¥å…·"><a href="#è¾…åŠ©å·¥å…·" class="headerlink" title="è¾…åŠ©å·¥å…·"></a>è¾…åŠ©å·¥å…·</h4><h5 id="æ—¥å¿—"><a href="#æ—¥å¿—" class="headerlink" title="æ—¥å¿—"></a>æ—¥å¿—</h5><p>æ—¥å¿—ä¸»è¦åŒ…æ‹¬ <strong>ç¤ºä¾‹æ—¥å¿—</strong> å’Œ <strong>dnnæ—¥å¿—</strong> ä¸¤éƒ¨åˆ†ã€‚ å…¶ä¸­ç¤ºä¾‹æ—¥å¿—æ˜¯æŒ‡äº¤ä»˜åŒ…ç¤ºä¾‹ä»£ç ä¸­æ‰€åº”ç”¨çš„æ—¥å¿—ï¼› dnnæ—¥å¿—æ˜¯æŒ‡åµŒå…¥å¼dnnåº“ä¸­çš„æ—¥å¿—ã€‚ ç”¨æˆ·æ ¹æ®ä¸åŒçš„éœ€æ±‚å¯ä»¥è®¾ç½®ä¸åŒçš„æ—¥å¿—ã€‚</p>
<blockquote>
<p>ç¤ºä¾‹æ—¥å¿—</p>
</blockquote>
<p>ç¤ºä¾‹æ—¥å¿—ä¸»è¦é‡‡ç”¨glogä¸­çš„vlogï¼Œbasic_samplesæ‰€æ¶‰åŠåˆ°çš„ç¤ºä¾‹ä¸­ï¼Œæ—¥å¿—å†…å®¹å…¨éƒ¨è¾“å‡ºã€‚</p>
<blockquote>
<p>dnn æ—¥å¿—</p>
</blockquote>
<p>å…³äº <code>dnn</code> æ—¥å¿—çš„é…ç½®ï¼Œè¯·é˜…è¯»BPU SDK APIæ‰‹å†Œç« èŠ‚ä¸­çš„ <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/runtime/source/bpu_sdk_api/source/bpu_sdk_api_doc.html#bpu-sdk-config" >é…ç½®ä¿¡æ¯ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ä¸€èŠ‚å†…å®¹ã€‚</p>
<h3 id="AI-Benchmarkä½¿ç”¨è¯´æ˜"><a href="#AI-Benchmarkä½¿ç”¨è¯´æ˜" class="headerlink" title="AI-Benchmarkä½¿ç”¨è¯´æ˜"></a>AI-Benchmarkä½¿ç”¨è¯´æ˜</h3><p>AI Benchmarkç¤ºä¾‹åŒ…æä¾›äº†åµŒå…¥å¼åº”ç”¨å¼€å‘å¸¸è§åˆ†ç±»ã€æ£€æµ‹ã€åˆ†å‰²å’Œå…‰æµä¼°è®¡æ¨¡å‹çš„æ€§èƒ½å’Œç²¾åº¦è¯„æµ‹ç¤ºä¾‹ã€‚ å…¶ä¸­æ€§èƒ½è¯„æµ‹ç¤ºä¾‹åŒ…æ‹¬å•å¸§å»¶è¿Ÿè¯„æµ‹å’Œå¤šçº¿ç¨‹è¯„æµ‹ç¤ºä¾‹ï¼Œå……åˆ†åˆ©ç”¨è°ƒç”¨BPUåŒæ ¸çš„é€Ÿåº¦è¯„æµ‹ã€‚ ç¤ºä¾‹åŒ…ä¸­é¢„ç½®äº†æºç ã€å¯æ‰§è¡Œç¨‹åºå’Œè¯„æµ‹è„šæœ¬ï¼Œå¼€å‘è€…å¯ä»¥åœ¨åœ°å¹³çº¿å¼€å‘æ¿ä¸Šè¿›è¡Œä½“éªŒï¼Œå¹¶åŸºäºè¿™äº›ç¤ºä¾‹ç›´æ¥è¿›è¡Œåº”ç”¨å¼€å‘ï¼Œé™ä½å¼€å‘é—¨æ§›ã€‚</p>
<h4 id="å‘å¸ƒç‰©è¯´æ˜"><a href="#å‘å¸ƒç‰©è¯´æ˜" class="headerlink" title="å‘å¸ƒç‰©è¯´æ˜"></a>å‘å¸ƒç‰©è¯´æ˜</h4><p>AI Benchmarkç¤ºä¾‹åŒ…ä½äº <strong>horizon_j5_open_explorer</strong> å‘å¸ƒç‰©çš„ <code>ddk/samples/ai_benchmark/</code> è·¯å¾„ä¸‹ï¼Œä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å†…å®¹ï¼š</p>
<table>
<thead>
<tr>
<th align="left"><strong>ç¼–å·</strong></th>
<th align="left"><strong>åç§°</strong></th>
<th align="left"><strong>å†…å®¹</strong></th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left">code</td>
<td align="left">åŒ…å«ç¤ºä¾‹æºä»£ç å’Œç¼–è¯‘è„šæœ¬ã€‚</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left">j5</td>
<td align="left">ç¤ºä¾‹åŒ…ä¸Šæ¿è¿è¡Œç¯å¢ƒã€‚</td>
</tr>
</tbody></table>
<h5 id="ç¤ºä¾‹åŒ…ç»“æ„"><a href="#ç¤ºä¾‹åŒ…ç»“æ„" class="headerlink" title="ç¤ºä¾‹åŒ…ç»“æ„"></a>ç¤ºä¾‹åŒ…ç»“æ„</h5><blockquote>
<p>ä¸Šæ¿æ¨¡å‹éœ€è¦å…ˆåœ¨OEåŒ…çš„ <code>ddk/samples/ai_toolchain/model_zoo/runtime/ai_benchmark</code> ç›®å½•ä¸‹çš„ <code>resolve_ai_benchmark_ptq.sh</code> å’Œ <code>resolve_ai_benchmark_qat.sh</code> è„šæœ¬è¿›è¡Œè·å–ã€‚</p>
</blockquote>
<p>ç¤ºä¾‹åŒ…ç»“æ„å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line">ai_benchmark/code/                    # ç¤ºä¾‹æºç æ–‡ä»¶å¤¹</span><br><span class="line">â”œâ”€â”€ build_ptq_j5.sh</span><br><span class="line">â”œâ”€â”€ build_qat_j5.sh</span><br><span class="line">â”œâ”€â”€ CMakeLists.txt</span><br><span class="line">â”œâ”€â”€ deps_gcc9.3                       # ç¬¬ä¸‰æ–¹ä¾èµ–åº“</span><br><span class="line">â”‚   â””â”€â”€ aarch64</span><br><span class="line">â”œâ”€â”€ include                           # æºç å¤´æ–‡ä»¶</span><br><span class="line">â”‚   â”œâ”€â”€ base</span><br><span class="line">â”‚   â”œâ”€â”€ input</span><br><span class="line">â”‚   â”œâ”€â”€ method</span><br><span class="line">â”‚   â”œâ”€â”€ output</span><br><span class="line">â”‚   â”œâ”€â”€ plugin</span><br><span class="line">â”‚   â””â”€â”€ utils</span><br><span class="line">â”œâ”€â”€ README.md</span><br><span class="line">â””â”€â”€ src                               # ç¤ºä¾‹æºç </span><br><span class="line">    â”œâ”€â”€ input</span><br><span class="line">    â”œâ”€â”€ method</span><br><span class="line">    â”œâ”€â”€ output</span><br><span class="line">    â”œâ”€â”€ plugin</span><br><span class="line">    â”œâ”€â”€ simple_example.cc             # ç¤ºä¾‹ä¸»ç¨‹åº</span><br><span class="line">    â””â”€â”€ utils</span><br><span class="line"></span><br><span class="line">ai_benchmark/j5                       # ç¤ºä¾‹åŒ…è¿è¡Œç¯å¢ƒ</span><br><span class="line">â”œâ”€â”€ ptq                               # PTQæ–¹æ¡ˆæ¨¡å‹ç¤ºä¾‹</span><br><span class="line">â”‚   â”œâ”€â”€ data                          # æ¨¡å‹ç²¾åº¦è¯„æµ‹æ•°æ®é›†</span><br><span class="line">â”‚   â”œâ”€â”€ mini_data                     # æ¨¡å‹æ€§èƒ½è¯„æµ‹æ•°æ®é›†</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ cifar10</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ cityscapes</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ coco</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ culane</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ flyingchairs</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ imagenet</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ kitti3d</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ nuscenes</span><br><span class="line">â”‚   â”‚   â””â”€â”€ voc</span><br><span class="line">â”‚   â”œâ”€â”€ model                         # PTQæ–¹æ¡ˆnv12æ¨¡å‹</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ README.md</span><br><span class="line">â”‚   â”‚   â””â”€â”€ runtime -&gt; ../../../../model_zoo/runtime/ai_benchmark/ptq   # è½¯é“¾æ¥æŒ‡å‘OEåŒ…ä¸­çš„æ¨¡å‹ï¼Œæ¿ç«¯è¿è¡Œç¯å¢ƒéœ€è¦è‡ªè¡ŒæŒ‡å®šæ¨¡å‹è·¯å¾„</span><br><span class="line">â”‚   â”œâ”€â”€ README.md</span><br><span class="line">â”‚   â”œâ”€â”€ script                        # æ‰§è¡Œè„šæœ¬</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ aarch64                   # ç¼–è¯‘äº§ç”Ÿå¯æ‰§è¡Œæ–‡ä»¶åŠä¾èµ–åº“</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ classification            # åˆ†ç±»æ¨¡å‹ç¤ºä¾‹</span><br><span class="line">â”‚   â”‚   â”‚   â”œâ”€â”€ efficientnasnet_m</span><br><span class="line">â”‚   â”‚   â”‚   â”œâ”€â”€ efficientnasnet_s</span><br><span class="line">â”‚   â”‚   â”‚   â”œâ”€â”€ efficientnet_lite0</span><br><span class="line">â”‚   â”‚   â”‚   â”œâ”€â”€ efficientnet_lite1</span><br><span class="line">â”‚   â”‚   â”‚   â”œâ”€â”€ efficientnet_lite2</span><br><span class="line">â”‚   â”‚   â”‚   â”œâ”€â”€ efficientnet_lite3</span><br><span class="line">â”‚   â”‚   â”‚   â”œâ”€â”€ efficientnet_lite4</span><br><span class="line">â”‚   â”‚   â”‚   â”œâ”€â”€ googlenet</span><br><span class="line">â”‚   â”‚   â”‚   â”œâ”€â”€ mobilenetv1</span><br><span class="line">â”‚   â”‚   â”‚   â”œâ”€â”€ mobilenetv2</span><br><span class="line">â”‚   â”‚   â”‚   â”œâ”€â”€ resnet18</span><br><span class="line">â”‚   â”‚   â”‚   â””â”€â”€ vargconvnet</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ config                    # æ¨¡å‹æ¨ç†é…ç½®æ–‡ä»¶</span><br><span class="line">â”‚   â”‚   â”‚   â””â”€â”€ model</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ detection                 # æ£€æµ‹æ¨¡å‹ç¤ºä¾‹</span><br><span class="line">â”‚   â”‚   â”‚   â”œâ”€â”€ centernet_resnet101</span><br><span class="line">â”‚   â”‚   â”‚   â”œâ”€â”€ preq_qat_fcos_efficientnetb0</span><br><span class="line">â”‚   â”‚   â”‚   â”œâ”€â”€ preq_qat_fcos_efficientnetb2</span><br><span class="line">â”‚   â”‚   â”‚   â”œâ”€â”€ preq_qat_fcos_efficientnetb3</span><br><span class="line">â”‚   â”‚   â”‚   â”œâ”€â”€ ssd_mobilenetv1</span><br><span class="line">â”‚   â”‚   â”‚   â”œâ”€â”€ yolov2_darknet19</span><br><span class="line">â”‚   â”‚   â”‚   â”œâ”€â”€ yolov3_darknet53</span><br><span class="line">â”‚   â”‚   â”‚   â”œâ”€â”€ yolov3_vargdarknet</span><br><span class="line">â”‚   â”‚   â”‚   â””â”€â”€ yolov5x</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ segmentation              # åˆ†å‰²æ¨¡å‹ç¤ºä¾‹</span><br><span class="line">â”‚   â”‚   â”‚   â”œâ”€â”€ deeplabv3plus_efficientnetb0</span><br><span class="line">â”‚   â”‚   â”‚   â”œâ”€â”€ deeplabv3plus_efficientnetm1</span><br><span class="line">â”‚   â”‚   â”‚   â”œâ”€â”€ deeplabv3plus_efficientnetm2</span><br><span class="line">â”‚   â”‚   â”‚   â””â”€â”€ fastscnn_efficientnetb0</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ env.sh                    # åŸºç¡€ç¯å¢ƒè„šæœ¬</span><br><span class="line">â”‚   â”‚   â””â”€â”€ README.md</span><br><span class="line">â”‚   â””â”€â”€ tools                         # ç²¾åº¦è¯„æµ‹å·¥å…·</span><br><span class="line">â”‚       â”œâ”€â”€ python_tools</span><br><span class="line">â”‚       â””â”€â”€ README.md</span><br><span class="line">â””â”€â”€ qat                               # QATæ–¹æ¡ˆæ¨¡å‹ç¤ºä¾‹</span><br><span class="line">    â”œâ”€â”€ data                          # æ¨¡å‹ç²¾åº¦è¯„æµ‹æ•°æ®é›†</span><br><span class="line">    â”œâ”€â”€ mini_data                     # æ¨¡å‹æ€§èƒ½è¯„æµ‹æ•°æ®é›†</span><br><span class="line">    â”œâ”€â”€ model                         # QATæ–¹æ¡ˆnv12æ¨¡å‹</span><br><span class="line">    â”‚   â”œâ”€â”€ README.md</span><br><span class="line">    â”‚   â””â”€â”€ runtime -&gt; ../../../../model_zoo/runtime/ai_benchmark/qat    # è½¯é“¾æ¥æŒ‡å‘OEåŒ…ä¸­çš„æ¨¡å‹ï¼Œæ¿ç«¯è¿è¡Œç¯å¢ƒéœ€è¦è‡ªè¡ŒæŒ‡å®šæ¨¡å‹è·¯å¾„</span><br><span class="line">    â”œâ”€â”€ README.md</span><br><span class="line">    â”œâ”€â”€ script                        # æ‰§è¡Œè„šæœ¬</span><br><span class="line">    â”‚   â”œâ”€â”€ aarch64                   # ç¼–è¯‘äº§ç”Ÿå¯æ‰§è¡Œæ–‡ä»¶åŠä¾èµ–åº“</span><br><span class="line">    â”‚   â”œâ”€â”€ classification            # åˆ†ç±»æ¨¡å‹ç¤ºä¾‹</span><br><span class="line">    â”‚   â”‚   â”œâ”€â”€ mixvargenet</span><br><span class="line">    â”‚   â”‚   â”œâ”€â”€ mobilenetv1</span><br><span class="line">    â”‚   â”‚   â”œâ”€â”€ mobilenetv2</span><br><span class="line">    â”‚   â”‚   â”œâ”€â”€ resnet18</span><br><span class="line">    â”‚   â”‚   â”œâ”€â”€ resnet50</span><br><span class="line">    â”‚   â”‚   â”œâ”€â”€ swint</span><br><span class="line">    â”‚   â”‚   â””â”€â”€ vargnetv2</span><br><span class="line">    â”‚   â”œâ”€â”€ config                    # æ¨¡å‹æ¨ç†é…ç½®æ–‡ä»¶</span><br><span class="line">    â”‚   â”‚   â””â”€â”€ model</span><br><span class="line">    â”‚   â”œâ”€â”€ detection                 # æ£€æµ‹æ¨¡å‹ç¤ºä¾‹</span><br><span class="line">    â”‚   â”‚   â”œâ”€â”€ detr_efficientnetb3</span><br><span class="line">    â”‚   â”‚   â”œâ”€â”€ detr_resnet50</span><br><span class="line">    â”‚   â”‚   â”œâ”€â”€ fcos_efficientnetb0</span><br><span class="line">    â”‚   â”‚   â”œâ”€â”€ fcos3d_efficientnetb0</span><br><span class="line">    â”‚   â”‚   â”œâ”€â”€ ganet</span><br><span class="line">    â”‚   â”‚   â”œâ”€â”€ retinanet</span><br><span class="line">    â”‚   â”‚   â”œâ”€â”€ pointpillars_kitti_car</span><br><span class="line">    â”‚   â”‚   â””â”€â”€ yolov3_mobilenetv1</span><br><span class="line">    â”‚   â”œâ”€â”€ opticalflow               # å…‰æµæ¨¡å‹ç¤ºä¾‹</span><br><span class="line">    â”‚   â”‚   â””â”€â”€ pwcnet_opticalflow</span><br><span class="line">    â”‚   â”œâ”€â”€ segmentation              # åˆ†å‰²æ¨¡å‹ç¤ºä¾‹</span><br><span class="line">    â”‚   â”‚   â””â”€â”€ mobilenet_unet</span><br><span class="line">    â”‚   â”œâ”€â”€ env.sh                    # åŸºç¡€ç¯å¢ƒè„šæœ¬</span><br><span class="line">    â”‚   â””â”€â”€ README.md</span><br><span class="line">    â””â”€â”€ tools                         # å‰å¤„ç†åŠç²¾åº¦è¯„æµ‹å·¥å…·</span><br><span class="line">        â”œâ”€â”€ eval_preprocess</span><br><span class="line">        â”œâ”€â”€ python_tools</span><br><span class="line">        â””â”€â”€ README.md</span><br></pre></td></tr></table></figure></div>

<ul>
<li><p><strong>code</strong>ï¼šè¯¥ç›®å½•å†…æ˜¯è¯„æµ‹ç¨‹åºçš„æºç ï¼Œç”¨æ¥è¿›è¡Œæ¨¡å‹æ€§èƒ½å’Œç²¾åº¦è¯„æµ‹ã€‚</p>
</li>
<li><p><strong>j5</strong>ï¼šè¯¥ç›®å½•å†…æä¾›äº†å·²ç»ç¼–è¯‘å¥½çš„åº”ç”¨ç¨‹åºï¼Œä»¥åŠå„ç§è¯„æµ‹è„šæœ¬ï¼Œç”¨æ¥æµ‹è¯•å¤šç§æ¨¡å‹åœ¨åœ°å¹³çº¿BPUä¸Šè¿è¡Œçš„æ€§èƒ½å’Œç²¾åº¦ç­‰ã€‚</p>
</li>
<li><p><strong>build_ptq_j5.sh</strong>ï¼šPTQçœŸæœºç¨‹åºä¸€é”®ç¼–è¯‘è„šæœ¬ã€‚</p>
</li>
<li><p><strong>build_qat_j5.sh</strong>ï¼šQATçœŸæœºç¨‹åºä¸€é”®ç¼–è¯‘è„šæœ¬ã€‚</p>
</li>
<li><p><strong>deps_gcc9.3</strong>ï¼šç¤ºä¾‹ä»£ç æ‰€éœ€è¦çš„ä¾èµ–ï¼Œä¸»è¦å¦‚ä¸‹æ‰€ç¤º:</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">appsdk  gflags  glog  hobotlog  nlohmann  opencv  rapidjson</span><br></pre></td></tr></table></figure></div></li>
</ul>
<h5 id="ç¤ºä¾‹æ¨¡å‹"><a href="#ç¤ºä¾‹æ¨¡å‹" class="headerlink" title="ç¤ºä¾‹æ¨¡å‹"></a>ç¤ºä¾‹æ¨¡å‹</h5><p>AI Benchmarkç¤ºä¾‹åŒ…çš„PTQæ¨¡å‹å’ŒQATæ¨¡å‹å‘å¸ƒç‰©model_zooåˆ†åˆ«ä½äº <code>horizon_j5_open_explorer</code> å‘å¸ƒç‰©çš„ <code>ddk/samples/ai_toolchain/model_zoo/runtime/ai_benchmark/ptq</code> å’Œ <code>ddk/samples/ai_toolchain/model_zoo/runtime/ai_benchmark/qat</code> è·¯å¾„ä¸‹ï¼Œ é‡Œé¢åŒ…å«å¸¸ç”¨çš„åˆ†ç±»ã€æ£€æµ‹ã€åˆ†å‰²å’Œå…‰æµé¢„æµ‹æ¨¡å‹ï¼Œæ¨¡å‹çš„å‘½åè§„åˆ™ä¸ºï¼š <code>&#123;model_name&#125;_&#123;backbone&#125;_&#123;input_size&#125;_&#123;input_type&#125;</code>ã€‚ model_zooé‡Œçš„PTQæ¨¡å‹éƒ½æ˜¯é€šè¿‡PTQæ¨¡å‹è½¬æ¢ç¤ºä¾‹åŒ…ï¼ˆå³ï¼š <code>ddk/samples/ai_toolchain/horizon_model_convert_sample/</code>ï¼‰ç¼–è¯‘å‡ºæ¥çš„ã€‚ åŸå§‹æ¨¡å‹è¯¦ç»†ä¿¡æ¯å¯ä»¥æŸ¥çœ‹PTQæ¨¡å‹è½¬æ¢ç¤ºä¾‹åŒ…ä¸­å„æ¨¡å‹è‡ªè·¯å¾„ä¸‹çš„READMEæ–‡æ¡£æˆ–é˜…è¯» <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/ptq/ptq_sample/ptq_sample.html" >PTQæ¨¡å‹è½¬æ¢ç¤ºä¾‹æ‰‹å†Œ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> äº†è§£æ›´å¤šã€‚</p>
<table>
<thead>
<tr>
<th align="left">PTQMODEL</th>
<th align="left">MODEL NAME</th>
</tr>
</thead>
<tbody><tr>
<td align="left">centernet_resnet101</td>
<td align="left">centernet_resnet101_512x512_nv12.bin</td>
</tr>
<tr>
<td align="left">deeplabv3plus_efficientnetb0</td>
<td align="left">deeplabv3plus_efficientnetb0_1024x2048_nv12.bin</td>
</tr>
<tr>
<td align="left">deeplabv3plus_efficientnetm1</td>
<td align="left">deeplabv3plus_efficientnetm1_1024x2048_nv12.bin</td>
</tr>
<tr>
<td align="left">deeplabv3plus_efficientnetm2</td>
<td align="left">deeplabv3plus_efficientnetm2_1024x2048_nv12.bin</td>
</tr>
<tr>
<td align="left">efficientnasnet_m</td>
<td align="left">efficientnasnet_m_300x300_nv12.bin</td>
</tr>
<tr>
<td align="left">efficientnasnet_s</td>
<td align="left">efficientnasnet_s_280x280_nv12.bin</td>
</tr>
<tr>
<td align="left">efficientnet_lite0</td>
<td align="left">efficientnet_lite0_224x224_nv12.bin</td>
</tr>
<tr>
<td align="left">efficientnet_lite1</td>
<td align="left">efficientnet_lite1_240x240_nv12.bin</td>
</tr>
<tr>
<td align="left">efficientnet_lite2</td>
<td align="left">efficientnet_lite2_260x260_nv12.bin</td>
</tr>
<tr>
<td align="left">efficientnet_lite3</td>
<td align="left">efficientnet_lite3_280x280_nv12.bin</td>
</tr>
<tr>
<td align="left">efficientnet_lite4</td>
<td align="left">efficientnet_lite4_300x300_nv12.bin</td>
</tr>
<tr>
<td align="left">fastscnn_efficientnetb0</td>
<td align="left">fastscnn_efficientnetb0_1024x2048_nv12.bin</td>
</tr>
<tr>
<td align="left">preq_qat_fcos_efficientnetb0</td>
<td align="left">fcos_efficientnetb0_512x512_nv12.bin</td>
</tr>
<tr>
<td align="left">preq_qat_fcos_efficientnetb2</td>
<td align="left">fcos_efficientnetb2_768x768_nv12.bin</td>
</tr>
<tr>
<td align="left">preq_qat_fcos_efficientnetb3</td>
<td align="left">fcos_efficientnetb3_896x896_nv12.bin</td>
</tr>
<tr>
<td align="left">googlenet</td>
<td align="left">googlenet_224x224_nv12.bin</td>
</tr>
<tr>
<td align="left">mobilenetv1</td>
<td align="left">mobilenetv1_224x224_nv12.bin</td>
</tr>
<tr>
<td align="left">mobilenetv1_128x128_resizer_nv12.bin</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">mobilenetv2</td>
<td align="left">mobilenetv2_224x224_nv12.bin</td>
</tr>
<tr>
<td align="left">resnet18</td>
<td align="left">resnet18_224x224_nv12.bin</td>
</tr>
<tr>
<td align="left">ssd_mobilenetv1</td>
<td align="left">ssd_mobilenetv1_300x300_nv12.bin</td>
</tr>
<tr>
<td align="left">vargconvnet</td>
<td align="left">vargconvnet_224x224_nv12.bin</td>
</tr>
<tr>
<td align="left">yolov2_darknet19</td>
<td align="left">yolov2_darknet19_608x608_nv12.bin</td>
</tr>
<tr>
<td align="left">yolov3_darknet53</td>
<td align="left">yolov3_darknet53_416x416_nv12.bin</td>
</tr>
<tr>
<td align="left">yolov3_vargdarknet</td>
<td align="left">yolov3_vargdarknet_416x416_nv12.bin</td>
</tr>
<tr>
<td align="left">yolov5x</td>
<td align="left">yolov5x_672x672_nv12.bin</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th align="left">QATMODEL</th>
<th align="left">MODEL NAME</th>
</tr>
</thead>
<tbody><tr>
<td align="left">detr_efficientnetb3</td>
<td align="left">detr_efficientnetb3_mscoco&#x2F;compile&#x2F;model.hbm</td>
</tr>
<tr>
<td align="left">detr_resnet50</td>
<td align="left">detr_resnet50_mscoco&#x2F;compile&#x2F;model.hbm</td>
</tr>
<tr>
<td align="left">fcos_efficientnetb0</td>
<td align="left">fcos_efficientnetb0_mscoco&#x2F;compile&#x2F;model.hbm</td>
</tr>
<tr>
<td align="left">fcos3d_efficientnetb0</td>
<td align="left">fcos3d_efficientnetb0_nuscenes&#x2F;compile&#x2F;model.hbm</td>
</tr>
<tr>
<td align="left">ganet</td>
<td align="left">ganet_mixvargenet_culane&#x2F;compile&#x2F;model.hbm</td>
</tr>
<tr>
<td align="left">mixvargenet</td>
<td align="left">mixvargenet_cls&#x2F;compile&#x2F;model.hbm</td>
</tr>
<tr>
<td align="left">mobilenet_unet</td>
<td align="left">dwunet_seg&#x2F;compile&#x2F;model.hbm</td>
</tr>
<tr>
<td align="left">mobilenetv1</td>
<td align="left">mobilenetv1_cls&#x2F;compile&#x2F;model.hbm</td>
</tr>
<tr>
<td align="left">mobilenetv2</td>
<td align="left">mobilenetv2_cls&#x2F;compile&#x2F;model.hbm</td>
</tr>
<tr>
<td align="left">pwcnet_opticalflow</td>
<td align="left">pwcnet_opticalflow&#x2F;compile&#x2F;model.hbm</td>
</tr>
<tr>
<td align="left">resnet18</td>
<td align="left">resnet18_cls&#x2F;compile&#x2F;model.hbm</td>
</tr>
<tr>
<td align="left">resnet50</td>
<td align="left">resnet50_cls&#x2F;compile&#x2F;model.hbm</td>
</tr>
<tr>
<td align="left">retinanet</td>
<td align="left">retinanet_vargnetv2_fpn_mscoco&#x2F;compile&#x2F;model.hbm</td>
</tr>
<tr>
<td align="left">swint</td>
<td align="left">horizon_swin_transformer_cls&#x2F;compile&#x2F;model.hbm</td>
</tr>
<tr>
<td align="left">vargnetv2</td>
<td align="left">vargnetv2_cls&#x2F;compile&#x2F;model.hbm</td>
</tr>
<tr>
<td align="left">yolov3_mobilenetv1</td>
<td align="left">yolo_mobilenetv1_det&#x2F;compile&#x2F;model.hbm</td>
</tr>
<tr>
<td align="left">pointpillars_kitti_car</td>
<td align="left">pointpillars_kitti_car&#x2F;compile&#x2F;model.hbm</td>
</tr>
</tbody></table>
<h5 id="å…¬å…±æ•°æ®é›†"><a href="#å…¬å…±æ•°æ®é›†" class="headerlink" title="å…¬å…±æ•°æ®é›†"></a>å…¬å…±æ•°æ®é›†</h5><p>ç¤ºä¾‹ä¸­ç”¨åˆ°çš„æ•°æ®é›†ä¸»è¦æœ‰VOCæ•°æ®é›†ã€COCOæ•°æ®é›†ã€ImageNetæ•°æ®é›†ã€Cityscapesæ•°æ®é›†ã€FlyingChairsæ•°æ®é›†ã€KITTIæ•°æ®é›†ã€Culaneæ•°æ®é›†å’ŒNuscenesæ•°æ®é›†ã€‚ è·å–æ–¹å¼å¦‚ä¸‹ï¼Œæ•°æ®å‡†å¤‡è¿‡ç¨‹ä¸­å¦‚é‡é—®é¢˜è¯·è”ç³»åœ°å¹³çº¿ã€‚</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">VOCï¼šhttp://host.robots.ox.ac.uk/pascal/VOC/  ï¼ˆä½¿ç”¨VOC2012ç‰ˆæœ¬ï¼‰</span><br><span class="line">COCOï¼šhttps://cocodataset.org/#download</span><br><span class="line">ImageNetï¼šhttps://www.image-net.org/download.php</span><br><span class="line">Cityscapesï¼šhttps://github.com/mcordts/cityscapesScripts</span><br><span class="line">FlyingChairsï¼šhttps://lmb.informatik.uni-freiburg.de/resources/datasets/FlyingChairs.en.html</span><br><span class="line">KITTI3Dï¼šhttps://www.cvlibs.net/datasets/kitti/eval_object.php?obj_benchmark=3d</span><br><span class="line">CULaneï¼šhttps://xingangpan.github.io/projects/CULane.html</span><br><span class="line">nuScenesï¼šhttps://www.nuscenes.org/nuscenes#download</span><br></pre></td></tr></table></figure></div>



<h4 id="ç¯å¢ƒæ„å»º"><a href="#ç¯å¢ƒæ„å»º" class="headerlink" title="ç¯å¢ƒæ„å»º"></a>ç¯å¢ƒæ„å»º</h4><h5 id="å¼€å‘æ¿å‡†å¤‡-1"><a href="#å¼€å‘æ¿å‡†å¤‡-1" class="headerlink" title="å¼€å‘æ¿å‡†å¤‡"></a>å¼€å‘æ¿å‡†å¤‡</h5><p>1.æ‹¿åˆ°å¼€å‘æ¿åï¼ŒæŒ‰ç…§ <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/appendix/hardware/system_image.html" >ç³»ç»Ÿé•œåƒå‡çº§ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ä¸­çš„è¯´æ˜ï¼Œå‡çº§ç³»ç»Ÿé•œåƒåˆ°ç¤ºä¾‹åŒ…æ¨èçš„ç³»ç»Ÿé•œåƒç‰ˆæœ¬ã€‚</p>
<p>2.ç¡®ä¿æœ¬åœ°å¼€å‘æœºå’Œå¼€å‘æ¿å¯ä»¥è¿œç¨‹è¿æ¥ã€‚</p>
<h5 id="ç¼–è¯‘-1"><a href="#ç¼–è¯‘-1" class="headerlink" title="ç¼–è¯‘"></a>ç¼–è¯‘</h5><p>ç¼–è¯‘éœ€è¦å½“å‰ç¯å¢ƒå®‰è£…å¥½äº¤å‰ç¼–è¯‘å·¥å…·gcc-ubuntu-9.3.0-2020.03-x86_64-aarch64-linux-gnuã€‚ ç„¶åæ‰§è¡Œ <strong>code</strong> ç›®å½•ä¸‹çš„<code>build_ptq_j5.sh</code>è„šæœ¬å³å¯ä¸€é”®ç¼–è¯‘çœŸæœºç¯å¢ƒä¸‹çš„å¯æ‰§è¡Œç¨‹åºï¼Œå¯æ‰§è¡Œ ç¨‹åºå’Œå¯¹åº”ä¾èµ–ä¼šè‡ªåŠ¨å¤åˆ¶åˆ° <strong>j5&#x2F;ptq&#x2F;script</strong> ç›®å½•ä¸‹çš„ <strong>aarch64</strong> ç›®å½•ä¸‹ã€‚</p>
<blockquote>
<p>è¦æ³¨æ„build_ptq_j5.shè„šæœ¬é‡ŒæŒ‡å®šçš„äº¤å‰ç¼–è¯‘å·¥å…·é“¾çš„ä½ç½®æ˜¯ <strong>&#x2F;opt</strong> ç›®å½•ä¸‹ï¼Œç”¨æˆ·å¦‚æœå®‰è£…åœ¨å…¶ä»–ä½ç½®ï¼Œéœ€è¦æ‰‹åŠ¨ä¿®æ”¹ä¸‹build_ptq_j5.shã€‚</p>
</blockquote>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export CC=/opt/gcc-ubuntu-9.3.0-2020.03-x86_64-aarch64-linux-gnu/bin/aarch64-linux-gnu-gcc</span><br><span class="line">export CXX=/opt/gcc-ubuntu-9.3.0-2020.03-x86_64-aarch64-linux-gnu/bin/aarch64-linux-gnu-g++</span><br></pre></td></tr></table></figure></div>



<h4 id="ç¤ºä¾‹ä½¿ç”¨-1"><a href="#ç¤ºä¾‹ä½¿ç”¨-1" class="headerlink" title="ç¤ºä¾‹ä½¿ç”¨"></a>ç¤ºä¾‹ä½¿ç”¨</h4><h5 id="è¯„æµ‹ç¤ºä¾‹"><a href="#è¯„æµ‹ç¤ºä¾‹" class="headerlink" title="è¯„æµ‹ç¤ºä¾‹"></a>è¯„æµ‹ç¤ºä¾‹</h5><p>è¯„æµ‹ç¤ºä¾‹è„šæœ¬ä¸»è¦åœ¨ <strong>script</strong> å’Œ <strong>tools</strong> ç›®å½•ä¸‹ã€‚ <strong>script</strong> æ˜¯æ¿ä¸Šè¿è¡Œçš„<strong>è¯„æµ‹è„šæœ¬</strong>ï¼ŒåŒ…æ‹¬å¸¸è§åˆ†ç±»ã€æ£€æµ‹ã€åˆ†å‰²å’Œå…‰æµé¢„æµ‹æ¨¡å‹ã€‚ æ¯ä¸ªæ¨¡å‹ä¸‹é¢æœ‰ä»¥ä¸‹ä¸‰ä¸ªè„šæœ¬ï¼š</p>
<ul>
<li>fps.shï¼šå®ç°å¤šçº¿ç¨‹fpsç»Ÿè®¡ï¼ˆå¤šçº¿ç¨‹è°ƒåº¦ï¼Œç”¨æˆ·å¯ä»¥æ ¹æ®éœ€æ±‚è‡ªç”±è®¾ç½®çº¿ç¨‹æ•°ï¼‰ã€‚</li>
<li>latency.shï¼šå®ç°å•å¸§å»¶è¿Ÿæ€§èƒ½ç»Ÿè®¡ï¼ˆä¸€ä¸ªçº¿ç¨‹ï¼Œå•å¸§ï¼‰ã€‚</li>
<li>accuracy.shï¼šç”¨äºç²¾åº¦è¯„æµ‹ã€‚</li>
</ul>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">script:</span><br><span class="line"></span><br><span class="line">â”œâ”€â”€ aarch64                     # ç¼–è¯‘äº§ç”Ÿçš„å¯æ‰§è¡Œæ–‡ä»¶åŠä¾èµ–åº“</span><br><span class="line">â”‚   â”œâ”€â”€ bin</span><br><span class="line">â”‚   â””â”€â”€ lib</span><br><span class="line">â”œâ”€â”€ env.sh                      # åŸºç¡€é…ç½®</span><br><span class="line">â”œâ”€â”€ config                      # image_nameé…ç½®æ–‡ä»¶</span><br><span class="line">â”‚   â””â”€â”€ model</span><br><span class="line">â”‚       â””â”€â”€ data_name_list</span><br><span class="line">â”œâ”€â”€ detection                   # æ£€æµ‹æ¨¡å‹</span><br><span class="line">â”‚   â”œâ”€â”€ fcos_efficientnetb0     # åœ¨æ­¤ç›®å½•ä¸­è¿˜æœ‰å…¶ä»–æ¨¡å‹, ä»…ä»¥æ­¤æ¨¡å‹ç›®å½•ä¸ºå‚è€ƒ</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ accuracy.sh</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ fps.sh</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ latency.sh</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ workflow_accuracy.json</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ workflow_fps.json</span><br><span class="line">â”‚   â”‚   â”œâ”€â”€ workflow_latency.json</span><br><span class="line">â”‚   ......</span><br><span class="line">â”œâ”€â”€ classification              # åˆ†ç±»æ¨¡å‹</span><br><span class="line">â”œâ”€â”€ segmentation                # åˆ†å‰²æ¨¡å‹</span><br><span class="line">â”œâ”€â”€ opticalflow                 # å…‰æµæ¨¡å‹(qat)</span><br><span class="line">â””â”€â”€ README.md</span><br></pre></td></tr></table></figure></div>

<p><strong>(PTQ)tools</strong> PTQç›®å½•ä¸‹<strong>ç²¾åº¦è¯„æµ‹</strong>éœ€è¦çš„è„šæœ¬ã€‚ä¸»è¦åŒ…æ‹¬ <strong>python_tools</strong> ä¸‹çš„ç²¾åº¦è®¡ç®—è„šæœ¬ã€‚</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">tools:</span><br><span class="line"></span><br><span class="line">python_tools</span><br><span class="line">  â””â”€â”€ accuracy_tools</span><br><span class="line">      â”œâ”€â”€ cityscapes_metric.py</span><br><span class="line">      â”œâ”€â”€ cls_eval.py</span><br><span class="line">      â”œâ”€â”€ coco_metric.py</span><br><span class="line">      â”œâ”€â”€ config.py</span><br><span class="line">      â”œâ”€â”€ coco_det_eval.py</span><br><span class="line">      â”œâ”€â”€ parsing_eval.py</span><br><span class="line">      â””â”€â”€ voc_det_eval.py</span><br><span class="line">      â””â”€â”€ voc_metric.py</span><br></pre></td></tr></table></figure></div>

<p><strong>(QAT)tools</strong> QATç›®å½•ä¸‹ç²¾åº¦è¯„æµ‹éœ€è¦çš„è„šæœ¬ã€‚ä¸»è¦åŒ…æ‹¬å‰å¤„ç†è„šæœ¬åŠç²¾åº¦è®¡ç®—è„šæœ¬ã€‚</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">tools:</span><br><span class="line"></span><br><span class="line">tools/</span><br><span class="line">  â”œâ”€â”€ eval_preprocess</span><br><span class="line">  â”‚     â”œâ”€â”€ detr_process.py</span><br><span class="line">  â”‚     â”œâ”€â”€ fcos_process.py</span><br><span class="line">  â”‚     â”œâ”€â”€ fcos3d_process.py</span><br><span class="line">  â”‚     â”œâ”€â”€ ganet_process.py</span><br><span class="line">  â”‚     â”œâ”€â”€ imagenet.py</span><br><span class="line">  â”‚     â”œâ”€â”€ pwcnet_process.py</span><br><span class="line">  â”‚     â”œâ”€â”€ retinanet_process.py</span><br><span class="line">  â”‚     â”œâ”€â”€ pointpillars_process.py</span><br><span class="line">  â”‚     â””â”€â”€ voc.py</span><br><span class="line">  â”œâ”€â”€ python_tools</span><br><span class="line">  â”‚     â””â”€â”€ accuracy_tools</span><br><span class="line">  â”‚         â”œâ”€â”€ cityscapes_metric.py</span><br><span class="line">  â”‚         â”œâ”€â”€ cls_eval.py</span><br><span class="line">  â”‚         â”œâ”€â”€ coco_metric.py</span><br><span class="line">  â”‚         â”œâ”€â”€ config.py</span><br><span class="line">  â”‚         â”œâ”€â”€ detr_eval.py</span><br><span class="line">  â”‚         â”œâ”€â”€ fcos_eval.py</span><br><span class="line">  â”‚         â”œâ”€â”€ fcos3d_eval.py</span><br><span class="line">  â”‚         â”œâ”€â”€ ganet_eval.py</span><br><span class="line">  â”‚         â”œâ”€â”€ parsing_eval.py</span><br><span class="line">  â”‚         â”œâ”€â”€ pwcnet_eval.py</span><br><span class="line">  â”‚         â””â”€â”€ retinanet_eval.py</span><br><span class="line">  â”‚         â””â”€â”€ voc_metric.py</span><br><span class="line">  â”‚         â””â”€â”€ kitti3d_metric.py</span><br><span class="line">  â”‚         â””â”€â”€ pointpillars_eval.py</span><br><span class="line">  â”‚         â””â”€â”€ yolov3_eval.py</span><br><span class="line">  â””â”€â”€ README.md</span><br></pre></td></tr></table></figure></div>

<p><strong>æ³¨æ„ï¼šè¯„æµ‹å‰éœ€è¦æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œå°† ptq ï¼ˆ qat ï¼‰ ç›®å½•æ‹·è´åˆ°å¼€å‘æ¿ä¸Šã€‚</strong></p>
<blockquote>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">scp -r ddk/samples/ai_benchmark/j5/ptq root@192.168.1.1:/userdata/ptq/</span><br><span class="line">scp -r ddk/samples/ai_benchmark/j5/qat root@192.168.1.1:/userdata/qat/</span><br></pre></td></tr></table></figure></div>
</blockquote>
<h5 id="æ€§èƒ½è¯„æµ‹"><a href="#æ€§èƒ½è¯„æµ‹" class="headerlink" title="æ€§èƒ½è¯„æµ‹"></a>æ€§èƒ½è¯„æµ‹</h5><p>æ€§èƒ½è¯„æµ‹åˆ†ä¸ºlatencyå’Œfpsä¸¤æ–¹é¢ã€‚</p>
<blockquote>
<p>ä½¿ç”¨è¯´æ˜</p>
</blockquote>
<p>latency:</p>
<p>è¿›å…¥åˆ°éœ€è¦è¯„æµ‹çš„æ¨¡å‹ç›®å½•ä¸‹ï¼Œæ‰§è¡Œ <code>sh latency.sh</code> å³å¯æµ‹è¯•å‡ºå•å¸§å»¶è¿Ÿã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">I0419 02:35:07.041095 39124 output_plugin.cc:80]  Infer latency:  [avg:  13.124ms,  max:  13.946ms,  min:  13.048ms], Post process latency: [avg:  3.584ms,  max:  3.650ms,  min:  3.498ms].</span><br></pre></td></tr></table></figure></div>

<p>æ³¨æ„ï¼š</p>
<ul>
<li><code>infer</code> è¡¨ç¤ºæ¨¡å‹æ¨ç†è€—æ—¶ã€‚</li>
<li><code>Post process</code> è¡¨ç¤ºåå¤„ç†è€—æ—¶ã€‚</li>
</ul>
<p>fpsï¼šè¯¥åŠŸèƒ½é‡‡ç”¨å¤šçº¿ç¨‹å¹¶å‘æ–¹å¼ï¼Œæ—¨åœ¨è®©æ¨¡å‹å¯ä»¥åœ¨BPUä¸Šè¾¾åˆ°æè‡´çš„æ€§èƒ½ã€‚ç”±äºå¤šçº¿ç¨‹å¹¶å‘åŠæ•°æ®é‡‡æ ·çš„åŸå› ï¼Œåœ¨ç¨‹åºå¯åŠ¨é˜¶æ®µå¸§ç‡å€¼ä¼šè¾ƒä½ï¼Œä¹‹åå¸§ç‡ä¼šä¸Šå‡å¹¶é€æ¸è¶‹äºç¨³å®šï¼Œå¸§ç‡çš„æµ®åŠ¨èŒƒå›´æ§åˆ¶åœ¨0.5%ä¹‹å†…ã€‚ è¿›å…¥åˆ°éœ€è¦è¯„æµ‹çš„æ¨¡å‹ç›®å½•ä¸‹æ‰§è¡Œ <code>sh fps.sh</code> å³å¯æµ‹è¯•å‡ºå¸§ç‡ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š<code>I0419 02:35:00.044417 39094 output_plugin.cc:109]  Throughput: 1129.39fps      # æ¨¡å‹å¸§ç‡</code></p>
<blockquote>
<p>å‘½ä»¤è¡Œå‚æ•°è¯´æ˜</p>
</blockquote>
<p>è¯¥åŠŸèƒ½é‡‡ç”¨å¤šçº¿ç¨‹å¹¶å‘æ–¹å¼ï¼Œæ—¨åœ¨è®©æ¨¡å‹å¯ä»¥åœ¨BPUä¸Šè¾¾åˆ°æè‡´çš„æ€§èƒ½ã€‚ç”±äºå¤šçº¿ç¨‹å¹¶å‘åŠæ•°æ®é‡‡æ ·çš„åŸå› ï¼Œåœ¨ç¨‹åºå¯åŠ¨é˜¶æ®µå¸§ç‡å€¼ä¼šè¾ƒä½ï¼Œä¹‹åå¸§ç‡ä¼šä¸Šå‡å¹¶é€æ¸è¶‹äºç¨³å®šï¼Œå¸§ç‡çš„æµ®åŠ¨èŒƒå›´æ§åˆ¶åœ¨0.5%ä¹‹å†…ã€‚ è¿›å…¥åˆ°éœ€è¦è¯„æµ‹çš„æ¨¡å‹ç›®å½•ä¸‹æ‰§è¡Œ <code>sh fps.sh</code> å³å¯æµ‹è¯•å‡ºå¸§ç‡ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">I0419 02:35:00.044417 39094 output_plugin.cc:109]  Throughput: 1129.39fps      # æ¨¡å‹å¸§ç‡</span><br></pre></td></tr></table></figure></div>

<h6 id="å‘½ä»¤è¡Œå‚æ•°è¯´æ˜"><a href="#å‘½ä»¤è¡Œå‚æ•°è¯´æ˜" class="headerlink" title="å‘½ä»¤è¡Œå‚æ•°è¯´æ˜"></a>å‘½ä»¤è¡Œå‚æ•°è¯´æ˜</h6><p>fps.shè„šæœ¬å†…å®¹å¦‚ä¸‹ï¼š</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/sh</span><br><span class="line"></span><br><span class="line">source ../../env.sh</span><br><span class="line">export SHOW_FPS_LOG=1</span><br><span class="line">export STAT_CYCLE=100                             # è®¾ç½®ç¯å¢ƒå˜é‡ï¼ŒFPS ç»Ÿè®¡å‘¨æœŸ</span><br><span class="line"></span><br><span class="line">$&#123;app&#125; \</span><br><span class="line">  --config_file=workflow_fps.json \</span><br><span class="line">  --log_level=1</span><br></pre></td></tr></table></figure></div>

<p>latency.shè„šæœ¬å†…å®¹å¦‚ä¸‹ï¼š</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/sh</span><br><span class="line"></span><br><span class="line">source ../../env.sh</span><br><span class="line">export SHOW_LATENCY_LOG=1                         # è®¾ç½®ç¯å¢ƒå˜é‡ï¼Œæ‰“å° LATENCY çº§åˆ«log</span><br><span class="line">export STAT_CYCLE=50                              # è®¾ç½®ç¯å¢ƒå˜é‡ï¼ŒLATENCY ç»Ÿè®¡å‘¨æœŸ</span><br><span class="line"></span><br><span class="line">$&#123;app&#125; \</span><br><span class="line">  --config_file=workflow_latency.json \</span><br><span class="line">  --log_level=1</span><br></pre></td></tr></table></figure></div>



<h6 id="é…ç½®æ–‡ä»¶è¯´æ˜"><a href="#é…ç½®æ–‡ä»¶è¯´æ˜" class="headerlink" title="é…ç½®æ–‡ä»¶è¯´æ˜"></a>é…ç½®æ–‡ä»¶è¯´æ˜</h6><blockquote>
<p>æ³¨æ„ï¼šmax_cacheå‚æ•°ç”Ÿæ•ˆæ—¶ä¼šé¢„å¤„ç†å›¾ç‰‡å¹¶è¯»å–åˆ°å†…å­˜ä¸­ï¼Œä¸ºä¿éšœæ‚¨çš„ç¨‹åºç¨³å®šè¿è¡Œï¼Œè¯·ä¸è¦è®¾ç½®è¿‡å¤§çš„å€¼ï¼Œå»ºè®®æ‚¨çš„æ•°å€¼è®¾ç½®ä¸è¶…è¿‡30ã€‚</p>
</blockquote>
<p>ä»¥centernet_resnet101æ¨¡å‹ä¸ºä¾‹ï¼Œworkflow_fps.jsoné…ç½®æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</p>
<div class="highlight-container" data-rel="Json"><figure class="iseeu highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;input_config&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;input_type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;image&quot;</span><span class="punctuation">,</span>                                  # è¾“å…¥æ•°æ®æ ¼å¼ï¼Œæ”¯æŒå›¾åƒæˆ–è€…binæ–‡ä»¶</span><br><span class="line">    <span class="attr">&quot;height&quot;</span><span class="punctuation">:</span> <span class="number">512</span><span class="punctuation">,</span>                                          # è¾“å…¥æ•°æ®é«˜åº¦</span><br><span class="line">    <span class="attr">&quot;width&quot;</span><span class="punctuation">:</span> <span class="number">512</span><span class="punctuation">,</span>                                           # è¾“å…¥æ•°æ®å®½åº¦</span><br><span class="line">    <span class="attr">&quot;data_type&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span>                                         # è¾“å…¥æ•°æ®ç±»å‹ï¼šHB_DNN_IMG_TYPE_NV12</span><br><span class="line">    <span class="attr">&quot;image_list_file&quot;</span><span class="punctuation">:</span> <span class="string">&quot;../../../mini_data/coco/coco.lst&quot;</span><span class="punctuation">,</span>  # é¢„å¤„ç†æ•°æ®é›†lstæ–‡ä»¶æ‰€åœ¨è·¯å¾„</span><br><span class="line">    <span class="attr">&quot;need_pre_load&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span>                                  # æ˜¯å¦ä½¿ç”¨é¢„åŠ è½½æ–¹å¼è¯»å–æ•°æ®é›†</span><br><span class="line">    <span class="attr">&quot;limit&quot;</span><span class="punctuation">:</span> <span class="number">12</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;need_loop&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span>                                      # æ˜¯å¦å¾ªç¯è¯»å–æ•°æ®è¿›è¡Œè¯„æµ‹</span><br><span class="line">    <span class="attr">&quot;max_cache&quot;</span><span class="punctuation">:</span> <span class="number">10</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;output_config&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;output_type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;image&quot;</span><span class="punctuation">,</span>                                 # å¯è§†åŒ–è¾“å‡ºæ•°æ®ç±»å‹</span><br><span class="line">    <span class="attr">&quot;image_list_enable&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;in_order&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span>                                       # æ˜¯å¦æŒ‰é¡ºåºè¾“å‡º</span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;workflow&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;method_type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;InferMethod&quot;</span><span class="punctuation">,</span>                         # Inferæ¨ç†æ–¹å¼</span><br><span class="line">      <span class="attr">&quot;unique_name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;InferMethod&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;method_config&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;core&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span>                                          # æ¨ç†core id</span><br><span class="line">        <span class="attr">&quot;model_file&quot;</span><span class="punctuation">:</span> <span class="string">&quot;../../../model/runtime/centernet_resnet101/centernet_resnet101_512x512_nv12.bin&quot;</span> # æ¨¡å‹æ–‡ä»¶</span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;thread_count&quot;</span><span class="punctuation">:</span> <span class="number">8</span><span class="punctuation">,</span>                                    # åå¤„ç†çº¿ç¨‹æ•°</span><br><span class="line">      <span class="attr">&quot;method_type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;PTQCenternetPostProcessMethod&quot;</span><span class="punctuation">,</span>       # åå¤„ç†æ–¹æ³•</span><br><span class="line">      <span class="attr">&quot;unique_name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;PTQCenternetPostProcessMethod&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;method_config&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span>                                    # åå¤„ç†å‚æ•°</span><br><span class="line">        <span class="attr">&quot;class_num&quot;</span><span class="punctuation">:</span> <span class="number">80</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;score_threshold&quot;</span><span class="punctuation">:</span> <span class="number">0.4</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;topk&quot;</span><span class="punctuation">:</span> <span class="number">100</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;det_name_list&quot;</span><span class="punctuation">:</span> <span class="string">&quot;../../config/model/data_name_list/coco_classes.names&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></div>

<p>workflow_latency.json å¦‚ä¸‹ï¼š</p>
<div class="highlight-container" data-rel="Json"><figure class="iseeu highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;input_config&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;input_type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;image&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;height&quot;</span><span class="punctuation">:</span> <span class="number">512</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;width&quot;</span><span class="punctuation">:</span> <span class="number">512</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;data_type&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;image_list_file&quot;</span><span class="punctuation">:</span> <span class="string">&quot;../../../mini_data/coco/coco.lst&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;need_pre_load&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;limit&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;need_loop&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;max_cache&quot;</span><span class="punctuation">:</span> <span class="number">10</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;output_config&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;output_type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;image&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;image_list_enable&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;workflow&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;method_type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;InferMethod&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;unique_name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;InferMethod&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;method_config&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;core&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;model_file&quot;</span><span class="punctuation">:</span> <span class="string">&quot;../../../model/runtime/centernet_resnet101/centernet_resnet101_512x512_nv12.bin&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;thread_count&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;method_type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;PTQCenternetPostProcessMethod&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;unique_name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;PTQCenternetPostProcessMethod&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;method_config&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;class_num&quot;</span><span class="punctuation">:</span> <span class="number">80</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;score_threshold&quot;</span><span class="punctuation">:</span> <span class="number">0.4</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;topk&quot;</span><span class="punctuation">:</span> <span class="number">100</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;det_name_list&quot;</span><span class="punctuation">:</span> <span class="string">&quot;../../config/model/data_name_list/coco_classes.names&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></div>



<h5 id="ç²¾åº¦è¯„æµ‹"><a href="#ç²¾åº¦è¯„æµ‹" class="headerlink" title="ç²¾åº¦è¯„æµ‹"></a>ç²¾åº¦è¯„æµ‹</h5><p>æ¨¡å‹è¯„æµ‹åˆ†ä¸ºäº”æ­¥ï¼š</p>
<p>1.æ•°æ®é¢„å¤„ç†ã€‚</p>
<p>2.æ•°æ®æŒ‚è½½ã€‚</p>
<p>3.ç”Ÿæˆlstæ–‡ä»¶ã€‚</p>
<p>4.æ¨¡å‹æ¨ç†ã€‚</p>
<p>5.ç²¾åº¦è®¡ç®—ã€‚</p>
<h6 id="æ•°æ®é¢„å¤„ç†"><a href="#æ•°æ®é¢„å¤„ç†" class="headerlink" title="æ•°æ®é¢„å¤„ç†"></a>æ•°æ®é¢„å¤„ç†</h6><blockquote>
<p>PTQæ¨¡å‹æ•°æ®é¢„å¤„ç†</p>
</blockquote>
<p>PTQæ¨¡å‹æ•°æ®é¢„å¤„ç†éœ€è¦åœ¨x86ä»¿çœŸç¯å¢ƒä¸‹è¿è¡Œ <code>hb_eval_preprocess</code> å·¥å…·ï¼Œå¯¹æ•°æ®é›†è¿›è¡Œé¢„å¤„ç†ã€‚ æ‰€è°“é¢„å¤„ç†æ˜¯æŒ‡å›¾ç‰‡æ•°æ®åœ¨é€å…¥æ¨¡å‹ä¹‹å‰çš„ç‰¹å®šå¤„ç†æ“ä½œã€‚æ¯”å¦‚ï¼šå›¾ç‰‡resizeã€cropå’Œpaddingç­‰ã€‚ è¯¥å·¥å…·é›†æˆäº <code>horizon_tc_ui</code> å·¥å…·ä¸­ï¼Œå®‰è£…è¿‡ç›¸åº”installè„šæœ¬å³å¯ä½¿ç”¨ï¼Œ åŸå§‹æ•°æ®é›†ç»è¿‡å·¥å…·é¢„å¤„ç†ä¹‹åï¼Œä¼šç”Ÿæˆæ¨¡å‹å¯¹åº”çš„å‰å¤„ç†äºŒè¿›åˆ¶æ–‡ä»¶.binæ–‡ä»¶é›†ã€‚ ç›´æ¥è¿è¡Œ <code>hb_eval_preprocess --help</code> å¯ä»¥æŸ¥çœ‹å·¥å…·ä½¿ç”¨è§„åˆ™ã€‚</p>
<p><strong>å…³äº <code>hb_eval_preprocess</code> å·¥å…·å‘½ä»¤è¡Œå‚æ•°ï¼Œå¯é”®å…¥ <code>hb_eval_preprocess -h</code>ï¼Œ æˆ–æŸ¥çœ‹ PTQå·¥å…·æ–‡æ¡£ä¸­çš„ <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/oe_mapper/source/ptq/ptq_tool/hb_eval_preprocess.html" >hb_eval_preprocesså·¥å…· <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ä¸€èŠ‚å†…å®¹ã€‚</strong></p>
<p>ä¸‹é¢å°†è¯¦ç»†ä»‹ç»ç¤ºä¾‹åŒ…ä¸­æ¯ä¸€ä¸ªæ¨¡å‹å¯¹åº”çš„æ•°æ®é›†ï¼Œä»¥åŠå¯¹åº”æ•°æ®é›†çš„é¢„å¤„ç†æ“ä½œã€‚</p>
<p><strong>VOCæ•°æ®é›†</strong></p>
<p>VOCæ•°æ®é›†ç”¨äºssd_mobilenetv1æ£€æµ‹æ¨¡å‹çš„è¯„æµ‹ã€‚ æœ¬æ•°æ®é›†æ‚¨å¯ä»¥ä»å®˜ç½‘ä¸‹è½½ï¼š<a class="link"   target="_blank" rel="noopener" href="http://host.robots.ox.ac.uk/pascal/VOC/" >VOCæ•°æ®é›†å®˜ç½‘ä¸‹è½½åœ°å€ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ï¼Œ æˆ‘ä»¬å»ºè®®æ‚¨å°†ä¸‹è½½çš„æ•°æ®é›†è§£å‹æˆå¦‚ä¸‹ç»“æ„ï¼Œæ•°æ®å‡†å¤‡è¿‡ç¨‹ä¸­å¦‚é‡é—®é¢˜è¯·è”ç³»åœ°å¹³çº¿ï¼Œç¤ºä¾‹ä¸­ä¸»è¦ç”¨åˆ° <strong>Main</strong> æ–‡ä»¶ä¸‹çš„val.txtæ–‡ä»¶ï¼Œ <strong>JPEGImages</strong> ä¸­çš„æºå›¾ç‰‡å’Œ <strong>Annotations</strong> ä¸­çš„æ ‡æ³¨æ•°æ®ï¼š</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">â””â”€â”€ VOCdevkit                  # æ ¹ç›®å½•</span><br><span class="line">    â””â”€â”€ VOC2012                # ä¸åŒå¹´ä»½çš„æ•°æ®é›†ï¼Œè¿™é‡Œåªä¸‹è½½äº†2012çš„ï¼Œè¿˜æœ‰2007ç­‰å…¶å®ƒå¹´ä»½çš„</span><br><span class="line">        â”œâ”€â”€ Annotations        # å­˜æ”¾xmlæ–‡ä»¶ï¼Œä¸JPEGImagesä¸­çš„å›¾ç‰‡ä¸€ä¸€å¯¹åº”ï¼Œè§£é‡Šå›¾ç‰‡çš„å†…å®¹ç­‰ç­‰</span><br><span class="line">        â”œâ”€â”€ ImageSets          # è¯¥ç›®å½•ä¸‹å­˜æ”¾çš„éƒ½æ˜¯txtæ–‡ä»¶ï¼Œtxtæ–‡ä»¶ä¸­æ¯ä¸€è¡ŒåŒ…å«ä¸€ä¸ªå›¾ç‰‡çš„åç§°ï¼Œæœ«å°¾ä¼šåŠ ä¸ŠÂ±1è¡¨ç¤ºæ­£è´Ÿæ ·æœ¬</span><br><span class="line">        â”‚   â”œâ”€â”€ Action</span><br><span class="line">        â”‚   â”œâ”€â”€ Layout</span><br><span class="line">        â”‚   â”œâ”€â”€ Main</span><br><span class="line">        â”‚   â””â”€â”€ Segmentation</span><br><span class="line">        â”œâ”€â”€ JPEGImages         # å­˜æ”¾æºå›¾ç‰‡</span><br><span class="line">        â”œâ”€â”€ SegmentationClass  # å­˜æ”¾çš„æ˜¯å›¾ç‰‡ï¼Œè¯­ä¹‰åˆ†å‰²ç›¸å…³</span><br><span class="line">        â””â”€â”€ SegmentationObject # å­˜æ”¾çš„æ˜¯å›¾ç‰‡ï¼Œå®ä¾‹åˆ†å‰²ç›¸å…³</span><br></pre></td></tr></table></figure></div>

<p>å¯¹æ•°æ®é›†è¿›è¡Œé¢„å¤„ç†ï¼š</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hb_eval_preprocess -m ssd_mobilenetv1 -i VOCdevkit/VOC2012/JPEGImages -v VOCdevkit/VOC2012/ImageSets/Main/val.txt -o ./pre_ssd_mobilenetv1</span><br></pre></td></tr></table></figure></div>



<p><strong>COCOæ•°æ®é›†</strong></p>
<p>COCOæ•°æ®é›†ç”¨äºcenternet_resnet101ã€detr_efficientnetb3ã€detr_resnet50ã€yolov2_darknet19ã€yolov3_darknet53ã€yolov3_vargdarknetã€yolov5xã€preq_qat_fcos_efficientnetb0ã€preq_qat_fcos_efficientnetb2å’Œpreq_qat_fcos_efficientnetb3<strong>æ£€æµ‹æ¨¡å‹</strong>çš„è¯„æµ‹ï¼Œ æœ¬æ•°æ®é›†æ‚¨å¯ä»¥ä»å®˜ç½‘ä¸‹è½½ï¼š<a class="link"   target="_blank" rel="noopener" href="https://cocodataset.org/#download" >COCOæ•°æ®é›†å®˜ç½‘ä¸‹è½½åœ°å€ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ï¼Œ æˆ‘ä»¬å»ºè®®æ‚¨å°†ä¸‹è½½çš„æ•°æ®é›†è§£å‹æˆå¦‚ä¸‹ç»“æ„ï¼Œæ•°æ®å‡†å¤‡è¿‡ç¨‹ä¸­å¦‚é‡é—®é¢˜è¯·è”ç³»åœ°å¹³çº¿ï¼Œç¤ºä¾‹ä¸­ä¸»è¦ç”¨åˆ° <strong>annotations</strong> æ–‡ä»¶å¤¹ä¸‹çš„instances_val2017.jsonæ ‡æ³¨æ–‡ä»¶å’Œ <strong>images</strong> ä¸­çš„å›¾ç‰‡ï¼š</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">â”œâ”€â”€ annotations    # å­˜æ”¾æ ‡æ³¨æ•°æ®</span><br><span class="line">â””â”€â”€ images         # å­˜æ”¾æºå›¾ç‰‡</span><br></pre></td></tr></table></figure></div>

<p>å¯¹æ•°æ®é›†è¿›è¡Œé¢„å¤„ç†ï¼š</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hb_eval_preprocess -m model_name -i coco/coco_val2017/images -o ./pre_model_name</span><br></pre></td></tr></table></figure></div>



<p><strong>IMAGENETæ•°æ®é›†</strong></p>
<p>ImageNetæ•°æ®é›†ç”¨äºefficientnasnet_mã€efficientnasnet_sã€efficientnet_lite0ã€ efficientnet_lite1ã€efficientnet_lite2ã€efficientnet_lite3ã€efficientnet_lite4ã€googlenetã€ mobilenetv1ã€mobilenetv2ã€resnet18å’Œvargconvnet<strong>åˆ†ç±»æ¨¡å‹</strong>çš„è¯„æµ‹ï¼Œ æœ¬æ•°æ®é›†æ‚¨å¯ä»¥ä»å®˜ç½‘ä¸‹è½½ï¼š<a class="link"   target="_blank" rel="noopener" href="https://www.image-net.org/download.php" >ImageNetæ•°æ®é›†å®˜ç½‘ä¸‹è½½åœ°å€ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ï¼Œ æˆ‘ä»¬å»ºè®®æ‚¨å°†ä¸‹è½½çš„æ•°æ®é›†è§£å‹æˆå¦‚ä¸‹ç»“æ„ï¼Œæ•°æ®å‡†å¤‡è¿‡ç¨‹ä¸­å¦‚é‡é—®é¢˜è¯·è”ç³»åœ°å¹³çº¿ï¼Œç¤ºä¾‹ä¸­ä¸»è¦ç”¨åˆ°äº†æ ‡æ³¨æ–‡ä»¶val.txt å’Œ <strong>val</strong> ç›®å½•ä¸­çš„æºå›¾ç‰‡:</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">â”œâ”€â”€ val.txt</span><br><span class="line">â””â”€â”€ val</span><br></pre></td></tr></table></figure></div>

<p>å¯¹æ•°æ®é›†è¿›è¡Œé¢„å¤„ç†ï¼š</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hb_eval_preprocess -m model_name -i imagenet/val -o ./pre_model_name</span><br></pre></td></tr></table></figure></div>



<p><strong>CITYSCAPESæ•°æ®é›†</strong></p>
<p>Cityscapesæ•°æ®é›†ç”¨äºdeeplabv3plus_efficientnetb0ã€deeplabv3plus_efficientnetm1ã€ deeplabv3plus_efficientnetm2å’Œfastscnn_efficientnetb0æ¨¡å‹çš„è¯„æµ‹ã€‚ æœ¬æ•°æ®é›†æ‚¨å¯ä»¥ä»å®˜ç½‘ä¸‹è½½ï¼š<a class="link"   target="_blank" rel="noopener" href="https://github.com/mcordts/cityscapesScripts" >Cityscapesæ•°æ®é›†å®˜ç½‘ä¸‹è½½åœ°å€ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ï¼Œ æˆ‘ä»¬å»ºè®®æ‚¨å°†ä¸‹è½½çš„æ•°æ®é›†è§£å‹æˆå¦‚ä¸‹ç»“æ„ï¼Œæ•°æ®å‡†å¤‡è¿‡ç¨‹ä¸­å¦‚é‡é—®é¢˜è¯·è”ç³»åœ°å¹³çº¿ï¼Œç¤ºä¾‹ä¸­ä¸»è¦ç”¨åˆ°äº† <strong>.&#x2F;gtFine&#x2F;val</strong> ä¸­çš„æ ‡æ³¨æ–‡ä»¶å’Œ <strong>.&#x2F;leftImg8bit&#x2F;val</strong> ä¸­çš„æºå›¾ç‰‡ã€‚</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">â”œâ”€â”€ gtFine</span><br><span class="line">â”‚   â””â”€â”€ val</span><br><span class="line">â”‚       â”œâ”€â”€ frankfurt</span><br><span class="line">â”‚       â”œâ”€â”€ lindau</span><br><span class="line">â”‚       â””â”€â”€ munster</span><br><span class="line">â””â”€â”€ leftImg8bit</span><br><span class="line">    â””â”€â”€ val</span><br><span class="line">        â”œâ”€â”€ frankfurt</span><br><span class="line">        â”œâ”€â”€ lindau</span><br><span class="line">        â””â”€â”€ munster</span><br></pre></td></tr></table></figure></div>

<p>å¯¹æ•°æ®é›†è¿›è¡Œé¢„å¤„ç†ï¼š</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hb_eval_preprocess -m model_name -i cityscapes/leftImg8bit/val -o ./pre_model_name</span><br></pre></td></tr></table></figure></div>



<blockquote>
<p>QATæ•°æ®åŒ…é¢„å¤„ç†</p>
</blockquote>
<p>QATæ¨¡å‹æ•°æ®é¢„å¤„ç†éœ€è¦åœ¨x86ä»¿çœŸç¯å¢ƒä¸‹ æ‰§è¡Œ <code>ai_benchmark_j5/j5/qat/tools/eval_preprocess</code> ä¸­çš„å‰å¤„ç†è„šæœ¬ã€‚ ä¸‹é¢å°†è¯¦ç»†ä»‹ç»ç¤ºä¾‹åŒ…ä¸­æ¯ä¸€ä¸ªæ¨¡å‹å¯¹åº”çš„æ•°æ®é›†ï¼Œä»¥åŠå¯¹åº”æ•°æ®é›†çš„é¢„å¤„ç†æ“ä½œã€‚</p>
<p><strong>FLYINGCHAIRSæ•°æ®é›†</strong></p>
<p>FlyingChairsæ•°æ®é›†ç”¨äºpwcnet_opticalflowå…‰æµæ¨¡å‹çš„è¯„æµ‹ã€‚ æœ¬æ•°æ®é›†æ‚¨å¯ä»¥ä»å®˜ç½‘ä¸‹è½½ï¼š<a class="link"   target="_blank" rel="noopener" href="https://lmb.informatik.uni-freiburg.de/resources/datasets/FlyingChairs.en.html" >FlyingChairsæ•°æ®é›†å®˜ç½‘ä¸‹è½½åœ°å€ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ï¼Œ æˆ‘ä»¬å»ºè®®æ‚¨å°†ä¸‹è½½çš„æ•°æ®é›†è§£å‹æˆå¦‚ä¸‹ç»“æ„ï¼Œæ•°æ®å‡†å¤‡è¿‡ç¨‹ä¸­å¦‚é‡é—®é¢˜è¯·è”ç³»åœ°å¹³çº¿ï¼Œ ç¤ºä¾‹ä¸­ä¸»è¦ç”¨åˆ°äº† <strong>FlyingChairs_release&#x2F;data</strong> ä¸­çš„æ•°æ®å’Œ <strong>.&#x2F;FlyingChairs_train_val.txt</strong> æ ‡æ³¨æ–‡ä»¶ã€‚ {id}_img1.ppmå’Œ{id}_img2.ppmæ˜¯ä¸€ä¸ªå›¾åƒå¯¹ï¼Œå›¾åƒå®½åº¦å¤§å°æ˜¯512ï¼Œé«˜åº¦å¤§å°æ˜¯384ï¼› idæ˜¯ä»00001è‡³22872çš„åºå·ï¼Œæ¯ä¸€å›¾åƒå¯¹çš„æ ‡ç­¾æ˜¯{id}_flow.floã€‚å…¶ä¸­ <strong>FlyingChairs_train_val</strong> æ–‡ä»¶æ˜¯ç”¨äºåˆ’åˆ†è®­ç»ƒé›†å’ŒéªŒè¯é›†ï¼Œæ ‡ç­¾å€¼ä¸º2è¡¨ç¤ºéªŒè¯é›†ã€‚</p>
<blockquote>
<p>å…‰æµæ¨¡å‹æ˜¯è®¡ç®—æœºè§†è§‰é¢†åŸŸä¸­ç”¨äºæè¿°å›¾åƒä¸­è¿åŠ¨ç‰©ä½“è¿åŠ¨æƒ…å†µçš„ä¸€ç§æ¨¡å‹ã€‚å®ƒåŸºäºå›¾åƒä¸­ç›¸é‚»å¸§ä¹‹é—´çš„åƒç´ å€¼å·®å¼‚ï¼Œè®¡ç®—å‡ºåƒç´ ç‚¹åœ¨æ—¶é—´ä¸Šçš„ä½ç§»ï¼Œä»è€Œæ¨æ–­å‡ºç‰©ä½“åœ¨æ—¶é—´ä¸Šçš„è¿åŠ¨çŠ¶æ€ã€‚</p>
</blockquote>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">â”œâ”€â”€ FlyingChairs_release</span><br><span class="line">â”‚   â””â”€â”€ data</span><br><span class="line">â”‚       â”œâ”€â”€ 00001_img1.ppm</span><br><span class="line">â”‚       â”œâ”€â”€ 00001_img2.ppm</span><br><span class="line">â”‚       â””â”€â”€ 00001_flow.ppm</span><br><span class="line">â”œâ”€â”€ FlyingChairs_train_val.txt</span><br></pre></td></tr></table></figure></div>

<p>å¯¹æ•°æ®é›†è¿›è¡Œé¢„å¤„ç†ï¼š</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"></span><br><span class="line">python3 pwcnet_process.py --input_path=./flyingchairs/FlyingChairs_release/data/  --val_file=./flyingchairs/FlyingChairs_train_val.txt --output_path=./pre_pwcnet_opticalflow</span><br></pre></td></tr></table></figure></div>



<blockquote>
<p>IMAGENETæ•°æ®é›†</p>
</blockquote>
<p>ImageNetæ•°æ®é›†ç”¨äºQATåˆ†ç±»æ¨¡å‹mixvargenetã€mobilenetv1ã€mobilenetv2ã€resnet50ã€swintå’Œvargnetv2çš„è¯„æµ‹ã€‚</p>
<p>å¯¹æ•°æ®é›†è¿›è¡Œé¢„å¤„ç†ï¼š</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"></span><br><span class="line">python3 imagenet.py --image-path=./standard_imagenet/val/ --save-path=./pre_model_name</span><br></pre></td></tr></table></figure></div>



<p><strong>CITYSPACEæ•°æ®é›†</strong></p>
<p>Cityscapesæ•°æ®é›†ç”¨äºQATåˆ†å‰²æ¨¡å‹mobilenet_unetçš„è¯„æµ‹ï¼Œä¸éœ€è¦å‰å¤„ç†ç›´æ¥ä½¿ç”¨éªŒè¯é›†æ•°æ®å³å¯ã€‚</p>
<p><strong>VOCæ•°æ®é›†</strong></p>
<p>VOCæ•°æ®é›†ç”¨äºæ£€æµ‹æ¨¡å‹yolov3_mobilenetv1çš„è¯„æµ‹ã€‚</p>
<p>å¯¹æ•°æ®é›†è¿›è¡Œé¢„å¤„ç†ï¼š</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"></span><br><span class="line">python3 voc.py --image-path=./VOCdevkit/VOC2012/JPEGImages/ --save-path=./pre_yolov3_mobilenetv1</span><br></pre></td></tr></table></figure></div>



<p><strong>COCOæ•°æ®é›†</strong></p>
<p>COCOè¯¥æ•°æ®é›†ç”¨äºQATæ£€æµ‹æ¨¡å‹fcos_efficientnetb0å’Œretinanetçš„è¯„æµ‹ã€‚</p>
<p>å¯¹æ•°æ®é›†è¿›è¡Œé¢„å¤„ç†ï¼š</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"></span><br><span class="line">python3 fcos_process.py --image-path=./mscoco/images/val2017/  --label-path=./mscoco/images/annotations/instances_val2017.json --save-path=./pre_fcos_efficientnetb0</span><br><span class="line"></span><br><span class="line">python3 retinanet_process.py --image-path=./mscoco/images/val2017/  --label-path=./mscoco/images/annotations/instances_val2017.json --save-path=./pre_retinanet</span><br></pre></td></tr></table></figure></div>



<p><strong>KITTI3Dæ•°æ®é›†</strong></p>
<p>kitti3dæ•°æ®é›†ç”¨äºQATæ£€æµ‹æ¨¡å‹pointpillars_kitti_carçš„è¯„æµ‹ã€‚ æœ¬æ•°æ®é›†æ‚¨å¯ä»¥ä»å®˜ç½‘ä¸‹è½½ï¼š<a class="link"   target="_blank" rel="noopener" href="https://www.cvlibs.net/datasets/kitti/eval_object.php?obj_benchmark=3d" >kitti3dæ•°æ®é›†å®˜ç½‘ä¸‹è½½åœ°å€ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ï¼Œ æˆ‘ä»¬å»ºè®®æ‚¨ä¸‹è½½ä»¥ä¸‹å‹ç¼©åŒ…ï¼Œæ•°æ®å‡†å¤‡è¿‡ç¨‹ä¸­å¦‚é‡é—®é¢˜è¯·è”ç³»åœ°å¹³çº¿ã€‚</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">â”œâ”€â”€ kitti3d</span><br><span class="line">    â”œâ”€â”€ data_object_calib.zip        # camera calibration matrices of object data set</span><br><span class="line">    â”œâ”€â”€ data_object_image_2.zip      # left color images of object data set</span><br><span class="line">    â”œâ”€â”€ data_object_label_2.zip      # taining labels of object data set</span><br><span class="line">    â””â”€â”€ data_object_veloodyne.zip    # velodyne point cloud</span><br></pre></td></tr></table></figure></div>

<p>å»ºè®®æ‚¨å°†ä¸‹è½½çš„æ•°æ®é›†è§£å‹æˆå¦‚ä¸‹ç»“æ„ï¼š</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">â”œâ”€â”€ kitti3d_origin</span><br><span class="line">    â”œâ”€â”€ ImageSets</span><br><span class="line">    â”‚   â”œâ”€â”€ test.txt</span><br><span class="line">    â”‚   â”œâ”€â”€ train.txt</span><br><span class="line">    â”‚   â”œâ”€â”€ trainval.txt</span><br><span class="line">    â”‚   â””â”€â”€ val.txt</span><br><span class="line">    â”œâ”€â”€ testing</span><br><span class="line">    â”‚   â”œâ”€â”€ calib</span><br><span class="line">    â”‚   â”œâ”€â”€ image_2</span><br><span class="line">    â”‚   â””â”€â”€ velodyne</span><br><span class="line">    â””â”€â”€ training</span><br><span class="line">        â”œâ”€â”€ calib</span><br><span class="line">        â”œâ”€â”€ image_2</span><br><span class="line">        â”œâ”€â”€ label_2</span><br><span class="line">        â””â”€â”€ velodyne</span><br></pre></td></tr></table></figure></div>

<p>å¯¹æ•°æ®é›†è¿›è¡Œé¢„å¤„ç†ï¼š</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"></span><br><span class="line">python3 pointpillars_process.py --data-path=./kitti3d_origin  --save-path=./pre_kitti3d</span><br></pre></td></tr></table></figure></div>



<p><strong>CULANEæ•°æ®é›†</strong></p>
<p>culaneæ•°æ®é›†ç”¨äºQATæ£€æµ‹æ¨¡å‹ganetçš„è¯„æµ‹ã€‚ æœ¬æ•°æ®é›†æ‚¨å¯ä»¥ä»å®˜ç½‘ä¸‹è½½ï¼š<a class="link"   target="_blank" rel="noopener" href="https://xingangpan.github.io/projects/CULane.html" >culaneæ•°æ®é›†å®˜ç½‘ä¸‹è½½åœ°å€ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ï¼Œ æˆ‘ä»¬å»ºè®®æ‚¨ä¸‹è½½ä»¥ä¸‹å‹ç¼©åŒ…ï¼Œæ•°æ®å‡†å¤‡è¿‡ç¨‹ä¸­å¦‚é‡é—®é¢˜è¯·è”ç³»åœ°å¹³çº¿ã€‚</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">â”œâ”€â”€ culane</span><br><span class="line">    â”œâ”€â”€ annotations_new.tar.gz</span><br><span class="line">    â”œâ”€â”€ driver_23_30frame.tar.gz</span><br><span class="line">    â”œâ”€â”€ driver_37_30frame.tar.gz</span><br><span class="line">    â”œâ”€â”€ driver_100_30frame.tar.gz</span><br><span class="line">    â”œâ”€â”€ driver_161_90frame.tar.gz</span><br><span class="line">    â”œâ”€â”€ driver_182_30frame.tar.gz</span><br><span class="line">    â”œâ”€â”€ driver_193_90frame.tar.gz</span><br><span class="line">    â”œâ”€â”€ laneseg_label_w16.tar.gz</span><br><span class="line">    â””â”€â”€ list.tar.gz</span><br></pre></td></tr></table></figure></div>

<p>å…¶ä¸­ <strong>annotations_new.tar.gz</strong> éœ€è¦æœ€åè§£å‹ï¼Œä»¥å¯¹åŸå§‹çš„æ³¨é‡Šæ–‡ä»¶è¿›è¡Œæ›´æ­£ï¼Œå»ºè®®æ‚¨å°†ä¸‹è½½çš„æ•°æ®é›†è§£å‹æˆå¦‚ä¸‹ç»“æ„ï¼š</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">â”œâ”€â”€ culane                     # æ ¹ç›®å½•</span><br><span class="line">    â”œâ”€â”€ driver_23_30frame      # æ•°æ®é›†å’Œæ³¨é‡Š</span><br><span class="line">    â”‚   â”œâ”€â”€ 05151640_0419.MP4  # æ•°æ®é›†çš„ä¸€æ®µï¼ŒåŒ…å«æ¯ä¸€å¸§å›¾ç‰‡</span><br><span class="line">    â”‚   â”‚   â”œâ”€â”€00000.jpg       # æºå›¾ç‰‡</span><br><span class="line">    â”‚   â”‚   â”œâ”€â”€00000.lines.txt # æ³¨é‡Šæ–‡ä»¶ï¼Œå…¶ä¸­æ¯ä¸ªè¡Œç»™å‡ºè½¦é“æ ‡è®°å…³é”®ç‚¹çš„xï¼Œyåæ ‡</span><br><span class="line">    â”‚   ......</span><br><span class="line">    â”œâ”€â”€ driver_37_30frame</span><br><span class="line">    â”œâ”€â”€ driver_100_30frame</span><br><span class="line">    â”œâ”€â”€ driver_161_90frame</span><br><span class="line">    â”œâ”€â”€ driver_182_30frame</span><br><span class="line">    â”œâ”€â”€ driver_193_90frame</span><br><span class="line">    â”œâ”€â”€ laneseg_label_w16      # è½¦é“åˆ†æ®µæ ‡ç­¾</span><br><span class="line">    â””â”€â”€ list                   # è®­ç»ƒï¼ŒéªŒè¯ï¼Œæµ‹è¯•åˆ—è¡¨</span><br></pre></td></tr></table></figure></div>

<p>å¯¹æ•°æ®é›†è¿›è¡Œé¢„å¤„ç†ï¼š</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"></span><br><span class="line">python3 ganet_process.py --image_path=./culane  --save_path=./pre_culan</span><br></pre></td></tr></table></figure></div>



<p><strong>NUSCENESæ•°æ®é›†</strong></p>
<p>nuscenesæ•°æ®é›†ç”¨äºQATæ£€æµ‹æ¨¡å‹fcos3dçš„è¯„æµ‹ã€‚ æœ¬æ•°æ®é›†æ‚¨å¯ä»¥ä»å®˜ç½‘ä¸‹è½½ï¼š <a class="link"   target="_blank" rel="noopener" href="https://www.nuscenes.org/nuscenes#download" >nuscenesæ•°æ®é›†å®˜ç½‘ä¸‹è½½åœ°å€ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ï¼Œ æ•°æ®å‡†å¤‡è¿‡ç¨‹ä¸­å¦‚é‡é—®é¢˜è¯·è”ç³»åœ°å¹³çº¿ï¼Œæˆ‘ä»¬å»ºè®®æ‚¨ä¸‹è½½ä»¥ä¸‹å‹ç¼©åŒ…ï¼š</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">â”œâ”€â”€ Nuscenes</span><br><span class="line">    â”œâ”€â”€ nuScenes-map-expansion-v1.3.zip</span><br><span class="line">    â”œâ”€â”€ nuScenes-map-expansion-v1.2.zip</span><br><span class="line">    â”œâ”€â”€ nuScenes-map-expansion-v1.1.zip</span><br><span class="line">    â”œâ”€â”€ nuScenes-map-expansion-v1.0.zip</span><br><span class="line">    â”œâ”€â”€ v1.0-mini.tar</span><br><span class="line">    â”œâ”€â”€ v1.0-test_blobs.tar</span><br><span class="line">    â”œâ”€â”€ v1.0-test_meta.tar</span><br><span class="line">    â”œâ”€â”€ v1.0-trainval01_blobs.tar</span><br><span class="line">    â”œâ”€â”€ v1.0-trainval02_blobs.tar</span><br><span class="line">    â”œâ”€â”€ v1.0-trainval03_blobs.tar</span><br><span class="line">    â”œâ”€â”€ v1.0-trainval04_blobs.tar</span><br><span class="line">    â”œâ”€â”€ v1.0-trainval05_blobs.tar</span><br><span class="line">    â”œâ”€â”€ v1.0-trainval06_blobs.tar</span><br><span class="line">    â”œâ”€â”€ v1.0-trainval07_blobs.tar</span><br><span class="line">    â”œâ”€â”€ v1.0-trainval08_blobs.tar</span><br><span class="line">    â”œâ”€â”€ v1.0-trainval09_blobs.tar</span><br><span class="line">    â”œâ”€â”€ v1.0-trainval10_blobs.tar</span><br><span class="line">    â””â”€â”€ v1.0-trainval_meta.tar</span><br></pre></td></tr></table></figure></div>

<p>å»ºè®®æ‚¨å°†ä¸‹è½½çš„æ•°æ®é›†è§£å‹æˆå¦‚ä¸‹ç»“æ„ï¼š</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">â”œâ”€â”€ Nuscenes</span><br><span class="line">    â”œâ”€â”€ can_bus</span><br><span class="line">    â”œâ”€â”€ maps</span><br><span class="line">    â”œâ”€â”€ nuscenes</span><br><span class="line">    â”‚   â””â”€â”€ meta</span><br><span class="line">    â”‚       â”œâ”€â”€ maps</span><br><span class="line">    â”‚       â”œâ”€â”€ v1.0-mini</span><br><span class="line">    â”‚       â””â”€â”€ v1.0-trainval</span><br><span class="line">    â”œâ”€â”€ samples</span><br><span class="line">    â”œâ”€â”€ sweeps</span><br><span class="line">    â”œâ”€â”€ v1.0-mini</span><br><span class="line">    â””â”€â”€ v1.0-trainval</span><br></pre></td></tr></table></figure></div>

<p>å¯¹æ•°æ®é›†è¿›è¡Œé¢„å¤„ç†ï¼š</p>
<p> <strong>æ³¨æ„ï¼šè„šæœ¬é™¤äº†ç”Ÿæˆé¢„å¤„ç†å›¾ç‰‡å¤–ï¼Œè¿˜ä¼šå¯¹å¾…ä½¿ç”¨çš„ç›¸æœºå†…å‚è¿›è¡Œå¤„ç†ï¼Œç”Ÿæˆç›¸åº”çš„ç›¸æœºå†…å‚é…ç½®æ–‡ä»¶ã€‚</strong></p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"></span><br><span class="line">python3 fcos3d_process.py --src-data-dir=./Nuscenes --file-path=../../script/config/model/data_name_list/nuscenes_names.txt --save-path=./processed_fcos3d_images</span><br></pre></td></tr></table></figure></div>

<p><u>ä½¿ç”¨å‰éœ€è¦ä¿®æ”¹è„šæœ¬ä¸­çš„æ•°æ®é›†è·¯å¾„åŠä¿å­˜è·¯å¾„ä½¿è„šæœ¬æ­£å¸¸è¿è¡Œã€‚</u></p>
<h6 id="æ•°æ®æŒ‚è½½"><a href="#æ•°æ®æŒ‚è½½" class="headerlink" title="æ•°æ®æŒ‚è½½"></a>æ•°æ®æŒ‚è½½</h6><blockquote>
<p>&#x2F;etc&#x2F;exports æ˜¯ Linux ç³»ç»Ÿä¸‹ç”¨äºé…ç½® NFSï¼ˆNetwork File Systemï¼Œç½‘ç»œæ–‡ä»¶ç³»ç»Ÿï¼‰å…±äº«æœåŠ¡çš„é…ç½®æ–‡ä»¶ã€‚è¯¥æ–‡ä»¶ç”¨äºå®šä¹‰æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿçš„å…±äº«ç›®å½•ï¼Œå¹¶ä¸”å¯ä»¥æŒ‡å®šå…è®¸å“ªäº›å®¢æˆ·ç«¯æˆ–è€…ä¸»æœºè®¿é—®è¯¥å…±äº«ç›®å½•ã€‚åœ¨ NFS æœåŠ¡å¯åŠ¨æ—¶ï¼Œç³»ç»Ÿä¼šè¯»å–è¯¥æ–‡ä»¶ä¸­çš„é…ç½®ä¿¡æ¯ï¼Œå¹¶åœ¨å¯åŠ¨è¿‡ç¨‹ä¸­ä½¿ç”¨è¿™äº›ä¿¡æ¯æ¥åˆ›å»ºå…±äº«ç›®å½•ï¼Œä»¥ä¾¿å…¶ä»–ä¸»æœºå¯ä»¥é€šè¿‡ç½‘ç»œè®¿é—®å®ƒä»¬ã€‚</p>
<p>å…·ä½“æ¥è¯´ï¼Œ&#x2F;etc&#x2F;exports æ–‡ä»¶ä¸­æ¯ä¸€è¡Œéƒ½ä»£è¡¨ä¸€ä¸ªå…±äº«ç›®å½•çš„å®šä¹‰ï¼Œæ¯è¡ŒåŒ…å«ä¸€ä¸ªæœ¬åœ°å…±äº«ç›®å½•çš„è·¯å¾„å’Œä¸€ç»„å…è®¸è®¿é—®å…±äº«ç›®å½•çš„å‚æ•°ã€‚</p>
</blockquote>
<p>ç”±äºæ•°æ®é›†ç›¸å¯¹è¾ƒå¤§ï¼Œä¸é€‚åˆç›´æ¥æ”¾åœ¨å¼€å‘æ¿ä¸Šï¼Œå¯ä»¥é‡‡ç”¨æŒ‚è½½çš„æ–¹å¼ä¾›å¼€å‘æ¿è¯»å–ã€‚</p>
<p><u>æœåŠ¡å™¨PCç«¯ï¼š</u></p>
<ol>
<li>ç¼–è¾‘ &#x2F;etc&#x2F;exports, å¢åŠ ä¸€è¡Œï¼š <code>/nfs *(insecure,rw,sync,all_squash,anonuid=1000,anongid=1000,no_subtree_check)</code>ã€‚ <code>/nfs</code> è¡¨ç¤ºæœ¬æœºæŒ‚è½½è·¯å¾„ï¼Œå¯æ›¿æ¢ä¸ºç”¨æˆ·æŒ‡å®šç›®å½•ã€‚</li>
<li>æ‰§è¡Œå‘½ä»¤ <code>exportfs -a -r</code>ï¼Œä½¿&#x2F;etc&#x2F;exports ç”Ÿæ•ˆã€‚</li>
</ol>
<p><u>æ¿ç«¯ï¼š</u></p>
<ol>
<li>åˆ›å»ºéœ€è¦æŒ‚è½½çš„ç›®å½•ï¼š <code>mkdir -p /mnt</code>ã€‚</li>
<li><code>mount -t nfs &#123;PCç«¯IP&#125;:/nfs /mnt -o nolock</code>ã€‚</li>
</ol>
<p>å®Œæˆå°†PCç«¯çš„ <strong>&#x2F;nfs</strong> æ–‡ä»¶å¤¹æŒ‚è½½è‡³æ¿ç«¯ <strong>&#x2F;mnt</strong> æ–‡ä»¶å¤¹ã€‚ <strong>æŒ‰ç…§æ­¤æ–¹å¼ï¼Œå°†åŒ…å«é¢„å¤„ç†æ•°æ®çš„æ–‡ä»¶å¤¹æŒ‚è½½è‡³æ¿ç«¯ï¼Œ å¹¶å°† &#x2F;data ç›®å½•è½¯é“¾æ¥è‡³æ¿ç«¯ &#x2F;ptq æˆ– &#x2F;qat ç›®å½•ä¸‹ï¼Œä¸ &#x2F;script åŒçº§ç›®å½•ã€‚</strong></p>
<blockquote>
<p>ç”Ÿæˆlstæ–‡ä»¶</p>
</blockquote>
<p>ç¤ºä¾‹ä¸­ç²¾åº¦è®¡ç®—è„šæœ¬çš„è¿è¡Œæµç¨‹æ˜¯ï¼š</p>
<p>1.æ ¹æ® <code>workflow_accurary.json</code> ä¸­çš„ <code>image_list_file</code> å‚æ•°å€¼ï¼Œå»å¯»æ‰¾å¯¹åº”æ•°æ®é›†çš„ <code>lst</code> æ–‡ä»¶ã€‚</p>
<p>2.æ ¹æ® <strong><code>lst</code> æ–‡ä»¶å­˜å‚¨çš„å‰å¤„ç†æ–‡ä»¶è·¯å¾„ä¿¡æ¯ï¼Œå»åŠ è½½æ¯ä¸€ä¸ªå‰å¤„ç†æ–‡ä»¶ï¼Œç„¶åè¿›è¡Œæ¨ç†ã€‚</strong></p>
<p>å› æ­¤ç”Ÿæˆé¢„å¤„ç†æ–‡ä»¶ä¹‹åï¼Œéœ€è¦ç”Ÿæˆå¯¹åº”çš„lstæ–‡ä»¶ï¼Œå°†æ¯ä¸€å¼ å‰å¤„ç†æ–‡ä»¶çš„è·¯å¾„å†™å…¥åˆ°lstæ–‡ä»¶ä¸­ï¼Œè€Œè¿™ä¸ªè·¯å¾„ä¸æ•°æ®é›†åœ¨æ¿ç«¯çš„å­˜æ”¾ä½ç½®æœ‰å…³ã€‚ è¿™é‡Œæˆ‘ä»¬æ¨èå…¶å­˜æ”¾ä½ç½®ä¸ <code>./data/dataset_name/pre_model_name</code> é¢„å¤„ç†æ•°æ®æ–‡ä»¶å¤¹åŒçº§ç›®å½•ã€‚</p>
<p>PTQé¢„å¤„ç†æ•°æ®é›†ç»“æ„å¦‚ä¸‹ï¼š</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">|-- ptq</span><br><span class="line">|   |-- data</span><br><span class="line">|   |   |-- cityscapes</span><br><span class="line">|   |   |   |-- pre_deeplabv3plus_efficientnetb0</span><br><span class="line">|   |   |   |   |-- xxxx.bin                            # å‰å¤„ç†å¥½çš„äºŒè¿›åˆ¶æ–‡ä»¶</span><br><span class="line">|   |   |   |   |-- ....</span><br><span class="line">|   |   |   |-- pre_deeplabv3plus_efficientnetb0.lst    # lstæ–‡ä»¶ï¼šè®°å½•æ¯ä¸€ä¸ªå‰å¤„ç†æ–‡ä»¶çš„è·¯å¾„</span><br><span class="line">|   |   |   |-- pre_deeplabv3plus_efficientnetm1</span><br><span class="line">|   |   |   |-- pre_deeplabv3plus_efficientnetm1.lst</span><br><span class="line">|   |   |   |-- pre_deeplabv3plus_efficientnetm2</span><br><span class="line">|   |   |   |-- pre_deeplabv3plus_efficientnetm2.lst</span><br><span class="line">|   |   |   |-- pre_fastscnn_efficientnetb0</span><br><span class="line">|   |   |   |-- pre_fastscnn_efficientnetb0.lst</span><br><span class="line">|   |   |-- coco</span><br><span class="line">|   |   |   |-- pre_centernet_resnet101</span><br><span class="line">|   |   |   |   |-- xxxx.bin</span><br><span class="line">|   |   |   |   |-- ....</span><br><span class="line">|   |   |   |-- pre_centernet_resnet101.lst</span><br><span class="line">|   |   |   |-- pre_yolov2_darknet19</span><br><span class="line">|   |   |   |-- pre_yolov2_darknet19.lst</span><br><span class="line">|   |   |   |-- pre_yolov3_darknet53</span><br><span class="line">|   |   |   |-- pre_yolov3_darknet53.lst</span><br><span class="line">|   |   |   |-- pre_yolov3_vargdarknet</span><br><span class="line">|   |   |   |-- pre_yolov3_vargdarknet.lst</span><br><span class="line">|   |   |   |-- pre_yolov5x</span><br><span class="line">|   |   |   |-- pre_yolov5x.lst</span><br><span class="line">|   |   |   |-- pre_preq_qat_fcos_efficientnetb0</span><br><span class="line">|   |   |   |-- pre_preq_qat_fcos_efficientnetb0.lst</span><br><span class="line">|   |   |   |-- pre_preq_qat_fcos_efficientnetb2</span><br><span class="line">|   |   |   |-- pre_preq_qat_fcos_efficientnetb2.lst</span><br><span class="line">|   |   |   |-- pre_preq_qat_fcos_efficientnetb3</span><br><span class="line">|   |   |   |-- pre_preq_qat_fcos_efficientnetb3.lst</span><br><span class="line">|   |   |-- imagenet</span><br><span class="line">|   |   |   |-- pre_efficientnasnet_m</span><br><span class="line">|   |   |   |   |-- xxxx.bin</span><br><span class="line">|   |   |   |   |-- ....</span><br><span class="line">|   |   |   |-- pre_efficientnasnet_m.lst</span><br><span class="line">|   |   |   |-- pre_efficientnasnet_s</span><br><span class="line">|   |   |   |-- pre_efficientnasnet_s.lst</span><br><span class="line">|   |   |   |-- pre_efficientnet_lite0</span><br><span class="line">|   |   |   |-- pre_efficientnet_lite0.lst</span><br><span class="line">|   |   |   |-- pre_efficientnet_lite1</span><br><span class="line">|   |   |   |-- pre_efficientnet_lite1.lst</span><br><span class="line">|   |   |   |-- pre_efficientnet_lite2</span><br><span class="line">|   |   |   |-- pre_efficientnet_lite2.lst</span><br><span class="line">|   |   |   |-- pre_efficientnet_lite3</span><br><span class="line">|   |   |   |-- pre_efficientnet_lite3.lst</span><br><span class="line">|   |   |   |-- pre_efficientnet_lite4</span><br><span class="line">|   |   |   |-- pre_efficientnet_lite4.lst</span><br><span class="line">|   |   |   |-- pre_googlenet</span><br><span class="line">|   |   |   |-- pre_googlenet.lst</span><br><span class="line">|   |   |   |-- pre_mobilenetv1</span><br><span class="line">|   |   |   |-- pre_mobilenetv1.lst</span><br><span class="line">|   |   |   |-- pre_mobilenetv2</span><br><span class="line">|   |   |   |-- pre_mobilenetv2.lst</span><br><span class="line">|   |   |   |-- pre_resnet18</span><br><span class="line">|   |   |   |-- pre_resnet18.lst</span><br><span class="line">|   |   |   |-- pre_vargconvnet</span><br><span class="line">|   |   |   |-- pre_vargconvnet.lst</span><br><span class="line">|   |   |-- voc</span><br><span class="line">|   |   |   |-- pre_ssd_mobilenetv1</span><br><span class="line">|   |   |   |   |-- xxxx.bin</span><br><span class="line">|   |   |   |   |-- ....</span><br><span class="line">|   |   |   |-- pre_ssd_mobilenetv1.lst</span><br><span class="line">|   |-- model</span><br><span class="line">|   |   |-- ...</span><br><span class="line">|   |-- script</span><br><span class="line">|   |   |-- ...</span><br></pre></td></tr></table></figure></div>

<p>QATé¢„å¤„ç†æ•°æ®é›†ç»“æ„å¦‚ä¸‹ï¼š</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">|-- qat</span><br><span class="line">|   |-- data</span><br><span class="line">|   |   |-- cityscapes</span><br><span class="line">|   |   |   |-- pre_mobilenet_unet</span><br><span class="line">|   |   |   |   |-- xxxx                   # å‰å¤„ç†å¥½çš„æ•°æ®</span><br><span class="line">|   |   |   |   |-- ....</span><br><span class="line">|   |   |   |-- pre_mobilenet_unet .lst    # lstæ–‡ä»¶ï¼šè®°å½•æ¯ä¸€ä¸ªå‰å¤„ç†æ–‡ä»¶çš„è·¯å¾„</span><br><span class="line">|   |   |-- coco</span><br><span class="line">|   |   |   |-- pre_detr_efficientnetb3</span><br><span class="line">|   |   |   |   |-- xxxx</span><br><span class="line">|   |   |   |   |-- ....</span><br><span class="line">|   |   |   |-- pre_detr_efficientnetb3.lst</span><br><span class="line">|   |   |   |-- pre_detr_resnet50</span><br><span class="line">|   |   |   |-- pre_detr_resnet50.lst</span><br><span class="line">|   |   |   |-- pre_fcos_efficientnetb0</span><br><span class="line">|   |   |   |-- pre_fcos_efficientnetb0.lst</span><br><span class="line">|   |   |   |-- pre_retinanet</span><br><span class="line">|   |   |   |-- pre_retinanet.lst</span><br><span class="line">|   |   |-- imagenet</span><br><span class="line">|   |   |   |-- pre_mixvargenet</span><br><span class="line">|   |   |   |   |-- xxxx</span><br><span class="line">|   |   |   |   |-- ....</span><br><span class="line">|   |   |   |-- pre_mixvargenet.lst</span><br><span class="line">|   |   |   |-- pre_mobilenetv1</span><br><span class="line">|   |   |   |-- pre_mobilenetv1.lst</span><br><span class="line">|   |   |   |-- pre_mobilenetv2</span><br><span class="line">|   |   |   |-- pre_mobilenetv2.lst</span><br><span class="line">|   |   |   |-- pre_resnet50</span><br><span class="line">|   |   |   |-- pre_resnet50.lst</span><br><span class="line">|   |   |   |-- pre_swint</span><br><span class="line">|   |   |   |-- pre_swint.lst</span><br><span class="line">|   |   |   |-- pre_vargnetv2</span><br><span class="line">|   |   |   |-- pre_vargnetv2.lst</span><br><span class="line">|   |   |-- flyingchairs</span><br><span class="line">|   |   |   |-- pre_pwcnet_opticalflow</span><br><span class="line">|   |   |   |   |-- xxxx.bin</span><br><span class="line">|   |   |   |   |-- ....</span><br><span class="line">|   |   |   |-- pre_pwcnet_opticalflow.lst</span><br><span class="line">|   |   |-- kitti3d</span><br><span class="line">|   |   |   |-- pre_pointpillars_kitti_car</span><br><span class="line">|   |   |   |   |-- xxxx.bin</span><br><span class="line">|   |   |   |   |-- ....</span><br><span class="line">|   |   |   |-- pre_pointpillars_kitti_car.lst</span><br><span class="line">|   |   |-- voc</span><br><span class="line">|   |   |   |-- pre_yolov3_mobilenetv1</span><br><span class="line">|   |   |   |   |-- xxxx</span><br><span class="line">|   |   |   |   |-- ....</span><br><span class="line">|   |   |   |-- pre_yolov3_mobilenetv1.lst</span><br><span class="line">|   |   |-- culane</span><br><span class="line">|   |   |   |-- pre_ganet</span><br><span class="line">|   |   |   |   |-- xxxx</span><br><span class="line">|   |   |   |   |-- ....</span><br><span class="line">|   |   |   |-- pre_ganet.lst</span><br><span class="line">|   |   |-- nuscenes</span><br><span class="line">|   |   |   |-- pre_nuscenes</span><br><span class="line">|   |   |   |   |-- xxxx</span><br><span class="line">|   |   |   |   |-- ....</span><br><span class="line">|   |   |   |-- pre_nuscenes.lst</span><br><span class="line">|   |   |   |-- fcos3d_nuscenes_camconfig.txt</span><br><span class="line">|   |-- model</span><br><span class="line">|   |   |-- ...</span><br><span class="line">|   |-- script</span><br><span class="line">|   |   |-- ...</span><br></pre></td></tr></table></figure></div>

<p>ä¸ä¹‹å¯¹åº”çš„lstæ–‡ä»¶ï¼Œå‚è€ƒç”Ÿæˆæ–¹å¼å¦‚ä¸‹ï¼š</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find ../../../data/coco/pre_centernet_resnet101 -name &quot;*bin*&quot; &gt; ../../../data/coco/pre_centernet_resnet101.lst</span><br></pre></td></tr></table></figure></div>

<p>è¿™æ ·ç”Ÿæˆçš„lstæ–‡ä»¶ä¸­å­˜å‚¨çš„è·¯å¾„ä¸ºä¸€ä¸ªç›¸å¯¹è·¯å¾„ï¼š <code>../../../data/coco/pre_centernet_resnet101/</code> ï¼Œ å¯ä»¥ä¸ <code>workflow_accuracy.json</code> é»˜è®¤çš„é…ç½®è·¯å¾„å»åˆã€‚ å¦‚æœéœ€è¦æ›´æ”¹å‰å¤„ç†æ•°æ®é›†çš„å­˜æ”¾ä½ç½®ï¼Œåˆ™éœ€è¦ç¡®ä¿å¯¹åº”çš„ <code>lst</code> æ–‡ä»¶å¯ä»¥è¢« <code>workflow_accuracy.json</code> è¯»å–åˆ°ï¼› å…¶æ¬¡éœ€è¦ç¡®ä¿ç¨‹åºæ ¹æ® <code>lst</code> ä¸­çš„è·¯å¾„ä¿¡æ¯ï¼Œèƒ½è¯»å–åˆ°å¯¹åº”çš„å‰å¤„ç†æ–‡ä»¶ã€‚</p>
<blockquote>
<p>æ¨¡å‹æ¨ç†</p>
</blockquote>
<p><strong>å‘½ä»¤è¡Œå‚æ•°è¯´æ˜</strong></p>
<p>accuracy.shè„šæœ¬å†…å®¹å¦‚ä¸‹ï¼š</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">source</span> ../../env.sh                              <span class="comment"># åŠ è½½åŸºç¡€é…ç½®</span></span><br><span class="line"><span class="built_in">export</span> SHOW_FPS_LOG=1                            <span class="comment"># è®¾ç½®ç¯å¢ƒå˜é‡ï¼Œæ‰“å°fpsçº§åˆ«log</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$&#123;app&#125;</span> \                                         <span class="comment"># å¯æ‰§è¡Œç¨‹åºï¼Œåœ¨accuracy.shè„šæœ¬ä¸­å®šä¹‰</span></span><br><span class="line">  --config_file=workflow_accuracy.json \         <span class="comment"># åŠ è½½ç²¾åº¦æµ‹è¯•workflowé…ç½®æ–‡ä»¶</span></span><br><span class="line">  --log_level=2                                  <span class="comment"># è®¾ç½®logç­‰çº§</span></span><br></pre></td></tr></table></figure></div>



<p><strong>é…ç½®æ–‡ä»¶è¯´æ˜</strong></p>
<p>ä»¥centernet_resnet101æ¨¡å‹ä¸ºä¾‹ï¼Œworkflow_accuracy.json é…ç½®æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</p>
<div class="highlight-container" data-rel="Json"><figure class="iseeu highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;input_config&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;input_type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;preprocessed_image&quot;</span><span class="punctuation">,</span>         # è¾“å…¥æ•°æ®ç±»å‹ï¼Œæ”¯æŒå›¾åƒæˆ–è€…binæ–‡ä»¶ï¼Œç²¾åº¦è¯„æµ‹æ—¶ä½¿ç”¨é¢„å¤„ç†åçš„æ•°æ®</span><br><span class="line">    <span class="attr">&quot;height&quot;</span><span class="punctuation">:</span> <span class="number">512</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;width&quot;</span><span class="punctuation">:</span> <span class="number">512</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;data_type&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;image_list_file&quot;</span><span class="punctuation">:</span> <span class="string">&quot;../../../data/coco/coco.lst&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;need_pre_load&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;limit&quot;</span><span class="punctuation">:</span> <span class="number">14</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;need_loop&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;max_cache&quot;</span><span class="punctuation">:</span> <span class="number">10</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;output_config&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;output_type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;eval&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;eval_enable&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;output_file&quot;</span><span class="punctuation">:</span> <span class="string">&quot;./eval.log&quot;</span>                  # é¢„æµ‹ç»“æœæ–‡ä»¶</span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;workflow&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;method_type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;InferMethod&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;unique_name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;InferMethod&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;method_config&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;core&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;model_file&quot;</span><span class="punctuation">:</span> <span class="string">&quot;../../../model/runtime/centernet_resnet101/centernet_resnet101_512x512_nv12.bin&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;thread_count&quot;</span><span class="punctuation">:</span> <span class="number">4</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;method_type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;PTQCenternetPostProcessMethod&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;unique_name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;PTQCenternetPostProcessMethod&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;method_config&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;class_num&quot;</span><span class="punctuation">:</span> <span class="number">80</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;score_threshold&quot;</span><span class="punctuation">:</span> <span class="number">0.0</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;topk&quot;</span><span class="punctuation">:</span> <span class="number">100</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;det_name_list&quot;</span><span class="punctuation">:</span> <span class="string">&quot;../../config/model/data_name_list/coco_classes.names&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></div>

<p>æŒ‚è½½å®Œæ•°æ®åï¼Œç™»å½•å¼€å‘æ¿ï¼Œæ‰§è¡Œ <strong>centernet_resnet101&#x2F;</strong> ç›®å½•ä¸‹çš„accuracy.shè„šæœ¬ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">root@j5dvb-hynix8G:/userdata/ptq/script/detection/centernet_resnet101<span class="comment"># sh accuracy.sh</span></span><br><span class="line">../../aarch64/bin/example --config_file=workflow_accuracy.json --log_level=2</span><br><span class="line">...</span><br><span class="line">I0419 03:14:51.158655 39555 infer_method.cc:107] Predict DoProcess finished.</span><br><span class="line">I0419 03:14:51.187361 39556 ptq_centernet_post_process_method.cc:558] PTQCenternetPostProcessMethod DoProcess finished, predict result: [&#123;<span class="string">&quot;bbox&quot;</span>:[-1.518860,71.691170,574.934631,638.294922],<span class="string">&quot;prob&quot;</span>:0.750647,<span class="string">&quot;label&quot;</span>:21,<span class="string">&quot;class_name&quot;</span>:<span class="string">&quot;</span></span><br><span class="line"><span class="string">I0118 14:02:43.636204 24782 ptq_centernet_post_process_method.cc:558] PTQCenternetPostProcessMethod DoProcess finished, predict result: [&#123;&quot;</span>bbox<span class="string">&quot;:[3.432283,164.936249,157.480042,264.276825],&quot;</span>prob<span class="string">&quot;:0.544454,&quot;</span>label<span class="string">&quot;:62,&quot;</span>class_name<span class="string">&quot;:&quot;</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure></div>

<p>æ¿ç«¯ç¨‹åºä¼šåœ¨å½“å‰ç›®å½•ç”Ÿæˆeval.logæ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶å°±æ˜¯é¢„æµ‹ç»“æœæ–‡ä»¶ã€‚</p>
<h6 id="ç²¾åº¦è®¡ç®—"><a href="#ç²¾åº¦è®¡ç®—" class="headerlink" title="ç²¾åº¦è®¡ç®—"></a>ç²¾åº¦è®¡ç®—</h6><p><strong>æ³¨æ„ï¼šç²¾åº¦è®¡ç®—éƒ¨åˆ†è¯·åœ¨dockerç¯å¢ƒæˆ–linuxç¯å¢ƒä¸‹æ“ä½œã€‚</strong></p>
<blockquote>
<p>PTQæ¨¡å‹ç²¾åº¦è®¡ç®—</p>
</blockquote>
<p>PTQæ¨¡å‹å…¶ç²¾åº¦è®¡ç®—çš„è„šæœ¬åœ¨ <strong>ptq&#x2F;tools&#x2F;python_tools</strong> ç›®å½•ä¸‹ï¼ŒåŒ…æ‹¬ <strong>accuracy_tools</strong> ä¸­çš„ï¼š</p>
<ul>
<li>cls_eval.pyæ˜¯ç”¨æ¥è®¡ç®—åˆ†ç±»æ¨¡å‹çš„ç²¾åº¦ï¼›</li>
<li>coco_det_eval.pyæ˜¯ç”¨æ¥è®¡ç®—ä½¿ç”¨COCOæ•°æ®é›†è¯„æµ‹çš„æ£€æµ‹æ¨¡å‹çš„ç²¾åº¦ï¼›</li>
<li>parsing_eval.pyæ˜¯ç”¨æ¥è®¡ç®—ä½¿ç”¨Cityscapesæ•°æ®é›†è¯„æµ‹çš„åˆ†å‰²æ¨¡å‹çš„ç²¾åº¦ï¼›</li>
<li>voc_det_eval.pyæ˜¯ç”¨æ¥è®¡ç®—ä½¿ç”¨VOCæ•°æ®é›†è¯„æµ‹çš„æ£€æµ‹æ¨¡å‹çš„ç²¾åº¦ã€‚</li>
</ul>
<p><strong>åˆ†ç±»æ¨¡å‹</strong></p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"></span><br><span class="line">python3 cls_eval.py --log_file=eval.log --gt_file=val.txt</span><br></pre></td></tr></table></figure></div>

<ul>
<li><code>log_file</code>ï¼šåˆ†ç±»æ¨¡å‹çš„é¢„æµ‹ç»“æœæ–‡ä»¶ã€‚</li>
<li><code>gt_file</code>ï¼šCIFAR-10å’ŒImageNetæ•°æ®é›†çš„æ ‡æ³¨æ–‡ä»¶ã€‚</li>
</ul>
<p><strong>æ£€æµ‹æ¨¡å‹</strong></p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#ä½¿ç”¨COCOæ•°æ®é›†çš„æ£€æµ‹æ¨¡å‹ç²¾åº¦è®¡ç®—æ–¹å¼å¦‚ä¸‹ï¼š</span></span><br><span class="line">python3 coco_det_eval.py --eval_result_path=eval.log --annotation_path=instances_val2017.json		<span class="comment">#eval_result_pathï¼šæ£€æµ‹æ¨¡å‹çš„é¢„æµ‹ç»“æœæ–‡ä»¶ã€‚annotation_pathï¼šCOCOæ•°æ®é›†çš„æ ‡æ³¨æ–‡ä»¶ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#ä½¿ç”¨VOCæ•°æ®é›†çš„æ£€æµ‹æ¨¡å‹ç²¾åº¦è®¡ç®—æ–¹å¼å¦‚ä¸‹ï¼š</span></span><br><span class="line">python3 voc_det_eval.py --eval_result_path=eval.log --annotation_path=../Annotations --val_txt_path=../val.txt			<span class="comment">#eval_result_pathï¼šæ£€æµ‹æ¨¡å‹çš„é¢„æµ‹ç»“æœæ–‡ä»¶ã€‚annotation_pathï¼šVOCæ•°æ®é›†çš„æ ‡æ³¨æ–‡ä»¶ã€‚val_txt_pathï¼šVOCæ•°æ®é›†ä¸­ImageSets/Mainæ–‡ä»¶å¤¹ä¸‹çš„val.txtæ–‡ä»¶ã€‚</span></span><br></pre></td></tr></table></figure></div>



<p><strong>åˆ†å‰²æ¨¡å‹</strong></p>
<ul>
<li>ä½¿ç”¨Cityscapesæ•°æ®é›†çš„åˆ†å‰²æ¨¡å‹ç²¾åº¦è®¡ç®—æ–¹å¼å¦‚ä¸‹ï¼š</li>
</ul>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"></span><br><span class="line">python3 parsing_eval.py --log_file=eval.log --gt_path=cityscapes/gtFine/val</span><br></pre></td></tr></table></figure></div>

<ul>
<li><code>log_file</code>ï¼šåˆ†å‰²æ¨¡å‹çš„é¢„æµ‹ç»“æœæ–‡ä»¶ã€‚</li>
<li><code>gt_path</code>ï¼šCityscapesæ•°æ®é›†çš„æ ‡æ³¨æ–‡ä»¶ã€‚</li>
</ul>
<blockquote>
<p>QATæ¨¡å‹ç²¾åº¦è®¡ç®—</p>
</blockquote>
<p>QATæ¨¡å‹å…¶ç²¾åº¦è®¡ç®—çš„è„šæœ¬åœ¨ <strong>qat&#x2F;tools&#x2F;python_tools&#x2F;</strong> ç›®å½•ä¸‹ï¼ŒåŒ…æ‹¬ <strong>accuracy_tools</strong> ä¸­çš„ï¼š</p>
<ul>
<li>cls_eval.pyæ˜¯ç”¨æ¥è®¡ç®—åˆ†ç±»æ¨¡å‹çš„ç²¾åº¦ï¼›</li>
<li>detr_eval.pyæ˜¯ç”¨æ¥è®¡ç®—detræ£€æµ‹æ¨¡å‹çš„ç²¾åº¦ï¼›</li>
<li>retinanet_eval.pyæ˜¯ç”¨æ¥è®¡ç®—retinanetæ£€æµ‹æ¨¡å‹çš„ç²¾åº¦ï¼›</li>
<li>fcos_eval.pyæ˜¯ç”¨æ¥è®¡ç®—fcosæ£€æµ‹æ¨¡å‹çš„ç²¾åº¦ï¼›</li>
<li>parsing_eval.pyæ˜¯ç”¨æ¥è®¡ç®—ä½¿ç”¨Cityscapesæ•°æ®é›†è¯„æµ‹çš„åˆ†å‰²æ¨¡å‹çš„ç²¾åº¦ï¼›</li>
<li>pwcnet_eval.pyæ˜¯ç”¨æ¥è®¡ç®—ä½¿ç”¨FlyingChairsæ•°æ®é›†è¯„æµ‹çš„å…‰æµæ¨¡å‹çš„ç²¾åº¦ï¼›</li>
<li>yolov3_eval.pyæ˜¯ç”¨æ¥è®¡ç®—yolov3æ£€æµ‹æ¨¡å‹çš„ç²¾åº¦ï¼›</li>
<li>pointpillars_eval.pyæ˜¯ç”¨æ¥è®¡ç®—pointpillarsæ£€æµ‹æ¨¡å‹çš„ç²¾åº¦ï¼›</li>
<li>ganet_eval.pyæ˜¯ç”¨æ¥è®¡ç®—ganetæ£€æµ‹æ¨¡å‹çš„ç²¾åº¦ã€‚</li>
<li>fcos3d_eval.pyæ˜¯ç”¨æ¥è®¡ç®—fcos3dæ£€æµ‹æ¨¡å‹çš„ç²¾åº¦ã€‚</li>
</ul>
<p><strong>åˆ†ç±»æ¨¡å‹</strong></p>
<p>ä½¿ç”¨CIFAR-10æ•°æ®é›†å’ŒImageNetæ•°æ®é›†çš„åˆ†ç±»æ¨¡å‹è®¡ç®—æ–¹å¼å¦‚ä¸‹ï¼š</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"></span><br><span class="line">python3 cls_eval.py --log_file=eval.log --gt_file=val.txt</span><br></pre></td></tr></table></figure></div>

<ul>
<li><code>log_file</code>ï¼šåˆ†ç±»æ¨¡å‹çš„é¢„æµ‹ç»“æœæ–‡ä»¶ã€‚</li>
<li><code>gt_file</code>ï¼šCIFAR-10å’ŒImageNetæ•°æ®é›†çš„æ ‡æ³¨æ–‡ä»¶ã€‚</li>
</ul>
<p><strong>æ£€æµ‹æ¨¡å‹</strong></p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#ä½¿ç”¨COCOæ•°æ®é›†çš„æ£€æµ‹æ¨¡å‹ç²¾åº¦è®¡ç®—æ–¹å¼ç¤ºä¾‹å¦‚ä¸‹ï¼š</span></span><br><span class="line">python3 fcos_eval.py --eval_result_path=eval.log --annotation_path=instances_val2017.json  --image_path=./mscoco/images/val2017/</span><br><span class="line"><span class="comment">#eval_result_pathï¼šfcosæ£€æµ‹æ¨¡å‹çš„é¢„æµ‹ç»“æœæ–‡ä»¶ã€‚annotation_pathï¼šCOCOæ•°æ®é›†çš„æ ‡æ³¨æ–‡ä»¶ã€‚image_pathï¼šCOCOåŸå§‹æ•°æ®é›†ã€‚</span></span><br><span class="line">python3 retinanet_eval.py --eval_result_path=eval.log --annotation_path=instances_val2017.json --image_path=./mscoco/images/val2017/		<span class="comment">#eval_result_pathï¼šretinanetæ£€æµ‹æ¨¡å‹çš„é¢„æµ‹ç»“æœæ–‡ä»¶ã€‚annotation_pathï¼šCOCOæ•°æ®é›†çš„æ ‡æ³¨æ–‡ä»¶ã€‚image_pathï¼šCOCOåŸå§‹æ•°æ®é›†ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#ä½¿ç”¨VOCæ•°æ®é›†çš„æ£€æµ‹æ¨¡å‹ç²¾åº¦è®¡ç®—æ–¹å¼ç¤ºä¾‹å¦‚ä¸‹ï¼š</span></span><br><span class="line">python3 yolov3_eval.py --eval_result_path=eval.log --annotation_path=../Annotations --val_txt_path=../val.txt --image_height=416  --image_width=416		<span class="comment">#eval_result_pathï¼šæ£€æµ‹æ¨¡å‹çš„é¢„æµ‹ç»“æœæ–‡ä»¶ã€‚annotation_pathï¼šVOCæ•°æ®é›†çš„æ ‡æ³¨æ–‡ä»¶ã€‚val_txt_pathï¼šVOCæ•°æ®é›†ä¸­ImageSets/Mainæ–‡ä»¶å¤¹ä¸‹çš„val.txtæ–‡ä»¶ã€‚image_height: å›¾åƒçš„é«˜åº¦ã€‚image_width: å›¾åƒçš„å®½åº¦ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#ä½¿ç”¨KITTIæ•°æ®é›†çš„æ£€æµ‹æ¨¡å‹ç²¾åº¦è®¡ç®—æ–¹å¼å¦‚ä¸‹ï¼š</span></span><br><span class="line">python3 pointpillars_eval.py --eval_result_path=eval.log --annotation_path=./val_gt_infos.pkl		<span class="comment">#eval_result_pathï¼šæ£€æµ‹æ¨¡å‹çš„é¢„æµ‹ç»“æœæ–‡ä»¶ã€‚annotation_pathï¼šé¢„å¤„ç†è¿‡ç¨‹ä¸­ç”Ÿæˆçš„kitti3dæ•°æ®é›†çš„æ ‡æ³¨æ–‡ä»¶val_gt_infos.pklã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#ä½¿ç”¨culaneæ•°æ®é›†çš„æ£€æµ‹æ¨¡å‹ç²¾åº¦è®¡ç®—æ–¹å¼å¦‚ä¸‹ï¼š</span></span><br><span class="line">python3 ganet_eval.py --eval_path=eval.log --image_path=./culane		<span class="comment">#eval_pathï¼šæ£€æµ‹æ¨¡å‹çš„é¢„æµ‹ç»“æœæ–‡ä»¶ã€‚image_pathï¼šculaneæ•°æ®é›†ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#ä½¿ç”¨nuscenesæ•°æ®é›†çš„æ£€æµ‹æ¨¡å‹ç²¾åº¦è®¡ç®—æ–¹å¼å¦‚ä¸‹ï¼š</span></span><br><span class="line">python3 fcos3d_eval.py --eval_result_path=eval.log --image_path=./Nuscenes		<span class="comment">#eval_result_pathï¼šæ£€æµ‹æ¨¡å‹çš„é¢„æµ‹ç»“æœæ–‡ä»¶ã€‚image_pathï¼šnuscenesæ•°æ®é›†ã€‚</span></span><br></pre></td></tr></table></figure></div>



<p><strong>åˆ†å‰²æ¨¡å‹</strong></p>
<p>ä½¿ç”¨Cityscapesæ•°æ®é›†çš„åˆ†å‰²æ¨¡å‹ç²¾åº¦è®¡ç®—æ–¹å¼å¦‚ä¸‹ï¼š</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"></span><br><span class="line">python3 parsing_eval.py --log_file=eval.log --gt_path=cityscapes/gtFine/val</span><br></pre></td></tr></table></figure></div>

<ul>
<li><code>log_file</code>ï¼šåˆ†å‰²æ¨¡å‹çš„é¢„æµ‹ç»“æœæ–‡ä»¶ã€‚</li>
<li><code>gt_path</code>ï¼šCityscapesæ•°æ®é›†çš„æ ‡æ³¨æ–‡ä»¶ã€‚</li>
</ul>
<p><strong>å…‰æµæ¨¡å‹</strong></p>
<p>ä½¿ç”¨FlyingChairsæ•°æ®é›†çš„å…‰æµæ¨¡å‹ç²¾åº¦è®¡ç®—æ–¹å¼å¦‚ä¸‹ï¼š</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"></span><br><span class="line">python3 parsing_eval.py --log_file=eval.log --gt_path=./flyingchairs/FlyingChairs_release/data/  --val_file=./flyingchairs/FlyingChairs_train_val.txt</span><br></pre></td></tr></table></figure></div>

<p>æ³¨è§£</p>
<ul>
<li><code>log_file</code>ï¼šå…‰æµæ¨¡å‹çš„é¢„æµ‹ç»“æœæ–‡ä»¶ã€‚</li>
<li><code>val_file</code>ï¼šFlyingChairsæ•°æ®é›†æ ‡ç­¾æ–‡ä»¶ã€‚</li>
<li><code>gt_path</code>ï¼šFlyingChairsæ•°æ®é›†åŸå§‹æ–‡ä»¶ã€‚</li>
</ul>
<h4 id="æ¨¡å‹é›†æˆ"><a href="#æ¨¡å‹é›†æˆ" class="headerlink" title="æ¨¡å‹é›†æˆ"></a>æ¨¡å‹é›†æˆ</h4><p>åå¤„ç†é›†æˆä¸»è¦æœ‰2ä¸ªæ­¥éª¤ï¼Œä»¥CenterNetæ¨¡å‹é›†æˆä¸ºä¾‹ï¼š</p>
<p>1.å¢åŠ åå¤„ç†æ–‡ä»¶ptq_centernet_post_process_method.ccï¼Œä»¥åŠå¤´æ–‡ä»¶ptq_centernet_post_process_method.hã€‚</p>
<p>2.å¢åŠ æ¨¡å‹è¿è¡Œè„šæœ¬åŠé…ç½®æ–‡ä»¶ã€‚</p>
<h5 id="åå¤„ç†æ–‡ä»¶æ·»åŠ "><a href="#åå¤„ç†æ–‡ä»¶æ·»åŠ " class="headerlink" title="åå¤„ç†æ–‡ä»¶æ·»åŠ "></a>åå¤„ç†æ–‡ä»¶æ·»åŠ </h5><p>åå¤„ç†ä»£ç æ–‡ä»¶å¯ç›´æ¥å¤ç”¨src&#x2F;methodç›®å½•ä¸‹ä»»æ„åå¤„ç†æ–‡ä»¶ï¼Œä¸»è¦ä¿®æ”¹ <code>InitFromJsonString</code> å‡½æ•°ï¼Œä»¥åŠ <code>PostProcess</code> å‡½æ•°å³å¯ã€‚</p>
<p><code>InitFromJsonString</code> å‡½æ•°ä¸»è¦æ˜¯è¯»å–workflow.jsonä¸­çš„åå¤„ç†ç›¸å…³çš„å‚æ•°é…ç½®ï¼Œç”¨æˆ·å¯è‡ªå®šä¹‰è®¾ç½®ç›¸åº”çš„è¾“å…¥å‚æ•°ã€‚ <code>PostProcess</code> å‡½æ•°ä¸»è¦å®Œæˆåå¤„ç†çš„é€»è¾‘ã€‚</p>
<p>åå¤„ç† <code>.ccæ–‡ä»¶</code> æ”¾ç½®äº <strong>ai_benchmark&#x2F;code&#x2F;src&#x2F;method&#x2F;</strong> è·¯å¾„ä¸‹ï¼Œ <code>.hå¤´æ–‡ä»¶</code> æ”¾ç½®äº <strong>ai_benchmark&#x2F;code&#x2F;include&#x2F;method&#x2F;</strong> è·¯å¾„ä¸‹ï¼š</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">|--ai_benchmark</span><br><span class="line">|  |--code                                                 # ç¤ºä¾‹æºç </span><br><span class="line">|  |  |--include</span><br><span class="line">|  |  |  |--method                                         # åœ¨æ­¤æ–‡ä»¶å¤¹ä¸­æ·»åŠ å¤´æ–‡ä»¶</span><br><span class="line">|  |  |  |  |--qat_fcos_post_process_method.h</span><br><span class="line">|  |  |  |  |--......</span><br><span class="line">|  |  |--src</span><br><span class="line">|  |  |  |--method                                         # åœ¨æ­¤æ–‡ä»¶å¤¹ä¸­æ·»åŠ åå¤„ç†.ccæ–‡ä»¶</span><br><span class="line">|  |  |  |  |--qat_fcos_post_process_method.cc</span><br><span class="line">|  |  |  |  |--......</span><br></pre></td></tr></table></figure></div>



<h5 id="å¢åŠ æ¨¡å‹è¿è¡Œè„šæœ¬åŠé…ç½®æ–‡ä»¶"><a href="#å¢åŠ æ¨¡å‹è¿è¡Œè„šæœ¬åŠé…ç½®æ–‡ä»¶" class="headerlink" title="å¢åŠ æ¨¡å‹è¿è¡Œè„šæœ¬åŠé…ç½®æ–‡ä»¶"></a>å¢åŠ æ¨¡å‹è¿è¡Œè„šæœ¬åŠé…ç½®æ–‡ä»¶</h5><p>è„šæœ¬ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">|--ai_benchmark</span><br><span class="line">|  |--j5/ptq/script                                       # ç¤ºä¾‹è„šæœ¬æ–‡ä»¶å¤¹</span><br><span class="line">|  |  |--detection</span><br><span class="line">|  |  |  |--centernet_resnet101</span><br><span class="line">|  |  |  |  |--accuracy.sh                                # ç²¾åº¦æµ‹è¯•è„šæœ¬</span><br><span class="line">|  |  |  |  |--fps.sh                                     # æ€§èƒ½æµ‹è¯•è„šæœ¬</span><br><span class="line">|  |  |  |  |--latency.sh                                 # å•å¸§å»¶æ—¶ç¤ºä¾‹è„šæœ¬</span><br><span class="line">|  |  |  |  |--workflow_accuracy.json                     # ç²¾åº¦é…ç½®æ–‡ä»¶</span><br><span class="line">|  |  |  |  |--workflow_fps.json                          # æ€§èƒ½é…ç½®æ–‡ä»¶</span><br><span class="line">|  |  |  |  |--workflow_latency.json                      # å•å¸§å»¶æ—¶é…ç½®æ–‡ä»¶</span><br></pre></td></tr></table></figure></div>



<h4 id="è¾…åŠ©å·¥å…·-1"><a href="#è¾…åŠ©å·¥å…·-1" class="headerlink" title="è¾…åŠ©å·¥å…·"></a>è¾…åŠ©å·¥å…·</h4><h5 id="æ—¥å¿—-1"><a href="#æ—¥å¿—-1" class="headerlink" title="æ—¥å¿—"></a>æ—¥å¿—</h5><p>æ—¥å¿—ä¸»è¦åŒ…æ‹¬ <strong>ç¤ºä¾‹æ—¥å¿—</strong> å’Œ <strong>DNNæ—¥å¿—</strong> ä¸¤éƒ¨åˆ†ã€‚ å…¶ä¸­ç¤ºä¾‹æ—¥å¿—æ˜¯æŒ‡äº¤ä»˜åŒ…ç¤ºä¾‹ä»£ç ä¸­æ‰€åº”ç”¨çš„æ—¥å¿—ï¼Œ DNNæ—¥å¿—æ˜¯æŒ‡åµŒå…¥å¼runtimeåº“ä¸­çš„æ—¥å¿—ã€‚ ç”¨æˆ·æ ¹æ®ä¸åŒçš„éœ€æ±‚å¯ä»¥è®¾ç½®ä¸åŒçš„æ—¥å¿—ã€‚</p>
<h6 id="ç¤ºä¾‹æ—¥å¿—"><a href="#ç¤ºä¾‹æ—¥å¿—" class="headerlink" title="ç¤ºä¾‹æ—¥å¿—"></a>ç¤ºä¾‹æ—¥å¿—</h6><p>1.æ—¥å¿—ç­‰çº§ã€‚</p>
<p>ç¤ºä¾‹æ—¥å¿—ä¸»è¦é‡‡ç”¨glogä¸­çš„vlogï¼Œä¸»è¦åˆ†ä¸ºå››ä¸ªè‡ªå®šä¹‰ç­‰çº§ï¼š</p>
<ul>
<li><code>0</code> (SYSTEM)ï¼Œè¯¥ç­‰çº§ä¸»è¦ç”¨æ¥è¾“å‡ºæŠ¥é”™ä¿¡æ¯ï¼›</li>
<li><code>1</code> (REPORT)ï¼Œè¯¥ç­‰çº§åœ¨ç¤ºä¾‹ä»£ç ä¸­ä¸»è¦ç”¨æ¥è¾“å‡ºæ€§èƒ½æ•°æ®ï¼›</li>
<li><code>2</code> (DETAIL)ï¼Œè¯¥ç­‰çº§åœ¨ç¤ºä¾‹ä»£ç ä¸­ä¸»è¦ç”¨æ¥è¾“å‡ºç³»ç»Ÿå½“å‰çŠ¶æ€ä¿¡æ¯ï¼›</li>
<li><code>3</code> (DEBUG)ï¼Œè¯¥ç­‰çº§åœ¨ç¤ºä¾‹ä»£ç ä¸­ä¸»è¦ç”¨æ¥è¾“å‡ºè°ƒè¯•ä¿¡æ¯ã€‚</li>
</ul>
<p>æ—¥å¿—ç­‰çº§è®¾ç½®è§„åˆ™ï¼šå‡è®¾è®¾ç½®äº†çº§åˆ«ä¸º <code>P</code>ï¼Œå¦‚æœå‘ç”Ÿäº†ä¸€ä¸ªçº§åˆ« <code>Q</code> æ¯” <code>P</code> ä½ï¼Œ åˆ™å¯ä»¥å¯åŠ¨ï¼Œå¦åˆ™å±è”½æ‰ï¼›é»˜è®¤DEBUG&gt;DETAIL&gt;REPORT&gt;SYSTEMã€‚</p>
<p>2.æ—¥å¿—ç­‰çº§è®¾ç½®ã€‚</p>
<p>é€šè¿‡ <code>log_level</code> å‚æ•°æ¥è®¾ç½®æ—¥å¿—ç­‰çº§ï¼Œåœ¨è¿è¡Œç¤ºä¾‹çš„æ—¶å€™ï¼ŒæŒ‡å®š <code>log_level</code> å‚æ•°æ¥è®¾ç½®ç­‰çº§ï¼Œ æ¯”å¦‚æŒ‡å®š <code>log_level=0</code>ï¼Œå³è¾“å‡ºSYSTEMæ—¥å¿—ï¼›å¦‚æœæŒ‡å®š <code>log_level=3</code>ï¼Œåˆ™è¾“å‡ºDEBUGã€DETAILã€REPORTå’ŒSYSTEMæ—¥å¿—ã€‚</p>
<h6 id="dnnæ—¥å¿—"><a href="#dnnæ—¥å¿—" class="headerlink" title="dnnæ—¥å¿—"></a>dnnæ—¥å¿—</h6><p>å…³äº <code>dnn</code> æ—¥å¿—çš„é…ç½®ï¼Œè¯·é˜…è¯»BPU SDK APIæ‰‹å†Œä¸­çš„ <a class="link"   target="_blank" rel="noopener" href="https://developer.horizon.ai/api/v1/fileData/horizon_j5_open_explorer_cn_doc/runtime/source/bpu_sdk_api/source/bpu_sdk_api_doc.html#bpu-sdk-config" >é…ç½®ä¿¡æ¯ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ä¸€èŠ‚å†…å®¹ã€‚</p>
<h5 id="ç®—å­è€—æ—¶"><a href="#ç®—å­è€—æ—¶" class="headerlink" title="ç®—å­è€—æ—¶"></a>ç®—å­è€—æ—¶</h5><p>å¯¹OPæ€§èƒ½çš„ç»Ÿè®¡æ˜¯é€šè¿‡è®¾ç½® <code>HB_DNN_PROFILER_LOG_PATH</code> ç¯å¢ƒå˜é‡å®ç°çš„ã€‚ å¯¹è¯¥å˜é‡çš„ç±»å‹å’Œå–å€¼è¯´æ˜å¦‚ä¸‹ï¼š</p>
<p><code>HB_DNN_PROFILER_LOG_PATH=$&#123;path&#125;</code>ï¼šè¡¨ç¤ºOPèŠ‚ç‚¹dumpçš„è¾“å‡ºè·¯å¾„ï¼Œç¨‹åºæ­£å¸¸è¿è¡Œå®Œé€€å‡ºåï¼Œäº§ç”Ÿprofiler.logæ–‡ä»¶ã€‚</p>
<p>ä»¥ä¸‹ä»£ç å—ä»¥mobilenetv1æ¨¡å‹ä¸ºä¾‹ï¼Œå¼€å¯å•çº¿ç¨‹åŒæ—¶RunModelï¼Œè®¾ç½® <code>export HB_DNN_PROFILER_LOG_PATH=./</code>ï¼Œåˆ™ç»Ÿè®¡è¾“å‡ºçš„ä¿¡æ¯å¦‚ä¸‹ï¼š</p>
<div class="highlight-container" data-rel="Json"><figure class="iseeu highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"> <span class="number">1</span><span class="punctuation">&#123;</span></span><br><span class="line"> <span class="number">2</span>  <span class="attr">&quot;perf_result&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"> <span class="number">3</span>    <span class="attr">&quot;FPS&quot;</span><span class="punctuation">:</span> <span class="number">3492.5347070636512</span><span class="punctuation">,</span></span><br><span class="line"> <span class="number">4</span>    <span class="attr">&quot;average_latency&quot;</span><span class="punctuation">:</span> <span class="number">2.1842353343963623</span></span><br><span class="line"> <span class="number">5</span>  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"> <span class="number">6</span>  <span class="attr">&quot;running_condition&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"> <span class="number">7</span>    <span class="attr">&quot;core_id&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line"> <span class="number">8</span>    <span class="attr">&quot;frame_count&quot;</span><span class="punctuation">:</span> <span class="number">200</span><span class="punctuation">,</span></span><br><span class="line"> <span class="number">9</span>    <span class="attr">&quot;model_name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/home/jenkins/workspace/oolchain_tc_sys_release_j5_1.7.0/j5_toolchain/samples/03_classification/01_mobilenet/mapper/model_output/mobilenetv1_224x224_nv12&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="number">10</span>    <span class="attr">&quot;run_time&quot;</span><span class="punctuation">:</span> <span class="number">57.265</span><span class="punctuation">,</span></span><br><span class="line"><span class="number">11</span>    <span class="attr">&quot;thread_num&quot;</span><span class="punctuation">:</span> <span class="number">1</span></span><br><span class="line"><span class="number">12</span>  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="number">13</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="number">14</span>***</span><br><span class="line"><span class="number">15</span><span class="punctuation">&#123;</span></span><br><span class="line"><span class="number">16</span>  <span class="attr">&quot;chip_latency&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="number">17</span>    <span class="attr">&quot;BPU_inference_time_cost&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="number">18</span>      <span class="attr">&quot;avg_time&quot;</span><span class="punctuation">:</span> <span class="number">1.985635</span><span class="punctuation">,</span></span><br><span class="line"><span class="number">19</span>      <span class="attr">&quot;max_time&quot;</span><span class="punctuation">:</span> <span class="number">2.055</span><span class="punctuation">,</span></span><br><span class="line"><span class="number">20</span>      <span class="attr">&quot;min_time&quot;</span><span class="punctuation">:</span> <span class="number">1.047</span></span><br><span class="line"><span class="number">21</span>    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="number">22</span>    <span class="attr">&quot;CPU_inference_time_cost&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="number">23</span>      <span class="attr">&quot;avg_time&quot;</span><span class="punctuation">:</span> <span class="number">0.07651</span><span class="punctuation">,</span></span><br><span class="line"><span class="number">24</span>      <span class="attr">&quot;max_time&quot;</span><span class="punctuation">:</span> <span class="number">0.23300000000000004</span><span class="punctuation">,</span></span><br><span class="line"><span class="number">25</span>      <span class="attr">&quot;min_time&quot;</span><span class="punctuation">:</span> <span class="number">0.069</span></span><br><span class="line"><span class="number">26</span>    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="number">27</span>  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="number">28</span>  <span class="attr">&quot;model_latency&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="number">29</span>    <span class="attr">&quot;BPU_MOBILENET_subgraph_0&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="number">30</span>      <span class="attr">&quot;avg_time&quot;</span><span class="punctuation">:</span> <span class="number">1.985635</span><span class="punctuation">,</span></span><br><span class="line"><span class="number">31</span>      <span class="attr">&quot;max_time&quot;</span><span class="punctuation">:</span> <span class="number">2.055</span><span class="punctuation">,</span></span><br><span class="line"><span class="number">32</span>      <span class="attr">&quot;min_time&quot;</span><span class="punctuation">:</span> <span class="number">1.047</span></span><br><span class="line"><span class="number">33</span>    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="number">34</span>    <span class="attr">&quot;Dequantize_fc7_1_HzDequantize&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="number">35</span>      <span class="attr">&quot;avg_time&quot;</span><span class="punctuation">:</span> <span class="number">0.03118</span><span class="punctuation">,</span></span><br><span class="line"><span class="number">36</span>      <span class="attr">&quot;max_time&quot;</span><span class="punctuation">:</span> <span class="number">0.081</span><span class="punctuation">,</span></span><br><span class="line"><span class="number">37</span>      <span class="attr">&quot;min_time&quot;</span><span class="punctuation">:</span> <span class="number">0.029</span></span><br><span class="line"><span class="number">38</span>    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="number">39</span>    <span class="attr">&quot;MOBILENET_subgraph_0_output_layout_convert&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="number">40</span>      <span class="attr">&quot;avg_time&quot;</span><span class="punctuation">:</span> <span class="number">0.009460000000000001</span><span class="punctuation">,</span></span><br><span class="line"><span class="number">41</span>      <span class="attr">&quot;max_time&quot;</span><span class="punctuation">:</span> <span class="number">0.033</span><span class="punctuation">,</span></span><br><span class="line"><span class="number">42</span>      <span class="attr">&quot;min_time&quot;</span><span class="punctuation">:</span> <span class="number">0.008</span></span><br><span class="line"><span class="number">43</span>    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="number">44</span>    <span class="attr">&quot;Preprocess&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="number">45</span>      <span class="attr">&quot;avg_time&quot;</span><span class="punctuation">:</span> <span class="number">0.005860000000000001</span><span class="punctuation">,</span></span><br><span class="line"><span class="number">46</span>      <span class="attr">&quot;max_time&quot;</span><span class="punctuation">:</span> <span class="number">0.037</span><span class="punctuation">,</span></span><br><span class="line"><span class="number">47</span>      <span class="attr">&quot;min_time&quot;</span><span class="punctuation">:</span> <span class="number">0.004</span></span><br><span class="line"><span class="number">48</span>    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="number">49</span>    <span class="attr">&quot;Softmax_prob&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="number">50</span>      <span class="attr">&quot;avg_time&quot;</span><span class="punctuation">:</span> <span class="number">0.030010000000000002</span><span class="punctuation">,</span></span><br><span class="line"><span class="number">51</span>      <span class="attr">&quot;max_time&quot;</span><span class="punctuation">:</span> <span class="number">0.082</span><span class="punctuation">,</span></span><br><span class="line"><span class="number">52</span>      <span class="attr">&quot;min_time&quot;</span><span class="punctuation">:</span> <span class="number">0.028</span></span><br><span class="line"><span class="number">53</span>    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="number">54</span>  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="number">55</span>  <span class="attr">&quot;task_latency&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="number">56</span>    <span class="attr">&quot;TaskPendingTime&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="number">57</span>      <span class="attr">&quot;avg_time&quot;</span><span class="punctuation">:</span> <span class="number">0.019245</span><span class="punctuation">,</span></span><br><span class="line"><span class="number">58</span>      <span class="attr">&quot;max_time&quot;</span><span class="punctuation">:</span> <span class="number">0.145</span><span class="punctuation">,</span></span><br><span class="line"><span class="number">59</span>      <span class="attr">&quot;min_time&quot;</span><span class="punctuation">:</span> <span class="number">0.008</span></span><br><span class="line"><span class="number">60</span>    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="number">61</span>    <span class="attr">&quot;TaskRunningTime&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="number">62</span>      <span class="attr">&quot;avg_time&quot;</span><span class="punctuation">:</span> <span class="number">2.12983</span><span class="punctuation">,</span></span><br><span class="line"><span class="number">63</span>      <span class="attr">&quot;max_time&quot;</span><span class="punctuation">:</span> <span class="number">2.208</span><span class="punctuation">,</span></span><br><span class="line"><span class="number">64</span>      <span class="attr">&quot;min_time&quot;</span><span class="punctuation">:</span> <span class="number">1.427</span></span><br><span class="line"><span class="number">65</span>    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="number">66</span>  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="number">67</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></div>

<p>ä»¥ä¸Šè¾“å‡ºäº† <code>model_latency</code> å’Œ <code>task_latency</code>ã€‚å…¶ ä¸­model_latencyä¸­è¾“å‡ºäº†æ¨¡å‹æ¯ä¸ªOPè¿è¡Œæ‰€éœ€è¦çš„è€—æ—¶æƒ…å†µï¼Œtask_latencyä¸­è¾“å‡ºäº†æ¨¡å‹è¿è¡Œä¸­å„ä¸ªtaskæ¨¡å—çš„è€—æ—¶æƒ…å†µã€‚</p>
<h5 id="dumpå·¥å…·"><a href="#dumpå·¥å…·" class="headerlink" title="dumpå·¥å…·"></a>dumpå·¥å…·</h5><p>é€šè¿‡å¼€å¯ <code>HB_DNN_DUMP_PATH</code> è¿™ä¸ªç¯å¢ƒå˜é‡å¯ä»¥dumpå‡ºæ¨¡å‹æ¨ç†è¿‡ç¨‹ä¸­æ¯ä¸ªèŠ‚ç‚¹çš„è¾“å…¥å’Œè¾“å‡ºã€‚ é€šè¿‡dumpå·¥å…·ï¼Œå¯ä»¥æ’æŸ¥æ¨¡æ‹Ÿå™¨å’ŒçœŸæœºæ˜¯å¦å­˜åœ¨ä¸€è‡´æ€§é—®é¢˜ï¼šå³ç›¸åŒæ¨¡å‹ï¼Œç›¸åŒè¾“å…¥ï¼ŒçœŸæœºå’Œæ¨¡æ‹Ÿå™¨çš„è¾“å‡ºç»“æœæ˜¯å¦å®Œå…¨ç›¸åŒã€‚</p>

            </div>

            
                <div class="post-copyright-info">
                    <div class="article-copyright-info-container">
    <ul>
        <li><strong>æ ‡é¢˜:</strong> J5</li>
        <li><strong>ä½œè€…:</strong> Airex Yu</li>
        <li><strong>åˆ›å»ºäº:</strong> 2023-04-13 15:49:21</li>
        
            <li>
                <strong>æ›´æ–°äº:</strong> 2023-07-04 12:04:28
            </li>
        
        <li>
            <strong>é“¾æ¥:</strong> http://example.com/2023/04/13/J5/
        </li>
        <li>
            <strong>ç‰ˆæƒå£°æ˜:</strong> æœ¬æ–‡ç« é‡‡ç”¨ <a class="license" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">CC BY-NC-SA 4.0</a> è¿›è¡Œè®¸å¯ã€‚
        </li>
    </ul>
</div>

                </div>
            

            
                <ul class="post-tags-box">
                    
                        <li class="tag-item">
                            <a href="/tags/ONNX/">#ONNX</a>&nbsp;
                        </li>
                    
                        <li class="tag-item">
                            <a href="/tags/J5/">#J5</a>&nbsp;
                        </li>
                    
                        <li class="tag-item">
                            <a href="/tags/ISP/">#ISP</a>&nbsp;
                        </li>
                    
                        <li class="tag-item">
                            <a href="/tags/%E9%A1%B9%E7%9B%AE/">#é¡¹ç›®</a>&nbsp;
                        </li>
                    
                        <li class="tag-item">
                            <a href="/tags/%E7%83%A7%E5%86%99%E9%95%9C%E5%83%8F/">#çƒ§å†™é•œåƒ</a>&nbsp;
                        </li>
                    
                        <li class="tag-item">
                            <a href="/tags/PTQ/">#PTQ</a>&nbsp;
                        </li>
                    
                        <li class="tag-item">
                            <a href="/tags/Docker/">#Docker</a>&nbsp;
                        </li>
                    
                        <li class="tag-item">
                            <a href="/tags/%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/">#åµŒå…¥å¼å¼€å‘</a>&nbsp;
                        </li>
                    
                        <li class="tag-item">
                            <a href="/tags/%E6%B5%AE%E7%82%B9%E6%A8%A1%E5%9E%8B%E8%BD%AC%E5%AE%9A%E7%82%B9%E6%A8%A1%E5%9E%8B/">#æµ®ç‚¹æ¨¡å‹è½¬å®šç‚¹æ¨¡å‹</a>&nbsp;
                        </li>
                    
                        <li class="tag-item">
                            <a href="/tags/%E5%9C%B0%E5%B9%B3%E7%BA%BF/">#åœ°å¹³çº¿</a>&nbsp;
                        </li>
                    
                </ul>
            

            

            
                <div class="article-nav">
                    
                        <div class="article-prev">
                            <a class="prev"
                            rel="prev"
                            href="/2023/05/26/Docker/"
                            >
                                <span class="left arrow-icon flex-center">
                                    <i class="fa-solid fa-chevron-left"></i>
                                </span>
                                <span class="title flex-center">
                                    <span class="post-nav-title-item">Docker</span>
                                    <span class="post-nav-item">ä¸Šä¸€ç¯‡</span>
                                </span>
                            </a>
                        </div>
                    
                    
                        <div class="article-next">
                            <a class="next"
                            rel="next"
                            href="/2023/04/06/MPI/"
                            >
                                <span class="title flex-center">
                                    <span class="post-nav-title-item">MPI</span>
                                    <span class="post-nav-item">ä¸‹ä¸€ç¯‡</span>
                                </span>
                                <span class="right arrow-icon flex-center">
                                    <i class="fa-solid fa-chevron-right"></i>
                                </span>
                            </a>
                        </div>
                    
                </div>
            


            
                <div class="comment-container">
                    <div class="comments-container">
    <div id="comment-anchor"></div>
    <div class="comment-area-title">
        <i class="fa-solid fa-comments"></i>&nbsp;è¯„è®º
    </div>
    

        
            
 
    <div id="waline"></div>
    <script type="module"  data-pjax>
        import { init } from 'https://evan.beee.top/js/waline.mjs';

        function loadWaline() {
            init({
                el: '#waline',
                serverURL: 'https://example.example.com',
                lang: 'zh-CN',
                dark: 'body[class~="dark-mode"]',
                requiredMeta: ['nick','mail'], // cannot customize by theme config, change it yourself
            });
        }

        if ('true') {
            const loadWalineTimeout = setTimeout(() => {
                loadWaline();
                clearTimeout(loadWalineTimeout);
            }, 1000);
        } else {
            window.addEventListener('DOMContentLoaded', loadWaline);
        }
        
    </script>



        
    
</div>

                </div>
            
        </div>

        
            <div class="toc-content-container">
                <div class="post-toc-wrap">
    <div class="post-toc">
        <div class="toc-title">æ­¤é¡µç›®å½•</div>
        <div class="page-title">J5</div>
        <ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#J5-ISP%E8%BD%AF%E7%A1%AC%E4%BB%B6%E6%80%BB%E4%BD%93%E4%BB%8B%E7%BB%8D"><span class="nav-text">J5 ISPè½¯ç¡¬ä»¶æ€»ä½“ä»‹ç»</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#ISP%E5%90%8D%E8%AF%8D%E8%A7%A3%E9%87%8A"><span class="nav-text">ISPåè¯è§£é‡Š</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ISP-pipeline%E4%BB%8B%E7%BB%8D"><span class="nav-text">ISP pipelineä»‹ç»</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#J5%E6%B5%81%E7%A8%8B"><span class="nav-text">J5æµç¨‹</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#J5-ISP-feature"><span class="nav-text">J5 ISP feature</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#J5-ISP%E6%80%A7%E8%83%BD"><span class="nav-text">J5 ISPæ€§èƒ½</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ISP%E7%A1%AC%E4%BB%B6%E5%8E%9F%E7%90%86"><span class="nav-text">ISPç¡¬ä»¶åŸç†</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#ISP%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="nav-text">ISPå·¥ä½œåŸç†</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ISP%E8%B0%83%E5%BA%A6%E6%A8%A1%E5%BC%8F"><span class="nav-text">ISPè°ƒåº¦æ¨¡å¼</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ISP%E5%85%B8%E5%9E%8B%E4%B8%AD%E6%96%AD%E6%97%B6%E5%BA%8F"><span class="nav-text">ISPå…¸å‹ä¸­æ–­æ—¶åº</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ISP%E8%BD%AF%E4%BB%B6%E6%9E%B6%E6%9E%84"><span class="nav-text">ISPè½¯ä»¶æ¶æ„</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#ISP-%E8%BD%AF%E4%BB%B6%E6%9E%B6%E6%9E%84overview"><span class="nav-text">ISP è½¯ä»¶æ¶æ„overview</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ISP%E8%BD%AF%E4%BB%B6feature"><span class="nav-text">ISPè½¯ä»¶feature</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ISP%E8%BD%AF%E4%BB%B6%E6%95%B0%E6%8D%AE%E6%B5%81%E4%B8%8E%E6%8E%A7%E5%88%B6%E6%B5%81"><span class="nav-text">ISPè½¯ä»¶æ•°æ®æµä¸æ§åˆ¶æµ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ISP-firmware%E7%9B%B8%E4%BA%92%E5%85%B3%E7%B3%BB"><span class="nav-text">ISP firmwareç›¸äº’å…³ç³»</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ISP%E8%BD%AF%E4%BB%B6%E6%B5%81%E7%A8%8B"><span class="nav-text">ISPè½¯ä»¶æµç¨‹</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#ISP%E8%BD%AF%E4%BB%B6%E5%88%9D%E5%A7%8B%E5%8C%96%E4%B8%8E%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B"><span class="nav-text">ISPè½¯ä»¶åˆå§‹åŒ–ä¸å·¥ä½œæµç¨‹</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ISP-2A-amp-ISP-kernel-drv%E7%9A%84%E4%BA%A4%E4%BA%92%E6%B5%81%E7%A8%8B"><span class="nav-text">ISP 2A &amp; ISP kernel drvçš„äº¤äº’æµç¨‹</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ISP%E5%AF%B9%E5%A4%96API%E4%BD%BF%E7%94%A8%E6%B5%81%E7%A8%8B"><span class="nav-text">ISPå¯¹å¤–APIä½¿ç”¨æµç¨‹</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ISP%E5%AF%B9%E5%A4%96API"><span class="nav-text">ISPå¯¹å¤–API</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#JSP%E5%9C%A8%E7%BA%BFtuning%E6%B5%81%E7%A8%8B"><span class="nav-text">JSPåœ¨çº¿tuningæµç¨‹</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#J5-ISP%E7%B3%BB%E7%BB%9F%E9%A9%B1%E5%8A%A8%E5%AE%9E%E7%8E%B0%E4%BB%8B%E7%BB%8D"><span class="nav-text">J5 ISPç³»ç»Ÿé©±åŠ¨å®ç°ä»‹ç»</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#ISP%E9%A9%B1%E5%8A%A8%E8%BD%AF%E4%BB%B6%E6%95%B4%E4%BD%93%E6%A1%86%E6%9E%B6"><span class="nav-text">ISPé©±åŠ¨è½¯ä»¶æ•´ä½“æ¡†æ¶</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#ISP%E9%A9%B1%E5%8A%A8%E6%A1%86%E6%9E%B6"><span class="nav-text">ISPé©±åŠ¨æ¡†æ¶</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ISP-%E8%AE%BE%E5%A4%87%E6%8E%A5%E5%85%A5%E6%80%BB%E4%BD%93%E9%80%9A%E8%B7%AF"><span class="nav-text">ISP è®¾å¤‡æ¥å…¥æ€»ä½“é€šè·¯</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ISP%E9%A9%B1%E5%8A%A8%E4%BA%8B%E4%BB%B6%E3%80%81%E7%8A%B6%E6%80%81%E6%9C%BA%E3%80%81%E7%BA%BF%E7%A8%8B%E8%B0%83%E5%BA%A6%E4%BB%8B%E7%BB%8D"><span class="nav-text">ISPé©±åŠ¨äº‹ä»¶ã€çŠ¶æ€æœºã€çº¿ç¨‹è°ƒåº¦ä»‹ç»</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#ISP%E9%A9%B1%E5%8A%A8%E4%B8%AD%E6%96%AD%E4%BA%8B%E4%BB%B6"><span class="nav-text">ISPé©±åŠ¨ä¸­æ–­äº‹ä»¶</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ISP-FSM%E7%8A%B6%E6%80%81%E6%9C%BA%E8%BD%AE%E8%BD%AC"><span class="nav-text">ISP FSMçŠ¶æ€æœºè½®è½¬</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ISP%E4%BA%8B%E4%BB%B6%E8%BD%AE%E8%BD%AC"><span class="nav-text">ISPäº‹ä»¶è½®è½¬</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ISP%E9%A9%B1%E5%8A%A8%E7%BA%BF%E7%A8%8B"><span class="nav-text">ISPé©±åŠ¨çº¿ç¨‹</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ISP%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86"><span class="nav-text">ISPå†…å­˜ç®¡ç†</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#ISP%E9%A9%B1%E5%8A%A8%E5%86%85%E5%AD%98%E7%A9%BA%E9%97%B4"><span class="nav-text">ISPé©±åŠ¨å†…å­˜ç©ºé—´</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ISP%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E6%B5%81%E7%A8%8B"><span class="nav-text">ISPæ•°æ®å¤„ç†æµç¨‹</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#ISP%E7%BB%9F%E8%AE%A1%E6%95%B0%E6%8D%AE%E6%9B%B4%E6%96%B0%E6%B5%81%E7%A8%8B"><span class="nav-text">ISPç»Ÿè®¡æ•°æ®æ›´æ–°æµç¨‹</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ISP-command-API%E6%B5%81%E7%A8%8B%EF%BC%88%E6%8E%A8%E5%8A%A8%E4%BA%8B%E4%BB%B6%EF%BC%8C%E6%B7%BB%E5%8A%A0%E4%BA%8B%E4%BB%B6%EF%BC%89"><span class="nav-text">ISP command APIæµç¨‹ï¼ˆæ¨åŠ¨äº‹ä»¶ï¼Œæ·»åŠ äº‹ä»¶ï¼‰</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ISP-command-api%E7%B1%BB%E5%9E%8B"><span class="nav-text">ISP command apiç±»å‹</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ISP%E9%A9%B1%E5%8A%A8%E5%A4%84%E7%90%86%E6%97%B6%E5%BA%8F%E6%B5%81%E7%A8%8B"><span class="nav-text">ISPé©±åŠ¨å¤„ç†æ—¶åºæµç¨‹</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#J5-Tuning%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C%E4%BB%8B%E7%BB%8D"><span class="nav-text">J5 Tuningå‡†å¤‡å·¥ä½œä»‹ç»</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#AE-x2F-AWB%E4%BB%8B%E7%BB%8D"><span class="nav-text">AE&#x2F;AWBä»‹ç»</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%9F%E8%AE%A1%E6%95%B0%E6%8D%AE"><span class="nav-text">ç»Ÿè®¡æ•°æ®</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#AE%E4%BB%8B%E7%BB%8D"><span class="nav-text">AEä»‹ç»</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#AE%E6%B5%8B%E5%85%89%E6%96%B9%E5%BC%8F"><span class="nav-text">AEæµ‹å…‰æ–¹å¼</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#AWB%E4%BB%8B%E7%BB%8D"><span class="nav-text">AWBä»‹ç»</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#sensor%E9%A9%B1%E5%8A%A8%E5%BC%80%E5%8F%91%E5%92%8C%E9%AA%8C%E8%AF%81"><span class="nav-text">sensoré©±åŠ¨å¼€å‘å’ŒéªŒè¯</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#sensor%E9%A9%B1%E5%8A%A8%E5%AE%9E%E7%8E%B0"><span class="nav-text">sensoré©±åŠ¨å®ç°</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#sensor%E9%A9%B1%E5%8A%A8%E4%BB%8B%E7%BB%8D"><span class="nav-text">sensoré©±åŠ¨ä»‹ç»</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%A9%B1%E5%8A%A8%E5%B1%82%E6%8E%A7%E5%88%B6%E5%AE%9E%E7%8E%B0"><span class="nav-text">é©±åŠ¨å±‚æ§åˆ¶å®ç°</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%94%A8%E6%88%B7%E5%B1%82%E6%8E%A7%E5%88%B6%E5%AE%9E%E7%8E%B0"><span class="nav-text">ç”¨æˆ·å±‚æ§åˆ¶å®ç°</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#sensor%E9%A9%B1%E5%8A%A8%E9%AA%8C%E8%AF%81"><span class="nav-text">sensoré©±åŠ¨éªŒè¯</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Tuning%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8%E4%BB%8B%E7%BB%8D"><span class="nav-text">Tuningå·¥å…·ä½¿ç”¨ä»‹ç»</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Control-Tool"><span class="nav-text">Control Tool</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#HobotPlayer"><span class="nav-text">HobotPlayer</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Tuning%E5%8F%82%E6%95%B0%E9%83%A8%E7%BD%B2"><span class="nav-text">Tuningå‚æ•°éƒ¨ç½²</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Tuning%E5%8F%82%E6%95%B0"><span class="nav-text">Tuningå‚æ•°</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Tuning%E5%8F%82%E6%95%B0%E7%BC%96%E8%AF%91"><span class="nav-text">Tuningå‚æ•°ç¼–è¯‘</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Tuning%E5%8F%82%E6%95%B0%E9%83%A8%E7%BD%B2-1"><span class="nav-text">Tuningå‚æ•°éƒ¨ç½²</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Tuning%E5%AE%9E%E6%88%98%E7%BB%8F%E9%AA%8C%E5%88%86%E4%BA%AB"><span class="nav-text">Tuningå®æˆ˜ç»éªŒåˆ†äº«</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#ISP-Feature-x2F-Pipeline%E5%8F%8A%E5%AE%A2%E8%A7%82%E7%9F%AB%E6%AD%A3"><span class="nav-text">ISP Feature&#x2F;PipelineåŠå®¢è§‚çŸ«æ­£</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#ISP-Feature"><span class="nav-text">ISP Feature</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ISP-Algorithm-block-diagram-part"><span class="nav-text">ISP Algorithm block diagram-part</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#J5-%E8%B0%83%E8%AF%95%E7%8E%AF%E5%A2%83%E5%8F%8A%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C%E4%BB%8B%E7%BB%8D"><span class="nav-text">J5 è°ƒè¯•ç¯å¢ƒåŠåŸºæœ¬æ“ä½œä»‹ç»</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Hobot-player"><span class="nav-text">Hobot player</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Control-Tool-1"><span class="nav-text">Control Tool</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Tuning%E5%8F%82%E6%95%B0%E7%BC%96%E8%AF%91-1"><span class="nav-text">Tuningå‚æ•°ç¼–è¯‘</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Color%E6%A8%A1%E5%9D%97-AWB-x2F-CCM"><span class="nav-text">Coloræ¨¡å—-AWB&#x2F;CCM</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#AWB-Auto-white-balance-algorithm"><span class="nav-text">AWB - Auto white balance algorithm</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D-x3D"><span class="nav-text">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#J5-EVM%E5%BC%80%E5%8F%91%E5%A5%97%E4%BB%B6%E7%94%A8%E6%88%B7%E6%89%8B%E5%86%8C"><span class="nav-text">J5 EVMå¼€å‘å¥—ä»¶ç”¨æˆ·æ‰‹å†Œ</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%A1%AC%E4%BB%B6%E5%B9%B3%E5%8F%B0%E4%BB%8B%E7%BB%8D"><span class="nav-text">ç¡¬ä»¶å¹³å°ä»‹ç»</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%8A%AF%E7%89%87%E6%A1%86%E5%9B%BE"><span class="nav-text">èŠ¯ç‰‡æ¡†å›¾</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BC%80%E5%8F%91%E6%9D%BF%E5%AE%9E%E7%89%A9%E5%9B%BE"><span class="nav-text">å¼€å‘æ¿å®ç‰©å›¾</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%96%E8%AE%BE%E5%AE%89%E8%A3%85"><span class="nav-text">å¤–è®¾å®‰è£…</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%BD%AF%E4%BB%B6%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7"><span class="nav-text">è½¯ä»¶å¼€å‘å·¥å…·</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%B3%BB%E7%BB%9F%E6%A1%86%E5%9B%BE"><span class="nav-text">ç³»ç»Ÿæ¡†å›¾</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84"><span class="nav-text">å¼€å‘å·¥å…·ç›®å½•ç»“æ„</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9D%BF%E7%AB%AF%E8%BF%9E%E6%8E%A5%E6%96%B9%E6%B3%95"><span class="nav-text">æ¿ç«¯è¿æ¥æ–¹æ³•</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BD%91%E5%8F%A3%E8%BF%9E%E6%8E%A5"><span class="nav-text">ç½‘å£è¿æ¥</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%B2%E5%8F%A3%E6%8E%A5%E5%8F%A3"><span class="nav-text">ä¸²å£æ¥å£</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BC%96%E8%AF%91%E9%95%9C%E5%83%8F%E8%AF%B4%E6%98%8E"><span class="nav-text">ç¼–è¯‘é•œåƒè¯´æ˜</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="nav-text">ç¯å¢ƒæ­å»º</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%96%E8%AF%91%E5%91%BD%E4%BB%A4"><span class="nav-text">ç¼–è¯‘å‘½ä»¤</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%96%E8%AF%91%E5%8F%82%E6%95%B0"><span class="nav-text">ç¼–è¯‘å‚æ•°</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%96%E8%AF%91%E9%85%8D%E7%BD%AE"><span class="nav-text">ç¼–è¯‘é…ç½®</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%96%E8%AF%91%E8%BE%93%E5%87%BA"><span class="nav-text">ç¼–è¯‘è¾“å‡º</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AD%BE%E5%90%8D%E5%8A%A0%E5%AF%86"><span class="nav-text">ç­¾ååŠ å¯†</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A8%A1%E5%9D%97%E7%BC%96%E8%AF%91"><span class="nav-text">æ¨¡å—ç¼–è¯‘</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%83%A7%E5%86%99%E9%95%9C%E5%83%8F%E8%AF%B4%E6%98%8E"><span class="nav-text">çƒ§å†™é•œåƒè¯´æ˜</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9C%B0%E5%B9%B3%E7%BA%BF%E7%83%A7%E5%86%99%E5%B7%A5%E5%85%B7"><span class="nav-text">åœ°å¹³çº¿çƒ§å†™å·¥å…·</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#UART"><span class="nav-text">UART</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Uboot-1"><span class="nav-text">Uboot</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SD"><span class="nav-text">SD</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%AA%8C%E8%AF%81%E6%A3%80%E6%9F%A5"><span class="nav-text">éªŒè¯æ£€æŸ¥</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%B3%BB%E7%BB%9F%E7%89%88%E6%9C%AC"><span class="nav-text">ç³»ç»Ÿç‰ˆæœ¬</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%8A%B6%E6%80%81%E6%A3%80%E6%9F%A5%EF%BC%9AMCore"><span class="nav-text">çŠ¶æ€æ£€æŸ¥ï¼šMCore</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7"><span class="nav-text">å¸¸ç”¨å·¥å…·</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%9C%B0%E5%B9%B3%E7%BA%BF%E5%BE%81%E7%A8%8B5-%E8%8A%AF%E7%89%87%E7%AE%97%E6%B3%95%E5%B7%A5%E5%85%B7%E9%93%BE"><span class="nav-text">åœ°å¹³çº¿å¾ç¨‹5 èŠ¯ç‰‡ç®—æ³•å·¥å…·é“¾</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BA%A7%E5%93%81%E7%AE%80%E4%BB%8B"><span class="nav-text">äº§å“ç®€ä»‹</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%8E%AF%E5%A2%83%E5%AE%89%E8%A3%85"><span class="nav-text">ç¯å¢ƒå®‰è£…</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8"><span class="nav-text">å¿«é€Ÿå…¥é—¨</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B5%AE%E7%82%B9%E6%A8%A1%E5%9E%8B%E8%BD%AC%E5%AE%9A%E7%82%B9%E6%A8%A1%E5%9E%8B%E6%89%8B%E5%86%8C"><span class="nav-text">æµ®ç‚¹æ¨¡å‹è½¬å®šç‚¹æ¨¡å‹æ‰‹å†Œ</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2021-04-21-11-13-08-337-INFO-Convert-to-runtime-bin-file-successfully-2021-04-21-11-13-08-337-INFO-End-Model-Convert"><span class="nav-text">2021-04-21 11:13:08,337 INFO Convert to runtime bin file successfully!2021-04-21 11:13:08,337 INFO End Model Convert123*ç›¸ä¼¼åº¦ä¿¡æ¯ä¹Ÿå­˜åœ¨äº &#96;makertbin&#96; çš„æ§åˆ¶å°è¾“å‡ºå†…å®¹ä¸­ï¼Œåœ¨ &#96;makertbin&#96; çŠ¶æ€ä¿¡æ¯ä¹‹å‰ï¼Œå…¶å†…å®¹å½¢å¼å¦‚ä¸‹ï¼š*</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Node-ON-Subgraph-Type-Cosine-Similarity-Threshold"><span class="nav-text">Node    ON   Subgraph  Type     Cosine Similarity  Threshold</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91%EF%BC%88runtime%EF%BC%89%E6%89%8B%E5%86%8C"><span class="nav-text">åµŒå…¥å¼åº”ç”¨å¼€å‘ï¼ˆruntimeï¼‰æ‰‹å†Œ</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91%E6%8C%87%E5%AF%BC"><span class="nav-text">åµŒå…¥å¼åº”ç”¨å¼€å‘æŒ‡å¯¼</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#BPU-SDK-API%E6%89%8B%E5%86%8C"><span class="nav-text">BPU SDK APIæ‰‹å†Œ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9F%BA%E7%A1%80%E7%A4%BA%E4%BE%8B%E5%8C%85%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E"><span class="nav-text">åŸºç¡€ç¤ºä¾‹åŒ…ä½¿ç”¨è¯´æ˜</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#AI-Benchmark%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E"><span class="nav-text">AI-Benchmarkä½¿ç”¨è¯´æ˜</span></a></li></ol></li></ol></li></ol>

    </div>
</div>
            </div>
        
    </div>
</div>


                

            </div>
            
            

        </div>

        <div class="main-content-footer">
            <footer class="footer">
    <div class="info-container">
        <div class="copyright-info">
            &copy;
            
              <span>2023</span>
              -
            
            2023&nbsp;&nbsp;<i class="fa-solid fa-heart fa-beat" style="--fa-animation-duration: 0.5s; color: #f54545"></i>&nbsp;&nbsp;<a href="/">Airex Yu</a>
        </div>
        
            <script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            <div class="website-count info-item">
                
                    <span id="busuanzi_container_site_uv" class="busuanzi_container_site_uv">
                        è®¿é—®äººæ•°&nbsp;<span id="busuanzi_value_site_uv" class="busuanzi_value_site_uv"></span>
                    </span>
                
                
                    <span id="busuanzi_container_site_pv" class="busuanzi_container_site_pv">
                        æ€»è®¿é—®é‡&nbsp;<span id="busuanzi_value_site_pv" class="busuanzi_value_site_pv"></span>
                    </span>
                
            </div>
        
        <div class="theme-info info-item">
            <span class="powered-by-container">ç”± <?xml version="1.0" encoding="utf-8"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg version="1.1" id="åœ–å±¤_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1rem" height="1rem" viewBox="0 0 512 512" enable-background="new 0 0 512 512" xml:space="preserve"><path fill="#0E83CD" d="M256.4,25.8l-200,115.5L56,371.5l199.6,114.7l200-115.5l0.4-230.2L256.4,25.8z M349,354.6l-18.4,10.7l-18.6-11V275H200v79.6l-18.4,10.7l-18.6-11v-197l18.5-10.6l18.5,10.8V237h112v-79.6l18.5-10.6l18.5,10.8V354.6z"/></svg><a target="_blank" href="https://hexo.io">Hexo</a> é©±åŠ¨</span>
                <br>
            <span class="theme-version-container">ä¸»é¢˜&nbsp;<a class="theme-version" target="_blank" href="https://github.com/EvanNotFound/hexo-theme-redefine">Redefine v2.1.5</a>
        </div>
        
        
        
            <div id="start_div" style="display:none">
                2023/01/05 11:45:14
            </div>
            <div>
                åšå®¢å·²è¿è¡Œ <span class="odometer" id="runtime_days" ></span> å¤© <span class="odometer" id="runtime_hours"></span> å°æ—¶ <span class="odometer" id="runtime_minutes"></span> åˆ†é’Ÿ <span class="odometer" id="runtime_seconds"></span> ç§’
            </div>
        
        
        
            <script async data-pjax>
                try {
                    function odometer_init() {
                    const elements = document.querySelectorAll('.odometer');
                    elements.forEach(el => {
                        new Odometer({
                            el,
                            format: '( ddd).dd',
                            duration: 200
                        });
                    });
                    }
                    odometer_init();
                } catch (error) {}
            </script>
        
        
        
    </div>  
</footer>
        </div>
    </div>

    
        <div class="post-tools">
            <div class="post-tools-container">
    <ul class="article-tools-list">
        <!-- TOC aside toggle -->
        
            <li class="right-bottom-tools page-aside-toggle">
                <i class="fa-regular fa-outdent"></i>
            </li>
        

        <!-- go comment -->
        
            <li class="go-comment">
                <i class="fa-regular fa-comments"></i>
            </li>
        
    </ul>
</div>

        </div>
    

    <div class="right-side-tools-container">
        <div class="side-tools-container">
    <ul class="hidden-tools-list">
        <li class="right-bottom-tools tool-font-adjust-plus flex-center">
            <i class="fa-regular fa-magnifying-glass-plus"></i>
        </li>

        <li class="right-bottom-tools tool-font-adjust-minus flex-center">
            <i class="fa-regular fa-magnifying-glass-minus"></i>
        </li>

        <li class="right-bottom-tools tool-expand-width flex-center">
            <i class="fa-regular fa-expand"></i>
        </li>

        <li class="right-bottom-tools tool-dark-light-toggle flex-center">
            <i class="fa-regular fa-moon"></i>
        </li>

        <!-- rss -->
        

        

        <li class="right-bottom-tools tool-scroll-to-bottom flex-center">
            <i class="fa-regular fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="visible-tools-list">
        <li class="right-bottom-tools toggle-tools-list flex-center">
            <i class="fa-regular fa-cog fa-spin"></i>
        </li>
        
            <li class="right-bottom-tools tool-scroll-to-top flex-center">
                <i class="arrow-up fas fa-arrow-up"></i>
                <span class="percent"></span>
            </li>
        
        
    </ul>
</div>

    </div>

    <div class="image-viewer-container">
    <img src="">
</div>


    
        <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
          <span class="search-input-field-pre">
            <i class="fa-solid fa-keyboard"></i>
          </span>
            <div class="search-input-container">
                <input autocomplete="off"
                       autocorrect="off"
                       autocapitalize="off"
                       placeholder="æœç´¢..."
                       spellcheck="false"
                       type="search"
                       class="search-input"
                >
            </div>
            <span class="popup-btn-close">
                <i class="fa-solid fa-times"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fa-solid fa-spinner fa-spin-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>

    


</main>




<script src="/js/utils.js"></script>

<script src="/js/main.js"></script>

<script src="/js/layouts/navbarShrink.js"></script>

<script src="/js/tools/scrollTopBottom.js"></script>

<script src="/js/tools/lightDarkSwitch.js"></script>



    
<script src="/js/tools/localSearch.js"></script>




    
<script src="/js/tools/codeBlock.js"></script>




    
<script src="/js/layouts/lazyload.js"></script>




    
<script src="/js/tools/runtime.js"></script>

    
<script src="/js/libs/odometer.min.js"></script>

    
<link rel="stylesheet" href="/assets/odometer-theme-minimal.css">




  
<script src="/js/libs/Typed.min.js"></script>

  
<script src="/js/plugins/typed.js"></script>




    
<script src="/js/libs/mermaid.min.js"></script>

    
<script src="/js/plugins/mermaid.js"></script>





<div class="post-scripts pjax">
    
        
<script src="/js/tools/tocToggle.js"></script>

<script src="/js/libs/anime.min.js"></script>

<script src="/js/layouts/toc.js"></script>

<script src="/js/plugins/tabs.js"></script>

    
</div>


    
<script src="/js/libs/pjax.min.js"></script>

<script>
    window.addEventListener('DOMContentLoaded', () => {
        window.pjax = new Pjax({
            selectors: [
                'head title',
                '.page-container',
                '.pjax',
            ],
            history: true,
            debug: false,
            cacheBust: false,
            timeout: 0,
            analytics: false,
            currentUrlFullReload: false,
            scrollRestoration: false,
            // scrollTo: true,
        });

        document.addEventListener('pjax:send', () => {
            Global.utils.pjaxProgressBarStart();
        });

        document.addEventListener('pjax:complete', () => {
            Global.utils.pjaxProgressBarEnd();
            window.pjax.executeScripts(document.querySelectorAll('script[data-pjax], .pjax script'));
            Global.refresh();
        });
    });
</script>




</body>
</html>
