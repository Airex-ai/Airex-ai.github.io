<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="keywords" content="Hexo Theme Redefine">
    
    <meta name="author" content="Airex Yu">
    <!-- preconnect -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    
    <!--- Seo Part-->
    
    <link rel="canonical" href="http://example.com/2023/04/06/mpi/"/>
    <meta name="robots" content="index,follow">
    <meta name="googlebot" content="index,follow">
    <meta name="revisit-after" content="1 days">
    
        <meta name="description" content="ä»‹ç»MPI çš„å†å²ç®€ä»‹åˆ†å¸ƒå¼è®¡ç®—ç°åœ¨å¯¹äºæˆ‘ä»¬æ¥è¯´ï¼Œå°±è·Ÿæ—¥å¸¸ç”Ÿæ´»é‡Œçš„æ‰‹æœºå’Œç”µè„‘ä¸€æ ·æ™®åŠã€‚ä½ å¾ˆæ˜æ˜¾åº”è¯¥è®¤åŒè¿™ä¸ªè§‚ç‚¹ï¼Œå› ä¸ºä½ å‘ç°äº†è¿™ä¸ªäº†ä¸èµ·çš„ MPI æ•™ç¨‹ç½‘ç«™ï¼ä¸ç®¡ä½ æ˜¯å‡ºäºä»€ä¹ˆåŸå› æƒ³å­¦ä¹ å¹¶è¡Œç¼–ç¨‹ï¼ˆparallel programmingï¼‰ï¼Œæˆ–è€…è¯´åˆ†å¸ƒå¼ç¼–ç¨‹ã€å¹¶è¡Œç¼–ç¨‹ï¼Œä¹Ÿè®¸æ˜¯å› ä¸ºè¯¾ç¨‹éœ€è¦ï¼Œæˆ–è€…æ˜¯å·¥ä½œï¼Œæˆ–è€…å•çº¯åœ°è§‰å¾—å¥½ç©ï¼Œæˆ‘è§‰å¾—ä½ éƒ½åº”è¯¥é€‰æ‹©ä¸€é¡¹åœ¨æœªæ¥å‡ å¹´ä¾ç„¶ååˆ†æœ‰ä»·å€¼çš„æŠ€æœ¯å»å­¦ä¹ ã€‚æˆ‘è§‰å¾—ã€Œæ¶ˆæ¯ä¼ é€’æ¥å£ã€ï¼ˆ">
<meta property="og:type" content="article">
<meta property="og:title" content="MPI">
<meta property="og:url" content="http://example.com/2023/04/06/MPI/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="ä»‹ç»MPI çš„å†å²ç®€ä»‹åˆ†å¸ƒå¼è®¡ç®—ç°åœ¨å¯¹äºæˆ‘ä»¬æ¥è¯´ï¼Œå°±è·Ÿæ—¥å¸¸ç”Ÿæ´»é‡Œçš„æ‰‹æœºå’Œç”µè„‘ä¸€æ ·æ™®åŠã€‚ä½ å¾ˆæ˜æ˜¾åº”è¯¥è®¤åŒè¿™ä¸ªè§‚ç‚¹ï¼Œå› ä¸ºä½ å‘ç°äº†è¿™ä¸ªäº†ä¸èµ·çš„ MPI æ•™ç¨‹ç½‘ç«™ï¼ä¸ç®¡ä½ æ˜¯å‡ºäºä»€ä¹ˆåŸå› æƒ³å­¦ä¹ å¹¶è¡Œç¼–ç¨‹ï¼ˆparallel programmingï¼‰ï¼Œæˆ–è€…è¯´åˆ†å¸ƒå¼ç¼–ç¨‹ã€å¹¶è¡Œç¼–ç¨‹ï¼Œä¹Ÿè®¸æ˜¯å› ä¸ºè¯¾ç¨‹éœ€è¦ï¼Œæˆ–è€…æ˜¯å·¥ä½œï¼Œæˆ–è€…å•çº¯åœ°è§‰å¾—å¥½ç©ï¼Œæˆ‘è§‰å¾—ä½ éƒ½åº”è¯¥é€‰æ‹©ä¸€é¡¹åœ¨æœªæ¥å‡ å¹´ä¾ç„¶ååˆ†æœ‰ä»·å€¼çš„æŠ€æœ¯å»å­¦ä¹ ã€‚æˆ‘è§‰å¾—ã€Œæ¶ˆæ¯ä¼ é€’æ¥å£ã€ï¼ˆ">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/2023/04/06/MPI/image-20230406190258065.png">
<meta property="og:image" content="http://example.com/2023/04/06/MPI/image-20230406190643521.png">
<meta property="og:image" content="http://example.com/2023/04/06/MPI/image-20230406192458314.png">
<meta property="og:image" content="http://example.com/2023/04/06/MPI/image-20230406201220958.png">
<meta property="og:image" content="http://example.com/2023/04/06/MPI/image-20230406201727561.png">
<meta property="og:image" content="http://example.com/2023/04/06/MPI/image-20230406202312516.png">
<meta property="og:image" content="http://example.com/2023/04/06/MPI/image-20230406203808578.png">
<meta property="og:image" content="http://example.com/2023/04/06/MPI/image-20230406204451384.png">
<meta property="og:image" content="http://example.com/2023/04/06/MPI/image-20230407102050741.png">
<meta property="og:image" content="http://example.com/2023/04/06/MPI/image-20230407103300194.png">
<meta property="og:image" content="http://example.com/2023/04/06/MPI/image-20230407105421091.png">
<meta property="og:image" content="http://example.com/2023/04/06/MPI/image-20230407145700539.png">
<meta property="og:image" content="http://example.com/2023/04/06/MPI/image-20230407150118235.png">
<meta property="og:image" content="http://example.com/2023/04/06/MPI/image-20230407151502131.png">
<meta property="og:image" content="http://example.com/2023/04/06/MPI/image-20230407152146975.png">
<meta property="article:published_time" content="2023-04-06T12:41:56.000Z">
<meta property="article:modified_time" content="2023-05-25T12:56:41.691Z">
<meta property="article:author" content="John Doe">
<meta property="article:tag" content="è¿›ç¨‹">
<meta property="article:tag" content="é€šè®¯">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/2023/04/06/MPI/image-20230406190258065.png">
    
    
    <!--- Icon Part-->
    <link rel="icon" type="image/png" href="/images/%E9%B1%BC.svg" sizes="192x192">
    <link rel="apple-touch-icon" sizes="180x180" href="/images/%E9%B1%BC.svg">
    <meta name="theme-color" content="#A31F34">
    <link rel="shortcut icon" href="/images/%E9%B1%BC.svg">
    <!--- Page Info-->
    
    <title>
        
            MPI -
        
        Airex-Daily
    </title>
    
<link rel="stylesheet" href="/css/style.css">

    
<link rel="stylesheet" href="/assets/fonts.css">

    <!--- Font Part-->
    
    
    
        <link href="" rel="stylesheet">
    
    
        <link href="" rel="stylesheet">
    

    <!--- Inject Part-->
    
    <script id="hexo-configurations">
    let Global = window.Global || {};
    Global.hexo_config = {"hostname":"example.com","root":"/","language":"zh-CN"};
    Global.theme_config = {"articles":{"style":{"font_size":"16px","line_height":1.5,"image_border_radius":"14px","image_alignment":"center","image_caption":false,"link_icon":true},"word_count":{"enable":true,"count":true,"min2read":true},"author_label":{"enable":true,"auto":false,"list":[]},"code_block":{"copy":true,"style":"mac","font":{"enable":false,"family":null,"url":null}},"toc":{"enable":true,"max_depth":3,"number":false,"expand":true,"init_open":true},"copyright":true,"lazyload":true,"recommendation":{"enable":false,"title":"æ¨èé˜…è¯»","limit":3,"placeholder":"/images/wallhaven-wqery6-light.webp","skip_dirs":[]}},"colors":{"primary":"#A31F34","secondary":null},"global":{"fonts":{"chinese":{"enable":true,"family":null,"url":null},"english":{"enable":true,"family":null,"url":null}},"content_max_width":"1000px","sidebar_width":"210px","hover":{"shadow":true,"scale":false},"scroll_progress":{"bar":false,"percentage":true},"busuanzi_counter":{"enable":true,"site_pv":true,"site_uv":true,"post_pv":true},"pjax":true,"open_graph":true,"google_analytics":{"enable":false,"id":null}},"home_banner":{"enable":true,"style":"fix","image":{"light":"/images/wallhaven-wqery6-light.webp","dark":"/images/wallhaven-rry6gw.png"},"title":"ä¼¸æ‰‹ä¹Ÿæ¡ä¸ä½å½©è™¹ğŸŒˆ","subtitle":{"text":["â€”â€”æˆ‘æœŸå¾…"],"hitokoto":{"enable":true,"api":"https://v1.hitokoto.cn"},"typing_speed":100,"backing_speed":80,"starting_delay":500,"backing_delay":1500,"loop":true,"smart_backspace":true},"text_color":{"light":"#fff","dark":"#d1d1b6"},"text_style":{"title_size":"2.8rem","subtitle_size":"1.5rem","line_height":1.2},"custom_font":{"enable":false,"family":null,"url":null},"social_links":{"enable":true,"links":{"github":"https://github.com/Airex-ai","instagram":null,"zhihu":null,"twitter":null,"email":"airex.yu@foxmail.com"}}},"plugins":{"feed":{"enable":false},"aplayer":{"enable":false,"type":"fixed","audios":[{"name":null,"artist":null,"url":"https://music.163.com/song?id=1501530173&userid=253099352","cover":null}]},"mermaid":{"enable":true,"version":"9.3.0"}},"version":"2.1.5","navbar":{"auto_hide":true,"color":{"left":"#f78736","right":"#367df7","transparency":35},"links":{"Home":{"path":"/","icon":"fa-regular fa-house"},"Archives":{"path":"/archives","icon":"fa-regular fa-archive"},"About":{"icon":"fa-regular fa-user","submenus":{"Github":"https://github.com/Airex-ai?tab=repositories"}},"éšè®°":{"icon":"fa-solid fa-tree-palm","path":"/masonry/"}},"search":{"enable":true,"preload":true}},"page_templates":{"friends_column":2,"tags_style":"blur"},"home":{"sidebar":{"enable":true,"position":"left","first_item":"menu","announcement":null,"links":{"Archives":{"path":"/archives","icon":"fa-regular fa-archive"},"Tags":{"path":"/tags","icon":"fa-regular fa-tags"},"Categories":{"path":"/categories","icon":"fa-regular fa-folder"}}},"article_date_format":"auto","categories":{"enable":true,"limit":3},"tags":{"enable":true,"limit":3}}};
    Global.language_ago = {"second":"%s ç§’å‰","minute":"%s åˆ†é’Ÿå‰","hour":"%s å°æ—¶å‰","day":"%s å¤©å‰","week":"%s å‘¨å‰","month":"%s ä¸ªæœˆå‰","year":"%s å¹´å‰"};
    Global.data_config = {"masonry":false};
  </script>
    
    <!--- Fontawesome Part-->
    
<link rel="stylesheet" href="/fontawesome/fontawesome.min.css">

    
<link rel="stylesheet" href="/fontawesome/brands.min.css">

    
<link rel="stylesheet" href="/fontawesome/solid.min.css">

    
<link rel="stylesheet" href="/fontawesome/regular.min.css">

    
    
    
    
<meta name="generator" content="Hexo 6.3.0"></head>


<body>
<div class="progress-bar-container">
    

    
        <span class="pjax-progress-bar"></span>
        <span class="pjax-progress-icon">
            <i class="fa-solid fa-circle-notch fa-spin"></i>
        </span>
    
</div>


<main class="page-container">

    

    <div class="main-content-container">

        <div class="main-content-header">
            <header class="navbar-container">
    
    <div class="navbar-content">
        <div class="left">
            
            <a class="logo-title" href="/">
                
                Airex-Daily
                
            </a>
        </div>

        <div class="right">
            <!-- PC -->
            <div class="desktop">
                <ul class="navbar-list">
                    
                        
                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class="" 
                                    href="/"  >
                                    
                                        
                                            <i class="fa-regular fa-house"></i>
                                        
                                        é¦–é¡µ
                                    
                                </a>
                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class="" 
                                    href="/archives"  >
                                    
                                        
                                            <i class="fa-regular fa-archive"></i>
                                        
                                        å½’æ¡£
                                    
                                </a>
                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class="has-dropdown" 
                                    href="#" onClick="return false;">
                                    
                                        
                                            <i class="fa-regular fa-user"></i>
                                        
                                        å…³äº&nbsp;<i class="fa-solid fa-chevron-down"></i>
                                    
                                </a>
                                <!-- Submenu -->
                                
                                    <ul class="sub-menu">
                                    
                                        <li>
                                        <a target="_blank" rel="noopener" href="https://github.com/Airex-ai?tab=repositories">GITHUB
                                        </a>
                                        </li>
                                    
                                    </ul>
                                
                            </li>
                    
                        
                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class="" 
                                    href="/masonry/"  >
                                    
                                        
                                            <i class="fa-solid fa-tree-palm"></i>
                                        
                                        éšè®°
                                    
                                </a>
                                <!-- Submenu -->
                                
                            </li>
                    
                    
                        <li class="navbar-item search search-popup-trigger">
                            <i class="fa-solid fa-magnifying-glass"></i>
                        </li>
                    
                </ul>
            </div>
            <!-- Mobile -->
            <div class="mobile">
                
                    <div class="icon-item search search-popup-trigger"><i class="fa-solid fa-magnifying-glass"></i></div>
                
                <div class="icon-item navbar-bar">
                    <div class="navbar-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile drawer -->
    <div class="navbar-drawer">
        <ul class="drawer-navbar-list">
            
                
                    <li class="drawer-navbar-item flex-center">
                        <a class="" 
                        href="/"  >
                             
                                
                                    <i class="fa-regular fa-house"></i>
                                
                                é¦–é¡µ
                            
                        </a>
                    </li>
                    <!-- Submenu -->
                    
            
                
                    <li class="drawer-navbar-item flex-center">
                        <a class="" 
                        href="/archives"  >
                             
                                
                                    <i class="fa-regular fa-archive"></i>
                                
                                å½’æ¡£
                            
                        </a>
                    </li>
                    <!-- Submenu -->
                    
            
                
                    <li class="drawer-navbar-item flex-center">
                        <a class="has-dropdown" 
                        href="#" onClick="return false;">
                            
                                
                                    <i class="fa-regular fa-user"></i>
                                
                                å…³äº&nbsp;<i class="fa-solid fa-chevron-down"></i>
                            
                        </a>
                    </li>
                    <!-- Submenu -->
                              
                        
                            <li class="dropdown-item flex-center">
                                <a class="dropdown-item" target="_blank" rel="noopener" href="https://github.com/Airex-ai?tab=repositories">GITHUB</a>
                            </li>
                        
                    
            
                
                    <li class="drawer-navbar-item flex-center">
                        <a class="" 
                        href="/masonry/"  >
                             
                                
                                    <i class="fa-solid fa-tree-palm"></i>
                                
                                éšè®°
                            
                        </a>
                    </li>
                    <!-- Submenu -->
                    
            

        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="main-content-body">

            

            <div class="main-content">

                
                    <div class="fade-in-down-animation">
    <div class="post-page-container">
        <div class="article-content-container">

            
             
                <div class="article-title">         
                    <img src="/images/mpi.png" alt="MPI" />
                    <h1 class="article-title-cover">MPI</h1>
                </div>
            
                
            

            
                <div class="article-header">
                    <div class="avatar">
                        <img src="/images/%E5%A4%B4%E5%83%8F.JPG">
                    </div>
                    <div class="info">
                        <div class="author">
                            <span class="name">Airex Yu</span>
                            
                                <span class="author-label">Lv3</span>
                            
                        </div>
                        <div class="meta-info">
                            <div class="article-meta-info">
    <span class="article-date article-meta-item">
        <i class="fa-regular fa-pen-fancy"></i>&nbsp;
        <span class="desktop">2023-04-06 20:41:56</span>
        <span class="mobile">2023-04-06 20:41</span>
        <span class="hover-info">åˆ›å»º</span>
    </span>
    
        <span class="article-date article-meta-item">
            <i class="fa-regular fa-wrench"></i>&nbsp;
            <span class="desktop">2023-05-25 20:56:41</span>
            <span class="mobile">2023-05-25 20:56</span>
            <span class="hover-info">æ›´æ–°</span>
        </span>
    

    
        <span class="article-categories article-meta-item">
            <i class="fa-regular fa-folders"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/categories/MPI/">MPI</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    
    
        <span class="article-tags article-meta-item">
            <i class="fa-regular fa-tags"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/tags/%E8%BF%9B%E7%A8%8B/">è¿›ç¨‹</a>&nbsp;
                    </li>
                
                    <li>
                        | <a href="/tags/%E9%80%9A%E8%AE%AF/">é€šè®¯</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    

    
    
    
    
        <span class="article-pv article-meta-item">
            <i class="fa-regular fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>
        </span>
    
</div>

                        </div>
                    </div>
                </div>
            

            <div class="article-content markdown-body">
                <h1 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h1><h2 id="MPI-çš„å†å²ç®€ä»‹"><a href="#MPI-çš„å†å²ç®€ä»‹" class="headerlink" title="MPI çš„å†å²ç®€ä»‹"></a>MPI çš„å†å²ç®€ä»‹</h2><p>åˆ†å¸ƒå¼è®¡ç®—ç°åœ¨å¯¹äºæˆ‘ä»¬æ¥è¯´ï¼Œå°±è·Ÿæ—¥å¸¸ç”Ÿæ´»é‡Œçš„æ‰‹æœºå’Œç”µè„‘ä¸€æ ·æ™®åŠã€‚ä½ å¾ˆæ˜æ˜¾åº”è¯¥è®¤åŒè¿™ä¸ªè§‚ç‚¹ï¼Œå› ä¸ºä½ å‘ç°äº†è¿™ä¸ªäº†ä¸èµ·çš„ MPI æ•™ç¨‹ç½‘ç«™ï¼ä¸ç®¡ä½ æ˜¯å‡ºäºä»€ä¹ˆåŸå› æƒ³å­¦ä¹ å¹¶è¡Œç¼–ç¨‹ï¼ˆparallel programmingï¼‰ï¼Œæˆ–è€…è¯´åˆ†å¸ƒå¼ç¼–ç¨‹ã€å¹¶è¡Œç¼–ç¨‹ï¼Œä¹Ÿè®¸æ˜¯å› ä¸ºè¯¾ç¨‹éœ€è¦ï¼Œæˆ–è€…æ˜¯å·¥ä½œï¼Œæˆ–è€…å•çº¯åœ°è§‰å¾—å¥½ç©ï¼Œæˆ‘è§‰å¾—ä½ éƒ½åº”è¯¥é€‰æ‹©ä¸€é¡¹åœ¨æœªæ¥å‡ å¹´ä¾ç„¶ååˆ†æœ‰ä»·å€¼çš„æŠ€æœ¯å»å­¦ä¹ ã€‚æˆ‘è§‰å¾—ã€Œ<strong>æ¶ˆæ¯ä¼ é€’æ¥å£</strong>ã€ï¼ˆMessage Passing Interface, MPIï¼‰å°±æ˜¯è¿™æ ·ä¸€é¡¹æŠ€æœ¯ï¼Œè€Œä¸”å­¦ä¹ å®ƒç¡®å®å¯ä»¥è®©ä½ çš„å¹¶è¡Œç¼–ç¨‹çŸ¥è¯†å˜å¾—æ›´æ·±åšã€‚å°½ç®¡ <strong>MPI æ¯”å¤§å¤šæ•°å¹¶è¡Œæ¡†æ¶è¦æ›´åº•å±‚</strong>ï¼ˆæ¯”å¦‚ Hadoopï¼‰ï¼Œä½†æ˜¯å­¦ä¹  MPI ä¼šä¸ºä½ çš„å¹¶è¡Œç¼–ç¨‹æ‰“ä¸‹è‰¯å¥½çš„åŸºç¡€ã€‚</p>
<p>åœ¨ 90 å¹´ä»£ä¹‹å‰ï¼Œç¨‹åºå‘˜å¯æ²¡æˆ‘ä»¬è¿™ä¹ˆå¹¸è¿ã€‚å¯¹äºä¸åŒçš„è®¡ç®—æ¶æ„å†™å¹¶å‘ç¨‹åºæ˜¯ä¸€ä»¶å›°éš¾è€Œä¸”å†—é•¿çš„äº‹æƒ…ã€‚å½“æ—¶ï¼Œå¾ˆå¤šè½¯ä»¶åº“å¯ä»¥å¸®åŠ©å†™å¹¶å‘ç¨‹åºï¼Œä½†æ˜¯æ²¡æœ‰ä¸€ä¸ªå¤§å®¶éƒ½æ¥å—çš„æ ‡å‡†æ¥åšè¿™ä¸ªäº‹æƒ…ã€‚</p>
<p>åœ¨å½“æ—¶ï¼Œå¤§å¤šæ•°çš„å¹¶å‘ç¨‹åºåªå‡ºç°åœ¨ç§‘å­¦å’Œç ”ç©¶çš„é¢†åŸŸã€‚æœ€å¹¿ä¸ºæ¥å—çš„æ¨¡å‹å°±æ˜¯<strong>æ¶ˆæ¯ä¼ é€’æ¨¡å‹</strong>ã€‚ä»€ä¹ˆæ˜¯æ¶ˆæ¯ä¼ é€’æ¨¡å‹ï¼Ÿå®ƒå…¶å®åªæ˜¯æŒ‡ç¨‹åºé€šè¿‡åœ¨è¿›ç¨‹é—´ä¼ é€’æ¶ˆæ¯ï¼ˆæ¶ˆæ¯å¯ä»¥ç†è§£æˆå¸¦æœ‰ä¸€äº›ä¿¡æ¯å’Œæ•°æ®çš„ä¸€ä¸ªæ•°æ®ç»“æ„ï¼‰æ¥å®ŒæˆæŸäº›ä»»åŠ¡ã€‚åœ¨å®è·µä¸­ï¼Œå¹¶å‘ç¨‹åºç”¨è¿™ä¸ªæ¨¡å‹å»å®ç°ç‰¹åˆ«å®¹æ˜“ã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œä¸»è¿›ç¨‹ï¼ˆmanager processï¼‰å¯ä»¥é€šè¿‡å¯¹ä»è¿›ç¨‹ï¼ˆworker processï¼‰å‘é€ä¸€ä¸ªæè¿°å·¥ä½œçš„æ¶ˆæ¯æ¥æŠŠè¿™ä¸ªå·¥ä½œåˆ†é…ç»™å®ƒã€‚å¦ä¸€ä¸ªä¾‹å­å°±æ˜¯ä¸€ä¸ªå¹¶å‘çš„æ’åºç¨‹åºå¯ä»¥åœ¨å½“å‰è¿›ç¨‹ä¸­å¯¹å½“å‰è¿›ç¨‹å¯è§çš„ï¼ˆæˆ‘ä»¬ç§°ä½œæœ¬åœ°çš„ï¼Œlocallyï¼‰æ•°æ®è¿›è¡Œæ’åºï¼Œç„¶åæŠŠæ’å¥½åºçš„æ•°æ®å‘é€çš„é‚»å±…è¿›ç¨‹ä¸Šé¢æ¥è¿›è¡Œåˆå¹¶çš„æ“ä½œã€‚å‡ ä¹æ‰€æœ‰çš„å¹¶è¡Œç¨‹åºå¯ä»¥ä½¿ç”¨æ¶ˆæ¯ä¼ é€’æ¨¡å‹æ¥æè¿°ã€‚</p>
<p>ç”±äºå½“æ—¶<strong>å¾ˆå¤šè½¯ä»¶åº“éƒ½ç”¨åˆ°äº†è¿™ä¸ªæ¶ˆæ¯ä¼ é€’æ¨¡å‹ï¼Œä½†æ˜¯åœ¨å®šä¹‰ä¸Šæœ‰äº›å¾®å°çš„å·®å¼‚</strong>ï¼Œè¿™äº›åº“çš„ä½œè€…ä»¥åŠä¸€äº›å…¶ä»–äººä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜å°±åœ¨ Supercomputing 1992 å¤§ä¼šä¸Šå®šä¹‰äº†ä¸€ä¸ªæ¶ˆæ¯ä¼ é€’æ¥å£çš„æ ‡å‡†- ä¹Ÿå°±æ˜¯ MPIã€‚è¿™ä¸ªæ ‡å‡†æ¥å£ä½¿å¾—ç¨‹åºå‘˜å†™çš„å¹¶å‘ç¨‹åºå¯ä»¥åœ¨æ‰€æœ‰ä¸»æµçš„å¹¶å‘æ¡†æ¶ä¸­è¿è¡Œã€‚å¹¶ä¸”å…è®¸ä»–ä»¬å¯ä»¥ä½¿ç”¨å½“æ—¶å·²ç»åœ¨ä½¿ç”¨çš„ä¸€äº›æµè¡Œåº“çš„ç‰¹æ€§å’Œæ¨¡å‹ã€‚</p>
<h2 id="MPI-å¯¹äºæ¶ˆæ¯ä¼ é€’æ¨¡å‹çš„è®¾è®¡"><a href="#MPI-å¯¹äºæ¶ˆæ¯ä¼ é€’æ¨¡å‹çš„è®¾è®¡" class="headerlink" title="MPI å¯¹äºæ¶ˆæ¯ä¼ é€’æ¨¡å‹çš„è®¾è®¡"></a>MPI å¯¹äºæ¶ˆæ¯ä¼ é€’æ¨¡å‹çš„è®¾è®¡</h2><p>å…ˆè§£é‡Šä¸€ä¸‹ MPI åœ¨æ¶ˆæ¯ä¼ é€’æ¨¡å‹è®¾è®¡ä¸Šçš„ä¸€äº›ç»å…¸æ¦‚å¿µã€‚ç¬¬ä¸€ä¸ªæ¦‚å¿µæ˜¯<em><strong>é€šè®¯å™¨</strong></em>ï¼ˆcommunicatorï¼‰ã€‚é€šè®¯å™¨å®šä¹‰äº†ä¸€ç»„èƒ½å¤Ÿäº’ç›¸å‘æ¶ˆæ¯çš„è¿›ç¨‹ã€‚åœ¨è¿™ç»„è¿›ç¨‹ä¸­ï¼Œæ¯ä¸ªè¿›ç¨‹ä¼šè¢«åˆ†é…ä¸€ä¸ªåºå·ï¼Œç§°ä½œ<em>ç§©</em>ï¼ˆrankï¼‰ï¼Œè¿›ç¨‹é—´æ˜¾æ€§åœ°é€šè¿‡æŒ‡å®šç§©æ¥è¿›è¡Œé€šä¿¡ã€‚</p>
<p>é€šä¿¡çš„åŸºç¡€å»ºç«‹åœ¨ä¸åŒè¿›ç¨‹é—´å‘é€å’Œæ¥æ”¶æ“ä½œã€‚ä¸€ä¸ªè¿›ç¨‹å¯ä»¥é€šè¿‡æŒ‡å®šå¦ä¸€ä¸ªè¿›ç¨‹çš„ç§©ä»¥åŠä¸€ä¸ªç‹¬ä¸€æ— äºŒçš„æ¶ˆæ¯<em>æ ‡ç­¾</em>ï¼ˆ<em>tag</em>ï¼‰æ¥å‘é€æ¶ˆæ¯ç»™å¦ä¸€ä¸ªè¿›ç¨‹ã€‚æ¥å—è€…å¯ä»¥å‘é€ä¸€ä¸ªæ¥æ”¶ç‰¹å®šæ ‡ç­¾æ ‡è®°çš„æ¶ˆæ¯çš„è¯·æ±‚ï¼ˆæˆ–è€…ä¹Ÿå¯ä»¥å®Œå…¨ä¸ç®¡æ ‡ç­¾ï¼Œæ¥æ”¶ä»»ä½•æ¶ˆæ¯ï¼‰ï¼Œç„¶åä¾æ¬¡å¤„ç†æ¥æ”¶åˆ°çš„æ•°æ®ã€‚ç±»ä¼¼è¿™æ ·çš„æ¶‰åŠä¸€ä¸ªå‘é€è€…ä»¥åŠä¸€ä¸ªæ¥å—è€…çš„é€šä¿¡è¢«ç§°ä½œ<strong><em>ç‚¹å¯¹ç‚¹</em>ï¼ˆpoint-to-pointï¼‰é€šä¿¡</strong>ã€‚</p>
<p>å½“ç„¶åœ¨å¾ˆå¤šæƒ…å†µä¸‹ï¼ŒæŸä¸ªè¿›ç¨‹å¯èƒ½éœ€è¦è·Ÿæ‰€æœ‰å…¶ä»–è¿›ç¨‹é€šä¿¡ã€‚æ¯”å¦‚ä¸»è¿›ç¨‹æƒ³å‘ä¸€ä¸ªå¹¿æ’­ç»™æ‰€æœ‰çš„ä»è¿›ç¨‹ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‰‹åŠ¨å»å†™ä¸€ä¸ªä¸ªè¿›ç¨‹ç‚¹å¯¹ç‚¹çš„ä¿¡æ¯ä¼ é€’å°±æ˜¾å¾—å¾ˆç¬¨æ‹™ã€‚è€Œä¸”äº‹å®ä¸Šè¿™æ ·ä¼šå¯¼è‡´ç½‘ç»œåˆ©ç”¨ç‡ä½ä¸‹ã€‚MPI æœ‰ä¸“é—¨çš„æ¥å£æ¥å¸®æˆ‘ä»¬å¤„ç†è¿™ç±»æ‰€æœ‰è¿›ç¨‹é—´çš„<strong><em>é›†ä½“æ€§</em>ï¼ˆcollectiveï¼‰é€šä¿¡ã€‚</strong></p>
<p>æŠŠ<strong>ç‚¹å¯¹ç‚¹é€šä¿¡</strong>å’Œ<strong>é›†ä½“æ€§é€šä¿¡</strong>è¿™ä¸¤ä¸ªæœºåˆ¶åˆåœ¨ä¸€èµ·å·²ç»å¯ä»¥åˆ›é€ ååˆ†å¤æ‚çš„å¹¶å‘ç¨‹åºäº†ã€‚äº‹å®ä¸Šï¼Œè¿™ä¸¤ä¸ªåŠŸèƒ½å·²ç»å¼ºå¤§åˆ°æˆ‘ç°åœ¨ä¸éœ€è¦å†ä»‹ç»ä»»ä½• MPI é«˜çº§çš„ç‰¹æ€§äº†</p>
<h1 id="MPI-Hello-World"><a href="#MPI-Hello-World" class="headerlink" title="MPI Hello World"></a>MPI Hello World</h1><h2 id="Hello-world-ä»£ç æ¡ˆä¾‹"><a href="#Hello-world-ä»£ç æ¡ˆä¾‹" class="headerlink" title="Hello world ä»£ç æ¡ˆä¾‹"></a>Hello world ä»£ç æ¡ˆä¾‹</h2><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;mpi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>** argv)</span> &#123;</span><br><span class="line">    <span class="comment">// åˆå§‹åŒ– MPI ç¯å¢ƒ</span></span><br><span class="line">    MPI_Init(<span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é€šè¿‡è°ƒç”¨ä»¥ä¸‹æ–¹æ³•æ¥å¾—åˆ°æ‰€æœ‰å¯ä»¥å·¥ä½œçš„è¿›ç¨‹æ•°é‡</span></span><br><span class="line">    <span class="type">int</span> world_size;</span><br><span class="line">    MPI_Comm_size(MPI_COMM_WORLD, &amp;world_size);		<span class="comment">//MPI_Comm_sizeå‡½æ•°è¿”å›è¿›ç¨‹æ•°é‡åˆ°world_sizeã€‚MPI_WORLDæ˜¯MPIè‡ªåŠ¨ç”Ÿæˆçš„é€šè®¯å™¨</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¾—åˆ°å½“å‰è¿›ç¨‹çš„ç§©</span></span><br><span class="line">    <span class="type">int</span> world_rank;</span><br><span class="line">    MPI_Comm_rank(MPI_COMM_WORLD, &amp;world_rank);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¾—åˆ°å½“å‰è¿›ç¨‹çš„åå­—</span></span><br><span class="line">    <span class="type">char</span> processor_name[MPI_MAX_PROCESSOR_NAME];</span><br><span class="line">    <span class="type">int</span> name_len;</span><br><span class="line">    MPI_Get_processor_name(processor_name, &amp;name_len);	<span class="comment">//MPI_GET_processor_nameè¿”å›å½“å‰è¿›ç¨‹çš„åå­—</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ‰“å°ä¸€æ¡å¸¦æœ‰å½“å‰è¿›ç¨‹åå­—ï¼Œç§©ä»¥åŠ</span></span><br><span class="line">    <span class="comment">// æ•´ä¸ª communicator çš„å¤§å°çš„ hello world æ¶ˆæ¯ã€‚</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Hello world from processor %s, rank %d out of %d processors\n&quot;</span>,</span><br><span class="line">           processor_name, world_rank, world_size);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é‡Šæ”¾ MPI çš„ä¸€äº›èµ„æº</span></span><br><span class="line">    MPI_Finalize();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h2 id="è¿è¡Œ-MPI-hello-world-ç¨‹åº"><a href="#è¿è¡Œ-MPI-hello-world-ç¨‹åº" class="headerlink" title="è¿è¡Œ MPI hello world ç¨‹åº"></a>è¿è¡Œ MPI hello world ç¨‹åº</h2><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; git clone https://github.com/mpitutorial/mpitutorial</span><br><span class="line">&gt;&gt;&gt; cd mpitutorial/tutorials/mpi-hello-world/code</span><br><span class="line">&gt;&gt;&gt; cat makefile</span><br><span class="line">EXECS=mpi_hello_world</span><br><span class="line">MPICC?=mpicc</span><br><span class="line"></span><br><span class="line">all: $&#123;EXECS&#125;</span><br><span class="line"></span><br><span class="line">mpi_hello_world: mpi_hello_world.c</span><br><span class="line">    $&#123;MPICC&#125; -o mpi_hello_world mpi_hello_world.c</span><br><span class="line"></span><br><span class="line">clean:</span><br><span class="line">    rm $&#123;EXECS&#125;</span><br></pre></td></tr></table></figure></div>

<p>makefile ä¼šå»æ‰¾ MPICC è¿™ä¸ªç¯å¢ƒå˜é‡ã€‚å¦‚æœä½ æŠŠ MPICH2 è£…åœ¨äº†æœ¬åœ°æ–‡ä»¶å¤¹é‡Œé¢è€Œä¸æ˜¯å…¨å±€ PATH ä¸‹é¢, æ‰‹åŠ¨è®¾ç½®ä¸€ä¸‹ MPICC è¿™ä¸ªç¯å¢ƒå˜é‡ï¼ŒæŠŠå®ƒæŒ‡å‘ä½ çš„ mpicc äºŒè¿›åˆ¶ç¨‹åºã€‚mpicc äºŒè¿›åˆ¶ç¨‹åºå…¶å®åªæ˜¯å¯¹ gcc åšäº†ä¸€å±‚å°è£…ï¼Œä½¿å¾—ç¼–è¯‘å’Œé“¾æ¥æ‰€æœ‰çš„ MPI ç¨‹åºæ›´æ–¹ä¾¿ã€‚</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; export MPICC=/home/kendall/bin/mpicc</span><br><span class="line">&gt;&gt;&gt; make</span><br><span class="line">/home/kendall/bin/mpicc -o mpi_hello_world mpi_hello_world.c</span><br></pre></td></tr></table></figure></div>

<p>å½“ç¨‹åºç¼–è¯‘å¥½ä¹‹åï¼Œå®ƒå°±å¯ä»¥è¢«æ‰§è¡Œäº†ã€‚</p>
<h1 id="MPI-Send-and-Receive"><a href="#MPI-Send-and-Receive" class="headerlink" title="MPI Send and Receive"></a>MPI Send and Receive</h1><p>å‘é€å’Œæ¥æ”¶æ˜¯ MPI é‡Œé¢ä¸¤ä¸ªåŸºç¡€çš„æ¦‚å¿µã€‚MPI é‡Œé¢å‡ ä¹æ‰€æœ‰å•ä¸ªçš„æ–¹æ³•éƒ½å¯ä»¥ä½¿ç”¨åŸºç¡€çš„å‘é€å’Œæ¥æ”¶ API æ¥å®ç°ã€‚</p>
<h2 id="MPI-çš„å‘é€å’Œæ¥æ”¶ç®€ä»‹"><a href="#MPI-çš„å‘é€å’Œæ¥æ”¶ç®€ä»‹" class="headerlink" title="MPI çš„å‘é€å’Œæ¥æ”¶ç®€ä»‹"></a>MPI çš„å‘é€å’Œæ¥æ”¶ç®€ä»‹</h2><p>MPI çš„å‘é€å’Œæ¥æ”¶æ–¹æ³•æ˜¯æŒ‰ä»¥ä¸‹æ–¹å¼è¿›è¡Œçš„ï¼šå¼€å§‹çš„æ—¶å€™ï¼Œ<em>A</em> è¿›ç¨‹å†³å®šè¦å‘é€ä¸€äº›æ¶ˆæ¯ç»™ <em>B</em> è¿›ç¨‹ã€‚Aè¿›ç¨‹å°±ä¼šæŠŠéœ€è¦å‘é€ç»™Bè¿›ç¨‹çš„æ‰€æœ‰æ•°æ®æ‰“åŒ…å¥½ï¼Œæ”¾åˆ°ä¸€ä¸ªç¼“å­˜é‡Œé¢ã€‚å› ä¸ºæ‰€æœ‰æ•°æ®ä¼šè¢«æ‰“åŒ…åˆ°ä¸€ä¸ªå¤§çš„ä¿¡æ¯é‡Œé¢ï¼Œå› æ­¤ç¼“å­˜å¸¸å¸¸ä¼šè¢«æ¯”ä½œ<em>ä¿¡å°</em>ï¼ˆå°±åƒæˆ‘ä»¬æŠŠå¥½å¤šä¿¡çº¸æ‰“åŒ…åˆ°ä¸€ä¸ªä¿¡å°é‡Œé¢ç„¶åå†å¯„å»é‚®å±€ï¼‰ã€‚æ•°æ®æ‰“åŒ…è¿›ç¼“å­˜ä¹‹åï¼Œé€šä¿¡è®¾å¤‡ï¼ˆé€šå¸¸æ˜¯ç½‘ç»œï¼‰å°±éœ€è¦è´Ÿè´£æŠŠä¿¡æ¯ä¼ é€’åˆ°æ­£ç¡®çš„åœ°æ–¹ã€‚<strong>è¿™ä¸ªæ­£ç¡®çš„åœ°æ–¹ä¹Ÿå°±æ˜¯æ ¹æ®ç‰¹å®šç§©ç¡®å®šçš„é‚£ä¸ªè¿›ç¨‹ã€‚</strong><code>ç§©ç¡®å®šä¼ é€å¯¹è±¡</code></p>
<p>å°½ç®¡æ•°æ®å·²ç»è¢«é€è¾¾åˆ° B äº†ï¼Œä½†æ˜¯è¿›ç¨‹ B ä¾ç„¶éœ€è¦ç¡®è®¤å®ƒæƒ³è¦æ¥æ”¶ A çš„æ•°æ®ã€‚ä¸€æ—¦å®ƒç¡®å®šäº†è¿™ç‚¹ï¼Œæ•°æ®å°±è¢«ä¼ è¾“æˆåŠŸäº†ã€‚è¿›ç¨‹ A ä¼šæ¥æ”¶åˆ°æ•°æ®ä¼ é€’æˆåŠŸçš„ä¿¡æ¯ï¼Œç„¶åå»å¹²å…¶ä»–äº‹æƒ…ã€‚</p>
<p>æœ‰æ—¶å€™ A éœ€è¦ä¼ é€’å¾ˆå¤šä¸åŒçš„æ¶ˆæ¯ç»™ Bã€‚ä¸ºäº†è®© B èƒ½æ¯”è¾ƒæ–¹ä¾¿åœ°åŒºåˆ†ä¸åŒçš„æ¶ˆæ¯ï¼ŒMPI è¿è¡Œå‘é€è€…å’Œæ¥å—è€…é¢å¤–åœ°æŒ‡å®šä¸€äº›ä¿¡æ¯ ID (æ­£å¼åç§°æ˜¯<em>æ ‡ç­¾</em>, <em>tags</em>)ã€‚å½“ B åªè¦æ±‚æ¥æ”¶æŸç§ç‰¹å®šæ ‡ç­¾çš„ä¿¡æ¯çš„æ—¶å€™ï¼Œå…¶ä»–çš„ä¸æ˜¯è¿™ä¸ªæ ‡ç­¾çš„ä¿¡æ¯ä¼šå…ˆè¢«ç¼“å­˜èµ·æ¥ï¼Œç­‰åˆ° B éœ€è¦çš„æ—¶å€™æ‰ä¼šç»™ Bã€‚<code>tagç¡®å®šä¼ é€æ–‡ä»¶</code></p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">MPI_Send(</span><br><span class="line">    void* data,								<span class="comment">#æ•°æ®ç¼“å­˜</span></span><br><span class="line">    <span class="built_in">int</span> count,								<span class="comment">#æ•°æ®é‡</span></span><br><span class="line">    MPI_Datatype datatype,					<span class="comment">#ç±»å‹</span></span><br><span class="line">    <span class="built_in">int</span> destination,						<span class="comment">#ç§©</span></span><br><span class="line">    <span class="built_in">int</span> tag,								<span class="comment">#æ ‡ç­¾</span></span><br><span class="line">    MPI_Comm communicator)					<span class="comment">#é€šè®¯å™¨</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">MPI_Recv(</span><br><span class="line">    void* data,</span><br><span class="line">    <span class="built_in">int</span> count,</span><br><span class="line">    MPI_Datatype datatype,</span><br><span class="line">    <span class="built_in">int</span> source,								<span class="comment">#ç§©</span></span><br><span class="line">    <span class="built_in">int</span> tag,</span><br><span class="line">    MPI_Comm communicator,</span><br><span class="line">    MPI_Status* status)</span><br></pre></td></tr></table></figure></div>

<h2 id="åŸºç¡€-MPI-æ•°æ®ç»“æ„"><a href="#åŸºç¡€-MPI-æ•°æ®ç»“æ„" class="headerlink" title="åŸºç¡€ MPI æ•°æ®ç»“æ„"></a>åŸºç¡€ MPI æ•°æ®ç»“æ„</h2><p><code>MPI_send</code> å’Œ <code>MPI_Recv</code> æ–¹æ³•ä½¿ç”¨äº† MPI çš„æ•°æ®ç»“æ„ä½œä¸ºä¸€ç§åœ¨æ›´é«˜å±‚æ¬¡æŒ‡å®šæ¶ˆæ¯ç»“æ„çš„æ–¹æ³•ï¼ˆ<strong>é‡æ–°å®šä¹‰äº†å‘é€æ¶ˆæ¯çš„æ•°æ®ç»“æ„</strong>ï¼‰ã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œå¦‚æœä¸€ä¸ªè¿›ç¨‹æƒ³è¦å‘é€ä¸€ä¸ªæ•´æ•°ç»™å¦ä¸€ä¸ªè¿›ç¨‹ï¼Œå®ƒä¼šæŒ‡å®š count ä¸º 1ï¼Œæ•°æ®ç»“æ„ä¸º <code>MPI_INT</code>ã€‚å…¶ä»–çš„ MPI æ•°æ®ç»“æ„ä»¥åŠå®ƒä»¬åœ¨ C è¯­è¨€é‡Œå¯¹åº”çš„ç»“æ„å¦‚ä¸‹ï¼š</p>
<table>
<thead>
<tr>
<th>MPI datatype</th>
<th>C equivalent</th>
</tr>
</thead>
<tbody><tr>
<td>MPI_SHORT</td>
<td>short int</td>
</tr>
<tr>
<td>MPI_INT</td>
<td>int</td>
</tr>
<tr>
<td>MPI_LONG</td>
<td>long int</td>
</tr>
<tr>
<td>MPI_LONG_LONG</td>
<td>long long int</td>
</tr>
<tr>
<td>MPI_UNSIGNED_CHAR</td>
<td>unsigned char</td>
</tr>
<tr>
<td>MPI_UNSIGNED_SHORT</td>
<td>unsigned short int</td>
</tr>
<tr>
<td>MPI_UNSIGNED</td>
<td>unsigned int</td>
</tr>
<tr>
<td>MPI_UNSIGNED_LONG</td>
<td>unsigned long int</td>
</tr>
<tr>
<td>MPI_UNSIGNED_LONG_LONG</td>
<td>unsigned long long int</td>
</tr>
<tr>
<td>MPI_FLOAT</td>
<td>float</td>
</tr>
<tr>
<td>MPI_DOUBLE</td>
<td>double</td>
</tr>
<tr>
<td>MPI_LONG_DOUBLE</td>
<td>long double</td>
</tr>
<tr>
<td>MPI_BYTE</td>
<td>char</td>
</tr>
</tbody></table>
<h2 id="MPI-å‘é€-x2F-æ¥æ”¶-ç¨‹åº"><a href="#MPI-å‘é€-x2F-æ¥æ”¶-ç¨‹åº" class="headerlink" title="MPI å‘é€ &#x2F; æ¥æ”¶ ç¨‹åº"></a>MPI å‘é€ &#x2F; æ¥æ”¶ ç¨‹åº</h2><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¾—åˆ°å½“å‰è¿›ç¨‹çš„ rank ä»¥åŠæ•´ä¸ª communicator çš„å¤§å°</span></span><br><span class="line"><span class="type">int</span> world_rank;</span><br><span class="line">MPI_Comm_rank(MPI_COMM_WORLD, &amp;world_rank);</span><br><span class="line"><span class="type">int</span> world_size;</span><br><span class="line">MPI_Comm_size(MPI_COMM_WORLD, &amp;world_size);</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> number;</span><br><span class="line"><span class="keyword">if</span> (world_rank == <span class="number">0</span>) &#123;</span><br><span class="line">    number = <span class="number">-1</span>;</span><br><span class="line">    MPI_Send(&amp;number, <span class="number">1</span>, MPI_INT, <span class="number">1</span>, <span class="number">0</span>, MPI_COMM_WORLD);</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (world_rank == <span class="number">1</span>) &#123;</span><br><span class="line">    MPI_Recv(&amp;number, <span class="number">1</span>, MPI_INT, <span class="number">0</span>, <span class="number">0</span>, MPI_COMM_WORLD,</span><br><span class="line">             MPI_STATUS_IGNORE);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Process 1 received number %d from process 0\n&quot;</span>,</span><br><span class="line">           number);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>å¦‚æœå½“å‰è¿›ç¨‹æ˜¯ 0 è¿›ç¨‹ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±åˆå§‹åŒ–ä¸€ä¸ªæ•°å­— -1 ç„¶åæŠŠå®ƒå‘é€ç»™ 1 è¿›ç¨‹ã€‚ç„¶åä½ å¯ä»¥çœ‹åˆ° <code>else if</code> æ¡ä»¶è¯­å¥é‡Œçš„è¯é¢˜ï¼Œè¿›ç¨‹ 1 ä¼šè°ƒç”¨ <code>MPI_Recv</code> å»æ¥å—è¿™ä¸ªæ•°å­—ã€‚ç„¶åä¼šå°†æ¥æ”¶åˆ°çš„æ•°å­—æ‰“å°å‡ºæ¥ã€‚ç”±äºæˆ‘ä»¬æ˜ç¡®åœ°å‘é€æ¥æ”¶äº†ä¸€ä¸ªæ•´æ•°ï¼Œå› æ­¤ <code>MPI_INT</code> æ•°æ®ç±»å‹è¢«ä½¿ç”¨äº†ã€‚æ¯ä¸ªè¿›ç¨‹è¿˜ä½¿ç”¨äº† 0 ä½œä¸ºæ¶ˆæ¯æ ‡ç­¾æ¥æŒ‡å®šæ¶ˆæ¯ã€‚ç”±äºæˆ‘ä»¬è¿™é‡Œåªæœ‰ä¸€ç§ç±»å‹çš„ä¿¡æ¯è¢«ä¼ é€’äº†ï¼Œå› æ­¤è¿›ç¨‹ä¹Ÿå¯ä»¥ä½¿ç”¨é¢„å…ˆå®šä¹‰å¥½çš„å¸¸é‡ <code>MPI_ANY_TAG</code> æ¥ä½œä¸ºæ ‡ç­¾æ•°å­—ã€‚</p>
<h2 id="MPI-ä¹’ä¹“ç¨‹åº"><a href="#MPI-ä¹’ä¹“ç¨‹åº" class="headerlink" title="MPI ä¹’ä¹“ç¨‹åº"></a>MPI ä¹’ä¹“ç¨‹åº</h2><p>æ¥ä¸‹æ¥çš„ç¨‹åºæ¯”è¾ƒæœ‰è¶£ï¼Œæ˜¯ä¸€ä¸ªä¹’ä¹“æ¸¸æˆã€‚ä¸¤ä¸ªè¿›ç¨‹ä¼šä¸€ç›´ä½¿ç”¨ <code>MPI_Send</code> å’Œ <code>MPI_Recv</code> æ–¹æ³•æ¥â€œæ¨æŒ¡â€æ¶ˆæ¯ï¼Œç›´åˆ°ä»–ä»¬å†³å®šä¸ç©äº†ã€‚</p>
<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;mpi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>** argv)</span> &#123;</span><br><span class="line">  <span class="type">const</span> <span class="type">int</span> PING_PONG_LIMIT = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Initialize the MPI environment</span></span><br><span class="line">  MPI_Init(<span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br><span class="line">  <span class="comment">// Find out rank, size</span></span><br><span class="line">  <span class="type">int</span> world_rank;</span><br><span class="line">  MPI_Comm_rank(MPI_COMM_WORLD, &amp;world_rank);</span><br><span class="line">  <span class="type">int</span> world_size;</span><br><span class="line">  MPI_Comm_size(MPI_COMM_WORLD, &amp;world_size);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// We are assuming 2 processes for this task</span></span><br><span class="line">  <span class="keyword">if</span> (world_size != <span class="number">2</span>) &#123;</span><br><span class="line">    <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;World size must be two for %s\n&quot;</span>, argv[<span class="number">0</span>]);</span><br><span class="line">    MPI_Abort(MPI_COMM_WORLD, <span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="type">int</span> ping_pong_count = <span class="number">0</span>;</span><br><span class="line">  <span class="type">int</span> partner_rank = (world_rank + <span class="number">1</span>) % <span class="number">2</span>;</span><br><span class="line">  <span class="keyword">while</span> (ping_pong_count &lt; PING_PONG_LIMIT) &#123;				<span class="comment">//10æ¬¡ä»¥åé€€å‡ºç¨‹åº</span></span><br><span class="line">    <span class="keyword">if</span> (world_rank == ping_pong_count % <span class="number">2</span>) &#123;</span><br><span class="line">      <span class="comment">// Increment the ping pong count before you send it</span></span><br><span class="line">      ping_pong_count++;</span><br><span class="line">      MPI_Send(&amp;ping_pong_count, <span class="number">1</span>, MPI_INT, partner_rank, <span class="number">0</span>, MPI_COMM_WORLD);</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;%d sent and incremented ping_pong_count %d to %d\n&quot;</span>,</span><br><span class="line">             world_rank, ping_pong_count, partner_rank);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      MPI_Recv(&amp;ping_pong_count, <span class="number">1</span>, MPI_INT, partner_rank, <span class="number">0</span>, MPI_COMM_WORLD,</span><br><span class="line">               MPI_STATUS_IGNORE);</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;%d received ping_pong_count %d from %d\n&quot;</span>,</span><br><span class="line">             world_rank, ping_pong_count, partner_rank);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  MPI_Finalize();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>éšç€ <code>ping_pong_count</code> çš„é€’å¢ï¼Œä¸¤ä¸ªè¿›ç¨‹ä¼šè½®æµæˆä¸ºå‘é€è€…å’Œæ¥å—è€…ã€‚æœ€åï¼Œå½“æˆ‘ä»¬è®¾å®šçš„ limit è¢«è§¦å‘çš„æ—¶å€™ï¼Œè¿›ç¨‹å°±åœæ­¢äº†å‘é€å’Œæ¥æ”¶ã€‚è¿™ä¸ªç¨‹åºåœ¨å…¶ä»–æœºå™¨ä¸Šè¿è¡Œçš„è¾“å‡ºå¯èƒ½ä¼šç”±äºè¿›ç¨‹è°ƒåº¦çš„ä¸åŒè·Ÿä¸Šé¢çš„ä¸ä¸€æ ·ã€‚ä¸ç®¡æ€ä¹ˆæ ·ï¼Œä½ å¯ä»¥çœ‹åˆ°ï¼Œè¿›ç¨‹0å’Œè¿›ç¨‹1åœ¨è½®æµå‘é€å’Œæ¥æ”¶ ping_pong_countã€‚</p>
<h2 id="ç¯ç¨‹åº"><a href="#ç¯ç¨‹åº" class="headerlink" title="ç¯ç¨‹åº"></a>ç¯ç¨‹åº</h2><p>ä¸€ä¸ªå€¼ä¼šåœ¨å„ä¸ªè¿›ç¨‹ä¹‹é—´ä»¥ä¸€ä¸ªç¯çš„å½¢å¼ä¼ é€’ã€‚</p>
<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;mpi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>** argv)</span> &#123;</span><br><span class="line">  <span class="comment">// Initialize the MPI environment</span></span><br><span class="line">  MPI_Init(<span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br><span class="line">  <span class="comment">// Find out rank, size</span></span><br><span class="line">  <span class="type">int</span> world_rank;</span><br><span class="line">  MPI_Comm_rank(MPI_COMM_WORLD, &amp;world_rank);</span><br><span class="line">  <span class="type">int</span> world_size;</span><br><span class="line">  MPI_Comm_size(MPI_COMM_WORLD, &amp;world_size);</span><br><span class="line"></span><br><span class="line">  <span class="type">int</span> token;</span><br><span class="line">  <span class="comment">// Receive from the lower process and send to the higher process. Take care</span></span><br><span class="line">  <span class="comment">// of the special case when you are the first process to prevent deadlock.</span></span><br><span class="line">  <span class="keyword">if</span> (world_rank != <span class="number">0</span>) &#123;</span><br><span class="line">    MPI_Recv(&amp;token, <span class="number">1</span>, MPI_INT, world_rank - <span class="number">1</span>, <span class="number">0</span>, MPI_COMM_WORLD,</span><br><span class="line">             MPI_STATUS_IGNORE);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Process %d received token %d from process %d\n&quot;</span>, world_rank, token,</span><br><span class="line">           world_rank - <span class="number">1</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// Set the token&#x27;s value if you are process 0</span></span><br><span class="line">    token = <span class="number">-1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  MPI_Send(&amp;token, <span class="number">1</span>, MPI_INT, (world_rank + <span class="number">1</span>) % world_size, <span class="number">0</span>,</span><br><span class="line">           MPI_COMM_WORLD);</span><br><span class="line">  <span class="comment">// Now process 0 can receive from the last process. This makes sure that at</span></span><br><span class="line">  <span class="comment">// least one MPI_Send is initialized before all MPI_Recvs (again, to prevent</span></span><br><span class="line">  <span class="comment">// deadlock)</span></span><br><span class="line">  <span class="keyword">if</span> (world_rank == <span class="number">0</span>) &#123;</span><br><span class="line">    MPI_Recv(&amp;token, <span class="number">1</span>, MPI_INT, world_size - <span class="number">1</span>, <span class="number">0</span>, MPI_COMM_WORLD,</span><br><span class="line">             MPI_STATUS_IGNORE);				<span class="comment">//é»˜è®¤ä¸æ¥å—MPI_Statusç»“æ„ä½“çš„å‚æ•°</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Process %d received token %d from process %d\n&quot;</span>, world_rank, token,</span><br><span class="line">           world_size - <span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  MPI_Finalize();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>è¿™ä¸ªç¯ç¨‹åºåœ¨è¿›ç¨‹0ä¸Šé¢åˆå§‹åŒ–äº†ä¸€ä¸ªå€¼-1ï¼Œèµ‹å€¼ç»™ tokenã€‚ç„¶åè¿™ä¸ªå€¼ä¼šä¾æ¬¡ä¼ é€’ç»™æ¯ä¸ªè¿›ç¨‹ã€‚ç¨‹åºä¼šåœ¨è¿›ç¨‹0ä»æœ€åä¸€ä¸ªè¿›ç¨‹æ¥æ”¶åˆ°å€¼ä¹‹åç»“æŸã€‚å¦‚ä½ æ‰€è§ï¼Œæˆ‘ä»¬çš„é€»è¾‘é¿å…äº†æ­»é”çš„å‘ç”Ÿã€‚å…·ä½“æ¥è¯´ï¼Œè¿›ç¨‹0ä¿è¯äº†åœ¨æƒ³è¦æ¥å—æ•°æ®ä¹‹å‰å‘é€äº† tokenã€‚æ‰€æœ‰å…¶ä»–çš„è¿›ç¨‹åªæ˜¯ç®€å•çš„è°ƒç”¨ <code>MPI_Recv</code> (ä»ä»–ä»¬çš„é‚»å±…è¿›ç¨‹æ¥æ”¶æ•°æ®)ï¼Œç„¶åè°ƒç”¨ <code>MPI_Send</code> (å‘é€æ•°æ®åˆ°ä»–ä»¬çš„é‚»å±…è¿›ç¨‹)æŠŠæ•°æ®ä»ç¯ä¸Šä¼ é€’ä¸‹å»ã€‚ <code>MPI_Send</code> å’Œ <code>MPI_Recv</code> ä¼šé˜»å¡ç›´åˆ°æ•°æ®ä¼ é€’å®Œæˆã€‚å› ä¸ºè¿™ä¸ªç‰¹æ€§ï¼Œæ‰“å°å‡ºæ¥çš„æ•°æ®æ˜¯è·Ÿæ•°æ®ä¼ é€’çš„æ¬¡åºä¸€æ ·çš„</p>
<h1 id="Dynamic-Receiving-with-MPI-Probe-and-MPI-Status"><a href="#Dynamic-Receiving-with-MPI-Probe-and-MPI-Status" class="headerlink" title="Dynamic Receiving with MPI Probe (and MPI Status)"></a>Dynamic Receiving with MPI Probe (and MPI Status)</h1><h2 id="MPI-Status-ç»“æ„ä½“"><a href="#MPI-Status-ç»“æ„ä½“" class="headerlink" title="MPI_Status ç»“æ„ä½“"></a>MPI_Status ç»“æ„ä½“</h2><p><code>MPI_Recv</code> å°† <code>MPI_Status</code> ç»“æ„ä½“çš„åœ°å€ä½œä¸ºå‚æ•°ï¼ˆå¯ä»¥ä½¿ç”¨ <code>MPI_STATUS_IGNORE</code> å¿½ç•¥ï¼‰ã€‚ å¦‚æœæˆ‘ä»¬å°† <code>MPI_Status</code> ç»“æ„ä½“ä¼ é€’ç»™ <code>MPI_Recv</code> å‡½æ•°ï¼Œåˆ™æ“ä½œå®Œæˆåå°†åœ¨è¯¥ç»“æ„ä½“ä¸­å¡«å……æœ‰å…³æ¥æ”¶æ“ä½œçš„å…¶ä»–ä¿¡æ¯ã€‚ ä¸‰ä¸ªä¸»è¦çš„ä¿¡æ¯åŒ…æ‹¬ï¼š</p>
<ol>
<li><strong>å‘é€ç«¯ç§©</strong>. å‘é€ç«¯çš„ç§©å­˜å‚¨åœ¨ç»“æ„ä½“çš„ <code>MPI_SOURCE</code> å…ƒç´ ä¸­ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæˆ‘ä»¬å£°æ˜ä¸€ä¸ª <code>MPI_Status stat</code> å˜é‡ï¼Œåˆ™å¯ä»¥é€šè¿‡ <code>stat.MPI_SOURCE</code> è®¿é—®ç§©ã€‚</li>
<li><strong>æ¶ˆæ¯çš„æ ‡ç­¾</strong>. æ¶ˆæ¯çš„æ ‡ç­¾å¯ä»¥é€šè¿‡ç»“æ„ä½“çš„ <code>MPI_TAG</code> å…ƒç´ è®¿é—®ï¼ˆç±»ä¼¼äº <code>MPI_SOURCE</code>ï¼‰ã€‚</li>
<li><strong>æ¶ˆæ¯çš„é•¿åº¦</strong>. æ¶ˆæ¯çš„é•¿åº¦åœ¨ç»“æ„ä½“ä¸­æ²¡æœ‰é¢„å®šä¹‰çš„å…ƒç´ ã€‚ç›¸åï¼Œæˆ‘ä»¬å¿…é¡»ä½¿ç”¨ <code>MPI_Get_count</code> æ‰¾å‡ºæ¶ˆæ¯çš„é•¿åº¦ã€‚</li>
</ol>
<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">MPI_Get_count(</span><br><span class="line">    MPI_Status* status,			<span class="comment">//MPI_Status ç»“æ„ä½“</span></span><br><span class="line">    MPI_Datatype datatype,		<span class="comment">//æ•°æ®ç±»å‹</span></span><br><span class="line">    <span class="type">int</span>* count)					<span class="comment">//å·²æ¥å—datatypeçš„å…ƒç´ çš„æ•°ç›®</span></span><br></pre></td></tr></table></figure></div>

<p> äº‹å®è¯æ˜ï¼Œ<code>MPI_Recv</code> å¯ä»¥å°† <code>MPI_ANY_SOURCE</code> ç”¨ä½œå‘é€ç«¯çš„ç§©ï¼Œå°† <code>MPI_ANY_TAG</code> ç”¨ä½œæ¶ˆæ¯çš„æ ‡ç­¾ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ<code>MPI_Status</code> ç»“æ„ä½“æ˜¯æ‰¾å‡ºæ¶ˆæ¯çš„<strong>å®é™…å‘é€ç«¯å’Œæ ‡ç­¾çš„å”¯ä¸€æ–¹æ³•</strong>ã€‚ æ­¤å¤–ï¼Œå¹¶ä¸èƒ½ä¿è¯ <code>MPI_Recv</code> èƒ½å¤Ÿæ¥æ”¶å‡½æ•°è°ƒç”¨å‚æ•°çš„å…¨éƒ¨å…ƒç´ ã€‚ ç›¸åï¼Œå®ƒåªæ¥æ”¶å·²å‘é€ç»™å®ƒçš„å…ƒç´ æ•°é‡ï¼ˆå¦‚æœå‘é€çš„å…ƒç´ å¤šäºæ‰€éœ€çš„æ¥æ”¶æ•°é‡ï¼Œåˆ™è¿”å›é”™è¯¯ã€‚ï¼‰ <code>MPI_Get_count</code> å‡½æ•°ç”¨äºç¡®å®šå®é™…çš„æ¥æ”¶é‡ã€‚</p>
<h2 id="MPI-Status-ç»“æ„ä½“æŸ¥è¯¢çš„ç¤ºä¾‹"><a href="#MPI-Status-ç»“æ„ä½“æŸ¥è¯¢çš„ç¤ºä¾‹" class="headerlink" title="MPI_Status ç»“æ„ä½“æŸ¥è¯¢çš„ç¤ºä¾‹"></a><code>MPI_Status</code> ç»“æ„ä½“æŸ¥è¯¢çš„ç¤ºä¾‹</h2><p>ç¨‹åºå°†éšæœºæ•°é‡çš„æ•°å­—å‘é€ç»™æ¥æ”¶ç«¯ï¼Œç„¶åæ¥æ”¶ç«¯æ‰¾å‡ºå‘é€äº†å¤šå°‘ä¸ªæ•°å­—</p>
<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;mpi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;time.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>** argv)</span> &#123;</span><br><span class="line">  MPI_Init(<span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">  <span class="type">int</span> world_size;</span><br><span class="line">  MPI_Comm_size(MPI_COMM_WORLD, &amp;world_size);</span><br><span class="line">  <span class="keyword">if</span> (world_size != <span class="number">2</span>) &#123;</span><br><span class="line">    <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;Must use two processes for this example\n&quot;</span>);</span><br><span class="line">    MPI_Abort(MPI_COMM_WORLD, <span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="type">int</span> world_rank;</span><br><span class="line">  MPI_Comm_rank(MPI_COMM_WORLD, &amp;world_rank);</span><br><span class="line"></span><br><span class="line">  <span class="type">const</span> <span class="type">int</span> MAX_NUMBERS = <span class="number">100</span>;</span><br><span class="line">  <span class="type">int</span> numbers[MAX_NUMBERS];</span><br><span class="line">  <span class="type">int</span> number_amount;</span><br><span class="line">  <span class="keyword">if</span> (world_rank == <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="comment">// Pick a random amount of integers to send to process one</span></span><br><span class="line">    srand(time(<span class="literal">NULL</span>));	<span class="comment">//srand()ç”¨äºè®¾ç½®éšæœºæ•°ç”Ÿæˆå™¨çš„ç§å­ï¼Œç§å­æ˜¯éšæœºæ•°ç”Ÿæˆå™¨çš„ä¸€ä¸ªé‡è¦å‚æ•°ï¼Œå®ƒç”¨äºåˆå§‹åŒ–ç”Ÿæˆå™¨å¹¶ç¡®å®šç”Ÿæˆçš„éšæœºæ•°åºåˆ—ã€‚å¦‚æœä½¿ç”¨ç›¸åŒçš„ç§å­ï¼Œéšæœºæ•°ç”Ÿæˆå™¨å°†ç”Ÿæˆç›¸åŒçš„éšæœºæ•°åºåˆ—ã€‚ä¸€èˆ¬ä»¥å½“å‰æ—¶é—´ä½œä¸ºç§å­</span></span><br><span class="line">      </span><br><span class="line">    number_amount = (rand() / (<span class="type">float</span>)RAND_MAX) * MAX_NUMBERS;</span><br><span class="line">    <span class="comment">// Send the amount of integers to process one</span></span><br><span class="line">    MPI_Send(numbers, number_amount, MPI_INT, <span class="number">1</span>, <span class="number">0</span>, MPI_COMM_WORLD);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;0 sent %d numbers to 1\n&quot;</span>, number_amount);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (world_rank == <span class="number">1</span>) &#123;</span><br><span class="line">    MPI_Status status;</span><br><span class="line">    <span class="comment">// Receive at most MAX_NUMBERS from process zero</span></span><br><span class="line">    MPI_Recv(numbers, MAX_NUMBERS, MPI_INT, <span class="number">0</span>, <span class="number">0</span>, MPI_COMM_WORLD, &amp;status);</span><br><span class="line">    <span class="comment">// After receiving the message, check the status to determine how many</span></span><br><span class="line">    <span class="comment">// numbers were actually received</span></span><br><span class="line">    MPI_Get_count(&amp;status, MPI_INT, &amp;number_amount);</span><br><span class="line">    <span class="comment">// Print off the amount of numbers, and also print additional information</span></span><br><span class="line">    <span class="comment">// in the status object</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;1 received %d numbers from 0. Message source = %d, tag = %d\n&quot;</span>,</span><br><span class="line">           number_amount, status.MPI_SOURCE, status.MPI_TAG);</span><br><span class="line">  &#125;</span><br><span class="line">  MPI_Barrier(MPI_COMM_WORLD);</span><br><span class="line">  MPI_Finalize();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>å¦‚æˆ‘ä»¬æ‰€è§ï¼Œè¿›ç¨‹ 0 å°†æœ€å¤š <code>MAX_NUMBERS</code> ä¸ªæ•´æ•°ä»¥éšæœºæ•°é‡å‘é€åˆ°è¿›ç¨‹ 1ã€‚ è¿›ç¨‹ 1 ç„¶åè°ƒç”¨ <code>MPI_Recv</code> ä»¥è·å–æ€»è®¡ <code>MAX_NUMBERS</code> ä¸ªæ•´æ•°ã€‚ <strong>å°½ç®¡è¿›ç¨‹ 1 ä»¥ <code>MAX_NUMBERS</code> ä½œä¸º <code>MPI_Recv</code> å‡½æ•°å‚æ•°</strong>ï¼Œä½†è¿›ç¨‹ 1 å°†æœ€å¤šæ¥æ”¶åˆ°æ­¤æ•°é‡çš„æ•°å­—ã€‚ åœ¨ä»£ç ä¸­ï¼Œ<strong>è¿›ç¨‹ 1 ä½¿ç”¨ <code>MPI_INT</code> ä½œä¸ºæ•°æ®ç±»å‹çš„å‚æ•°ï¼Œè°ƒç”¨ <code>MPI_Get_count</code>ï¼Œä»¥æ‰¾å‡ºå®é™…æ¥æ”¶äº†å¤šå°‘ä¸ªæ•´æ•°ã€‚</strong> é™¤äº†æ‰“å°å‡ºæ¥æ”¶åˆ°çš„æ¶ˆæ¯çš„å¤§å°å¤–ï¼Œè¿›ç¨‹ 1 è¿˜é€šè¿‡è®¿é—® status ç»“æ„ä½“çš„ <code>MPI_SOURCE</code> å’Œ <code>MPI_TAG</code> å…ƒç´ æ¥æ‰“å°æ¶ˆæ¯çš„æ¥æºå’Œæ ‡ç­¾ã€‚</p>
<p><code>MPI_Get_count</code> çš„è¿”å›å€¼æ˜¯ç›¸å¯¹äºä¼ é€’çš„æ•°æ®ç±»å‹è€Œè¨€çš„</p>
<h2 id="ä½¿ç”¨-MPI-Probe-æ‰¾å‡ºæ¶ˆæ¯å¤§å°"><a href="#ä½¿ç”¨-MPI-Probe-æ‰¾å‡ºæ¶ˆæ¯å¤§å°" class="headerlink" title="ä½¿ç”¨ MPI_Probe æ‰¾å‡ºæ¶ˆæ¯å¤§å°"></a>ä½¿ç”¨ <code>MPI_Probe</code> æ‰¾å‡ºæ¶ˆæ¯å¤§å°</h2><p>é™¤äº†ä¼ é€’æ¥æ”¶æ¶ˆæ¯å¹¶ç®€æ˜“åœ°é…å¤‡ä¸€ä¸ªå¾ˆå¤§çš„ç¼“å†²åŒºæ¥ä¸ºæ‰€æœ‰å¯èƒ½çš„å¤§å°çš„æ¶ˆæ¯æä¾›å¤„ç†ï¼ˆå°±åƒæˆ‘ä»¬åœ¨ä¸Šä¸€ä¸ªç¤ºä¾‹ä¸­æ‰€åšçš„é‚£æ ·ï¼‰ï¼Œæ‚¨å¯ä»¥<strong>ä½¿ç”¨ <code>MPI_Probe</code> åœ¨å®é™…æ¥æ”¶æ¶ˆæ¯ä¹‹å‰æŸ¥è¯¢æ¶ˆæ¯å¤§å°ã€‚</strong> å‡½æ•°åŸå‹çœ‹èµ·æ¥åƒè¿™æ ·ï¼š</p>
<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">MPI_Probe(</span><br><span class="line">    <span class="type">int</span> source,</span><br><span class="line">    <span class="type">int</span> tag,</span><br><span class="line">    MPI_Comm comm,</span><br><span class="line">    MPI_Status* status)</span><br></pre></td></tr></table></figure></div>

<p><code>MPI_Probe</code> çœ‹èµ·æ¥ä¸ <code>MPI_Recv</code> éå¸¸ç›¸ä¼¼ã€‚ å®é™…ä¸Šï¼Œæ‚¨å¯ä»¥å°† <code>MPI_Probe</code> è§†ä¸º <code>MPI_Recv</code>ï¼Œé™¤äº†ä¸æ¥æ”¶æ¶ˆæ¯å¤–ï¼Œå®ƒä»¬æ‰§è¡Œç›¸åŒçš„åŠŸèƒ½ã€‚ ä¸ <code>MPI_Recv</code> ç±»ä¼¼ï¼Œ**<code>MPI_Probe</code> å°†é˜»å¡å…·æœ‰åŒ¹é…æ ‡ç­¾å’Œå‘é€ç«¯çš„æ¶ˆæ¯ã€‚ å½“æ¶ˆæ¯å¯ç”¨æ—¶ï¼Œå®ƒå°†å¡«å…… status ç»“æ„ä½“**ã€‚ ç„¶åï¼Œç”¨æˆ·å¯ä»¥ä½¿ç”¨ <code>MPI_Recv</code> æ¥æ”¶å®é™…çš„æ¶ˆæ¯ã€‚</p>
<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> number_amount;</span><br><span class="line"><span class="keyword">if</span> (world_rank == <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="type">const</span> <span class="type">int</span> MAX_NUMBERS = <span class="number">100</span>;</span><br><span class="line">    <span class="type">int</span> numbers[MAX_NUMBERS];</span><br><span class="line">    <span class="comment">// Pick a random amount of integers to send to process one</span></span><br><span class="line">    srand(time(<span class="literal">NULL</span>));</span><br><span class="line">    number_amount = (rand() / (<span class="type">float</span>)RAND_MAX) * MAX_NUMBERS;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Send the random amount of integers to process one</span></span><br><span class="line">    MPI_Send(numbers, number_amount, MPI_INT, <span class="number">1</span>, <span class="number">0</span>, MPI_COMM_WORLD);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;0 sent %d numbers to 1\n&quot;</span>, number_amount);</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (world_rank == <span class="number">1</span>) &#123;</span><br><span class="line">    MPI_Status status;</span><br><span class="line">    <span class="comment">// Probe for an incoming message from process zero</span></span><br><span class="line">    MPI_Probe(<span class="number">0</span>, <span class="number">0</span>, MPI_COMM_WORLD, &amp;status);		<span class="comment">//åœ¨receiveä¹‹å‰</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// When probe returns, the status object has the size and other</span></span><br><span class="line">    <span class="comment">// attributes of the incoming message. Get the message size</span></span><br><span class="line">    MPI_Get_count(&amp;status, MPI_INT, &amp;number_amount);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Allocate a buffer to hold the incoming numbers</span></span><br><span class="line">    <span class="type">int</span>* number_buf = (<span class="type">int</span>*)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="type">int</span>) * number_amount);		<span class="comment">//ç¼“å†²åŒº</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Now receive the message with the allocated buffer</span></span><br><span class="line">    MPI_Recv(number_buf, number_amount, MPI_INT, <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">             MPI_COMM_WORLD, MPI_STATUS_IGNORE);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;1 dynamically received %d numbers from 0.\n&quot;</span>,</span><br><span class="line">           number_amount);</span><br><span class="line">    <span class="built_in">free</span>(number_buf);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h1 id="MPI-å¹¿æ’­ä»¥åŠé›†ä½“-collective-é€šä¿¡"><a href="#MPI-å¹¿æ’­ä»¥åŠé›†ä½“-collective-é€šä¿¡" class="headerlink" title="MPI å¹¿æ’­ä»¥åŠé›†ä½“(collective)é€šä¿¡"></a>MPI å¹¿æ’­ä»¥åŠé›†ä½“(collective)é€šä¿¡</h1><p>é›†ä½“é€šä¿¡æŒ‡çš„æ˜¯ä¸€ä¸ªæ¶‰åŠ communicator é‡Œé¢æ‰€æœ‰è¿›ç¨‹çš„ä¸€ä¸ªæ–¹æ³•ã€‚è§£é‡Šé›†ä½“é€šä¿¡ä»¥åŠä¸€ä¸ªæ ‡å‡†çš„æ–¹æ³• - broadcasting (å¹¿æ’­)</p>
<h2 id="é›†ä½“é€šä¿¡ä»¥åŠåŒæ­¥ç‚¹"><a href="#é›†ä½“é€šä¿¡ä»¥åŠåŒæ­¥ç‚¹" class="headerlink" title="é›†ä½“é€šä¿¡ä»¥åŠåŒæ­¥ç‚¹"></a>é›†ä½“é€šä¿¡ä»¥åŠåŒæ­¥ç‚¹</h2><p>å…³äºé›†ä½“é€šä¿¡éœ€è¦è®°ä½çš„ä¸€ç‚¹æ˜¯å®ƒåœ¨è¿›ç¨‹é—´å¼•å…¥äº†<strong>åŒæ­¥ç‚¹</strong>çš„æ¦‚å¿µã€‚è¿™æ„å‘³ç€æ‰€æœ‰çš„è¿›ç¨‹åœ¨æ‰§è¡Œä»£ç çš„æ—¶å€™å¿…é¡»é¦–å…ˆ<em>éƒ½</em>åˆ°è¾¾ä¸€ä¸ªåŒæ­¥ç‚¹æ‰èƒ½ç»§ç»­æ‰§è¡Œåé¢çš„ä»£ç ã€‚</p>
<p>åœ¨çœ‹å…·ä½“çš„é›†ä½“é€šä¿¡æ–¹æ³•ä¹‹å‰ï¼Œè®©æˆ‘ä»¬æ›´ä»”ç»†åœ°çœ‹ä¸€ä¸‹åŒæ­¥è¿™ä¸ªæ¦‚å¿µã€‚äº‹å®ä¸Šï¼ŒMPI æœ‰ä¸€ä¸ªç‰¹æ®Šçš„å‡½æ•°æ¥åšåŒæ­¥è¿›ç¨‹çš„è¿™ä¸ªæ“ä½œ</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MPI_Barrier(MPI_Comm communicator)</span><br></pre></td></tr></table></figure></div>

<p>è¿™ä¸ªå‡½æ•°çš„åå­—ååˆ†è´´åˆ‡ï¼ˆBarrierï¼Œå±éšœï¼‰- è¿™ä¸ªæ–¹æ³•ä¼šæ„å»ºä¸€ä¸ªå±éšœï¼Œä»»ä½•è¿›ç¨‹éƒ½æ²¡æ³•è·¨è¶Šå±éšœï¼Œç›´åˆ°æ‰€æœ‰çš„è¿›ç¨‹éƒ½åˆ°è¾¾å±éšœ</p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/06/MPI/image-20230406190258065.png"
                      class="" title="image-20230406190258065"
                >

<p><code>MPI_Barrier</code> åœ¨å¾ˆå¤šæ—¶å€™å¾ˆæœ‰ç”¨ã€‚å…¶ä¸­ä¸€ä¸ªç”¨é€”æ˜¯ç”¨æ¥åŒæ­¥ä¸€ä¸ªç¨‹åºï¼Œä½¿å¾—åˆ†å¸ƒå¼ä»£ç ä¸­çš„æŸä¸€éƒ¨åˆ†å¯ä»¥è¢«ç²¾ç¡®çš„è®¡æ—¶ã€‚</p>
<p>å…³äºåŒæ­¥æœ€åä¸€ä¸ªè¦æ³¨æ„çš„åœ°æ–¹æ˜¯ï¼š<strong>å§‹ç»ˆè®°å¾—æ¯ä¸€ä¸ªä½ è°ƒç”¨çš„é›†ä½“é€šä¿¡æ–¹æ³•éƒ½æ˜¯åŒæ­¥çš„</strong>ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä½ æ²¡æ³•è®©æ‰€æœ‰è¿›ç¨‹éƒ½å®Œæˆ <code>MPI_Barrier</code>ï¼Œé‚£ä¹ˆä½ ä¹Ÿæ²¡æ³•å®Œæˆä»»ä½•é›†ä½“è°ƒç”¨ã€‚å¦‚æœä½ åœ¨æ²¡æœ‰ç¡®ä¿æ‰€æœ‰è¿›ç¨‹éƒ½è°ƒç”¨ <code>MPI_Barrier</code> çš„æƒ…å†µä¸‹è°ƒç”¨äº†å®ƒï¼Œé‚£ä¹ˆç¨‹åºä¼šç©ºé—²ä¸‹æ¥ã€‚</p>
<h2 id="ä½¿ç”¨-MPI-Bcast-æ¥è¿›è¡Œå¹¿æ’­"><a href="#ä½¿ç”¨-MPI-Bcast-æ¥è¿›è¡Œå¹¿æ’­" class="headerlink" title="ä½¿ç”¨ MPI_Bcast æ¥è¿›è¡Œå¹¿æ’­"></a>ä½¿ç”¨ MPI_Bcast æ¥è¿›è¡Œå¹¿æ’­</h2><p><em><strong>å¹¿æ’­</strong></em> (broadcast) æ˜¯æ ‡å‡†çš„é›†ä½“é€šä¿¡æŠ€æœ¯ä¹‹ä¸€ã€‚ä¸€ä¸ªå¹¿æ’­å‘ç”Ÿçš„æ—¶å€™ï¼Œä¸€ä¸ªè¿›ç¨‹ä¼šæŠŠåŒæ ·ä¸€ä»½æ•°æ®ä¼ é€’ç»™ä¸€ä¸ª communicator é‡Œçš„æ‰€æœ‰å…¶ä»–è¿›ç¨‹ã€‚å¹¿æ’­çš„ä¸»è¦ç”¨é€”ä¹‹ä¸€æ˜¯æŠŠç”¨æˆ·è¾“å…¥ä¼ é€’ç»™ä¸€ä¸ªåˆ†å¸ƒå¼ç¨‹åºï¼Œæˆ–è€…æŠŠä¸€äº›é…ç½®å‚æ•°ä¼ é€’ç»™æ‰€æœ‰çš„è¿›ç¨‹ã€‚</p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/06/MPI/image-20230406190643521.png"
                      class="" title="image-20230406190643521"
                >

<p>åœ¨ MPI é‡Œé¢ï¼Œå¹¿æ’­å¯ä»¥ä½¿ç”¨ <code>MPI_Bcast</code> æ¥åšåˆ°ï¼š</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">MPI_Bcast(</span><br><span class="line">    void* data,</span><br><span class="line">    int count,</span><br><span class="line">    MPI_Datatype datatype,</span><br><span class="line">    int root,</span><br><span class="line">    MPI_Comm communicator)</span><br></pre></td></tr></table></figure></div>

<p>æ ¹èŠ‚ç‚¹å’Œæ¥æ”¶èŠ‚ç‚¹éƒ½æ˜¯è°ƒç”¨åŒæ ·çš„è¿™ä¸ª <code>MPI_Bcast</code> å‡½æ•°æ¥å®ç°å¹¿æ’­ã€‚å½“æ ¹èŠ‚ç‚¹(åœ¨æˆ‘ä»¬çš„ä¾‹å­æ˜¯èŠ‚ç‚¹0)è°ƒç”¨ <code>MPI_Bcast</code> å‡½æ•°çš„æ—¶å€™ï¼Œ<code>data</code> å˜é‡é‡Œçš„å€¼ä¼šè¢«å‘é€åˆ°å…¶ä»–çš„èŠ‚ç‚¹ä¸Šã€‚å½“å…¶ä»–çš„èŠ‚ç‚¹è°ƒç”¨ <code>MPI_Bcast</code> çš„æ—¶å€™ï¼Œ<code>data</code> å˜é‡ä¼šè¢«èµ‹å€¼æˆä»æ ¹èŠ‚ç‚¹æ¥å—åˆ°çš„æ•°æ®ã€‚</p>
<h2 id="ä½¿ç”¨-MPI-Send-å’Œ-MPI-Recv-æ¥åšå¹¿æ’­"><a href="#ä½¿ç”¨-MPI-Send-å’Œ-MPI-Recv-æ¥åšå¹¿æ’­" class="headerlink" title="ä½¿ç”¨ MPI_Send å’Œ MPI_Recv æ¥åšå¹¿æ’­"></a>ä½¿ç”¨ MPI_Send å’Œ MPI_Recv æ¥åšå¹¿æ’­</h2><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;mpi.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">my_bcast</span><span class="params">(<span class="type">void</span>* data, <span class="type">int</span> count, MPI_Datatype datatype, <span class="type">int</span> root,</span></span><br><span class="line"><span class="params">              MPI_Comm communicator)</span> &#123;</span><br><span class="line">  <span class="type">int</span> world_rank;</span><br><span class="line">  MPI_Comm_rank(communicator, &amp;world_rank);</span><br><span class="line">  <span class="type">int</span> world_size;</span><br><span class="line">  MPI_Comm_size(communicator, &amp;world_size);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (world_rank == root) &#123;</span><br><span class="line">    <span class="comment">// If we are the root process, send our data to everyone</span></span><br><span class="line">    <span class="type">int</span> i;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; world_size; i++) &#123;</span><br><span class="line">      <span class="keyword">if</span> (i != world_rank) &#123;</span><br><span class="line">        MPI_Send(data, count, datatype, i, <span class="number">0</span>, communicator);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// If we are a receiver process, receive the data from the root</span></span><br><span class="line">    MPI_Recv(data, count, datatype, root, <span class="number">0</span>, communicator, MPI_STATUS_IGNORE);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>** argv)</span> &#123;</span><br><span class="line">  MPI_Init(<span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">  <span class="type">int</span> world_rank;</span><br><span class="line">  MPI_Comm_rank(MPI_COMM_WORLD, &amp;world_rank);</span><br><span class="line"></span><br><span class="line">  <span class="type">int</span> data;</span><br><span class="line">  <span class="keyword">if</span> (world_rank == <span class="number">0</span>) &#123;</span><br><span class="line">    data = <span class="number">100</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Process 0 broadcasting data %d\n&quot;</span>, data);</span><br><span class="line">    my_bcast(&amp;data, <span class="number">1</span>, MPI_INT, <span class="number">0</span>, MPI_COMM_WORLD);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    my_bcast(&amp;data, <span class="number">1</span>, MPI_INT, <span class="number">0</span>, MPI_COMM_WORLD);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Process %d received data %d from root process\n&quot;</span>, world_rank, data);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  MPI_Finalize();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>ä¸Šè¿°çš„ç®—æ³•å‡½æ•°æ•ˆç‡ç‰¹åˆ«ä½ï¼å‡è®¾æ¯ä¸ªè¿›ç¨‹éƒ½åªæœ‰ä¸€ä¸ªã€Œè¾“å‡º&#x2F;è¾“å…¥ã€ç½‘ç»œè¿æ¥ã€‚æˆ‘ä»¬çš„æ–¹æ³•åªæ˜¯ä½¿ç”¨äº†è¿›ç¨‹0çš„ä¸€ä¸ªè¾“å‡ºè¿æ¥æ¥ä¼ é€’æ•°æ®ã€‚æ¯”è¾ƒèªæ˜çš„æ–¹æ³•æ˜¯ä½¿ç”¨ä¸€ä¸ªåŸºäºæ ‘çš„æ²Ÿé€šç®—æ³•å¯¹ç½‘ç»œè¿›è¡Œæ›´å¥½çš„åˆ©ç”¨</p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/06/MPI/image-20230406192458314.png"
                      class="" title="image-20230406192458314"
                >

<p>åœ¨ç¤ºæ„å›¾é‡Œï¼Œ<strong>è¿›ç¨‹0ä¸€å¼€å§‹ä¼ é€’æ•°æ®ç»™è¿›ç¨‹1</strong>ã€‚è·Ÿæˆ‘ä»¬ä¹‹å‰çš„ä¾‹å­ç±»ä¼¼ï¼Œ<strong>ç¬¬äºŒä¸ªé˜¶æ®µçš„æ—¶å€™è¿›ç¨‹0ä¾æ—§ä¼šæŠŠæ•°æ®ä¼ é€’ç»™è¿›ç¨‹2ã€‚è¿™ä¸ªä¾‹å­ä¸­ä¸åŒçš„æ˜¯è¿›ç¨‹1åœ¨ç¬¬äºŒé˜¶æ®µä¹Ÿä¼šä¼ é€’æ•°æ®ç»™è¿›ç¨‹3</strong>ã€‚åœ¨ç¬¬äºŒé˜¶æ®µï¼Œä¸¤ä¸ªç½‘ç»œè¿æ¥åœ¨åŒæ—¶å‘ç”Ÿäº†ã€‚åœ¨è¿™ä¸ªæ ‘å½¢ç®—æ³•é‡Œï¼Œèƒ½å¤Ÿåˆ©ç”¨çš„ç½‘ç»œè¿æ¥æ¯<strong>ä¸ªé˜¶æ®µéƒ½ä¼šæ¯”å‰ä¸€é˜¶æ®µç¿»ç•ª</strong>ï¼Œç›´åˆ°æ‰€æœ‰çš„è¿›ç¨‹æ¥å—åˆ°æ•°æ®ä¸ºæ­¢ã€‚</p>
<h2 id="MPI-Bcast-å’Œ-MPI-Send-ä»¥åŠ-MPI-Recv-çš„æ¯”è¾ƒ"><a href="#MPI-Bcast-å’Œ-MPI-Send-ä»¥åŠ-MPI-Recv-çš„æ¯”è¾ƒ" class="headerlink" title="MPI_Bcast å’Œ MPI_Send ä»¥åŠ MPI_Recv çš„æ¯”è¾ƒ"></a>MPI_Bcast å’Œ MPI_Send ä»¥åŠ MPI_Recv çš„æ¯”è¾ƒ</h2><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;mpi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;assert.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">my_bcast</span><span class="params">(<span class="type">void</span>* data, <span class="type">int</span> count, MPI_Datatype datatype, <span class="type">int</span> root,</span></span><br><span class="line"><span class="params">              MPI_Comm communicator)</span> &#123;</span><br><span class="line">  <span class="type">int</span> world_rank;</span><br><span class="line">  MPI_Comm_rank(communicator, &amp;world_rank);</span><br><span class="line">  <span class="type">int</span> world_size;</span><br><span class="line">  MPI_Comm_size(communicator, &amp;world_size);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (world_rank == root) &#123;</span><br><span class="line">    <span class="comment">// If we are the root process, send our data to everyone</span></span><br><span class="line">    <span class="type">int</span> i;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; world_size; i++) &#123;</span><br><span class="line">      <span class="keyword">if</span> (i != world_rank) &#123;</span><br><span class="line">        MPI_Send(data, count, datatype, i, <span class="number">0</span>, communicator);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// If we are a receiver process, receive the data from the root</span></span><br><span class="line">    MPI_Recv(data, count, datatype, root, <span class="number">0</span>, communicator, MPI_STATUS_IGNORE);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>** argv)</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (argc != <span class="number">3</span>) &#123;</span><br><span class="line">    <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;Usage: compare_bcast num_elements num_trials\n&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="type">int</span> num_elements = atoi(argv[<span class="number">1</span>]);</span><br><span class="line">  <span class="type">int</span> num_trials = atoi(argv[<span class="number">2</span>]);</span><br><span class="line"></span><br><span class="line">  MPI_Init(<span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">  <span class="type">int</span> world_rank;</span><br><span class="line">  MPI_Comm_rank(MPI_COMM_WORLD, &amp;world_rank);</span><br><span class="line"></span><br><span class="line">  <span class="type">double</span> total_my_bcast_time = <span class="number">0.0</span>;</span><br><span class="line">  <span class="type">double</span> total_mpi_bcast_time = <span class="number">0.0</span>;</span><br><span class="line">  <span class="type">int</span> i;</span><br><span class="line">  <span class="type">int</span>* data = (<span class="type">int</span>*)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="type">int</span>) * num_elements);</span><br><span class="line">  assert(data != <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; num_trials; i++) &#123;</span><br><span class="line">    <span class="comment">// Time my_bcast</span></span><br><span class="line">    <span class="comment">// Synchronize before starting timing</span></span><br><span class="line">    MPI_Barrier(MPI_COMM_WORLD);</span><br><span class="line">    total_my_bcast_time -= MPI_Wtime();</span><br><span class="line">    my_bcast(data, num_elements, MPI_INT, <span class="number">0</span>, MPI_COMM_WORLD);</span><br><span class="line">    <span class="comment">// Synchronize again before obtaining final time</span></span><br><span class="line">    MPI_Barrier(MPI_COMM_WORLD);</span><br><span class="line">    total_my_bcast_time += MPI_Wtime();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Time MPI_Bcast</span></span><br><span class="line">    MPI_Barrier(MPI_COMM_WORLD);</span><br><span class="line">    total_mpi_bcast_time -= MPI_Wtime();</span><br><span class="line">    MPI_Bcast(data, num_elements, MPI_INT, <span class="number">0</span>, MPI_COMM_WORLD);</span><br><span class="line">    MPI_Barrier(MPI_COMM_WORLD);</span><br><span class="line">    total_mpi_bcast_time += MPI_Wtime();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Print off timing information</span></span><br><span class="line">  <span class="keyword">if</span> (world_rank == <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Data size = %d, Trials = %d\n&quot;</span>, num_elements * (<span class="type">int</span>)<span class="keyword">sizeof</span>(<span class="type">int</span>),</span><br><span class="line">           num_trials);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Avg my_bcast time = %lf\n&quot;</span>, total_my_bcast_time / num_trials);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Avg MPI_Bcast time = %lf\n&quot;</span>, total_mpi_bcast_time / num_trials);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">free</span>(data);</span><br><span class="line">  MPI_Finalize();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>ä»£ç é‡Œçš„ <code>num_trials</code> æ˜¯ä¸€ä¸ªæŒ‡æ˜ä¸€å…±è¦è¿è¡Œå¤šå°‘æ¬¡å®éªŒçš„å˜é‡ã€‚æˆ‘ä»¬åˆ†åˆ«è®°å½•ä¸¤ä¸ªå‡½æ•°è¿è¡Œæ‰€éœ€çš„ç´¯åŠ æ—¶é—´ï¼Œå¹³å‡çš„æ—¶é—´ä¼šåœ¨ç¨‹åºç»“æŸçš„æ—¶å€™æ‰“å°å‡ºæ¥</p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/06/MPI/image-20230406201220958.png"
                      class="" title="image-20230406201220958"
                >

<p>å¯ä»¥çœ‹åˆ°ï¼Œ2ä¸ªè¿›ç¨‹è¿è¡Œçš„æ—¶å€™æ˜¯æ²¡æœ‰æ—¶é—´å·®å¼‚çš„ã€‚è¿™æ˜¯å› ä¸º <code>MPI_Bcast</code> çš„æ ‘ç®—æ³•åœ¨ä½¿ç”¨ä¸¤ä¸ªè¿›ç¨‹çš„æ—¶å€™å¹¶æ²¡æœ‰æä¾›é¢å¤–çš„ç½‘ç»œåˆ©ç”¨ç‡ã€‚ç„¶è€Œï¼Œè¿›ç¨‹æ•°é‡ç¨å¾®å¢åŠ åˆ°å³ä½¿åªæœ‰16ä¸ªçš„æ—¶å€™æˆ‘ä»¬ä¹Ÿå¯ä»¥çœ‹åˆ°æ˜æ˜¾çš„å·®å¼‚ã€‚</p>
<h1 id="MPI-Scatter-Gather-and-Allgather"><a href="#MPI-Scatter-Gather-and-Allgather" class="headerlink" title="MPI Scatter, Gather, and Allgather"></a>MPI Scatter, Gather, and Allgather</h1><h2 id="MPI-Scatter-çš„ä»‹ç»"><a href="#MPI-Scatter-çš„ä»‹ç»" class="headerlink" title="MPI_Scatter çš„ä»‹ç»"></a>MPI_Scatter çš„ä»‹ç»</h2><p><code>MPI_Scatter</code> æ˜¯ä¸€ä¸ªè·Ÿ <code>MPI_Bcast</code> ç±»ä¼¼çš„é›†ä½“é€šä¿¡æœºåˆ¶ã€‚<code>MPI_Scatter</code> çš„æ“ä½œä¼šè®¾è®¡ä¸€ä¸ªæŒ‡å®šçš„æ ¹è¿›ç¨‹ï¼Œæ ¹è¿›ç¨‹ä¼šå°†æ•°æ®å‘é€åˆ° communicator é‡Œé¢çš„æ‰€æœ‰è¿›ç¨‹ã€‚<code>MPI_Bcast</code> å’Œ <code>MPI_Scatter</code> çš„ä¸»è¦åŒºåˆ«å¾ˆå°ä½†æ˜¯å¾ˆé‡è¦ã€‚<code>MPI_Bcast</code> ç»™æ¯ä¸ªè¿›ç¨‹å‘é€çš„æ˜¯<em>åŒæ ·</em>çš„æ•°æ®ï¼Œ<strong>ç„¶è€Œ <code>MPI_Scatter</code> ç»™æ¯ä¸ªè¿›ç¨‹å‘é€çš„æ˜¯<em>ä¸€ä¸ªæ•°ç»„çš„ä¸€éƒ¨åˆ†æ•°æ®</em></strong>ã€‚ä¸‹å›¾è¿›ä¸€æ­¥å±•ç¤ºäº†è¿™ä¸ªåŒºåˆ«ã€‚</p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/06/MPI/image-20230406201727561.png"
                      class="" title="image-20230406201727561"
                >

<p>åœ¨å›¾ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œ<code>MPI_Bcast</code> åœ¨æ ¹è¿›ç¨‹ä¸Šæ¥æ”¶ä¸€ä¸ªå•ç‹¬çš„æ•°æ®å…ƒç´ ï¼ˆçº¢è‰²çš„æ–¹å—ï¼‰ï¼Œç„¶åæŠŠå®ƒå¤åˆ¶åˆ°æ‰€æœ‰å…¶ä»–çš„è¿›ç¨‹ã€‚<code>MPI_Scatter</code> æ¥æ”¶ä¸€ä¸ªæ•°ç»„ï¼Œå¹¶æŠŠå…ƒç´ æŒ‰è¿›ç¨‹çš„<strong>ç§©</strong>åˆ†å‘å‡ºå»ã€‚ç¬¬ä¸€ä¸ªå…ƒç´ ï¼ˆçº¢è‰²æ–¹å—ï¼‰å‘å¾€è¿›ç¨‹0ï¼Œç¬¬äºŒä¸ªå…ƒç´ ï¼ˆç»¿è‰²æ–¹å—ï¼‰å‘å¾€è¿›ç¨‹1ï¼Œä»¥æ­¤ç±»æ¨ã€‚å°½ç®¡æ ¹è¿›ç¨‹ï¼ˆè¿›ç¨‹0ï¼‰æ‹¥æœ‰æ•´ä¸ªæ•°ç»„çš„æ‰€æœ‰å…ƒç´ ï¼Œ<code>MPI_Scatter</code> è¿˜æ˜¯ä¼šæŠŠæ­£ç¡®çš„å±äºè¿›ç¨‹0çš„å…ƒç´ æ”¾åˆ°è¿™ä¸ªè¿›ç¨‹çš„æ¥æ”¶ç¼“å­˜ä¸­ã€‚</p>
<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">MPI_Scatter(</span><br><span class="line">    <span class="type">void</span>* send_data,				<span class="comment">//æ ¹è¿›ç¨‹ä¸Šçš„ä¸€ä¸ªæ•°æ®æ•°ç»„</span></span><br><span class="line">    <span class="type">int</span> send_count,					<span class="comment">//å‘é€ç»™æ¯ä¸ªè¿›ç¨‹çš„æ•°æ®æ•°é‡.ä¸€èˆ¬æ¥è¯´send_countä¼šç­‰äºæ•°ç»„çš„é•¿åº¦é™¤ä»¥è¿›ç¨‹çš„æ•°é‡</span></span><br><span class="line">    MPI_Datatype send_datatype,		<span class="comment">//æ•°æ®ç±»å‹</span></span><br><span class="line">    <span class="type">void</span>* recv_data,				<span class="comment">//ç¼“å­˜ï¼šä¿å­˜recv_countä¸ªrecv_datatypeæ•°æ®ç±»å‹çš„å…ƒç´ </span></span><br><span class="line">    <span class="type">int</span> recv_count,</span><br><span class="line">    MPI_Datatype recv_datatype,</span><br><span class="line">    <span class="type">int</span> root,						<span class="comment">//æ ¹è¿›ç¨‹</span></span><br><span class="line">    MPI_Comm communicator)			<span class="comment">//é€šè®¯å™¨</span></span><br></pre></td></tr></table></figure></div>

<h2 id="MPI-Gather-çš„ä»‹ç»"><a href="#MPI-Gather-çš„ä»‹ç»" class="headerlink" title="MPI_Gather çš„ä»‹ç»"></a>MPI_Gather çš„ä»‹ç»</h2><p><code>MPI_Gather</code> è·Ÿ <code>MPI_Scatter</code> æ˜¯ç›¸åçš„ã€‚**<code>MPI_Gather</code> ä»å¥½å¤šè¿›ç¨‹é‡Œé¢æ”¶é›†æ•°æ®åˆ°ä¸€ä¸ªè¿›ç¨‹ä¸Šé¢**è€Œä¸æ˜¯ä»ä¸€ä¸ªè¿›ç¨‹åˆ†å‘æ•°æ®åˆ°å¤šä¸ªè¿›ç¨‹ã€‚è¿™ä¸ªæœºåˆ¶å¯¹å¾ˆå¤šå¹³è¡Œç®—æ³•å¾ˆæœ‰ç”¨ï¼Œæ¯”å¦‚å¹¶è¡Œçš„æ’åºå’Œæœç´¢ã€‚ä¸‹å›¾æ˜¯è¿™ä¸ªç®—æ³•çš„ä¸€ä¸ªç¤ºä¾‹ã€‚</p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/06/MPI/image-20230406202312516.png"
                      class="" title="image-20230406202312516"
                >

<p><code>MPI_Gather</code>çš„å‡½æ•°åŸå‹è·Ÿ<code>MPI_Scatter</code>é•¿çš„ä¸€æ ·ï¼š</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">MPI_Gather(</span><br><span class="line">    void* send_data,</span><br><span class="line">    int send_count,</span><br><span class="line">    MPI_Datatype send_datatype,</span><br><span class="line">    void* recv_data,</span><br><span class="line">    int recv_count,</span><br><span class="line">    MPI_Datatype recv_datatype,</span><br><span class="line">    int root,</span><br><span class="line">    MPI_Comm communicator)</span><br></pre></td></tr></table></figure></div>

<p>åœ¨<code>MPI_Gather</code>ä¸­ï¼Œåªæœ‰æ ¹è¿›ç¨‹éœ€è¦ä¸€ä¸ªæœ‰æ•ˆçš„æ¥æ”¶ç¼“å­˜ã€‚æ‰€æœ‰å…¶ä»–çš„è°ƒç”¨è¿›ç¨‹å¯ä»¥ä¼ é€’<code>NULL</code>ç»™<code>recv_data</code>ã€‚å¦å¤–ï¼Œåˆ«å¿˜è®°<em>recv_count</em>å‚æ•°æ˜¯ä»<em>æ¯ä¸ªè¿›ç¨‹</em>æ¥æ”¶åˆ°çš„æ•°æ®æ•°é‡ï¼Œè€Œä¸æ˜¯æ‰€æœ‰è¿›ç¨‹çš„æ•°æ®æ€»é‡ä¹‹å’Œã€‚</p>
<h2 id="ä½¿ç”¨-MPI-Scatter-å’Œ-MPI-Gather-æ¥è®¡ç®—å¹³å‡æ•°"><a href="#ä½¿ç”¨-MPI-Scatter-å’Œ-MPI-Gather-æ¥è®¡ç®—å¹³å‡æ•°" class="headerlink" title="ä½¿ç”¨ MPI_Scatter å’Œ MPI_Gather æ¥è®¡ç®—å¹³å‡æ•°"></a>ä½¿ç”¨ <code>MPI_Scatter</code> å’Œ <code>MPI_Gather</code> æ¥è®¡ç®—å¹³å‡æ•°</h2><p>æä¾›äº†ä¸€ä¸ªç”¨æ¥è®¡ç®—æ•°ç»„é‡Œé¢æ‰€æœ‰æ•°å­—çš„å¹³å‡æ•°çš„æ ·ä¾‹ç¨‹åºï¼ˆ<a class="link"   target="_blank" rel="noopener" href="https://github.com/mpitutorial/mpitutorial/tree/gh-pages/tutorials/mpi-scatter-gather-and-allgather/code/avg.c" >avg.c <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>ï¼‰ã€‚å°½ç®¡è¿™ä¸ªç¨‹åºååˆ†ç®€å•ï¼Œä½†æ˜¯å®ƒå±•ç¤ºäº†æˆ‘ä»¬å¦‚ä½•ä½¿ç”¨MPIæ¥æŠŠå·¥ä½œæ‹†åˆ†åˆ°ä¸åŒçš„è¿›ç¨‹ä¸Šï¼Œæ¯ä¸ªè¿›ç¨‹å¯¹ä¸€éƒ¨åˆ†æ•°æ®è¿›è¡Œè®¡ç®—ï¼Œç„¶åå†æŠŠæ¯ä¸ªéƒ¨åˆ†è®¡ç®—å‡ºæ¥çš„ç»“æœæ±‡é›†æˆæœ€ç»ˆçš„ç­”æ¡ˆã€‚è¿™ä¸ªç¨‹åºæœ‰ä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š</p>
<ol>
<li>åœ¨æ ¹è¿›ç¨‹ï¼ˆè¿›ç¨‹0ï¼‰ä¸Šç”Ÿæˆä¸€ä¸ªå……æ»¡éšæœºæ•°å­—çš„æ•°ç»„ã€‚</li>
<li>æŠŠæ‰€æœ‰æ•°å­—ç”¨<code>MPI_Scatter</code>åˆ†å‘ç»™æ¯ä¸ªè¿›ç¨‹ï¼Œæ¯ä¸ªè¿›ç¨‹å¾—åˆ°çš„åŒæ ·å¤šçš„æ•°å­—ã€‚</li>
<li>æ¯ä¸ªè¿›ç¨‹è®¡ç®—å®ƒä»¬å„è‡ªå¾—åˆ°çš„æ•°å­—çš„å¹³å‡æ•°ã€‚</li>
<li>æ ¹è¿›ç¨‹æ”¶é›†æ‰€æœ‰çš„å¹³å‡æ•°ï¼Œç„¶åè®¡ç®—è¿™ä¸ªå¹³å‡æ•°çš„å¹³å‡æ•°ï¼Œå¾—å‡ºæœ€åç»“æœã€‚</li>
</ol>
<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;time.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;mpi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;assert.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Creates an array of random numbers. Each number has a value from 0 - 1</span></span><br><span class="line"><span class="type">float</span> *<span class="title function_">create_rand_nums</span><span class="params">(<span class="type">int</span> num_elements)</span> &#123;</span><br><span class="line">  <span class="type">float</span> *rand_nums = (<span class="type">float</span> *)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="type">float</span>) * num_elements);</span><br><span class="line">  assert(rand_nums != <span class="literal">NULL</span>);</span><br><span class="line">  <span class="type">int</span> i;</span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; num_elements; i++) &#123;</span><br><span class="line">    rand_nums[i] = (rand() / (<span class="type">float</span>)RAND_MAX);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> rand_nums;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Computes the average of an array of numbers</span></span><br><span class="line"><span class="type">float</span> <span class="title function_">compute_avg</span><span class="params">(<span class="type">float</span> *<span class="built_in">array</span>, <span class="type">int</span> num_elements)</span> &#123;</span><br><span class="line">  <span class="type">float</span> sum = <span class="number">0.f</span>;</span><br><span class="line">  <span class="type">int</span> i;</span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; num_elements; i++) &#123;</span><br><span class="line">    sum += <span class="built_in">array</span>[i];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> sum / num_elements;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>** argv)</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (argc != <span class="number">2</span>) &#123;</span><br><span class="line">    <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;Usage: avg num_elements_per_proc\n&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="type">int</span> num_elements_per_proc = atoi(argv[<span class="number">1</span>]);</span><br><span class="line">  <span class="comment">// Seed the random number generator to get different results each time</span></span><br><span class="line">  srand(time(<span class="literal">NULL</span>));</span><br><span class="line"></span><br><span class="line">  MPI_Init(<span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">  <span class="type">int</span> world_rank;</span><br><span class="line">  MPI_Comm_rank(MPI_COMM_WORLD, &amp;world_rank);</span><br><span class="line">  <span class="type">int</span> world_size;</span><br><span class="line">  MPI_Comm_size(MPI_COMM_WORLD, &amp;world_size);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Create a random array of elements on the root process. Its total</span></span><br><span class="line">  <span class="comment">// size will be the number of elements per process times the number</span></span><br><span class="line">  <span class="comment">// of processes</span></span><br><span class="line">  <span class="type">float</span> *rand_nums = <span class="literal">NULL</span>;</span><br><span class="line">  <span class="keyword">if</span> (world_rank == <span class="number">0</span>) &#123;</span><br><span class="line">    rand_nums = create_rand_nums(num_elements_per_proc * world_size);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// For each process, create a buffer that will hold a subset of the entire</span></span><br><span class="line">  <span class="comment">// array</span></span><br><span class="line">  <span class="type">float</span> *sub_rand_nums = (<span class="type">float</span> *)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="type">float</span>) * num_elements_per_proc);</span><br><span class="line">  assert(sub_rand_nums != <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Scatter the random numbers from the root process to all processes in</span></span><br><span class="line">  <span class="comment">// the MPI world</span></span><br><span class="line">  MPI_Scatter(rand_nums, num_elements_per_proc, MPI_FLOAT, sub_rand_nums,</span><br><span class="line">              num_elements_per_proc, MPI_FLOAT, <span class="number">0</span>, MPI_COMM_WORLD);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Compute the average of your subset</span></span><br><span class="line">  <span class="type">float</span> sub_avg = compute_avg(sub_rand_nums, num_elements_per_proc);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Gather all partial averages down to the root process</span></span><br><span class="line">  <span class="type">float</span> *sub_avgs = <span class="literal">NULL</span>;</span><br><span class="line">  <span class="keyword">if</span> (world_rank == <span class="number">0</span>) &#123;</span><br><span class="line">    sub_avgs = (<span class="type">float</span> *)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="type">float</span>) * world_size);</span><br><span class="line">    assert(sub_avgs != <span class="literal">NULL</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  MPI_Gather(&amp;sub_avg, <span class="number">1</span>, MPI_FLOAT, sub_avgs, <span class="number">1</span>, MPI_FLOAT, <span class="number">0</span>, MPI_COMM_WORLD);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Now that we have all of the partial averages on the root, compute the</span></span><br><span class="line">  <span class="comment">// total average of all numbers. Since we are assuming each process computed</span></span><br><span class="line">  <span class="comment">// an average across an equal amount of elements, this computation will</span></span><br><span class="line">  <span class="comment">// produce the correct answer.</span></span><br><span class="line">  <span class="keyword">if</span> (world_rank == <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="type">float</span> avg = compute_avg(sub_avgs, world_size);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Avg of all elements is %f\n&quot;</span>, avg);</span><br><span class="line">    <span class="comment">// Compute the average across the original data for comparison</span></span><br><span class="line">    <span class="type">float</span> original_data_avg =</span><br><span class="line">      compute_avg(rand_nums, num_elements_per_proc * world_size);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Avg computed across original data is %f\n&quot;</span>, original_data_avg);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Clean up</span></span><br><span class="line">  <span class="keyword">if</span> (world_rank == <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="built_in">free</span>(rand_nums);</span><br><span class="line">    <span class="built_in">free</span>(sub_avgs);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">free</span>(sub_rand_nums);</span><br><span class="line"></span><br><span class="line">  MPI_Barrier(MPI_COMM_WORLD);</span><br><span class="line">  MPI_Finalize();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>ä»£ç å¼€å¤´æ ¹è¿›ç¨‹åˆ›å»ºé‡Œä¸€ä¸ªéšæœºæ•°çš„æ•°ç»„ã€‚å½“<code>MPI_Scatter</code>è¢«è°ƒç”¨çš„æ—¶å€™ï¼Œæ¯ä¸ªè¿›ç¨‹ç°åœ¨éƒ½æŒæœ‰<code>elements_per_proc</code>ä¸ªåŸå§‹æ•°æ®é‡Œé¢çš„å…ƒç´ ã€‚æ¯ä¸ªè¿›ç¨‹è®¡ç®—å­æ•°ç»„çš„å¹³å‡æ•°ï¼Œç„¶åæ ¹è¿›ç¨‹æ”¶é›†è¿™äº›å¹³å‡æ•°ã€‚ç„¶åæ€»çš„å¹³å‡æ•°å°±å¯ä»¥åœ¨è¿™ä¸ªå°çš„å¤šçš„å¹³å‡æ•°æ•°ç»„é‡Œé¢è¢«è®¡ç®—å‡ºæ¥ã€‚</p>
<h2 id="MPI-Allgather-ä»¥åŠä¿®æ”¹åçš„å¹³å‡ç¨‹åº"><a href="#MPI-Allgather-ä»¥åŠä¿®æ”¹åçš„å¹³å‡ç¨‹åº" class="headerlink" title="MPI_Allgather ä»¥åŠä¿®æ”¹åçš„å¹³å‡ç¨‹åº"></a>MPI_Allgather ä»¥åŠä¿®æ”¹åçš„å¹³å‡ç¨‹åº</h2><p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬è®²è§£äº†ä¸¤ä¸ªç”¨æ¥æ“ä½œ<em>å¤šå¯¹ä¸€</em>æˆ–è€…<em>ä¸€å¯¹å¤š</em>é€šä¿¡æ¨¡å¼çš„MPIæ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯è¯´å¤šä¸ªè¿›ç¨‹è¦ä¹ˆå‘ä¸€ä¸ªè¿›ç¨‹å‘é€æ•°æ®ï¼Œè¦ä¹ˆä»ä¸€ä¸ªè¿›ç¨‹æ¥æ”¶æ•°æ®ã€‚å¾ˆå¤šæ—¶å€™å‘é€å¤šä¸ªå…ƒç´ åˆ°å¤šä¸ªè¿›ç¨‹ä¹Ÿå¾ˆæœ‰ç”¨<strong>ï¼ˆä¹Ÿå°±æ˜¯<em>å¤šå¯¹å¤š</em>é€šä¿¡æ¨¡å¼ï¼‰</strong>ã€‚<code>MPI_Allgather</code>å°±æ˜¯è¿™ä¸ªä½œç”¨ã€‚</p>
<p>å¯¹äºåˆ†å‘åœ¨æ‰€æœ‰è¿›ç¨‹ä¸Šçš„ä¸€ç»„æ•°æ®æ¥è¯´ï¼Œ**<code>MPI_Allgather</code>ä¼šæ”¶é›†æ‰€æœ‰æ•°æ®åˆ°æ‰€æœ‰è¿›ç¨‹ä¸Šã€‚**ä»æœ€åŸºç¡€çš„è§’åº¦æ¥çœ‹ï¼Œ<code>MPI_Allgather</code>ç›¸å½“äºä¸€ä¸ª<code>MPI_Gather</code>æ“ä½œä¹‹åè·Ÿç€ä¸€ä¸ª<code>MPI_Bcast</code>æ“ä½œã€‚ä¸‹é¢çš„ç¤ºæ„å›¾æ˜¾ç¤ºäº†<code>MPI_Allgather</code>è°ƒç”¨ä¹‹åæ•°æ®æ˜¯å¦‚ä½•åˆ†å¸ƒçš„ã€‚</p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/06/MPI/image-20230406203808578.png"
                      class="" title="image-20230406203808578"
                >

<p>å°±è·Ÿ<code>MPI_Gather</code>ä¸€æ ·ï¼Œæ¯ä¸ªè¿›ç¨‹ä¸Šçš„å…ƒç´ æ˜¯æ ¹æ®ä»–ä»¬çš„ç§©ä¸ºé¡ºåºè¢«æ”¶é›†èµ·æ¥çš„ï¼Œåªä¸è¿‡è¿™æ¬¡æ˜¯æ”¶é›†åˆ°äº†æ‰€æœ‰è¿›ç¨‹ä¸Šé¢ã€‚åªä¸è¿‡<code>MPI_Allgather</code>ä¸éœ€è¦rootè¿™ä¸ªå‚æ•°æ¥æŒ‡å®šæ ¹èŠ‚ç‚¹ã€‚</p>
<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">MPI_Allgather(</span><br><span class="line">    <span class="type">void</span>* send_data,</span><br><span class="line">    <span class="type">int</span> send_count,</span><br><span class="line">    MPI_Datatype send_datatype,</span><br><span class="line">    <span class="type">void</span>* recv_data,</span><br><span class="line">    <span class="type">int</span> recv_count,</span><br><span class="line">    MPI_Datatype recv_datatype,</span><br><span class="line">    MPI_Comm communicator)</span><br></pre></td></tr></table></figure></div>

<blockquote>
<p>æŠŠè®¡ç®—å¹³å‡æ•°çš„ä»£ç ä¿®æ”¹æˆäº†ä½¿ç”¨<code>MPI_Allgather</code>æ¥è®¡ç®—</p>
</blockquote>
<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;time.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;mpi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;assert.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Creates an array of random numbers. Each number has a value from 0 - 1</span></span><br><span class="line"><span class="type">float</span> *<span class="title function_">create_rand_nums</span><span class="params">(<span class="type">int</span> num_elements)</span> &#123;</span><br><span class="line">  <span class="type">float</span> *rand_nums = (<span class="type">float</span> *)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="type">float</span>) * num_elements);</span><br><span class="line">  assert(rand_nums != <span class="literal">NULL</span>);</span><br><span class="line">  <span class="type">int</span> i;</span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; num_elements; i++) &#123;</span><br><span class="line">    rand_nums[i] = (rand() / (<span class="type">float</span>)RAND_MAX);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> rand_nums;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Computes the average of an array of numbers</span></span><br><span class="line"><span class="type">float</span> <span class="title function_">compute_avg</span><span class="params">(<span class="type">float</span> *<span class="built_in">array</span>, <span class="type">int</span> num_elements)</span> &#123;</span><br><span class="line">  <span class="type">float</span> sum = <span class="number">0.f</span>;</span><br><span class="line">  <span class="type">int</span> i;</span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; num_elements; i++) &#123;</span><br><span class="line">    sum += <span class="built_in">array</span>[i];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> sum / num_elements;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>** argv)</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (argc != <span class="number">2</span>) &#123;</span><br><span class="line">    <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;Usage: avg num_elements_per_proc\n&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="type">int</span> num_elements_per_proc = atoi(argv[<span class="number">1</span>]);</span><br><span class="line">  <span class="comment">// Seed the random number generator to get different results each time</span></span><br><span class="line">  srand(time(<span class="literal">NULL</span>));</span><br><span class="line"></span><br><span class="line">  MPI_Init(<span class="literal">NULL</span>, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">  <span class="type">int</span> world_rank;</span><br><span class="line">  MPI_Comm_rank(MPI_COMM_WORLD, &amp;world_rank);</span><br><span class="line">  <span class="type">int</span> world_size;</span><br><span class="line">  MPI_Comm_size(MPI_COMM_WORLD, &amp;world_size);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Create a random array of elements on the root process. Its total</span></span><br><span class="line">  <span class="comment">// size will be the number of elements per process times the number</span></span><br><span class="line">  <span class="comment">// of processes</span></span><br><span class="line">  <span class="type">float</span> *rand_nums = <span class="literal">NULL</span>;</span><br><span class="line">  <span class="keyword">if</span> (world_rank == <span class="number">0</span>) &#123;</span><br><span class="line">    rand_nums = create_rand_nums(num_elements_per_proc * world_size);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// For each process, create a buffer that will hold a subset of the entire</span></span><br><span class="line">  <span class="comment">// array</span></span><br><span class="line">  <span class="type">float</span> *sub_rand_nums = (<span class="type">float</span> *)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="type">float</span>) * num_elements_per_proc);</span><br><span class="line">  assert(sub_rand_nums != <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Scatter the random numbers from the root process to all processes in</span></span><br><span class="line">  <span class="comment">// the MPI world</span></span><br><span class="line">  MPI_Scatter(rand_nums, num_elements_per_proc, MPI_FLOAT, sub_rand_nums,</span><br><span class="line">              num_elements_per_proc, MPI_FLOAT, <span class="number">0</span>, MPI_COMM_WORLD);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Compute the average of your subset</span></span><br><span class="line">  <span class="type">float</span> sub_avg = compute_avg(sub_rand_nums, num_elements_per_proc);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Gather all partial averages down to all the processes</span></span><br><span class="line">  <span class="type">float</span> *sub_avgs = (<span class="type">float</span> *)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="type">float</span>) * world_size);</span><br><span class="line">  assert(sub_avgs != <span class="literal">NULL</span>);</span><br><span class="line">  MPI_Allgather(&amp;sub_avg, <span class="number">1</span>, MPI_FLOAT, sub_avgs, <span class="number">1</span>, MPI_FLOAT, MPI_COMM_WORLD);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Now that we have all of the partial averages, compute the</span></span><br><span class="line">  <span class="comment">// total average of all numbers. Since we are assuming each process computed</span></span><br><span class="line">  <span class="comment">// an average across an equal amount of elements, this computation will</span></span><br><span class="line">  <span class="comment">// produce the correct answer.</span></span><br><span class="line">  <span class="type">float</span> avg = compute_avg(sub_avgs, world_size);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Avg of all elements from proc %d is %f\n&quot;</span>, world_rank, avg);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Clean up</span></span><br><span class="line">  <span class="keyword">if</span> (world_rank == <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="built_in">free</span>(rand_nums);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">free</span>(sub_avgs);</span><br><span class="line">  <span class="built_in">free</span>(sub_rand_nums);</span><br><span class="line"></span><br><span class="line">  MPI_Barrier(MPI_COMM_WORLD);</span><br><span class="line">  MPI_Finalize();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h1 id="ä½¿ç”¨MPIè®¡ç®—å¹¶è¡Œæ’å"><a href="#ä½¿ç”¨MPIè®¡ç®—å¹¶è¡Œæ’å" class="headerlink" title="ä½¿ç”¨MPIè®¡ç®—å¹¶è¡Œæ’å"></a>ä½¿ç”¨MPIè®¡ç®—å¹¶è¡Œæ’å</h1><h2 id="å¹¶è¡Œæ’å-é—®é¢˜æ¦‚è¿°"><a href="#å¹¶è¡Œæ’å-é—®é¢˜æ¦‚è¿°" class="headerlink" title="å¹¶è¡Œæ’å - é—®é¢˜æ¦‚è¿°"></a>å¹¶è¡Œæ’å - é—®é¢˜æ¦‚è¿°</h2><p>å½“æ¯ä¸€ä¸ªè¿›ç¨‹éƒ½åœ¨å…¶æœ¬åœ°å†…å­˜ä¸­å­˜å‚¨äº†ä¸€ä¸ªæ•°ï¼Œæ‰€æœ‰è¿›ç¨‹ä¸­å­˜å‚¨çš„æ•°å­—æ„æˆäº†ä¸€ä¸ª<strong>æ•°å­—é›†åˆ</strong>ï¼ˆset of numbersï¼‰ï¼Œäº†è§£è¯¥æ•°ç›¸å¯¹äºæ•´ä¸ªæ•°å­—é›†åˆçš„é¡ºåºæ˜¯æœ‰ç”¨çš„ã€‚ä¾‹å¦‚ï¼Œç”¨æˆ·å¯èƒ½æ­£åœ¨å¯¹MPIç¾¤é›†ä¸­çš„å¤„ç†å™¨è¿›è¡ŒåŸºå‡†æµ‹è¯•ï¼Œå¹¶æƒ³çŸ¥é“æ¯ä¸ªå¤„ç†å™¨ç›¸å¯¹äºå…¶ä»–å¤„ç†å™¨æœ‰å¤šå¿«ã€‚è¿™ä¸ªä¿¡æ¯å¯ç”¨äºå®‰æ’ã€è°ƒåº¦ä»»åŠ¡ç­‰ã€‚å¯ä»¥æƒ³è±¡ï¼Œå¦‚æœæ‰€æœ‰å…¶ä»–æ•°å­—åˆ†æ•£åœ¨å„ä¸ªè¿›ç¨‹ä¸­ï¼Œé‚£ä¹ˆå¾ˆéš¾æ‰¾å‡ºä¸€ä¸ªæ•°å­—ç›¸å¯¹äºæ‰€æœ‰å…¶ä»–æ•°å­—çš„é¡ºåºã€‚è¿™ä¸ªå¹¶è¡Œæ’åé—®é¢˜æ˜¯æˆ‘ä»¬åœ¨æœ¬è¯¾ä¸­è¦è§£å†³çš„é—®é¢˜ã€‚</p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/06/MPI/image-20230406204451384.png"
                      class="" title="image-20230406204451384"
                >

<p>å›¾ç¤ºä¸­çš„è¿›ç¨‹ï¼ˆæ ‡è®°ä¸º0åˆ°3ï¼‰å¼€å§‹æ—¶æœ‰å››ä¸ªæ•°å­—â€”â€” 5ã€2ã€7å’Œ4ã€‚ç„¶åï¼Œå¹¶è¡Œæ’åç®—æ³•ç®—å‡ºè¿›ç¨‹1åœ¨æ•°å­—é›†åˆä¸­çš„æ’åä¸º0ï¼ˆå³ç¬¬ä¸€ä¸ªæ•°å­—ï¼‰ï¼Œè¿›ç¨‹3æ’åä¸º1ï¼Œè¿›ç¨‹0æ’åä¸º2ï¼Œè¿›ç¨‹2æ’åœ¨æ•´ä¸ªæ•°å­—é›†åˆçš„æœ€åã€‚</p>
<h2 id="å¹¶è¡Œæ’åAPIå®šä¹‰"><a href="#å¹¶è¡Œæ’åAPIå®šä¹‰" class="headerlink" title="å¹¶è¡Œæ’åAPIå®šä¹‰"></a>å¹¶è¡Œæ’åAPIå®šä¹‰</h2><p>åœ¨æ·±å…¥ç ”ç©¶å¹¶è¡Œæ’åé—®é¢˜ä¹‹å‰ï¼Œè®©æˆ‘ä»¬é¦–å…ˆç¡®å®šå‡½æ•°çš„è¡Œä¸ºæ–¹å¼ã€‚æˆ‘ä»¬çš„å‡½æ•°éœ€è¦åœ¨æ¯ä¸ªè¿›ç¨‹ä¸Šå–ä¸€ä¸ªæ•°å­—ï¼Œå¹¶è¿”å›å…¶ç›¸å¯¹äºæ‰€æœ‰å…¶ä»–è¿›ç¨‹ä¸­çš„æ•°å­—çš„æ’åã€‚ä¸æ­¤åŒæ—¶ï¼Œæˆ‘ä»¬å°†éœ€è¦å…¶ä»–å„ç§ä¿¡æ¯ï¼Œä¾‹å¦‚æ­£åœ¨ä½¿ç”¨çš„é€šè®¯å™¨ï¼ˆcommunicatorï¼‰ä»¥åŠè¢«æ’åçš„æ•°å­—çš„æ•°æ®ç±»å‹ã€‚ ç»™å®šè¿™ä¸ªå‡½æ•°å®šä¹‰åï¼Œæˆ‘ä»¬çš„æ’åå‡½æ•°åŸå‹å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">TMPI_Rank(</span><br><span class="line">    <span class="type">void</span> *send_data,				<span class="comment">//è¿›ç¨‹çš„æ•°æ®</span></span><br><span class="line">    <span class="type">void</span> *recv_data,				<span class="comment">//æ’å</span></span><br><span class="line">    MPI_Datatype datatype,</span><br><span class="line">    MPI_Comm comm)					<span class="comment">//é€šè®¯å™¨</span></span><br></pre></td></tr></table></figure></div>

<blockquote>
<p><strong>æ³¨æ„</strong> - MPIæ ‡å‡†æ˜ç¡®æŒ‡å‡ºï¼Œç”¨æˆ·ä¸åº”ä»¥ <code>MPI</code> èµ·å¤´å‘½åè‡ªå·±çš„å‡½æ•°ï¼Œå¦‚ <code>MPI_&lt;something&gt;</code>ï¼Œä»¥é¿å…å°†ç”¨æˆ·å‡½æ•°ä¸MPIæ ‡å‡†æœ¬èº«çš„å‡½æ•°æ··æ·†ã€‚ å› æ­¤ï¼Œåœ¨è¿™äº›æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†åœ¨å‡½æ•°å‰é¢åŠ ä¸Š <code>T</code>ã€‚</p>
</blockquote>
<h2 id="è§£å†³å¹¶è¡Œæ’åé—®é¢˜"><a href="#è§£å†³å¹¶è¡Œæ’åé—®é¢˜" class="headerlink" title="è§£å†³å¹¶è¡Œæ’åé—®é¢˜"></a>è§£å†³å¹¶è¡Œæ’åé—®é¢˜</h2><p>è§£å†³å¹¶è¡Œæ’åé—®é¢˜çš„<strong>ç¬¬ä¸€æ­¥æ˜¯å¯¹æ‰€æœ‰è¿›ç¨‹ä¸­çš„æ•°å­—è¿›è¡Œæ’åº</strong>ã€‚ è¿™ä¸€ç‚¹å¿…é¡»åšåˆ°ï¼Œä»¥ä¾¿æˆ‘ä»¬æ‰¾åˆ°æ•´ä¸ªæ•°å­—é›†ä¸­æ¯ä¸ªæ•°å­—çš„æ’åã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡å¤šç§æ–¹å¼æ¥å®ç°è¿™ä¸€ç›®æ ‡ã€‚æœ€ç®€å•çš„æ–¹æ³•æ˜¯å°†æ‰€æœ‰æ•°å­—æ”¶é›†åˆ°ä¸€ä¸ªè¿›ç¨‹ä¸­å¹¶å¯¹æ•°å­—è¿›è¡Œæ’åºã€‚åœ¨ç¤ºä¾‹ä»£ç (<a class="link"   target="_blank" rel="noopener" href="https://github.com/mpitutorial/mpitutorial/tree/gh-pages/tutorials/performing-parallel-rank-with-mpi/code/tmpi_rank.c" >tmpi_rank.c <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>)ä¸­ï¼Œ<code>gather_numbers_to_root</code> å‡½æ•°è´Ÿè´£å°†æ‰€æœ‰æ•°å­—æ”¶é›†åˆ°æ ¹è¿›ç¨‹ï¼ˆroot processï¼‰ã€‚</p>
<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¸ºè¿›ç¨‹0çš„TMPI_Rankæ”¶é›†æ•°å­—ã€‚ä¸ºMPIçš„æ•°æ®ç±»å‹åˆ†é…ç©ºé—´</span></span><br><span class="line"><span class="comment">// å¯¹è¿›ç¨‹0è¿”å› void * æŒ‡å‘çš„ç¼“å†²åŒº</span></span><br><span class="line"><span class="comment">// å¯¹æ‰€æœ‰å…¶ä»–è¿›ç¨‹è¿”å›NULL</span></span><br><span class="line"><span class="type">void</span> *<span class="title function_">gather_numbers_to_root</span><span class="params">(<span class="type">void</span> *number, MPI_Datatype datatype,</span></span><br><span class="line"><span class="params">                             MPI_Comm comm)</span> &#123;</span><br><span class="line">  <span class="type">int</span> comm_rank, comm_size;</span><br><span class="line">  MPI_Comm_rank(comm, &amp;comm_rank);</span><br><span class="line">  MPI_Comm_size(comm, &amp;comm_size);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// åœ¨æ ¹è¿›ç¨‹ä¸Šåˆ†é…ä¸€ä¸ªæ•°ç»„</span></span><br><span class="line">  <span class="comment">// æ•°ç»„å¤§å°å–å†³äºæ‰€ç”¨çš„MPIæ•°æ®ç±»å‹</span></span><br><span class="line">  <span class="type">int</span> datatype_size;</span><br><span class="line">  MPI_Type_size(datatype, &amp;datatype_size);</span><br><span class="line">  <span class="type">void</span> *gathered_numbers;</span><br><span class="line">  <span class="keyword">if</span> (comm_rank == <span class="number">0</span>) &#123;</span><br><span class="line">    gathered_numbers = <span class="built_in">malloc</span>(datatype_size * comm_size);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// åœ¨æ ¹è¿›ç¨‹ä¸Šæ”¶é›†æ‰€æœ‰æ•°å­—</span></span><br><span class="line">  MPI_Gather(number, <span class="number">1</span>, datatype, gathered_numbers, <span class="number">1</span>,</span><br><span class="line">             datatype, <span class="number">0</span>, comm);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> gathered_numbers;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p><code>gather_numbers_to_root</code> å‡½æ•°è·å–è¦æ”¶é›†çš„æ•°å­—ï¼ˆå³ <code>send_data</code> å˜é‡ï¼‰ã€æ•°å­—çš„æ•°æ®ç±»å‹ <code>datatype</code> å’Œ <code>comm</code> é€šè®¯å™¨ã€‚æ ¹è¿›ç¨‹å¿…é¡»åœ¨æ­¤å‡½æ•°ä¸­æ”¶é›† <code>comm_size</code> ä¸ªæ•°å­—ï¼Œå› æ­¤å®ƒä¼šåˆ†é… <code>datatype_size * comm_size</code> é•¿åº¦çš„æ•°ç»„ã€‚åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œé€šè¿‡ä½¿ç”¨æ–°çš„MPIå‡½æ•°- <code>MPI_Type_size</code> æ¥æ”¶é›†<code>datatype_size</code>å˜é‡ã€‚å°½ç®¡æˆ‘ä»¬çš„ä»£ç ä»…æ”¯æŒå°† <code>MPI_INT</code> å’Œ <code>MPI_FLOAT</code> ä½œä¸ºæ•°æ®ç±»å‹ï¼Œä½†å¯å°†å…¶æ‰©å±•ä»¥æ”¯æŒä¸åŒå¤§å°çš„æ•°æ®ç±»å‹ã€‚ åœ¨ä½¿ç”¨ <code>MPI_Gather</code> åœ¨æ ¹è¿›ç¨‹ä¸Šæ”¶é›†äº†æ•°å­—ä¹‹åï¼Œå¿…é¡»åœ¨æ ¹è¿›ç¨‹ä¸Šå¯¹æ•°å­—è¿›è¡Œæ’åºï¼Œä»¥ç¡®å®šå®ƒä»¬æ’åã€‚</p>
<h2 id="æ’åºæ•°å­—å¹¶ç»´æŠ¤æ‰€å±"><a href="#æ’åºæ•°å­—å¹¶ç»´æŠ¤æ‰€å±" class="headerlink" title="æ’åºæ•°å­—å¹¶ç»´æŠ¤æ‰€å±"></a>æ’åºæ•°å­—å¹¶ç»´æŠ¤æ‰€å±</h2><p>åœ¨æˆ‘ä»¬çš„æ’åå‡½æ•°ä¸­ï¼Œæ’åºæ•°å­—ä¸ä¸€å®šæ˜¯éš¾é¢˜ã€‚ Cæ ‡å‡†åº“ä¸ºæˆ‘ä»¬æä¾›äº†æµè¡Œçš„æ’åºç®—æ³•ï¼Œä¾‹å¦‚ <code>qsort</code>ã€‚ <strong>åœ¨å¹¶è¡Œæ’åé—®é¢˜ä¸­ï¼Œæ’åºçš„å›°éš¾åœ¨äºï¼Œæˆ‘ä»¬å¿…é¡»ç»´æŠ¤å„ä¸ªè¿›ç¨‹å°†æ•°å­—å‘é€åˆ°æ ¹è¿›ç¨‹çš„æ¬¡åºã€‚</strong> å¦‚æœæˆ‘ä»¬è¦å¯¹æ”¶é›†åˆ°æ ¹è¿›ç¨‹çš„æ•°ç»„è¿›è¡Œæ’åºè€Œä¸ç»™æ•°å­—é™„åŠ ä¿¡æ¯ï¼Œåˆ™æ ¹è¿›ç¨‹å°†ä¸çŸ¥é“å¦‚ä½•å°†æ•°å­—çš„æ’åå‘é€å›åŸæ¥è¯·æ±‚çš„è¿›ç¨‹ï¼</p>
<p>ä¸ºäº†ä¾¿äºå°†æ‰€å±è¿›ç¨‹é™„åˆ°å¯¹åº”æ•°å­—ä¸Šï¼Œæˆ‘ä»¬åœ¨ä»£ç ä¸­åˆ›å»ºäº†ä¸€ä¸ªç»“æ„ä½“ï¼ˆstructï¼‰æ¥ä¿å­˜æ­¤ä¿¡æ¯ã€‚ æˆ‘ä»¬çš„ç»“æ„å®šä¹‰å¦‚ä¸‹ï¼š</p>
<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¿å­˜è¿›ç¨‹åœ¨é€šè®¯å™¨ä¸­çš„æ¬¡åºï¼ˆrankï¼‰å’Œå¯¹åº”æ•°å­—</span></span><br><span class="line"><span class="comment">// è¯¥ç»“æ„ä½“ç”¨äºæ•°ç»„æ’åºï¼Œ</span></span><br><span class="line"><span class="comment">// å¹¶åŒæ—¶å®Œæ•´ä¿ç•™æ‰€å±è¿›ç¨‹ä¿¡æ¯</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">  <span class="type">int</span> comm_rank;</span><br><span class="line">  <span class="class"><span class="keyword">union</span> &#123;</span></span><br><span class="line">    <span class="type">float</span> f;</span><br><span class="line">    <span class="type">int</span> i;</span><br><span class="line">  &#125; number;</span><br><span class="line">&#125; CommRankNumber;</span><br></pre></td></tr></table></figure></div>

<p><code>CommRankNumber</code> ç»“æ„ä½“ä¿å­˜äº†æˆ‘ä»¬è¦æ’åºçš„æ•°å­—ï¼ˆè®°ä½å®ƒå¯ä»¥æ˜¯æµ®ç‚¹æ•°æˆ–æ•´æ•°ï¼Œå› æ­¤æˆ‘ä»¬ä½¿ç”¨è”åˆä½“unionï¼‰ï¼Œå¹¶ä¸”å®ƒæ‹¥æœ‰è¯¥æ•°å­—æ‰€å±è¿›ç¨‹åœ¨é€šè®¯å™¨ä¸­çš„æ¬¡åºï¼ˆrankï¼‰ã€‚</p>
<p><code>get_ranks</code> å‡½æ•°ï¼Œè´Ÿè´£åˆ›å»ºè¿™äº›ç»“æ„ä½“å¹¶å¯¹å®ƒä»¬è¿›è¡Œæ’åºã€‚</p>
<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¿™ä¸ªå‡½æ•°åœ¨æ ¹è¿›ç¨‹ä¸Šå¯¹æ”¶é›†åˆ°çš„æ•°å­—æ’åº</span></span><br><span class="line"><span class="comment">// è¿”å›ä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„æŒ‰è¿›ç¨‹åœ¨é€šè®¯å™¨ä¸­çš„æ¬¡åºæ’åº</span></span><br><span class="line"><span class="comment">// æ³¨æ„ - è¯¥å‡½æ•°åªåœ¨æ ¹è¿›ç¨‹ä¸Šè¿è¡Œ</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> *<span class="title function_">get_ranks</span><span class="params">(<span class="type">void</span> *gathered_numbers, <span class="type">int</span> gathered_number_count,</span></span><br><span class="line"><span class="params">               MPI_Datatype datatype)</span> &#123;</span><br><span class="line">  <span class="type">int</span> datatype_size;</span><br><span class="line">  MPI_Type_size(datatype, &amp;datatype_size);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å°†æ”¶é›†åˆ°çš„æ•°å­—æ•°ç»„è½¬æ¢ä¸ºCommRankNumbersæ•°ç»„</span></span><br><span class="line">  <span class="comment">// è¿™å…è®¸æˆ‘ä»¬åœ¨æ’åºçš„åŒæ—¶ï¼Œå®Œæ•´ä¿ç•™æ•°å­—æ‰€å±è¿›ç¨‹çš„ä¿¡æ¯</span></span><br><span class="line">  </span><br><span class="line">  CommRankNumber *comm_rank_numbers = <span class="built_in">malloc</span>(</span><br><span class="line">    gathered_number_count * <span class="keyword">sizeof</span>(CommRankNumber));</span><br><span class="line">  <span class="type">int</span> i;</span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; gathered_number_count; i++) &#123;</span><br><span class="line">    comm_rank_numbers[i].comm_rank = i;</span><br><span class="line">    <span class="built_in">memcpy</span>(&amp;(comm_rank_numbers[i].number),</span><br><span class="line">           gathered_numbers + (i * datatype_size),</span><br><span class="line">           datatype_size);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ ¹æ®æ•°æ®ç±»å‹å¯¹comm_rank_numbersæ’åº</span></span><br><span class="line">  <span class="keyword">if</span> (datatype == MPI_FLOAT) &#123;</span><br><span class="line">    qsort(comm_rank_numbers, gathered_number_count,</span><br><span class="line">          <span class="keyword">sizeof</span>(CommRankNumber), &amp;compare_float_comm_rank_number);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    qsort(comm_rank_numbers, gathered_number_count,</span><br><span class="line">          <span class="keyword">sizeof</span>(CommRankNumber), &amp;compare_int_comm_rank_number);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ç°åœ¨comm_rank_numbersæ˜¯æ’å¥½åºçš„ï¼Œä¸‹é¢ç”Ÿæˆä¸€ä¸ªæ•°ç»„ï¼Œ</span></span><br><span class="line">  <span class="comment">// åŒ…å«æ¯ä¸ªè¿›ç¨‹çš„æ’åï¼Œæ•°ç»„ç¬¬iä¸ªå…ƒç´ æ˜¯è¿›ç¨‹içš„æ•°å­—çš„æ’å</span></span><br><span class="line">  </span><br><span class="line">  <span class="type">int</span> *ranks = (<span class="type">int</span> *)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="type">int</span>) * gathered_number_count);</span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; gathered_number_count; i++) &#123;</span><br><span class="line">    ranks[comm_rank_numbers[i].comm_rank] = i;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ¸…ç†å¹¶è¿”å›æ’åæ•°ç»„</span></span><br><span class="line">  <span class="built_in">free</span>(comm_rank_numbers);</span><br><span class="line">  <span class="keyword">return</span> ranks;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p><code>get_ranks</code> å‡½æ•°é¦–å…ˆåˆ›å»ºä¸€ä¸ªCommRankNumberç»“æ„ä½“æ•°ç»„ï¼Œå¹¶é™„ä¸Šè¯¥æ•°å­—æ‰€å±è¿›ç¨‹åœ¨é€šè®¯å™¨ä¸­çš„æ¬¡åºã€‚ å¦‚æœæ•°æ®ç±»å‹ä¸º <code>MPI_FLOAT</code> ï¼Œåˆ™å¯¹æˆ‘ä»¬çš„ç»“æ„ä½“æ•°ç»„è°ƒç”¨ <code>qsort</code> æ—¶ï¼Œä¼šä½¿ç”¨ç‰¹æ®Šçš„æ’åºå‡½æ•°ï¼Œï¼ˆä»£ç è§<a class="link"   target="_blank" rel="noopener" href="https://github.com/mpitutorial/mpitutorial/tree/gh-pages/tutorials/performing-parallel-rank-with-mpi/code" >tmpi_rank.c <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>ã€‚ ç±»ä¼¼çš„ï¼Œå¦‚æœæ•°æ®ç±»å‹ä¸º <code>MPI_INT</code> ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ä¸åŒçš„æ’åºå‡½æ•°ã€‚</p>
<p>åœ¨å¯¹æ•°å­—è¿›è¡Œæ’åºä¹‹åï¼Œæˆ‘ä»¬å¿…é¡»ä»¥é€‚å½“çš„é¡ºåºåˆ›å»ºä¸€ä¸ªæ’åæ•°ç»„ï¼ˆarray of ranksï¼‰ï¼Œä»¥ä¾¿å°†å®ƒä»¬åˆ†æ•£ï¼ˆscatterï¼‰å›åˆ°è¯·æ±‚çš„è¿›ç¨‹ä¸­ã€‚è¿™æ˜¯é€šè¿‡åˆ›å»º <code>ranks</code> æ•°ç»„å¹¶ä¸ºæ¯ä¸ªå·²æ’åºçš„ <code>CommRankNumber</code> ç»“æ„ä½“å¡«å……é€‚å½“çš„æ’åæ¥å®ç°çš„ã€‚</p>
<h2 id="æ•´åˆ"><a href="#æ•´åˆ" class="headerlink" title="æ•´åˆ"></a>æ•´åˆ</h2><p>ç°åœ¨æˆ‘ä»¬æœ‰äº†ä¸¤ä¸ªä¸»è¦å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥å°†å®ƒä»¬å…¨éƒ¨æ•´åˆåˆ°æˆ‘ä»¬çš„ <code>TMPI_Rank</code> å‡½æ•°ä¸­ã€‚æ­¤å‡½æ•°å°†æ•°å­—æ”¶é›†åˆ°æ ¹è¿›ç¨‹ï¼Œå¹¶å¯¹æ•°å­—è¿›è¡Œæ’åºä»¥ç¡®å®šå…¶æ’åï¼Œç„¶åå°†æ’ååˆ†æ•£å›è¯·æ±‚çš„è¿›ç¨‹ã€‚ ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">/ è·å–recv_dataçš„æ’å, ç±»å‹ä¸ºdatatype</span><br><span class="line"><span class="comment">// æ’åç”¨send_dataè¿”å›ï¼Œç±»å‹ä¸ºdatatype</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">TMPI_Rank</span><span class="params">(<span class="type">void</span> *send_data, <span class="type">void</span> *recv_data, MPI_Datatype datatype,</span></span><br><span class="line"><span class="params">             MPI_Comm comm)</span> &#123;</span><br><span class="line">  <span class="comment">// é¦–å…ˆæ£€æŸ¥åŸºæœ¬æƒ…å†µ - æ­¤å‡½æ•°åªæ”¯æŒMPI_INTå’ŒMPI_FLOAT</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (datatype != MPI_INT &amp;&amp; datatype != MPI_FLOAT) &#123;</span><br><span class="line">    <span class="keyword">return</span> MPI_ERR_TYPE;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="type">int</span> comm_size, comm_rank;</span><br><span class="line">  MPI_Comm_size(comm, &amp;comm_size);</span><br><span class="line">  MPI_Comm_rank(comm, &amp;comm_rank);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ä¸ºäº†è®¡ç®—æ’åï¼Œå¿…é¡»å°†æ•°å­—æ”¶é›†åˆ°ä¸€ä¸ªè¿›ç¨‹ä¸­</span></span><br><span class="line">  <span class="comment">// å¯¹æ•°å­—æ’åº, ç„¶åå°†æ’åç»“æœåˆ†æ•£ä¼ å›</span></span><br><span class="line">  <span class="comment">// é¦–å…ˆåœ¨è¿›ç¨‹0ä¸Šæ”¶é›†æ•°å­—</span></span><br><span class="line">  <span class="type">void</span> *gathered_numbers = gather_numbers_to_root(send_data, datatype,</span><br><span class="line">                                                  comm);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è·å–æ¯ä¸ªè¿›ç¨‹çš„æ¬¡åºï¼ˆrank)</span></span><br><span class="line">  <span class="type">int</span> *ranks = <span class="literal">NULL</span>;</span><br><span class="line">  <span class="keyword">if</span> (comm_rank == <span class="number">0</span>) &#123;</span><br><span class="line">    ranks = get_ranks(gathered_numbers, comm_size, datatype);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// åˆ†æ•£å‘å›æ’åç»“æœ</span></span><br><span class="line">  MPI_Scatter(ranks, <span class="number">1</span>, MPI_INT, recv_data, <span class="number">1</span>, MPI_INT, <span class="number">0</span>, comm);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ¸…ç†</span></span><br><span class="line">  <span class="keyword">if</span> (comm_rank == <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="built_in">free</span>(gathered_numbers);</span><br><span class="line">    <span class="built_in">free</span>(ranks);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p><code>TMPI_Rank</code> å‡½æ•°ä½¿ç”¨æˆ‘ä»¬åˆšåˆšåˆ›å»ºçš„ä¸¤ä¸ªå‡½æ•° <code>gather_numbers_to_root</code> å’Œ <code>get_ranks</code> æ¥è·å–æ•°å­—çš„æ’åã€‚ç„¶åï¼Œå‡½æ•°æ‰§è¡Œæœ€åçš„ <code>MPI_Scatter</code>ï¼Œä»¥å°†æ‰€å¾—çš„æ’ååˆ†æ•£ä¼ å›è¿›ç¨‹ã€‚</p>
<h2 id="å®Œæ•´ä»£ç "><a href="#å®Œæ•´ä»£ç " class="headerlink" title="å®Œæ•´ä»£ç "></a>å®Œæ•´ä»£ç </h2><div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;mpi.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Holds the communicator rank of a process along with the corresponding number.</span></span><br><span class="line"><span class="comment">// This struct is used for sorting the values and keeping the owning process information</span></span><br><span class="line"><span class="comment">// intact.</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">  <span class="type">int</span> comm_rank;</span><br><span class="line">  <span class="class"><span class="keyword">union</span> &#123;</span></span><br><span class="line">    <span class="type">float</span> f;</span><br><span class="line">    <span class="type">int</span> i;</span><br><span class="line">  &#125; number;</span><br><span class="line">&#125; CommRankNumber;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Gathers numbers for TMPI_Rank to process zero. Allocates enough space given the MPI datatype and</span></span><br><span class="line"><span class="comment">// returns a void * buffer to process 0. It returns NULL to all other processes.</span></span><br><span class="line"><span class="type">void</span> *<span class="title function_">gather_numbers_to_root</span><span class="params">(<span class="type">void</span> *number, MPI_Datatype datatype, MPI_Comm comm)</span> &#123;</span><br><span class="line">  <span class="type">int</span> comm_rank, comm_size;</span><br><span class="line">  MPI_Comm_rank(comm, &amp;comm_rank);</span><br><span class="line">  MPI_Comm_size(comm, &amp;comm_size);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Allocate an array on the root process of a size depending on the MPI datatype being used.</span></span><br><span class="line">  <span class="type">int</span> datatype_size;</span><br><span class="line">  MPI_Type_size(datatype, &amp;datatype_size);</span><br><span class="line">  <span class="type">void</span> *gathered_numbers;</span><br><span class="line">  <span class="keyword">if</span> (comm_rank == <span class="number">0</span>) &#123;</span><br><span class="line">    gathered_numbers = <span class="built_in">malloc</span>(datatype_size * comm_size);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Gather all of the numbers on the root process</span></span><br><span class="line">  MPI_Gather(number, <span class="number">1</span>, datatype, gathered_numbers, <span class="number">1</span>, datatype, <span class="number">0</span>, comm);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> gathered_numbers;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// A comparison function for sorting float CommRankNumber values</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">compare_float_comm_rank_number</span><span class="params">(<span class="type">const</span> <span class="type">void</span> *a, <span class="type">const</span> <span class="type">void</span> *b)</span> &#123;</span><br><span class="line">  CommRankNumber *comm_rank_number_a = (CommRankNumber *)a;</span><br><span class="line">  CommRankNumber *comm_rank_number_b = (CommRankNumber *)b;</span><br><span class="line">  <span class="keyword">if</span> (comm_rank_number_a-&gt;number.f &lt; comm_rank_number_b-&gt;number.f) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (comm_rank_number_a-&gt;number.f &gt; comm_rank_number_b-&gt;number.f) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// A comparison function for sorting int CommRankNumber values</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">compare_int_comm_rank_number</span><span class="params">(<span class="type">const</span> <span class="type">void</span> *a, <span class="type">const</span> <span class="type">void</span> *b)</span> &#123;</span><br><span class="line">  CommRankNumber *comm_rank_number_a = (CommRankNumber *)a;</span><br><span class="line">  CommRankNumber *comm_rank_number_b = (CommRankNumber *)b;</span><br><span class="line">  <span class="keyword">if</span> (comm_rank_number_a-&gt;number.i &lt; comm_rank_number_b-&gt;number.i) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (comm_rank_number_a-&gt;number.i &gt; comm_rank_number_b-&gt;number.i) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// This function sorts the gathered numbers on the root process and returns an array of</span></span><br><span class="line"><span class="comment">// ordered by the process&#x27;s rank in its communicator. Note - this function is only</span></span><br><span class="line"><span class="comment">// executed on the root process.</span></span><br><span class="line"><span class="type">int</span> *<span class="title function_">get_ranks</span><span class="params">(<span class="type">void</span> *gathered_numbers, <span class="type">int</span> gathered_number_count, MPI_Datatype datatype)</span> &#123;</span><br><span class="line">  <span class="type">int</span> datatype_size;</span><br><span class="line">  MPI_Type_size(datatype, &amp;datatype_size);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Convert the gathered number array to an array of CommRankNumbers. This allows us to</span></span><br><span class="line">  <span class="comment">// sort the numbers and also keep the information of the processes that own the numbers</span></span><br><span class="line">  <span class="comment">// intact.</span></span><br><span class="line">  CommRankNumber *comm_rank_numbers = <span class="built_in">malloc</span>(gathered_number_count * <span class="keyword">sizeof</span>(CommRankNumber));</span><br><span class="line">  <span class="type">int</span> i;</span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; gathered_number_count; i++) &#123;</span><br><span class="line">    comm_rank_numbers[i].comm_rank = i;</span><br><span class="line">    <span class="built_in">memcpy</span>(&amp;(comm_rank_numbers[i].number), gathered_numbers + (i * datatype_size), datatype_size);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Sort the comm rank numbers based on the datatype</span></span><br><span class="line">  <span class="keyword">if</span> (datatype == MPI_FLOAT) &#123;</span><br><span class="line">    qsort(comm_rank_numbers, gathered_number_count, <span class="keyword">sizeof</span>(CommRankNumber), &amp;compare_float_comm_rank_number);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    qsort(comm_rank_numbers, gathered_number_count, <span class="keyword">sizeof</span>(CommRankNumber), &amp;compare_int_comm_rank_number);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Now that the comm_rank_numbers are sorted, create an array of rank values for each process. The ith</span></span><br><span class="line">  <span class="comment">// element of this array contains the rank value for the number sent by process i.</span></span><br><span class="line">  <span class="type">int</span> *ranks = (<span class="type">int</span> *)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="type">int</span>) * gathered_number_count);</span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; gathered_number_count; i++) &#123;</span><br><span class="line">    ranks[comm_rank_numbers[i].comm_rank] = i;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Clean up and return the rank array</span></span><br><span class="line">  <span class="built_in">free</span>(comm_rank_numbers);</span><br><span class="line">  <span class="keyword">return</span> ranks;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Gets the rank of the recv_data, which is of type datatype. The rank is returned</span></span><br><span class="line"><span class="comment">// in send_data and is of type datatype.</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">TMPI_Rank</span><span class="params">(<span class="type">void</span> *send_data, <span class="type">void</span> *recv_data, MPI_Datatype datatype, MPI_Comm comm)</span> &#123;</span><br><span class="line">  <span class="comment">// Check base cases first - Only support MPI_INT and MPI_FLOAT for this function.</span></span><br><span class="line">  <span class="keyword">if</span> (datatype != MPI_INT &amp;&amp; datatype != MPI_FLOAT) &#123;</span><br><span class="line">    <span class="keyword">return</span> MPI_ERR_TYPE;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="type">int</span> comm_size, comm_rank;</span><br><span class="line">  MPI_Comm_size(comm, &amp;comm_size);</span><br><span class="line">  MPI_Comm_rank(comm, &amp;comm_rank);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// To calculate the rank, we must gather the numbers to one process, sort the numbers, and then</span></span><br><span class="line">  <span class="comment">// scatter the resulting rank values. Start by gathering the numbers on process 0 of comm.</span></span><br><span class="line">  <span class="type">void</span> *gathered_numbers = gather_numbers_to_root(send_data, datatype, comm);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Get the ranks of each process</span></span><br><span class="line">  <span class="type">int</span> *ranks = <span class="literal">NULL</span>;</span><br><span class="line">  <span class="keyword">if</span> (comm_rank == <span class="number">0</span>) &#123;</span><br><span class="line">    ranks = get_ranks(gathered_numbers, comm_size, datatype);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Scatter the rank results</span></span><br><span class="line">  MPI_Scatter(ranks, <span class="number">1</span>, MPI_INT, recv_data, <span class="number">1</span>, MPI_INT, <span class="number">0</span>, comm);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Do clean up</span></span><br><span class="line">  <span class="keyword">if</span> (comm_rank == <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="built_in">free</span>(gathered_numbers);</span><br><span class="line">    <span class="built_in">free</span>(ranks);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h1 id="â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”"><a href="#â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”" class="headerlink" title="â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”"></a>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</h1><h1 id="åŸºäºè¿›ç¨‹çš„å¹¶è¡Œ"><a href="#åŸºäºè¿›ç¨‹çš„å¹¶è¡Œ" class="headerlink" title="åŸºäºè¿›ç¨‹çš„å¹¶è¡Œ"></a>åŸºäºè¿›ç¨‹çš„å¹¶è¡Œ</h1><p><code>multiprocessing</code> æ˜¯Pythonæ ‡å‡†åº“ä¸­çš„æ¨¡å—ï¼Œ<strong>å®ç°äº†å…±äº«å†…å­˜æœºåˆ¶</strong>ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¯ä»¥è®©è¿è¡Œåœ¨ä¸åŒå¤„ç†å™¨æ ¸å¿ƒçš„è¿›ç¨‹èƒ½è¯»å–å…±äº«å†…å­˜ã€‚</p>
<p><code>mpi4py</code> åº“å®ç°äº†æ¶ˆæ¯ä¼ é€’çš„ç¼–ç¨‹èŒƒä¾‹ï¼ˆè®¾è®¡æ¨¡å¼ï¼‰ã€‚ç®€å•æ¥è¯´ï¼Œå°±æ˜¯è¿›ç¨‹ä¹‹é—´ä¸é ä»»ä½•å…±äº«ä¿¡æ¯æ¥è¿›è¡Œé€šè®¯ï¼ˆä¹Ÿå«åšshared nothingï¼‰ï¼Œ<strong>æ‰€æœ‰çš„äº¤æµéƒ½é€šè¿‡ä¼ é€’ä¿¡æ¯ä»£æ›¿ã€‚</strong>åœ¨ä¿¡æ¯ä¼ é€’çš„ä»£ç ä¸­ï¼Œè¿›ç¨‹é€šè¿‡ <code>send()</code> å’Œ <code>receive</code> è¿›è¡Œäº¤æµã€‚</p>
<p>åœ¨Pythonå¤šè¿›ç¨‹çš„å®˜æ–¹æ–‡æ¡£ä¸­ï¼Œæ˜ç¡®æŒ‡å‡º <code>multiprocessing</code> æ¨¡å—è¦æ±‚ï¼Œä½¿ç”¨æ­¤æ¨¡å—çš„å‡½æ•°çš„mainæ¨¡å—å¯¹å­ç±»æ¥è¯´å¿…é¡»æ˜¯å¯å¯¼å…¥çš„ï¼ˆ <a class="link"   target="_blank" rel="noopener" href="https://docs.python.org/3.3/library/multiprocessing.html" >https://docs.python.org/3.3/library/multiprocessing.html <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> ï¼‰ã€‚</p>
<p><code>__main__</code> åœ¨IDLEä¸­å¹¶ä¸æ˜¯å¯ä»¥å¯¼å…¥çš„ï¼Œå³ä½¿ä½ åœ¨IDLEä¸­å°†æ–‡ä»¶å½“åšä¸€ä¸ªè„šæœ¬æ¥è¿è¡Œã€‚ä¸ºäº†èƒ½æ­£ç¡®ä½¿ç”¨æ­¤æ¨¡å—ï¼Œæœ¬ç« æˆ‘ä»¬å°†åœ¨å‘½ä»¤è¡Œä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤è¿è¡Œè„šæœ¬ï¼š</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python multiprocessing example.py</span><br></pre></td></tr></table></figure></div>

<p>è¿™é‡Œï¼Œ <code>multiprocessing_example.py</code> æ˜¯è„šæœ¬çš„æ–‡ä»¶å</p>
<p><strong>å¤šè¿›ç¨‹è¿è¡Œä¸€ä¸ªå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°å¿…é¡»ä»å¤–éƒ¨æ–‡ä»¶å¯¼å…¥ã€‚</strong>æ¯”å¦‚è¯´ä¸‹é¢è¿™æ ·å°±ä¸è¡Œï¼š</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Pool</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>p = Pool(<span class="number">5</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">def</span> <span class="title function_">f</span>(<span class="params">x</span>):</span><br><span class="line"><span class="meta">... </span>    <span class="keyword">return</span> x*x</span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>p.<span class="built_in">map</span>(f, [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>])</span><br><span class="line">Process PoolWorker-<span class="number">1</span>:</span><br><span class="line">Process PoolWorker-<span class="number">2</span>:</span><br><span class="line">Process PoolWorker-<span class="number">3</span>:</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">AttributeError: <span class="string">&#x27;module&#x27;</span> <span class="built_in">object</span> has no attribute <span class="string">&#x27;f&#x27;</span></span><br><span class="line">AttributeError: <span class="string">&#x27;module&#x27;</span> <span class="built_in">object</span> has no attribute <span class="string">&#x27;f&#x27;</span></span><br><span class="line">AttributeError: <span class="string">&#x27;module&#x27;</span> <span class="built_in">object</span> has no attribute <span class="string">&#x27;f&#x27;</span></span><br></pre></td></tr></table></figure></div>

<p>ä¸Šé¢è„šæœ¬æ¥è‡ªPythonå®˜ç½‘æ–‡æ¡£ã€‚å¦‚æœç¨ä½œä¿®æ”¹ï¼Œå°†éœ€è¦å¤šè¿›ç¨‹è¿è¡Œçš„ç›®æ ‡å‡½æ•°æ”¾åˆ°æ–‡ä»¶é‡Œå¯¼å…¥è¿è¡Œï¼Œå°±æ²¡æœ‰é—®é¢˜äº†ï¼š</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">1</span>]: <span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Pool</span><br><span class="line"></span><br><span class="line">In [<span class="number">2</span>]: p = Pool(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">In [<span class="number">4</span>]: <span class="keyword">import</span> func</span><br><span class="line"></span><br><span class="line">In [<span class="number">5</span>]: p.<span class="built_in">map</span>(func.f, [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>])</span><br><span class="line">Out[<span class="number">5</span>]: [<span class="number">1</span>, <span class="number">4</span>, <span class="number">9</span>]</span><br></pre></td></tr></table></figure></div>

<h1 id="å¦‚ä½•äº§ç”Ÿä¸€ä¸ªè¿›ç¨‹"><a href="#å¦‚ä½•äº§ç”Ÿä¸€ä¸ªè¿›ç¨‹" class="headerlink" title="å¦‚ä½•äº§ç”Ÿä¸€ä¸ªè¿›ç¨‹"></a>å¦‚ä½•äº§ç”Ÿä¸€ä¸ªè¿›ç¨‹</h1><p>â€œäº§ç”Ÿâ€ï¼ˆspawnï¼‰çš„æ„æ€æ˜¯ï¼Œç”±çˆ¶è¿›ç¨‹åˆ›å»ºå­è¿›ç¨‹ã€‚çˆ¶è¿›ç¨‹æ—¢å¯ä»¥åœ¨äº§ç”Ÿå­è¿›ç¨‹ä¹‹åç»§ç»­å¼‚æ­¥æ‰§è¡Œï¼Œä¹Ÿå¯ä»¥æš‚åœç­‰å¾…å­è¿›ç¨‹åˆ›å»ºå®Œæˆä¹‹åå†ç»§ç»­æ‰§è¡Œã€‚Pythonçš„multiprocessingåº“é€šè¿‡ä»¥ä¸‹å‡ æ­¥åˆ›å»ºè¿›ç¨‹ï¼š</p>
<ol>
<li>åˆ›å»ºè¿›ç¨‹å¯¹è±¡</li>
<li>è°ƒç”¨ <code>start()</code> æ–¹æ³•ï¼Œå¼€å¯è¿›ç¨‹çš„æ´»åŠ¨</li>
<li>è°ƒç”¨ <code>join()</code> æ–¹æ³•ï¼Œåœ¨è¿›ç¨‹ç»“æŸä¹‹å‰ä¸€ç›´ç­‰å¾…</li>
</ol>
<p>ä¸‹é¢çš„ä¾‹å­åˆ›å»ºäº†5ä¸ªè¿›ç¨‹ï¼Œæ¯ä¸€ä¸ªè¿›ç¨‹éƒ½åˆ†é…äº† <code>foo(i)</code> å‡½æ•°ï¼Œ <code>i</code> è¡¨ç¤ºè¿›ç¨‹çš„idï¼š</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> multiprocessing</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">foo</span>(<span class="params">i</span>):</span><br><span class="line">    <span class="built_in">print</span> (<span class="string">&#x27;called function in process: %s&#x27;</span> %i)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    Process_jobs = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">        p = multiprocessing.Process(target=foo, args=(i,))		<span class="comment">#åˆ›å»ºè¿›ç¨‹ã€‚è¿›ç¨‹å¯¹è±¡çš„æ—¶å€™éœ€è¦åˆ†é…ä¸€ä¸ªå‡½æ•°ï¼Œä½œä¸ºè¿›ç¨‹çš„æ‰§è¡Œä»»åŠ¡ï¼Œargsæ˜¯ä¼ å…¥å‡½æ•°çš„å‚æ•°</span></span><br><span class="line">        Process_jobs.append(p)									<span class="comment">#å°†è¿›ç¨‹åŠ å…¥</span></span><br><span class="line">        p.start()</span><br><span class="line">        p.join()</span><br></pre></td></tr></table></figure></div>

<p>æ‰§è¡Œæœ¬ä¾‹éœ€è¦æ‰“å¼€å‘½ä»¤è¡Œï¼Œåˆ°æ–‡ä»¶ <code>spawn_a_process.py</code> ï¼ˆè„šæœ¬åå­—ï¼‰æ‰€åœ¨çš„ç›®å½•ä¸‹ï¼Œç„¶åè¾“å…¥ä¸‹é¢çš„å‘½ä»¤æ‰§è¡Œï¼š</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python spawn_a_process.py</span><br></pre></td></tr></table></figure></div>

<p>æˆ‘ä»¬ä¼šå¾—åˆ°ä»¥ä¸‹ç»“æœï¼š</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ python process_2.py</span><br><span class="line">called function in process: 0</span><br><span class="line">called function in process: 1</span><br><span class="line">called function in process: 2</span><br><span class="line">called function in process: 3</span><br><span class="line">called function in process: 4</span><br></pre></td></tr></table></figure></div>

<p>å­è¿›ç¨‹åˆ›å»ºçš„æ—¶å€™éœ€è¦å¯¼å…¥åŒ…å«ç›®æ ‡å‡½æ•°çš„è„šæœ¬ã€‚é€šè¿‡åœ¨ <code>__main__</code> ä»£ç å—ä¸­å®ä¾‹åŒ–è¿›ç¨‹å¯¹è±¡ï¼Œæˆ‘ä»¬å¯ä»¥é¢„é˜²æ— é™é€’å½’è°ƒç”¨ã€‚<strong>æœ€ä½³å®è·µæ˜¯åœ¨ä¸åŒçš„è„šæœ¬æ–‡ä»¶ä¸­å®šä¹‰ç›®æ ‡å‡½æ•°ï¼Œç„¶åå¯¼å…¥è¿›æ¥ä½¿ç”¨</strong>ã€‚æ‰€ä»¥ä¸Šé¢çš„ä»£ç å¯ä»¥ä¿®æ”¹ä¸ºï¼š</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> multiprocessing</span><br><span class="line"><span class="keyword">import</span> target_function</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    Process_jobs = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">        p = multiprocessing.Process(target=target_function.function,args=(i,))</span><br><span class="line">        Process_jobs.append(p)</span><br><span class="line">        p.start()</span><br><span class="line">        p.join()</span><br></pre></td></tr></table></figure></div>

<p><code>target_function.py</code> çš„å†…å®¹å¦‚ä¸‹ï¼š</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">function</span>(<span class="params">i</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;called function in process: %s&#x27;</span> %i)</span><br><span class="line">    <span class="keyword">return</span></span><br></pre></td></tr></table></figure></div>

<h1 id="å¦‚ä½•ä¸ºä¸€ä¸ªè¿›ç¨‹å‘½å"><a href="#å¦‚ä½•ä¸ºä¸€ä¸ªè¿›ç¨‹å‘½å" class="headerlink" title="å¦‚ä½•ä¸ºä¸€ä¸ªè¿›ç¨‹å‘½å"></a>å¦‚ä½•ä¸ºä¸€ä¸ªè¿›ç¨‹å‘½å</h1><div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å‘½åä¸€ä¸ªè¿›ç¨‹</span></span><br><span class="line"><span class="keyword">import</span> multiprocessing</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">foo</span>():</span><br><span class="line">    name = multiprocessing.current_process().name</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Starting %s \n&quot;</span> % name)</span><br><span class="line">    time.sleep(<span class="number">3</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Exiting %s \n&quot;</span> % name)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    process_with_name = multiprocessing.Process(name=<span class="string">&#x27;foo_process&#x27;</span>, target=foo)</span><br><span class="line">    </span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    åœ¨ Python ä¸­ï¼Œè¿›ç¨‹å¯ä»¥åˆ†ä¸ºä¸¤ç§ç±»å‹ï¼šå‰å°è¿›ç¨‹å’Œå®ˆæŠ¤è¿›ç¨‹ã€‚å‰å°è¿›ç¨‹æ˜¯æŒ‡åœ¨ä¸»è¿›ç¨‹ä¸­åˆ›å»ºçš„è¿›ç¨‹ï¼Œå®ƒä»¬ä¼šåœ¨ä¸»è¿›ç¨‹é€€å‡ºå‰å®Œæˆè¿è¡Œã€‚è€Œå®ˆæŠ¤è¿›ç¨‹æ˜¯æŒ‡åœ¨ä¸»è¿›ç¨‹ä¸­åˆ›å»ºçš„è¿›ç¨‹ï¼Œå®ƒä»¬ä¼šåœ¨ä¸»è¿›ç¨‹é€€å‡ºæ—¶è‡ªåŠ¨ç»ˆæ­¢ã€‚</span></span><br><span class="line"><span class="string">    ç¬¬ä¸€ä¸ªè¿›ç¨‹ï¼ˆä½¿ç”¨è‡ªå®šä¹‰åç§°ï¼‰è®¾ç½®ä¸ºå®ˆæŠ¤è¿›ç¨‹ï¼Œå³ process_with_name.daemon = Trueã€‚è¿™æ„å‘³ç€åœ¨ä¸»è¿›ç¨‹é€€å‡ºæ—¶ï¼Œè¯¥è¿›ç¨‹ä¼šè‡ªåŠ¨ç»ˆæ­¢ï¼Œè€Œä¸ç®¡å®ƒæ˜¯å¦å®Œæˆè¿è¡Œã€‚</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">    process_with_name.daemon = <span class="literal">True</span>  <span class="comment"># æ³¨æ„åŸä»£ç æœ‰è¿™ä¸€è¡Œï¼Œä½†æ˜¯è¯‘è€…å‘ç°åˆ æ‰è¿™ä¸€è¡Œæ‰èƒ½å¾—åˆ°æ­£ç¡®è¾“å‡º</span></span><br><span class="line">    process_with_default_name = multiprocessing.Process(target=foo)</span><br><span class="line">    process_with_name.start()</span><br><span class="line">    process_with_default_name.start()</span><br></pre></td></tr></table></figure></div>

<p>è¿è¡Œä¸Šé¢çš„ä»£ç ï¼Œæ‰“å¼€ç»ˆç«¯è¾“å…¥:</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python naming_process.py</span><br></pre></td></tr></table></figure></div>

<p>è¾“å‡ºçš„ç»“æœå¦‚ä¸‹ï¼š</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ python naming_process.py</span><br><span class="line">Starting foo_process</span><br><span class="line">Starting Process-2</span><br><span class="line">Exiting foo_process</span><br><span class="line">Exiting Process-2</span><br></pre></td></tr></table></figure></div>

<h1 id="å¦‚ä½•åœ¨åå°è¿è¡Œä¸€ä¸ªè¿›ç¨‹"><a href="#å¦‚ä½•åœ¨åå°è¿è¡Œä¸€ä¸ªè¿›ç¨‹" class="headerlink" title="å¦‚ä½•åœ¨åå°è¿è¡Œä¸€ä¸ªè¿›ç¨‹"></a>å¦‚ä½•åœ¨åå°è¿è¡Œä¸€ä¸ªè¿›ç¨‹</h1><p>å¦‚æœéœ€è¦å¤„ç†æ¯”è¾ƒå·¨å¤§çš„ä»»åŠ¡ï¼Œåˆä¸éœ€è¦äººä¸ºå¹²é¢„ï¼Œå°†å…¶ä½œä¸ºåå°è¿›ç¨‹æ‰§è¡Œæ˜¯ä¸ªéå¸¸å¸¸ç”¨çš„ç¼–ç¨‹æ¨¡å‹ã€‚æ­¤è¿›ç¨‹åˆå¯ä»¥å’Œå…¶ä»–è¿›ç¨‹å¹¶å‘æ‰§è¡Œã€‚é€šè¿‡Pythonçš„multiprocessingæ¨¡å—çš„åå°è¿›ç¨‹é€‰é¡¹ï¼Œæˆ‘ä»¬å¯ä»¥è®©è¿›ç¨‹åœ¨åå°è¿è¡Œã€‚</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> multiprocessing</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">foo</span>():</span><br><span class="line">    name = multiprocessing.current_process().name</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Starting %s &quot;</span> % name)</span><br><span class="line">    time.sleep(<span class="number">3</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Exiting %s &quot;</span> % name)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    background_process = multiprocessing.Process(name=<span class="string">&#x27;background_process&#x27;</span>, target=foo)</span><br><span class="line">    background_process.daemon = <span class="literal">True</span>			<span class="comment">#å®ˆæŠ¤è¿›ç¨‹å°±æ˜¯åå°è¿›ç¨‹ï¼Œä¸ä¼šæ˜¾ç¤ºç›¸å…³ä¿¡æ¯ã€‚åå°è¿è¡Œè¿›ç¨‹åœ¨ä¸»è¿›ç¨‹ç»“æŸä¹‹åä¼šè‡ªåŠ¨ç»“æŸã€‚</span></span><br><span class="line">    NO_background_process = multiprocessing.Process(name=<span class="string">&#x27;NO_background_process&#x27;</span>, target=foo)</span><br><span class="line">    NO_background_process.daemon = <span class="literal">False</span></span><br><span class="line">    background_process.start()</span><br><span class="line">    NO_background_process.start()</span><br></pre></td></tr></table></figure></div>

<p>è¿è¡Œä¸Šé¢çš„è„šæœ¬ï¼Œéœ€è¦ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤ï¼š</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python background_process.py</span><br></pre></td></tr></table></figure></div>

<p>æœ€åçš„è¾“å‡ºå¦‚ä¸‹ï¼š</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ python background_process.py</span><br><span class="line">Starting NO_background_process</span><br><span class="line">Exiting NO_background_process</span><br></pre></td></tr></table></figure></div>

<h1 id="å¦‚ä½•æ€æ‰ä¸€ä¸ªè¿›ç¨‹"><a href="#å¦‚ä½•æ€æ‰ä¸€ä¸ªè¿›ç¨‹" class="headerlink" title="å¦‚ä½•æ€æ‰ä¸€ä¸ªè¿›ç¨‹"></a>å¦‚ä½•æ€æ‰ä¸€ä¸ªè¿›ç¨‹</h1><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>terminate()</code> æ–¹æ³•ç«‹å³æ€æ­»ä¸€ä¸ªè¿›ç¨‹ã€‚å¦å¤–ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>is_alive()</code> æ–¹æ³•æ¥åˆ¤æ–­ä¸€ä¸ªè¿›ç¨‹æ˜¯å¦è¿˜å­˜æ´»ã€‚</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ€æ­»ä¸€ä¸ªè¿›ç¨‹</span></span><br><span class="line"><span class="keyword">import</span> multiprocessing</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">foo</span>():</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Starting function&#x27;</span>)</span><br><span class="line">        time.sleep(<span class="number">0.1</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Finished function&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">        p = multiprocessing.Process(target=foo)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Process before execution:&#x27;</span>, p, p.is_alive())</span><br><span class="line">        p.start()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Process running:&#x27;</span>, p, p.is_alive())</span><br><span class="line">        p.terminate()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Process terminated:&#x27;</span>, p, p.is_alive())</span><br><span class="line">        p.join()					<span class="comment">#join() æ–¹æ³•ä¼šé˜»å¡ä¸»è¿›ç¨‹ï¼Œç›´åˆ°å­è¿›ç¨‹å®Œæˆä¸ºæ­¢ã€‚</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Process joined:&#x27;</span>, p, p.is_alive())</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Process exit code:&#x27;</span>, p.exitcode)</span><br></pre></td></tr></table></figure></div>

<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/06/MPI/image-20230407102050741.png"
                      class="" title="image-20230407102050741"
                >

<p>æœ€åï¼Œæˆ‘ä»¬é€šè¿‡è¯»è¿›ç¨‹çš„ <code>ExitCode</code> çŠ¶æ€ç ï¼ˆstatus codeï¼‰éªŒè¯è¿›ç¨‹å·²ç»ç»“æŸï¼Œ <code>ExitCode</code> å¯èƒ½çš„å€¼å¦‚ä¸‹ï¼š</p>
<ul>
<li>&#x3D;&#x3D; 0: æ²¡æœ‰é”™è¯¯æ­£å¸¸é€€å‡º</li>
<li>&gt; 0: è¿›ç¨‹æœ‰é”™è¯¯ï¼Œå¹¶ä»¥æ­¤çŠ¶æ€ç é€€å‡º</li>
<li>&lt; 0: è¿›ç¨‹è¢« <code>-1 *</code> çš„ä¿¡å·æ€æ­»å¹¶ä»¥æ­¤ä½œä¸º ExitCode é€€å‡º</li>
</ul>
<p>åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œè¾“å‡ºçš„ <code>ExitCode</code> æ˜¯ <code>-15</code> ã€‚è´Ÿæ•°è¡¨ç¤ºå­è¿›ç¨‹è¢«æ•°å­—ä¸º15çš„ä¿¡å·æ€æ­»ã€‚</p>
<h1 id="å¦‚ä½•åœ¨å­ç±»ä¸­ä½¿ç”¨è¿›ç¨‹"><a href="#å¦‚ä½•åœ¨å­ç±»ä¸­ä½¿ç”¨è¿›ç¨‹" class="headerlink" title="å¦‚ä½•åœ¨å­ç±»ä¸­ä½¿ç”¨è¿›ç¨‹"></a>å¦‚ä½•åœ¨å­ç±»ä¸­ä½¿ç”¨è¿›ç¨‹</h1><p>å®ç°ä¸€ä¸ªè‡ªå®šä¹‰çš„è¿›ç¨‹å­ç±»ï¼Œéœ€è¦ä»¥ä¸‹ä¸‰æ­¥ï¼š</p>
<ul>
<li>å®šä¹‰ <code>Process</code> çš„å­ç±»</li>
<li>è¦†ç›– <code>__init__(self [,args])</code> æ–¹æ³•æ¥æ·»åŠ é¢å¤–çš„å‚æ•°</li>
<li>è¦†ç›– <code>run(self, [.args])</code> æ–¹æ³•æ¥å®ç° <code>Process</code> å¯åŠ¨çš„æ—¶å€™æ‰§è¡Œçš„ä»»åŠ¡</li>
</ul>
<p>åˆ›å»º <code>Porcess</code> å­ç±»ä¹‹åï¼Œä½ å¯ä»¥åˆ›å»ºå®ƒçš„å®ä¾‹å¹¶é€šè¿‡ <code>start()</code> æ–¹æ³•å¯åŠ¨å®ƒï¼Œå¯åŠ¨ä¹‹åä¼šè¿è¡Œ <code>run()</code> æ–¹æ³•ã€‚</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># è‡ªå®šä¹‰å­ç±»è¿›ç¨‹</span></span><br><span class="line"><span class="keyword">import</span> multiprocessing</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyProcess</span>(multiprocessing.Process):</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">run</span>(<span class="params">self</span>):</span><br><span class="line">                <span class="built_in">print</span> (<span class="string">&#x27;called run method in process: %s&#x27;</span> % self.name)</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">        jobs = []</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">                p = MyProcess()</span><br><span class="line">                jobs.append(p)</span><br><span class="line">                p.start()</span><br><span class="line">                p.join()</span><br></pre></td></tr></table></figure></div>

<p>è¾“å…¥ä»¥ä¸‹å‘½ä»¤è¿è¡Œè„šæœ¬ï¼š</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python subclass_process.py</span><br></pre></td></tr></table></figure></div>

<p>è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ python subclass.py</span><br><span class="line">called run method in process: MyProcess-1</span><br><span class="line">called run method in process: MyProcess-2</span><br><span class="line">called run method in process: MyProcess-3</span><br><span class="line">called run method in process: MyProcess-4</span><br><span class="line">called run method in process: MyProcess-5</span><br></pre></td></tr></table></figure></div>

<h1 id="å¦‚ä½•åœ¨è¿›ç¨‹ä¹‹é—´äº¤æ¢å¯¹è±¡"><a href="#å¦‚ä½•åœ¨è¿›ç¨‹ä¹‹é—´äº¤æ¢å¯¹è±¡" class="headerlink" title="å¦‚ä½•åœ¨è¿›ç¨‹ä¹‹é—´äº¤æ¢å¯¹è±¡"></a>å¦‚ä½•åœ¨è¿›ç¨‹ä¹‹é—´äº¤æ¢å¯¹è±¡</h1><p>å¹¶è¡Œåº”ç”¨å¸¸å¸¸éœ€è¦åœ¨è¿›ç¨‹ä¹‹é—´äº¤æ¢æ•°æ®ã€‚Multiprocessingåº“æœ‰ä¸¤ä¸ªCommunication Channelå¯ä»¥äº¤æ¢å¯¹è±¡ï¼š<strong>é˜Ÿåˆ—(queue)å’Œç®¡é“ï¼ˆpipeï¼‰ã€‚</strong></p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/06/MPI/image-20230407103300194.png"
                      class="" title="image-20230407103300194"
                >

<h2 id="ä½¿ç”¨é˜Ÿåˆ—äº¤æ¢å¯¹è±¡"><a href="#ä½¿ç”¨é˜Ÿåˆ—äº¤æ¢å¯¹è±¡" class="headerlink" title="ä½¿ç”¨é˜Ÿåˆ—äº¤æ¢å¯¹è±¡"></a>ä½¿ç”¨é˜Ÿåˆ—äº¤æ¢å¯¹è±¡</h2><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡é˜Ÿåˆ—æ•°æ®ç»“æ„æ¥å…±äº«å¯¹è±¡ã€‚</p>
<p><code>Queue</code> è¿”å›ä¸€ä¸ªè¿›ç¨‹å…±äº«çš„é˜Ÿåˆ—ï¼Œæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä¹Ÿæ˜¯è¿›ç¨‹å®‰å…¨çš„ã€‚<strong>ä»»ä½•å¯åºåˆ—åŒ–çš„å¯¹è±¡ï¼ˆPythoné€šè¿‡ <code>pickable</code> æ¨¡å—åºåˆ—åŒ–å¯¹è±¡ï¼‰éƒ½å¯ä»¥é€šè¿‡å®ƒè¿›è¡Œäº¤æ¢ã€‚</strong></p>
<blockquote>
<p>åºåˆ—åŒ–æ˜¯æŒ‡å°†æ•°æ®ç»“æ„æˆ–å¯¹è±¡è½¬æ¢ä¸ºå¯å­˜å‚¨æˆ–ä¼ è¾“çš„æ ¼å¼çš„è¿‡ç¨‹ã€‚ã€‚å¯åºåˆ—åŒ–çš„å¯¹è±¡æ˜¯æŒ‡å¯ä»¥è¢«è½¬æ¢ä¸ºå­—èŠ‚æµæˆ–å­—ç¬¦ä¸²çš„å¯¹è±¡ã€‚</p>
</blockquote>
<p>åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å°†å±•ç¤ºå¦‚ä½•ä½¿ç”¨é˜Ÿåˆ—æ¥å®ç°ç”Ÿäº§è€…-æ¶ˆè´¹è€…é—®é¢˜ã€‚ <code>Producer</code> ç±»ç”Ÿäº§itemæ”¾åˆ°é˜Ÿåˆ—ä¸­ï¼Œç„¶å <code>Consumer</code> ç±»ä»é˜Ÿåˆ—ä¸­ç§»é™¤å®ƒä»¬ã€‚</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> multiprocessing</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Producer</span>(multiprocessing.Process):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, queue</span>):</span><br><span class="line">        multiprocessing.Process.__init__(self)</span><br><span class="line">        self.queue = queue</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">run</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">            item = random.randint(<span class="number">0</span>, <span class="number">256</span>)</span><br><span class="line">            self.queue.put(item)			<span class="comment">#å°†itemæ”¾è¿›queueä¸­</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Process Producer : item %d appended to queue %s&quot;</span> % (item, self.name))</span><br><span class="line">            time.sleep(<span class="number">1</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;The size of queue is %s&quot;</span> % self.queue.qsize())</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Consumer</span>(multiprocessing.Process):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, queue</span>):</span><br><span class="line">        multiprocessing.Process.__init__(self)</span><br><span class="line">        self.queue = queue</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">run</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            <span class="keyword">if</span> self.queue.empty():</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;the queue is empty&quot;</span>)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                time.sleep(<span class="number">2</span>)</span><br><span class="line">                item = self.queue.get()			<span class="comment">#å°†queueã€ä¸­çš„itemå–å‡º</span></span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&#x27;Process Consumer : item %d popped from by %s \n&#x27;</span> % (item, self.name))</span><br><span class="line">                time.sleep(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    queue = multiprocessing.Queue()</span><br><span class="line">    process_producer = Producer(queue)</span><br><span class="line">    process_consumer = Consumer(queue)</span><br><span class="line">    process_producer.start()</span><br><span class="line">    process_consumer.start()</span><br><span class="line">    process_producer.join()</span><br><span class="line">    process_consumer.join()</span><br></pre></td></tr></table></figure></div>

<p>é˜Ÿåˆ—è¿˜æœ‰ä¸€ä¸ª <code>JoinableQueue</code> å­ç±»ï¼Œå®ƒæœ‰ä»¥ä¸‹ä¸¤ä¸ªé¢å¤–çš„æ–¹æ³•ï¼š</p>
<ul>
<li><code>task_done()</code>: æ­¤æ–¹æ³•æ„å‘³ç€ä¹‹å‰å…¥é˜Ÿçš„ä¸€ä¸ªä»»åŠ¡å·²ç»å®Œæˆï¼Œæ¯”å¦‚ï¼Œ <code>get()</code> æ–¹æ³•ä»é˜Ÿåˆ—å–å›itemä¹‹åè°ƒç”¨ã€‚æ‰€ä»¥æ­¤æ–¹æ³•åªèƒ½è¢«é˜Ÿåˆ—çš„æ¶ˆè´¹è€…è°ƒç”¨ã€‚</li>
<li><code>join()</code>: æ­¤æ–¹æ³•å°†è¿›ç¨‹é˜»å¡ï¼Œç›´åˆ°é˜Ÿåˆ—ä¸­çš„itemå…¨éƒ¨è¢«å–å‡ºå¹¶æ‰§è¡Œã€‚</li>
</ul>
<p>ï¼ˆ <a class="link"   target="_blank" rel="noopener" href="https://github.com/laixintao/python-parallel-programming-cookbook-cn/issues/17#issuecomment-335668371" >Microndgt <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> æ³¨ï¼šå› ä¸ºä½¿ç”¨é˜Ÿåˆ—è¿›è¡Œé€šä¿¡æ˜¯ä¸€ä¸ªå•å‘çš„ï¼Œä¸ç¡®å®šçš„è¿‡ç¨‹ï¼Œæ‰€ä»¥ä½ ä¸çŸ¥é“ä»€ä¹ˆæ—¶å€™é˜Ÿåˆ—çš„å…ƒç´ è¢«å–å‡ºæ¥äº†ï¼Œæ‰€ä»¥ä½¿ç”¨task_doneæ¥è¡¨ç¤ºé˜Ÿåˆ—é‡Œçš„ä¸€ä¸ªä»»åŠ¡å·²ç»å®Œæˆã€‚</p>
<p><strong>è¿™ä¸ªæ–¹æ³•ä¸€èˆ¬å’Œjoinä¸€èµ·ä½¿ç”¨ï¼Œå½“é˜Ÿåˆ—çš„æ‰€æœ‰ä»»åŠ¡éƒ½å¤„ç†ä¹‹åï¼Œä¹Ÿå°±æ˜¯è¯´putåˆ°é˜Ÿåˆ—çš„æ¯ä¸ªä»»åŠ¡éƒ½è°ƒç”¨äº†task_doneæ–¹æ³•åï¼Œjoinæ‰ä¼šå®Œæˆé˜»å¡ã€‚ï¼‰</strong></p>
<h2 id="ä½¿ç”¨ç®¡é“äº¤æ¢å¯¹è±¡"><a href="#ä½¿ç”¨ç®¡é“äº¤æ¢å¯¹è±¡" class="headerlink" title="ä½¿ç”¨ç®¡é“äº¤æ¢å¯¹è±¡"></a>ä½¿ç”¨ç®¡é“äº¤æ¢å¯¹è±¡</h2><p>ç¬¬äºŒç§Communication Channelæ˜¯ç®¡é“ã€‚</p>
<p>ä¸€ä¸ªç®¡é“å¯ä»¥åšä»¥ä¸‹äº‹æƒ…ï¼š</p>
<ul>
<li>è¿”å›ä¸€å¯¹è¢«ç®¡é“è¿æ¥çš„è¿æ¥å¯¹è±¡</li>
<li>ç„¶åå¯¹è±¡å°±æœ‰äº† send&#x2F;receive æ–¹æ³•å¯ä»¥åœ¨è¿›ç¨‹ä¹‹é—´é€šä¿¡</li>
</ul>
<p>ä¸‹é¢æ˜¯ç®¡é“ç”¨æ³•çš„ä¸€ä¸ªç®€å•ç¤ºä¾‹ã€‚è¿™é‡Œæœ‰ä¸€ä¸ªè¿›ç¨‹ç®¡é“ä»0åˆ°9å‘å‡ºæ•°å­—ï¼Œå¦ä¸€ä¸ªè¿›ç¨‹æ¥æ”¶æ•°å­—å¹¶è¿›è¡Œå¹³æ–¹è®¡ç®—ã€‚</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> multiprocessing</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">create_items</span>(<span class="params">pipe</span>):</span><br><span class="line">    output_pipe, _ = pipe</span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">        output_pipe.send(item)</span><br><span class="line">    output_pipe.close()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">multiply_items</span>(<span class="params">pipe_1, pipe_2</span>):</span><br><span class="line">    close, input_pipe = pipe_1</span><br><span class="line">    close.close()</span><br><span class="line">    output_pipe, _ = pipe_2</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            item = input_pipe.recv()</span><br><span class="line">            output_pipe.send(item * item)</span><br><span class="line">    <span class="keyword">except</span> EOFError:</span><br><span class="line">        output_pipe.close()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__== <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment"># ç¬¬ä¸€ä¸ªè¿›ç¨‹ç®¡é“å‘å‡ºæ•°å­—</span></span><br><span class="line">    pipe_1 = multiprocessing.Pipe(<span class="literal">True</span>)</span><br><span class="line">    process_pipe_1 = multiprocessing.Process(target=create_items, args=(pipe_1,))</span><br><span class="line">    process_pipe_1.start()</span><br><span class="line">    <span class="comment"># ç¬¬äºŒä¸ªè¿›ç¨‹ç®¡é“æ¥æ”¶æ•°å­—å¹¶è®¡ç®—</span></span><br><span class="line">    pipe_2 = multiprocessing.Pipe(<span class="literal">True</span>)</span><br><span class="line">    process_pipe_2 = multiprocessing.Process(target=multiply_items, args=(pipe_1, pipe_2,))</span><br><span class="line">    process_pipe_2.start()</span><br><span class="line">    pipe_1[<span class="number">0</span>].close()</span><br><span class="line">    pipe_2[<span class="number">0</span>].close()</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            <span class="built_in">print</span>(pipe_2[<span class="number">1</span>].recv())</span><br><span class="line">    <span class="keyword">except</span> EOFError:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;End&quot;</span>)</span><br></pre></td></tr></table></figure></div>

<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/06/MPI/image-20230407105421091.png"
                      class="" title="image-20230407105421091"
                >

<p><code>Pipe()</code> å‡½æ•°è¿”å›ä¸€å¯¹é€šè¿‡åŒå‘ç®¡é“è¿æ¥èµ·æ¥çš„å¯¹è±¡ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œ <code>out_pipe</code> åŒ…å«æ•°å­—0-9ï¼Œé€šè¿‡ç›®æ ‡å‡½æ•° <code>create_items()</code> äº§ç”Ÿ:</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">create_items</span>(<span class="params">pipe</span>):</span><br><span class="line">    output_pipe, _ = pipe</span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">        output_pipe.send(item)</span><br><span class="line">    output_pipe.close()</span><br></pre></td></tr></table></figure></div>

<p>åœ¨ç¬¬äºŒä¸ªè¿›ç¨‹ä¸­ï¼Œæˆ‘ä»¬æœ‰ä¸¤ä¸ªç®¡é“ï¼Œè¾“å…¥ç®¡é“å’ŒåŒ…å«ç»“æœçš„è¾“å‡ºç®¡é“ï¼š</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">process_pipe_2 = multiprocessing.Process(target=multiply_items, args=(pipe_1, pipe_2,))</span><br></pre></td></tr></table></figure></div>

<p>æœ€åæ‰“å°å‡ºç»“æœ:</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="built_in">print</span>(pipe_2[<span class="number">1</span>].recv())</span><br><span class="line"><span class="keyword">except</span> EOFError:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;End&quot;</span>)</span><br></pre></td></tr></table></figure></div>

<h1 id="è¿›ç¨‹å¦‚ä½•åŒæ­¥"><a href="#è¿›ç¨‹å¦‚ä½•åŒæ­¥" class="headerlink" title="è¿›ç¨‹å¦‚ä½•åŒæ­¥"></a>è¿›ç¨‹å¦‚ä½•åŒæ­¥</h1><p>å¤šä¸ªè¿›ç¨‹å¯ä»¥ååŒå·¥ä½œæ¥å®Œæˆä¸€é¡¹ä»»åŠ¡ã€‚é€šå¸¸éœ€è¦å…±äº«æ•°æ®ã€‚æ‰€ä»¥åœ¨å¤šè¿›ç¨‹ä¹‹é—´ä¿æŒæ•°æ®çš„ä¸€è‡´æ€§å°±å¾ˆé‡è¦äº†ã€‚éœ€è¦å…±äº«æ•°æ®ååŒçš„è¿›ç¨‹å¿…é¡»ä»¥é€‚å½“çš„ç­–ç•¥æ¥è¯»å†™æ•°æ®ã€‚ç›¸å…³çš„åŒæ­¥åŸè¯­å’Œçº¿ç¨‹çš„åº“å¾ˆç±»ä¼¼ã€‚</p>
<p>è¿›ç¨‹çš„åŒæ­¥åŸè¯­å¦‚ä¸‹ï¼š</p>
<ul>
<li><strong>Lock</strong>: è¿™ä¸ªå¯¹è±¡å¯ä»¥æœ‰ä¸¤ç§è£…å¡«ï¼šé”ä½çš„ï¼ˆlockedï¼‰å’Œæ²¡é”ä½çš„ï¼ˆunlockedï¼‰ã€‚ä¸€ä¸ªLockå¯¹è±¡æœ‰ä¸¤ä¸ªæ–¹æ³•ï¼Œ <code>acquire()</code> å’Œ <code>release()</code> ï¼Œæ¥æ§åˆ¶å…±äº«æ•°æ®çš„è¯»å†™æƒé™ã€‚</li>
<li><strong>Event</strong>: å®ç°äº†è¿›ç¨‹é—´çš„ç®€å•é€šè®¯ï¼Œä¸€ä¸ªè¿›ç¨‹å‘äº‹ä»¶çš„ä¿¡å·ï¼Œå¦ä¸€ä¸ªè¿›ç¨‹ç­‰å¾…äº‹ä»¶çš„ä¿¡å·ã€‚ <code>Event</code> å¯¹è±¡æœ‰ä¸¤ä¸ªæ–¹æ³•ï¼Œ <code>set()</code> å’Œ <code>clear()</code> ï¼Œæ¥ç®¡ç†è‡ªå·±å†…éƒ¨çš„å˜é‡ã€‚</li>
<li><strong>Condition</strong>: æ­¤å¯¹è±¡ç”¨æ¥åŒæ­¥éƒ¨åˆ†å·¥ä½œæµç¨‹ï¼Œåœ¨å¹¶è¡Œçš„è¿›ç¨‹ä¸­ï¼Œæœ‰ä¸¤ä¸ªåŸºæœ¬çš„æ–¹æ³•ï¼š <code>wait()</code> ç”¨æ¥ç­‰å¾…è¿›ç¨‹ï¼Œ <code>notify_all()</code> ç”¨æ¥é€šçŸ¥æ‰€æœ‰ç­‰å¾…æ­¤æ¡ä»¶çš„è¿›ç¨‹ã€‚</li>
<li><strong>Semaphore</strong>: ç”¨æ¥å…±äº«èµ„æºï¼Œä¾‹å¦‚ï¼Œæ”¯æŒå›ºå®šæ•°é‡çš„å…±äº«è¿æ¥ã€‚</li>
<li><strong>Rlock</strong>: é€’å½’é”å¯¹è±¡ã€‚å…¶ç”¨é€”å’Œæ–¹æ³•åŒ <code>Threading</code> æ¨¡å—ä¸€æ ·ã€‚</li>
<li><strong>Barrier</strong>: å°†ç¨‹åºåˆ†æˆå‡ ä¸ªé˜¶æ®µï¼Œé€‚ç”¨äºæœ‰äº›è¿›ç¨‹å¿…é¡»åœ¨æŸäº›ç‰¹å®šè¿›ç¨‹ä¹‹åæ‰§è¡Œã€‚å¤„äºéšœç¢ï¼ˆBarrierï¼‰ä¹‹åçš„ä»£ç ä¸èƒ½åŒå¤„äºéšœç¢ä¹‹å‰çš„ä»£ç å¹¶è¡Œã€‚</li>
</ul>
<p>ä¸‹é¢çš„ä»£ç å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ <code>barrier()</code> å‡½æ•°æ¥åŒæ­¥ä¸¤ä¸ªè¿›ç¨‹ã€‚æˆ‘ä»¬æœ‰4ä¸ªè¿›ç¨‹ï¼Œè¿›ç¨‹1å’Œè¿›ç¨‹2ç”±barrierè¯­å¥ç®¡ç†ï¼Œè¿›ç¨‹3å’Œè¿›ç¨‹4æ²¡æœ‰åŒæ­¥ç­–ç•¥ã€‚</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> multiprocessing</span><br><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Barrier, Lock, Process</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_with_barrier</span>(<span class="params">synchronizer, serializer</span>):</span><br><span class="line">    name = multiprocessing.current_process().name</span><br><span class="line">    synchronizer.wait()		<span class="comment">#å½“ä¸¤ä¸ªè¿›ç¨‹éƒ½è°ƒç”¨ wait() æ–¹æ³•çš„æ—¶å€™ï¼Œå®ƒä»¬ä¼šä¸€èµ·ç»§ç»­æ‰§è¡Œä¸‹é¢çš„ä»£ç </span></span><br><span class="line">    now = time()</span><br><span class="line">    <span class="keyword">with</span> serializer:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;process %s ----&gt; %s&quot;</span> % (name, datetime.fromtimestamp(now)))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_without_barrier</span>():</span><br><span class="line">    name = multiprocessing.current_process().name</span><br><span class="line">    now = time()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;process %s ----&gt; %s&quot;</span> % (name, datetime.fromtimestamp(now)))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    synchronizer = Barrier(<span class="number">2</span>)</span><br><span class="line">    serializer = Lock()</span><br><span class="line">    <span class="comment">#è¿›ç¨‹1ï¼Œ2åŠ äº†é”ï¼Œå®ç°äº†åŒæ­¥</span></span><br><span class="line">    Process(name=<span class="string">&#x27;p1 - test_with_barrier&#x27;</span>, target=test_with_barrier, args=(synchronizer,serializer)).start()</span><br><span class="line">    Process(name=<span class="string">&#x27;p2 - test_with_barrier&#x27;</span>, target=test_with_barrier, args=(synchronizer,serializer)).start()</span><br><span class="line">    Process(name=<span class="string">&#x27;p3 - test_without_barrier&#x27;</span>, target=test_without_barrier).start()</span><br><span class="line">    Process(name=<span class="string">&#x27;p4 - test_without_barrier&#x27;</span>, target=test_without_barrier).start()</span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ python process_barrier.py</span><br><span class="line">process p1 - test_with_barrier ----&gt; 2015-05-09 11:11:33.291229</span><br><span class="line">process p2 - test_with_barrier ----&gt; 2015-05-09 11:11:33.291229</span><br><span class="line">process p3 - test_without_barrier ----&gt; 2015-05-09 11:11:33.310230</span><br><span class="line">process p4 - test_without_barrier ----&gt; 2015-05-09 11:11:33.333231</span><br></pre></td></tr></table></figure></div>

<h1 id="å¦‚ä½•åœ¨è¿›ç¨‹ä¹‹é—´ç®¡ç†çŠ¶æ€"><a href="#å¦‚ä½•åœ¨è¿›ç¨‹ä¹‹é—´ç®¡ç†çŠ¶æ€" class="headerlink" title="å¦‚ä½•åœ¨è¿›ç¨‹ä¹‹é—´ç®¡ç†çŠ¶æ€"></a>å¦‚ä½•åœ¨è¿›ç¨‹ä¹‹é—´ç®¡ç†çŠ¶æ€</h1><p>Pythonçš„å¤šè¿›ç¨‹æ¨¡å—æä¾›äº†åœ¨æ‰€æœ‰çš„ç”¨æˆ·é—´ç®¡ç†å…±äº«ä¿¡æ¯çš„ç®¡ç†è€…(Manager)ã€‚ä¸€ä¸ªç®¡ç†è€…å¯¹è±¡æ§åˆ¶ç€æŒæœ‰Pythonå¯¹è±¡çš„æœåŠ¡è¿›ç¨‹ï¼Œå¹¶å…è®¸å…¶å®ƒè¿›ç¨‹æ“ä½œå…±äº«å¯¹è±¡ã€‚</p>
<p>ç®¡ç†è€…æœ‰ä»¥ä¸‹ç‰¹æ€§ï¼š</p>
<ul>
<li>å®ƒæ§åˆ¶ç€ç®¡ç†å…±äº«å¯¹è±¡çš„æœåŠ¡è¿›ç¨‹</li>
<li>å®ƒç¡®ä¿å½“æŸä¸€è¿›ç¨‹ä¿®æ”¹äº†å…±äº«å¯¹è±¡ä¹‹åï¼Œæ‰€æœ‰çš„è¿›ç¨‹æ‹¿åˆ°é¢å…±äº«å¯¹è±¡éƒ½å¾—åˆ°äº†æ›´æ–°</li>
</ul>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> multiprocessing</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">worker</span>(<span class="params">dictionary, key, item</span>):</span><br><span class="line">   dictionary[key] = item</span><br><span class="line">   <span class="built_in">print</span>(<span class="string">&quot;key = %d value = %d&quot;</span> % (key, item))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    mgr = multiprocessing.Manager()</span><br><span class="line">    dictionary = mgr.<span class="built_in">dict</span>()</span><br><span class="line">    <span class="comment">#manageråˆ›ç«‹äº†10ä¸ªè¿›ç¨‹ï¼Œæ›´æ–°å­—å…¸</span></span><br><span class="line">    jobs = [multiprocessing.Process(target=worker, args=(dictionary, i, i*<span class="number">2</span>)) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>)]</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> jobs:</span><br><span class="line">        j.start()</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> jobs:</span><br><span class="line">        j.join()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Results:&#x27;</span>, dictionary)</span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ python manager.py</span><br><span class="line">key = 0 value = 0</span><br><span class="line">key = 3 value = 6</span><br><span class="line">key = 2 value = 4</span><br><span class="line">key = 1 value = 2</span><br><span class="line">key = 4 value = 8</span><br><span class="line">key = 5 value = 10</span><br><span class="line">key = 8 value = 16</span><br><span class="line">key = 6 value = 12</span><br><span class="line">key = 7 value = 14</span><br><span class="line">key = 9 value = 18</span><br><span class="line">Results: &#123;0: 0, 3: 6, 2: 4, 1: 2, 4: 8, 5: 10, 8: 16, 6: 12, 7: 14, 9: 18&#125;</span><br></pre></td></tr></table></figure></div>

<h1 id="å¦‚ä½•ä½¿ç”¨è¿›ç¨‹æ± "><a href="#å¦‚ä½•ä½¿ç”¨è¿›ç¨‹æ± " class="headerlink" title="å¦‚ä½•ä½¿ç”¨è¿›ç¨‹æ± "></a>å¦‚ä½•ä½¿ç”¨è¿›ç¨‹æ± </h1><p>å¤šè¿›ç¨‹åº“æä¾›äº† <code>Pool</code> ç±»æ¥å®ç°ç®€å•çš„å¤šè¿›ç¨‹ä»»åŠ¡ã€‚ <code>Pool</code> ç±»æœ‰ä»¥ä¸‹æ–¹æ³•ï¼š</p>
<ul>
<li><code>apply()</code>: ç›´åˆ°å¾—åˆ°ç»“æœä¹‹å‰ä¸€ç›´é˜»å¡ã€‚</li>
<li><code>apply_async()</code>: è¿™æ˜¯ <code>apply()</code> æ–¹æ³•çš„ä¸€ä¸ªå˜ä½“ï¼Œè¿”å›çš„æ˜¯ä¸€ä¸ªresultå¯¹è±¡ã€‚è¿™æ˜¯ä¸€ä¸ªå¼‚æ­¥çš„æ“ä½œï¼Œ<strong>åœ¨æ‰€æœ‰çš„å­ç±»æ‰§è¡Œä¹‹å‰ä¸ä¼šé”ä½ä¸»è¿›ç¨‹ã€‚</strong></li>
<li><code>map()</code>: è¿™æ˜¯å†…ç½®çš„ <code>map()</code> å‡½æ•°çš„å¹¶è¡Œç‰ˆæœ¬ã€‚åœ¨å¾—åˆ°ç»“æœä¹‹å‰ä¸€ç›´é˜»å¡ï¼Œæ­¤æ–¹æ³•å°†å¯è¿­ä»£çš„æ•°æ®çš„æ¯ä¸€ä¸ªå…ƒç´ ä½œä¸ºè¿›ç¨‹æ± çš„ä¸€ä¸ªä»»åŠ¡æ¥æ‰§è¡Œã€‚</li>
<li><code>map_async()</code>: è¿™æ˜¯ <code>map()</code> æ–¹æ³•çš„ä¸€ä¸ªå˜ä½“ï¼Œè¿”å›ä¸€ä¸ªresultå¯¹è±¡ã€‚å¦‚æœæŒ‡å®šäº†å›è°ƒå‡½æ•°ï¼Œå›è°ƒå‡½æ•°åº”è¯¥æ˜¯callableçš„ï¼Œå¹¶ä¸”åªæ¥å—ä¸€ä¸ªå‚æ•°ã€‚å½“resultå‡†å¤‡å¥½æ—¶ä¼šè‡ªåŠ¨è°ƒç”¨å›è°ƒå‡½æ•°ï¼ˆé™¤éè°ƒç”¨å¤±è´¥ï¼‰ã€‚å›è°ƒå‡½æ•°åº”è¯¥ç«‹å³å®Œæˆï¼Œå¦åˆ™ï¼ŒæŒæœ‰resultçš„è¿›ç¨‹å°†è¢«é˜»å¡ã€‚</li>
</ul>
<p>ä¸‹é¢çš„ä¾‹å­å±•ç¤ºäº†å¦‚æœé€šè¿‡è¿›ç¨‹æ± æ¥æ‰§è¡Œä¸€ä¸ªå¹¶è¡Œåº”ç”¨ã€‚æˆ‘ä»¬åˆ›å»ºäº†æœ‰4ä¸ªè¿›ç¨‹çš„è¿›ç¨‹æ± ï¼Œç„¶åä½¿ç”¨ <code>map()</code> æ–¹æ³•è¿›è¡Œä¸€ä¸ªç®€å•çš„è®¡ç®—ã€‚</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> multiprocessing</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">function_square</span>(<span class="params">data</span>):</span><br><span class="line">    result = data*data</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    inputs = <span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">100</span>))</span><br><span class="line">    pool = multiprocessing.Pool(processes=<span class="number">4</span>)</span><br><span class="line">    pool_outputs = pool.<span class="built_in">map</span>(function_square, inputs)		<span class="comment">#pool.map æ–¹æ³•å°†ä¸€äº›ç‹¬ç«‹çš„ä»»åŠ¡æäº¤ç»™è¿›ç¨‹æ± ï¼š</span></span><br><span class="line">    pool.close()</span><br><span class="line">    pool.join()</span><br><span class="line">    <span class="built_in">print</span> (<span class="string">&#x27;Pool    :&#x27;</span>, pool_outputs)</span><br></pre></td></tr></table></figure></div>

<p>è®¡ç®—çš„ç»“æœå¦‚ä¸‹ï¼š</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ python poll.py</span><br><span class="line">(&#x27;Pool    :&#x27;, [0, 1, 4, 9, 16, 25, 36, 49, 64, 81, 100, 121, 144, 169, 196, 225, 256, 289, 324, 361, 400, 441,</span><br></pre></td></tr></table></figure></div>

<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ <code>pool.map()</code> æ–¹æ³•çš„ç»“æœå’ŒPythonå†…ç½®çš„ <code>map()</code> ç»“æœæ˜¯ç›¸åŒçš„ï¼Œä¸åŒçš„æ˜¯ <code>pool.map()</code> æ˜¯é€šè¿‡å¤šä¸ªå¹¶è¡Œè¿›ç¨‹è®¡ç®—çš„ã€‚</p>
<h1 id="ä½¿ç”¨Pythonçš„mpi4pyæ¨¡å—"><a href="#ä½¿ç”¨Pythonçš„mpi4pyæ¨¡å—" class="headerlink" title="ä½¿ç”¨Pythonçš„mpi4pyæ¨¡å—"></a>ä½¿ç”¨Pythonçš„mpi4pyæ¨¡å—</h1><p>Python æä¾›äº†å¾ˆå¤šMPIæ¨¡å—å†™å¹¶è¡Œç¨‹åºã€‚å…¶ä¸­ <code>mpi4py</code> æ˜¯ä¸€ä¸ªåˆæœ‰æ„æ€çš„åº“ã€‚å®ƒåœ¨MPI-1&#x2F;2é¡¶å±‚æ„å»ºï¼Œæä¾›äº†é¢å‘å¯¹è±¡çš„æ¥å£ï¼Œç´§è·ŸC++ç»‘å®šçš„ MPI-2ã€‚MPIçš„Cè¯­è¨€ç”¨æˆ·å¯ä»¥æ— éœ€å­¦ä¹ æ–°çš„æ¥å£å°±å¯ä»¥ä¸Šæ‰‹è¿™ä¸ªåº“ã€‚æ‰€ä»¥ï¼Œå®ƒæˆä¸ºäº†Pythonä¸­æœ€å¹¿æ³›ä½¿ç”¨çš„MPIåº“ã€‚</p>
<p>æ­¤æ¨¡å—åŒ…å«çš„ä¸»è¦åº”ç”¨æœ‰ï¼š</p>
<ul>
<li>ç‚¹å¯¹ç‚¹é€šè®¯</li>
<li>é›†ä½“é€šè®¯</li>
<li>æ‹“æ‰‘</li>
</ul>
<p>æˆ‘ä»¬é€šè¿‡æ‰“å°â€œHello worldâ€æ¥å¼€å§‹MPIä¹‹æ—…ï¼š</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># hello.py</span></span><br><span class="line"><span class="keyword">from</span> mpi4py <span class="keyword">import</span> MPI</span><br><span class="line">comm = MPI.COMM_WORLD</span><br><span class="line">rank = comm.Get_rank()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;hello world from process &quot;</span>, rank)</span><br></pre></td></tr></table></figure></div>

<p>é€šè¿‡ä¸‹é¢çš„å‘½ä»¤æ‰§è¡Œä»£ç ï¼š</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:&gt; mpiexec  -n 5 python  helloWorld_MPI.py</span><br></pre></td></tr></table></figure></div>

<p>æ‰§è¡Œç»“æœå°†å¾—åˆ°å¦‚ä¸‹çš„è¾“å‡ºï¼š</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">(&#x27;hello world from process &#x27;, 1)</span><br><span class="line">(&#x27;hello world from process &#x27;, 0)</span><br><span class="line">(&#x27;hello world from process &#x27;, 2)</span><br><span class="line">(&#x27;hello world from process &#x27;, 3)</span><br><span class="line">(&#x27;hello world from process &#x27;, 4)</span><br></pre></td></tr></table></figure></div>

<h1 id="ç‚¹å¯¹ç‚¹é€šè®¯"><a href="#ç‚¹å¯¹ç‚¹é€šè®¯" class="headerlink" title="ç‚¹å¯¹ç‚¹é€šè®¯"></a>ç‚¹å¯¹ç‚¹é€šè®¯</h1><p>MPIæä¾›çš„æœ€å®ç”¨çš„ä¸€ä¸ªç‰¹æ€§æ˜¯<strong>ç‚¹å¯¹ç‚¹é€šè®¯</strong>ã€‚ä¸¤ä¸ªä¸åŒçš„è¿›ç¨‹ä¹‹é—´å¯ä»¥é€šè¿‡ç‚¹å¯¹ç‚¹é€šè®¯äº¤æ¢æ•°æ®ï¼šä¸€ä¸ªè¿›ç¨‹æ˜¯æ¥æ”¶è€…ï¼Œä¸€ä¸ªè¿›ç¨‹æ˜¯å‘é€è€…ã€‚</p>
<p>Pythonçš„ <code>mpi4py</code> é€šè¿‡ä¸‹é¢ä¸¤ä¸ªå‡½æ•°æä¾›äº†ç‚¹å¯¹ç‚¹é€šè®¯åŠŸèƒ½ï¼š</p>
<ul>
<li><code>Comm.Send(data, process_destination)</code>: é€šè¿‡å®ƒåœ¨äº¤æµç»„ä¸­çš„rankæ¥åŒºåˆ†å‘é€ç»™ä¸åŒè¿›ç¨‹çš„æ•°æ®</li>
<li><code>Comm.Recv(process_source)</code>: æ¥æ”¶æ¥è‡ªæºè¿›ç¨‹çš„æ•°æ®ï¼Œä¹Ÿæ˜¯é€šè¿‡åœ¨äº¤æµç»„ä¸­çš„rankæ¥åŒºåˆ†çš„</li>
</ul>
<p><code>Comm</code> å˜é‡è¡¨ç¤ºäº¤æµè€…ï¼Œå®šä¹‰äº†å¯ä»¥äº’ç›¸é€šè®¯çš„è¿›ç¨‹ç»„ï¼š</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">comm = MKPI.COMM_WORLD</span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> mpi4py <span class="keyword">import</span> MPI</span><br><span class="line">comm = MPI.COMM_WORLD</span><br><span class="line">rank = comm.rank</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;my rank is : &quot;</span> , rank)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> rank == <span class="number">0</span>:</span><br><span class="line">    data = <span class="number">10000000</span></span><br><span class="line">    destination_process = <span class="number">4</span></span><br><span class="line">    comm.send(data,dest=destination_process)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;sending data % s &quot;</span> % data + <span class="string">&quot;to process % d&quot;</span> % destination_process)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> rank == <span class="number">1</span>:</span><br><span class="line">    destination_process = <span class="number">8</span></span><br><span class="line">    data = <span class="string">&quot;hello&quot;</span></span><br><span class="line">    comm.send(data,dest=destination_process)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;sending data % s :&quot;</span> % data + <span class="string">&quot;to process % d&quot;</span> % destination_process)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> rank == <span class="number">4</span>:</span><br><span class="line">   data = comm.recv(source = <span class="number">0</span>)			<span class="comment">#sourceè¡¨ç¤ºä»å“ªé‡Œæ¥å—æ•°æ®</span></span><br><span class="line">   <span class="built_in">print</span>(<span class="string">&quot;data received is = % s&quot;</span> % data)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> rank == <span class="number">8</span>:</span><br><span class="line">   data1 = comm.recv(source = <span class="number">1</span>)</span><br><span class="line">   <span class="built_in">print</span>(<span class="string">&quot;data1 received is = % s&quot;</span> % data1)</span><br></pre></td></tr></table></figure></div>

<p>è¿è¡Œè„šæœ¬çš„å‘½ä»¤å¦‚ä¸‹ï¼š</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ mpiexec -n 9 python pointToPointCommunication.py</span><br></pre></td></tr></table></figure></div>

<p>å¾—åˆ°çš„è¾“å‡ºå¦‚ä¸‹ï¼š</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">(&#x27;my rank is : &#x27;, 5)</span><br><span class="line">(&#x27;my rank is : &#x27;, 1)</span><br><span class="line">sending data hello :to process 8</span><br><span class="line">(&#x27;my rank is : &#x27;, 3)</span><br><span class="line">(&#x27;my rank is : &#x27;, 0)</span><br><span class="line">sending data 10000000 to process 4</span><br><span class="line">(&#x27;my rank is : &#x27;, 2)</span><br><span class="line">(&#x27;my rank is : &#x27;, 7)</span><br><span class="line">(&#x27;my rank is : &#x27;, 4)</span><br><span class="line">data received is = 10000000</span><br><span class="line">(&#x27;my rank is : &#x27;, 8)</span><br><span class="line">data1 received is = hello</span><br><span class="line">(&#x27;my rank is : &#x27;, 6)</span><br></pre></td></tr></table></figure></div>

<p><code>comm.send()</code> å’Œ <code>comm.recv()</code> å‡½æ•°éƒ½æ˜¯é˜»å¡çš„å‡½æ•°ã€‚ä»–ä»¬ä¼šä¸€ç›´é˜»å¡è°ƒç”¨è€…ï¼Œç›´åˆ°æ•°æ®ä½¿ç”¨å®Œæˆã€‚åŒæ—¶åœ¨MPIä¸­ï¼Œæœ‰ä¸¤ç§æ–¹å¼å‘é€å’Œæ¥æ”¶æ•°æ®ï¼š</p>
<ul>
<li>bufferæ¨¡å¼</li>
<li>åŒæ­¥æ¨¡å¼</li>
</ul>
<p><strong>åœ¨bufferæ¨¡å¼ä¸­ï¼Œåªè¦éœ€è¦å‘é€çš„æ•°æ®è¢«æ‹·è´åˆ°bufferä¸­ï¼Œæ‰§è¡Œæƒå°±ä¼šäº¤å›åˆ°ä¸»ç¨‹åºï¼Œæ­¤æ—¶æ•°æ®å¹¶éå·²ç»å‘é€&#x2F;æ¥æ”¶å®Œæˆã€‚åœ¨åŒæ­¥æ¨¡å¼ä¸­ï¼Œåªæœ‰å‡½æ•°çœŸæ­£çš„ç»“æŸå‘é€&#x2F;æ¥æ”¶ä»»åŠ¡ä¹‹åæ‰ä¼šè¿”å›ã€‚</strong></p>
<p>ä¸‹é¢çš„ä»£ç ä¸­ä»‹ç»äº†ä¸€ç§å…¸å‹çš„æ­»é”é—®é¢˜ï¼›æˆ‘ä»¬æœ‰ä¸¤ä¸ªè¿›ç¨‹ï¼Œä¸€ä¸ª <code>rank</code> ç­‰äº1ï¼Œå¦ä¸€ä¸ª <code>rank</code> ç­‰äº5ï¼Œä»–ä»¬äº’ç›¸é€šè®¯ï¼Œå¹¶ä¸”æ¯ä¸€ä¸ªéƒ½æœ‰å‘é€å’Œæ¥æ”¶çš„å‡½æ•°ã€‚</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> mpi4py <span class="keyword">import</span> MPI</span><br><span class="line">comm=MPI.COMM_WORLD</span><br><span class="line">rank = comm.rank</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;my rank is : &quot;</span> , rank)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> rank==<span class="number">1</span>:</span><br><span class="line">    data_send= <span class="string">&quot;a&quot;</span></span><br><span class="line">    destination_process = <span class="number">5</span></span><br><span class="line">    source_process = <span class="number">5</span></span><br><span class="line">    data_received=comm.recv(source=source_process)</span><br><span class="line">    comm.send(data_send,dest=destination_process)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;sending data %s &quot;</span> %data_send + <span class="string">&quot;to process %d&quot;</span> %destination_process)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;data received is = %s&quot;</span> %data_received)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> rank==<span class="number">5</span>:</span><br><span class="line">    data_send= <span class="string">&quot;b&quot;</span></span><br><span class="line">    destination_process = <span class="number">1</span></span><br><span class="line">    source_process = <span class="number">1</span></span><br><span class="line">    data_received=comm.recv(source=source_process)</span><br><span class="line">    comm.send(data_send,dest=destination_process)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;sending data %s :&quot;</span> %data_send + <span class="string">&quot;to process %d&quot;</span> %destination_process)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;data received is = %s&quot;</span> %data_received)</span><br></pre></td></tr></table></figure></div>

<p>æœæˆ‘ä»¬å°è¯•è¿è¡Œè¿™ä¸ªç¨‹åºï¼ˆåªæœ‰ä¸¤ä¸ªè¿›ç¨‹è¶³å¤Ÿäº†ï¼‰ï¼Œä¼šå‘ç°è¿™ä¸¤ä¸ªè¿›ç¨‹éƒ½ä¸ä¼šå®Œæˆï¼š</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ mpiexec -n 9 python deadLockProblems.py</span><br><span class="line">(&#x27;my rank is : &#x27;, 8)</span><br><span class="line">(&#x27;my rank is : &#x27;, 3)</span><br><span class="line">(&#x27;my rank is : &#x27;, 2)</span><br><span class="line">(&#x27;my rank is : &#x27;, 7)</span><br><span class="line">(&#x27;my rank is : &#x27;, 0)</span><br><span class="line">(&#x27;my rank is : &#x27;, 4)</span><br><span class="line">(&#x27;my rank is : &#x27;, 6)</span><br></pre></td></tr></table></figure></div>

<p>æ­¤æ—¶è¿ä¸ªè¿›ç¨‹éƒ½åœ¨ç­‰å¾…å¯¹æ–¹ï¼Œéƒ½è¢«é˜»å¡ä½äº†ã€‚ä¼šå‘ç”Ÿè¿™ç§æƒ…å†µæ˜¯å› ä¸ºMPIçš„ <code>comm.recv()</code> å‡½æ•°å’Œ <code>comm.send()</code> å‡½æ•°éƒ½æ˜¯é˜»å¡çš„ã€‚å®ƒä»¬çš„è°ƒç”¨è€…éƒ½åœ¨ç­‰å¾…å®ƒä»¬å®Œæˆã€‚<strong>å¯¹ <code>comm.send()</code> MPIæ¥è¯´ï¼Œåªæœ‰æ•°æ®å‘å‡ºä¹‹åå‡½æ•°æ‰ä¼šç»“æŸï¼Œå¯¹äº <code>comm.recv()</code> å‡½æ•°æ¥è¯´ï¼Œåªæœ‰æ¥æ”¶åˆ°æ•°æ®å‡½æ•°æ‰ä¼šç»“æŸã€‚</strong>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥å°†è¿™è¿ä¸ªå‡½æ•°è¿™æ ·å†™ï¼š</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> rank==<span class="number">1</span>:</span><br><span class="line">    data_send= <span class="string">&quot;a&quot;</span></span><br><span class="line">    destination_process = <span class="number">5</span></span><br><span class="line">    source_process = <span class="number">5</span></span><br><span class="line">    comm.send(data_send,dest=destination_process)</span><br><span class="line">    data_received=comm.recv(source=source_process)</span><br><span class="line"><span class="keyword">if</span> rank==<span class="number">5</span>:</span><br><span class="line">    data_send= <span class="string">&quot;b&quot;</span></span><br><span class="line">    destination_process = <span class="number">1</span></span><br><span class="line">    source_process = <span class="number">1</span></span><br><span class="line">    data_received=comm.recv(source=source_process)</span><br><span class="line">    comm.send(data_send,dest=destination_process)</span><br></pre></td></tr></table></figure></div>

<p>è™½ç„¶è¿™ä¸ªè§£å†³æ–¹æ³•ä»é€»è¾‘ä¸Šçº æ­£äº†ï¼Œä½†æ˜¯å¹¶ä¸ä¿è¯ä¸€å®šå¯ä»¥é¿å…æ­»é”é—®é¢˜ã€‚é‰´äºé€šè®¯æ˜¯å‘ç”Ÿåœ¨bufferçš„ï¼Œ <code>comm.send()</code> å‡½æ•°å°†è¦å‘é€çš„æ•°æ®å®Œå…¨æ‹·è´åˆ°bufferé‡Œï¼Œåªæœ‰bufferé‡Œæœ‰å®Œæ•´çš„æ•°æ®ä¹‹åç¨‹åºæ‰èƒ½ç»§ç»­è¿è¡Œã€‚å¦åˆ™ï¼Œä¾ç„¶ä¼šäº§ç”Ÿæ­»é”ï¼šå‘é€è€…ä¸èƒ½å‘é€ï¼Œå› ä¸ºbufferå·²ç»æäº¤ä½†æ˜¯æ¥æ”¶ä¸åˆ°æ¥æ”¶è€…ï¼Œä¸èƒ½æ¥æ”¶æ•°æ®ï¼Œå› ä¸ºå®ƒè¢« <code>comm.send()</code> é˜»å¡ä½äº†ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥äº¤æ¢ä¸€ä¸‹å‘é€è€…å’Œæ¥æ”¶è€…çš„é¡ºåºæ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> rank==<span class="number">1</span>:</span><br><span class="line">    data_send= <span class="string">&quot;a&quot;</span></span><br><span class="line">    destination_process = <span class="number">5</span></span><br><span class="line">    source_process = <span class="number">5</span></span><br><span class="line">    comm.send(data_send,dest=destination_process)</span><br><span class="line">    data_received=comm.recv(source=source_process)</span><br><span class="line"><span class="keyword">if</span> rank==<span class="number">5</span>:</span><br><span class="line">    data_send= <span class="string">&quot;b&quot;</span></span><br><span class="line">    destination_process = <span class="number">1</span></span><br><span class="line">    source_process = <span class="number">1</span></span><br><span class="line">    comm.send(data_send,dest=destination_process)</span><br><span class="line">    data_received=comm.recv(source=source_process)</span><br></pre></td></tr></table></figure></div>

<p>æœ€åï¼Œæˆ‘ä»¬å¾—åˆ°æ­£ç¡®çš„è¾“å‡ºå¦‚ä¸‹ï¼š</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ mpiexec -n 9 python deadLockProblems.py</span><br><span class="line">(&#x27;my rank is : &#x27;, 7)</span><br><span class="line">(&#x27;my rank is : &#x27;, 0)</span><br><span class="line">(&#x27;my rank is : &#x27;, 8)</span><br><span class="line">(&#x27;my rank is : &#x27;, 1)</span><br><span class="line">sending data a to process 5</span><br><span class="line">data received is = b</span><br><span class="line">(&#x27;my rank is : &#x27;, 5)</span><br><span class="line">sending data b :to process 1</span><br><span class="line">data received is = a</span><br><span class="line">(&#x27;my rank is : &#x27;, 2)</span><br><span class="line">(&#x27;my rank is : &#x27;, 3)</span><br><span class="line">(&#x27;my rank is : &#x27;, 4)</span><br><span class="line">(&#x27;my rank is : &#x27;, 6)</span><br></pre></td></tr></table></figure></div>

<h1 id="é›†ä½“é€šè®¯ï¼šä½¿ç”¨broadcasté€šè®¯"><a href="#é›†ä½“é€šè®¯ï¼šä½¿ç”¨broadcasté€šè®¯" class="headerlink" title="é›†ä½“é€šè®¯ï¼šä½¿ç”¨broadcasté€šè®¯"></a>é›†ä½“é€šè®¯ï¼šä½¿ç”¨broadcasté€šè®¯</h1><p>åœ¨å¹¶è¡Œä»£ç çš„å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ä¼šç»å¸¸å‘ç°éœ€è¦åœ¨å¤šä¸ªè¿›ç¨‹é—´å…±äº«æŸä¸ªå˜é‡è¿è¡Œæ—¶çš„å€¼ï¼Œæˆ–æ“ä½œå¤šä¸ªè¿›ç¨‹æä¾›çš„å˜é‡ï¼ˆå¯èƒ½å…·æœ‰ä¸åŒçš„å€¼)ã€‚</p>
<p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä½¿ç”¨äº†é€šè®¯æ•°ã€‚ä¸¾ä¾‹è¯´ï¼Œå¦‚æœè¿›ç¨‹0è¦å‘é€ä¿¡æ¯ç»™è¿›ç¨‹1å’Œè¿›ç¨‹2ï¼ŒåŒæ—¶ä¹Ÿä¼šå‘é€ä¿¡æ¯ç»™è¿›ç¨‹3ï¼Œ4ï¼Œ5ï¼Œ6ï¼Œå³ä½¿è¿™äº›è¿›ç¨‹å¹¶ä¸éœ€è¦è¿™äº›ä¿¡æ¯ã€‚</p>
<p>å¦å¤–ï¼ŒMPIåº“æä¾›äº†åœ¨å¤šä¸ªè¿›ç¨‹ä¹‹é—´äº¤æ¢ä¿¡æ¯çš„æ–¹æ³•ï¼Œé’ˆå¯¹æ‰§è¡Œçš„æœºå™¨åšäº†ä¼˜åŒ–ã€‚</p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/06/MPI/image-20230407145700539.png"
                      class="" title="image-20230407145700539"
                >

<p> <code>mpi4py</code> æ¨¡å—é€šè¿‡ä»¥ä¸‹çš„æ–¹å¼æä¾›å¹¿æ’­çš„åŠŸèƒ½ï¼š</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">buf = comm.bcast(data_to_share, rank_of_root_process)</span><br></pre></td></tr></table></figure></div>

<p>è¿™ä¸ªå‡½æ•°å°†rootæ¶ˆæ¯ä¸­åŒ…å«çš„ä¿¡æ¯å‘é€ç»™å±äº <code>comm</code> é€šè®¯ç»„å…¶ä»–çš„è¿›ç¨‹ï¼Œæ¯ä¸ªè¿›ç¨‹å¿…é¡»é€šè¿‡ç›¸åŒçš„ <code>root</code> å’Œ <code>comm</code> æ¥è°ƒç”¨å®ƒã€‚</p>
<p>ä¸‹é¢æ¥é€šè¿‡ä¸€ä¸ªä¾‹å­ç†è§£å¹¿æ’­å‡½æ•°ã€‚æˆ‘ä»¬æœ‰ä¸€ä¸ªrootè¿›ç¨‹ï¼Œ <code>rank</code> ç­‰äº0ï¼Œä¿å­˜è‡ªå·±çš„æ•°æ® <code>variable_to_share</code> ï¼Œä»¥åŠå…¶ä»–å®šä¹‰åœ¨é€šè®¯ç»„ä¸­çš„è¿›ç¨‹ã€‚</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">from mpi4py import MPI</span><br><span class="line">comm = MPI.COMM_WORLD</span><br><span class="line">rank = comm.Get_rank()</span><br><span class="line">if rank == 0:</span><br><span class="line">    variable_to_share = 100</span><br><span class="line">else:</span><br><span class="line">    variable_to_share = None</span><br><span class="line">variable_to_share = comm.bcast(variable_to_share, root=0)</span><br><span class="line">print(&quot;process = %d&quot; %rank + &quot; variable shared  = %d &quot; %variable_to_share)</span><br></pre></td></tr></table></figure></div>

<p>å’Œä¸€ä¸ªæ‹¥æœ‰10ä¸ªè¿›ç¨‹çš„é€šè®¯ç»„çš„æ‰§è¡Œè¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">C:\&gt;mpiexec -n 10 python broadcast.py</span><br><span class="line">process = 0 variable shared  = 100</span><br><span class="line">process = 8 variable shared  = 100</span><br><span class="line">process = 2 variable shared  = 100</span><br><span class="line">process = 3 variable shared  = 100</span><br><span class="line">process = 4 variable shared  = 100</span><br><span class="line">process = 5 variable shared  = 100</span><br><span class="line">process = 9 variable shared  = 100</span><br><span class="line">process = 6 variable shared  = 100</span><br><span class="line">process = 1 variable shared  = 100</span><br><span class="line">process = 7 variable shared  = 100</span><br></pre></td></tr></table></figure></div>



<p><code>rank</code> ç­‰äº0çš„rootè¿›ç¨‹åˆå§‹åŒ–äº†ä¸€ä¸ªå˜é‡ï¼Œ <code>variable_to_share</code> ï¼Œå€¼ä¸º100.è¿™ä¸ªå˜é‡å°†é€šè¿‡é€šè®¯ç»„å‘é€ç»™å…¶ä»–è¿›ç¨‹ã€‚:</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">if rank == 0:</span><br><span class="line">    variable_to_share = 100</span><br></pre></td></tr></table></figure></div>

<p>ä¸ºäº†å‘é€æ¶ˆæ¯ï¼Œæˆ‘ä»¬å£°æ˜äº†ä¸€ä¸ªå¹¿æ’­ï¼š</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">variable_to_share = comm.bcast(variable_to_share, root=0)</span><br></pre></td></tr></table></figure></div>

<p>è¿™é‡Œï¼Œ<strong>å‡½æ•°çš„å˜é‡æ˜¯è¦å‘é€çš„æ•°æ®å’Œå‘é€è€…çš„è¿›ç¨‹</strong>ã€‚å½“æˆ‘ä»¬æ‰§è¡Œä»£ç çš„æ—¶å€™ï¼Œåœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ª10ä¸ªè¿›ç¨‹çš„é€šè®¯ç»„ï¼Œ <code>variable_to_share</code> å˜é‡å°†å‘é€ç»™ç»„ä¸­çš„å…¶ä»–è¿›ç¨‹ã€‚æœ€å <code>print</code> å‡½æ•°æ‰“å°å‡ºæ¥è¿è¡Œçš„è¿›ç¨‹å’Œå®ƒä»¬çš„å˜é‡ï¼š</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(&quot;process = %d&quot; %rank + &quot; variable shared  = %d &quot; %variable_to_share)</span><br></pre></td></tr></table></figure></div>

<p>é›†ä½“é€šè®¯å…è®¸ç»„ä¸­çš„å¤šä¸ªè¿›ç¨‹åŒæ—¶è¿›è¡Œæ•°æ®äº¤æµã€‚åœ¨ <code>mpi4py</code> æ¨¡å—ä¸­ï¼Œåªæä¾›äº†é˜»å¡ç‰ˆæœ¬çš„é›†ä½“é€šè®¯ï¼ˆé˜»å¡è°ƒç”¨è€…ï¼Œç›´åˆ°ç¼“å­˜ä¸­çš„æ•°æ®å…¨éƒ¨å®‰å…¨å‘é€ã€‚ï¼‰</p>
<p>å¹¿æ³›åº”ç”¨çš„é›†ä½“é€šè®¯åº”è¯¥æ˜¯ï¼š</p>
<ol>
<li>ç»„ä¸­çš„è¿›ç¨‹æä¾›é€šè®¯çš„å±éšœ</li>
<li>é€šè®¯æ–¹å¼åŒ…æ‹¬ï¼š<ul>
<li>å°†ä¸€ä¸ªè¿›ç¨‹çš„æ•°æ®å¹¿æ’­åˆ°ç»„ä¸­å…¶ä»–è¿›ç¨‹ä¸­</li>
<li>ä»å…¶ä»–è¿›ç¨‹æ”¶é›†æ•°æ®å‘ç»™ä¸€ä¸ªè¿›ç¨‹</li>
<li>ä»ä¸€ä¸ªè¿›ç¨‹æ•£æ’­æ•°æ®æ•£æ’­åˆ°å…¶ä»–è¿›ç¨‹ä¸­</li>
</ul>
</li>
<li>å‡å°‘æ“ä½œ</li>
</ol>
<h1 id="é›†ä½“é€šè®¯ï¼šä½¿ç”¨scatteré€šè®¯"><a href="#é›†ä½“é€šè®¯ï¼šä½¿ç”¨scatteré€šè®¯" class="headerlink" title="é›†ä½“é€šè®¯ï¼šä½¿ç”¨scatteré€šè®¯"></a>é›†ä½“é€šè®¯ï¼šä½¿ç”¨scatteré€šè®¯</h1><p>scatterå‡½æ•°å’Œå¹¿æ’­å¾ˆåƒï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªå¾ˆå¤§çš„ä¸åŒï¼Œ <code>comm.bcast</code> å°†ç›¸åŒçš„æ•°æ®å‘é€ç»™æ‰€æœ‰åœ¨ç›‘å¬çš„è¿›ç¨‹ï¼Œ <code>comm.scatter</code> å¯ä»¥å°†æ•°æ®æ”¾åœ¨æ•°ç»„ä¸­ï¼Œå‘é€ç»™ä¸åŒçš„è¿›ç¨‹ã€‚ä¸‹å›¾å±•ç¤ºäº†scatterçš„åŠŸèƒ½ï¼š</p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/06/MPI/image-20230407150118235.png"
                      class="" title="image-20230407150118235"
                >

<p><code>comm.scatter</code> å‡½æ•°æ¥æ”¶ä¸€ä¸ªarrayï¼Œæ ¹æ®è¿›ç¨‹çš„rankå°†å…¶ä¸­çš„å…ƒç´ å‘é€ç»™ä¸åŒçš„è¿›ç¨‹ã€‚æ¯”å¦‚ç¬¬ä¸€ä¸ªå…ƒç´ å°†å‘é€ç»™è¿›ç¨‹0ï¼Œç¬¬äºŒä¸ªå…ƒç´ å°†å‘é€ç»™è¿›ç¨‹1ï¼Œç­‰ç­‰ã€‚ <code>mpi4py</code> ä¸­çš„å‡½æ•°åŸå‹å¦‚ä¸‹ï¼š</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">recvbuf  = comm.scatter(sendbuf, rank_of_root_process)</span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> mpi4py <span class="keyword">import</span> MPI</span><br><span class="line">comm = MPI.COMM_WORLD</span><br><span class="line">rank = comm.Get_rank()</span><br><span class="line"><span class="keyword">if</span> rank == <span class="number">0</span>:</span><br><span class="line">    array_to_share = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span> ,<span class="number">5</span> ,<span class="number">6</span> ,<span class="number">7</span>, <span class="number">8</span> ,<span class="number">9</span> ,<span class="number">10</span>]</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    array_to_share = <span class="literal">None</span></span><br><span class="line">recvbuf = comm.scatter(array_to_share, root=<span class="number">0</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;process = %d&quot;</span> %rank + <span class="string">&quot; recvbuf = %d &quot;</span> %recvbuf)</span><br></pre></td></tr></table></figure></div>

<p>è¿è¡Œä»£ç çš„è¾“å‡ºå¦‚ä¸‹ï¼š</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">C:\&gt;mpiexec -n 10 python scatter.py</span><br><span class="line">process = 0 variable shared  = 1</span><br><span class="line">process = 4 variable shared  = 5</span><br><span class="line">process = 6 variable shared  = 7</span><br><span class="line">process = 2 variable shared  = 3</span><br><span class="line">process = 5 variable shared  = 6</span><br><span class="line">process = 3 variable shared  = 4</span><br><span class="line">process = 7 variable shared  = 8</span><br><span class="line">process = 1 variable shared  = 2</span><br><span class="line">process = 8 variable shared  = 9</span><br><span class="line">process = 9 variable shared  = 10</span><br></pre></td></tr></table></figure></div>

<p>è¿™é‡Œéœ€è¦æ³¨æ„ï¼Œ <code>comm.scatter</code> æœ‰ä¸€ä¸ªé™åˆ¶<strong>ï¼Œå‘é€æ•°æ®çš„åˆ—è¡¨ä¸­å…ƒç´ çš„ä¸ªæ•°å¿…é¡»å’Œæ¥æ”¶çš„è¿›ç¨‹æ•°ç›¸ç­‰ã€‚</strong></p>
<h1 id="ä½“é€šè®¯ï¼šä½¿ç”¨gatheré€šè®¯"><a href="#ä½“é€šè®¯ï¼šä½¿ç”¨gatheré€šè®¯" class="headerlink" title="ä½“é€šè®¯ï¼šä½¿ç”¨gatheré€šè®¯"></a>ä½“é€šè®¯ï¼šä½¿ç”¨gatheré€šè®¯</h1><p><code>gather</code> å‡½æ•°åŸºæœ¬ä¸Šæ˜¯åå‘çš„ <code>scatter</code> ï¼Œå³æ‰‹æœºæ‰€æœ‰è¿›ç¨‹å‘é€å‘rootè¿›ç¨‹çš„æ•°æ®ã€‚ <code>mpi4py</code> å®ç°çš„ <code>gather</code> å‡½æ•°å¦‚ä¸‹ï¼š</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">recvbuf = comm.gather(sendbuf, rank_of_root_process)</span><br></pre></td></tr></table></figure></div>

<p>è¿™é‡Œï¼Œ <code>sendbuf</code> æ˜¯è¦å‘é€çš„æ•°æ®ï¼Œ <code>rank_of_root_process</code> ä»£è¡¨è¦æ¥æ”¶æ•°æ®è¿›ç¨‹ã€‚</p>
<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/06/MPI/image-20230407151502131.png"
                      class="" title="image-20230407151502131"
                >

<p>åœ¨æ¥ä¸‹æ¥çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬æƒ³å®ç°ä¸Šå›¾è¡¨ç¤ºçš„è¿‡ç¨‹ã€‚æ¯ä¸€ä¸ªè¿›ç¨‹éƒ½æ„å»ºè‡ªå·±çš„æ•°æ®ï¼Œå‘é€ç»™rootè¿›ç¨‹ï¼ˆrankä¸º0ï¼‰ã€‚</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> mpi4py <span class="keyword">import</span> MPI</span><br><span class="line">comm = MPI.COMM_WORLD</span><br><span class="line">size = comm.Get_size()</span><br><span class="line">rank = comm.Get_rank()</span><br><span class="line">data = (rank+<span class="number">1</span>)**<span class="number">2</span></span><br><span class="line">data = comm.gather(data, root=<span class="number">0</span>)</span><br><span class="line"><span class="keyword">if</span> rank == <span class="number">0</span>:</span><br><span class="line">    <span class="built_in">print</span> (<span class="string">&quot;rank = %s &quot;</span> %rank + <span class="string">&quot;...receiving data to other process&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, size):</span><br><span class="line">        data[i] = (i+<span class="number">1</span>)**<span class="number">2</span></span><br><span class="line">        value = data[i]</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot; process %s receiving %s from process %s&quot;</span> % (rank , value , i))</span><br></pre></td></tr></table></figure></div>

<p>æœ€åï¼Œæˆ‘ä»¬ç”¨5ä¸ªè¿›ç¨‹æ¥æ¼”ç¤ºï¼š</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">C:\&gt;mpiexec -n 5 python gather.py</span><br><span class="line">rank = 0 ...receiving data to other process</span><br><span class="line">process 0 receiving 4 from process 1</span><br><span class="line">process 0 receiving 9 from process 2</span><br><span class="line">process 0 receiving 16 from process 3</span><br><span class="line">process 0 receiving 25 from process 4</span><br></pre></td></tr></table></figure></div>

<h1 id="ä½¿ç”¨Alltoallé€šè®¯"><a href="#ä½¿ç”¨Alltoallé€šè®¯" class="headerlink" title="ä½¿ç”¨Alltoallé€šè®¯"></a>ä½¿ç”¨Alltoallé€šè®¯</h1><p><code>Alltoall</code> é›†ä½“é€šè®¯ç»“åˆäº† <code>scatter</code> å’Œ <code>gather</code> çš„åŠŸèƒ½ã€‚åœ¨ <code>mpi4py</code> ä¸­ï¼Œæœ‰ä»¥ä¸‹ä¸‰ç§ç±»å‹çš„ <code>Alltoall</code> é›†ä½“é€šè®¯ã€‚</p>
<ul>
<li><code>comm.Alltoall(sendbuf, recvbuf)</code> :</li>
<li><code>comm.Alltoallv(sendbuf, recvbuf)</code> :</li>
<li><code>comm.Alltoallw(sendbuf, recvbuf)</code> :</li>
</ul>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> mpi4py <span class="keyword">import</span> MPI</span><br><span class="line"><span class="keyword">import</span> numpy</span><br><span class="line"></span><br><span class="line">comm = MPI.COMM_WORLD</span><br><span class="line">size = comm.Get_size()</span><br><span class="line">rank = comm.Get_rank()</span><br><span class="line">a_size = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">senddata = (rank+<span class="number">1</span>)*numpy.arange(size,dtype=<span class="built_in">int</span>)</span><br><span class="line">recvdata = numpy.empty(size*a_size,dtype=<span class="built_in">int</span>)</span><br><span class="line"></span><br><span class="line">comm.Alltoall(senddata,recvdata)			<span class="comment">#comm.alltoall æ–¹æ³•å°† task j çš„ä¸­ sendbuf çš„ç¬¬iä¸ªå¯¹è±¡æ‹·è´åˆ° task i ä¸­ recvbuf çš„ç¬¬jä¸ªå¯¹è±¡</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot; process %s sending %s receiving %s&quot;</span> % (rank , senddata , recvdata))</span><br></pre></td></tr></table></figure></div>

<p>è¿è¡Œä»£ç ï¼Œè®¾å®šé€šè®¯è€…ç»„çš„è¿›ç¨‹æ•°ä¸º5ï¼Œè¾“å‡ºå¦‚ä¸‹ï¼š</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">C:\&gt;mpiexec -n 5 python alltoall.py</span><br><span class="line">process 0 sending [0 1 2 3 4] receiving [0 0 0 0 0]</span><br><span class="line">process 1 sending [0 2 4 6 8] receiving [1 2 3 4 5]</span><br><span class="line">process 2 sending [0 3 6 9 12] receiving [2 4 6 8 10]</span><br><span class="line">process 3 sending [0 4 8 12 16] receiving [3 6 9 12 15]</span><br><span class="line">process 4 sending [0 5 10 15 20] receiving [4 8 12 16 20]</span><br></pre></td></tr></table></figure></div>

<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/2023/04/06/MPI/image-20230407152146975.png"
                      class="" title="image-20230407152146975"
                >

<h1 id="ä½¿ç”¨Reduce"><a href="#ä½¿ç”¨Reduce" class="headerlink" title="ä½¿ç”¨Reduce"></a>ä½¿ç”¨Reduce</h1><p>åŒ <code>comm.gather</code> ä¸€æ ·ï¼Œ <code>comm.reduce</code> æ¥æ”¶ä¸€ä¸ªæ•°ç»„ï¼Œæ¯ä¸€ä¸ªå…ƒç´ æ˜¯ä¸€ä¸ªè¿›ç¨‹çš„è¾“å…¥ï¼Œç„¶åè¿”å›ä¸€ä¸ªæ•°ç»„ï¼Œæ¯ä¸€ä¸ªå…ƒç´ æ˜¯è¿›ç¨‹çš„è¾“å‡ºï¼Œè¿”å›ç»™ root è¿›ç¨‹ã€‚è¾“å‡ºçš„å…ƒç´ ä¸­åŒ…å«äº†ç®€åŒ–çš„ç»“æœã€‚</p>
<p>åœ¨ <code>mpi4py</code> ä¸­ï¼Œæˆ‘ä»¬å°†ç®€åŒ–æ“ä½œå®šä¹‰å¦‚ä¸‹ï¼š</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">comm.Reduce(sendbuf, recvbuf, rank_of_root_process, op = type_of_reduction_operation)</span><br></pre></td></tr></table></figure></div>

<p>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<strong>è¿™é‡Œæœ‰ä¸ªå‚æ•° <code>op</code> å’Œ <code>comm.gather</code> ä¸åŒï¼Œå®ƒä»£è¡¨ä½ æƒ³åº”ç”¨åœ¨æ•°æ®ä¸Šçš„æ“ä½œ</strong>ï¼Œ <code>mpi4py</code> æ¨¡å—ä»£è¡¨å®šä¹‰äº†ä¸€ç³»åˆ—çš„ç®€åŒ–æ“ä½œï¼Œå…¶ä¸­ä¸€äº›å¦‚ä¸‹ï¼š</p>
<ul>
<li><code>MPI.MAX</code> : è¿”å›æœ€å¤§çš„å…ƒç´ </li>
<li><code>MPI.MIN</code> : è¿”å›æœ€å°çš„å…ƒç´ </li>
<li><code>MPI.SUM</code> : å¯¹æ‰€æœ‰å…ƒç´ ç›¸åŠ </li>
<li><code>MPI.PROD</code> : å¯¹æ‰€æœ‰å…ƒç´ ç›¸ä¹˜</li>
<li><code>MPI.LAND</code> : å¯¹æ‰€æœ‰å…ƒç´ è¿›è¡Œé€»è¾‘æ“ä½œ</li>
<li><code>MPI.MAXLOC</code> : è¿”å›æœ€å¤§å€¼ï¼Œä»¥åŠæ‹¥æœ‰å®ƒçš„è¿›ç¨‹</li>
<li><code>MPI.MINLOC</code> : è¿”å›æœ€å°å€¼ï¼Œä»¥åŠæ‹¥æœ‰å®ƒçš„è¿›ç¨‹</li>
</ul>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> mpi4py <span class="keyword">import</span> MPI</span><br><span class="line">comm = MPI.COMM_WORLD</span><br><span class="line">size = comm.size</span><br><span class="line">rank = comm.rank</span><br><span class="line">array_size = <span class="number">3</span></span><br><span class="line">recvdata = numpy.zeros(array_size, dtype=numpy.<span class="built_in">int</span>)</span><br><span class="line">senddata = (rank+<span class="number">1</span>)*numpy.arange(size,dtype=numpy.<span class="built_in">int</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;process %s sending %s &quot;</span> % (rank , senddata))</span><br><span class="line">comm.Reduce(senddata, recvdata, root=<span class="number">0</span>, op=MPI.SUM)			<span class="comment">#å°†æ¯ä¸ª task çš„ç¬¬ i ä¸ªå…ƒç´ ç›¸åŠ ï¼Œç„¶åæ”¾å›åˆ° P0 è¿›ç¨‹çš„ç¬¬ i ä¸ªå…ƒç´ ä¸­ã€‚åœ¨æ¥æ”¶æ“ä½œä¸­ï¼Œ P0 æ”¶åˆ°æ•°æ® [0 6 12]ã€‚</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;on task&#x27;</span>, rank, <span class="string">&#x27;after Reduce:    data = &#x27;</span>, recvdata)</span><br></pre></td></tr></table></figure></div>

<p>æˆ‘ä»¬ç”¨é€šè®¯ç»„è¿›ç¨‹æ•°ä¸º 3 æ¥è¿è¡Œï¼Œç­‰äºç»´æŠ¤çš„æ•°ç»„çš„å¤§å°ã€‚è¾“å‡ºçš„ç»“æœå¦‚ä¸‹ï¼š</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">C:\&gt;mpiexec -n 3 python reduction2.py</span><br><span class="line"> process 2 sending [0 3 6]</span><br><span class="line">on task 2 after Reduce:    data =  [0 0 0]</span><br><span class="line"> process 1 sending [0 2 4]</span><br><span class="line">on task 1 after Reduce:    data =  [0 0 0]</span><br><span class="line"> process 0 sending [0 1 2]</span><br><span class="line">on task 0 after Reduce:    data =  [ 0  6 12]</span><br></pre></td></tr></table></figure></div>

            </div>

            
                <div class="post-copyright-info">
                    <div class="article-copyright-info-container">
    <ul>
        <li><strong>æ ‡é¢˜:</strong> MPI</li>
        <li><strong>ä½œè€…:</strong> Airex Yu</li>
        <li><strong>åˆ›å»ºäº:</strong> 2023-04-06 20:41:56</li>
        
            <li>
                <strong>æ›´æ–°äº:</strong> 2023-05-25 20:56:41
            </li>
        
        <li>
            <strong>é“¾æ¥:</strong> http://example.com/2023/04/06/MPI/
        </li>
        <li>
            <strong>ç‰ˆæƒå£°æ˜:</strong> æœ¬æ–‡ç« é‡‡ç”¨ <a class="license" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">CC BY-NC-SA 4.0</a> è¿›è¡Œè®¸å¯ã€‚
        </li>
    </ul>
</div>

                </div>
            

            
                <ul class="post-tags-box">
                    
                        <li class="tag-item">
                            <a href="/tags/%E8%BF%9B%E7%A8%8B/">#è¿›ç¨‹</a>&nbsp;
                        </li>
                    
                        <li class="tag-item">
                            <a href="/tags/%E9%80%9A%E8%AE%AF/">#é€šè®¯</a>&nbsp;
                        </li>
                    
                </ul>
            

            

            
                <div class="article-nav">
                    
                        <div class="article-prev">
                            <a class="prev"
                            rel="prev"
                            href="/2023/04/13/J5/"
                            >
                                <span class="left arrow-icon flex-center">
                                    <i class="fa-solid fa-chevron-left"></i>
                                </span>
                                <span class="title flex-center">
                                    <span class="post-nav-title-item">J5</span>
                                    <span class="post-nav-item">ä¸Šä¸€ç¯‡</span>
                                </span>
                            </a>
                        </div>
                    
                    
                        <div class="article-next">
                            <a class="next"
                            rel="next"
                            href="/2023/03/27/yolo/"
                            >
                                <span class="title flex-center">
                                    <span class="post-nav-title-item">yolo</span>
                                    <span class="post-nav-item">ä¸‹ä¸€ç¯‡</span>
                                </span>
                                <span class="right arrow-icon flex-center">
                                    <i class="fa-solid fa-chevron-right"></i>
                                </span>
                            </a>
                        </div>
                    
                </div>
            


            
                <div class="comment-container">
                    <div class="comments-container">
    <div id="comment-anchor"></div>
    <div class="comment-area-title">
        <i class="fa-solid fa-comments"></i>&nbsp;è¯„è®º
    </div>
    

        
            
 
    <div id="waline"></div>
    <script type="module"  data-pjax>
        import { init } from 'https://evan.beee.top/js/waline.mjs';

        function loadWaline() {
            init({
                el: '#waline',
                serverURL: 'https://example.example.com',
                lang: 'zh-CN',
                dark: 'body[class~="dark-mode"]',
                requiredMeta: ['nick','mail'], // cannot customize by theme config, change it yourself
            });
        }

        if ('true') {
            const loadWalineTimeout = setTimeout(() => {
                loadWaline();
                clearTimeout(loadWalineTimeout);
            }, 1000);
        } else {
            window.addEventListener('DOMContentLoaded', loadWaline);
        }
        
    </script>



        
    
</div>

                </div>
            
        </div>

        
            <div class="toc-content-container">
                <div class="post-toc-wrap">
    <div class="post-toc">
        <div class="toc-title">æ­¤é¡µç›®å½•</div>
        <div class="page-title">MPI</div>
        <ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BB%8B%E7%BB%8D"><span class="nav-text">ä»‹ç»</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#MPI-%E7%9A%84%E5%8E%86%E5%8F%B2%E7%AE%80%E4%BB%8B"><span class="nav-text">MPI çš„å†å²ç®€ä»‹</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#MPI-%E5%AF%B9%E4%BA%8E%E6%B6%88%E6%81%AF%E4%BC%A0%E9%80%92%E6%A8%A1%E5%9E%8B%E7%9A%84%E8%AE%BE%E8%AE%A1"><span class="nav-text">MPI å¯¹äºæ¶ˆæ¯ä¼ é€’æ¨¡å‹çš„è®¾è®¡</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#MPI-Hello-World"><span class="nav-text">MPI Hello World</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Hello-world-%E4%BB%A3%E7%A0%81%E6%A1%88%E4%BE%8B"><span class="nav-text">Hello world ä»£ç æ¡ˆä¾‹</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%BF%90%E8%A1%8C-MPI-hello-world-%E7%A8%8B%E5%BA%8F"><span class="nav-text">è¿è¡Œ MPI hello world ç¨‹åº</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#MPI-Send-and-Receive"><span class="nav-text">MPI Send and Receive</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#MPI-%E7%9A%84%E5%8F%91%E9%80%81%E5%92%8C%E6%8E%A5%E6%94%B6%E7%AE%80%E4%BB%8B"><span class="nav-text">MPI çš„å‘é€å’Œæ¥æ”¶ç®€ä»‹</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9F%BA%E7%A1%80-MPI-%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84"><span class="nav-text">åŸºç¡€ MPI æ•°æ®ç»“æ„</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#MPI-%E5%8F%91%E9%80%81-x2F-%E6%8E%A5%E6%94%B6-%E7%A8%8B%E5%BA%8F"><span class="nav-text">MPI å‘é€ &#x2F; æ¥æ”¶ ç¨‹åº</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#MPI-%E4%B9%92%E4%B9%93%E7%A8%8B%E5%BA%8F"><span class="nav-text">MPI ä¹’ä¹“ç¨‹åº</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%8E%AF%E7%A8%8B%E5%BA%8F"><span class="nav-text">ç¯ç¨‹åº</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Dynamic-Receiving-with-MPI-Probe-and-MPI-Status"><span class="nav-text">Dynamic Receiving with MPI Probe (and MPI Status)</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#MPI-Status-%E7%BB%93%E6%9E%84%E4%BD%93"><span class="nav-text">MPI_Status ç»“æ„ä½“</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#MPI-Status-%E7%BB%93%E6%9E%84%E4%BD%93%E6%9F%A5%E8%AF%A2%E7%9A%84%E7%A4%BA%E4%BE%8B"><span class="nav-text">MPI_Status ç»“æ„ä½“æŸ¥è¯¢çš„ç¤ºä¾‹</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-MPI-Probe-%E6%89%BE%E5%87%BA%E6%B6%88%E6%81%AF%E5%A4%A7%E5%B0%8F"><span class="nav-text">ä½¿ç”¨ MPI_Probe æ‰¾å‡ºæ¶ˆæ¯å¤§å°</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#MPI-%E5%B9%BF%E6%92%AD%E4%BB%A5%E5%8F%8A%E9%9B%86%E4%BD%93-collective-%E9%80%9A%E4%BF%A1"><span class="nav-text">MPI å¹¿æ’­ä»¥åŠé›†ä½“(collective)é€šä¿¡</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%9B%86%E4%BD%93%E9%80%9A%E4%BF%A1%E4%BB%A5%E5%8F%8A%E5%90%8C%E6%AD%A5%E7%82%B9"><span class="nav-text">é›†ä½“é€šä¿¡ä»¥åŠåŒæ­¥ç‚¹</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-MPI-Bcast-%E6%9D%A5%E8%BF%9B%E8%A1%8C%E5%B9%BF%E6%92%AD"><span class="nav-text">ä½¿ç”¨ MPI_Bcast æ¥è¿›è¡Œå¹¿æ’­</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-MPI-Send-%E5%92%8C-MPI-Recv-%E6%9D%A5%E5%81%9A%E5%B9%BF%E6%92%AD"><span class="nav-text">ä½¿ç”¨ MPI_Send å’Œ MPI_Recv æ¥åšå¹¿æ’­</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#MPI-Bcast-%E5%92%8C-MPI-Send-%E4%BB%A5%E5%8F%8A-MPI-Recv-%E7%9A%84%E6%AF%94%E8%BE%83"><span class="nav-text">MPI_Bcast å’Œ MPI_Send ä»¥åŠ MPI_Recv çš„æ¯”è¾ƒ</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#MPI-Scatter-Gather-and-Allgather"><span class="nav-text">MPI Scatter, Gather, and Allgather</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#MPI-Scatter-%E7%9A%84%E4%BB%8B%E7%BB%8D"><span class="nav-text">MPI_Scatter çš„ä»‹ç»</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#MPI-Gather-%E7%9A%84%E4%BB%8B%E7%BB%8D"><span class="nav-text">MPI_Gather çš„ä»‹ç»</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-MPI-Scatter-%E5%92%8C-MPI-Gather-%E6%9D%A5%E8%AE%A1%E7%AE%97%E5%B9%B3%E5%9D%87%E6%95%B0"><span class="nav-text">ä½¿ç”¨ MPI_Scatter å’Œ MPI_Gather æ¥è®¡ç®—å¹³å‡æ•°</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#MPI-Allgather-%E4%BB%A5%E5%8F%8A%E4%BF%AE%E6%94%B9%E5%90%8E%E7%9A%84%E5%B9%B3%E5%9D%87%E7%A8%8B%E5%BA%8F"><span class="nav-text">MPI_Allgather ä»¥åŠä¿®æ”¹åçš„å¹³å‡ç¨‹åº</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8MPI%E8%AE%A1%E7%AE%97%E5%B9%B6%E8%A1%8C%E6%8E%92%E5%90%8D"><span class="nav-text">ä½¿ç”¨MPIè®¡ç®—å¹¶è¡Œæ’å</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B9%B6%E8%A1%8C%E6%8E%92%E5%90%8D-%E9%97%AE%E9%A2%98%E6%A6%82%E8%BF%B0"><span class="nav-text">å¹¶è¡Œæ’å - é—®é¢˜æ¦‚è¿°</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B9%B6%E8%A1%8C%E6%8E%92%E5%90%8DAPI%E5%AE%9A%E4%B9%89"><span class="nav-text">å¹¶è¡Œæ’åAPIå®šä¹‰</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%A3%E5%86%B3%E5%B9%B6%E8%A1%8C%E6%8E%92%E5%90%8D%E9%97%AE%E9%A2%98"><span class="nav-text">è§£å†³å¹¶è¡Œæ’åé—®é¢˜</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8E%92%E5%BA%8F%E6%95%B0%E5%AD%97%E5%B9%B6%E7%BB%B4%E6%8A%A4%E6%89%80%E5%B1%9E"><span class="nav-text">æ’åºæ•°å­—å¹¶ç»´æŠ¤æ‰€å±</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%95%B4%E5%90%88"><span class="nav-text">æ•´åˆ</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%8C%E6%95%B4%E4%BB%A3%E7%A0%81"><span class="nav-text">å®Œæ•´ä»£ç </span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94%E2%80%94"><span class="nav-text">â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%9F%BA%E4%BA%8E%E8%BF%9B%E7%A8%8B%E7%9A%84%E5%B9%B6%E8%A1%8C"><span class="nav-text">åŸºäºè¿›ç¨‹çš„å¹¶è¡Œ</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%A6%82%E4%BD%95%E4%BA%A7%E7%94%9F%E4%B8%80%E4%B8%AA%E8%BF%9B%E7%A8%8B"><span class="nav-text">å¦‚ä½•äº§ç”Ÿä¸€ä¸ªè¿›ç¨‹</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%A6%82%E4%BD%95%E4%B8%BA%E4%B8%80%E4%B8%AA%E8%BF%9B%E7%A8%8B%E5%91%BD%E5%90%8D"><span class="nav-text">å¦‚ä½•ä¸ºä¸€ä¸ªè¿›ç¨‹å‘½å</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%A6%82%E4%BD%95%E5%9C%A8%E5%90%8E%E5%8F%B0%E8%BF%90%E8%A1%8C%E4%B8%80%E4%B8%AA%E8%BF%9B%E7%A8%8B"><span class="nav-text">å¦‚ä½•åœ¨åå°è¿è¡Œä¸€ä¸ªè¿›ç¨‹</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%A6%82%E4%BD%95%E6%9D%80%E6%8E%89%E4%B8%80%E4%B8%AA%E8%BF%9B%E7%A8%8B"><span class="nav-text">å¦‚ä½•æ€æ‰ä¸€ä¸ªè¿›ç¨‹</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%A6%82%E4%BD%95%E5%9C%A8%E5%AD%90%E7%B1%BB%E4%B8%AD%E4%BD%BF%E7%94%A8%E8%BF%9B%E7%A8%8B"><span class="nav-text">å¦‚ä½•åœ¨å­ç±»ä¸­ä½¿ç”¨è¿›ç¨‹</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%A6%82%E4%BD%95%E5%9C%A8%E8%BF%9B%E7%A8%8B%E4%B9%8B%E9%97%B4%E4%BA%A4%E6%8D%A2%E5%AF%B9%E8%B1%A1"><span class="nav-text">å¦‚ä½•åœ¨è¿›ç¨‹ä¹‹é—´äº¤æ¢å¯¹è±¡</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E9%98%9F%E5%88%97%E4%BA%A4%E6%8D%A2%E5%AF%B9%E8%B1%A1"><span class="nav-text">ä½¿ç”¨é˜Ÿåˆ—äº¤æ¢å¯¹è±¡</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E7%AE%A1%E9%81%93%E4%BA%A4%E6%8D%A2%E5%AF%B9%E8%B1%A1"><span class="nav-text">ä½¿ç”¨ç®¡é“äº¤æ¢å¯¹è±¡</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%BF%9B%E7%A8%8B%E5%A6%82%E4%BD%95%E5%90%8C%E6%AD%A5"><span class="nav-text">è¿›ç¨‹å¦‚ä½•åŒæ­¥</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%A6%82%E4%BD%95%E5%9C%A8%E8%BF%9B%E7%A8%8B%E4%B9%8B%E9%97%B4%E7%AE%A1%E7%90%86%E7%8A%B6%E6%80%81"><span class="nav-text">å¦‚ä½•åœ¨è¿›ç¨‹ä¹‹é—´ç®¡ç†çŠ¶æ€</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8%E8%BF%9B%E7%A8%8B%E6%B1%A0"><span class="nav-text">å¦‚ä½•ä½¿ç”¨è¿›ç¨‹æ± </span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8Python%E7%9A%84mpi4py%E6%A8%A1%E5%9D%97"><span class="nav-text">ä½¿ç”¨Pythonçš„mpi4pyæ¨¡å—</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%82%B9%E5%AF%B9%E7%82%B9%E9%80%9A%E8%AE%AF"><span class="nav-text">ç‚¹å¯¹ç‚¹é€šè®¯</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%9B%86%E4%BD%93%E9%80%9A%E8%AE%AF%EF%BC%9A%E4%BD%BF%E7%94%A8broadcast%E9%80%9A%E8%AE%AF"><span class="nav-text">é›†ä½“é€šè®¯ï¼šä½¿ç”¨broadcasté€šè®¯</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%9B%86%E4%BD%93%E9%80%9A%E8%AE%AF%EF%BC%9A%E4%BD%BF%E7%94%A8scatter%E9%80%9A%E8%AE%AF"><span class="nav-text">é›†ä½“é€šè®¯ï¼šä½¿ç”¨scatteré€šè®¯</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BD%93%E9%80%9A%E8%AE%AF%EF%BC%9A%E4%BD%BF%E7%94%A8gather%E9%80%9A%E8%AE%AF"><span class="nav-text">ä½“é€šè®¯ï¼šä½¿ç”¨gatheré€šè®¯</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8Alltoall%E9%80%9A%E8%AE%AF"><span class="nav-text">ä½¿ç”¨Alltoallé€šè®¯</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8Reduce"><span class="nav-text">ä½¿ç”¨Reduce</span></a></li></ol>

    </div>
</div>
            </div>
        
    </div>
</div>


                

            </div>
            
            

        </div>

        <div class="main-content-footer">
            <footer class="footer">
    <div class="info-container">
        <div class="copyright-info">
            &copy;
            
              <span>2023</span>
              -
            
            2023&nbsp;&nbsp;<i class="fa-solid fa-heart fa-beat" style="--fa-animation-duration: 0.5s; color: #f54545"></i>&nbsp;&nbsp;<a href="/">Airex Yu</a>
        </div>
        
            <script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            <div class="website-count info-item">
                
                    <span id="busuanzi_container_site_uv" class="busuanzi_container_site_uv">
                        è®¿é—®äººæ•°&nbsp;<span id="busuanzi_value_site_uv" class="busuanzi_value_site_uv"></span>
                    </span>
                
                
                    <span id="busuanzi_container_site_pv" class="busuanzi_container_site_pv">
                        æ€»è®¿é—®é‡&nbsp;<span id="busuanzi_value_site_pv" class="busuanzi_value_site_pv"></span>
                    </span>
                
            </div>
        
        <div class="theme-info info-item">
            <span class="powered-by-container">ç”± <?xml version="1.0" encoding="utf-8"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg version="1.1" id="åœ–å±¤_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1rem" height="1rem" viewBox="0 0 512 512" enable-background="new 0 0 512 512" xml:space="preserve"><path fill="#0E83CD" d="M256.4,25.8l-200,115.5L56,371.5l199.6,114.7l200-115.5l0.4-230.2L256.4,25.8z M349,354.6l-18.4,10.7l-18.6-11V275H200v79.6l-18.4,10.7l-18.6-11v-197l18.5-10.6l18.5,10.8V237h112v-79.6l18.5-10.6l18.5,10.8V354.6z"/></svg><a target="_blank" href="https://hexo.io">Hexo</a> é©±åŠ¨</span>
                <br>
            <span class="theme-version-container">ä¸»é¢˜&nbsp;<a class="theme-version" target="_blank" href="https://github.com/EvanNotFound/hexo-theme-redefine">Redefine v2.1.5</a>
        </div>
        
        
        
            <div id="start_div" style="display:none">
                2023/01/05 11:45:14
            </div>
            <div>
                åšå®¢å·²è¿è¡Œ <span class="odometer" id="runtime_days" ></span> å¤© <span class="odometer" id="runtime_hours"></span> å°æ—¶ <span class="odometer" id="runtime_minutes"></span> åˆ†é’Ÿ <span class="odometer" id="runtime_seconds"></span> ç§’
            </div>
        
        
        
            <script async data-pjax>
                try {
                    function odometer_init() {
                    const elements = document.querySelectorAll('.odometer');
                    elements.forEach(el => {
                        new Odometer({
                            el,
                            format: '( ddd).dd',
                            duration: 200
                        });
                    });
                    }
                    odometer_init();
                } catch (error) {}
            </script>
        
        
        
    </div>  
</footer>
        </div>
    </div>

    
        <div class="post-tools">
            <div class="post-tools-container">
    <ul class="article-tools-list">
        <!-- TOC aside toggle -->
        
            <li class="right-bottom-tools page-aside-toggle">
                <i class="fa-regular fa-outdent"></i>
            </li>
        

        <!-- go comment -->
        
            <li class="go-comment">
                <i class="fa-regular fa-comments"></i>
            </li>
        
    </ul>
</div>

        </div>
    

    <div class="right-side-tools-container">
        <div class="side-tools-container">
    <ul class="hidden-tools-list">
        <li class="right-bottom-tools tool-font-adjust-plus flex-center">
            <i class="fa-regular fa-magnifying-glass-plus"></i>
        </li>

        <li class="right-bottom-tools tool-font-adjust-minus flex-center">
            <i class="fa-regular fa-magnifying-glass-minus"></i>
        </li>

        <li class="right-bottom-tools tool-expand-width flex-center">
            <i class="fa-regular fa-expand"></i>
        </li>

        <li class="right-bottom-tools tool-dark-light-toggle flex-center">
            <i class="fa-regular fa-moon"></i>
        </li>

        <!-- rss -->
        

        

        <li class="right-bottom-tools tool-scroll-to-bottom flex-center">
            <i class="fa-regular fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="visible-tools-list">
        <li class="right-bottom-tools toggle-tools-list flex-center">
            <i class="fa-regular fa-cog fa-spin"></i>
        </li>
        
            <li class="right-bottom-tools tool-scroll-to-top flex-center">
                <i class="arrow-up fas fa-arrow-up"></i>
                <span class="percent"></span>
            </li>
        
        
    </ul>
</div>

    </div>

    <div class="image-viewer-container">
    <img src="">
</div>


    
        <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
          <span class="search-input-field-pre">
            <i class="fa-solid fa-keyboard"></i>
          </span>
            <div class="search-input-container">
                <input autocomplete="off"
                       autocorrect="off"
                       autocapitalize="off"
                       placeholder="æœç´¢..."
                       spellcheck="false"
                       type="search"
                       class="search-input"
                >
            </div>
            <span class="popup-btn-close">
                <i class="fa-solid fa-times"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fa-solid fa-spinner fa-spin-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>

    


</main>




<script src="/js/utils.js"></script>

<script src="/js/main.js"></script>

<script src="/js/layouts/navbarShrink.js"></script>

<script src="/js/tools/scrollTopBottom.js"></script>

<script src="/js/tools/lightDarkSwitch.js"></script>



    
<script src="/js/tools/localSearch.js"></script>




    
<script src="/js/tools/codeBlock.js"></script>




    
<script src="/js/layouts/lazyload.js"></script>




    
<script src="/js/tools/runtime.js"></script>

    
<script src="/js/libs/odometer.min.js"></script>

    
<link rel="stylesheet" href="/assets/odometer-theme-minimal.css">




  
<script src="/js/libs/Typed.min.js"></script>

  
<script src="/js/plugins/typed.js"></script>




    
<script src="/js/libs/mermaid.min.js"></script>

    
<script src="/js/plugins/mermaid.js"></script>





<div class="post-scripts pjax">
    
        
<script src="/js/tools/tocToggle.js"></script>

<script src="/js/libs/anime.min.js"></script>

<script src="/js/layouts/toc.js"></script>

<script src="/js/plugins/tabs.js"></script>

    
</div>


    
<script src="/js/libs/pjax.min.js"></script>

<script>
    window.addEventListener('DOMContentLoaded', () => {
        window.pjax = new Pjax({
            selectors: [
                'head title',
                '.page-container',
                '.pjax',
            ],
            history: true,
            debug: false,
            cacheBust: false,
            timeout: 0,
            analytics: false,
            currentUrlFullReload: false,
            scrollRestoration: false,
            // scrollTo: true,
        });

        document.addEventListener('pjax:send', () => {
            Global.utils.pjaxProgressBarStart();
        });

        document.addEventListener('pjax:complete', () => {
            Global.utils.pjaxProgressBarEnd();
            window.pjax.executeScripts(document.querySelectorAll('script[data-pjax], .pjax script'));
            Global.refresh();
        });
    });
</script>




</body>
</html>
